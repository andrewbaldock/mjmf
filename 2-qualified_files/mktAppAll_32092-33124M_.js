/* Copyright (c) 2006-2007, Marketo, Inc. All rights reserved. */

/* ========== mktCommon.js ============ */

function isAlien(a){return isObject(a)&&typeof a.constructor!='function';}
function isArray(a){return isObject(a)&&a.constructor==Array;}
function isBoolean(a){return typeof a=='boolean';}
function isEmpty(o){var i,v;if(isObject(o)){for(i in o){v=o[i];if(isUndefined(v)&&isFunction(v)){return false;}}}
return true;}
function isFunction(a){return typeof a=='function';}
function isNull(a){return typeof a=='object'&&!a;}
function isNumber(a){return typeof a=='number'&&isFinite(a);}
function isObject(a){return(a&&typeof a=='object')||isFunction(a);}
function isString(a){return typeof a=='string';}
function isUndefined(a){return typeof a=='undefined';}
function isDefined(a){return!isUndefined(a);}
function isEmptyString(a){return isString(a)&&a.length==0;}
function isNonEmptyString(a){return isString(a)&&(a!=null)&&(a.length>0);}
function isDOMElement(a){return(isObject(a)&&isDefined(a.tagName));}
function hasValue(a){return(isDefined(a)&&!isNull(a));}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(item,startIndex){var len=this.length;if(startIndex==null)
startIndex=0;else if(startIndex<0){startIndex+=len;if(startIndex<0)
startIndex=0;}
for(var i=startIndex;i<len;i++){var val=this[i]||this.charAt&&this.charAt(i);if(val==item)
return i;}
return-1;};}
if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(item,startIndex){var len=this.length;if(startIndex==null||startIndex>=len)
startIndex=len-1;else if(startIndex<0)
startIndex+=len;for(var i=startIndex;i>=0;i--){var val=this[i]||this.charAt&&this.charAt(i);if(val==item)
return i;}
return-1;};}
if(!Array.prototype.forEach){Array.prototype.forEach=function(func,thisVal){var len=this.length;for(var i=0;i<len;i++)
func.call(thisVal,this[i]||this.charAt&&this.charAt(i),i,this);};}
if(!Array.prototype.map){Array.prototype.map=function(func,thisVal){var len=this.length;var ret=new Array(len);for(var i=0;i<len;i++)
ret[i]=func.call(thisVal,this[i]||this.charAt&&this.charAt(i),i,this);return ret;};}
if(!Array.prototype.filter){Array.prototype.filter=function(func,thisVal){var len=this.length;var ret=new Array();for(var i=0;i<len;i++){var val=this[i]||this.charAt&&this.charAt(i);if(func.call(thisVal,val,i,this))
ret[ret.length]=val;}
return ret;};}
if(!Array.prototype.every){Array.prototype.every=function(func,thisVal){var len=this.length;for(var i=0;i<len;i++)
if(!func.call(thisVal,this[i]||this.charAt&&this.charAt(i),i,this))
return false;return true;};}
if(!Array.prototype.some){Array.prototype.some=function(func,thisVal){var len=this.length;for(var i=0;i<len;i++)
if(func.call(thisVal,this[i]||this.charAt&&this.charAt(i),i,this))
return true;return false;};}
(function(){var images=['/images/icons32/about.png','/images/icons48/about.png','/images/icons32/excel.gif','/images/icons48/band_aid.png','/images/icons48/plug_lan.png','/images/icons48/error.png','/images/icons32/sign_stop.png','/images/icons48/sign_stop.png','/images/icons16/refresh.png','/images/marketo/tabs/tab-strip-large-bg.gif'];for(var i=0;i<images.length;i++){var img=new Image();img.src=images[i];}})();
/* ========== mktAppJS.js ============ */

var MktAppJS={genDocInfo:{},ender:null}
MktAppJS.activatecampaignCanvas1=function(panel){if(isDefined(MktPage.canvasHook.alertMgr)&&MktPage.canvasHook.alertMgr!=null){var alertMgr=MktPage.canvasHook.alertMgr;if(isDefined(MktPage.appVars.alertItems)&&MktPage.appVars.alertItems.length>0){alertMgr.clearAll();alertMgr.addAlerts();alertMgr.showAllAlerts();alertMgr.showPostit(Ext.query("div.mktNote",$('campaignCanvas1'))[0]);}}
return true;}
MktAppJS.activateprogramCanvasDetail1=function(panel){MktMainNav.loadPE({});MktSession.lastSelExpNode=null;return false;}
MktAppJS.activatelandingPagesHome=function(panel){MktTree.selectNode('lpgTree',1);MktSession.lastSelLpgNode=1;return true;}
MktAppJS.activatelandingCanvasLP=function(panel){MktTree.selectNode('lpgTree',2);MktSession.lastSelLpgNode=2;return true;}
MktAppJS.activatelandingLPDetail=function(panel){var selNode='lpg_'+panel.config.cHData;MktTree.selectNode('lpgTree',selNode);MktSession.lastSelLpgNode=selNode;return true;}
MktAppJS.activatelandingCanvasFO=function(panel){MktTree.selectNode('lpgTree',4);MktSession.lastSelLpgNode=4;return true;}
MktAppJS.activatelandingFODetail=function(panel){var selNode='lpf_'+panel.config.cHData;MktTree.selectNode('lpgTree',selNode);MktSession.lastSelLpgNode=selNode;return true;}
MktAppJS.activatelandingCanvasIM=function(panel){MktTree.selectNode('lpgTree',5);MktSession.lastSelLpgNode=5;return true;}
MktAppJS.activatelandingIMDetail=function(panel){var selNode='lpi_'+panel.config.cHData;MktTree.selectNode('lpgTree',selNode);MktSession.lastSelLpgNode=selNode;return true;}
MktAppJS.activatelandingCanvasTM=function(panel){MktTree.selectNode('lpgTree',3);MktSession.lastSelLpgNode=3;return true;}
MktAppJS.activatelandingTMDetail=function(panel){var selNode='lpt_'+panel.config.cHData;MktTree.selectNode('lpgTree',selNode);MktSession.lastSelLpgNode=selNode;return true;}
MktAppJS.activatelandingCanvasEM=function(panel){MktTree.selectNode('lpgTree',4);MktSession.lastSelLpgNode=4;return true;}
MktAppJS.activatelandingEMDetail=function(panel){var selNode='lpe_'+panel.config.cHData;MktTree.selectNode('lpgTree',selNode);MktSession.lastSelLpgNode=selNode;return true;}
MktAppJS.activateemailTemplates=function(panel){}
MktAppJS.activateEMTemplateDetail=function(panel){}
MktAppJS.activatelandingCanvasObject=function(panel){return true;}
MktAppJS.activateallCreativeHome=function(pane){return true;}
MktAppJS.activateallAssetsHome=function(pane){return true;}
MktAppJS.mpsCStrackAPButtons=function(status){Element.hide('mpsCSFauxButton');if(status==4){Element.show('mpsCSPauseButton');Element.hide('mpsCSActivateButton');}else{Element.show('mpsCSActivateButton');Element.hide('mpsCSPauseButton');MElement.disabled('mpsCSActivateButton',(status!=5));}}
MktAppJS.mpsCSremoveProtoId=function(node){if(isDefined(node.id))node.id=node.id.slice(1);if(isDefined(node.name))node.name=node.name.slice(1);if(node.childNodes!=null){for(var i=0;i<node.childNodes.length;i++){MktAppJS.mpsCSremoveProtoId(node.childNodes.item(i));}}}
MktAppJS.cdsCScalToolsDisabled=function(calId,tf){$(calId+'MDY').disabled=tf;var cp=$(calId+'CP');if(tf){cp.src="/images/icons/table_sql_view-off24.gif";Element.addClassName(cp,"mktClickDisabled");}else{cp.src="/images/icons/table_sql_view24.gif";Element.removeClassName(cp,"mktClickDisabled");}}
MktAppJS.pdbPEBudgetDisabled=function(mtf){var baseId='pdbPEBudget';$(baseId+'Amount').disabled=mtf;$(baseId+'Unit').disabled=mtf;$(baseId+'DurSet').disabled=mtf;$(baseId+'DurOng').disabled=mtf;$(baseId+'StartMDY').disabled=mtf;MElement.textDisabled($(baseId+'TxBegin'),mtf);var scp=$(baseId+'StartCP');if(mtf){scp.src="/images/icons/table_sql_view-off24.gif";Element.addClassName(scp,"mktClickDisabled");}else{scp.src="/images/icons/table_sql_view24.gif";Element.removeClassName(scp,"mktClickDisabled");}
MElement.textDisabled($(baseId+'TxOng'),mtf);MElement.textDisabled($(baseId+'TxEnd'),mtf);var dtf=$(baseId+'DurOng').checked||mtf;$(baseId+'EndMDY').disabled=dtf;var ecp=$(baseId+'EndCP');if(dtf){ecp.src="/images/icons/table_sql_view-off24.gif";Element.addClassName(ecp,"mktClickDisabled");}else{ecp.src="/images/icons/table_sql_view24.gif";Element.removeClassName(ecp,"mktClickDisabled");}}
MktAppJS.pdbPETrackUnit=function(elem){elem=$(elem);var baseId='pdbPEBudget';var set=elem.options[elem.selectedIndex].value;if($(baseId+'Set').checked){if(set=='t'){$(baseId+'DurOng').checked=false;$(baseId+'DurSet').checked=true;MktAppJS.pdbPEBudgetDisabled(false);$(baseId+'DurOng').disabled=true;MElement.textDisabled($(baseId+'TxOng'),true);}else{$(baseId+'DurOng').disabled=false;MElement.textDisabled($(baseId+'TxOng'),false);}}}
MktAppJS.cdbCSBudUnitChanged=function(elem){}
MktAppJS.cdbCSBudSetUpdate=function(){Element.hide($('cdbCSBudErr1'));Element.hide($('cdbCSBudErr2'));Element.hide($('cdbCSBudErr3'));Element.hide($('cdbCSBudErr4'));Element.hide($('cdbCSBudErr5'));selElem=$('cdbCSBudUnit');var ba=$('cdbCSBudAmount').value;if(isNaN(ba)){Element.show($('cdbCSBudErr2'));return;}
if(ba==0){Element.show($('cdbCSBudErr2'));return;}
var set=selElem.options[selElem.selectedIndex].value;if(set=='d'){var ta=Math.ceil(ba*MktPage.appVars.adShowDays);}else if(set=='m'){var ta=ba;}else if(set=='q'){var ta=Math.ceil(ba/3);}else if(set=='t'){if(MktPage.appVars.ScheduleInited){if(!MktPage.appVars.endSpecDate){Element.show($('cdbCSBudErr4'));return;}
if(MktPage.appVars.topicActive){var sd=new Date();}else{var sd=new Date(MktPage.appVars.actDate);}
var ed=new Date(MktPage.appVars.endDate);var interval=ed.getTime()-sd.getTime();var days=interval/(1000*60*60*24);days=Math.max(days,1);var bad=ba/days;var ta=Math.ceil(bad*30.5);}else{Element.show($('cdbCSBudErr1'));return;}}
if(isNaN(MktPage.appVars.topBudMonth))MktPage.appVars.topBudMonth=0;if(MktPage.appVars.progBudEnforced){if(ta>(Number(MktPage.appVars.progAvMonth)+Number(MktPage.appVars.topBudMonth))){Element.show($('cdbCSBudErr3'));return;}
var bav=(Number(MktPage.appVars.progAvMonth)+Number(MktPage.appVars.topBudMonth))-Number(ta);MktPage.appVars.progAvMonth=bav;MktPage.appVars.topBudMonth=ta;$('cdbCSBudAv').innerHTML='$'+MktAppJS.addCommas(bav)+' / month';}
var thisbud='$'+MktAppJS.addCommas(ta)+' / month';$('cdbCSBudThis').innerHTML=thisbud;MktPage.appVars.cdbCSBudPval=ba;MktPage.appVars.cdbCSBudPunit=set;Element.hide($('cdbCSBudComp'));this.disabled(false);}
MktAppJS.dashClickHandler=function(e,obj){MktPage.activatePanel(obj.panel);}
MktAppJS.dashSetText=function(dashItemEl,text){var diEl=getEl(dashItemEl);if(diEl!=null&&diEl.dom!=null){var diNs=diEl.getNextSibling();if(diNs!=null){diNs.innerHTML=text;}}}
MktAppJS.dashSetUsedByList=function(dashListEl,list,listPlain){var listEl=Ext.get(dashListEl);if(!listEl)return;while(listEl.dom.firstChild){listEl.dom.removeChild(listEl.dom.firstChild);}
var listField=null;if(!listPlain){var data=[];for(var i=0,il=list.length;i<il;i++){var id=list[i].dlId||list[i].lpId||list[i].id,text=list[i].lpName||list[i].name,iconCls=list[i].iconCls||(list[i].navInfo?MktAppJS.componentIcons[list[i].navInfo.compSubtype]:'');data.push({id:id,text:text,iconCls:iconCls,xtra:list[i].navInfo});}
listField=new Mkt.widgets.UsedByListField({hideLabel:true,data:data});}
else{var data=[];if(list.length){for(var i=0,il=list.length;i<il;i++){data.push({text:list[i].name});}}
else{data.push({text:'None'});}
listField=new Mkt.widgets.ListField2({hideLabel:true,values:data});}
new Ext.Panel({layout:'form',unstyled:true,renderTo:listEl,items:[listField]});};MktAppJS.componentIcons={'broken':'mkiDelete2','Landing Page':'mkiWebpage','Email':'mkiMail2','Report':'mkiChartArea','Landing Page Template':'mkiWindow','Email Template':'mkiWindow','Smart List':'mkiDocumentNew','Smart Campaign':'mkiLightbulbOn'};MktAppJS.dashSetUsesItem=function(dashItemEl,item){var itemEl=Ext.get(dashItemEl);if(itemEl&&item){while(itemEl.dom.firstChild){itemEl.dom.removeChild(itemEl.dom.firstChild);}
aEx=new Ext.Element(document.createElement('a'));aEx.on('click',function(){MktDlManager.loadDl(this.navInfo);}.createDelegate(item));aEx.applyStyles("cursor:pointer; text-decoration: underline;");var icon=new Ext.Element(document.createElement('div'));var subType=item.navInfo.subType;var iconCls=MktAppJS.componentIcons[subType]||'';icon.addClass('mki16-ul '+iconCls);icon.dom.appendChild(aEx.dom);var name=item.lpName||item.name;var txt=document.createTextNode(name);aEx.dom.appendChild(txt);itemEl.dom.appendChild(icon.dom);}};MktAppJS.cdhTrackInitedDisplays=function(){MktCanvasPanel.flagById('campaignCanvasDetailBudget',!MktPage.appVars.BudgetInited);MktCanvasPanel.flagById('campaignCanvasDetailSchedule',!MktPage.appVars.ScheduleInited);MktCanvasPanel.flagById('campaignCanvasDetailTargets',!MktPage.appVars.TargetsInited);}
MktAppJS.agdhTrackInitedDisplays=function(){MktCanvasPanel.flagById('adGroupCanvasEditSettings',!MktPage.appVars.defaultsInited);}
MktAppJS.addCommas=function(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
MktAppJS.valAndSubmitProgBudgetSave=function(progId,theForm){Element.hide($('pdbPEBudErr1'));Element.hide($('pdbPEBudErr2'));if($('pdbPEBudgetSet').checked){selElem=$('pdbPEBudgetUnit');var ba=$('pdbPEBudgetAmount').value;if(isNaN(ba)){Element.show($('pdbPEBudErr1'));return false;}
if(ba==0){Element.show($('pdbPEBudErr1'));return false;}
var set=selElem.options[selElem.selectedIndex].value;if(set=='d'){var pa=Math.ceil(ba*30.5);}else if(set=='m'){var pa=ba;}else if(set=='q'){var pa=Math.ceil(ba/3);}else if(set=='t'){var pa=9999;}
if(pa<MktPage.appVars.budTopCommitted){Element.show($('pdbPEBudErr2'));return false;}}
MktSession.ajaxRequest('/explorer/editProgramBudgetSubmit?programId='
+MktPage.appVars.programId,{serializeForm:'pdbPanelForm',containerId:'pdbOuter'});return true;}
MktAppJS.populateSelectBox=function(box,optList){var box=$(box);for(var ix=0;ix<optList.length;ix++){box.options[box.options.length]=new Option(optList[ix].text,optList[ix].id);}}
MktAppJS.clearSelectBox=function(box){var box=$(box);box.options.length=0;}
MktAppJS.moveSelectedBoxElementsSorted=function(fromBox,toBox){fromBox=$(fromBox);toBox=$(toBox);for(var no=0;no<fromBox.options.length;no++){if(fromBox.options[no].selected){fromBox.options[no].selected=false;toBox.options[toBox.options.length]=new Option(fromBox.options[no].text,fromBox.options[no].value);for(var no2=no;no2<(fromBox.options.length-1);no2++){fromBox.options[no2].value=fromBox.options[no2+1].value;fromBox.options[no2].text=fromBox.options[no2+1].text;fromBox.options[no2].selected=fromBox.options[no2+1].selected;}
no=no-1;fromBox.options.length=fromBox.options.length-1;}}
var tmpTextArray=new Array();for(var no=0;no<fromBox.options.length;no++){tmpTextArray.push(fromBox.options[no].text+'___'+fromBox.options[no].value);}
tmpTextArray.sort();var tmpTextArray2=new Array();for(var no=0;no<toBox.options.length;no++){tmpTextArray2.push(toBox.options[no].text+'___'+toBox.options[no].value);}
tmpTextArray2.sort();for(var no=0;no<tmpTextArray.length;no++){var items=tmpTextArray[no].split('___');fromBox.options[no]=new Option(items[0],items[1]);}
for(var no=0;no<tmpTextArray2.length;no++){var items=tmpTextArray2[no].split('___');toBox.options[no]=new Option(items[0],items[1]);}}
MktAppJS.cdtCSLangPickerDisabled=function(tf){MElement.textDisabled('cdtCSTxLangAv',tf);MElement.textDisabled('cdtCSTxLangSel',tf);MElement.disabled('cdtCSLangAdd',tf);MElement.disabled('cdtCSLangRem',tf);$('cdtCSLangFrom').disabled=tf;$('cdtCSLangTo').disabled=tf;}
MktAppJS.cdtCSTrackNetworks=function(){var spanTag=Ext.get('cdtCSNetPartnerSpan');var targetErr=Ext.get('cdtCSTargetErr1');var netPartner=Ext.get('cdtCSNetPartner').dom;if($('cdtCSNetSearch')){if($('cdtCSNetSearch').checked){spanTag.show();$('cdtCSNetPartner').disabled=false;}else{spanTag.hide();netPartner.disabled=true;netPartner.checked=false;}
if($('cdtCSNetSearch').checked||$('cdtCSNetContent').checked){targetErr.removeClass('mktFieldError')
MElement.disabled('cdtCSTargetSave',false);}else{targetErr.addClass('mktFieldError');MElement.disabled('cdtCSTargetSave',true);}}}
MktAppJS.cdtCSMoreTerrs=function(){if($('cdtCSTerrMore')){if($('cdtCSTerrMore').checked){MktAppJS.clearSelectBox('cdtCSTerrFrom');MktAppJS.populateSelectBox('cdtCSTerrFrom',MktPage.appVars.tcountries.availableAll);}else{MktAppJS.clearSelectBox('cdtCSTerrFrom');MktAppJS.populateSelectBox('cdtCSTerrFrom',MktPage.appVars.tcountries.available);}}}
MktAppJS.cdtCSTrackGeo=function(sb){var geoPaneCountriesEl=getEl('cdtCSGeoPane2');geoPaneCountriesEl.setVisibilityMode(Element.DISPLAY);var geoPaneRegionsEl=getEl('cdtCSGeoPane3');geoPaneRegionsEl.setVisibilityMode(Element.DISPLAY);var geoPaneMetrosEl=getEl('cdtCSGeoPane4');geoPaneMetrosEl.setVisibilityMode(Element.DISPLAY);var geoPaneCitiesEl=getEl('cdtCSGeoPane5');geoPaneCitiesEl.setVisibilityMode(Element.DISPLAY);var regionSelEl=getEl('cdtCSRegionSel');if(sb.value=='a'){geoPaneCountriesEl.setDisplayed(false);geoPaneRegionsEl.setDisplayed(false);geoPaneMetrosEl.setDisplayed(false);geoPaneCitiesEl.setDisplayed(false);regionSelEl.setDisplayed(false);}else if(sb.value=='c'){geoPaneCountriesEl.setDisplayed(true);geoPaneRegionsEl.setDisplayed(false);geoPaneMetrosEl.setDisplayed(false);geoPaneCitiesEl.setDisplayed(false);regionSelEl.setDisplayed(false);}else if(sb.value=='r'){geoPaneCountriesEl.setDisplayed(false);geoPaneRegionsEl.setDisplayed(true);geoPaneMetrosEl.setDisplayed(MktPage.appVars.regionSelected.toUpperCase()=='US');geoPaneCitiesEl.setDisplayed(true);regionSelEl.setDisplayed(true);MktAppJS.cdtCSSetSelectedRegion(MktPage.appVars.regionSelected);}}
MktAppJS.cdtCSSetSelectedRegion=function(selected){var rs=getEl('cdtCSRegionSel');if(rs){for(var ix=0;ix<rs.dom.options.length;ix++){if(selected.toUpperCase()==rs.dom.options[ix].value.toUpperCase()){rs.dom.options[ix].selected=true;break;}}}}
MktAppJS.cdtCSTrackRegion=function(sb){var errMsg2=Ext.get('cdtCSTargetErr2');errMsg2.removeClass('mktFieldError');var cdtGeoErrEl=getEl('cdtGeoErr');var geoPaneMetrosEl=getEl('cdtCSGeoPane4');geoPaneMetrosEl.setVisibilityMode(Element.DISPLAY);var selRegion=sb.value.toUpperCase();if(selRegion!=MktPage.appVars.regionSelected.toLowerCase()){MktAppJS.clearSelectBox('cdtCSRegionFrom');MktAppJS.clearSelectBox('cdtCSRegionTo');MktAppJS.clearSelectBox('cdtCSMetroFrom');MktAppJS.clearSelectBox('cdtCSMetroTo');MktAppJS.populateSelectBox('cdtCSRegionFrom',[{id:0,text:"Please wait..."}]);MktAppJS.populateSelectBox('cdtCSMetroFrom',[{id:0,text:"Please wait..."}]);geoPaneMetrosEl.setDisplayed(selRegion=='US');MktSession.clockCursor(true);MktSession.ajaxRequest('progSearch/refreshRegionsRequest',{serializeParms:{selRegion:selRegion},onMySuccess:MktAppJS.cdtRefreshRegionsDone});}}
MktAppJS.cdtRefreshRegionsDone=function(){MktAppJS.clearSelectBox('cdtCSRegionFrom');MktAppJS.clearSelectBox('cdtCSMetroFrom');MktAppJS.populateSelectBox('cdtCSRegionFrom',MktPage.appVars.tregions.available);MktAppJS.populateSelectBox('cdtCSMetroFrom',MktPage.appVars.tmetros.available);MktAppJS.cdtCSSetSelectedRegion(MktPage.appVars.regionSelected);MktSession.clockCursor(false);}
MktAppJS.cdtCSTrackLang=function(sb){var targetErr3=Ext.get('cdtCSTargetErr3');targetErr3.removeClass('mktFieldError');var langPane=Ext.get('cdtCSLangPicker');langPane.setVisibilityMode(Ext.Element.DISPLAY);if(sb.value=='a'){MktAppJS.cdtCSLangPickerDisabled();langPane.hide();}else{MktAppJS.cdtCSLangPickerDisabled(false);langPane.show();}}
MktAppJS.valAndSubmitCSTargetSave=function(){var haveErrors=false;var errMsg1=Ext.get('cdtCSTargetErr1');var errMsg2=Ext.get('cdtCSTargetErr2');var errMsg3=Ext.get('cdtCSTargetErr3');errMsg1.removeClass('mktFieldError');errMsg2.removeClass('mktFieldError');errMsg3.removeClass('mktFieldError');var searchCB=Ext.get('cdtCSNetSearch');var pSrchCB=Ext.get('cdtCSNetContent');var spanTag=Ext.get('cdtCSNetPartnerSpan');var netPartner=Ext.get('cdtCSNetPartner').dom;if(!searchCB.dom.checked){errMsg1.addClass('mktFieldError');MElement.disabled('cdtCSTargetSave',true);netPartner.disabled=true;netPartner.checked=false;haveErrors=true;}
if($('cdtCSNetSearch').checked||$('cdtCSNetContent').checked){errMsg1.removeClass('mktFieldError')
MElement.disabled('cdtCSTargetSave',false);}else{errMsg1.addClass('mktFieldError');MElement.disabled('cdtCSTargetSave',true);}
var parms={topicId:MktPage.appVars.topicId};var geoSB=getEl('cdtCSGeoPaneSel');var cdtGeoErrEl=getEl('cdtGeoErr');if(geoSB.dom.value=='c'){var toTerr=getEl('cdtCSTerrTo');if(toTerr.dom.options.length==0){haveErrors=true;cdtGeoErrEl.dom.innerHTML="You must select at least one country for this targeting option";errMsg2.addClass('mktFieldError');}else{var toTerrs=[];for(var ix=0;ix<toTerr.dom.options.length;ix++){toTerrs.push(toTerr.dom.options[ix].value);}
parms.cdtCSTargetTerrs=toTerrs.join(',');}}else if(geoSB.dom.value=='r'){var toRegion=getEl('cdtCSRegionTo');var toMetro=getEl('cdtCSMetroTo');var regionSB=getEl('cdtCSRegionSel');var selRegion=regionSB.dom.value.toUpperCase();parms.cdtCSSelRegion=selRegion;var nrSels=0;var toRegions=[];for(var ix=0;ix<toRegion.dom.options.length;ix++){toRegions.push(toRegion.dom.options[ix].value);nrSels++;}
parms.cdtCSTargetRegions=toRegions.join(',');var toMetros=[];for(var ix=0;ix<toMetro.dom.options.length;ix++){toMetros.push(toMetro.dom.options[ix].value);nrSels++;}
parms.cdtCSTargetMetros=toMetros.join(',');var toCities=[];for(var ix=0;ix<MktPage.appVars.tcities.selected.length;ix++){toCities.push(MktPage.appVars.tcities.selected[ix].id);nrSels++;}
parms.cdtCSTargetCities=toCities.join(';');if(nrSels==0){haveErrors=true;if(selRegion=='US'){cdtGeoErrEl.dom.innerHTML="You must select at least one region, metro area, or city for this targeting option";}else{cdtGeoErrEl.dom.innerHTML="You must select at least one region or city for this targeting option";}
errMsg2.addClass('mktFieldError');}}
var langSB=Ext.get('cdtCSLangPaneSel');if(langSB.dom.value=='s'){var toLang=Ext.get('cdtCSLangTo');if(toLang.dom.options.length==0){errMsg3.addClass('mktFieldError');haveErrors=true;}else{var toLangs=[];for(var ix=0;ix<toLang.dom.options.length;ix++){toLangs.push(toLang.dom.options[ix].value);}
parms.cdtCSTargetLangs=toLangs.join(',');}}
if(haveErrors){return;}
MktSession.clockCursor(true);MktSession.ajaxRequest('progSearch/editTargetsRS',{serializeForm:'cdtPanelForm',serializeParms:parms,containerId:'cdtOuter'});}
MktAppJS.phcDriveCreateProgramModalBtn=function(animEl,e){MktAppJS.phcDriveCreateProgramModal(animEl);}
MktAppJS.phcDriveCreateProgramModal=function(animEl,accessZoneId){var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div id="mexProgramEditForm">'+'  <form id="mexSubmitForm" action="#" onsubmit="return false;">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Name:</td>'+'        <td class="mktForm2Field">'+'          <input type="hidden" id="accessZoneId" name="accessZoneId" value="'+(accessZoneId?accessZoneId:'')+'" />'+'          <input type="text" class="mktMedium" id="text" name="text" tabindex="1" value="" title="Campaign Folder Name" maxlength="240" style="width: 95%" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea id="desc" class="mktLong95" name="desc" tabindex="2" title="description" rows="4"></textarea>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'New Campaign Folder',iconCls:'mkiFolder',serializeForm:'mexSubmitForm',ajopts:{serializeParms:{}},okButtonTitle:'Create',width:655,height:350});mp.show(animEl,MktAppJS.phcSubmitCreateProgramModal);}
MktAppJS.phcSubmitCreateProgramModal=function(mf){MktSession.ajaxRequest('/explorer/createProgramFolder',{serializeForm:'mexSubmitForm',onMySuccess:MktMa.newProgramFolderDone.createDelegate({fromModal:true})});return false;}
MktAppJS.phcDriveConfirmDeleteModal=function(compId,pName,animEl){var cmp=Ext.getCmp(animEl.id);var msg='';if(cmp&&cmp.parentMenu&&cmp.parentMenu.xtra&&cmp.parentMenu.xtra.isArchive){msg='Delete Archive Folder?';}
else{msg='Delete Campaign Folder?';}
MktMessage.confirmDelete(msg,"Are you sure you want to delete <b>"+pName+"</b>?",function(){MktAppJS.phcSubmitDeleteProgram(compId);},animEl);}
MktAppJS.phcSubmitDeleteProgram=function(compId){MktSession.clockCursor(true);MktSession.ajaxRequest('explorer/deleteProgramRequest?compId='+compId);return true;}
MktAppJS.loadSmartCampaignMembership=function(compId,nodeId){var appVars=MktPage.appVars;if(compId==undefined){compId=appVars.smartCampaignId;}
if(isDefined(compId)&&compId!=null){window.open(MktDlManager.getDlUrl('SL',compId,'X',true),'_blank');}else if(isDefined(appVars.campaignSmartListId)&&appVars.campaignSmartListId!=null){window.open(MktDlManager.getDlUrl('SL',appVars.campaignSmartListId,'A',true),'_blank');}}
MktAppJS.chcDriveCreateSmartCampaignModalBtn=function(btn){MktAppJS.chcDriveCreateSmartCampaignModal(this.button);}
MktAppJS.chcDriveCreateSmartCampaignModal=function(animEl,programName,cloneScId,accessZoneId){var url='smartcampaigns/createCampaignRequest';var parms={};var title="";var buttonName="";Mkt.apps.localasset.ComboManager.clearForm('all');if(isDefined(cloneScId)){title='Clone Smart Campaign';buttonName='Clone';parms.cloneScId=cloneScId;}else{title='New Smart Campaign';buttonName='Create';if(isUndefined(programName)){parms.programName=MktPage.appVars.topicName;}else{parms.programName=programName;}}
if(isDefined(accessZoneId)){parms.accessZoneId=accessZoneId;}
if(isDefined(MktPage.appVars.disableActionBtn)){delete MktPage.appVars.disableActionBtn;}
var mp=new MktModalForm({url:url,title:title,iconCls:'mkiLightbulbOn',ajopts:{serializeParms:parms},okButtonTitle:buttonName,width:655,height:350});mp.on('load',function(modal){if(isDefined(MktPage.appVars.disableActionBtn)&&MktPage.appVars.disableActionBtn){modal.disableButton(0);}},mp,true);mp.show(animEl,MktAppJS.chcSubmitCreateSmartCampaignModal);}
MktAppJS.chcSubmitCreateSmartCampaignModal=function(mf){var msg;if(isDefined(mf.ajopts.serializeParms.cloneScId)){msg="Cloning smart campaign";}else{msg="Creating smart campaign";}
MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/createCampaignSubmit',{serializeForm:'mpsSubmitForm'});return false;}
MktAppJS.chcEditQualificationModal=function(smartCampaignId,animEl){var url='smartcampaigns/editSmartCampaignExclusionRS?smartCampaignId='+smartCampaignId;var mp=new MktModalForm({url:url,title:'Edit Qualification Rules',iconCls:'mkiLightbulbClock',okButtonTitle:'Save',width:400,height:250});mp.show(animEl,function(){MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/editSmartCampaignExclusion',{serializeForm:'smcEditExclusionSubmitForm',onMySuccess:MktAppJS.chcEditQualificationSuccess});return true;});};smcHome=null;programSummary=null;MktAppJS.chcEditQualificationSuccess=function(animEl){if(MktPage.appVars.smartCampaignExclusionSaved!='saved'){Ext.MessageBox.alert('Marketo',MktPage.appVars.smartCampaignExclusionResult);delete MktPage.appVars.smartCampaignExclusionResult;}
delete MktPage.appVars.smartCampaignExclusionSaved;if(smcHome&&smcHome.summaryGrid&&smcHome.summaryGrid.store){smcHome.summaryGrid.store.load();}
else if(programSummary&&programSummary.manager){programSummary.manager.reloadPanelByCompId(MktPage.appVars.smartCampaignExclusionSmartCampaignId);}
else{console.debug('no summary to reload?');}
var schedulePanel='campaignCanvasDetailSchedule';if(MktCanvas.isActiveTab(schedulePanel)){MktCanvas.setActiveTab(schedulePanel);}}
MktAppJS.chcDriveCreateEmailCampaignModal=function(animEl,leadDbSmartListId){var url='smartcampaigns/createEmailCampaignRequest';var addedProgId=false;if(isDefined(MktPage.appVars.programId)){url+='?programId='+MktPage.appVars.programId;addedProgId=true;}
if(isDefined(leadDbSmartListId)){url+=(addedProgId?'&':'?')+'leadDbSlId='+leadDbSmartListId;}
var mf=new MktModalForm({url:url,title:'New Email Campaign',iconCls:'mkiCustLightbulbOnAdd',okButtonTitle:'Next >',width:655,height:330});var pickSmartListBackBtn=mf.addClientButton('< Back',MktAppJS.chcCreateEmailGoBackNameIt);mf.hideButton(pickSmartListBackBtn);var pickEmailBackBtn=mf.addClientButton('< Back',MktAppJS.chcCreateEmailGoBackPickSmartList);mf.hideButton(pickEmailBackBtn);mf.extension={leadDbSlId:leadDbSmartListId};mf.show(animEl,MktAppJS.chcCreateEmailCheckCampaignName.createDelegate(mf));}
MktAppJS.chcCreateEmailCheckCampaignName=function(){delete MktPage.appVars.scNameAvailError;parms={programId:$('smcTEProgram').value,name:$('smcTEName').value};MktSession.ajaxRequest('smartcampaigns/checkSmartCampaignNameAvail',{serializeParms:parms,onMySuccess:MktAppJS.chcCreateEmailPickSmartList.createDelegate(this)});}
MktAppJS.chcCreateEmailPickSmartList=function(){if(!isDefined(MktPage.appVars.scNameAvailError)){MktModalForm.clearMessage();$('p.pslTEProgram').value=$('smcTEProgram').value;$('p.pslTEName').value=$('smcTEName').value;$('p.pslTEDescr').value=$('smcTEDescr').value;this.extension.ecname=$('smcTEName').value;var detailConfig={staticForm:'p.pslPickSmartListForm'};this.setButtonText(1,'Next >');this.showButton(2);this.hideButton(3);var doFn=MktAppJS.chcCreateEmailPickEmail.createDelegate(this);this.newContent(detailConfig,doFn);}}
MktAppJS.chcCreateEmailPickEmail=function(){MktModalForm.clearMessage();$('p.pemTEProgram').value=$('pslTEProgram').value;$('p.pemTEName').value=$('pslTEName').value;$('p.pemTEDescr').value=$('pslTEDescr').value;if($('pslSLOptionPickLater').checked){$('p.pemSLOption').value=$('pslSLOptionPickLater').value;}
else if($('pslSLOptionCopyExisting').checked){$('p.pemSLOption').value=$('pslSLOptionCopyExisting').value;$('p.pemCopySl').value=$('pslCopySl').value;}
else{$('p.pemSLOption').value=$('pslSLOptionRef').value;$('p.pemRefSl').value=$('pslRefSl').value;}
var detailConfig={staticForm:'p.pemPickEmailForm'};this.setButtonText(1,'Create');this.hideButton(2);this.showButton(3);var doFn=MktAppJS.chcDriveCreateEmailCampaign.createDelegate(this);this.newContent(detailConfig,doFn);}
MktAppJS.chcDriveCreateEmailCampaign=function(){MktSession.ajaxRequest('smartcampaigns/createEmailCampaignSubmit',{serializeForm:'pemSubmitPickEmailForm',onMySuccess:MktAppJS.chcEmailCampaignCreated.createDelegate(this)});MktCanvas.mask();return true;}
MktAppJS.chcEmailCampaignCreated=function(){return true;}
MktAppJS.chcCreateEmailGoBackNameIt=function(mf){MktModalForm.clearMessage();var url='smartcampaigns/createEmailCampaignRequest';var addedProgId=false;if(isDefined(MktPage.appVars.programId)){url+='?programId='+MktPage.appVars.programId;addedProgId=true;}
if(isDefined(this.extension.leadDbSlId)){url+=(addedProgId?'&':'?')+'leadDbSlId='+this.extension.leadDbSlId;}
var detailConfig={url:url};this.setButtonText(1,'Next >');this.hideButton(2);this.hideButton(3);var doFn=MktAppJS.chcCreateEmailPickSmartList;this.newContent(detailConfig,doFn);return false;}
MktAppJS.chcCreateEmailGoBackPickSmartList=function(mf){MktModalForm.clearMessage();$('p.pslTEProgram').value=$('pemTEProgram').value;$('p.pslTEName').value=$('pemTEName').value;$('p.pslTEDescr').value=$('pemTEDescr').value;if($('pemSLOption').value=='picklater'){$('p.pslSLOptionPickLater').checked=true;$('p.pslSLOptionCopyExisting').checked=false;$('p.pslSLOptionRef').checked=false;}
else if($('pemSLOption').value=='copy'){$('p.pslSLOptionPickLater').checked=false;$('p.pslSLOptionCopyExisting').checked=true;$('p.pslSLOptionRef').checked=false;$('p.pslCopySl').value=$('pemCopySl').value;}
else{$('p.pslSLOptionPickLater').checked=false;$('p.pslSLOptionCopyExisting').checked=false;$('p.pslSLOptionRef').checked=true;$('p.pslRefSl').value=$('pemRefSl').value;}
var detailConfig={staticForm:'p.pslSubmitPickSmartListForm'};this.setButtonText(1,'Next >');this.showButton(2);this.hideButton(3);var doFn=MktAppJS.chcCreateEmailPickEmail;this.newContent(detailConfig,doFn);}
MktAppJS.ldbDriveCreateSmartListModal=function(animEl,parentId,cloneFromId,cloneFromName,compSubtype,accessZoneId,marketingProgramId){if(cloneFromId&&marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId,accessZoneId:accessZoneId},onMySuccess:MktAppJS.showCreateModal.createDelegate(this,[animEl,parentId,cloneFromId,cloneFromName,compSubtype,accessZoneId,marketingProgramId])});}
else{MktAppJS.showCreateModal(animEl,parentId,cloneFromId,cloneFromName,compSubtype,accessZoneId,marketingProgramId);}}
MktAppJS.showCreateModal=function(animEl,parentId,cloneFromId,cloneFromName,compSubtype,accessZoneId,marketingProgramId){var tabIndex=1;if(isDefined(cloneFromId)){if(MktPage.appVars.marketingProgramName){cloneFromName=MktPage.appVars.marketingProgramName+"."+cloneFromName;}
var cloneHtml='<tr>'+'  <td class="mktForm2Label">Clone From:</td>'+'  <td class="mktForm2Field">'+cloneFromName+'    <div class="message"></div>'+'  </td>'+'</tr>'+'<tr id="applicationRow" class="mktRequired">'+'  <td class="mktForm2Label">Clone To:</td>'+'  <td class="mktForm2Field" id="appPicker">'+'    <div class="message"></div>'+'  </td>'+'</tr>';var cloneInputHtml='<input type="hidden" id="ldbCloneFromId" name="ldbCloneFromId" value="" />'+'<input type="hidden" id="ldbCompSubtype" name="ldbCompSubtype" value="" />';tabIndex+=2;}
var canvas=MktCanvas.getActiveTab();var html='<div id="ldbCreateSmartListForm">'+'  <form id="ldbCreateSmartListSubmitForm" onsubmit="return false;">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+(cloneHtml||'')+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">List Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" tabIndex = "'+tabIndex+++'" id="ldbListName" name="ldbListName" value="" maxsize="240" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" id="ldbListDescr" name="ldbListDescr" tabIndex = "'+tabIndex+++'" title="description" rows="4"></textarea>'+'          <input type="hidden" id="parentId" name="parentId" value="" />'+(cloneInputHtml||'')+'          <input type="hidden" id="accessZoneId" name="accessZoneId" value="" />'+'          <input type="hidden" id="marketingProgramId" name="marketingProgramId" value="" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>';if(canvas.id=='cp_maLocalAssets'&&canvas.config&&canvas.config.compId==marketingProgramId){html+='    <tr>'+'      <td>&nbsp;</td>'+'      <td>'+'        <div style="float: left;" class="mktForm2Field">'+'          <input type="checkbox" checked="checked" id="navigateToSmartList" tabIndex = "'+tabIndex+++'" name="navigateToSmartList" />'+'        </div>'+'        <div class="mktForm2Label">&nbsp;Go to Smart List</div>'+'      </td>'+'    </tr>';}'    </table>'+'  </form>'+'</div>';var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,html);},title:'New Smart List',iconCls:'mkiDocumentPlainNew',okButtonTitle:'Create',width:550,height:cloneFromId?350:270});mp.extension={};if(cloneFromId){mp.extension.cloneFromId=cloneFromId;}
if(marketingProgramId){mp.marketingProgramId=marketingProgramId;}
mp.on('load',MktAppJS.createFormLoaded,mp,true);mp.show(animEl,function(){var params={};MktSession.clockCursor(true);Ext.MessageBox.show;if(marketingProgramId){var el=Ext.query('#marketingProgramId','ldbCreateListForm')[0];if(isDefined(el)){el.value=marketingProgramId;}}
if(mp.cloneToMarketingProgramId){params.cloneToMarketingProgramId=mp.cloneToMarketingProgramId;}
if(isDefined(parentId)){var el=Ext.query('#parentId','ldbCreateListForm')[0];if(isDefined(el)){el.value=parentId;}}
if(isDefined(accessZoneId)){var el=Ext.query('#accessZoneId','ldbCreateListForm')[0];if(isDefined(el)){el.value=accessZoneId;}}
if(isDefined(cloneFromId)){var el=Ext.query('#ldbCloneFromId','ldbCreateListForm')[0];if(isDefined(el)){el.value=cloneFromId;}
var el=Ext.query('#ldbCompSubtype','ldbCreateListForm')[0];if(isDefined(el)){el.value=compSubtype;}}
MktSession.ajaxRequest('leadDatabase/createSmartList',{serializeForm:'ldbCreateSmartListSubmitForm',serializeParms:params});return false;});}
MktAppJS.createFormLoaded=function(mp){var cloneFromId=mp.extension.cloneFromId;var parentId=mp.extension.parentId;Mkt.apps.localasset.ComboManager.clearForm('all');if(cloneFromId){var dataStore=[[1,'Lead Database...']];if(MktPage.savedState.marketingProgramEnabled||MktPage.savedState.marketingEventEnabled){if(mp.marketingProgramId){dataStore.push([2,'A Different Program...']);dataStore.push([3,'Same Program']);}
else{dataStore.push([2,'A Program...']);}}
var appPickerBox=Mkt.apps.localasset.ComboManager.applicationPicker({dataStore:dataStore,renderTo:'appPicker'});appPickerBox.el.dom.setAttribute('tabIndex',1);appPickerBox.focus();appPickerBox.on('select',function(combo,object,index){var wasProgramVisible=false,setProgramVisible=false;var wasFolderVisible=false,setFolderVisible=false;if(Ext.getCmp('cloneToProgramPicker')&&Ext.getCmp('cloneToProgramPicker').isVisible()){wasProgramVisible=true;}
if(Ext.getCmp('cloneToFolderPicker')&&Ext.getCmp('cloneToFolderPicker').isVisible()){wasFolderVisible=true;}
if(object.data&&object.data.value==2){setProgramVisible=true;}
else if(object.data&&object.data.value==1){setFolderVisible=true;}
if(setProgramVisible&&!wasProgramVisible){MktAppJS.showProgramPicker(mp);parentId="";}
else if(setFolderVisible&&!wasFolderVisible){MktAppJS.showFolderPicker(mp);parentId=mp.extension.parentId
mp.cloneToMarketingProgramId="";}
if(Ext.getCmp('cloneToProgramPicker')&&!setProgramVisible){Mkt.apps.localasset.ComboManager.clearForm('program');}
if(Ext.getCmp('cloneToFolderPicker')&&!setFolderVisible){Mkt.apps.localasset.ComboManager.clearForm('folder');}
if(object.data&&object.data.value==3){mp.cloneToMarketingProgramId=mp.marketingProgramId;}});var fParentEl=Ext.getDom('parentId');if(isDefined(fParentEl)&&hasValue(parentId)){fParentEl.value=parentId;}}};MktAppJS.showProgramPicker=function(mp){var programPickerBox=Mkt.apps.localasset.ComboManager.cloneProgramPicker({});programPickerBox.on('select',function(combo,object){mp.cloneToMarketingProgramId=object.data.programId;});};MktAppJS.showFolderPicker=function(mp){var folderPickerBox=Mkt.apps.localasset.ComboManager.cloneFolderPicker({compType:'smartlist'});folderPickerBox.on('select',function(combo,object,index){getEl('parentId').dom.value=object.data.id;mp.extension.parentId=object.data.id;});};MktAppJS.atxDriveCreateReportModalBtn=function(btn){MktAppJS.atxDriveCreateReportModal(this.button);};MktAppJS.atxDriveCreateReportModal=function(animEl,appFolderId,accessZoneId,isAnalyzer){var url='analytics/createReportRequest';var parms={};var title="";var buttonName="";if(isAnalyzer){title='New Analyzer';}
else{title='New Report';}
buttonName='Create';console.debug('Creating new report/analyzer in folder',appFolderId);parms.appFolderId=appFolderId;parms.accessZoneId=accessZoneId;parms.isAnalyzer=isAnalyzer;var mp=new MktModalForm({url:url,title:title,iconCls:'mkiChartArea',ajopts:{serializeParms:parms},okButtonTitle:buttonName,width:655,height:350});mp.show(animEl,MktAppJS.atxSubmitCreateReportModal);};MktAppJS.atxSubmitCreateReportModal=function(mf){var msg="Creating report";MktSession.clockCursor(true);MktSession.ajaxRequest('analytics/createReportSubmit',{serializeForm:'atxSubmitForm'});return false;};MktAppJS.atxDriveCloneReportModalBtn=function(btn){MktAppJS.atxDriveCloneReportModal(this.button);};MktAppJS.atxDriveCloneReportModal=function(animEl,atxReportCloneFrom,accessZoneId,isAnalyzer){var url='analytics/cloneReportRequest';var parms={};var title="";var buttonName="";if(isAnalyzer){title='Clone Analyzer';}
else{title='Clone Report';}
buttonName='Clone';parms.atxReportCloneFrom=atxReportCloneFrom;parms.accessZoneId=accessZoneId;var mp=new MktModalForm({url:url,title:title,iconCls:'mkiChartArea',ajopts:{serializeParms:parms},okButtonTitle:buttonName,width:655,height:350});mp.show(animEl,MktAppJS.atxSubmitCloneReportModal);};MktAppJS.atxSubmitCloneReportModal=function(mf){var msg="Cloning report";MktSession.clockCursor(true);MktSession.ajaxRequest('analytics/cloneReportSubmit',{serializeForm:'atxSubmitForm'});return false;};MktAppJS.atxDriveCreateSubscriptionModalBtn=function(btn){MktAppJS.atxDriveCreateSubscriptionModal(this.button);}
MktAppJS.atxDriveCreateSubscriptionModal=function(animEl,atxReportCloneFrom,accessZoneId){var url='analytics/createSubscriptionRequest';var params={};var title="New Report Subscription";var buttonName="Create";if(isDefined(atxReportCloneFrom)){params.atxReportCloneFrom=atxReportCloneFrom;}
else{params.accessZoneId=accessZoneId;}
var mp=new MktModalForm({url:url,title:title,iconCls:'mkiMail2Clock',ajopts:{serializeParms:params},okButtonTitle:buttonName,width:655,height:350});mp.show(animEl,MktAppJS.atxSubmitCreateSubscriptionModal);}
MktAppJS.atxSubmitCreateSubscriptionModal=function(mf){MktSession.clockCursor(true);MktSession.ajaxRequest('analytics/createSubscriptionSubmit',{serializeForm:'atxSubmitForm',onMySuccess:MktAppJS.atxCreateSubscriptionSuccess});return false;}
MktAppJS.atxCreateSubscriptionSuccess=function(){var tab=MktCanvas.getTab('atxCanvasSubscriptions');if(tab){MktCanvas.setActiveTab('atxCanvasSubscriptions');}
else{MktMainNav.loadAnalytics({panelId:'atxCanvasSubscriptions'});}}
MktAppJS.cadDriveEditSecuritySettingsModal=function(animEl,context){var securityReader=new Ext.data.ArrayReader({fields:['id','name',{name:'minLength',type:'int'},{name:'needCharacters',type:'bool'},{name:'needDigit',type:'bool'},{name:'needMixedCase',type:'bool'},{name:'needSpecialChar',type:'bool'},{name:'expiration',type:'int'}]});var currentSecurityStore=new Ext.data.Store({data:new Array(context.currentSecurity),reader:securityReader});var currentSecurity=currentSecurityStore.getAt(0);var securityTemplates=new Ext.data.Store({data:context.securityTemplates,reader:securityReader});var changingTemplateOptions=false;var setCustomTemplate=function(changedAdvancedField){if(changingTemplateOptions){return;}
var templates=changedAdvancedField.findParentByType("form").get('templates');if(templates){templates.setValue(templates.getStore().getTotalCount()-1);}}
var changeSecurityOptions=function(changedField,selectedTemplate){var fieldSet=changedField.ownerCt.getComponent('securityOptions');if(selectedTemplate.get('id')==changedField.getStore().getTotalCount()-1){fieldSet.expand();return;}
changingTemplateOptions=true;fieldSet.get('minLength').setValue(selectedTemplate.get('minLength'));fieldSet.get('needChars_disp').setValue(selectedTemplate.get('needCharacters'));fieldSet.get('needChars').setValue(selectedTemplate.get('needCharacters'));fieldSet.get('needDigit_disp').setValue(selectedTemplate.get('needDigit'));fieldSet.get('needDigit').setValue(selectedTemplate.get('needDigit'));fieldSet.get('needMixedCase').setValue(selectedTemplate.get('needMixedCase'));fieldSet.get('needSpecialChar').setValue(selectedTemplate.get('needSpecialChar'));fieldSet.get('pwExpiration').setValue(selectedTemplate.get('expiration'));changingTemplateOptions=false;}
var advancedSettings=[{fieldLabel:'Minimum Length',xtype:'combo',name:'minLength',itemId:'minLength',width:50,forceSelection:true,triggerAction:'all',mode:'local',store:context.validLengths,displayField:'field1',value:currentSecurity.get('minLength'),listeners:{'select':setCustomTemplate}},{fieldLabel:'lowercase or UPPERCASE',name:'needCharacters_disp',xtype:'checkbox',itemId:'needChars_disp',checked:currentSecurity.get('needCharacters'),disabled:true},{name:'needChars',xtype:'hidden',itemId:'needChars',value:currentSecurity.get('needCharacters')},{fieldLabel:'Numb3r',name:'needDigit_disp',itemId:'needDigit_disp',xtype:'checkbox',checked:currentSecurity.get('needDigit'),disabled:true},{name:'needDigit',xtype:'hidden',itemId:'needDigit',value:currentSecurity.get('needDigit')},{fieldLabel:'MixED CaSe',name:'needMixedCase',xtype:'checkbox',itemId:'needMixedCase',inputValue:'true',checked:currentSecurity.get('needMixedCase'),listeners:{'check':setCustomTemplate}},{fieldLabel:'Special Ch@racter',name:'needSpecialChar',xtype:'checkbox',itemId:'needSpecialChar',inputValue:'true',checked:currentSecurity.get('needSpecialChar'),listeners:{'check':setCustomTemplate}},{fieldLabel:'Expiration',name:'pwExpiration',itemId:'pwExpiration',hiddenName:'expiration',xtype:'combo',width:85,forceSelection:true,triggerAction:'all',store:new Ext.data.ArrayStore({data:context.validExpirations,fields:['display','value']}),displayField:'display',valueField:'value',mode:'local',value:currentSecurity.get('expiration'),listeners:{'select':setCustomTemplate}}];var formPanel=new Ext.FormPanel({formId:'securityForm',labelWidth:200,frame:false,baseCls:'x-plain',width:350,items:[{itemId:'errorMessage',baseCls:'x-plain',cls:'mktModalInFormMessage mktModalErrorMessage',hidden:true},{baseCls:'x-plain',html:'<h3 style="padding-top: 10px; padding-bottom: 15px">Password settings apply to all '+context.subscriptionName+' users</h3>',cls:'mktModalInFormMessage'},{fieldLabel:'Template',name:'template',xtype:'combo',itemId:'templates',forceSelection:true,triggerAction:'all',store:securityTemplates,mode:'local',displayField:'name',valueField:'id',value:context.selectedTemplate,listeners:{'select':function(changedField,record){changeSecurityOptions(changedField,record);}}},{title:'Advanced',xtype:'fieldset',collapsed:context.selectedTemplate!=securityTemplates.getTotalCount()-1,collapsible:true,itemId:'securityOptions',items:advancedSettings}]});var pwSettingsWindow=new Ext.Window({modal:true,title:'Password Strength Settings',iconCls:'mkiLockEdit',layout:'fit',width:600,height:365,closeAction:'hide',closable:false,plain:true,items:formPanel,buttons:[{text:'Save',iconCls:'mkiOk',handler:function(){var errorCmp=formPanel.getComponent('errorMessage');errorCmp.hide();MktSession.clockCursor(true);MktSession.ajaxRequest('custAdmin/securitySettingsSubmit',{serializeForm:'securityForm',onMySuccess:function(){MktSession.clockCursor(false);var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){pwSettingsWindow.close();MktDlManager.loadDl({type:'CustAdmin',compSubtype:'securitySettings'});}
else{errorCmp.update("<h3>"+MktPage.appVars.errorMessage+"</h3>");errorCmp.show();}}});}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){pwSettingsWindow.close();}}]});pwSettingsWindow.show(animEl);}
MktAppJS.cadDriveEditUrlSettingsModal=function(animEl,context){var start=1;var end=30;var defaultExpirations=[];for(var i=start;i<=end;i++){defaultExpirations.push(i);};var formPanel=new Ext.FormPanel({formId:'urlExpireForm',labelWidth:200,frame:false,baseCls:'x-plain',width:350,items:[{itemId:'errorMessage',baseCls:'x-plain',cls:'mktModalInFormMessage mktModalErrorMessage',hidden:true},{baseCls:'x-plain',html:'<h3 style="padding-top: 10px; padding-bottom: 15px">Emails may contain links to Marketo lead details.<br />Set the number of days before the link is disabled.</h3>',cls:'mktModalInFormMessage'},{fieldLabel:'Expiration (days)',name:'urlExpiration',xtype:'combo',width:50,itemId:'urlExpiration',forceSelection:true,triggerAction:'all',store:defaultExpirations,mode:'local',displayField:'field1',valueField:'id',value:context.urlExpiration}]});var urlSettingsWindow=new Ext.Window({modal:true,title:'Email Link Expiration',iconCls:'mkiEarthLock',layout:'fit',width:440,height:220,closeAction:'hide',closable:false,plain:true,items:formPanel,buttons:[{text:'Save',iconCls:'mkiOk',handler:function(){var errorCmp=formPanel.getComponent('errorMessage');errorCmp.hide();MktSession.clockCursor(true);MktSession.ajaxRequest('custAdmin/urlExpirationSubmit',{serializeForm:'urlExpireForm',onMySuccess:function(){MktSession.clockCursor(false);var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){urlSettingsWindow.close();MktDlManager.loadDl({type:'CustAdmin',compSubtype:'securitySettings'});}
else{errorCmp.update("<h3>"+MktPage.appVars.errorMessage+"</h3>");errorCmp.show();}}});}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){urlSettingsWindow.close();}}]});urlSettingsWindow.show(animEl);}
MktAppJS.cadSubmitEditUrlSettingsModal=function(mf){MktSession.ajaxRequest('/custAdmin/urlSettingsSubmit',{serializeForm:'cadSubmitForm',containerId:'caadOuter'});return false;}
MktAppJS.cadDriveEditAccountDetailsModal=function(animEl,context){var mp=new MktModalForm({staticForm:'p.cadAccountDetailsForm',title:'Edit Account Settings',iconCls:'mkiUserEdit',okButtonTitle:'Save',width:560,height:220});mp.on('load',function(){$('cadFirstName').value=context.firstName;$('cadLastName').value=context.lastName;$('cadEmail').value=context.email;},context,true);mp.show(animEl,MktAppJS.cadSubmitEditAccountDetailsModal);}
MktAppJS.cadSubmitEditAccountDetailsModal=function(mf){MktSession.ajaxRequest('/custAdmin/accountDetailsSubmit',{serializeForm:'cadSubmitForm',containerId:'cadAccountDetails'});return false;}
MktAppJS.cadDriveChangePasswordModal=function(animEl){var securityReader=new Ext.data.ArrayReader({fields:['id','name',{name:'minLength',type:'int'},{name:'needCharacters',type:'bool'},{name:'needDigit',type:'bool'},{name:'needMixedCase',type:'bool'},{name:'needSpecialChar',type:'bool'},{name:'expiration',type:'int'}]});var currentSecurityStore=new Ext.data.Store({data:new Array(MktPage.appVars.currentSecurity),reader:securityReader});var currentSecurity=currentSecurityStore.getAt(0);var msg;msg="<div class='mktPasswordStrength' style='float:right'>"+"<div>Password Requirements:</div>"+"<div id='minLength' class='mkiBulletBallGrey mktPasswordStrengthBull'>Minimum "+currentSecurity.get('minLength')+" characters</div>"+
(currentSecurity.get('needMixedCase')?"<div id='needMixedCase' class='mkiBulletBallGrey mktPasswordStrengthBull'>MixED CaSe</div>":"<div id='needChars' class='mkiBulletBallGrey mktPasswordStrengthBull'>lowercase or UPPERCASE</div>")+
(currentSecurity.get('needDigit')?"<div id='needDigit' class='mkiBulletBallGrey mktPasswordStrengthBull'>Numb3r</div>":"")+
(currentSecurity.get('needSpecialChar')?"<div id='needSpecialChar' class='mkiBulletBallGrey mktPasswordStrengthBull'>Special Ch@racter</div>":"")+"<div id='passwordMatch' class='mkiBulletBallGrey mktPasswordStrengthBull'>Passwords Match</div>"+"</div>";var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div><h2><div class="mktModalInFormMessage"></div></h2></div><div id="cadChangePasswordForm" style="float:left; width: 300px">'+'  <form id="cadSubmitForm" action="#" onsubmit="return false;">'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Old Password:</td>'+'        <td class="mktForm2Field">'+'          <input type="password" class="mktSmall" id="cadPassword" name="cadPassword" tabindex="1" value="" title="Old Password" maxlength="240" style="width: 95%" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">New Password:</td>'+'        <td class="mktForm2Field">'+'          <input type="password" class="mktSmall" id="cadPassword1" name="cadPassword1" tabindex="2" value="" title="New Password" maxlength="240" style="width: 95%" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Retype Password:</td>'+'        <td class="mktForm2Field">'+'          <input type="password" class="mktSmall" id="cadPassword2" name="cadPassword2" tabindex="3" value="" title="New Password" maxlength="240" style="width: 95%" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'    <div style="margin-top:20px; font-size: 14px;">'+""+'</div>'+'  </form>'+'</div>'+msg);},title:'Change Password',iconCls:'mkiKey',okButtonTitle:'Save',width:660,height:300});mp.show(animEl,MktAppJS.cadSubmitChangePasswordModal);var pwStrengthConfig={successCls:'mkiHandThumbUp',failCls:'mkiHandThumbDown',minLength:{id:'minLength',value:currentSecurity.get('minLength')},needChars:{id:'needChars',value:!currentSecurity.get('needMixedCase')},needDigit:{id:'needDigit',value:currentSecurity.get('needDigit')},needMixedCase:{id:'needMixedCase',value:currentSecurity.get('needMixedCase')},needSpecialChar:{id:'needSpecialChar',value:currentSecurity.get('needSpecialChar')},passwordMatch:{id:'passwordMatch',value:true}};var validateFn=function(){var password1=Ext.get('cadPassword1');var password2=Ext.get('cadPassword2');if(password1&&password2){MktAppJS.checkPasswordStrength(password1.getValue(),password2.getValue(),pwStrengthConfig);}};var onloadFn=function(){var password1=Ext.get('cadPassword1');var password2=Ext.get('cadPassword2');if(password1&&password2){password1.on('keyup',validateFn);password1.on('blur',validateFn);password2.on('keyup',validateFn);password2.on('blur',validateFn);MktAppJS.checkPasswordStrength(password1.getValue(),password2.getValue(),pwStrengthConfig);}};mp.on('load',onloadFn);}
MktAppJS.checkPasswordStrength=function(password1,password2,config){var displayResult=function(result,itemConfig){if(itemConfig.value==false){return;}
var resultAddCls=result?config.successCls:config.failCls;var resultRemoveCls=!result?config.successCls:config.failCls;var element;if(typeof Ext!='undefined'){element=Ext.get(itemConfig.id);}
else if(typeof jQuery!='undefined'){element=$("#"+itemConfig.id);}
if(element){element.addClass(resultAddCls);element.removeClass(resultRemoveCls);}}
validLength=password1.length>=config.minLength.value;displayResult(validLength,config.minLength);hasUpperCase=/[A-Z]/.test(password1);hasLowerCase=/[a-z]/.test(password1);hasCharacters=hasUpperCase||hasLowerCase;displayResult(hasCharacters,config.needChars);hasDigit=/[0-9]/.test(password1);displayResult(hasDigit,config.needDigit);isMixedCase=hasUpperCase&&hasLowerCase;displayResult(isMixedCase,config.needMixedCase);hasSpecialCharacter=/[^A-Za-z0-9]/.test(password1);displayResult(hasSpecialCharacter,config.needSpecialChar);passwordsMatch=password1.length>0&&password1==password2;displayResult(passwordsMatch,config.passwordMatch);}
MktAppJS.cadSubmitChangePasswordModal=function(mf){MktSession.ajaxRequest('/custAdmin/changePasswordSubmit',{serializeForm:'cadSubmitForm'});return false;}
MktAppJS.cadDriveEditBillingDetailsModal=function(animEl,context){var mp=new MktModalForm({staticForm:'p.cadBillingDetailsForm',title:context.isSignup?'Choose Subscription Plan':'Billing Details',okButtonTitle:'Save',width:710,height:context.isSignup?675:635});mp.on('load',function(){$('cadFirstName').value=context.firstName;$('cadLastName').value=context.lastName;$('cadAddress1').value=context.address1;$('cadAddress2').value=context.address2;$('cadCity').value=context.city;$('cadState').value=context.state;$('cadZip').value=context.zip;$('cadPhone').value=context.phone;$('cadEmail').value=context.email;if(context.isSignup){var ccDisabled='';}
else{var ccDisabled='disabled';}
var ccType=$('cadCCType');ccType.value=context.ccType;ccType.disabled=ccDisabled;var ccExpMonth=$('cadCCExpMonth');ccExpMonth.value=context.ccExpMonth;ccExpMonth.disabled=ccDisabled;var ccExpYear=$('cadCCExpYear');ccExpYear.value=context.ccExpYear;ccExpYear.disabled=ccDisabled;var ccNum=$('cadCCNum');ccNum.value=context.ccNum;ccNum.disabled=ccDisabled;var ccCode=$('cadCCCode');ccCode.disabled=ccDisabled;getEl('cadChangeCC').on('click',function(evt,el){var form=getEl('cadBillingDetailsForm');var checkBoxOn=el.dom.checked;if(checkBoxOn){ccType.disabled='';ccExpMonth.disabled='';ccExpYear.disabled='';ccNum.disabled='';ccCode.disabled='';}
else{ccType.disabled='disabled';ccExpMonth.disabled='disabled';ccExpYear.disabled='disabled';ccNum.disabled='disabled';ccCode.disabled='disabled';}
Ext.query('tr.ccFields',form.dom).forEach(function(el,ix,a){if(checkBoxOn){Ext.fly(el).removeClass('mktDisabled');Ext.fly(el).addClass('mktRequired');}
else{Ext.fly(el).removeClass('mktRequired');Ext.fly(el).addClass('mktDisabled');}});});},context,true);mp.show(animEl,MktAppJS.cadSubmitEditBillingDetailsModal);}
MktAppJS.cadSubmitEditBillingDetailsModal=function(mf){MktSession.ajaxRequest('/custAdmin/billingDetailsSubmit',{serializeForm:'cadSubmitForm',containerId:'casdPanelInner',onMySuccess:MktAppJS.cadEditBillingDetailsDone});MktCanvas.mask();return true;}
MktAppJS.cadEditBillingDetailsDone=function(){if(isDefined(MktPage.appVars.showUsersTab)){if(MktPage.appVars.showUsersTab==1){MktCanvasPanel.unhideTab('cadCanvasUsers');}else{MktCanvasPanel.hideTab('cadCanvasUsers');}
delete MktPage.appVars.showUsersTab;}
if(isDefined(MktPage.appVars.forceRestart)&&MktPage.appVars.forceRestart==1){MktAppJS.cadForceRestart();delete MktPage.appVars.forceRestart;}}
MktAppJS.cadDriveEndSubscriptionModal=function(animEl){var mp=new MktModalForm({staticForm:'p.cadEndSubForm',title:'End Subscription',okButtonTitle:'End Subscription',cancelButtonTitle:'Stay with Marketo',width:560,height:290});mp.show(animEl,MktAppJS.cadSubmitEndSubscriptionModal);}
MktAppJS.cadSubmitEndSubscriptionModal=function(mf){MktSession.ajaxRequest('/custAdmin/endSubscriptionSubmit',{serializeForm:'cadSubmitForm',containerId:'casdPanelInner'});return false;}
MktAppJS.cadDriveChangePlanModal=function(animEl){var mp=new MktModalForm({staticForm:'p.cadChangePlanForm',title:'Change Subscription Plans',okButtonTitle:'Change',width:670,height:370,requiredChecker:MktAppJS.cadVerifyChangePlanModal,extension:{ppcCode:MktPage.appVars.ppcCode,lpCode:MktPage.appVars.lpCode}});mp.show(animEl,MktAppJS.cadSubmitChangePlanModal);}
MktAppJS.cadVerifyChangePlanModal=function(){var fmEls=this.innerEl.getChildrenByTagName('form');if(fmEls.length==0)return true;this.validateErrors=0;var rfs=Ext.query('tr.mktRequired',fmEls[0].dom);var sels=Ext.query('select',rfs[0]);this.extension.sels=sels;if(sels[0].value==this.extension.ppcCode&&sels[1].value==this.extension.lpCode){this.validateErrors++;var valMessage='Please change your selected plan(s) or click Cancel to exit';}else if(sels[0].value=='none'&&sels[1].value=='lpnone'){this.validateErrors++;var valMessage='Please select one or more plans; use End Subscription if you wish to cancel all plans';}
if(this.validateErrors>0){Ext.fly(rfs[0]).addClass('mktFieldError');this.extension.sel0changeFn=Ext.EventManager.on(sels[0],'change',MktAppJS.cadVCPMChange,this,true);this.extension.sel1changeFn=Ext.EventManager.on(sels[1],'change',MktAppJS.cadVCPMChange,this,true);MktModalForm.clearMessage();MktModalForm.setMessageError(valMessage);return false;}else{return true;}}
MktAppJS.cadDriveChangeTimezoneModal=function(animEl){var mp=new MktModalForm({staticForm:'p.cadChangeLocationSubmitForm',title:'Change Location Settings',iconCls:'mkiEarthLocation',okButtonTitle:'Save',width:415,height:210});mp.on('load',function(){var el;if(MktPage.appVars.newTimezone){el=Ext.query("option[value='"+MktPage.appVars.newTimezone+"']",'timezone')[0];if(el){el.selected=true;}}
if(MktPage.appVars.newCurrency){el=Ext.query("option[value='"+MktPage.appVars.newCurrency+"']",'currency')[0];if(el){el.selected=true;}}
if(MktPage.appVars.currencyFormats){var formats=MktPage.appVars.currencyFormats;for(var format in formats){el=Ext.query("option[value='"+format+"']",'currencyFormat')[0];if(el){el.innerHTML=(formats[format]);}}}
if(MktPage.appVars.newCurrencyFormat){el=Ext.query("option[value='"+MktPage.appVars.newCurrencyFormat+"']",'currencyFormat')[0];if(el){el.selected=true;}}
var currencySymbols=MktPage.appVars.currencySymbols;var currencyFormats=MktPage.appVars.currencyFormatsRaw;var currencyFormatCombo=Ext.get('currencyFormat');var currencyCombo=Ext.get('currency');if(currencySymbols&&currencyFormats&&currencyFormatCombo&&currencyCombo){currencyCombo.addListener('change',function(event,combo){var selectedCurrencyKey=combo.value;var selectedSymbol=currencySymbols[selectedCurrencyKey];var currencyFormatOptions=currencyFormatCombo.dom.options;for(var i=0;i<currencyFormatOptions.length;i++){var option=currencyFormatOptions[i];var formatTemplate=currencyFormats[option.value];if(selectedSymbol&&formatTemplate){var newText=Mkt.util.locale.Format.formatCurrency(10000,formatTemplate,selectedSymbol);option.text=newText;}}});}});mp.show(animEl,MktAppJS.cadSubmitChangeTimezoneModal);}
MktAppJS.cadSubmitChangeTimezoneModal=function(mf){MktSession.ajaxRequest('/custAdmin/changeLocationSubmit',{serializeForm:'cadChangeLocationSubmitForm',onMySuccess:MktAppJS.cadSubmitChangeTimezoneDone});MktCanvas.mask();return true;}
MktAppJS.cadSubmitChangeTimezoneDone=function(){var cTzResult=MktPage.appVars.changeTimezoneResults;if(isDefined(cTzResult)){if(cTzResult=='success'){var el=Ext.getDom('timezoneText');var nTz=MktPage.appVars.newTimezoneDisplay;if(isDefined(el)){el.innerHTML=nTz;}
var el=Ext.getDom('currencyText');var nTz=MktPage.appVars.newCurrencyDisplay;if(isDefined(el)){el.innerHTML=nTz;}
var el=Ext.getDom('currencyFormatText');var nTz=MktPage.appVars.newCurrencyFormatDisplay;if(isDefined(el)){el.innerHTML=nTz;}}else{var errMsg=MktPage.appVars.changeTimezoneErrMsg;if(isDefined(errMsg)){Ext.MessageBox.alert('Marketo',errMsg);delete errorMsg;}}
delete cTzResult;}
MktCanvas.unmask();};MktAppJS.cadVCPMChange=function(e,a,b,c){var eTarget=e.getTarget();var eRow=e.findTarget('mktRequired','tr');Ext.fly(eRow).removeClass('mktFieldError');Ext.EventManager.removeListener(this.extension.sels[0],'change',this.extension.sel0changeFn);Ext.EventManager.removeListener(this.extension.sels[1],'change',this.extension.sel1changeFn);this.validateErrors--;if(this.validateErrors==0){MktModalForm.clearMessage();}}
MktAppJS.cadSubmitChangePlanModal=function(mf){MktSession.ajaxRequest('/custAdmin/changePlanSubmit',{serializeForm:'cadSubmitForm',containerId:'casdPanelInner',onMySuccess:MktAppJS.cadSubmitChangePlanDone});MktCanvas.mask();return true;}
MktAppJS.cadSubmitChangePlanDone=function(){if(isDefined(MktPage.appVars.showUsersTab)){if(MktPage.appVars.showUsersTab==1){MktCanvasPanel.unhideTab('cadCanvasUsers');}else{MktCanvasPanel.hideTab('cadCanvasUsers');}
delete MktPage.appVars.showUsersTab;}
if(isDefined(MktPage.appVars.forceRestart)&&MktPage.appVars.forceRestart==1){MktAppJS.cadForceRestart();delete MktPage.appVars.forceRestart;}}
MktAppJS.cadForceRestart=function(){Ext.MessageBox.show({title:'Subscription Plans Changed',msg:'We must restart your session for your plan changes to take effect',closable:false,buttons:{ok:'Restart Session'},fn:MktAppJS.cadForceRestartOK});}
MktAppJS.cadForceRestartOK=function(){MktPage.preventNavAway(false);window.location.replace(MktSession.getUrlPrefix());}
MktAppJS.expDriveCreateProtypeFormModal=function(animEl){var mp=new MktModalForm({url:'/explorer/createProtoFormRequest',title:'Prototype Modal Form',okButtonTitle:'Submit',width:655,height:350});mp.show(animEl,MktAppJS.expSubmitCreatePrototypeFormModal);}
MktAppJS.expSubmitCreatePrototypeFormModal=function(mf){alert("Submit success");return false;}
var mktAlertBridge={}
mktAlertBridge.loadVerifyAccount=function(){MktMainNav.loadHome({firstLoad:1});}
mktAlertBridge.loadAccountSettings=function(){MktMainNav.loadCustAdmin({setActivePanel:'cadCanvasMyAccount'});}
mktAlertBridge.loadSubscription=function(){MktMainNav.loadCustAdmin({setActivePanel:'cadCanvasSubscription'});}
mktAlertBridge.loadSfdcSettings=function(){MktMainNav.loadCustAdmin({setActivePanel:'cadCanvasIntegration'});}
mktAlertBridge.loadCampaignBudget=function(tid){MktPage.activatePanel('campaignCanvasDetailBudget');}
mktAlertBridge.loadCampaignSchedule=function(tid){MktPage.activatePanel('campaignCanvasDetailSchedule');}
mktAlertBridge.loadCampaignTargeting=function(tid){MktPage.activatePanel('campaignCanvasDetailTargets');}
mktAlertBridge.loadCampaignFlow=function(tid){MktPage.activatePanel('campaignCanvasDetailFlow');}
mktAlertBridge.loadCampaignSmartlist=function(tid){MktPage.activatePanel('campaignCanvasDetailSmartlist');}
mktAlertBridge.loadLandingPage=function(){MktMainNav.loadLanding({lpgType:'page'});}
mktAlertBridge.loadLpForm=function(){MktMainNav.loadLanding({lpgType:'form'});}
mktTurnOffGBO=function(pfx,callback){this.pfx=pfx;this.offGBOBtn=getEl(pfx+'OffGBO');if(this.offGBOBtn)
this.offGBOBtn.mon('click',this.onOffBtnClicked,this,true);this.afterGBOOffMsg=getEl(pfx+'AfterGBOOff');this.beforeGBOOffMsg=getEl(pfx+'BeforeGBOOff');if(this.afterGBOOffMsg)
this.afterGBOOffMsg.setVisibilityMode(Ext.Element.DISPLAY);if(this.beforeGBOOffMsg)
this.beforeGBOOffMsg.setVisibilityMode(Ext.Element.DISPLAY);this.useBoValue=false;if(isDefined(callback)&&callback!=null){this.switchedCallBack=callback;}};mktTurnOffGBO.prototype={onSwitchClickedCallback:function(){this.dialog.close();MktSession.clockCursor(false);if(MktPage.appVars.switched){this.beforeGBOOffMsg.hide();this.afterGBOOffMsg.show();}
if(typeof this.switchedCallBack=='function'){this.switchedCallBack(this);}},chooseUseBoValue:function(){this.useBoValue=true;},chooseUsePrevious:function(){this.useBoValue=false;},onSwitchClicked:function(){MktSession.clockCursor(true);MktSession.ajaxRequest('bidding/turnOffGBO',{serializeParms:{topicId:MktPage.appVars.topicId,useBoValue:this.useBoValue},containerId:'adGroupCanvasBids',onMySuccess:this.onSwitchClickedCallback.createDelegate(this)});},setupDialogListener:function(){getEl('cpbRdUseBOValue').mon('click',this.chooseUseBoValue,this,true);getEl('cpbRdUsePrevious').mon('click',this.chooseUsePrevious,this,true);},onOffBtnClicked:function(btn){this.dialog=new MktModalForm({staticForm:'p.cpbTurnOffGBOForm',title:'Switch to Maximum Cost Bidding',okButtonTitle:'Switch',width:450,height:250});this.dialog.on('okclick',this.onSwitchClicked,this,true);this.dialog.show(this.offGBOBtn.dom);this.dialog.on('load',this.setupDialogListener,this,true);}};mktAdScheduleGrid=function(){this.hourGrid=getEl('cdaHourGrid');this.hourGrid.mon('click',this.onBlockClicked,this,true);this.hourGrid.mon('mouseover',this.onBlockMouseOver,this,true);this.hourGrid.setVisibilityMode(Ext.Element.DISPLAY);this.minuteGrid=getEl('cdaMinuteGrid');this.minuteGrid.mon('click',this.onBlockClicked,this,true);this.minuteGrid.mon('mouseover',this.onBlockMouseOver,this,true);this.minuteGrid.setVisibilityMode(Ext.Element.DISPLAY);this.clockMode24=getEl('cdaClockMode24');getEl('cdaSwitchTo24').mon('click',this.switchTo24Hour,this,true);this.clockMode24.setVisibilityMode(Ext.Element.DISPLAY);this.clockMode12=getEl('cdaClockMode12');getEl('cdaSwitchTo12').mon('click',this.switchTo12Hour,this,true);this.clockMode12.setVisibilityMode(Ext.Element.DISPLAY);getEl('cdaSwitchTo1H').mon('click',this.switchTo1HourInterval,this,true);getEl('cdaSwitchTo15M').mon('click',this.switchTo15MInterval,this,true);this.intervalMode15M=getEl('cdaIntervalMode15M');this.intervalMode15M.setVisibilityMode(Ext.Element.DISPLAY);this.intervalMode1H=getEl('cdaIntervalMode1H');this.intervalMode1H.setVisibilityMode(Ext.Element.DISPLAY);getEl('cdaEditBtn').mon('click',this.onEditClicked,this,true);this.saveBtn=new mktButton('cdaSaveBtn',this.onSaveClicked,this);this.saveBtn.disabled(true);getEl('cdaCancelBtn').mon('click',this.onCancelClicked,this,true);this.viewBtns=getEl('cdaViewBtns');this.editBtns=getEl('cdaEditBtns');this.viewBtns.setVisibilityMode(Ext.Element.DISPLAY);this.editBtns.setVisibilityMode(Ext.Element.DISPLAY);for(var i=1;i<=7;++i){getEl('cdaPause'+i).mon('click',this.onPauseDayClicked,this,true);}
for(var i=1;i<=24;++i){getEl('cdaPH'+i).mon('click',this.onPauseHourClicked,this,true);}
for(var i=1;i<=6;++i){getEl('cdaP4H'+i).mon('click',this.onPauseHourClicked,this,true);}
this.hourBlocks=[];for(var i=1;i<=168;++i){this.hourBlocks[i]=getEl('cdaHB'+i);}
this.minBlocks=[];for(var i=1;i<=672;++i){this.minBlocks[i]=getEl('cdaMB'+i);}
this.dataModel=new Array(672);this.allDayStatus=new Array(7);this.allHourStatus=new Array(24);this.hourInterval=MktPage.appVars.show1HourIntervalPref;this.timeMode12Hour=MktPage.appVars.show12HourClockPref;this.adsToArray(MktPage.appVars.adScheduling,this.dataModel);this.init(this.dataModel);this.editMode=false;this.panelContent=getEl("cdaPanelContent");};mktAdScheduleGrid.prototype={WEEKDAYS:['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'],BLOCKSTATUS:['RUNNING','PAUSED','PARTIAL'],getDataIndexFromTime:function(day,hour,minute){var index=day*24*4;index+=hour*4;index+=Math.floor(minute/15);return index;},getTimeFromDataIndex:function(index){var day=Math.floor(index/96);var time=index%96;var hour=Math.floor(time/4);var minute=(time%4)*15;return{'day':day,'hour':hour,'minute':minute};},getDataIndexFromId:function(id){var re=null;if(this.hourInterval){re=/cdaHB(\d+)/;}else{re=/cdaMB(\d+)/;}
var idArray=id.match(re);var numberId=null;if(idArray!==null){numberId=parseInt(idArray[1]);}
if(numberId!=null){var dataIndex=numberId-1;if(this.hourInterval){return dataIndex*4;}else{return dataIndex;}}
return null;},getIdFromDataIndex:function(dataIndex){if(this.hourInterval){var id=Math.floor(i/4);return'cdaHB'+id;}else{return'cdaMB'+id;}},getTimeFromId:function(id){var dataIndex=this.getDataIndexFromId(id);if(dataIndex!==null){return this.getTimeFromDataIndex(dataIndex);}
return null;},getTimeStr:function(day,hour,minute){var dayStr=this.WEEKDAYS[day];var minStr;if(minute<10){minStr='0'+minute;}else{minStr=''+minute;}
if(this.timeMode12Hour){var hourStr;var amPm='';if(hour==0){hourStr='Midnight 0';amPm='am'}else if(hour==12){hourStr='Noon 12';amPm='pm'}else if(hour<12){hourStr=''+hour;amPm='am';}else{hourStr=""+hour-12;amPm='pm';}
return dayStr+" "+hourStr+':'+minStr+' '+amPm;}else{return dayStr+" "+hour+':'+minStr;}},adsToArray:function(ads,data){var i;var j;if(ads['status']=='Enabled'){for(i=0;i<672;++i){data[i]=false;}
var intervals=ads['intervals'];for(i=0;i<intervals.length;++i){var aInterval=intervals[i];var day=this.WEEKDAYS.indexOf(aInterval['day']);var startHour=parseInt(aInterval['startHour']);var startMin=parseInt(aInterval['startMinute']);var endHour=parseInt(aInterval['endHour']);if(endHour==0){endHour=24;}
var endMin=parseInt(aInterval['endMinute']);var startIndex=this.getDataIndexFromTime(day,startHour,startMin);var endIndex=this.getDataIndexFromTime(day,endHour,endMin);for(j=startIndex;j<endIndex;++j){data[j]=true;}}}else{for(i=0;i<672;++i){data[i]=true;}}},arrayToAds:function(data,ads){var intervals={};intervals['intervals']=[];var len=0;var aInterval={};var openInterval=false;var index=0;var enabled=false;for(var i=0;i<7;++i){for(var j=0;j<96;++j,++index){if(!data[index])
enabled=true;if(data[index]&&!openInterval){var time=this.getTimeFromDataIndex(index);aInterval={};aInterval['day']=this.WEEKDAYS[time['day']];aInterval['startHour']=''+time['hour'];aInterval['startMinute']=''+time['minute'];openInterval=true;}else if(!data[index]&&openInterval){var time=this.getTimeFromDataIndex(index);aInterval['endHour']=''+time['hour'];aInterval['endMinute']=''+time['minute'];openInterval=false;len=intervals['intervals'].length;intervals['intervals'][len]=aInterval;}}
if(openInterval){aInterval['endHour']=0;aInterval['endMinute']=0;openInterval=false;len=intervals['intervals'].length;intervals['intervals'][len]=aInterval;}}
if(enabled){ads['status']='Enabled';ads['intervals']=intervals['intervals'];}else{ads['status']='Disabled';}},init:function(data){for(i=0;i<7;++i){this.allDayStatus[i]=false;}
for(i=0;i<data.length;++i){if(data[i]){this.allDayStatus[Math.floor(i/96)]=true;}}
for(i=0;i<24;++i){this.allHourStatus[i]=false;}
for(i=0;i<data.length;++i){if(data[i]){this.allHourStatus[Math.floor((i%96)/4)]=true;}}},setHourBlockClass:function(elmt,blockstatus){var index=this.BLOCKSTATUS.indexOf(blockstatus);if(index==0){elmt.removeClass(['mktDisabledHourBlock','mktPartialHourBlock']);elmt.addClass('mktHourBlock');}else if(index==1){elmt.removeClass(['mktHourBlock','mktPartialHourBlock']);elmt.addClass('mktDisabledHourBlock');}else if(index==2){elmt.removeClass(['mktHourBlock','mktDisabledHourBlock']);elmt.addClass('mktPartialHourBlock');}},load:function(data){var i;if(data==null)data=this.dataModel;if(this.hourInterval){for(i=0;i<data.length;i+=4){var index=Math.floor(i/4)+1;if(data[i]&&data[i+1]&&data[i+2]&&data[i+3]){this.setHourBlockClass(this.hourBlocks[index],'RUNNING');}else if(data[i]||data[i+1]||data[i+2]||data[i+3]){this.setHourBlockClass(this.hourBlocks[index],'PARTIAL');}else{this.setHourBlockClass(this.hourBlocks[index],'PAUSED');}}}else{for(i=0;i<data.length;++i){if(data[i]){this.minBlocks[i+1].replaceClass('mktDisabledMinuteBlock','mktMinuteBlock');}else{this.minBlocks[i+1].replaceClass('mktMinuteBlock','mktDisabledMinuteBlock');;}}}
this.init(data);},getDataToSave:function(){var ads={};this.arrayToAds(this.dataModel,ads);return ads;},onPauseHourClicked:function(e){if(!this.editMode)return;var target=e.getTarget();var pauseElmt=getEl(target);var indexArray=null;var hour=null;var i;if(this.hourInterval){indexArray=pauseElmt.dom.id.match(/cdaP4H(\d+)/);if(indexArray==null){e.stopEvent();return;}
hour=(parseInt(indexArray[1])-1)*4;var hourStatus=false;for(i=0;i<4;++i){if(this.allHourStatus[hour+i]){hourStatus=true;break;}}
hourStatus=!hourStatus;for(i=0;i<4;++i){this.allHourStatus[hour+i]=hourStatus;}}else{indexArray=pauseElmt.dom.id.match(/cdaPH(\d+)/);hour=parseInt(indexArray[1])-1;this.allHourStatus[hour]=!this.allHourStatus[hour];hourStatus=this.allHourStatus[hour];}
if(this.hourInterval){for(k=0;k<4;++k){var index=(hour+k)*4;for(i=0;i<7;++i,index+=96){for(j=0;j<4;++j){this.dataModel[index+j]=hourStatus;}}}}else{var index=hour*4;for(i=0;i<7;++i,index+=96){for(j=0;j<4;++j){this.dataModel[index+j]=hourStatus;}}}
var numBlock=0;if(this.hourInterval){numBlock=24;}else{numBlock=96;}
var j;var startIndex;if(this.hourInterval){startIndex=hour;}else{startIndex=4*hour;}
for(j=0;j<4;++j,++startIndex){var step=0;for(i=0;i<7;++i,step+=numBlock){var newIndex=startIndex+step+1;var elmt;if(this.hourInterval){elmt=this.hourBlocks[newIndex];if(hourStatus){this.setHourBlockClass(elmt,'RUNNING');}else{this.setHourBlockClass(elmt,'PAUSED');}}else{elmt=this.minBlocks[newIndex];if(hourStatus){elmt.replaceClass('mktDisabledMinuteBlock','mktMinuteBlock');}else{elmt.replaceClass('mktMinuteBlock','mktDisabledMinuteBlock');;}}}}
this.saveBtn.disabled(false);e.stopEvent();},onPauseDayClicked:function(e){if(!this.editMode)return;var target=e.getTarget();var pauseElmt=getEl(target);var indexArray=pauseElmt.dom.id.match(/cdaPause(\d+)/);var day=parseInt(indexArray[1])-1;this.allDayStatus[day]=!this.allDayStatus[day];var dataIndex=this.getDataIndexFromTime(day,0,0);var i;var dayStatus=this.allDayStatus[day];for(i=0;i<96;++i){this.dataModel[dataIndex+i]=dayStatus;}
var numBlock=0;if(this.hourInterval){numBlock=24;}else{numBlock=96;}
var startIndex=day*numBlock;for(var i=1;i<=numBlock;++i){var newIndex=startIndex+i;var elmt;if(this.hourInterval){elmt=this.hourBlocks[newIndex];if(dayStatus){this.setHourBlockClass(elmt,'RUNNING');}else{this.setHourBlockClass(elmt,'PAUSED');}}else{elmt=this.minBlocks[newIndex];if(dayStatus){elmt.replaceClass('mktDisabledMinuteBlock','mktMinuteBlock');}else{elmt.replaceClass('mktMinuteBlock','mktDisabledMinuteBlock');}}}
this.saveBtn.disabled(false);e.stopEvent();},switchTo1HourInterval:function(){this.hourInterval=true;this.load();this.refreshHeader();this.minuteGrid.hide();this.hourGrid.show();this.intervalMode15M.hide();this.intervalMode1H.show();MktSession.ajaxRequest('progSearch/saveSchedulePref',{serializeParms:{show1HourIntervalPref:true}});},switchTo15MInterval:function(){this.hourInterval=false;this.load();this.refreshHeader();this.hourGrid.hide();this.minuteGrid.show();this.intervalMode15M.show();this.intervalMode1H.hide();MktSession.ajaxRequest('progSearch/saveSchedulePref',{serializeParms:{show1HourIntervalPref:false}});},refreshHeader:function(){if(this.timeMode12Hour){this.switchTo12Hour();}else{this.switchTo24Hour();}},switchTo12Hour:function(){this.timeMode12Hour=true;if(this.hourInterval){getEl('cdaP4H1').update('Midnight');getEl('cdaP4H2').update('4:00am');getEl('cdaP4H3').update('8:00am');getEl('cdaP4H4').update('Noon');getEl('cdaP4H5').update('4:00pm');getEl('cdaP4H6').update('8:00pm');}else{getEl('cdaPH1').update('Midnight');getEl('cdaPH2').update('1:00am');getEl('cdaPH3').update('2:00am');getEl('cdaPH4').update('3:00am');getEl('cdaPH5').update('4:00am');getEl('cdaPH6').update('5:00am');getEl('cdaPH7').update('6:00am');getEl('cdaPH8').update('7:00am');getEl('cdaPH9').update('8:00am');getEl('cdaPH10').update('9:00am');getEl('cdaPH11').update('10:00am');getEl('cdaPH12').update('11:00am');getEl('cdaPH13').update('Noon');getEl('cdaPH14').update('1:00pm');getEl('cdaPH15').update('2:00pm');getEl('cdaPH16').update('3:00pm');getEl('cdaPH17').update('4:00pm');getEl('cdaPH18').update('5:00pm');getEl('cdaPH19').update('6:00pm');getEl('cdaPH20').update('7:00pm');getEl('cdaPH21').update('8:00pm');getEl('cdaPH22').update('9:00pm');getEl('cdaPH23').update('10:00pm');getEl('cdaPH24').update('11:00pm');}
this.clockMode24.hide();this.clockMode12.show();MktSession.ajaxRequest('progSearch/saveSchedulePref',{serializeParms:{show12HourClockPref:true}});},switchTo24Hour:function(){this.timeMode12Hour=false;if(this.hourInterval){getEl('cdaP4H1').update('0:00');getEl('cdaP4H2').update('4:00');getEl('cdaP4H3').update('8:00');getEl('cdaP4H4').update('12:00');getEl('cdaP4H5').update('16:00');getEl('cdaP4H6').update('20:00');}else{getEl('cdaPH1').update('0:00');getEl('cdaPH2').update('1:00');getEl('cdaPH3').update('2:00');getEl('cdaPH4').update('3:00');getEl('cdaPH5').update('4:00');getEl('cdaPH6').update('5:00');getEl('cdaPH7').update('6:00');getEl('cdaPH8').update('7:00');getEl('cdaPH9').update('8:00');getEl('cdaPH10').update('9:00');getEl('cdaPH11').update('10:00');getEl('cdaPH12').update('11:00');getEl('cdaPH13').update('12:00');getEl('cdaPH14').update('13:00');getEl('cdaPH15').update('14:00');getEl('cdaPH16').update('15:00');getEl('cdaPH17').update('16:00');getEl('cdaPH18').update('17:00');getEl('cdaPH19').update('18:00');getEl('cdaPH20').update('19:00');getEl('cdaPH21').update('20:00');getEl('cdaPH22').update('21:00');getEl('cdaPH23').update('22:00');getEl('cdaPH24').update('23:00');}
this.clockMode12.hide();this.clockMode24.show();MktSession.ajaxRequest('progSearch/saveSchedulePref',{serializeParms:{show12HourClockPref:false}});},onEditClicked:function(){this.viewBtns.hide();this.editBtns.show();this.editMode=true;this.panelContent.replaceClass("mktPanelShowing","mktPanelEditing");},onCancelClicked:function(){MktSession.clockCursor(true);this.adsToArray(MktPage.appVars.adScheduling,this.dataModel);this.load();this.saveBtn.disabled(true);this.viewBtns.show();this.editBtns.hide();this.editMode=false;this.panelContent.replaceClass("mktPanelEditing","mktPanelShowing");MktSession.clockCursor(false);},onSaveClicked:function(){var ads=this.getDataToSave();MktSession.clockCursor(true);MktSession.ajaxRequest('progSearch/saveAdScheduling',{serializeParms:{topicId:MktPage.appVars.topicId,adScheduling:Ext.encode(ads)},onMySuccess:this.onSaveDone.createDelegate(this,[ads])});MktCanvas.mask();return true;},onSaveDone:function(ads){this.saveBtn.disabled(true);MktPage.appVars.adScheduling=ads;MktSession.clockCursor(false);this.viewBtns.show();this.editBtns.hide();this.editMode=false;this.panelContent.replaceClass("mktPanelEditing","mktPanelShowing");},getBlockFromTarget:function(target){var block=null;var className='mktHourBlock';var disabledClassName='mktDisabledHourBlock';var partialClassName='mktPartialHourBlock';if(!this.hourInterval){className='mktMinuteBlock';disabledClassName='mktDisabledMinuteBlock';}
if(target&&(Ext.fly(target).hasClass(className)||Ext.fly(target).hasClass(disabledClassName)||Ext.fly(target).hasClass(partialClassName))){block=getEl(target);}
return block;},onBlockClicked:function(e){if(!this.editMode)return false;blockClicked=this.getBlockFromTarget(e.getTarget());if(blockClicked){var dataIndex=this.getDataIndexFromId(blockClicked.dom.id);if(dataIndex!=null){if(this.dataModel[dataIndex]){if(this.hourInterval){this.setHourBlockClass(blockClicked,'PAUSED');}else{blockClicked.replaceClass("mktMinuteBlock","mktDisabledMinuteBlock");}}else{if(this.hourInterval){this.setHourBlockClass(blockClicked,'RUNNING');}else{blockClicked.replaceClass("mktDisabledMinuteBlock","mktMinuteBlock");}}
if(this.hourInterval){for(var i=0;i<4;++i){this.dataModel[dataIndex+i]=!this.dataModel[dataIndex+i];}}else{this.dataModel[dataIndex]=!this.dataModel[dataIndex];}}
this.saveBtn.disabled(false);}
return false;},onBlockMouseOver:function(e){var block=this.getBlockFromTarget(e.getTarget());if(block){var time=this.getTimeFromId(block.dom.id);block.dom.title=this.getTimeStr(time['day'],time['hour'],time['minute']);}
return false;}};mktTurnOffAdsMultiplier=function(pfx){this.pfx=pfx;this.offMultiplierBtn=getEl(pfx+'OffMultiplier');if(this.offMultiplierBtn)
this.offMultiplierBtn.mon('click',this.onOffBtnClicked,this,true);this.afterMultiplierOffMsg=getEl(pfx+'AfterMultiplierOff');this.beforeMultiplierOffMsg=getEl(pfx+'BeforeMultiplierOff');if(this.afterMultiplierOffMsg)
this.afterMultiplierOffMsg.setVisibilityMode(Ext.Element.DISPLAY);if(this.beforeMultiplierOffMsg)
this.beforeMultiplierOffMsg.setVisibilityMode(Ext.Element.DISPLAY);};mktTurnOffAdsMultiplier.prototype={onSwitchClickedCallback:function(){MktSession.clockCursor(false);if(MktPage.appVars.multiplierOff){this.beforeMultiplierOffMsg.hide();this.afterMultiplierOffMsg.show();}},onOffBtnClicked:function(btn){MktSession.clockCursor(true);MktSession.ajaxRequest('bidding/turnOffMultiplier',{serializeParms:{topicId:MktPage.appVars.topicId},onMySuccess:this.onSwitchClickedCallback.createDelegate(this)});}};
/* ========== mktGuide.js ============ */

function mktGuideManager(config){this.config={};Ext.apply(this.config,config||{});this.cacheIds=[];this.cacheTexts=[];this.cacheSize=4;this.curPanel=null;var rthtml='<div id="" class="gimLink"><a href="{2}" class="{1}" {3}>{0}</a></div>';var rttmpl=new Ext.Template(rthtml);rttmpl.compile();this.rttmpl=rttmpl;getEl('gidHome').on('click',this.showBase,this,true);return this;}
mktGuideManager.prototype.loadNewPanel=function(panelId){var cText=this.checkCache(panelId);if(cText){this.updateGuide(cText);}else{MktSession.ajaxRequest('guide/getPanel',{serializeParms:{panelId:panelId},onMySuccess:this.newPanelLoaded.createDelegate(this)});}
this.curPanel=panelId;}
mktGuideManager.prototype.newPanelLoaded=function(){var text=MktPage.appVars.panelText;if(MktPage.sfEnvironment=='dev'&&!MktPage.appVars.panelTextExists){text+=": "+this.curPanel;}
this.updateGuide(text);this.updateCache(MktPage.appVars.panelText);}
mktGuideManager.prototype.checkCache=function(panelId){if(MktPage.sfEnvironment=='dev')return null;var cix=this.cacheIds.indexOf(panelId);if(cix<0)return null;return this.cacheTexts[cix];}
mktGuideManager.prototype.updateCache=function(text){if(MktPage.sfEnvironment=='dev')return null;if(this.cacheIds.length==this.cacheSize){this.cacheTexts.shift();this.cacheIds.shift();}
this.cacheTexts.push(text);this.cacheIds.push(this.curPanel);}
mktGuideManager.prototype.updateGuide=function(text){this.linkCount=0;this.links=[];var re=/<a (.*?)>(.*?)<\/a>/g;var ttext=text.replace(re,this.decodeLinks.createDelegate(this))
this.baseText=ttext;this.showBase();this.renderRelated();}
mktGuideManager.prototype.decodeLinks=function(str,m1,m2){var re=/(.*?)="(.*?)"/g;re.lastIndex=0;var mr;var name=null;var label=null;var link=null;while((mr=re.exec(m1))!=null){var attrib=MktUtil.trim(mr[1]);if(attrib=='href'){link=this.formatLink(mr[2],m2);var page=mr[2];}else if(attrib=='name'){name=mr[2];}else if(attrib=='label'){label=mr[2];}else{throw"Unknown attribute "+mr[1]+" in panelhelp text link";}}
if(link!=null){if(label!=null){this.links.push({name:'external',label:label,page:page});}
return link;}else{if(name!=null){var found=false;for(var ix=0;ix<this.links.length;ix++){if(this.links[ix].name==name){this.links[ix].label=label;this.links[ix].text=m2;found=true;break;}}
if(!found){this.links.push({name:name,label:label,text:m2});}}else if(label!=null){this.links.push({name:'anonymous',label:label,text:m2});}
return'';}}
mktGuideManager.prototype.formatLink=function(linker,linkText){if(linker.charAt(0)=="#"){var rv='<a href="#" onclick="MktPage.guideManager.showLink('+this.linkCount+');return false;">'+linkText+'</a>';this.links.push({name:linker.slice(1)});this.linkCount++;}else{if(linkText.length>0){var urlPrefix=MktSession.getUrlPrefix();var rv='<a class="gimExternalLink" href="'+urlPrefix+'/wiki/'+linker+'" target="MarketoWiki">'+linkText+'</a>';}else{var rv='';}}
return rv;}
mktGuideManager.prototype.showLink=function(idx){$('gidMainText').innerHTML=this.links[idx].text;}
mktGuideManager.prototype.renderRelated=function(){var rtEl=getEl('gidRelatedLinks');rtEl.dom.innerHTML='';for(var ix=0;ix<this.links.length;ix++){if(this.links[ix].name=='external'){var classVal='gimExternalLink';var urlPrefix=MktSession.getUrlPrefix();var href=urlPrefix+'/wiki/'+this.links[ix].page;var xtra='target="MarketoWiki"';}else{var classVal='gimInternalLink';var href='#';var xtra=' onclick="MktPage.guideManager.showLink('+ix+');return false;"';}
this.rttmpl.append(rtEl.dom,[this.links[ix].label,classVal,href,xtra]);}}
mktGuideManager.prototype.showBase=function(){$('gidMainText').innerHTML=this.baseText;}
mktGuideManager.editPageSubmit=function(){MktSession.ajaxRequest('guide/editPageSubmit',{serializeForm:'gidPickEntryForm',targetActivePanel:true,onMySuccess:mktGuideManager.showForEdit});}
mktGuideManager.showForEdit=function(){var showText=MktPage.appVars.pageText;$('gidHelpText').value=showText;}
mktGuideManager.savePage=function(){var pText=$('gidHelpText').value;var pTextEnc=encodeURIComponent(pText);var pId=$('gidEditingId').value;MktSession.ajaxRequest('guide/savePageSubmit',{serializeParms:{gidEditingId:pId,gidHelpText:pTextEnc},targetActivePanel:true});}
/* ========== ../ext-3.2.1/adapter/ext/ext-base-debug.js ============ */

window.undefined=window.undefined;Ext={version:'3.2.1',versionDetail:{major:3,minor:2,patch:1}};Ext.apply=function(o,c,defaults){if(defaults){Ext.apply(o,defaults);}
if(o&&c&&typeof c=='object'){for(var p in c){o[p]=c[p];}}
return o;};(function(){var idSeed=0,toString=Object.prototype.toString,ua=navigator.userAgent.toLowerCase(),check=function(r){return r.test(ua);},DOC=document,isStrict=DOC.compatMode=="CSS1Compat",isOpera=check(/opera/),isChrome=check(/\bchrome\b/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&check(/msie 7/),isIE8=isIE&&check(/msie 8/),isIE6=isIE&&!isIE7&&!isIE8,isGecko=!isWebKit&&check(/gecko/),isGecko2=isGecko&&check(/rv:1\.8/),isGecko3=isGecko&&check(/rv:1\.9/),isBorderBox=isIE&&!isStrict,isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),isSecure=/^https/i.test(window.location.protocol);if(isIE6){try{DOC.execCommand("BackgroundImageCache",false,true);}catch(e){}}
Ext.apply(Ext,{SSL_SECURE_URL:isSecure&&isIE?'javascript:""':'about:blank',isStrict:isStrict,isSecure:isSecure,isReady:false,enableGarbageCollector:true,enableListenerCollection:false,enableNestedListenerRemoval:false,USE_NATIVE_JSON:false,applyIf:function(o,c){if(o){for(var p in c){if(!Ext.isDefined(o[p])){o[p]=c[p];}}}
return o;},id:function(el,prefix){el=Ext.getDom(el,true)||{};if(!el.id){el.id=(prefix||"ext-gen")+(++idSeed);}
return el.id;},extend:function(){var io=function(o){for(var m in o){this[m]=o[m];}};var oc=Object.prototype.constructor;return function(sb,sp,overrides){if(typeof sp=='object'){overrides=sp;sp=sb;sb=overrides.constructor!=oc?overrides.constructor:function(){sp.apply(this,arguments);};}
var F=function(){},sbp,spp=sp.prototype;F.prototype=spp;sbp=sb.prototype=new F();sbp.constructor=sb;sb.superclass=spp;if(spp.constructor==oc){spp.constructor=sp;}
sb.override=function(o){Ext.override(sb,o);};sbp.superclass=sbp.supr=(function(){return spp;});sbp.override=io;Ext.override(sb,overrides);sb.extend=function(o){return Ext.extend(sb,o);};return sb;};}(),override:function(origclass,overrides){if(overrides){var p=origclass.prototype;Ext.apply(p,overrides);if(Ext.isIE&&overrides.hasOwnProperty('toString')){p.toString=overrides.toString;}}},namespace:function(){var o,d;Ext.each(arguments,function(v){d=v.split(".");o=window[d[0]]=window[d[0]]||{};Ext.each(d.slice(1),function(v2){o=o[v2]=o[v2]||{};});});return o;},urlEncode:function(o,pre){var empty,buf=[],e=encodeURIComponent;Ext.iterate(o,function(key,item){empty=Ext.isEmpty(item);Ext.each(empty?key:item,function(val){buf.push('&',e(key),'=',(!Ext.isEmpty(val)&&(val!=key||!empty))?(Ext.isDate(val)?Ext.encode(val).replace(/"/g,''):e(val)):'');});});if(!pre){buf.shift();pre='';}
return pre+buf.join('');},urlDecode:function(string,overwrite){if(Ext.isEmpty(string)){return{};}
var obj={},pairs=string.split('&'),d=decodeURIComponent,name,value;Ext.each(pairs,function(pair){pair=pair.split('=');name=d(pair[0]);value=d(pair[1]);obj[name]=overwrite||!obj[name]?value:[].concat(obj[name]).concat(value);});return obj;},urlAppend:function(url,s){if(!Ext.isEmpty(s)){return url+(url.indexOf('?')===-1?'?':'&')+s;}
return url;},toArray:function(){return isIE?function(a,i,j,res){res=[];for(var x=0,len=a.length;x<len;x++){res.push(a[x]);}
return res.slice(i||0,j||res.length);}:function(a,i,j){return Array.prototype.slice.call(a,i||0,j||a.length);}}(),isIterable:function(v){if(Ext.isArray(v)||v.callee){return true;}
if(/NodeList|HTMLCollection/.test(toString.call(v))){return true;}
return((typeof v.nextNode!='undefined'||v.item)&&Ext.isNumber(v.length));},each:function(array,fn,scope){if(Ext.isEmpty(array,true)){return;}
if(!Ext.isIterable(array)||Ext.isPrimitive(array)){array=[array];}
for(var i=0,len=array.length;i<len;i++){if(fn.call(scope||array[i],array[i],i,array)===false){return i;};}},iterate:function(obj,fn,scope){if(Ext.isEmpty(obj)){return;}
if(Ext.isIterable(obj)){Ext.each(obj,fn,scope);return;}else if(typeof obj=='object'){for(var prop in obj){if(obj.hasOwnProperty(prop)){if(fn.call(scope||obj,prop,obj[prop],obj)===false){return;};}}}},getDom:function(el,strict){if(!el||!DOC){return null;}
if(el.dom){return el.dom;}else{if(typeof el=='string'){var e=DOC.getElementById(el);if(e&&isIE&&strict){if(el==e.getAttribute('id')){return e;}else{return null;}}
return e;}else{return el;}}},getBody:function(){return Ext.get(DOC.body||DOC.documentElement);},removeNode:isIE&&!isIE8?function(){var d;return function(n){if(n&&n.tagName!='BODY'){(Ext.enableNestedListenerRemoval)?Ext.EventManager.purgeElement(n,true):Ext.EventManager.removeAll(n);d=d||DOC.createElement('div');d.appendChild(n);d.innerHTML='';delete Ext.elCache[n.id];}}}():function(n){if(n&&n.parentNode&&n.tagName!='BODY'){(Ext.enableNestedListenerRemoval)?Ext.EventManager.purgeElement(n,true):Ext.EventManager.removeAll(n);n.parentNode.removeChild(n);delete Ext.elCache[n.id];}},isEmpty:function(v,allowBlank){return v===null||v===undefined||((Ext.isArray(v)&&!v.length))||(!allowBlank?v==='':false);},isArray:function(v){return toString.apply(v)==='[object Array]';},isDate:function(v){return toString.apply(v)==='[object Date]';},isObject:function(v){return!!v&&Object.prototype.toString.call(v)==='[object Object]';},isPrimitive:function(v){return Ext.isString(v)||Ext.isNumber(v)||Ext.isBoolean(v);},isFunction:function(v){return toString.apply(v)==='[object Function]';},isNumber:function(v){return typeof v==='number'&&isFinite(v);},isString:function(v){return typeof v==='string';},isBoolean:function(v){return typeof v==='boolean';},isElement:function(v){return v?!!v.tagName:false;},isDefined:function(v){return typeof v!=='undefined';},isOpera:isOpera,isWebKit:isWebKit,isChrome:isChrome,isSafari:isSafari,isSafari3:isSafari3,isSafari4:isSafari4,isSafari2:isSafari2,isIE:isIE,isIE6:isIE6,isIE7:isIE7,isIE8:isIE8,isGecko:isGecko,isGecko2:isGecko2,isGecko3:isGecko3,isBorderBox:isBorderBox,isLinux:isLinux,isWindows:isWindows,isMac:isMac,isAir:isAir});Ext.ns=Ext.namespace;})();Ext.ns("Ext.util","Ext.lib","Ext.data");Ext.elCache={};Ext.apply(Function.prototype,{createInterceptor:function(fcn,scope){var method=this;return!Ext.isFunction(fcn)?this:function(){var me=this,args=arguments;fcn.target=me;fcn.method=method;return(fcn.apply(scope||me||window,args)!==false)?method.apply(me||window,args):null;};},createCallback:function(){var args=arguments,method=this;return function(){return method.apply(window,args);};},createDelegate:function(obj,args,appendArgs){var method=this;return function(){var callArgs=args||arguments;if(appendArgs===true){callArgs=Array.prototype.slice.call(arguments,0);callArgs=callArgs.concat(args);}else if(Ext.isNumber(appendArgs)){callArgs=Array.prototype.slice.call(arguments,0);var applyArgs=[appendArgs,0].concat(args);Array.prototype.splice.apply(callArgs,applyArgs);}
return method.apply(obj||window,callArgs);};},defer:function(millis,obj,args,appendArgs){var fn=this.createDelegate(obj,args,appendArgs);if(millis>0){return setTimeout(fn,millis);}
fn();return 0;}});Ext.applyIf(String,{format:function(format){var args=Ext.toArray(arguments,1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i];});}});Ext.applyIf(Array.prototype,{indexOf:function(o,from){var len=this.length;from=from||0;from+=(from<0)?len:0;for(;from<len;++from){if(this[from]===o){return from;}}
return-1;},remove:function(o){var index=this.indexOf(o);if(index!=-1){this.splice(index,1);}
return this;}});Ext.ns("Ext.grid","Ext.list","Ext.dd","Ext.tree","Ext.form","Ext.menu","Ext.state","Ext.layout","Ext.app","Ext.ux","Ext.chart","Ext.direct");Ext.apply(Ext,function(){var E=Ext,idSeed=0,scrollWidth=null;return{emptyFn:function(){},BLANK_IMAGE_URL:Ext.isIE6||Ext.isIE7||Ext.isAir?'http:/'+'/www.extjs.com/s.gif':'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',extendX:function(supr,fn){return Ext.extend(supr,fn(supr.prototype));},getDoc:function(){return Ext.get(document);},num:function(v,defaultValue){v=Number(Ext.isEmpty(v)||Ext.isArray(v)||typeof v=='boolean'||(typeof v=='string'&&v.trim().length==0)?NaN:v);return isNaN(v)?defaultValue:v;},value:function(v,defaultValue,allowBlank){return Ext.isEmpty(v,allowBlank)?defaultValue:v;},escapeRe:function(s){return s.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1");},sequence:function(o,name,fn,scope){o[name]=o[name].createSequence(fn,scope);},addBehaviors:function(o){if(!Ext.isReady){Ext.onReady(function(){Ext.addBehaviors(o);});}else{var cache={},parts,b,s;for(b in o){if((parts=b.split('@'))[1]){s=parts[0];if(!cache[s]){cache[s]=Ext.select(s);}
cache[s].on(parts[1],o[b]);}}
cache=null;}},getScrollBarWidth:function(force){if(!Ext.isReady){return 0;}
if(force===true||scrollWidth===null){var div=Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),child=div.child('div',true);var w1=child.offsetWidth;div.setStyle('overflow',(Ext.isWebKit||Ext.isGecko)?'auto':'scroll');var w2=child.offsetWidth;div.remove();scrollWidth=w1-w2+2;}
return scrollWidth;},combine:function(){var as=arguments,l=as.length,r=[];for(var i=0;i<l;i++){var a=as[i];if(Ext.isArray(a)){r=r.concat(a);}else if(a.length!==undefined&&!a.substr){r=r.concat(Array.prototype.slice.call(a,0));}else{r.push(a);}}
return r;},copyTo:function(dest,source,names){if(typeof names=='string'){names=names.split(/[,;\s]/);}
Ext.each(names,function(name){if(source.hasOwnProperty(name)){dest[name]=source[name];}},this);return dest;},destroy:function(){Ext.each(arguments,function(arg){if(arg){if(Ext.isArray(arg)){this.destroy.apply(this,arg);}else if(typeof arg.destroy=='function'){arg.destroy();}else if(arg.dom){arg.remove();}}},this);},destroyMembers:function(o,arg1,arg2,etc){for(var i=1,a=arguments,len=a.length;i<len;i++){Ext.destroy(o[a[i]]);delete o[a[i]];}},clean:function(arr){var ret=[];Ext.each(arr,function(v){if(!!v){ret.push(v);}});return ret;},unique:function(arr){var ret=[],collect={};Ext.each(arr,function(v){if(!collect[v]){ret.push(v);}
collect[v]=true;});return ret;},flatten:function(arr){var worker=[];function rFlatten(a){Ext.each(a,function(v){if(Ext.isArray(v)){rFlatten(v);}else{worker.push(v);}});return worker;}
return rFlatten(arr);},min:function(arr,comp){var ret=arr[0];comp=comp||function(a,b){return a<b?-1:1;};Ext.each(arr,function(v){ret=comp(ret,v)==-1?ret:v;});return ret;},max:function(arr,comp){var ret=arr[0];comp=comp||function(a,b){return a>b?1:-1;};Ext.each(arr,function(v){ret=comp(ret,v)==1?ret:v;});return ret;},mean:function(arr){return arr.length>0?Ext.sum(arr)/arr.length:undefined;},sum:function(arr){var ret=0;Ext.each(arr,function(v){ret+=v;});return ret;},partition:function(arr,truth){var ret=[[],[]];Ext.each(arr,function(v,i,a){ret[(truth&&truth(v,i,a))||(!truth&&v)?0:1].push(v);});return ret;},invoke:function(arr,methodName){var ret=[],args=Array.prototype.slice.call(arguments,2);Ext.each(arr,function(v,i){if(v&&typeof v[methodName]=='function'){ret.push(v[methodName].apply(v,args));}else{ret.push(undefined);}});return ret;},pluck:function(arr,prop){var ret=[];Ext.each(arr,function(v){ret.push(v[prop]);});return ret;},zip:function(){var parts=Ext.partition(arguments,function(val){return typeof val!='function';}),arrs=parts[0],fn=parts[1][0],len=Ext.max(Ext.pluck(arrs,"length")),ret=[];for(var i=0;i<len;i++){ret[i]=[];if(fn){ret[i]=fn.apply(fn,Ext.pluck(arrs,i));}else{for(var j=0,aLen=arrs.length;j<aLen;j++){ret[i].push(arrs[j][i]);}}}
return ret;},getCmp:function(id){return Ext.ComponentMgr.get(id);},useShims:E.isIE6||(E.isMac&&E.isGecko2),type:function(o){if(o===undefined||o===null){return false;}
if(o.htmlElement){return'element';}
var t=typeof o;if(t=='object'&&o.nodeName){switch(o.nodeType){case 1:return'element';case 3:return(/\S/).test(o.nodeValue)?'textnode':'whitespace';}}
if(t=='object'||t=='function'){switch(o.constructor){case Array:return'array';case RegExp:return'regexp';case Date:return'date';}
if(typeof o.length=='number'&&typeof o.item=='function'){return'nodelist';}}
return t;},intercept:function(o,name,fn,scope){o[name]=o[name].createInterceptor(fn,scope);},callback:function(cb,scope,args,delay){if(typeof cb=='function'){if(delay){cb.defer(delay,scope,args||[]);}else{cb.apply(scope,args||[]);}}}};}());Ext.apply(Function.prototype,{createSequence:function(fcn,scope){var method=this;return(typeof fcn!='function')?this:function(){var retval=method.apply(this||window,arguments);fcn.apply(scope||this||window,arguments);return retval;};}});Ext.applyIf(String,{escape:function(string){return string.replace(/('|\\)/g,"\\$1");},leftPad:function(val,size,ch){var result=String(val);if(!ch){ch=" ";}
while(result.length<size){result=ch+result;}
return result;}});String.prototype.toggle=function(value,other){return this==value?other:value;};String.prototype.trim=function(){var re=/^\s+|\s+$/g;return function(){return this.replace(re,"");};}();Date.prototype.getElapsed=function(date){return Math.abs((date||new Date()).getTime()-this.getTime());};Ext.applyIf(Number.prototype,{constrain:function(min,max){return Math.min(Math.max(this,min),max);}});Ext.util.TaskRunner=function(interval){interval=interval||10;var tasks=[],removeQueue=[],id=0,running=false,stopThread=function(){running=false;clearInterval(id);id=0;},startThread=function(){if(!running){running=true;id=setInterval(runTasks,interval);}},removeTask=function(t){removeQueue.push(t);if(t.onStop){t.onStop.apply(t.scope||t);}},runTasks=function(){var rqLen=removeQueue.length,now=new Date().getTime();if(rqLen>0){for(var i=0;i<rqLen;i++){tasks.remove(removeQueue[i]);}
removeQueue=[];if(tasks.length<1){stopThread();return;}}
for(var i=0,t,itime,rt,len=tasks.length;i<len;++i){t=tasks[i];itime=now-t.taskRunTime;if(t.interval<=itime){rt=t.run.apply(t.scope||t,t.args||[++t.taskRunCount]);t.taskRunTime=now;if(rt===false||t.taskRunCount===t.repeat){removeTask(t);return;}}
if(t.duration&&t.duration<=(now-t.taskStartTime)){removeTask(t);}}};this.start=function(task){tasks.push(task);task.taskStartTime=new Date().getTime();task.taskRunTime=0;task.taskRunCount=0;startThread();return task;};this.stop=function(task){removeTask(task);return task;};this.stopAll=function(){stopThread();for(var i=0,len=tasks.length;i<len;i++){if(tasks[i].onStop){tasks[i].onStop();}}
tasks=[];removeQueue=[];};};Ext.TaskMgr=new Ext.util.TaskRunner();(function(){var libFlyweight;function fly(el){if(!libFlyweight){libFlyweight=new Ext.Element.Flyweight();}
libFlyweight.dom=el;return libFlyweight;}
(function(){var doc=document,isCSS1=doc.compatMode=="CSS1Compat",MAX=Math.max,ROUND=Math.round,PARSEINT=parseInt;Ext.lib.Dom={isAncestor:function(p,c){var ret=false;p=Ext.getDom(p);c=Ext.getDom(c);if(p&&c){if(p.contains){return p.contains(c);}else if(p.compareDocumentPosition){return!!(p.compareDocumentPosition(c)&16);}else{while(c=c.parentNode){ret=c==p||ret;}}}
return ret;},getViewWidth:function(full){return full?this.getDocumentWidth():this.getViewportWidth();},getViewHeight:function(full){return full?this.getDocumentHeight():this.getViewportHeight();},getDocumentHeight:function(){return MAX(!isCSS1?doc.body.scrollHeight:doc.documentElement.scrollHeight,this.getViewportHeight());},getDocumentWidth:function(){return MAX(!isCSS1?doc.body.scrollWidth:doc.documentElement.scrollWidth,this.getViewportWidth());},getViewportHeight:function(){return Ext.isIE?(Ext.isStrict?doc.documentElement.clientHeight:doc.body.clientHeight):self.innerHeight;},getViewportWidth:function(){return!Ext.isStrict&&!Ext.isOpera?doc.body.clientWidth:Ext.isIE?doc.documentElement.clientWidth:self.innerWidth;},getY:function(el){return this.getXY(el)[1];},getX:function(el){return this.getXY(el)[0];},getXY:function(el){var p,pe,b,bt,bl,dbd,x=0,y=0,scroll,hasAbsolute,bd=(doc.body||doc.documentElement),ret=[0,0];el=Ext.getDom(el);if(el!=bd){if(el.getBoundingClientRect){b=el.getBoundingClientRect();scroll=fly(document).getScroll();ret=[ROUND(b.left+scroll.left),ROUND(b.top+scroll.top)];}else{p=el;hasAbsolute=fly(el).isStyle("position","absolute");while(p){pe=fly(p);x+=p.offsetLeft;y+=p.offsetTop;hasAbsolute=hasAbsolute||pe.isStyle("position","absolute");if(Ext.isGecko){y+=bt=PARSEINT(pe.getStyle("borderTopWidth"),10)||0;x+=bl=PARSEINT(pe.getStyle("borderLeftWidth"),10)||0;if(p!=el&&!pe.isStyle('overflow','visible')){x+=bl;y+=bt;}}
p=p.offsetParent;}
if(Ext.isSafari&&hasAbsolute){x-=bd.offsetLeft;y-=bd.offsetTop;}
if(Ext.isGecko&&!hasAbsolute){dbd=fly(bd);x+=PARSEINT(dbd.getStyle("borderLeftWidth"),10)||0;y+=PARSEINT(dbd.getStyle("borderTopWidth"),10)||0;}
p=el.parentNode;while(p&&p!=bd){if(!Ext.isOpera||(p.tagName!='TR'&&!fly(p).isStyle("display","inline"))){x-=p.scrollLeft;y-=p.scrollTop;}
p=p.parentNode;}
ret=[x,y];}}
return ret},setXY:function(el,xy){(el=Ext.fly(el,'_setXY')).position();var pts=el.translatePoints(xy),style=el.dom.style,pos;for(pos in pts){if(!isNaN(pts[pos]))style[pos]=pts[pos]+"px"}},setX:function(el,x){this.setXY(el,[x,false]);},setY:function(el,y){this.setXY(el,[false,y]);}};})();Ext.lib.Dom.getRegion=function(el){return Ext.lib.Region.getRegion(el);};Ext.lib.Event=function(){var loadComplete=false,unloadListeners={},retryCount=0,onAvailStack=[],_interval,locked=false,win=window,doc=document,POLL_RETRYS=200,POLL_INTERVAL=20,EL=0,TYPE=0,FN=1,WFN=2,OBJ=2,ADJ_SCOPE=3,SCROLLLEFT='scrollLeft',SCROLLTOP='scrollTop',UNLOAD='unload',MOUSEOVER='mouseover',MOUSEOUT='mouseout',doAdd=function(){var ret;if(win.addEventListener){ret=function(el,eventName,fn,capture){if(eventName=='mouseenter'){fn=fn.createInterceptor(checkRelatedTarget);el.addEventListener(MOUSEOVER,fn,(capture));}else if(eventName=='mouseleave'){fn=fn.createInterceptor(checkRelatedTarget);el.addEventListener(MOUSEOUT,fn,(capture));}else{el.addEventListener(eventName,fn,(capture));}
return fn;};}else if(win.attachEvent){ret=function(el,eventName,fn,capture){el.attachEvent("on"+eventName,fn);return fn;};}else{ret=function(){};}
return ret;}(),doRemove=function(){var ret;if(win.removeEventListener){ret=function(el,eventName,fn,capture){if(eventName=='mouseenter'){eventName=MOUSEOVER;}else if(eventName=='mouseleave'){eventName=MOUSEOUT;}
el.removeEventListener(eventName,fn,(capture));};}else if(win.detachEvent){ret=function(el,eventName,fn){el.detachEvent("on"+eventName,fn);};}else{ret=function(){};}
return ret;}();function checkRelatedTarget(e){return!elContains(e.currentTarget,pub.getRelatedTarget(e));}
function elContains(parent,child){if(parent&&parent.firstChild){while(child){if(child===parent){return true;}
child=child.parentNode;if(child&&(child.nodeType!=1)){child=null;}}}
return false;}
function _tryPreloadAttach(){var ret=false,notAvail=[],element,i,v,override,tryAgain=!loadComplete||(retryCount>0);if(!locked){locked=true;for(i=0;i<onAvailStack.length;++i){v=onAvailStack[i];if(v&&(element=doc.getElementById(v.id))){if(!v.checkReady||loadComplete||element.nextSibling||(doc&&doc.body)){override=v.override;element=override?(override===true?v.obj:override):element;v.fn.call(element,v.obj);onAvailStack.remove(v);--i;}else{notAvail.push(v);}}}
retryCount=(notAvail.length===0)?0:retryCount-1;if(tryAgain){startInterval();}else{clearInterval(_interval);_interval=null;}
ret=!(locked=false);}
return ret;}
function startInterval(){if(!_interval){var callback=function(){_tryPreloadAttach();};_interval=setInterval(callback,POLL_INTERVAL);}}
function getScroll(){var dd=doc.documentElement,db=doc.body;if(dd&&(dd[SCROLLTOP]||dd[SCROLLLEFT])){return[dd[SCROLLLEFT],dd[SCROLLTOP]];}else if(db){return[db[SCROLLLEFT],db[SCROLLTOP]];}else{return[0,0];}}
function getPageCoord(ev,xy){ev=ev.browserEvent||ev;var coord=ev['page'+xy];if(!coord&&coord!==0){coord=ev['client'+xy]||0;if(Ext.isIE){coord+=getScroll()[xy=="X"?0:1];}}
return coord;}
var pub={extAdapter:true,onAvailable:function(p_id,p_fn,p_obj,p_override){onAvailStack.push({id:p_id,fn:p_fn,obj:p_obj,override:p_override,checkReady:false});retryCount=POLL_RETRYS;startInterval();},addListener:function(el,eventName,fn){el=Ext.getDom(el);if(el&&fn){if(eventName==UNLOAD){if(unloadListeners[el.id]===undefined){unloadListeners[el.id]=[];}
unloadListeners[el.id].push([eventName,fn]);return fn;}
return doAdd(el,eventName,fn,false);}
return false;},removeListener:function(el,eventName,fn){el=Ext.getDom(el);var i,len,li,lis;if(el&&fn){if(eventName==UNLOAD){if((lis=unloadListeners[el.id])!==undefined){for(i=0,len=lis.length;i<len;i++){if((li=lis[i])&&li[TYPE]==eventName&&li[FN]==fn){unloadListeners[el.id].splice(i,1);}}}
return;}
doRemove(el,eventName,fn,false);}},getTarget:function(ev){ev=ev.browserEvent||ev;return this.resolveTextNode(ev.target||ev.srcElement);},resolveTextNode:Ext.isGecko?function(node){if(!node){return;}
var s=HTMLElement.prototype.toString.call(node);if(s=='[xpconnect wrapped native prototype]'||s=='[object XULElement]'){return;}
return node.nodeType==3?node.parentNode:node;}:function(node){return node&&node.nodeType==3?node.parentNode:node;},getRelatedTarget:function(ev){ev=ev.browserEvent||ev;return this.resolveTextNode(ev.relatedTarget||(ev.type==MOUSEOUT?ev.toElement:ev.type==MOUSEOVER?ev.fromElement:null));},getPageX:function(ev){return getPageCoord(ev,"X");},getPageY:function(ev){return getPageCoord(ev,"Y");},getXY:function(ev){return[this.getPageX(ev),this.getPageY(ev)];},stopEvent:function(ev){this.stopPropagation(ev);this.preventDefault(ev);},stopPropagation:function(ev){ev=ev.browserEvent||ev;if(ev.stopPropagation){ev.stopPropagation();}else{ev.cancelBubble=true;}},preventDefault:function(ev){ev=ev.browserEvent||ev;if(ev.preventDefault){ev.preventDefault();}else{ev.returnValue=false;}},getEvent:function(e){e=e||win.event;if(!e){var c=this.getEvent.caller;while(c){e=c.arguments[0];if(e&&Event==e.constructor){break;}
c=c.caller;}}
return e;},getCharCode:function(ev){ev=ev.browserEvent||ev;return ev.charCode||ev.keyCode||0;},getListeners:function(el,eventName){Ext.EventManager.getListeners(el,eventName);},purgeElement:function(el,recurse,eventName){Ext.EventManager.purgeElement(el,recurse,eventName);},_load:function(e){loadComplete=true;var EU=Ext.lib.Event;if(Ext.isIE&&e!==true){doRemove(win,"load",arguments.callee);}},_unload:function(e){var EU=Ext.lib.Event,i,j,l,v,ul,id,len,index,scope;for(id in unloadListeners){ul=unloadListeners[id];for(i=0,len=ul.length;i<len;i++){v=ul[i];if(v){try{scope=v[ADJ_SCOPE]?(v[ADJ_SCOPE]===true?v[OBJ]:v[ADJ_SCOPE]):win;v[FN].call(scope,EU.getEvent(e),v[OBJ]);}catch(ex){}}}};Ext.EventManager._unload();doRemove(win,UNLOAD,EU._unload);}};pub.on=pub.addListener;pub.un=pub.removeListener;if(doc&&doc.body){pub._load(true);}else{doAdd(win,"load",pub._load);}
doAdd(win,UNLOAD,pub._unload);_tryPreloadAttach();return pub;}();Ext.lib.Ajax=function(){var activeX=['MSXML2.XMLHTTP.3.0','MSXML2.XMLHTTP','Microsoft.XMLHTTP'],CONTENTTYPE='Content-Type';function setHeader(o){var conn=o.conn,prop;function setTheHeaders(conn,headers){for(prop in headers){if(headers.hasOwnProperty(prop)){conn.setRequestHeader(prop,headers[prop]);}}}
if(pub.defaultHeaders){setTheHeaders(conn,pub.defaultHeaders);}
if(pub.headers){setTheHeaders(conn,pub.headers);delete pub.headers;}}
function createExceptionObject(tId,callbackArg,isAbort,isTimeout){return{tId:tId,status:isAbort?-1:0,statusText:isAbort?'transaction aborted':'communication failure',isAbort:isAbort,isTimeout:isTimeout,argument:callbackArg};}
function initHeader(label,value){(pub.headers=pub.headers||{})[label]=value;}
function createResponseObject(o,callbackArg){var headerObj={},headerStr,conn=o.conn,t,s,isBrokenStatus=conn.status==1223;try{headerStr=o.conn.getAllResponseHeaders();Ext.each(headerStr.replace(/\r\n/g,'\n').split('\n'),function(v){t=v.indexOf(':');if(t>=0){s=v.substr(0,t).toLowerCase();if(v.charAt(t+1)==' '){++t;}
headerObj[s]=v.substr(t+1);}});}catch(e){}
return{tId:o.tId,status:isBrokenStatus?204:conn.status,statusText:isBrokenStatus?'No Content':conn.statusText,getResponseHeader:function(header){return headerObj[header.toLowerCase()];},getAllResponseHeaders:function(){return headerStr},responseText:conn.responseText,responseXML:conn.responseXML,argument:callbackArg};}
function releaseObject(o){if(o.tId){pub.conn[o.tId]=null;}
o.conn=null;o=null;}
function handleTransactionResponse(o,callback,isAbort,isTimeout){if(!callback){releaseObject(o);return;}
var httpStatus,responseObject;try{if(o.conn.status!==undefined&&o.conn.status!=0){httpStatus=o.conn.status;}
else{httpStatus=13030;}}
catch(e){httpStatus=13030;}
if((httpStatus>=200&&httpStatus<300)||(Ext.isIE&&httpStatus==1223)){responseObject=createResponseObject(o,callback.argument);if(callback.success){if(!callback.scope){callback.success(responseObject);}
else{callback.success.apply(callback.scope,[responseObject]);}}}
else{switch(httpStatus){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:responseObject=createExceptionObject(o.tId,callback.argument,(isAbort?isAbort:false),isTimeout);if(callback.failure){if(!callback.scope){callback.failure(responseObject);}
else{callback.failure.apply(callback.scope,[responseObject]);}}
break;default:responseObject=createResponseObject(o,callback.argument);if(callback.failure){if(!callback.scope){callback.failure(responseObject);}
else{callback.failure.apply(callback.scope,[responseObject]);}}}}
releaseObject(o);responseObject=null;}
function handleReadyState(o,callback){callback=callback||{};var conn=o.conn,tId=o.tId,poll=pub.poll,cbTimeout=callback.timeout||null;if(cbTimeout){pub.conn[tId]=conn;pub.timeout[tId]=setTimeout(function(){pub.abort(o,callback,true);},cbTimeout);}
poll[tId]=setInterval(function(){if(conn&&conn.readyState==4){clearInterval(poll[tId]);poll[tId]=null;if(cbTimeout){clearTimeout(pub.timeout[tId]);pub.timeout[tId]=null;}
handleTransactionResponse(o,callback);}},pub.pollInterval);}
function asyncRequest(method,uri,callback,postData){var o=getConnectionObject()||null;if(o){o.conn.open(method,uri,true);if(pub.useDefaultXhrHeader){initHeader('X-Requested-With',pub.defaultXhrHeader);}
if(postData&&pub.useDefaultHeader&&(!pub.headers||!pub.headers[CONTENTTYPE])){initHeader(CONTENTTYPE,pub.defaultPostHeader);}
if(pub.defaultHeaders||pub.headers){setHeader(o);}
handleReadyState(o,callback);o.conn.send(postData||null);}
return o;}
function getConnectionObject(){var o;try{if(o=createXhrObject(pub.transactionId)){pub.transactionId++;}}catch(e){}finally{return o;}}
function createXhrObject(transactionId){var http;try{http=new XMLHttpRequest();}catch(e){for(var i=0;i<activeX.length;++i){try{http=new ActiveXObject(activeX[i]);break;}catch(e){}}}finally{return{conn:http,tId:transactionId};}}
var pub={request:function(method,uri,cb,data,options){if(options){var me=this,xmlData=options.xmlData,jsonData=options.jsonData,hs;Ext.applyIf(me,options);if(xmlData||jsonData){hs=me.headers;if(!hs||!hs[CONTENTTYPE]){initHeader(CONTENTTYPE,xmlData?'text/xml':'application/json');}
data=xmlData||(!Ext.isPrimitive(jsonData)?Ext.encode(jsonData):jsonData);}}
return asyncRequest(method||options.method||"POST",uri,cb,data);},serializeForm:function(form){var fElements=form.elements||(document.forms[form]||Ext.getDom(form)).elements,hasSubmit=false,encoder=encodeURIComponent,element,options,name,val,data='',type;Ext.each(fElements,function(element){name=element.name;type=element.type;if(!element.disabled&&name){if(/select-(one|multiple)/i.test(type)){Ext.each(element.options,function(opt){if(opt.selected){data+=String.format("{0}={1}&",encoder(name),encoder((opt.hasAttribute?opt.hasAttribute('value'):opt.getAttribute('value')!==null)?opt.value:opt.text));}});}else if(!/file|undefined|reset|button/i.test(type)){if(!(/radio|checkbox/i.test(type)&&!element.checked)&&!(type=='submit'&&hasSubmit)){data+=encoder(name)+'='+encoder(element.value)+'&';hasSubmit=/submit/i.test(type);}}}});return data.substr(0,data.length-1);},useDefaultHeader:true,defaultPostHeader:'application/x-www-form-urlencoded; charset=UTF-8',useDefaultXhrHeader:true,defaultXhrHeader:'XMLHttpRequest',poll:{},timeout:{},conn:{},pollInterval:50,transactionId:0,abort:function(o,callback,isTimeout){var me=this,tId=o.tId,isAbort=false;if(me.isCallInProgress(o)){o.conn.abort();clearInterval(me.poll[tId]);me.poll[tId]=null;clearTimeout(pub.timeout[tId]);me.timeout[tId]=null;handleTransactionResponse(o,callback,(isAbort=true),isTimeout);}
return isAbort;},isCallInProgress:function(o){return o.conn&&!{0:true,4:true}[o.conn.readyState];}};return pub;}();Ext.lib.Region=function(t,r,b,l){var me=this;me.top=t;me[1]=t;me.right=r;me.bottom=b;me.left=l;me[0]=l;};Ext.lib.Region.prototype={contains:function(region){var me=this;return(region.left>=me.left&&region.right<=me.right&&region.top>=me.top&&region.bottom<=me.bottom);},getArea:function(){var me=this;return((me.bottom-me.top)*(me.right-me.left));},intersect:function(region){var me=this,t=Math.max(me.top,region.top),r=Math.min(me.right,region.right),b=Math.min(me.bottom,region.bottom),l=Math.max(me.left,region.left);if(b>=t&&r>=l){return new Ext.lib.Region(t,r,b,l);}},union:function(region){var me=this,t=Math.min(me.top,region.top),r=Math.max(me.right,region.right),b=Math.max(me.bottom,region.bottom),l=Math.min(me.left,region.left);return new Ext.lib.Region(t,r,b,l);},constrainTo:function(r){var me=this;me.top=me.top.constrain(r.top,r.bottom);me.bottom=me.bottom.constrain(r.top,r.bottom);me.left=me.left.constrain(r.left,r.right);me.right=me.right.constrain(r.left,r.right);return me;},adjust:function(t,l,b,r){var me=this;me.top+=t;me.left+=l;me.right+=r;me.bottom+=b;return me;}};Ext.lib.Region.getRegion=function(el){var p=Ext.lib.Dom.getXY(el),t=p[1],r=p[0]+el.offsetWidth,b=p[1]+el.offsetHeight,l=p[0];return new Ext.lib.Region(t,r,b,l);};Ext.lib.Point=function(x,y){if(Ext.isArray(x)){y=x[1];x=x[0];}
var me=this;me.x=me.right=me.left=me[0]=x;me.y=me.top=me.bottom=me[1]=y;};Ext.lib.Point.prototype=new Ext.lib.Region();(function(){var EXTLIB=Ext.lib,noNegatives=/width|height|opacity|padding/i,offsetAttribute=/^((width|height)|(top|left))$/,defaultUnit=/width|height|top$|bottom$|left$|right$/i,offsetUnit=/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i,isset=function(v){return typeof v!=='undefined';},now=function(){return new Date();};EXTLIB.Anim={motion:function(el,args,duration,easing,cb,scope){return this.run(el,args,duration,easing,cb,scope,Ext.lib.Motion);},run:function(el,args,duration,easing,cb,scope,type){type=type||Ext.lib.AnimBase;if(typeof easing=="string"){easing=Ext.lib.Easing[easing];}
var anim=new type(el,args,duration,easing);anim.animateX(function(){if(Ext.isFunction(cb)){cb.call(scope);}});return anim;}};EXTLIB.AnimBase=function(el,attributes,duration,method){if(el){this.init(el,attributes,duration,method);}};EXTLIB.AnimBase.prototype={doMethod:function(attr,start,end){var me=this;return me.method(me.curFrame,start,end-start,me.totalFrames);},setAttr:function(attr,val,unit){if(noNegatives.test(attr)&&val<0){val=0;}
Ext.fly(this.el,'_anim').setStyle(attr,val+unit);},getAttr:function(attr){var el=Ext.fly(this.el),val=el.getStyle(attr),a=offsetAttribute.exec(attr)||[];if(val!=='auto'&&!offsetUnit.test(val)){return parseFloat(val);}
return(!!(a[2])||(el.getStyle('position')=='absolute'&&!!(a[3])))?el.dom['offset'+a[0].charAt(0).toUpperCase()+a[0].substr(1)]:0;},getDefaultUnit:function(attr){return defaultUnit.test(attr)?'px':'';},animateX:function(callback,scope){var me=this,f=function(){me.onComplete.removeListener(f);if(Ext.isFunction(callback)){callback.call(scope||me,me);}};me.onComplete.addListener(f,me);me.animate();},setRunAttr:function(attr){var me=this,a=this.attributes[attr],to=a.to,by=a.by,from=a.from,unit=a.unit,ra=(this.runAttrs[attr]={}),end;if(!isset(to)&&!isset(by)){return false;}
var start=isset(from)?from:me.getAttr(attr);if(isset(to)){end=to;}else if(isset(by)){if(Ext.isArray(start)){end=[];for(var i=0,len=start.length;i<len;i++){end[i]=start[i]+by[i];}}else{end=start+by;}}
Ext.apply(ra,{start:start,end:end,unit:isset(unit)?unit:me.getDefaultUnit(attr)});},init:function(el,attributes,duration,method){var me=this,actualFrames=0,mgr=EXTLIB.AnimMgr;Ext.apply(me,{isAnimated:false,startTime:null,el:Ext.getDom(el),attributes:attributes||{},duration:duration||1,method:method||EXTLIB.Easing.easeNone,useSec:true,curFrame:0,totalFrames:mgr.fps,runAttrs:{},animate:function(){var me=this,d=me.duration;if(me.isAnimated){return false;}
me.curFrame=0;me.totalFrames=me.useSec?Math.ceil(mgr.fps*d):d;mgr.registerElement(me);},stop:function(finish){var me=this;if(finish){me.curFrame=me.totalFrames;me._onTween.fire();}
mgr.stop(me);}});var onStart=function(){var me=this,attr;me.onStart.fire();me.runAttrs={};for(attr in this.attributes){this.setRunAttr(attr);}
me.isAnimated=true;me.startTime=now();actualFrames=0;};var onTween=function(){var me=this;me.onTween.fire({duration:now()-me.startTime,curFrame:me.curFrame});var ra=me.runAttrs;for(var attr in ra){this.setAttr(attr,me.doMethod(attr,ra[attr].start,ra[attr].end),ra[attr].unit);}
++actualFrames;};var onComplete=function(){var me=this,actual=(now()-me.startTime)/1000,data={duration:actual,frames:actualFrames,fps:actualFrames/actual};me.isAnimated=false;actualFrames=0;me.onComplete.fire(data);};me.onStart=new Ext.util.Event(me);me.onTween=new Ext.util.Event(me);me.onComplete=new Ext.util.Event(me);(me._onStart=new Ext.util.Event(me)).addListener(onStart);(me._onTween=new Ext.util.Event(me)).addListener(onTween);(me._onComplete=new Ext.util.Event(me)).addListener(onComplete);}};Ext.lib.AnimMgr=new function(){var me=this,thread=null,queue=[],tweenCount=0;Ext.apply(me,{fps:1000,delay:1,registerElement:function(tween){queue.push(tween);++tweenCount;tween._onStart.fire();me.start();},unRegister:function(tween,index){tween._onComplete.fire();index=index||getIndex(tween);if(index!=-1){queue.splice(index,1);}
if(--tweenCount<=0){me.stop();}},start:function(){if(thread===null){thread=setInterval(me.run,me.delay);}},stop:function(tween){if(!tween){clearInterval(thread);for(var i=0,len=queue.length;i<len;++i){if(queue[0].isAnimated){me.unRegister(queue[0],0);}}
queue=[];thread=null;tweenCount=0;}else{me.unRegister(tween);}},run:function(){var tf,i,len,tween;for(i=0,len=queue.length;i<len;i++){tween=queue[i];if(tween&&tween.isAnimated){tf=tween.totalFrames;if(tween.curFrame<tf||tf===null){++tween.curFrame;if(tween.useSec){correctFrame(tween);}
tween._onTween.fire();}else{me.stop(tween);}}}}});var getIndex=function(anim){var i,len;for(i=0,len=queue.length;i<len;i++){if(queue[i]===anim){return i;}}
return-1;};var correctFrame=function(tween){var frames=tween.totalFrames,frame=tween.curFrame,duration=tween.duration,expected=(frame*duration*1000/frames),elapsed=(now()-tween.startTime),tweak=0;if(elapsed<duration*1000){tweak=Math.round((elapsed/expected-1)*frame);}else{tweak=frames-(frame+1);}
if(tweak>0&&isFinite(tweak)){if(tween.curFrame+tweak>=frames){tweak=frames-(frame+1);}
tween.curFrame+=tweak;}};};EXTLIB.Bezier=new function(){this.getPosition=function(points,t){var n=points.length,tmp=[],c=1-t,i,j;for(i=0;i<n;++i){tmp[i]=[points[i][0],points[i][1]];}
for(j=1;j<n;++j){for(i=0;i<n-j;++i){tmp[i][0]=c*tmp[i][0]+t*tmp[parseInt(i+1,10)][0];tmp[i][1]=c*tmp[i][1]+t*tmp[parseInt(i+1,10)][1];}}
return[tmp[0][0],tmp[0][1]];};};EXTLIB.Easing={easeNone:function(t,b,c,d){return c*t/d+b;},easeIn:function(t,b,c,d){return c*(t/=d)*t+b;},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;}};(function(){EXTLIB.Motion=function(el,attributes,duration,method){if(el){EXTLIB.Motion.superclass.constructor.call(this,el,attributes,duration,method);}};Ext.extend(EXTLIB.Motion,Ext.lib.AnimBase);var superclass=EXTLIB.Motion.superclass,proto=EXTLIB.Motion.prototype,pointsRe=/^points$/i;Ext.apply(EXTLIB.Motion.prototype,{setAttr:function(attr,val,unit){var me=this,setAttr=superclass.setAttr;if(pointsRe.test(attr)){unit=unit||'px';setAttr.call(me,'left',val[0],unit);setAttr.call(me,'top',val[1],unit);}else{setAttr.call(me,attr,val,unit);}},getAttr:function(attr){var me=this,getAttr=superclass.getAttr;return pointsRe.test(attr)?[getAttr.call(me,'left'),getAttr.call(me,'top')]:getAttr.call(me,attr);},doMethod:function(attr,start,end){var me=this;return pointsRe.test(attr)?EXTLIB.Bezier.getPosition(me.runAttrs[attr],me.method(me.curFrame,0,100,me.totalFrames)/100):superclass.doMethod.call(me,attr,start,end);},setRunAttr:function(attr){if(pointsRe.test(attr)){var me=this,el=this.el,points=this.attributes.points,control=points.control||[],from=points.from,to=points.to,by=points.by,DOM=EXTLIB.Dom,start,i,end,len,ra;if(control.length>0&&!Ext.isArray(control[0])){control=[control];}else{}
Ext.fly(el,'_anim').position();DOM.setXY(el,isset(from)?from:DOM.getXY(el));start=me.getAttr('points');if(isset(to)){end=translateValues.call(me,to,start);for(i=0,len=control.length;i<len;++i){control[i]=translateValues.call(me,control[i],start);}}else if(isset(by)){end=[start[0]+by[0],start[1]+by[1]];for(i=0,len=control.length;i<len;++i){control[i]=[start[0]+control[i][0],start[1]+control[i][1]];}}
ra=this.runAttrs[attr]=[start];if(control.length>0){ra=ra.concat(control);}
ra[ra.length]=end;}else{superclass.setRunAttr.call(this,attr);}}});var translateValues=function(val,start){var pageXY=EXTLIB.Dom.getXY(this.el);return[val[0]-pageXY[0]+start[0],val[1]-pageXY[1]+start[1]];};})();})();(function(){var abs=Math.abs,pi=Math.PI,asin=Math.asin,pow=Math.pow,sin=Math.sin,EXTLIB=Ext.lib;Ext.apply(EXTLIB.Easing,{easeBoth:function(t,b,c,d){return((t/=d/2)<1)?c/2*t*t+b:-c/2*((--t)*(t-2)-1)+b;},easeInStrong:function(t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutStrong:function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeBothStrong:function(t,b,c,d){return((t/=d/2)<1)?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b;},elasticIn:function(t,b,c,d,a,p){if(t==0||(t/=d)==1){return t==0?b:b+c;}
p=p||(d*.3);var s;if(a>=abs(c)){s=p/(2*pi)*asin(c/a);}else{a=c;s=p/4;}
return-(a*pow(2,10*(t-=1))*sin((t*d-s)*(2*pi)/p))+b;},elasticOut:function(t,b,c,d,a,p){if(t==0||(t/=d)==1){return t==0?b:b+c;}
p=p||(d*.3);var s;if(a>=abs(c)){s=p/(2*pi)*asin(c/a);}else{a=c;s=p/4;}
return a*pow(2,-10*t)*sin((t*d-s)*(2*pi)/p)+c+b;},elasticBoth:function(t,b,c,d,a,p){if(t==0||(t/=d/2)==2){return t==0?b:b+c;}
p=p||(d*(.3*1.5));var s;if(a>=abs(c)){s=p/(2*pi)*asin(c/a);}else{a=c;s=p/4;}
return t<1?-.5*(a*pow(2,10*(t-=1))*sin((t*d-s)*(2*pi)/p))+b:a*pow(2,-10*(t-=1))*sin((t*d-s)*(2*pi)/p)*.5+c+b;},backIn:function(t,b,c,d,s){s=s||1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},backOut:function(t,b,c,d,s){if(!s){s=1.70158;}
return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},backBoth:function(t,b,c,d,s){s=s||1.70158;return((t/=d/2)<1)?c/2*(t*t*(((s*=(1.525))+1)*t-s))+b:c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},bounceIn:function(t,b,c,d){return c-EXTLIB.Easing.bounceOut(d-t,0,c,d)+b;},bounceOut:function(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}
return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;},bounceBoth:function(t,b,c,d){return(t<d/2)?EXTLIB.Easing.bounceIn(t*2,0,c,d)*.5+b:EXTLIB.Easing.bounceOut(t*2-d,0,c,d)*.5+c*.5+b;}});})();(function(){var EXTLIB=Ext.lib;EXTLIB.Anim.color=function(el,args,duration,easing,cb,scope){return EXTLIB.Anim.run(el,args,duration,easing,cb,scope,EXTLIB.ColorAnim);}
EXTLIB.ColorAnim=function(el,attributes,duration,method){EXTLIB.ColorAnim.superclass.constructor.call(this,el,attributes,duration,method);};Ext.extend(EXTLIB.ColorAnim,EXTLIB.AnimBase);var superclass=EXTLIB.ColorAnim.superclass,colorRE=/color$/i,transparentRE=/^transparent|rgba\(0, 0, 0, 0\)$/,rgbRE=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,hexRE=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,hex3RE=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,isset=function(v){return typeof v!=='undefined';};function parseColor(s){var pi=parseInt,base,out=null,c;if(s.length==3){return s;}
Ext.each([hexRE,rgbRE,hex3RE],function(re,idx){base=(idx%2==0)?16:10;c=re.exec(s);if(c&&c.length==4){out=[pi(c[1],base),pi(c[2],base),pi(c[3],base)];return false;}});return out;}
Ext.apply(EXTLIB.ColorAnim.prototype,{getAttr:function(attr){var me=this,el=me.el,val;if(colorRE.test(attr)){while(el&&transparentRE.test(val=Ext.fly(el).getStyle(attr))){el=el.parentNode;val="fff";}}else{val=superclass.getAttr.call(me,attr);}
return val;},doMethod:function(attr,start,end){var me=this,val,floor=Math.floor,i,len,v;if(colorRE.test(attr)){val=[];end=end||[];for(i=0,len=start.length;i<len;i++){v=start[i];val[i]=superclass.doMethod.call(me,attr,v,end[i]);}
val='rgb('+floor(val[0])+','+floor(val[1])+','+floor(val[2])+')';}else{val=superclass.doMethod.call(me,attr,start,end);}
return val;},setRunAttr:function(attr){var me=this,a=me.attributes[attr],to=a.to,by=a.by,ra;superclass.setRunAttr.call(me,attr);ra=me.runAttrs[attr];if(colorRE.test(attr)){var start=parseColor(ra.start),end=parseColor(ra.end);if(!isset(to)&&isset(by)){end=parseColor(by);for(var i=0,len=start.length;i<len;i++){end[i]=start[i]+end[i];}}
ra.start=start;ra.end=end;}}});})();(function(){var EXTLIB=Ext.lib;EXTLIB.Anim.scroll=function(el,args,duration,easing,cb,scope){return EXTLIB.Anim.run(el,args,duration,easing,cb,scope,EXTLIB.Scroll);};EXTLIB.Scroll=function(el,attributes,duration,method){if(el){EXTLIB.Scroll.superclass.constructor.call(this,el,attributes,duration,method);}};Ext.extend(EXTLIB.Scroll,EXTLIB.ColorAnim);var superclass=EXTLIB.Scroll.superclass,SCROLL='scroll';Ext.apply(EXTLIB.Scroll.prototype,{doMethod:function(attr,start,end){var val,me=this,curFrame=me.curFrame,totalFrames=me.totalFrames;if(attr==SCROLL){val=[me.method(curFrame,start[0],end[0]-start[0],totalFrames),me.method(curFrame,start[1],end[1]-start[1],totalFrames)];}else{val=superclass.doMethod.call(me,attr,start,end);}
return val;},getAttr:function(attr){var me=this;if(attr==SCROLL){return[me.el.scrollLeft,me.el.scrollTop];}else{return superclass.getAttr.call(me,attr);}},setAttr:function(attr,val,unit){var me=this;if(attr==SCROLL){me.el.scrollLeft=val[0];me.el.scrollTop=val[1];}else{superclass.setAttr.call(me,attr,val,unit);}}});})();if(Ext.isIE){function fnCleanUp(){var p=Function.prototype;delete p.createSequence;delete p.defer;delete p.createDelegate;delete p.createCallback;delete p.createInterceptor;window.detachEvent("onunload",fnCleanUp);}
window.attachEvent("onunload",fnCleanUp);}})();
/* ========== ../ext-3.2.1/ext-all-debug.js ============ */

Ext.DomHelper=function(){var tempTableEl=null,emptyTags=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,tableRe=/^table|tbody|tr|td$/i,confRe=/tag|children|cn|html$/i,tableElRe=/td|tr|tbody/i,cssRe=/([a-z0-9-]+)\s*:\s*([^;\s]+(?:\s*[^;\s]+)*);?/gi,endRe=/end/i,pub,afterbegin='afterbegin',afterend='afterend',beforebegin='beforebegin',beforeend='beforeend',ts='<table>',te='</table>',tbs=ts+'<tbody>',tbe='</tbody>'+te,trs=tbs+'<tr>',tre='</tr>'+tbe;function doInsert(el,o,returnElement,pos,sibling,append){var newNode=pub.insertHtml(pos,Ext.getDom(el),createHtml(o));return returnElement?Ext.get(newNode,true):newNode;}
function createHtml(o){var b='',attr,val,key,keyVal,cn;if(typeof o=="string"){b=o;}else if(Ext.isArray(o)){for(var i=0;i<o.length;i++){if(o[i]){b+=createHtml(o[i]);}};}else{b+='<'+(o.tag=o.tag||'div');for(attr in o){val=o[attr];if(!confRe.test(attr)){if(typeof val=="object"){b+=' '+attr+'="';for(key in val){b+=key+':'+val[key]+';';};b+='"';}else{b+=' '+({cls:'class',htmlFor:'for'}[attr]||attr)+'="'+val+'"';}}};if(emptyTags.test(o.tag)){b+='/>';}else{b+='>';if((cn=o.children||o.cn)){b+=createHtml(cn);}else if(o.html){b+=o.html;}
b+='</'+o.tag+'>';}}
return b;}
function ieTable(depth,s,h,e){tempTableEl.innerHTML=[s,h,e].join('');var i=-1,el=tempTableEl,ns;while(++i<depth){el=el.firstChild;}
if(ns=el.nextSibling){var df=document.createDocumentFragment();while(el){ns=el.nextSibling;df.appendChild(el);el=ns;}
el=df;}
return el;}
function insertIntoTable(tag,where,el,html){var node,before;tempTableEl=tempTableEl||document.createElement('div');if(tag=='td'&&(where==afterbegin||where==beforeend)||!tableElRe.test(tag)&&(where==beforebegin||where==afterend)){return;}
before=where==beforebegin?el:where==afterend?el.nextSibling:where==afterbegin?el.firstChild:null;if(where==beforebegin||where==afterend){el=el.parentNode;}
if(tag=='td'||(tag=='tr'&&(where==beforeend||where==afterbegin))){node=ieTable(4,trs,html,tre);}else if((tag=='tbody'&&(where==beforeend||where==afterbegin))||(tag=='tr'&&(where==beforebegin||where==afterend))){node=ieTable(3,tbs,html,tbe);}else{node=ieTable(2,ts,html,te);}
el.insertBefore(node,before);return node;}
pub={markup:function(o){return createHtml(o);},applyStyles:function(el,styles){if(styles){var i=0,len,style,matches;el=Ext.fly(el);if(typeof styles=="function"){styles=styles.call();}
if(typeof styles=="string"){while((matches=cssRe.exec(styles))){el.setStyle(matches[1],matches[2]);}}else if(typeof styles=="object"){el.setStyle(styles);}}},insertHtml:function(where,el,html){var hash={},hashVal,setStart,range,frag,rangeEl,rs;where=where.toLowerCase();hash[beforebegin]=['BeforeBegin','previousSibling'];hash[afterend]=['AfterEnd','nextSibling'];if(el.insertAdjacentHTML){if(tableRe.test(el.tagName)&&(rs=insertIntoTable(el.tagName.toLowerCase(),where,el,html))){return rs;}
hash[afterbegin]=['AfterBegin','firstChild'];hash[beforeend]=['BeforeEnd','lastChild'];if((hashVal=hash[where])){el.insertAdjacentHTML(hashVal[0],html);return el[hashVal[1]];}}else{range=el.ownerDocument.createRange();setStart='setStart'+(endRe.test(where)?'After':'Before');if(hash[where]){range[setStart](el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,where==beforebegin?el:el.nextSibling);return el[(where==beforebegin?'previous':'next')+'Sibling'];}else{rangeEl=(where==afterbegin?'first':'last')+'Child';if(el.firstChild){range[setStart](el[rangeEl]);frag=range.createContextualFragment(html);if(where==afterbegin){el.insertBefore(frag,el.firstChild);}else{el.appendChild(frag);}}else{el.innerHTML=html;}
return el[rangeEl];}}
throw'Illegal insertion point -> "'+where+'"';},insertBefore:function(el,o,returnElement){return doInsert(el,o,returnElement,beforebegin);},insertAfter:function(el,o,returnElement){return doInsert(el,o,returnElement,afterend,'nextSibling');},insertFirst:function(el,o,returnElement){return doInsert(el,o,returnElement,afterbegin,'firstChild');},append:function(el,o,returnElement){return doInsert(el,o,returnElement,beforeend,'',true);},overwrite:function(el,o,returnElement){el=Ext.getDom(el);el.innerHTML=createHtml(o);return returnElement?Ext.get(el.firstChild):el.firstChild;},createHtml:createHtml};return pub;}();Ext.apply(Ext.DomHelper,function(){var pub,afterbegin='afterbegin',afterend='afterend',beforebegin='beforebegin',beforeend='beforeend',confRe=/tag|children|cn|html$/i;function doInsert(el,o,returnElement,pos,sibling,append){el=Ext.getDom(el);var newNode;if(pub.useDom){newNode=createDom(o,null);if(append){el.appendChild(newNode);}else{(sibling=='firstChild'?el:el.parentNode).insertBefore(newNode,el[sibling]||el);}}else{newNode=Ext.DomHelper.insertHtml(pos,el,Ext.DomHelper.createHtml(o));}
return returnElement?Ext.get(newNode,true):newNode;}
function createDom(o,parentNode){var el,doc=document,useSet,attr,val,cn;if(Ext.isArray(o)){el=doc.createDocumentFragment();for(var i=0,l=o.length;i<l;i++){createDom(o[i],el);}}else if(typeof o=='string'){el=doc.createTextNode(o);}else{el=doc.createElement(o.tag||'div');useSet=!!el.setAttribute;for(var attr in o){if(!confRe.test(attr)){val=o[attr];if(attr=='cls'){el.className=val;}else{if(useSet){el.setAttribute(attr,val);}else{el[attr]=val;}}}}
Ext.DomHelper.applyStyles(el,o.style);if((cn=o.children||o.cn)){createDom(cn,el);}else if(o.html){el.innerHTML=o.html;}}
if(parentNode){parentNode.appendChild(el);}
return el;}
pub={createTemplate:function(o){var html=Ext.DomHelper.createHtml(o);return new Ext.Template(html);},useDom:false,insertBefore:function(el,o,returnElement){return doInsert(el,o,returnElement,beforebegin);},insertAfter:function(el,o,returnElement){return doInsert(el,o,returnElement,afterend,'nextSibling');},insertFirst:function(el,o,returnElement){return doInsert(el,o,returnElement,afterbegin,'firstChild');},append:function(el,o,returnElement){return doInsert(el,o,returnElement,beforeend,'',true);},createDom:createDom};return pub;}());Ext.Template=function(html){var me=this,a=arguments,buf=[],v;if(Ext.isArray(html)){html=html.join("");}else if(a.length>1){for(var i=0,len=a.length;i<len;i++){v=a[i];if(typeof v=='object'){Ext.apply(me,v);}else{buf.push(v);}};html=buf.join('');}
me.html=html;if(me.compiled){me.compile();}};Ext.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(values){var me=this;return me.compiled?me.compiled(values):me.html.replace(me.re,function(m,name){return values[name]!==undefined?values[name]:"";});},set:function(html,compile){var me=this;me.html=html;me.compiled=null;return compile?me.compile():me;},compile:function(){var me=this,sep=Ext.isGecko?"+":",";function fn(m,name){name="values['"+name+"']";return"'"+sep+'('+name+" == undefined ? '' : "+name+')'+sep+"'";}
eval("this.compiled = function(values){ return "+(Ext.isGecko?"'":"['")+
me.html.replace(/\\/g,'\\\\').replace(/(\r\n|\n)/g,'\\n').replace(/'/g,"\\'").replace(this.re,fn)+
(Ext.isGecko?"';};":"'].join('');};"));return me;},insertFirst:function(el,values,returnElement){return this.doInsert('afterBegin',el,values,returnElement);},insertBefore:function(el,values,returnElement){return this.doInsert('beforeBegin',el,values,returnElement);},insertAfter:function(el,values,returnElement){return this.doInsert('afterEnd',el,values,returnElement);},append:function(el,values,returnElement){return this.doInsert('beforeEnd',el,values,returnElement);},doInsert:function(where,el,values,returnEl){el=Ext.getDom(el);var newNode=Ext.DomHelper.insertHtml(where,el,this.applyTemplate(values));return returnEl?Ext.get(newNode,true):newNode;},overwrite:function(el,values,returnElement){el=Ext.getDom(el);el.innerHTML=this.applyTemplate(values);return returnElement?Ext.get(el.firstChild,true):el.firstChild;}};Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;Ext.Template.from=function(el,config){el=Ext.getDom(el);return new Ext.Template(el.value||el.innerHTML,config||'');};Ext.apply(Ext.Template.prototype,{disableFormats:false,re:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,argsRe:/^\s*['"](.*)["']\s*$/,compileARe:/\\/g,compileBRe:/(\r\n|\n)/g,compileCRe:/\x27/g,applyTemplate:function(values){var me=this,useF=me.disableFormats!==true,fm=Ext.util.Format,tpl=me;if(me.compiled){return me.compiled(values);}
function fn(m,name,format,args){if(format&&useF){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values);}else{if(args){var re=me.argsRe;args=args.split(',');for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1");}
args=[values[name]].concat(args);}else{args=[values[name]];}
return fm[format].apply(fm,args);}}else{return values[name]!==undefined?values[name]:"";}}
return me.html.replace(me.re,fn);},compile:function(){var me=this,fm=Ext.util.Format,useF=me.disableFormats!==true,sep=Ext.isGecko?"+":",",body;function fn(m,name,format,args){if(format&&useF){args=args?','+args:"";if(format.substr(0,5)!="this."){format="fm."+format+'(';}else{format='this.call("'+format.substr(5)+'", ';args=", values";}}else{args='';format="(values['"+name+"'] == undefined ? '' : ";}
return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'";}
if(Ext.isGecko){body="this.compiled = function(values){ return '"+
me.html.replace(me.compileARe,'\\\\').replace(me.compileBRe,'\\n').replace(me.compileCRe,"\\'").replace(me.re,fn)+"';};";}else{body=["this.compiled = function(values){ return ['"];body.push(me.html.replace(me.compileARe,'\\\\').replace(me.compileBRe,'\\n').replace(me.compileCRe,"\\'").replace(me.re,fn));body.push("'].join('');};");body=body.join('');}
eval(body);return me;},call:function(fnName,value,allValues){return this[fnName](value,allValues);}});Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;Ext.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/>+~]\s?|\s|$)/,tagTokenRe=/^(#)?([\w-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;eval("var batch = 30803;");function child(parent,index){var i=0,n=parent.firstChild;while(n){if(n.nodeType==1){if(++i==index){return n;}}
n=n.nextSibling;}
return null;}
function next(n){while((n=n.nextSibling)&&n.nodeType!=1);return n;}
function prev(n){while((n=n.previousSibling)&&n.nodeType!=1);return n;}
function children(parent){var n=parent.firstChild,nodeIndex=-1,nextNode;while(n){nextNode=n.nextSibling;if(n.nodeType==3&&!nonSpace.test(n.nodeValue)){parent.removeChild(n);}else{n.nodeIndex=++nodeIndex;}
n=nextNode;}
return this;}
function byClassName(nodeSet,cls){if(!cls){return nodeSet;}
var result=[],ri=-1;for(var i=0,ci;ci=nodeSet[i];i++){if((' '+ci.className+' ').indexOf(cls)!=-1){result[++ri]=ci;}}
return result;};function attrValue(n,attr){if(!n.tagName&&typeof n.length!="undefined"){n=n[0];}
if(!n){return null;}
if(attr=="for"){return n.htmlFor;}
if(attr=="class"||attr=="className"){return n.className;}
return n.getAttribute(attr)||n[attr];};function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;if(!ns){return result;}
tagName=tagName||"*";if(typeof ns.getElementsByTagName!="undefined"){ns=[ns];}
if(!mode){for(var i=0,ni;ni=ns[i];i++){cs=ni.getElementsByTagName(tagName);for(var j=0,ci;ci=cs[j];j++){result[++ri]=ci;}}}else if(mode=="/"||mode==">"){var utag=tagName.toUpperCase();for(var i=0,ni,cn;ni=ns[i];i++){cn=ni.childNodes;for(var j=0,cj;cj=cn[j];j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName=='*'){result[++ri]=cj;}}}}else if(mode=="+"){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)&&n.nodeType!=1);if(n&&(n.nodeName==utag||n.nodeName==tagName||tagName=='*')){result[++ri]=n;}}}else if(mode=="~"){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName=='*'){result[++ri]=n;}}}}
return result;}
function concat(a,b){if(b.slice){return a.concat(b);}
for(var i=0,l=b.length;i<l;i++){a[a.length]=b[i];}
return a;}
function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs];}
if(!tagName){return cs;}
var result=[],ri=-1;tagName=tagName.toLowerCase();for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType==1&&ci.tagName.toLowerCase()==tagName){result[++ri]=ci;}}
return result;}
function byId(cs,id){if(cs.tagName||cs==document){cs=[cs];}
if(!id){return cs;}
var result=[],ri=-1;for(var i=0,ci;ci=cs[i];i++){if(ci&&ci.id==id){result[++ri]=ci;return result;}}
return result;}
function byAttribute(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom=="{",fn=Ext.DomQuery.operators[op],a,innerHTML;for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType!=1){continue;}
innerHTML=ci.innerHTML;if(innerHTML!==null&&innerHTML!==undefined){if(useGetStyle){a=Ext.DomQuery.getStyle(ci,attr);}else if(attr=="class"||attr=="className"){a=ci.className;}else if(attr=="for"){a=ci.htmlFor;}else if(attr=="href"){a=ci.getAttribute("href",2);}else{a=ci.getAttribute(attr);}}else{a=ci.getAttribute(attr);}
if((fn&&fn(a,value))||(!fn&&a)){result[++ri]=ci;}}
return result;}
function byPseudo(cs,name,value){return Ext.DomQuery.pseudos[name](cs,value);}
function nodupIEXml(cs){var d=++key,r;cs[0].setAttribute("_nodup",d);r=[cs[0]];for(var i=1,len=cs.length;i<len;i++){var c=cs[i];if(!c.getAttribute("_nodup")!=d){c.setAttribute("_nodup",d);r[r.length]=c;}}
for(var i=0,len=cs.length;i<len;i++){cs[i].removeAttribute("_nodup");}
return r;}
function nodup(cs){if(!cs){return[];}
var len=cs.length,c,i,r=cs,cj,ri=-1;if(!len||typeof cs.nodeType!="undefined"||len==1){return cs;}
if(isIE&&typeof cs[0].selectSingleNode!="undefined"){return nodupIEXml(cs);}
var d=++key;cs[0]._nodup=d;for(i=1;c=cs[i];i++){if(c._nodup!=d){c._nodup=d;}else{r=[];for(var j=0;j<i;j++){r[++ri]=cs[j];}
for(j=i+1;cj=cs[j];j++){if(cj._nodup!=d){cj._nodup=d;r[++ri]=cj;}}
return r;}}
return r;}
function quickDiffIEXml(c1,c2){var d=++key,r=[];for(var i=0,len=c1.length;i<len;i++){c1[i].setAttribute("_qdiff",d);}
for(var i=0,len=c2.length;i<len;i++){if(c2[i].getAttribute("_qdiff")!=d){r[r.length]=c2[i];}}
for(var i=0,len=c1.length;i<len;i++){c1[i].removeAttribute("_qdiff");}
return r;}
function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];if(!len1){return c2;}
if(isIE&&typeof c1[0].selectSingleNode!="undefined"){return quickDiffIEXml(c1,c2);}
for(var i=0;i<len1;i++){c1[i]._qdiff=d;}
for(var i=0,len=c2.length;i<len;i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i];}}
return r;}
function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;return d.getElementById(id);}
ns=getNodes(ns,mode,"*");return byId(ns,id);}
return{getStyle:function(el,name){return Ext.fly(el).getStyle(name);},compile:function(path,type){type=type||"select";var fn=["var f = function(root){\n var mode; ++batch; var n = root || document;\n"],mode,lastPath,matchers=Ext.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);if(lmode&&lmode[1]){fn[fn.length]='mode="'+lmode[1].replace(trimRe,"")+'";';path=path.replace(lmode[1],"");}
while(path.substr(0,1)=="/"){path=path.substr(1);}
while(path&&lastPath!=path){lastPath=path;var tokenMatch=path.match(tagTokenRe);if(type=="select"){if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = quickId(n, mode, root, "'+tokenMatch[2]+'");';}else{fn[fn.length]='n = getNodes(n, mode, "'+tokenMatch[2]+'");';}
path=path.replace(tokenMatch[0],"");}else if(path.substr(0,1)!='@'){fn[fn.length]='n = getNodes(n, mode, "*");';}}else{if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = byId(n, "'+tokenMatch[2]+'");';}else{fn[fn.length]='n = byTag(n, "'+tokenMatch[2]+'");';}
path=path.replace(tokenMatch[0],"");}}
while(!(modeMatch=path.match(modeRe))){var matched=false;for(var j=0;j<matchersLn;j++){var t=matchers[j];var m=path.match(t.re);if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i];});path=path.replace(m[0],"");matched=true;break;}}
if(!matched){throw'Error parsing selector, parsing failed at "'+path+'"';}}
if(modeMatch[1]){fn[fn.length]='mode="'+modeMatch[1].replace(trimRe,"")+'";';path=path.replace(modeMatch[1],"");}}
fn[fn.length]="return nodup(n);\n}";eval(fn.join(""));return f;},jsSelect:function(path,root,type){root=root||document;if(typeof root=="string"){root=document.getElementById(root);}
var paths=path.split(","),results=[];for(var i=0,len=paths.length;i<len;i++){var subPath=paths[i].replace(trimRe,"");if(!cache[subPath]){cache[subPath]=Ext.DomQuery.compile(subPath);if(!cache[subPath]){throw subPath+" is not a valid selector";}}
var result=cache[subPath](root);if(result&&result!=document){results=results.concat(result);}}
if(paths.length>1){return nodup(results);}
return results;},isXml:function(el){var docEl=(el?el.ownerDocument||el:0).documentElement;return docEl?docEl.nodeName!=="HTML":false;},select:document.querySelectorAll?function(path,root,type){root=root||document;if(!Ext.DomQuery.isXml(root)){try{var cs=root.querySelectorAll(path);return Ext.toArray(cs);}
catch(ex){}}
return Ext.DomQuery.jsSelect.call(this,path,root,type);}:function(path,root,type){return Ext.DomQuery.jsSelect.call(this,path,root,type);},selectNode:function(path,root){return Ext.DomQuery.select(path,root)[0];},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,"");if(!valueCache[path]){valueCache[path]=Ext.DomQuery.compile(path,"select");}
var n=valueCache[path](root),v;n=n[0]?n[0]:n;if(typeof n.normalize=='function')n.normalize();v=(n&&n.firstChild?n.firstChild.nodeValue:null);return((v===null||v===undefined||v==='')?defaultValue:v);},selectNumber:function(path,root,defaultValue){var v=Ext.DomQuery.selectValue(path,root,defaultValue||0);return parseFloat(v);},is:function(el,ss){if(typeof el=="string"){el=document.getElementById(el);}
var isArray=Ext.isArray(el),result=Ext.DomQuery.filter(isArray?el:[el],ss);return isArray?(result.length==el.length):(result.length>0);},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,"");if(!simpleCache[ss]){simpleCache[ss]=Ext.DomQuery.compile(ss,"simple");}
var result=simpleCache[ss](els);return nonMatches?quickDiff(result,els):result;},matchers:[{re:/^\.([\w-]+)/,select:'n = byClassName(n, " {1} ");'},{re:/^\:([\w-]+)(?:\(((?:[^\s>\/]*|.*?))\))?/,select:'n = byPseudo(n, "{1}", "{2}");'},{re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]\}])/,select:'n = byAttribute(n, "{2}", "{4}", "{3}", "{1}");'},{re:/^#([\w-]+)/,select:'n = byId(n, "{1}");'},{re:/^@([\w-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, "{1}")}};'}],operators:{"=":function(a,v){return a==v;},"!=":function(a,v){return a!=v;},"^=":function(a,v){return a&&a.substr(0,v.length)==v;},"$=":function(a,v){return a&&a.substr(a.length-v.length)==v;},"*=":function(a,v){return a&&a.indexOf(v)!==-1;},"%=":function(a,v){return(a%v)==0;},"|=":function(a,v){return a&&(a==v||a.substr(0,v.length+1)==v+'-');},"~=":function(a,v){return a&&(' '+a+' ').indexOf(' '+v+' ')!=-1;}},pseudos:{"first-child":function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.previousSibling)&&n.nodeType!=1);if(!n){r[++ri]=ci;}}
return r;},"last-child":function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.nextSibling)&&n.nodeType!=1);if(!n){r[++ri]=ci;}}
return r;},"nth-child":function(c,a){var r=[],ri=-1,m=nthRe.exec(a=="even"&&"2n"||a=="odd"&&"2n+1"||!nthRe2.test(a)&&"n+"+a||a),f=(m[1]||1)-0,l=m[2]-0;for(var i=0,n;n=c[i];i++){var pn=n.parentNode;if(batch!=pn._batch){var j=0;for(var cn=pn.firstChild;cn;cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j;}}
pn._batch=batch;}
if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n;}}else if((n.nodeIndex+l)%f==0){r[++ri]=n;}}
return r;},"only-child":function(c){var r=[],ri=-1;;for(var i=0,ci;ci=c[i];i++){if(!prev(ci)&&!next(ci)){r[++ri]=ci;}}
return r;},"empty":function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var cns=ci.childNodes,j=0,cn,empty=true;while(cn=cns[j]){++j;if(cn.nodeType==1||cn.nodeType==3){empty=false;break;}}
if(empty){r[++ri]=ci;}}
return r;},"contains":function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if((ci.textContent||ci.innerText||'').indexOf(v)!=-1){r[++ri]=ci;}}
return r;},"nodeValue":function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.firstChild&&ci.firstChild.nodeValue==v){r[++ri]=ci;}}
return r;},"checked":function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.checked==true){r[++ri]=ci;}}
return r;},"not":function(c,ss){return Ext.DomQuery.filter(c,ss,true);},"any":function(c,selectors){var ss=selectors.split('|'),r=[],ri=-1,s;for(var i=0,ci;ci=c[i];i++){for(var j=0;s=ss[j];j++){if(Ext.DomQuery.is(ci,s)){r[++ri]=ci;break;}}}
return r;},"odd":function(c){return this["nth-child"](c,"odd");},"even":function(c){return this["nth-child"](c,"even");},"nth":function(c,a){return c[a-1]||[];},"first":function(c){return c[0]||[];},"last":function(c){return c[c.length-1]||[];},"has":function(c,ss){var s=Ext.DomQuery.select,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(s(ss,ci).length>0){r[++ri]=ci;}}
return r;},"next":function(c,ss){var is=Ext.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=next(ci);if(n&&is(n,ss)){r[++ri]=ci;}}
return r;},"prev":function(c,ss){var is=Ext.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=prev(ci);if(n&&is(n,ss)){r[++ri]=ci;}}
return r;}}};}();Ext.query=Ext.DomQuery.select;Ext.util.DelayedTask=function(fn,scope,args){var me=this,id,call=function(){clearInterval(id);id=null;fn.apply(scope,args||[]);};me.delay=function(delay,newFn,newScope,newArgs){me.cancel();fn=newFn||fn;scope=newScope||scope;args=newArgs||args;id=setInterval(call,delay);};me.cancel=function(){if(id){clearInterval(id);id=null;}};};(function(){var EXTUTIL=Ext.util,EACH=Ext.each,TRUE=true,FALSE=false;EXTUTIL.Observable=function(){var me=this,e=me.events;if(me.listeners){me.on(me.listeners);delete me.listeners;}
me.events=e||{};};EXTUTIL.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var a=Array.prototype.slice.call(arguments,0),ename=a[0].toLowerCase(),me=this,ret=TRUE,ce=me.events[ename],cc,q,c;if(me.eventsSuspended===TRUE){if(q=me.eventQueue){q.push(a);}}
else if(typeof ce=='object'){if(ce.bubble){if(ce.fire.apply(ce,a.slice(1))===FALSE){return FALSE;}
c=me.getBubbleTarget&&me.getBubbleTarget();if(c&&c.enableBubble){cc=c.events[ename];if(!cc||typeof cc!='object'||!cc.bubble){c.enableBubble(ename);}
return c.fireEvent.apply(c,a);}}
else{a.shift();ret=ce.fire.apply(ce,a);}}
return ret;},addListener:function(eventName,fn,scope,o){var me=this,e,oe,isF,ce;if(typeof eventName=='object'){o=eventName;for(e in o){oe=o[e];if(!me.filterOptRe.test(e)){me.addListener(e,oe.fn||oe,oe.scope||o.scope,oe.fn?oe:o);}}}else{eventName=eventName.toLowerCase();ce=me.events[eventName]||TRUE;if(typeof ce=='boolean'){me.events[eventName]=ce=new EXTUTIL.Event(me,eventName);}
ce.addListener(fn,scope,typeof o=='object'?o:{});}},removeListener:function(eventName,fn,scope){var ce=this.events[eventName.toLowerCase()];if(typeof ce=='object'){ce.removeListener(fn,scope);}},purgeListeners:function(){var events=this.events,evt,key;for(key in events){evt=events[key];if(typeof evt=='object'){evt.clearListeners();}}},addEvents:function(o){var me=this;me.events=me.events||{};if(typeof o=='string'){var a=arguments,i=a.length;while(i--){me.events[a[i]]=me.events[a[i]]||TRUE;}}else{Ext.applyIf(me.events,o);}},hasListener:function(eventName){var e=this.events[eventName.toLowerCase()];return typeof e=='object'&&e.listeners.length>0;},suspendEvents:function(queueSuspended){this.eventsSuspended=TRUE;if(queueSuspended&&!this.eventQueue){this.eventQueue=[];}},resumeEvents:function(){var me=this,queued=me.eventQueue||[];me.eventsSuspended=FALSE;delete me.eventQueue;EACH(queued,function(e){me.fireEvent.apply(me,e);});}};var OBSERVABLE=EXTUTIL.Observable.prototype;OBSERVABLE.on=OBSERVABLE.addListener;OBSERVABLE.un=OBSERVABLE.removeListener;EXTUTIL.Observable.releaseCapture=function(o){o.fireEvent=OBSERVABLE.fireEvent;};function createTargeted(h,o,scope){return function(){if(o.target==arguments[0]){h.apply(scope,Array.prototype.slice.call(arguments,0));}};};function createBuffered(h,o,l,scope){l.task=new EXTUTIL.DelayedTask();return function(){l.task.delay(o.buffer,h,scope,Array.prototype.slice.call(arguments,0));};};function createSingle(h,e,fn,scope){return function(){e.removeListener(fn,scope);return h.apply(scope,arguments);};};function createDelayed(h,o,l,scope){return function(){var task=new EXTUTIL.DelayedTask();if(!l.tasks){l.tasks=[];}
l.tasks.push(task);task.delay(o.delay||10,h,scope,Array.prototype.slice.call(arguments,0));};};EXTUTIL.Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[];};EXTUTIL.Event.prototype={addListener:function(fn,scope,options){var me=this,l;scope=scope||me.obj;if(!me.isListening(fn,scope)){l=me.createListener(fn,scope,options);if(me.firing){me.listeners=me.listeners.slice(0);}
me.listeners.push(l);}},createListener:function(fn,scope,o){o=o||{},scope=scope||this.obj;var l={fn:fn,scope:scope,options:o},h=fn;if(o.target){h=createTargeted(h,o,scope);}
if(o.delay){h=createDelayed(h,o,l,scope);}
if(o.single){h=createSingle(h,this,fn,scope);}
if(o.buffer){h=createBuffered(h,o,l,scope);}
l.fireFn=h;return l;},findListener:function(fn,scope){var list=this.listeners,i=list.length,l;scope=scope||this.obj;while(i--){l=list[i];if(l){if(l.fn==fn&&l.scope==scope){return i;}}}
return-1;},isListening:function(fn,scope){return this.findListener(fn,scope)!=-1;},removeListener:function(fn,scope){var index,l,k,me=this,ret=FALSE;if((index=me.findListener(fn,scope))!=-1){if(me.firing){me.listeners=me.listeners.slice(0);}
l=me.listeners[index];if(l.task){l.task.cancel();delete l.task;}
k=l.tasks&&l.tasks.length;if(k){while(k--){l.tasks[k].cancel();}
delete l.tasks;}
me.listeners.splice(index,1);ret=TRUE;}
return ret;},clearListeners:function(){var me=this,l=me.listeners,i=l.length;while(i--){me.removeListener(l[i].fn,l[i].scope);}},fire:function(){var me=this,listeners=me.listeners,len=listeners.length,i=0,l;if(len>0){me.firing=TRUE;var args=Array.prototype.slice.call(arguments,0);for(;i<len;i++){l=listeners[i];if(l&&l.fireFn.apply(l.scope||me.obj||window,args)===FALSE){return(me.firing=FALSE);}}}
me.firing=FALSE;return TRUE;}};})();Ext.apply(Ext.util.Observable.prototype,function(){function getMethodEvent(method){var e=(this.methodEvents=this.methodEvents||{})[method],returnValue,v,cancel,obj=this;if(!e){this.methodEvents[method]=e={};e.originalFn=this[method];e.methodName=method;e.before=[];e.after=[];var makeCall=function(fn,scope,args){if((v=fn.apply(scope||obj,args))!==undefined){if(typeof v=='object'){if(v.returnValue!==undefined){returnValue=v.returnValue;}else{returnValue=v;}
cancel=!!v.cancel;}
else
if(v===false){cancel=true;}
else{returnValue=v;}}};this[method]=function(){var args=Array.prototype.slice.call(arguments,0),b;returnValue=v=undefined;cancel=false;for(var i=0,len=e.before.length;i<len;i++){b=e.before[i];makeCall(b.fn,b.scope,args);if(cancel){return returnValue;}}
if((v=e.originalFn.apply(obj,args))!==undefined){returnValue=v;}
for(var i=0,len=e.after.length;i<len;i++){b=e.after[i];makeCall(b.fn,b.scope,args);if(cancel){return returnValue;}}
return returnValue;};}
return e;}
return{beforeMethod:function(method,fn,scope){getMethodEvent.call(this,method).before.push({fn:fn,scope:scope});},afterMethod:function(method,fn,scope){getMethodEvent.call(this,method).after.push({fn:fn,scope:scope});},removeMethodListener:function(method,fn,scope){var e=this.getMethodEvent(method);for(var i=0,len=e.before.length;i<len;i++){if(e.before[i].fn==fn&&e.before[i].scope==scope){e.before.splice(i,1);return;}}
for(var i=0,len=e.after.length;i<len;i++){if(e.after[i].fn==fn&&e.after[i].scope==scope){e.after.splice(i,1);return;}}},relayEvents:function(o,events){var me=this;function createHandler(ename){return function(){return me.fireEvent.apply(me,[ename].concat(Array.prototype.slice.call(arguments,0)));};}
for(var i=0,len=events.length;i<len;i++){var ename=events[i];me.events[ename]=me.events[ename]||true;o.on(ename,createHandler(ename),me);}},enableBubble:function(events){var me=this;if(!Ext.isEmpty(events)){events=Ext.isArray(events)?events:Array.prototype.slice.call(arguments,0);for(var i=0,len=events.length;i<len;i++){var ename=events[i];ename=ename.toLowerCase();var ce=me.events[ename]||true;if(typeof ce=='boolean'){ce=new Ext.util.Event(me,ename);me.events[ename]=ce;}
ce.bubble=true;}}}};}());Ext.util.Observable.capture=function(o,fn,scope){o.fireEvent=o.fireEvent.createInterceptor(fn,scope);};Ext.util.Observable.observeClass=function(c,listeners){if(c){if(!c.fireEvent){Ext.apply(c,new Ext.util.Observable());Ext.util.Observable.capture(c.prototype,c.fireEvent,c);}
if(typeof listeners=='object'){c.on(listeners);}
return c;}};Ext.EventManager=function(){var docReadyEvent,docReadyProcId,docReadyState=false,DETECT_NATIVE=Ext.isGecko||Ext.isWebKit||Ext.isSafari,E=Ext.lib.Event,D=Ext.lib.Dom,DOC=document,WINDOW=window,DOMCONTENTLOADED="DOMContentLoaded",COMPLETE='complete',propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,specialElCache=[];function getId(el){var id=false,i=0,len=specialElCache.length,id=false,skip=false,o;if(el){if(el.getElementById||el.navigator){for(;i<len;++i){o=specialElCache[i];if(o.el===el){id=o.id;break;}}
if(!id){id=Ext.id(el);specialElCache.push({id:id,el:el});skip=true;}}else{id=Ext.id(el);}
if(!Ext.elCache[id]){Ext.Element.addToCache(new Ext.Element(el),id);if(skip){Ext.elCache[id].skipGC=true;}}}
return id;};function addListener(el,ename,fn,task,wrap,scope){el=Ext.getDom(el);var id=getId(el),es=Ext.elCache[id].events,wfn;wfn=E.on(el,ename,wrap);es[ename]=es[ename]||[];es[ename].push([fn,wrap,scope,wfn,task]);if(el.addEventListener&&ename=="mousewheel"){var args=["DOMMouseScroll",wrap,false];el.addEventListener.apply(el,args);Ext.EventManager.addListener(WINDOW,'unload',function(){el.removeEventListener.apply(el,args);});}
if(el==DOC&&ename=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.addListener(wrap);}};function doScrollChk(){if(window!=top){return false;}
try{DOC.documentElement.doScroll('left');}catch(e){return false;}
fireDocReady();return true;}
function checkReadyState(e){if(Ext.isIE&&doScrollChk()){return true;}
if(DOC.readyState==COMPLETE){fireDocReady();return true;}
docReadyState||(docReadyProcId=setTimeout(arguments.callee,2));return false;}
var styles;function checkStyleSheets(e){styles||(styles=Ext.query('style, link[rel=stylesheet]'));if(styles.length==DOC.styleSheets.length){fireDocReady();return true;}
docReadyState||(docReadyProcId=setTimeout(arguments.callee,2));return false;}
function OperaDOMContentLoaded(e){DOC.removeEventListener(DOMCONTENTLOADED,arguments.callee,false);checkStyleSheets();}
function fireDocReady(e){if(!docReadyState){docReadyState=true;if(docReadyProcId){clearTimeout(docReadyProcId);}
if(DETECT_NATIVE){DOC.removeEventListener(DOMCONTENTLOADED,fireDocReady,false);}
if(Ext.isIE&&checkReadyState.bindIE){DOC.detachEvent('onreadystatechange',checkReadyState);}
E.un(WINDOW,"load",arguments.callee);}
if(docReadyEvent&&!Ext.isReady){Ext.isReady=true;docReadyEvent.fire();docReadyEvent.listeners=[];}};function initDocReady(){docReadyEvent||(docReadyEvent=new Ext.util.Event());if(DETECT_NATIVE){DOC.addEventListener(DOMCONTENTLOADED,fireDocReady,false);}
if(Ext.isIE){if(!checkReadyState()){checkReadyState.bindIE=true;DOC.attachEvent('onreadystatechange',checkReadyState);}}else if(Ext.isOpera){(DOC.readyState==COMPLETE&&checkStyleSheets())||DOC.addEventListener(DOMCONTENTLOADED,OperaDOMContentLoaded,false);}else if(Ext.isWebKit){checkReadyState();}
E.on(WINDOW,"load",fireDocReady);};function createTargeted(h,o){return function(){var args=Ext.toArray(arguments);if(o.target==Ext.EventObject.setEvent(args[0]).target){h.apply(this,args);}};};function createBuffered(h,o,task){return function(e){task.delay(o.buffer,h,null,[new Ext.EventObjectImpl(e)]);};};function createSingle(h,el,ename,fn,scope){return function(e){Ext.EventManager.removeListener(el,ename,fn,scope);h(e);};};function createDelayed(h,o,fn){return function(e){var task=new Ext.util.DelayedTask(h);if(!fn.tasks){fn.tasks=[];}
fn.tasks.push(task);task.delay(o.delay||10,h,null,[new Ext.EventObjectImpl(e)]);};};function listen(element,ename,opt,fn,scope){var o=(!opt||typeof opt=="boolean")?{}:opt,el=Ext.getDom(element),task;fn=fn||o.fn;scope=scope||o.scope;if(!el){throw"Error listening for \""+ename+'\". Element "'+element+'" doesn\'t exist.';}
function h(e){if(!Ext){return;}
e=Ext.EventObject.setEvent(e);var t;if(o.delegate){if(!(t=e.getTarget(o.delegate,el))){return;}}else{t=e.target;}
if(o.stopEvent){e.stopEvent();}
if(o.preventDefault){e.preventDefault();}
if(o.stopPropagation){e.stopPropagation();}
if(o.normalized){e=e.browserEvent;}
fn.call(scope||el,e,t,o);};if(o.target){h=createTargeted(h,o);}
if(o.delay){h=createDelayed(h,o,fn);}
if(o.single){h=createSingle(h,el,ename,fn,scope);}
if(o.buffer){task=new Ext.util.DelayedTask(h);h=createBuffered(h,o,task);}
addListener(el,ename,fn,task,h,scope);return h;};var pub={addListener:function(element,eventName,fn,scope,options){if(typeof eventName=='object'){var o=eventName,e,val;for(e in o){val=o[e];if(!propRe.test(e)){if(Ext.isFunction(val)){listen(element,e,o,val,o.scope);}else{listen(element,e,val);}}}}else{listen(element,eventName,options,fn,scope);}},removeListener:function(el,eventName,fn,scope){el=Ext.getDom(el);var id=getId(el),f=el&&(Ext.elCache[id].events)[eventName]||[],wrap,i,l,k,len,fnc;for(i=0,len=f.length;i<len;i++){if(Ext.isArray(fnc=f[i])&&fnc[0]==fn&&(!scope||fnc[2]==scope)){if(fnc[4]){fnc[4].cancel();}
k=fn.tasks&&fn.tasks.length;if(k){while(k--){fn.tasks[k].cancel();}
delete fn.tasks;}
wrap=fnc[1];E.un(el,eventName,E.extAdapter?fnc[3]:wrap);if(wrap&&el.addEventListener&&eventName=="mousewheel"){el.removeEventListener("DOMMouseScroll",wrap,false);}
if(wrap&&el==DOC&&eventName=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap);}
f.splice(i,1);if(f.length===0){delete Ext.elCache[id].events[eventName];}
for(k in Ext.elCache[id].events){return false;}
Ext.elCache[id].events={};return false;}}},removeAll:function(el){el=Ext.getDom(el);var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},f,i,len,ename,fn,k,wrap;for(ename in es){if(es.hasOwnProperty(ename)){f=es[ename];for(i=0,len=f.length;i<len;i++){fn=f[i];if(fn[4]){fn[4].cancel();}
if(fn[0].tasks&&(k=fn[0].tasks.length)){while(k--){fn[0].tasks[k].cancel();}
delete fn.tasks;}
wrap=fn[1];E.un(el,ename,E.extAdapter?fn[3]:wrap);if(el.addEventListener&&wrap&&ename=="mousewheel"){el.removeEventListener("DOMMouseScroll",wrap,false);}
if(wrap&&el==DOC&&ename=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap);}}}}
if(Ext.elCache[id]){Ext.elCache[id].events={};}},getListeners:function(el,eventName){el=Ext.getDom(el);var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},results=[];if(es&&es[eventName]){return es[eventName];}else{return null;}},purgeElement:function(el,recurse,eventName){el=Ext.getDom(el);var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},i,f,len;if(eventName){if(es&&es.hasOwnProperty(eventName)){f=es[eventName];for(i=0,len=f.length;i<len;i++){Ext.EventManager.removeListener(el,eventName,f[i][0]);}}}else{Ext.EventManager.removeAll(el);}
if(recurse&&el&&el.childNodes){for(i=0,len=el.childNodes.length;i<len;i++){Ext.EventManager.purgeElement(el.childNodes[i],recurse,eventName);}}},_unload:function(){var el;for(el in Ext.elCache){Ext.EventManager.removeAll(el);}
delete Ext.elCache;delete Ext.Element._flyweights;var c,conn,tid,ajax=Ext.lib.Ajax;(typeof ajax.conn=='object')?conn=ajax.conn:conn={};for(tid in conn){c=conn[tid];if(c){ajax.abort({conn:c,tId:tid});}}},onDocumentReady:function(fn,scope,options){if(Ext.isReady){docReadyEvent||(docReadyEvent=new Ext.util.Event());docReadyEvent.addListener(fn,scope,options);docReadyEvent.fire();docReadyEvent.listeners=[];}else{if(!docReadyEvent){initDocReady();}
options=options||{};options.delay=options.delay||1;docReadyEvent.addListener(fn,scope,options);}},fireDocReady:fireDocReady};pub.on=pub.addListener;pub.un=pub.removeListener;pub.stoppedMouseDownEvent=new Ext.util.Event();return pub;}();Ext.onReady=Ext.EventManager.onDocumentReady;(function(){var initExtCss=function(){var bd=document.body||document.getElementsByTagName('body')[0];if(!bd){return false;}
var cls=[' ',Ext.isIE?"ext-ie "+(Ext.isIE6?'ext-ie6':(Ext.isIE7?'ext-ie7':'ext-ie8')):Ext.isGecko?"ext-gecko "+(Ext.isGecko2?'ext-gecko2':'ext-gecko3'):Ext.isOpera?"ext-opera":Ext.isWebKit?"ext-webkit":""];if(Ext.isSafari){cls.push("ext-safari "+(Ext.isSafari2?'ext-safari2':(Ext.isSafari3?'ext-safari3':'ext-safari4')));}else if(Ext.isChrome){cls.push("ext-chrome");}
if(Ext.isMac){cls.push("ext-mac");}
if(Ext.isLinux){cls.push("ext-linux");}
if(Ext.isStrict||Ext.isBorderBox){var p=bd.parentNode;if(p){p.className+=Ext.isStrict?' ext-strict':' ext-border-box';}}
bd.className+=cls.join(' ');return true;}
if(!initExtCss()){Ext.onReady(initExtCss);}})();Ext.EventObject=function(){var E=Ext.lib.Event,safariKeys={3:13,63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},btnMap=Ext.isIE?{1:0,4:1,2:2}:(Ext.isWebKit?{1:0,2:1,3:2}:{0:0,1:1,2:2});Ext.EventObjectImpl=function(e){if(e){this.setEvent(e.browserEvent||e);}};Ext.EventObjectImpl.prototype={setEvent:function(e){var me=this;if(e==me||(e&&e.browserEvent)){return e;}
me.browserEvent=e;if(e){me.button=e.button?btnMap[e.button]:(e.which?e.which-1:-1);if(e.type=='click'&&me.button==-1){me.button=0;}
me.type=e.type;me.shiftKey=e.shiftKey;me.ctrlKey=e.ctrlKey||e.metaKey||false;me.altKey=e.altKey;me.keyCode=e.keyCode;me.charCode=e.charCode;me.target=E.getTarget(e);me.xy=E.getXY(e);}else{me.button=-1;me.shiftKey=false;me.ctrlKey=false;me.altKey=false;me.keyCode=0;me.charCode=0;me.target=null;me.xy=[0,0];}
return me;},stopEvent:function(){var me=this;if(me.browserEvent){if(me.browserEvent.type=='mousedown'){Ext.EventManager.stoppedMouseDownEvent.fire(me);}
E.stopEvent(me.browserEvent);}},preventDefault:function(){if(this.browserEvent){E.preventDefault(this.browserEvent);}},stopPropagation:function(){var me=this;if(me.browserEvent){if(me.browserEvent.type=='mousedown'){Ext.EventManager.stoppedMouseDownEvent.fire(me);}
E.stopPropagation(me.browserEvent);}},getCharCode:function(){return this.charCode||this.keyCode;},getKey:function(){return this.normalizeKey(this.keyCode||this.charCode)},normalizeKey:function(k){return Ext.isSafari?(safariKeys[k]||k):k;},getPageX:function(){return this.xy[0];},getPageY:function(){return this.xy[1];},getXY:function(){return this.xy;},getTarget:function(selector,maxDepth,returnEl){return selector?Ext.fly(this.target).findParent(selector,maxDepth,returnEl):(returnEl?Ext.get(this.target):this.target);},getRelatedTarget:function(){return this.browserEvent?E.getRelatedTarget(this.browserEvent):null;},getWheelDelta:function(){var e=this.browserEvent;var delta=0;if(e.wheelDelta){delta=e.wheelDelta/120;}else if(e.detail){delta=-e.detail/3;}
return delta;},within:function(el,related,allowEl){if(el){var t=this[related?"getRelatedTarget":"getTarget"]();return t&&((allowEl?(t==Ext.getDom(el)):false)||Ext.fly(el).contains(t));}
return false;}};return new Ext.EventObjectImpl();}();Ext.apply(Ext.EventManager,function(){var resizeEvent,resizeTask,textEvent,textSize,D=Ext.lib.Dom,propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,curWidth=0,curHeight=0,useKeydown=Ext.isWebKit?Ext.num(navigator.userAgent.match(/AppleWebKit\/(\d+)/)[1])>=525:!((Ext.isGecko&&!Ext.isWindows)||Ext.isOpera);return{doResizeEvent:function(){var h=D.getViewHeight(),w=D.getViewWidth();if(curHeight!=h||curWidth!=w){resizeEvent.fire(curWidth=w,curHeight=h);}},onWindowResize:function(fn,scope,options){if(!resizeEvent){resizeEvent=new Ext.util.Event();resizeTask=new Ext.util.DelayedTask(this.doResizeEvent);Ext.EventManager.on(window,"resize",this.fireWindowResize,this);}
resizeEvent.addListener(fn,scope,options);},fireWindowResize:function(){if(resizeEvent){resizeTask.delay(100);}},onTextResize:function(fn,scope,options){if(!textEvent){textEvent=new Ext.util.Event();var textEl=new Ext.Element(document.createElement('div'));textEl.dom.className='x-text-resize';textEl.dom.innerHTML='X';textEl.appendTo(document.body);textSize=textEl.dom.offsetHeight;setInterval(function(){if(textEl.dom.offsetHeight!=textSize){textEvent.fire(textSize,textSize=textEl.dom.offsetHeight);}},this.textResizeInterval);}
textEvent.addListener(fn,scope,options);},removeResizeListener:function(fn,scope){if(resizeEvent){resizeEvent.removeListener(fn,scope);}},fireResize:function(){if(resizeEvent){resizeEvent.fire(D.getViewWidth(),D.getViewHeight());}},textResizeInterval:50,ieDeferSrc:false,useKeydown:useKeydown};}());Ext.EventManager.on=Ext.EventManager.addListener;Ext.apply(Ext.EventObjectImpl.prototype,{BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGEUP:33,PAGE_DOWN:34,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,isNavKeyPress:function(){var me=this,k=this.normalizeKey(me.keyCode);return(k>=33&&k<=40)||k==me.RETURN||k==me.TAB||k==me.ESC;},isSpecialKey:function(){var k=this.normalizeKey(this.keyCode);return(this.type=='keypress'&&this.ctrlKey)||this.isNavKeyPress()||(k==this.BACKSPACE)||(k>=16&&k<=20)||(k>=44&&k<=46);},getPoint:function(){return new Ext.lib.Point(this.xy[0],this.xy[1]);},hasModifier:function(){return((this.ctrlKey||this.altKey)||this.shiftKey);}});(function(){var DOC=document;Ext.Element=function(element,forceNew){var dom=typeof element=="string"?DOC.getElementById(element):element,id;if(!dom)return null;id=dom.id;if(!forceNew&&id&&Ext.elCache[id]){return Ext.elCache[id].el;}
this.dom=dom;this.id=id||Ext.id(dom);};var D=Ext.lib.Dom,DH=Ext.DomHelper,E=Ext.lib.Event,A=Ext.lib.Anim,El=Ext.Element,EC=Ext.elCache;El.prototype={set:function(o,useSet){var el=this.dom,attr,val,useSet=(useSet!==false)&&!!el.setAttribute;for(attr in o){if(o.hasOwnProperty(attr)){val=o[attr];if(attr=='style'){DH.applyStyles(el,val);}else if(attr=='cls'){el.className=val;}else if(useSet){el.setAttribute(attr,val);}else{el[attr]=val;}}}
return this;},defaultUnit:"px",is:function(simpleSelector){return Ext.DomQuery.is(this.dom,simpleSelector);},focus:function(defer,dom){var me=this,dom=dom||me.dom;try{if(Number(defer)){me.focus.defer(defer,null,[null,dom]);}else{dom.focus();}}catch(e){}
return me;},blur:function(){try{this.dom.blur();}catch(e){}
return this;},getValue:function(asNumber){var val=this.dom.value;return asNumber?parseInt(val,10):val;},addListener:function(eventName,fn,scope,options){Ext.EventManager.on(this.dom,eventName,fn,scope||this,options);return this;},removeListener:function(eventName,fn,scope){Ext.EventManager.removeListener(this.dom,eventName,fn,scope||this);return this;},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);return this;},purgeAllListeners:function(){Ext.EventManager.purgeElement(this,true);return this;},addUnits:function(size){if(size===""||size=="auto"||size===undefined){size=size||'';}else if(!isNaN(size)||!unitPattern.test(size)){size=size+(this.defaultUnit||'px');}
return size;},load:function(url,params,cb){Ext.Ajax.request(Ext.apply({params:params,url:url.url||url,callback:cb,el:this.dom,indicatorText:url.indicatorText||''},Ext.isObject(url)?url:{}));return this;},isBorderBox:function(){return noBoxAdjust[(this.dom.tagName||"").toLowerCase()]||Ext.isBorderBox;},remove:function(){var me=this,dom=me.dom;if(dom){delete me.dom;Ext.removeNode(dom);}},hover:function(overFn,outFn,scope,options){var me=this;me.on('mouseenter',overFn,scope||me.dom,options);me.on('mouseleave',outFn,scope||me.dom,options);return me;},contains:function(el){return!el?false:Ext.lib.Dom.isAncestor(this.dom,el.dom?el.dom:el);},getAttributeNS:function(ns,name){return this.getAttribute(name,ns);},getAttribute:Ext.isIE?function(name,ns){var d=this.dom,type=typeof d[ns+":"+name];if(['undefined','unknown'].indexOf(type)==-1){return d[ns+":"+name];}
return d[name];}:function(name,ns){var d=this.dom;return d.getAttributeNS(ns,name)||d.getAttribute(ns+":"+name)||d.getAttribute(name)||d[name];},update:function(html){if(this.dom){this.dom.innerHTML=html;}
return this;}};var ep=El.prototype;El.addMethods=function(o){Ext.apply(ep,o);};ep.on=ep.addListener;ep.un=ep.removeListener;ep.autoBoxAdjust=true;var unitPattern=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,docEl;El.get=function(el){var ex,elm,id;if(!el){return null;}
if(typeof el=="string"){if(!(elm=DOC.getElementById(el))){return null;}
if(EC[el]&&EC[el].el){ex=EC[el].el;ex.dom=elm;}else{ex=El.addToCache(new El(elm));}
return ex;}else if(el.tagName){if(!(id=el.id)){id=Ext.id(el);}
if(EC[id]&&EC[id].el){ex=EC[id].el;ex.dom=el;}else{ex=El.addToCache(new El(el));}
return ex;}else if(el instanceof El){if(el!=docEl){if(Ext.isIE&&(el.id==undefined||el.id=='')){el.dom=el.dom;}else{el.dom=DOC.getElementById(el.id)||el.dom;}}
return el;}else if(el.isComposite){return el;}else if(Ext.isArray(el)){return El.select(el);}else if(el==DOC){if(!docEl){var f=function(){};f.prototype=El.prototype;docEl=new f();docEl.dom=DOC;}
return docEl;}
return null;};El.addToCache=function(el,id){id=id||el.id;EC[id]={el:el,data:{},events:{}};return el;};El.data=function(el,key,value){el=El.get(el);if(!el){return null;}
var c=EC[el.id].data;if(arguments.length==2){return c[key];}else{return(c[key]=value);}};function garbageCollect(){if(!Ext.enableGarbageCollector){clearInterval(El.collectorThreadId);}else{var eid,el,d,o;for(eid in EC){o=EC[eid];if(o.skipGC){continue;}
el=o.el;d=el.dom;if(!d||!d.parentNode||(!d.offsetParent&&!DOC.getElementById(eid))){if(Ext.enableListenerCollection){Ext.EventManager.removeAll(d);}
delete EC[eid];}}
if(Ext.isIE){var t={};for(eid in EC){t[eid]=EC[eid];}
EC=Ext.elCache=t;}}}
El.collectorThreadId=setInterval(garbageCollect,30000);var flyFn=function(){};flyFn.prototype=El.prototype;El.Flyweight=function(dom){this.dom=dom;};El.Flyweight.prototype=new flyFn();El.Flyweight.prototype.isFlyweight=true;El._flyweights={};El.fly=function(el,named){var ret=null;named=named||'_global';if(el=Ext.getDom(el)){(El._flyweights[named]=El._flyweights[named]||new El.Flyweight()).dom=el;ret=El._flyweights[named];}
return ret;};Ext.get=El.get;Ext.fly=El.fly;var noBoxAdjust=Ext.isStrict?{select:1}:{input:1,select:1,textarea:1};if(Ext.isIE||Ext.isGecko){noBoxAdjust['button']=1;}})();Ext.Element.addMethods({swallowEvent:function(eventName,preventDefault){var me=this;function fn(e){e.stopPropagation();if(preventDefault){e.preventDefault();}}
if(Ext.isArray(eventName)){Ext.each(eventName,function(e){me.on(e,fn);});return me;}
me.on(eventName,fn);return me;},relayEvent:function(eventName,observable){this.on(eventName,function(e){observable.fireEvent(eventName,e);});},clean:function(forceReclean){var me=this,dom=me.dom,n=dom.firstChild,ni=-1;if(Ext.Element.data(dom,'isCleaned')&&forceReclean!==true){return me;}
while(n){var nx=n.nextSibling;if(n.nodeType==3&&!/\S/.test(n.nodeValue)){dom.removeChild(n);}else{n.nodeIndex=++ni;}
n=nx;}
Ext.Element.data(dom,'isCleaned',true);return me;},load:function(){var um=this.getUpdater();um.update.apply(um,arguments);return this;},getUpdater:function(){return this.updateManager||(this.updateManager=new Ext.Updater(this));},update:function(html,loadScripts,callback){if(!this.dom){return this;}
html=html||"";if(loadScripts!==true){this.dom.innerHTML=html;if(typeof callback=='function'){callback();}
return this;}
var id=Ext.id(),dom=this.dom;html+='<span id="'+id+'"></span>';Ext.lib.Event.onAvailable(id,function(){var DOC=document,hd=DOC.getElementsByTagName("head")[0],re=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig,srcRe=/\ssrc=([\'\"])(.*?)\1/i,typeRe=/\stype=([\'\"])(.*?)\1/i,match,attrs,srcMatch,typeMatch,el,s;while((match=re.exec(html))){attrs=match[1];srcMatch=attrs?attrs.match(srcRe):false;if(srcMatch&&srcMatch[2]){s=DOC.createElement("script");s.src=srcMatch[2];typeMatch=attrs.match(typeRe);if(typeMatch&&typeMatch[2]){s.type=typeMatch[2];}
hd.appendChild(s);}else if(match[2]&&match[2].length>0){if(window.execScript){window.execScript(match[2]);}else{window.eval(match[2]);}}}
el=DOC.getElementById(id);if(el){Ext.removeNode(el);}
if(typeof callback=='function'){callback();}});dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"");return this;},removeAllListeners:function(){this.removeAnchor();Ext.EventManager.removeAll(this.dom);return this;},createProxy:function(config,renderTo,matchBox){config=(typeof config=='object')?config:{tag:"div",cls:config};var me=this,proxy=renderTo?Ext.DomHelper.append(renderTo,config,true):Ext.DomHelper.insertBefore(me.dom,config,true);if(matchBox&&me.setBox&&me.getBox){proxy.setBox(me.getBox());}
return proxy;}});Ext.Element.prototype.getUpdateManager=Ext.Element.prototype.getUpdater;Ext.Element.addMethods({getAnchorXY:function(anchor,local,s){anchor=(anchor||"tl").toLowerCase();s=s||{};var me=this,vp=me.dom==document.body||me.dom==document,w=s.width||vp?Ext.lib.Dom.getViewWidth():me.getWidth(),h=s.height||vp?Ext.lib.Dom.getViewHeight():me.getHeight(),xy,r=Math.round,o=me.getXY(),scroll=me.getScroll(),extraX=vp?scroll.left:!local?o[0]:0,extraY=vp?scroll.top:!local?o[1]:0,hash={c:[r(w*0.5),r(h*0.5)],t:[r(w*0.5),0],l:[0,r(h*0.5)],r:[w,r(h*0.5)],b:[r(w*0.5),h],tl:[0,0],bl:[0,h],br:[w,h],tr:[w,0]};xy=hash[anchor];return[xy[0]+extraX,xy[1]+extraY];},anchorTo:function(el,alignment,offsets,animate,monitorScroll,callback){var me=this,dom=me.dom,scroll=!Ext.isEmpty(monitorScroll),action=function(){Ext.fly(dom).alignTo(el,alignment,offsets,animate);Ext.callback(callback,Ext.fly(dom));},anchor=this.getAnchor();this.removeAnchor();Ext.apply(anchor,{fn:action,scroll:scroll});Ext.EventManager.onWindowResize(action,null);if(scroll){Ext.EventManager.on(window,'scroll',action,null,{buffer:!isNaN(monitorScroll)?monitorScroll:50});}
action.call(me);return me;},removeAnchor:function(){var me=this,anchor=this.getAnchor();if(anchor&&anchor.fn){Ext.EventManager.removeResizeListener(anchor.fn);if(anchor.scroll){Ext.EventManager.un(window,'scroll',anchor.fn);}
delete anchor.fn;}
return me;},getAnchor:function(){var data=Ext.Element.data,dom=this.dom;if(!dom){return;}
var anchor=data(dom,'_anchor');if(!anchor){anchor=data(dom,'_anchor',{});}
return anchor;},getAlignToXY:function(el,p,o){el=Ext.get(el);if(!el||!el.dom){throw"Element.alignToXY with an element that doesn't exist";}
o=o||[0,0];p=(!p||p=="?"?"tl-bl?":(!/-/.test(p)&&p!==""?"tl-"+p:p||"tl-bl")).toLowerCase();var me=this,d=me.dom,a1,a2,x,y,w,h,r,dw=Ext.lib.Dom.getViewWidth()-10,dh=Ext.lib.Dom.getViewHeight()-10,p1y,p1x,p2y,p2x,swapY,swapX,doc=document,docElement=doc.documentElement,docBody=doc.body,scrollX=(docElement.scrollLeft||docBody.scrollLeft||0)+5,scrollY=(docElement.scrollTop||docBody.scrollTop||0)+5,c=false,p1="",p2="",m=p.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){throw"Element.alignTo with an invalid alignment "+p;}
p1=m[1];p2=m[2];c=!!m[3];a1=me.getAnchorXY(p1,true);a2=el.getAnchorXY(p2,false);x=a2[0]-a1[0]+o[0];y=a2[1]-a1[1]+o[1];if(c){w=me.getWidth();h=me.getHeight();r=el.getRegion();p1y=p1.charAt(0);p1x=p1.charAt(p1.length-1);p2y=p2.charAt(0);p2x=p2.charAt(p2.length-1);swapY=((p1y=="t"&&p2y=="b")||(p1y=="b"&&p2y=="t"));swapX=((p1x=="r"&&p2x=="l")||(p1x=="l"&&p2x=="r"));if(x+w>dw+scrollX){x=swapX?r.left-w:dw+scrollX-w;}
if(x<scrollX){x=swapX?r.right:scrollX;}
if(y+h>dh+scrollY){y=swapY?r.top-h:dh+scrollY-h;}
if(y<scrollY){y=swapY?r.bottom:scrollY;}}
return[x,y];},alignTo:function(element,position,offsets,animate){var me=this;return me.setXY(me.getAlignToXY(element,position,offsets),me.preanim&&!!animate?me.preanim(arguments,3):false);},adjustForConstraints:function(xy,parent,offsets){return this.getConstrainToXY(parent||document,false,offsets,xy)||xy;},getConstrainToXY:function(el,local,offsets,proposedXY){var os={top:0,left:0,bottom:0,right:0};return function(el,local,offsets,proposedXY){el=Ext.get(el);offsets=offsets?Ext.applyIf(offsets,os):os;var vw,vh,vx=0,vy=0;if(el.dom==document.body||el.dom==document){vw=Ext.lib.Dom.getViewWidth();vh=Ext.lib.Dom.getViewHeight();}else{vw=el.dom.clientWidth;vh=el.dom.clientHeight;if(!local){var vxy=el.getXY();vx=vxy[0];vy=vxy[1];}}
var s=el.getScroll();vx+=offsets.left+s.left;vy+=offsets.top+s.top;vw-=offsets.right;vh-=offsets.bottom;var vr=vx+vw;var vb=vy+vh;var xy=proposedXY||(!local?this.getXY():[this.getLeft(true),this.getTop(true)]);var x=xy[0],y=xy[1];var w=this.dom.offsetWidth,h=this.dom.offsetHeight;var moved=false;if((x+w)>vr){x=vr-w;moved=true;}
if((y+h)>vb){y=vb-h;moved=true;}
if(x<vx){x=vx;moved=true;}
if(y<vy){y=vy;moved=true;}
return moved?[x,y]:false;};}(),getCenterXY:function(){return this.getAlignToXY(document,'c-c');},center:function(centerIn){return this.alignTo(centerIn||document,'c-c');}});Ext.Element.addMethods(function(){var PARENTNODE='parentNode',NEXTSIBLING='nextSibling',PREVIOUSSIBLING='previousSibling',DQ=Ext.DomQuery,GET=Ext.get;return{findParent:function(simpleSelector,maxDepth,returnEl){var p=this.dom,b=document.body,depth=0,stopEl;if(Ext.isGecko&&Object.prototype.toString.call(p)=='[object XULElement]'){return null;}
maxDepth=maxDepth||50;if(isNaN(maxDepth)){stopEl=Ext.getDom(maxDepth);maxDepth=Number.MAX_VALUE;}
while(p&&p.nodeType==1&&depth<maxDepth&&p!=b&&p!=stopEl){if(DQ.is(p,simpleSelector)){return returnEl?GET(p):p;}
depth++;p=p.parentNode;}
return null;},findParentNode:function(simpleSelector,maxDepth,returnEl){var p=Ext.fly(this.dom.parentNode,'_internal');return p?p.findParent(simpleSelector,maxDepth,returnEl):null;},up:function(simpleSelector,maxDepth){return this.findParentNode(simpleSelector,maxDepth,true);},select:function(selector){return Ext.Element.select(selector,this.dom);},query:function(selector){return DQ.select(selector,this.dom);},child:function(selector,returnDom){var n=DQ.selectNode(selector,this.dom);return returnDom?n:GET(n);},down:function(selector,returnDom){var n=DQ.selectNode(" > "+selector,this.dom);return returnDom?n:GET(n);},parent:function(selector,returnDom){return this.matchNode(PARENTNODE,PARENTNODE,selector,returnDom);},next:function(selector,returnDom){return this.matchNode(NEXTSIBLING,NEXTSIBLING,selector,returnDom);},prev:function(selector,returnDom){return this.matchNode(PREVIOUSSIBLING,PREVIOUSSIBLING,selector,returnDom);},first:function(selector,returnDom){return this.matchNode(NEXTSIBLING,'firstChild',selector,returnDom);},last:function(selector,returnDom){return this.matchNode(PREVIOUSSIBLING,'lastChild',selector,returnDom);},matchNode:function(dir,start,selector,returnDom){var n=this.dom[start];while(n){if(n.nodeType==1&&(!selector||DQ.is(n,selector))){return!returnDom?GET(n):n;}
n=n[dir];}
return null;}}}());Ext.Element.addMethods({select:function(selector,unique){return Ext.Element.select(selector,unique,this.dom);}});Ext.Element.addMethods(function(){var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;return{appendChild:function(el){return GET(el).appendTo(this);},appendTo:function(el){GETDOM(el).appendChild(this.dom);return this;},insertBefore:function(el){(el=GETDOM(el)).parentNode.insertBefore(this.dom,el);return this;},insertAfter:function(el){(el=GETDOM(el)).parentNode.insertBefore(this.dom,el.nextSibling);return this;},insertFirst:function(el,returnDom){el=el||{};if(el.nodeType||el.dom||typeof el=='string'){el=GETDOM(el);this.dom.insertBefore(el,this.dom.firstChild);return!returnDom?GET(el):el;}else{return this.createChild(el,this.dom.firstChild,returnDom);}},replace:function(el){el=GET(el);this.insertBefore(el);el.remove();return this;},replaceWith:function(el){var me=this;if(el.nodeType||el.dom||typeof el=='string'){el=GETDOM(el);me.dom.parentNode.insertBefore(el,me.dom);}else{el=DH.insertBefore(me.dom,el);}
delete Ext.elCache[me.id];Ext.removeNode(me.dom);me.id=Ext.id(me.dom=el);Ext.Element.addToCache(me.isFlyweight?new Ext.Element(me.dom):me);return me;},createChild:function(config,insertBefore,returnDom){config=config||{tag:'div'};return insertBefore?DH.insertBefore(insertBefore,config,returnDom!==true):DH[!this.dom.firstChild?'overwrite':'append'](this.dom,config,returnDom!==true);},wrap:function(config,returnDom){var newEl=DH.insertBefore(this.dom,config||{tag:"div"},!returnDom);newEl.dom?newEl.dom.appendChild(this.dom):newEl.appendChild(this.dom);return newEl;},insertHtml:function(where,html,returnEl){var el=DH.insertHtml(where,this.dom,html);return returnEl?Ext.get(el):el;}}}());Ext.apply(Ext.Element.prototype,function(){var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;return{insertSibling:function(el,where,returnDom){var me=this,rt,isAfter=(where||'before').toLowerCase()=='after',insertEl;if(Ext.isArray(el)){insertEl=me;Ext.each(el,function(e){rt=Ext.fly(insertEl,'_internal').insertSibling(e,where,returnDom);if(isAfter){insertEl=rt;}});return rt;}
el=el||{};if(el.nodeType||el.dom){rt=me.dom.parentNode.insertBefore(GETDOM(el),isAfter?me.dom.nextSibling:me.dom);if(!returnDom){rt=GET(rt);}}else{if(isAfter&&!me.dom.nextSibling){rt=DH.append(me.dom.parentNode,el,!returnDom);}else{rt=DH[isAfter?'insertAfter':'insertBefore'](me.dom,el,!returnDom);}}
return rt;}};}());Ext.Element.addMethods(function(){var propCache={},camelRe=/(-[a-z])/gi,classReCache={},view=document.defaultView,propFloat=Ext.isIE?'styleFloat':'cssFloat',opacityRe=/alpha\(opacity=(.*)\)/i,trimRe=/^\s+|\s+$/g,spacesRe=/\s+/,wordsRe=/\w/g,EL=Ext.Element,PADDING="padding",MARGIN="margin",BORDER="border",LEFT="-left",RIGHT="-right",TOP="-top",BOTTOM="-bottom",WIDTH="-width",MATH=Math,HIDDEN='hidden',ISCLIPPED='isClipped',OVERFLOW='overflow',OVERFLOWX='overflow-x',OVERFLOWY='overflow-y',ORIGINALCLIP='originalClip',borders={l:BORDER+LEFT+WIDTH,r:BORDER+RIGHT+WIDTH,t:BORDER+TOP+WIDTH,b:BORDER+BOTTOM+WIDTH},paddings={l:PADDING+LEFT,r:PADDING+RIGHT,t:PADDING+TOP,b:PADDING+BOTTOM},margins={l:MARGIN+LEFT,r:MARGIN+RIGHT,t:MARGIN+TOP,b:MARGIN+BOTTOM},data=Ext.Element.data;function camelFn(m,a){return a.charAt(1).toUpperCase();}
function chkCache(prop){return propCache[prop]||(propCache[prop]=prop=='float'?propFloat:prop.replace(camelRe,camelFn));}
return{adjustWidth:function(width){var me=this;var isNum=(typeof width=="number");if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){width-=(me.getBorderWidth("lr")+me.getPadding("lr"));}
return(isNum&&width<0)?0:width;},adjustHeight:function(height){var me=this;var isNum=(typeof height=="number");if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){height-=(me.getBorderWidth("tb")+me.getPadding("tb"));}
return(isNum&&height<0)?0:height;},addClass:function(className){var me=this,i,len,v,cls=[];if(!Ext.isArray(className)){if(typeof className=='string'&&!this.hasClass(className)){me.dom.className+=" "+className;}}
else{for(i=0,len=className.length;i<len;i++){v=className[i];if(typeof v=='string'&&(' '+me.dom.className+' ').indexOf(' '+v+' ')==-1){cls.push(v);}}
if(cls.length){me.dom.className+=" "+cls.join(" ");}}
return me;},removeClass:function(className){var me=this,i,idx,len,cls,elClasses;if(!Ext.isArray(className)){className=[className];}
if(me.dom&&me.dom.className){elClasses=me.dom.className.replace(trimRe,'').split(spacesRe);for(i=0,len=className.length;i<len;i++){cls=className[i];if(typeof cls=='string'){cls=cls.replace(trimRe,'');idx=elClasses.indexOf(cls);if(idx!=-1){elClasses.splice(idx,1);}}}
me.dom.className=elClasses.join(" ");}
return me;},radioClass:function(className){var cn=this.dom.parentNode.childNodes,v,i,len;className=Ext.isArray(className)?className:[className];for(i=0,len=cn.length;i<len;i++){v=cn[i];if(v&&v.nodeType==1){Ext.fly(v,'_internal').removeClass(className);}};return this.addClass(className);},toggleClass:function(className){return this.hasClass(className)?this.removeClass(className):this.addClass(className);},hasClass:function(className){return className&&(' '+this.dom.className+' ').indexOf(' '+className+' ')!=-1;},replaceClass:function(oldClassName,newClassName){return this.removeClass(oldClassName).addClass(newClassName);},isStyle:function(style,val){return this.getStyle(style)==val;},getStyle:function(){return view&&view.getComputedStyle?function(prop){var el=this.dom,v,cs,out,display,wk=Ext.isWebKit,display;if(el==document){return null;}
prop=chkCache(prop);if(wk&&/marginRight/.test(prop)){display=this.getStyle('display');el.style.display='inline-block';}
out=(v=el.style[prop])?v:(cs=view.getComputedStyle(el,""))?cs[prop]:null;if(wk){if(out=='rgba(0, 0, 0, 0)'){out='transparent';}else if(display){el.style.display=display;}}
return out;}:function(prop){var el=this.dom,m,cs;if(el==document)return null;if(prop=='opacity'){if(el.style.filter.match){if(m=el.style.filter.match(opacityRe)){var fv=parseFloat(m[1]);if(!isNaN(fv)){return fv?fv/100:0;}}}
return 1;}
prop=chkCache(prop);return el.style[prop]||((cs=el.currentStyle)?cs[prop]:null);};}(),getColor:function(attr,defaultValue,prefix){var v=this.getStyle(attr),color=(typeof prefix!='undefined')?prefix:'#',h;if(!v||/transparent|inherit/.test(v)){return defaultValue;}
if(/^r/.test(v)){Ext.each(v.slice(4,v.length-1).split(','),function(s){h=parseInt(s,10);color+=(h<16?'0':'')+h.toString(16);});}else{v=v.replace('#','');color+=v.length==3?v.replace(/^(\w)(\w)(\w)$/,'$1$1$2$2$3$3'):v;}
return(color.length>5?color.toLowerCase():defaultValue);},setStyle:function(prop,value){var tmp,style,camel;if(typeof prop!='object'){tmp={};tmp[prop]=value;prop=tmp;}
for(style in prop){value=prop[style];style=='opacity'?this.setOpacity(value):this.dom.style[chkCache(style)]=value;}
return this;},setOpacity:function(opacity,animate){var me=this,s=me.dom.style;if(!animate||!me.anim){if(Ext.isIE){var opac=opacity<1?'alpha(opacity='+opacity*100+')':'',val=s.filter.replace(opacityRe,'').replace(trimRe,'');s.zoom=1;s.filter=val+(val.length>0?' ':'')+opac;}else{s.opacity=opacity;}}else{me.anim({opacity:{to:opacity}},me.preanim(arguments,1),null,.35,'easeIn');}
return me;},clearOpacity:function(){var style=this.dom.style;if(Ext.isIE){if(!Ext.isEmpty(style.filter)){style.filter=style.filter.replace(opacityRe,'').replace(trimRe,'');}}else{style.opacity=style['-moz-opacity']=style['-khtml-opacity']='';}
return this;},getHeight:function(contentHeight){var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle('display','none'),h=MATH.max(dom.offsetHeight,hidden?0:dom.clientHeight)||0;h=!contentHeight?h:h-me.getBorderWidth("tb")-me.getPadding("tb");return h<0?0:h;},getWidth:function(contentWidth){var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle('display','none'),w=MATH.max(dom.offsetWidth,hidden?0:dom.clientWidth)||0;w=!contentWidth?w:w-me.getBorderWidth("lr")-me.getPadding("lr");return w<0?0:w;},setWidth:function(width,animate){var me=this;width=me.adjustWidth(width);!animate||!me.anim?me.dom.style.width=me.addUnits(width):me.anim({width:{to:width}},me.preanim(arguments,1));return me;},setHeight:function(height,animate){var me=this;height=me.adjustHeight(height);!animate||!me.anim?me.dom.style.height=me.addUnits(height):me.anim({height:{to:height}},me.preanim(arguments,1));return me;},getBorderWidth:function(side){return this.addStyles(side,borders);},getPadding:function(side){return this.addStyles(side,paddings);},clip:function(){var me=this,dom=me.dom;if(!data(dom,ISCLIPPED)){data(dom,ISCLIPPED,true);data(dom,ORIGINALCLIP,{o:me.getStyle(OVERFLOW),x:me.getStyle(OVERFLOWX),y:me.getStyle(OVERFLOWY)});me.setStyle(OVERFLOW,HIDDEN);me.setStyle(OVERFLOWX,HIDDEN);me.setStyle(OVERFLOWY,HIDDEN);}
return me;},unclip:function(){var me=this,dom=me.dom;if(data(dom,ISCLIPPED)){data(dom,ISCLIPPED,false);var o=data(dom,ORIGINALCLIP);if(o.o){me.setStyle(OVERFLOW,o.o);}
if(o.x){me.setStyle(OVERFLOWX,o.x);}
if(o.y){me.setStyle(OVERFLOWY,o.y);}}
return me;},addStyles:function(sides,styles){var ttlSize=0,sidesArr=sides.match(wordsRe),side,size,i,len=sidesArr.length;for(i=0;i<len;i++){side=sidesArr[i];size=side&&parseInt(this.getStyle(styles[side]),10);if(size){ttlSize+=MATH.abs(size);}}
return ttlSize;},margins:margins}}());Ext.Element.boxMarkup='<div class="{0}-tl"><div class="{0}-tr"><div class="{0}-tc"></div></div></div><div class="{0}-ml"><div class="{0}-mr"><div class="{0}-mc"></div></div></div><div class="{0}-bl"><div class="{0}-br"><div class="{0}-bc"></div></div></div>';Ext.Element.addMethods(function(){var INTERNAL="_internal",pxMatch=/(\d+\.?\d+)px/;return{applyStyles:function(style){Ext.DomHelper.applyStyles(this.dom,style);return this;},getStyles:function(){var ret={};Ext.each(arguments,function(v){ret[v]=this.getStyle(v);},this);return ret;},setOverflow:function(v){var dom=this.dom;if(v=='auto'&&Ext.isMac&&Ext.isGecko2){dom.style.overflow='hidden';(function(){dom.style.overflow='auto';}).defer(1);}else{dom.style.overflow=v;}},boxWrap:function(cls){cls=cls||'x-box';var el=Ext.get(this.insertHtml("beforeBegin","<div class='"+cls+"'>"+String.format(Ext.Element.boxMarkup,cls)+"</div>"));Ext.DomQuery.selectNode('.'+cls+'-mc',el.dom).appendChild(this.dom);return el;},setSize:function(width,height,animate){var me=this;if(typeof width=='object'){height=width.height;width=width.width;}
width=me.adjustWidth(width);height=me.adjustHeight(height);if(!animate||!me.anim){me.dom.style.width=me.addUnits(width);me.dom.style.height=me.addUnits(height);}else{me.anim({width:{to:width},height:{to:height}},me.preanim(arguments,2));}
return me;},getComputedHeight:function(){var me=this,h=Math.max(me.dom.offsetHeight,me.dom.clientHeight);if(!h){h=parseFloat(me.getStyle('height'))||0;if(!me.isBorderBox()){h+=me.getFrameWidth('tb');}}
return h;},getComputedWidth:function(){var w=Math.max(this.dom.offsetWidth,this.dom.clientWidth);if(!w){w=parseFloat(this.getStyle('width'))||0;if(!this.isBorderBox()){w+=this.getFrameWidth('lr');}}
return w;},getFrameWidth:function(sides,onlyContentBox){return onlyContentBox&&this.isBorderBox()?0:(this.getPadding(sides)+this.getBorderWidth(sides));},addClassOnOver:function(className){this.hover(function(){Ext.fly(this,INTERNAL).addClass(className);},function(){Ext.fly(this,INTERNAL).removeClass(className);});return this;},addClassOnFocus:function(className){this.on("focus",function(){Ext.fly(this,INTERNAL).addClass(className);},this.dom);this.on("blur",function(){Ext.fly(this,INTERNAL).removeClass(className);},this.dom);return this;},addClassOnClick:function(className){var dom=this.dom;this.on("mousedown",function(){Ext.fly(dom,INTERNAL).addClass(className);var d=Ext.getDoc(),fn=function(){Ext.fly(dom,INTERNAL).removeClass(className);d.removeListener("mouseup",fn);};d.on("mouseup",fn);});return this;},getViewSize:function(){var doc=document,d=this.dom,isDoc=(d==doc||d==doc.body);if(isDoc){var extdom=Ext.lib.Dom;return{width:extdom.getViewWidth(),height:extdom.getViewHeight()};}else{return{width:d.clientWidth,height:d.clientHeight}}},getStyleSize:function(){var me=this,w,h,doc=document,d=this.dom,isDoc=(d==doc||d==doc.body),s=d.style;if(isDoc){var extdom=Ext.lib.Dom;return{width:extdom.getViewWidth(),height:extdom.getViewHeight()}}
if(s.width&&s.width!='auto'){w=parseFloat(s.width);if(me.isBorderBox()){w-=me.getFrameWidth('lr');}}
if(s.height&&s.height!='auto'){h=parseFloat(s.height);if(me.isBorderBox()){h-=me.getFrameWidth('tb');}}
return{width:w||me.getWidth(true),height:h||me.getHeight(true)};},getSize:function(contentSize){return{width:this.getWidth(contentSize),height:this.getHeight(contentSize)};},repaint:function(){var dom=this.dom;this.addClass("x-repaint");setTimeout(function(){Ext.fly(dom).removeClass("x-repaint");},1);return this;},unselectable:function(){this.dom.unselectable="on";return this.swallowEvent("selectstart",true).applyStyles("-moz-user-select:none;-khtml-user-select:none;").addClass("x-unselectable");},getMargins:function(side){var me=this,key,hash={t:"top",l:"left",r:"right",b:"bottom"},o={};if(!side){for(key in me.margins){o[hash[key]]=parseFloat(me.getStyle(me.margins[key]))||0;}
return o;}else{return me.addStyles.call(me,side,me.margins);}}};}());(function(){var D=Ext.lib.Dom,LEFT="left",RIGHT="right",TOP="top",BOTTOM="bottom",POSITION="position",STATIC="static",RELATIVE="relative",AUTO="auto",ZINDEX="z-index";Ext.Element.addMethods({getX:function(){return D.getX(this.dom);},getY:function(){return D.getY(this.dom);},getXY:function(){return D.getXY(this.dom);},getOffsetsTo:function(el){var o=this.getXY(),e=Ext.fly(el,'_internal').getXY();return[o[0]-e[0],o[1]-e[1]];},setX:function(x,animate){return this.setXY([x,this.getY()],this.animTest(arguments,animate,1));},setY:function(y,animate){return this.setXY([this.getX(),y],this.animTest(arguments,animate,1));},setLeft:function(left){this.setStyle(LEFT,this.addUnits(left));return this;},setTop:function(top){this.setStyle(TOP,this.addUnits(top));return this;},setRight:function(right){this.setStyle(RIGHT,this.addUnits(right));return this;},setBottom:function(bottom){this.setStyle(BOTTOM,this.addUnits(bottom));return this;},setXY:function(pos,animate){var me=this;if(!animate||!me.anim){D.setXY(me.dom,pos);}else{me.anim({points:{to:pos}},me.preanim(arguments,1),'motion');}
return me;},setLocation:function(x,y,animate){return this.setXY([x,y],this.animTest(arguments,animate,2));},moveTo:function(x,y,animate){return this.setXY([x,y],this.animTest(arguments,animate,2));},getLeft:function(local){return!local?this.getX():parseInt(this.getStyle(LEFT),10)||0;},getRight:function(local){var me=this;return!local?me.getX()+me.getWidth():(me.getLeft(true)+me.getWidth())||0;},getTop:function(local){return!local?this.getY():parseInt(this.getStyle(TOP),10)||0;},getBottom:function(local){var me=this;return!local?me.getY()+me.getHeight():(me.getTop(true)+me.getHeight())||0;},position:function(pos,zIndex,x,y){var me=this;if(!pos&&me.isStyle(POSITION,STATIC)){me.setStyle(POSITION,RELATIVE);}else if(pos){me.setStyle(POSITION,pos);}
if(zIndex){me.setStyle(ZINDEX,zIndex);}
if(x||y)me.setXY([x||false,y||false]);},clearPositioning:function(value){value=value||'';this.setStyle({left:value,right:value,top:value,bottom:value,"z-index":"",position:STATIC});return this;},getPositioning:function(){var l=this.getStyle(LEFT);var t=this.getStyle(TOP);return{"position":this.getStyle(POSITION),"left":l,"right":l?"":this.getStyle(RIGHT),"top":t,"bottom":t?"":this.getStyle(BOTTOM),"z-index":this.getStyle(ZINDEX)};},setPositioning:function(pc){var me=this,style=me.dom.style;me.setStyle(pc);if(pc.right==AUTO){style.right="";}
if(pc.bottom==AUTO){style.bottom="";}
return me;},translatePoints:function(x,y){y=isNaN(x[1])?y:x[1];x=isNaN(x[0])?x:x[0];var me=this,relative=me.isStyle(POSITION,RELATIVE),o=me.getXY(),l=parseInt(me.getStyle(LEFT),10),t=parseInt(me.getStyle(TOP),10);l=!isNaN(l)?l:(relative?0:me.dom.offsetLeft);t=!isNaN(t)?t:(relative?0:me.dom.offsetTop);return{left:(x-o[0]+l),top:(y-o[1]+t)};},animTest:function(args,animate,i){return!!animate&&this.preanim?this.preanim(args,i):false;}});})();Ext.Element.addMethods({setBox:function(box,adjust,animate){var me=this,w=box.width,h=box.height;if((adjust&&!me.autoBoxAdjust)&&!me.isBorderBox()){w-=(me.getBorderWidth("lr")+me.getPadding("lr"));h-=(me.getBorderWidth("tb")+me.getPadding("tb"));}
me.setBounds(box.x,box.y,w,h,me.animTest.call(me,arguments,animate,2));return me;},getBox:function(contentBox,local){var me=this,xy,left,top,getBorderWidth=me.getBorderWidth,getPadding=me.getPadding,l,r,t,b;if(!local){xy=me.getXY();}else{left=parseInt(me.getStyle("left"),10)||0;top=parseInt(me.getStyle("top"),10)||0;xy=[left,top];}
var el=me.dom,w=el.offsetWidth,h=el.offsetHeight,bx;if(!contentBox){bx={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:w,height:h};}else{l=getBorderWidth.call(me,"l")+getPadding.call(me,"l");r=getBorderWidth.call(me,"r")+getPadding.call(me,"r");t=getBorderWidth.call(me,"t")+getPadding.call(me,"t");b=getBorderWidth.call(me,"b")+getPadding.call(me,"b");bx={x:xy[0]+l,y:xy[1]+t,0:xy[0]+l,1:xy[1]+t,width:w-(l+r),height:h-(t+b)};}
bx.right=bx.x+bx.width;bx.bottom=bx.y+bx.height;return bx;},move:function(direction,distance,animate){var me=this,xy=me.getXY(),x=xy[0],y=xy[1],left=[x-distance,y],right=[x+distance,y],top=[x,y-distance],bottom=[x,y+distance],hash={l:left,left:left,r:right,right:right,t:top,top:top,up:top,b:bottom,bottom:bottom,down:bottom};direction=direction.toLowerCase();me.moveTo(hash[direction][0],hash[direction][1],me.animTest.call(me,arguments,animate,2));},setLeftTop:function(left,top){var me=this,style=me.dom.style;style.left=me.addUnits(left);style.top=me.addUnits(top);return me;},getRegion:function(){return Ext.lib.Dom.getRegion(this.dom);},setBounds:function(x,y,width,height,animate){var me=this;if(!animate||!me.anim){me.setSize(width,height);me.setLocation(x,y);}else{me.anim({points:{to:[x,y]},width:{to:me.adjustWidth(width)},height:{to:me.adjustHeight(height)}},me.preanim(arguments,4),'motion');}
return me;},setRegion:function(region,animate){return this.setBounds(region.left,region.top,region.right-region.left,region.bottom-region.top,this.animTest.call(this,arguments,animate,1));}});Ext.Element.addMethods({isScrollable:function(){var dom=this.dom;return dom.scrollHeight>dom.clientHeight||dom.scrollWidth>dom.clientWidth;},scrollTo:function(side,value){this.dom["scroll"+(/top/i.test(side)?"Top":"Left")]=value;return this;},getScroll:function(){var d=this.dom,doc=document,body=doc.body,docElement=doc.documentElement,l,t,ret;if(d==doc||d==body){if(Ext.isIE&&Ext.isStrict){l=docElement.scrollLeft;t=docElement.scrollTop;}else{l=window.pageXOffset;t=window.pageYOffset;}
ret={left:l||(body?body.scrollLeft:0),top:t||(body?body.scrollTop:0)};}else{ret={left:d.scrollLeft,top:d.scrollTop};}
return ret;}});Ext.Element.addMethods({scrollTo:function(side,value,animate){var top=/top/i.test(side),me=this,dom=me.dom,prop;if(!animate||!me.anim){prop='scroll'+(top?'Top':'Left'),dom[prop]=value;}else{prop='scroll'+(top?'Left':'Top'),me.anim({scroll:{to:top?[dom[prop],value]:[value,dom[prop]]}},me.preanim(arguments,2),'scroll');}
return me;},scrollIntoView:function(container,hscroll){var c=Ext.getDom(container)||Ext.getBody().dom,el=this.dom,o=this.getOffsetsTo(c),l=o[0]+c.scrollLeft,t=o[1]+c.scrollTop,b=t+el.offsetHeight,r=l+el.offsetWidth,ch=c.clientHeight,ct=parseInt(c.scrollTop,10),cl=parseInt(c.scrollLeft,10),cb=ct+ch,cr=cl+c.clientWidth;if(el.offsetHeight>ch||t<ct){c.scrollTop=t;}else if(b>cb){c.scrollTop=b-ch;}
c.scrollTop=c.scrollTop;if(hscroll!==false){if(el.offsetWidth>c.clientWidth||l<cl){c.scrollLeft=l;}else if(r>cr){c.scrollLeft=r-c.clientWidth;}
c.scrollLeft=c.scrollLeft;}
return this;},scrollChildIntoView:function(child,hscroll){Ext.fly(child,'_scrollChildIntoView').scrollIntoView(this,hscroll);},scroll:function(direction,distance,animate){if(!this.isScrollable()){return;}
var el=this.dom,l=el.scrollLeft,t=el.scrollTop,w=el.scrollWidth,h=el.scrollHeight,cw=el.clientWidth,ch=el.clientHeight,scrolled=false,v,hash={l:Math.min(l+distance,w-cw),r:v=Math.max(l-distance,0),t:Math.max(t-distance,0),b:Math.min(t+distance,h-ch)};hash.d=hash.b;hash.u=hash.t;direction=direction.substr(0,1);if((v=hash[direction])>-1){scrolled=true;this.scrollTo(direction=='l'||direction=='r'?'left':'top',v,this.preanim(arguments,2));}
return scrolled;}});Ext.Element.VISIBILITY=1;Ext.Element.DISPLAY=2;Ext.Element.addMethods(function(){var VISIBILITY="visibility",DISPLAY="display",HIDDEN="hidden",OFFSETS="offsets",NONE="none",ORIGINALDISPLAY='originalDisplay',VISMODE='visibilityMode',ELDISPLAY=Ext.Element.DISPLAY,data=Ext.Element.data,getDisplay=function(dom){var d=data(dom,ORIGINALDISPLAY);if(d===undefined){data(dom,ORIGINALDISPLAY,d='');}
return d;},getVisMode=function(dom){var m=data(dom,VISMODE);if(m===undefined){data(dom,VISMODE,m=1);}
return m;};return{originalDisplay:"",visibilityMode:1,setVisibilityMode:function(visMode){data(this.dom,VISMODE,visMode);return this;},animate:function(args,duration,onComplete,easing,animType){this.anim(args,{duration:duration,callback:onComplete,easing:easing},animType);return this;},anim:function(args,opt,animType,defaultDur,defaultEase,cb){animType=animType||'run';opt=opt||{};var me=this,anim=Ext.lib.Anim[animType](me.dom,args,(opt.duration||defaultDur)||.35,(opt.easing||defaultEase)||'easeOut',function(){if(cb)cb.call(me);if(opt.callback)opt.callback.call(opt.scope||me,me,opt);},me);opt.anim=anim;return anim;},preanim:function(a,i){return!a[i]?false:(typeof a[i]=='object'?a[i]:{duration:a[i+1],callback:a[i+2],easing:a[i+3]});},isVisible:function(){return!this.isStyle(VISIBILITY,HIDDEN)&&!this.isStyle(DISPLAY,NONE);},setVisible:function(visible,animate){var me=this,isDisplay,isVisible,isOffsets,dom=me.dom;if(typeof animate=='string'){isDisplay=animate==DISPLAY;isVisible=animate==VISIBILITY;isOffsets=animate==OFFSETS;animate=false;}else{isDisplay=getVisMode(this.dom)==ELDISPLAY;isVisible=!isDisplay;}
if(!animate||!me.anim){if(isDisplay){me.setDisplayed(visible);}else if(isOffsets){if(!visible){me.hideModeStyles={position:me.getStyle('position'),top:me.getStyle('top'),left:me.getStyle('left')};me.applyStyles({position:'absolute',top:'-10000px',left:'-10000px'});}else{me.applyStyles(me.hideModeStyles||{position:'',top:'',left:''});}}else{me.fixDisplay();dom.style.visibility=visible?"visible":HIDDEN;}}else{if(visible){me.setOpacity(.01);me.setVisible(true);}
me.anim({opacity:{to:(visible?1:0)}},me.preanim(arguments,1),null,.35,'easeIn',function(){if(!visible){dom.style[isDisplay?DISPLAY:VISIBILITY]=(isDisplay)?NONE:HIDDEN;Ext.fly(dom).setOpacity(1);}});}
return me;},toggle:function(animate){var me=this;me.setVisible(!me.isVisible(),me.preanim(arguments,0));return me;},setDisplayed:function(value){if(typeof value=="boolean"){value=value?getDisplay(this.dom):NONE;}
this.setStyle(DISPLAY,value);return this;},fixDisplay:function(){var me=this;if(me.isStyle(DISPLAY,NONE)){me.setStyle(VISIBILITY,HIDDEN);me.setStyle(DISPLAY,getDisplay(this.dom));if(me.isStyle(DISPLAY,NONE)){me.setStyle(DISPLAY,"block");}}},hide:function(animate){if(typeof animate=='string'){this.setVisible(false,animate);return this;}
this.setVisible(false,this.preanim(arguments,0));return this;},show:function(animate){if(typeof animate=='string'){this.setVisible(true,animate);return this;}
this.setVisible(true,this.preanim(arguments,0));return this;}};}());Ext.Element.addMethods(function(){var VISIBILITY="visibility",DISPLAY="display",HIDDEN="hidden",NONE="none",XMASKED="x-masked",XMASKEDRELATIVE="x-masked-relative",data=Ext.Element.data;return{isVisible:function(deep){var vis=!this.isStyle(VISIBILITY,HIDDEN)&&!this.isStyle(DISPLAY,NONE),p=this.dom.parentNode;if(deep!==true||!vis){return vis;}
while(p&&!/^body/i.test(p.tagName)){if(!Ext.fly(p,'_isVisible').isVisible()){return false;}
p=p.parentNode;}
return true;},isDisplayed:function(){return!this.isStyle(DISPLAY,NONE);},enableDisplayMode:function(display){this.setVisibilityMode(Ext.Element.DISPLAY);if(!Ext.isEmpty(display)){data(this.dom,'originalDisplay',display);}
return this;},mask:function(msg,msgCls){var me=this,dom=me.dom,dh=Ext.DomHelper,EXTELMASKMSG="ext-el-mask-msg",el,mask;if(!/^body/i.test(dom.tagName)&&me.getStyle('position')=='static'){me.addClass(XMASKEDRELATIVE);}
if((el=data(dom,'maskMsg'))){el.remove();}
if((el=data(dom,'mask'))){el.remove();}
mask=dh.append(dom,{cls:"ext-el-mask"},true);data(dom,'mask',mask);me.addClass(XMASKED);mask.setDisplayed(true);if(typeof msg=='string'){var mm=dh.append(dom,{cls:EXTELMASKMSG,cn:{tag:'div'}},true);data(dom,'maskMsg',mm);mm.dom.className=msgCls?EXTELMASKMSG+" "+msgCls:EXTELMASKMSG;mm.dom.firstChild.innerHTML=msg;mm.setDisplayed(true);mm.center(me);}
if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&me.getStyle('height')=='auto'){mask.setSize(undefined,me.getHeight());}
return mask;},unmask:function(){var me=this,dom=me.dom,mask=data(dom,'mask'),maskMsg=data(dom,'maskMsg');if(mask){if(maskMsg){maskMsg.remove();data(dom,'maskMsg',undefined);}
mask.remove();data(dom,'mask',undefined);}
me.removeClass([XMASKED,XMASKEDRELATIVE]);},isMasked:function(){var m=data(this.dom,'mask');return m&&m.isVisible();},createShim:function(){var el=document.createElement('iframe'),shim;el.frameBorder='0';el.className='ext-shim';el.src=Ext.SSL_SECURE_URL;shim=Ext.get(this.dom.parentNode.insertBefore(el,this.dom));shim.autoBoxAdjust=false;return shim;}};}());Ext.Element.addMethods({addKeyListener:function(key,fn,scope){var config;if(typeof key!='object'||Ext.isArray(key)){config={key:key,fn:fn,scope:scope};}else{config={key:key.key,shift:key.shift,ctrl:key.ctrl,alt:key.alt,fn:fn,scope:scope};}
return new Ext.KeyMap(this,config);},addKeyMap:function(config){return new Ext.KeyMap(this,config);}});(function(){var NULL=null,UNDEFINED=undefined,TRUE=true,FALSE=false,SETX="setX",SETY="setY",SETXY="setXY",LEFT="left",BOTTOM="bottom",TOP="top",RIGHT="right",HEIGHT="height",WIDTH="width",POINTS="points",HIDDEN="hidden",ABSOLUTE="absolute",VISIBLE="visible",MOTION="motion",POSITION="position",EASEOUT="easeOut",flyEl=new Ext.Element.Flyweight(),queues={},getObject=function(o){return o||{};},fly=function(dom){flyEl.dom=dom;flyEl.id=Ext.id(dom);return flyEl;},getQueue=function(id){if(!queues[id]){queues[id]=[];}
return queues[id];},setQueue=function(id,value){queues[id]=value;};Ext.enableFx=TRUE;Ext.Fx={switchStatements:function(key,fn,argHash){return fn.apply(this,argHash[key]);},slideIn:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,xy,r,b,wrap,after,st,args,pt,bw,bh;anchor=anchor||"t";me.queueFx(o,function(){xy=fly(dom).getXY();fly(dom).fixDisplay();r=fly(dom).getFxRestore();b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight};b.right=b.x+b.width;b.bottom=b.y+b.height;fly(dom).setWidth(b.width).setHeight(b.height);wrap=fly(dom).fxWrap(r.pos,o,HIDDEN);st.visibility=VISIBLE;st.position=ABSOLUTE;function after(){fly(dom).fxUnwrap(wrap,r.pos,o);st.width=r.width;st.height=r.height;fly(dom).afterFx(o);}
pt={to:[b.x,b.y]};bw={to:b.width};bh={to:b.height};function argCalc(wrap,style,ww,wh,sXY,sXYval,s1,s2,w,h,p){var ret={};fly(wrap).setWidth(ww).setHeight(wh);if(fly(wrap)[sXY]){fly(wrap)[sXY](sXYval);}
style[s1]=style[s2]="0";if(w){ret.width=w};if(h){ret.height=h;}
if(p){ret.points=p;}
return ret;};args=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{t:[wrap,st,b.width,0,NULL,NULL,LEFT,BOTTOM,NULL,bh,NULL],l:[wrap,st,0,b.height,NULL,NULL,RIGHT,TOP,bw,NULL,NULL],r:[wrap,st,b.width,b.height,SETX,b.right,LEFT,TOP,NULL,NULL,pt],b:[wrap,st,b.width,b.height,SETY,b.bottom,LEFT,TOP,NULL,bh,pt],tl:[wrap,st,0,0,NULL,NULL,RIGHT,BOTTOM,bw,bh,pt],bl:[wrap,st,0,0,SETY,b.y+b.height,RIGHT,TOP,bw,bh,pt],br:[wrap,st,0,0,SETXY,[b.right,b.bottom],LEFT,TOP,bw,bh,pt],tr:[wrap,st,0,0,SETX,b.x+b.width,LEFT,BOTTOM,bw,bh,pt]});st.visibility=VISIBLE;fly(wrap).show();arguments.callee.anim=fly(wrap).fxanim(args,o,MOTION,.5,EASEOUT,after);});return me;},slideOut:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,xy=me.getXY(),wrap,r,b,a,zero={to:0};anchor=anchor||"t";me.queueFx(o,function(){r=fly(dom).getFxRestore();b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight};b.right=b.x+b.width;b.bottom=b.y+b.height;fly(dom).setWidth(b.width).setHeight(b.height);wrap=fly(dom).fxWrap(r.pos,o,VISIBLE);st.visibility=VISIBLE;st.position=ABSOLUTE;fly(wrap).setWidth(b.width).setHeight(b.height);function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).fxUnwrap(wrap,r.pos,o);st.width=r.width;st.height=r.height;fly(dom).afterFx(o);}
function argCalc(style,s1,s2,p1,v1,p2,v2,p3,v3){var ret={};style[s1]=style[s2]="0";ret[p1]=v1;if(p2){ret[p2]=v2;}
if(p3){ret[p3]=v3;}
return ret;};a=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{t:[st,LEFT,BOTTOM,HEIGHT,zero],l:[st,RIGHT,TOP,WIDTH,zero],r:[st,LEFT,TOP,WIDTH,zero,POINTS,{to:[b.right,b.y]}],b:[st,LEFT,TOP,HEIGHT,zero,POINTS,{to:[b.x,b.bottom]}],tl:[st,RIGHT,BOTTOM,WIDTH,zero,HEIGHT,zero],bl:[st,RIGHT,TOP,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.x,b.bottom]}],br:[st,LEFT,TOP,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.x+b.width,b.bottom]}],tr:[st,LEFT,BOTTOM,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.right,b.y]}]});arguments.callee.anim=fly(wrap).fxanim(a,o,MOTION,.5,EASEOUT,after);});return me;},puff:function(o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,width,height,r;me.queueFx(o,function(){width=fly(dom).getWidth();height=fly(dom).getHeight();fly(dom).clearOpacity();fly(dom).show();r=fly(dom).getFxRestore();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;st.fontSize='';fly(dom).afterFx(o);}
arguments.callee.anim=fly(dom).fxanim({width:{to:fly(dom).adjustWidth(width*2)},height:{to:fly(dom).adjustHeight(height*2)},points:{by:[-width*.5,-height*.5]},opacity:{to:0},fontSize:{to:200,unit:"%"}},o,MOTION,.5,EASEOUT,after);});return me;},switchOff:function(o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,r;me.queueFx(o,function(){fly(dom).clearOpacity();fly(dom).clip();r=fly(dom).getFxRestore();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;fly(dom).afterFx(o);};fly(dom).fxanim({opacity:{to:0.3}},NULL,NULL,.1,NULL,function(){fly(dom).clearOpacity();(function(){fly(dom).fxanim({height:{to:1},points:{by:[0,fly(dom).getHeight()*.5]}},o,MOTION,0.3,'easeIn',after);}).defer(100);});});return me;},highlight:function(color,o){o=getObject(o);var me=this,dom=me.dom,attr=o.attr||"backgroundColor",a={},restore;me.queueFx(o,function(){fly(dom).clearOpacity();fly(dom).show();function after(){dom.style[attr]=restore;fly(dom).afterFx(o);}
restore=dom.style[attr];a[attr]={from:color||"ffff9c",to:o.endColor||fly(dom).getColor(attr)||"ffffff"};arguments.callee.anim=fly(dom).fxanim(a,o,'color',1,'easeIn',after);});return me;},frame:function(color,count,o){o=getObject(o);var me=this,dom=me.dom,proxy,active;me.queueFx(o,function(){color=color||'#C3DAF9';if(color.length==6){color='#'+color;}
count=count||1;fly(dom).show();var xy=fly(dom).getXY(),b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight},queue=function(){proxy=fly(document.body||document.documentElement).createChild({style:{position:ABSOLUTE,'z-index':35000,border:'0px solid '+color}});return proxy.queueFx({},animFn);};arguments.callee.anim={isAnimated:true,stop:function(){count=0;proxy.stopFx();}};function animFn(){var scale=Ext.isBorderBox?2:1;active=proxy.anim({top:{from:b.y,to:b.y-20},left:{from:b.x,to:b.x-20},borderWidth:{from:0,to:10},opacity:{from:1,to:0},height:{from:b.height,to:b.height+20*scale},width:{from:b.width,to:b.width+20*scale}},{duration:o.duration||1,callback:function(){proxy.remove();--count>0?queue():fly(dom).afterFx(o);}});arguments.callee.anim={isAnimated:true,stop:function(){active.stop();}};};queue();});return me;},pause:function(seconds){var dom=this.dom,t;this.queueFx({},function(){t=setTimeout(function(){fly(dom).afterFx({});},seconds*1000);arguments.callee.anim={isAnimated:true,stop:function(){clearTimeout(t);fly(dom).afterFx({});}};});return this;},fadeIn:function(o){o=getObject(o);var me=this,dom=me.dom,to=o.endOpacity||1;me.queueFx(o,function(){fly(dom).setOpacity(0);fly(dom).fixDisplay();dom.style.visibility=VISIBLE;arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,.5,EASEOUT,function(){if(to==1){fly(dom).clearOpacity();}
fly(dom).afterFx(o);});});return me;},fadeOut:function(o){o=getObject(o);var me=this,dom=me.dom,style=dom.style,to=o.endOpacity||0;me.queueFx(o,function(){arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,.5,EASEOUT,function(){if(to==0){Ext.Element.data(dom,'visibilityMode')==Ext.Element.DISPLAY||o.useDisplay?style.display="none":style.visibility=HIDDEN;fly(dom).clearOpacity();}
fly(dom).afterFx(o);});});return me;},scale:function(w,h,o){this.shift(Ext.apply({},o,{width:w,height:h}));return this;},shift:function(o){o=getObject(o);var dom=this.dom,a={};this.queueFx(o,function(){for(var prop in o){if(o[prop]!=UNDEFINED){a[prop]={to:o[prop]};}}
a.width?a.width.to=fly(dom).adjustWidth(o.width):a;a.height?a.height.to=fly(dom).adjustWidth(o.height):a;if(a.x||a.y||a.xy){a.points=a.xy||{to:[a.x?a.x.to:fly(dom).getX(),a.y?a.y.to:fly(dom).getY()]};}
arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,.35,EASEOUT,function(){fly(dom).afterFx(o);});});return this;},ghost:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,a={opacity:{to:0},points:{}},pt=a.points,r,w,h;anchor=anchor||"b";me.queueFx(o,function(){r=fly(dom).getFxRestore();w=fly(dom).getWidth();h=fly(dom).getHeight();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;fly(dom).afterFx(o);}
pt.by=fly(dom).switchStatements(anchor.toLowerCase(),function(v1,v2){return[v1,v2];},{t:[0,-h],l:[-w,0],r:[w,0],b:[0,h],tl:[-w,-h],bl:[-w,h],br:[w,h],tr:[w,-h]});arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,.5,EASEOUT,after);});return me;},syncFx:function(){var me=this;me.fxDefaults=Ext.apply(me.fxDefaults||{},{block:FALSE,concurrent:TRUE,stopFx:FALSE});return me;},sequenceFx:function(){var me=this;me.fxDefaults=Ext.apply(me.fxDefaults||{},{block:FALSE,concurrent:FALSE,stopFx:FALSE});return me;},nextFx:function(){var ef=getQueue(this.dom.id)[0];if(ef){ef.call(this);}},hasActiveFx:function(){return getQueue(this.dom.id)[0];},stopFx:function(finish){var me=this,id=me.dom.id;if(me.hasActiveFx()){var cur=getQueue(id)[0];if(cur&&cur.anim){if(cur.anim.isAnimated){setQueue(id,[cur]);cur.anim.stop(finish!==undefined?finish:TRUE);}else{setQueue(id,[]);}}}
return me;},beforeFx:function(o){if(this.hasActiveFx()&&!o.concurrent){if(o.stopFx){this.stopFx();return TRUE;}
return FALSE;}
return TRUE;},hasFxBlock:function(){var q=getQueue(this.dom.id);return q&&q[0]&&q[0].block;},queueFx:function(o,fn){var me=fly(this.dom);if(!me.hasFxBlock()){Ext.applyIf(o,me.fxDefaults);if(!o.concurrent){var run=me.beforeFx(o);fn.block=o.block;getQueue(me.dom.id).push(fn);if(run){me.nextFx();}}else{fn.call(me);}}
return me;},fxWrap:function(pos,o,vis){var dom=this.dom,wrap,wrapXY;if(!o.wrap||!(wrap=Ext.getDom(o.wrap))){if(o.fixPosition){wrapXY=fly(dom).getXY();}
var div=document.createElement("div");div.style.visibility=vis;wrap=dom.parentNode.insertBefore(div,dom);fly(wrap).setPositioning(pos);if(fly(wrap).isStyle(POSITION,"static")){fly(wrap).position("relative");}
fly(dom).clearPositioning('auto');fly(wrap).clip();wrap.appendChild(dom);if(wrapXY){fly(wrap).setXY(wrapXY);}}
return wrap;},fxUnwrap:function(wrap,pos,o){var dom=this.dom;fly(dom).clearPositioning();fly(dom).setPositioning(pos);if(!o.wrap){var pn=fly(wrap).dom.parentNode;pn.insertBefore(dom,wrap);fly(wrap).remove();}},getFxRestore:function(){var st=this.dom.style;return{pos:this.getPositioning(),width:st.width,height:st.height};},afterFx:function(o){var dom=this.dom,id=dom.id;if(o.afterStyle){fly(dom).setStyle(o.afterStyle);}
if(o.afterCls){fly(dom).addClass(o.afterCls);}
if(o.remove==TRUE){fly(dom).remove();}
if(o.callback){o.callback.call(o.scope,fly(dom));}
if(!o.concurrent){getQueue(id).shift();fly(dom).nextFx();}},fxanim:function(args,opt,animType,defaultDur,defaultEase,cb){animType=animType||'run';opt=opt||{};var anim=Ext.lib.Anim[animType](this.dom,args,(opt.duration||defaultDur)||.35,(opt.easing||defaultEase)||EASEOUT,cb,this);opt.anim=anim;return anim;}};Ext.Fx.resize=Ext.Fx.scale;Ext.Element.addMethods(Ext.Fx);})();Ext.CompositeElementLite=function(els,root){this.elements=[];this.add(els,root);this.el=new Ext.Element.Flyweight();};Ext.CompositeElementLite.prototype={isComposite:true,getElement:function(el){var e=this.el;e.dom=el;e.id=el.id;return e;},transformElement:function(el){return Ext.getDom(el);},getCount:function(){return this.elements.length;},add:function(els,root){var me=this,elements=me.elements;if(!els){return this;}
if(typeof els=="string"){els=Ext.Element.selectorFunction(els,root);}else if(els.isComposite){els=els.elements;}else if(!Ext.isIterable(els)){els=[els];}
for(var i=0,len=els.length;i<len;++i){elements.push(me.transformElement(els[i]));}
return me;},invoke:function(fn,args){var me=this,els=me.elements,len=els.length,e,i;for(i=0;i<len;i++){e=els[i];if(e){Ext.Element.prototype[fn].apply(me.getElement(e),args);}}
return me;},item:function(index){var me=this,el=me.elements[index],out=null;if(el){out=me.getElement(el);}
return out;},addListener:function(eventName,handler,scope,opt){var els=this.elements,len=els.length,i,e;for(i=0;i<len;i++){e=els[i];if(e){Ext.EventManager.on(e,eventName,handler,scope||e,opt);}}
return this;},each:function(fn,scope){var me=this,els=me.elements,len=els.length,i,e;for(i=0;i<len;i++){e=els[i];if(e){e=this.getElement(e);if(fn.call(scope||e,e,me,i)===false){break;}}}
return me;},fill:function(els){var me=this;me.elements=[];me.add(els);return me;},filter:function(selector){var els=[],me=this,elements=me.elements,fn=Ext.isFunction(selector)?selector:function(el){return el.is(selector);};me.each(function(el,self,i){if(fn(el,i)!==false){els[els.length]=me.transformElement(el);}});me.elements=els;return me;},indexOf:function(el){return this.elements.indexOf(this.transformElement(el));},replaceElement:function(el,replacement,domReplace){var index=!isNaN(el)?el:this.indexOf(el),d;if(index>-1){replacement=Ext.getDom(replacement);if(domReplace){d=this.elements[index];d.parentNode.insertBefore(replacement,d);Ext.removeNode(d);}
this.elements.splice(index,1,replacement);}
return this;},clear:function(){this.elements=[];}};Ext.CompositeElementLite.prototype.on=Ext.CompositeElementLite.prototype.addListener;(function(){var fnName,ElProto=Ext.Element.prototype,CelProto=Ext.CompositeElementLite.prototype;for(fnName in ElProto){if(Ext.isFunction(ElProto[fnName])){(function(fnName){CelProto[fnName]=CelProto[fnName]||function(){return this.invoke(fnName,arguments);};}).call(CelProto,fnName);}}})();if(Ext.DomQuery){Ext.Element.selectorFunction=Ext.DomQuery.select;}
Ext.Element.select=function(selector,root){var els;if(typeof selector=="string"){els=Ext.Element.selectorFunction(selector,root);}else if(selector.length!==undefined){els=selector;}else{throw"Invalid selector";}
return new Ext.CompositeElementLite(els);};Ext.select=Ext.Element.select;Ext.apply(Ext.CompositeElementLite.prototype,{addElements:function(els,root){if(!els){return this;}
if(typeof els=="string"){els=Ext.Element.selectorFunction(els,root);}
var yels=this.elements;Ext.each(els,function(e){yels.push(Ext.get(e));});return this;},first:function(){return this.item(0);},last:function(){return this.item(this.getCount()-1);},contains:function(el){return this.indexOf(el)!=-1;},removeElement:function(keys,removeDom){var me=this,els=this.elements,el;Ext.each(keys,function(val){if((el=(els[val]||els[val=me.indexOf(val)]))){if(removeDom){if(el.dom){el.remove();}else{Ext.removeNode(el);}}
els.splice(val,1);}});return this;}});Ext.CompositeElement=Ext.extend(Ext.CompositeElementLite,{constructor:function(els,root){this.elements=[];this.add(els,root);},getElement:function(el){return el;},transformElement:function(el){return Ext.get(el);}});Ext.Element.select=function(selector,unique,root){var els;if(typeof selector=="string"){els=Ext.Element.selectorFunction(selector,root);}else if(selector.length!==undefined){els=selector;}else{throw"Invalid selector";}
return(unique===true)?new Ext.CompositeElement(els):new Ext.CompositeElementLite(els);};Ext.select=Ext.Element.select;(function(){var BEFOREREQUEST="beforerequest",REQUESTCOMPLETE="requestcomplete",REQUESTEXCEPTION="requestexception",UNDEFINED=undefined,LOAD='load',POST='POST',GET='GET',WINDOW=window;Ext.data.Connection=function(config){Ext.apply(this,config);this.addEvents(BEFOREREQUEST,REQUESTCOMPLETE,REQUESTEXCEPTION);Ext.data.Connection.superclass.constructor.call(this);};Ext.extend(Ext.data.Connection,Ext.util.Observable,{timeout:30000,autoAbort:false,disableCaching:true,disableCachingParam:'_dc',request:function(o){var me=this;if(me.fireEvent(BEFOREREQUEST,me,o)){if(o.el){if(!Ext.isEmpty(o.indicatorText)){me.indicatorText='<div class="loading-indicator">'+o.indicatorText+"</div>";}
if(me.indicatorText){Ext.getDom(o.el).innerHTML=me.indicatorText;}
o.success=(Ext.isFunction(o.success)?o.success:function(){}).createInterceptor(function(response){Ext.getDom(o.el).innerHTML=response.responseText;});}
var p=o.params,url=o.url||me.url,method,cb={success:me.handleResponse,failure:me.handleFailure,scope:me,argument:{options:o},timeout:o.timeout||me.timeout},form,serForm;if(Ext.isFunction(p)){p=p.call(o.scope||WINDOW,o);}
p=Ext.urlEncode(me.extraParams,Ext.isObject(p)?Ext.urlEncode(p):p);if(Ext.isFunction(url)){url=url.call(o.scope||WINDOW,o);}
if((form=Ext.getDom(o.form))){url=url||form.action;if(o.isUpload||/multipart\/form-data/i.test(form.getAttribute("enctype"))){return me.doFormUpload.call(me,o,p,url);}
serForm=Ext.lib.Ajax.serializeForm(form);p=p?(p+'&'+serForm):serForm;}
method=o.method||me.method||((p||o.xmlData||o.jsonData)?POST:GET);if(method===GET&&(me.disableCaching&&o.disableCaching!==false)||o.disableCaching===true){var dcp=o.disableCachingParam||me.disableCachingParam;url=Ext.urlAppend(url,dcp+'='+(new Date().getTime()));}
o.headers=Ext.apply(o.headers||{},me.defaultHeaders||{});if(o.autoAbort===true||me.autoAbort){me.abort();}
if((method==GET||o.xmlData||o.jsonData)&&p){url=Ext.urlAppend(url,p);p='';}
return(me.transId=Ext.lib.Ajax.request(method,url,cb,p,o));}else{return o.callback?o.callback.apply(o.scope,[o,UNDEFINED,UNDEFINED]):null;}},isLoading:function(transId){return transId?Ext.lib.Ajax.isCallInProgress(transId):!!this.transId;},abort:function(transId){if(transId||this.isLoading()){Ext.lib.Ajax.abort(transId||this.transId);}},handleResponse:function(response){this.transId=false;var options=response.argument.options;response.argument=options?options.argument:null;this.fireEvent(REQUESTCOMPLETE,this,response,options);if(options.success){options.success.call(options.scope,response,options);}
if(options.callback){options.callback.call(options.scope,options,true,response);}},handleFailure:function(response,e){this.transId=false;var options=response.argument.options;response.argument=options?options.argument:null;this.fireEvent(REQUESTEXCEPTION,this,response,options,e);if(options.failure){options.failure.call(options.scope,response,options);}
if(options.callback){options.callback.call(options.scope,options,false,response);}},doFormUpload:function(o,ps,url){var id=Ext.id(),doc=document,frame=doc.createElement('iframe'),form=Ext.getDom(o.form),hiddens=[],hd,encoding='multipart/form-data',buf={target:form.target,method:form.method,encoding:form.encoding,enctype:form.enctype,action:form.action};Ext.fly(frame).set({id:id,name:id,cls:'x-hidden',src:Ext.SSL_SECURE_URL});doc.body.appendChild(frame);if(Ext.isIE){document.frames[id].name=id;}
Ext.fly(form).set({target:id,method:POST,enctype:encoding,encoding:encoding,action:url||buf.action});Ext.iterate(Ext.urlDecode(ps,false),function(k,v){hd=doc.createElement('input');Ext.fly(hd).set({type:'hidden',value:v,name:k});form.appendChild(hd);hiddens.push(hd);});function cb(){var me=this,r={responseText:'',responseXML:null,argument:o.argument},doc,firstChild;try{doc=frame.contentWindow.document||frame.contentDocument||WINDOW.frames[id].document;if(doc){if(doc.body){if(/textarea/i.test((firstChild=doc.body.firstChild||{}).tagName)){r.responseText=firstChild.value;}else{r.responseText=doc.body.innerHTML;}}
r.responseXML=doc.XMLDocument||doc;}}
catch(e){}
Ext.EventManager.removeListener(frame,LOAD,cb,me);me.fireEvent(REQUESTCOMPLETE,me,r,o);function runCallback(fn,scope,args){if(Ext.isFunction(fn)){fn.apply(scope,args);}}
runCallback(o.success,o.scope,[r,o]);runCallback(o.callback,o.scope,[o,true,r]);if(!me.debugUploads){setTimeout(function(){Ext.removeNode(frame);},100);}}
Ext.EventManager.on(frame,LOAD,cb,this);form.submit();Ext.fly(form).set(buf);Ext.each(hiddens,function(h){Ext.removeNode(h);});}});})();Ext.Ajax=new Ext.data.Connection({autoAbort:false,serializeForm:function(form){return Ext.lib.Ajax.serializeForm(form);}});Ext.UpdateManager=Ext.Updater=Ext.extend(Ext.util.Observable,function(){var BEFOREUPDATE="beforeupdate",UPDATE="update",FAILURE="failure";function processSuccess(response){var me=this;me.transaction=null;if(response.argument.form&&response.argument.reset){try{response.argument.form.reset();}catch(e){}}
if(me.loadScripts){me.renderer.render(me.el,response,me,updateComplete.createDelegate(me,[response]));}else{me.renderer.render(me.el,response,me);updateComplete.call(me,response);}}
function updateComplete(response,type,success){this.fireEvent(type||UPDATE,this.el,response);if(Ext.isFunction(response.argument.callback)){response.argument.callback.call(response.argument.scope,this.el,Ext.isEmpty(success)?true:false,response,response.argument.options);}}
function processFailure(response){updateComplete.call(this,response,FAILURE,!!(this.transaction=null));}
return{constructor:function(el,forceNew){var me=this;el=Ext.get(el);if(!forceNew&&el.updateManager){return el.updateManager;}
me.el=el;me.defaultUrl=null;me.addEvents(BEFOREUPDATE,UPDATE,FAILURE);Ext.apply(me,Ext.Updater.defaults);me.transaction=null;me.refreshDelegate=me.refresh.createDelegate(me);me.updateDelegate=me.update.createDelegate(me);me.formUpdateDelegate=(me.formUpdate||function(){}).createDelegate(me);me.renderer=me.renderer||me.getDefaultRenderer();Ext.Updater.superclass.constructor.call(me);},setRenderer:function(renderer){this.renderer=renderer;},getRenderer:function(){return this.renderer;},getDefaultRenderer:function(){return new Ext.Updater.BasicRenderer();},setDefaultUrl:function(defaultUrl){this.defaultUrl=defaultUrl;},getEl:function(){return this.el;},update:function(url,params,callback,discardUrl){var me=this,cfg,callerScope;if(me.fireEvent(BEFOREUPDATE,me.el,url,params)!==false){if(Ext.isObject(url)){cfg=url;url=cfg.url;params=params||cfg.params;callback=callback||cfg.callback;discardUrl=discardUrl||cfg.discardUrl;callerScope=cfg.scope;if(!Ext.isEmpty(cfg.nocache)){me.disableCaching=cfg.nocache;};if(!Ext.isEmpty(cfg.text)){me.indicatorText='<div class="loading-indicator">'+cfg.text+"</div>";};if(!Ext.isEmpty(cfg.scripts)){me.loadScripts=cfg.scripts;};if(!Ext.isEmpty(cfg.timeout)){me.timeout=cfg.timeout;};}
me.showLoading();if(!discardUrl){me.defaultUrl=url;}
if(Ext.isFunction(url)){url=url.call(me);}
var o=Ext.apply({},{url:url,params:(Ext.isFunction(params)&&callerScope)?params.createDelegate(callerScope):params,success:processSuccess,failure:processFailure,scope:me,callback:undefined,timeout:(me.timeout*1000),disableCaching:me.disableCaching,argument:{"options":cfg,"url":url,"form":null,"callback":callback,"scope":callerScope||window,"params":params}},cfg);me.transaction=Ext.Ajax.request(o);}},formUpdate:function(form,url,reset,callback){var me=this;if(me.fireEvent(BEFOREUPDATE,me.el,form,url)!==false){if(Ext.isFunction(url)){url=url.call(me);}
form=Ext.getDom(form);me.transaction=Ext.Ajax.request({form:form,url:url,success:processSuccess,failure:processFailure,scope:me,timeout:(me.timeout*1000),argument:{"url":url,"form":form,"callback":callback,"reset":reset}});me.showLoading.defer(1,me);}},startAutoRefresh:function(interval,url,params,callback,refreshNow){var me=this;if(refreshNow){me.update(url||me.defaultUrl,params,callback,true);}
if(me.autoRefreshProcId){clearInterval(me.autoRefreshProcId);}
me.autoRefreshProcId=setInterval(me.update.createDelegate(me,[url||me.defaultUrl,params,callback,true]),interval*1000);},stopAutoRefresh:function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId);delete this.autoRefreshProcId;}},isAutoRefreshing:function(){return!!this.autoRefreshProcId;},showLoading:function(){if(this.showLoadIndicator){this.el.dom.innerHTML=this.indicatorText;}},abort:function(){if(this.transaction){Ext.Ajax.abort(this.transaction);}},isUpdating:function(){return this.transaction?Ext.Ajax.isLoading(this.transaction):false;},refresh:function(callback){if(this.defaultUrl){this.update(this.defaultUrl,null,callback,true);}}}}());Ext.Updater.defaults={timeout:30,disableCaching:false,showLoadIndicator:true,indicatorText:'<div class="loading-indicator">Loading...</div>',loadScripts:false,sslBlankUrl:Ext.SSL_SECURE_URL};Ext.Updater.updateElement=function(el,url,params,options){var um=Ext.get(el).getUpdater();Ext.apply(um,options);um.update(url,params,options?options.callback:null);};Ext.Updater.BasicRenderer=function(){};Ext.Updater.BasicRenderer.prototype={render:function(el,response,updateManager,callback){el.update(response.responseText,updateManager.loadScripts,callback);}};(function(){Date.useStrict=false;function xf(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i];});}
Date.formatCodeToRegex=function(character,currentGroup){var p=Date.parseCodes[character];if(p){p=typeof p=='function'?p():p;Date.parseCodes[character]=p;}
return p?Ext.applyIf({c:p.c?xf(p.c,currentGroup||"{0}"):p.c},p):{g:0,c:null,s:Ext.escapeRe(character)}};var $f=Date.formatCodeToRegex;Ext.apply(Date,{parseFunctions:{"M$":function(input,strict){var re=new RegExp('\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/');var r=(input||'').match(re);return r?new Date(((r[1]||'')+r[2])*1):null;}},parseRegexes:[],formatFunctions:{"M$":function(){return'\\/Date('+this.getTime()+')\\/';}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},getShortMonthName:function(month){return Date.monthNames[month].substring(0,3);},getShortDayName:function(day){return Date.dayNames[day].substring(0,3);},getMonthNumber:function(name){return Date.monthNumbers[name.substring(0,1).toUpperCase()+name.substring(1,3).toLowerCase()];},formatCodes:{d:"String.leftPad(this.getDate(), 2, '0')",D:"Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"this.getSuffix()",w:"this.getDay()",z:"this.getDayOfYear()",W:"String.leftPad(this.getWeekOfYear(), 2, '0')",F:"Date.monthNames[this.getMonth()]",m:"String.leftPad(this.getMonth() + 1, 2, '0')",M:"Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"this.getFullYear()",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"String.leftPad(this.getHours(), 2, '0')",i:"String.leftPad(this.getMinutes(), 2, '0')",s:"String.leftPad(this.getSeconds(), 2, '0')",u:"String.leftPad(this.getMilliseconds(), 3, '0')",O:"this.getGMTOffset()",P:"this.getGMTOffset(true)",T:"this.getTimezone()",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var c="Y-m-dTH:i:sP",code=[],i=0,l=c.length;i<l;++i){var e=c.charAt(i);code.push(e=="T"?"'T'":Date.getFormatCode(e));}
return code.join(" + ");},U:"Math.round(this.getTime() / 1000)"},isValid:function(y,m,d,h,i,s,ms){h=h||0;i=i||0;s=s||0;ms=ms||0;var dt=new Date(y,m-1,d,h,i,s,ms);return y==dt.getFullYear()&&m==dt.getMonth()+1&&d==dt.getDate()&&h==dt.getHours()&&i==dt.getMinutes()&&s==dt.getSeconds()&&ms==dt.getMilliseconds();},parseDate:function(input,format,strict){var p=Date.parseFunctions;if(p[format]==null){Date.createParser(format);}
return p[format](input,Ext.isDefined(strict)?strict:Date.useStrict);},getFormatCode:function(character){var f=Date.formatCodes[character];if(f){f=typeof f=='function'?f():f;Date.formatCodes[character]=f;}
return f||("'"+String.escape(character)+"'");},createFormat:function(format){var code=[],special=false,ch='';for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true;}else if(special){special=false;code.push("'"+String.escape(ch)+"'");}else{code.push(Date.getFormatCode(ch))}}
Date.formatFunctions[format]=new Function("return "+code.join('+'));},createParser:function(){var code=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Date.defaults,","results = String(input).match(Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = (new Date()).clearTime();","y = Ext.num(y, Ext.num(def.y, dt.getFullYear()));","m = Ext.num(m, Ext.num(def.m - 1, dt.getMonth()));","d = Ext.num(d, Ext.num(def.d, dt.getDate()));","h  = Ext.num(h, Ext.num(def.h, dt.getHours()));","i  = Ext.num(i, Ext.num(def.i, dt.getMinutes()));","s  = Ext.num(s, Ext.num(def.s, dt.getSeconds()));","ms = Ext.num(ms, Ext.num(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = new Date(y, 0, 1, h, i, s, ms);","v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);","}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = new Date(y, m, d, h, i, s, ms);","}","}","}","if(v){","if(zz != null){","v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join('\n');return function(format){var regexNum=Date.parseRegexes.length,currentGroup=1,calc=[],regex=[],special=false,ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true;}else if(special){special=false;regex.push(String.escape(ch));}else{var obj=$f(ch,currentGroup);currentGroup+=obj.g;regex.push(obj.s);if(obj.g&&obj.c){calc.push(obj.c);}}}
Date.parseRegexes[regexNum]=new RegExp("^"+regex.join('')+"$");Date.parseFunctions[format]=new Function("input","strict",xf(code,regexNum,calc.join('')));}}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var a=[],i=0;i<7;a.push(Date.getShortDayName(i)),++i);return{g:0,c:null,s:"(?:"+a.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n",s:"("+Date.monthNames.join("|")+")"}},M:function(){for(var a=[],i=0;i<12;a.push(Date.getShortMonthName(i)),++i);return Ext.applyIf({s:"("+a.join("|")+")"},$f("F"));},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return $f("Y");},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\n"
+"y = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (results[{0}] == 'am') {\n"
+"if (!h || h == 12) { h = 0; }\n"
+"} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm)"},A:{g:1,c:"if (results[{0}] == 'AM') {\n"
+"if (!h || h == 12) { h = 0; }\n"
+"} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM)"},g:function(){return $f("G");},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return $f("H");},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+\-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+\-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\n"
+"zz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+\-]?\\d{1,5})"},c:function(){var calc=[],arr=[$f("Y",1),$f("m",2),$f("d",3),$f("h",4),$f("i",5),$f("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",$f("P",8).c,"}else{",$f("O",8).c,"}","}"].join('\n')}];for(var i=0,l=arr.length;i<l;++i){calc.push(arr[i].c);}
return{g:1,c:calc.join(""),s:[arr[0].s,"(?:","-",arr[1].s,"(?:","-",arr[2].s,"(?:","(?:T| )?",arr[3].s,":",arr[4].s,"(?::",arr[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}}});}());Ext.apply(Date.prototype,{dateFormat:function(format){if(Date.formatFunctions[format]==null){Date.createFormat(format);}
return Date.formatFunctions[format].call(this);},getTimezone:function(){return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"");},getGMTOffset:function(colon){return(this.getTimezoneOffset()>0?"-":"+")
+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")
+(colon?":":"")
+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0");},getDayOfYear:function(){var num=0,d=this.clone(),m=this.getMonth(),i;for(i=0,d.setDate(1),d.setMonth(0);i<m;d.setMonth(++i)){num+=d.getDaysInMonth();}
return num+this.getDate()-1;},getWeekOfYear:function(){var ms1d=864e5,ms7d=7*ms1d;return function(){var DC3=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/ms1d,AWN=Math.floor(DC3/7),Wyr=new Date(AWN*ms7d).getUTCFullYear();return AWN-Math.floor(Date.UTC(Wyr,0,7)/ms7d)+1;}}(),isLeapYear:function(){var year=this.getFullYear();return!!((year&3)==0&&(year%100||(year%400==0&&year)));},getFirstDayOfMonth:function(){var day=(this.getDay()-(this.getDate()-1))%7;return(day<0)?(day+7):day;},getLastDayOfMonth:function(){return this.getLastDateOfMonth().getDay();},getFirstDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1);},getLastDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth());},getDaysInMonth:function(){var daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];return function(){var m=this.getMonth();return m==1&&this.isLeapYear()?29:daysInMonth[m];}}(),getSuffix:function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}},clone:function(){return new Date(this.getTime());},isDST:function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset();},clearTime:function(clone){if(clone){return this.clone().clearTime();}
var d=this.getDate();this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);if(this.getDate()!=d){for(var hr=1,c=this.add(Date.HOUR,hr);c.getDate()!=d;hr++,c=this.add(Date.HOUR,hr));this.setDate(d);this.setHours(c.getHours());}
return this;},add:function(interval,value){var d=this.clone();if(!interval||value===0)return d;switch(interval.toLowerCase()){case Date.MILLI:d.setMilliseconds(this.getMilliseconds()+value);break;case Date.SECOND:d.setSeconds(this.getSeconds()+value);break;case Date.MINUTE:d.setMinutes(this.getMinutes()+value);break;case Date.HOUR:d.setHours(this.getHours()+value);break;case Date.DAY:d.setDate(this.getDate()+value);break;case Date.MONTH:var day=this.getDate();if(day>28){day=Math.min(day,this.getFirstDateOfMonth().add('mo',value).getLastDateOfMonth().getDate());}
d.setDate(day);d.setMonth(this.getMonth()+value);break;case Date.YEAR:d.setFullYear(this.getFullYear()+value);break;}
return d;},between:function(start,end){var t=this.getTime();return start.getTime()<=t&&t<=end.getTime();}});Date.prototype.format=Date.prototype.dateFormat;if(Ext.isSafari&&(navigator.userAgent.match(/WebKit\/(\d+)/)[1]||NaN)<420){Ext.apply(Date.prototype,{_xMonth:Date.prototype.setMonth,_xDate:Date.prototype.setDate,setMonth:function(num){if(num<=-1){var n=Math.ceil(-num),back_year=Math.ceil(n/12),month=(n%12)?12-n%12:0;this.setFullYear(this.getFullYear()-back_year);return this._xMonth(month);}else{return this._xMonth(num);}},setDate:function(d){return this.setTime(this.getTime()-(this.getDate()-d)*864e5);}});}
Ext.util.MixedCollection=function(allowFunctions,keyFn){this.items=[];this.map={};this.keys=[];this.length=0;this.addEvents('clear','add','replace','remove','sort');this.allowFunctions=allowFunctions===true;if(keyFn){this.getKey=keyFn;}
Ext.util.MixedCollection.superclass.constructor.call(this);};Ext.extend(Ext.util.MixedCollection,Ext.util.Observable,{allowFunctions:false,add:function(key,o){if(arguments.length==1){o=arguments[0];key=this.getKey(o);}
if(typeof key!='undefined'&&key!==null){var old=this.map[key];if(typeof old!='undefined'){return this.replace(key,o);}
this.map[key]=o;}
this.length++;this.items.push(o);this.keys.push(key);this.fireEvent('add',this.length-1,o,key);return o;},getKey:function(o){return o.id;},replace:function(key,o){if(arguments.length==1){o=arguments[0];key=this.getKey(o);}
var old=this.map[key];if(typeof key=='undefined'||key===null||typeof old=='undefined'){return this.add(key,o);}
var index=this.indexOfKey(key);this.items[index]=o;this.map[key]=o;this.fireEvent('replace',key,old,o);return o;},addAll:function(objs){if(arguments.length>1||Ext.isArray(objs)){var args=arguments.length>1?arguments:objs;for(var i=0,len=args.length;i<len;i++){this.add(args[i]);}}else{for(var key in objs){if(this.allowFunctions||typeof objs[key]!='function'){this.add(key,objs[key]);}}}},each:function(fn,scope){var items=[].concat(this.items);for(var i=0,len=items.length;i<len;i++){if(fn.call(scope||items[i],items[i],i,len)===false){break;}}},eachKey:function(fn,scope){for(var i=0,len=this.keys.length;i<len;i++){fn.call(scope||window,this.keys[i],this.items[i],i,len);}},find:function(fn,scope){for(var i=0,len=this.items.length;i<len;i++){if(fn.call(scope||window,this.items[i],this.keys[i])){return this.items[i];}}
return null;},insert:function(index,key,o){if(arguments.length==2){o=arguments[1];key=this.getKey(o);}
if(this.containsKey(key)){this.suspendEvents();this.removeKey(key);this.resumeEvents();}
if(index>=this.length){return this.add(key,o);}
this.length++;this.items.splice(index,0,o);if(typeof key!='undefined'&&key!==null){this.map[key]=o;}
this.keys.splice(index,0,key);this.fireEvent('add',index,o,key);return o;},remove:function(o){return this.removeAt(this.indexOf(o));},removeAt:function(index){if(index<this.length&&index>=0){this.length--;var o=this.items[index];this.items.splice(index,1);var key=this.keys[index];if(typeof key!='undefined'){delete this.map[key];}
this.keys.splice(index,1);this.fireEvent('remove',o,key);return o;}
return false;},removeKey:function(key){return this.removeAt(this.indexOfKey(key));},getCount:function(){return this.length;},indexOf:function(o){return this.items.indexOf(o);},indexOfKey:function(key){return this.keys.indexOf(key);},item:function(key){var mk=this.map[key],item=mk!==undefined?mk:(typeof key=='number')?this.items[key]:undefined;return typeof item!='function'||this.allowFunctions?item:null;},itemAt:function(index){return this.items[index];},key:function(key){return this.map[key];},contains:function(o){return this.indexOf(o)!=-1;},containsKey:function(key){return typeof this.map[key]!='undefined';},clear:function(){this.length=0;this.items=[];this.keys=[];this.map={};this.fireEvent('clear');},first:function(){return this.items[0];},last:function(){return this.items[this.length-1];},_sort:function(property,dir,fn){var i,len,dsc=String(dir).toUpperCase()=='DESC'?-1:1,c=[],keys=this.keys,items=this.items;fn=fn||function(a,b){return a-b;};for(i=0,len=items.length;i<len;i++){c[c.length]={key:keys[i],value:items[i],index:i};}
c.sort(function(a,b){var v=fn(a[property],b[property])*dsc;if(v===0){v=(a.index<b.index?-1:1);}
return v;});for(i=0,len=c.length;i<len;i++){items[i]=c[i].value;keys[i]=c[i].key;}
this.fireEvent('sort',this);},sort:function(dir,fn){this._sort('value',dir,fn);},reorder:function(mapping){this.suspendEvents();var items=this.items,index=0,length=items.length,order=[],remaining=[];for(oldIndex in mapping){order[mapping[oldIndex]]=items[oldIndex];}
for(index=0;index<length;index++){if(mapping[index]==undefined){remaining.push(items[index]);}}
for(index=0;index<length;index++){if(order[index]==undefined){order[index]=remaining.shift();}}
this.clear();this.addAll(order);this.resumeEvents();this.fireEvent('sort',this);},keySort:function(dir,fn){this._sort('key',dir,fn||function(a,b){var v1=String(a).toUpperCase(),v2=String(b).toUpperCase();return v1>v2?1:(v1<v2?-1:0);});},getRange:function(start,end){var items=this.items;if(items.length<1){return[];}
start=start||0;end=Math.min(typeof end=='undefined'?this.length-1:end,this.length-1);var i,r=[];if(start<=end){for(i=start;i<=end;i++){r[r.length]=items[i];}}else{for(i=start;i>=end;i--){r[r.length]=items[i];}}
return r;},filter:function(property,value,anyMatch,caseSensitive){if(Ext.isEmpty(value,false)){return this.clone();}
value=this.createValueMatcher(value,anyMatch,caseSensitive);return this.filterBy(function(o){return o&&value.test(o[property]);});},filterBy:function(fn,scope){var r=new Ext.util.MixedCollection();r.getKey=this.getKey;var k=this.keys,it=this.items;for(var i=0,len=it.length;i<len;i++){if(fn.call(scope||this,it[i],k[i])){r.add(k[i],it[i]);}}
return r;},findIndex:function(property,value,start,anyMatch,caseSensitive){if(Ext.isEmpty(value,false)){return-1;}
value=this.createValueMatcher(value,anyMatch,caseSensitive);return this.findIndexBy(function(o){return o&&value.test(o[property]);},null,start);},findIndexBy:function(fn,scope,start){var k=this.keys,it=this.items;for(var i=(start||0),len=it.length;i<len;i++){if(fn.call(scope||this,it[i],k[i])){return i;}}
return-1;},createValueMatcher:function(value,anyMatch,caseSensitive,exactMatch){if(!value.exec){var er=Ext.escapeRe;value=String(value);if(anyMatch===true){value=er(value);}else{value='^'+er(value);if(exactMatch===true){value+='$';}}
value=new RegExp(value,caseSensitive?'':'i');}
return value;},clone:function(){var r=new Ext.util.MixedCollection();var k=this.keys,it=this.items;for(var i=0,len=it.length;i<len;i++){r.add(k[i],it[i]);}
r.getKey=this.getKey;return r;}});Ext.util.MixedCollection.prototype.get=Ext.util.MixedCollection.prototype.item;Ext.util.JSON=new(function(){var useHasOwn=!!{}.hasOwnProperty,isNative=function(){var useNative=null;return function(){if(useNative===null){useNative=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=='[object JSON]';}
return useNative;};}(),pad=function(n){return n<10?"0"+n:n;},doDecode=function(json){return eval("("+json+')');},doEncode=function(o){if(!Ext.isDefined(o)||o===null){return"null";}else if(Ext.isArray(o)){return encodeArray(o);}else if(Ext.isDate(o)){return Ext.util.JSON.encodeDate(o);}else if(Ext.isString(o)){return encodeString(o);}else if(typeof o=="number"){return isFinite(o)?String(o):"null";}else if(Ext.isBoolean(o)){return String(o);}else{var a=["{"],b,i,v;for(i in o){if(!o.getElementsByTagName){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(',');}
a.push(doEncode(i),":",v===null?"null":doEncode(v));b=true;}}}}
a.push("}");return a.join("");}},m={"\b":'\\b',"\t":'\\t',"\n":'\\n',"\f":'\\f',"\r":'\\r','"':'\\"',"\\":'\\\\'},encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c;}
c=b.charCodeAt();return"\\u00"+
Math.floor(c/16).toString(16)+
(c%16).toString(16);})+'"';}
return'"'+s+'"';},encodeArray=function(o){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i+=1){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(',');}
a.push(v===null?"null":Ext.util.JSON.encode(v));b=true;}}
a.push("]");return a.join("");};this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+
pad(o.getMonth()+1)+"-"+
pad(o.getDate())+"T"+
pad(o.getHours())+":"+
pad(o.getMinutes())+":"+
pad(o.getSeconds())+'"';};this.encode=function(){var ec;return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode;}
return ec(o);};}();this.decode=function(){var dc;return function(json){if(!dc){dc=isNative()?JSON.parse:doDecode;}
return dc(json);};}();})();Ext.encode=Ext.util.JSON.encode;Ext.decode=Ext.util.JSON.decode;Ext.util.Format=function(){var trimRe=/^\s+|\s+$/g,stripTagsRE=/<\/?[^>]+>/gi,stripScriptsRe=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,nl2brRe=/\r?\n/g;return{ellipsis:function(value,len,word){if(value&&value.length>len){if(word){var vs=value.substr(0,len-2),index=Math.max(vs.lastIndexOf(' '),vs.lastIndexOf('.'),vs.lastIndexOf('!'),vs.lastIndexOf('?'));if(index==-1||index<(len-15)){return value.substr(0,len-3)+"...";}else{return vs.substr(0,index)+"...";}}else{return value.substr(0,len-3)+"...";}}
return value;},undef:function(value){return value!==undefined?value:"";},defaultValue:function(value,defaultValue){return value!==undefined&&value!==''?value:defaultValue;},htmlEncode:function(value){return!value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");},htmlDecode:function(value){return!value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");},trim:function(value){return String(value).replace(trimRe,"");},substr:function(value,start,length){return String(value).substr(start,length);},lowercase:function(value){return String(value).toLowerCase();},uppercase:function(value){return String(value).toUpperCase();},capitalize:function(value){return!value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase();},call:function(value,fn){if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);args.unshift(value);return eval(fn).apply(window,args);}else{return eval(fn).call(window,value);}},usMoney:function(v){v=(Math.round((v-0)*100))/100;v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);v=String(v);var ps=v.split('.'),whole=ps[0],sub=ps[1]?'.'+ps[1]:'.00',r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,'$1'+','+'$2');}
v=whole+sub;if(v.charAt(0)=='-'){return'-$'+v.substr(1);}
return"$"+v;},date:function(v,format){if(!v){return"";}
if(!Ext.isDate(v)){v=new Date(Date.parse(v));}
return v.dateFormat(format||"m/d/Y");},dateRenderer:function(format){return function(v){return Ext.util.Format.date(v,format);};},stripTags:function(v){return!v?v:String(v).replace(stripTagsRE,"");},stripScripts:function(v){return!v?v:String(v).replace(stripScriptsRe,"");},fileSize:function(size){if(size<1024){return size+" bytes";}else if(size<1048576){return(Math.round(((size*10)/1024))/10)+" KB";}else{return(Math.round(((size*10)/1048576))/10)+" MB";}},math:function(){var fns={};return function(v,a){if(!fns[a]){fns[a]=new Function('v','return v '+a+';');}
return fns[a](v);}}(),round:function(value,precision){var result=Number(value);if(typeof precision=='number'){precision=Math.pow(10,precision);result=Math.round(value*precision)/precision;}
return result;},number:function(v,format){if(!format){return v;}
v=Ext.num(v,NaN);if(isNaN(v)){return'';}
var comma=',',dec='.',i18n=false,neg=v<0;v=Math.abs(v);if(format.substr(format.length-2)=='/i'){format=format.substr(0,format.length-2);i18n=true;comma='.';dec=',';}
var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,''):format.replace(/[^\d\.]/g,'')).split(dec);if(1<psplit.length){v=v.toFixed(psplit[1].length);}else if(2<psplit.length){throw('NumberFormatException: invalid format, formats should have no more than 1 period: '+format);}else{v=v.toFixed(0);}
var fnum=v.toString();psplit=fnum.split('.');if(hasComma){var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3;for(var i=0;i<j;i+=n){if(i!=0){n=3;}
parr[parr.length]=cnum.substr(i,n);m-=1;}
fnum=parr.join(comma);if(psplit[1]){fnum+=dec+psplit[1];}}else{if(psplit[1]){fnum=psplit[0]+dec+psplit[1];}}
return(neg?'-':'')+format.replace(/[\d,?\.?]+/,fnum);},numberRenderer:function(format){return function(v){return Ext.util.Format.number(v,format);};},plural:function(v,s,p){return v+' '+(v==1?s:(p?p:s+'s'));},nl2br:function(v){return Ext.isEmpty(v)?'':v.replace(nl2brRe,'<br/>');}}}();Ext.XTemplate=function(){Ext.XTemplate.superclass.constructor.apply(this,arguments);var me=this,s=me.html,re=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,nameRe=/^<tpl\b[^>]*?for="(.*?)"/,ifRe=/^<tpl\b[^>]*?if="(.*?)"/,execRe=/^<tpl\b[^>]*?exec="(.*?)"/,m,id=0,tpls=[],VALUES='values',PARENT='parent',XINDEX='xindex',XCOUNT='xcount',RETURN='return ',WITHVALUES='with(values){ ';s=['<tpl>',s,'</tpl>'].join('');while((m=s.match(re))){var m2=m[0].match(nameRe),m3=m[0].match(ifRe),m4=m[0].match(execRe),exp=null,fn=null,exec=null,name=m2&&m2[1]?m2[1]:'';if(m3){exp=m3&&m3[1]?m3[1]:null;if(exp){fn=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+RETURN+(Ext.util.Format.htmlDecode(exp))+'; }');}}
if(m4){exp=m4&&m4[1]?m4[1]:null;if(exp){exec=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+(Ext.util.Format.htmlDecode(exp))+'; }');}}
if(name){switch(name){case'.':name=new Function(VALUES,PARENT,WITHVALUES+RETURN+VALUES+'; }');break;case'..':name=new Function(VALUES,PARENT,WITHVALUES+RETURN+PARENT+'; }');break;default:name=new Function(VALUES,PARENT,WITHVALUES+RETURN+name+'; }');}}
tpls.push({id:id,target:name,exec:exec,test:fn,body:m[1]||''});s=s.replace(m[0],'{xtpl'+id+'}');++id;}
for(var i=tpls.length-1;i>=0;--i){me.compileTpl(tpls[i]);}
me.master=tpls[tpls.length-1];me.tpls=tpls;};Ext.extend(Ext.XTemplate,Ext.Template,{re:/\{([\w-\.\#]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,applySubTemplate:function(id,values,parent,xindex,xcount){var me=this,len,t=me.tpls[id],vs,buf=[];if((t.test&&!t.test.call(me,values,parent,xindex,xcount))||(t.exec&&t.exec.call(me,values,parent,xindex,xcount))){return'';}
vs=t.target?t.target.call(me,values,parent):values;len=vs.length;parent=t.target?values:parent;if(t.target&&Ext.isArray(vs)){for(var i=0,len=vs.length;i<len;i++){buf[buf.length]=t.compiled.call(me,vs[i],parent,i+1,len);}
return buf.join('');}
return t.compiled.call(me,vs,parent,xindex,xcount);},compileTpl:function(tpl){var fm=Ext.util.Format,useF=this.disableFormats!==true,sep=Ext.isGecko?"+":",",body;function fn(m,name,format,args,math){if(name.substr(0,4)=='xtpl'){return"'"+sep+'this.applySubTemplate('+name.substr(4)+', values, parent, xindex, xcount)'+sep+"'";}
var v;if(name==='.'){v='values';}else if(name==='#'){v='xindex';}else if(name.indexOf('.')!=-1){v=name;}else{v="values['"+name+"']";}
if(math){v='('+v+math+')';}
if(format&&useF){args=args?','+args:"";if(format.substr(0,5)!="this."){format="fm."+format+'(';}else{format='this.call("'+format.substr(5)+'", ';args=", values";}}else{args='';format="("+v+" === undefined ? '' : ";}
return"'"+sep+format+v+args+")"+sep+"'";}
function codeFn(m,code){return"'"+sep+'('+code.replace(/\\'/g,"'")+')'+sep+"'";}
if(Ext.isGecko){body="tpl.compiled = function(values, parent, xindex, xcount){ return '"+
tpl.body.replace(/(\r\n|\n)/g,'\\n').replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn)+"';};";}else{body=["tpl.compiled = function(values, parent, xindex, xcount){ return ['"];body.push(tpl.body.replace(/(\r\n|\n)/g,'\\n').replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn));body.push("'].join('');};");body=body.join('');}
eval(body);return this;},applyTemplate:function(values){return this.master.compiled.call(this,values,{},1,1);},compile:function(){return this;}});Ext.XTemplate.prototype.apply=Ext.XTemplate.prototype.applyTemplate;Ext.XTemplate.from=function(el){el=Ext.getDom(el);return new Ext.XTemplate(el.value||el.innerHTML);};Ext.util.CSS=function(){var rules=null;var doc=document;var camelRe=/(-[a-z])/gi;var camelFn=function(m,a){return a.charAt(1).toUpperCase();};return{createStyleSheet:function(cssText,id){var ss;var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id);}
if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText;}else{try{rules.appendChild(doc.createTextNode(cssText));}catch(e){rules.cssText=cssText;}
head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1]);}
this.cacheStyleSheet(ss);return ss;},removeStyleSheet:function(id){var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing);}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss);},refreshCache:function(){return this.getRules(true);},cacheStyleSheet:function(ss){if(!rules){rules={};}
try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){rules[ssRules[j].selectorText.toLowerCase()]=ssRules[j];}}catch(e){}},getRules:function(refreshCache){if(rules===null||refreshCache){rules={};var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i]);}catch(e){}}}
return rules;},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector.toLowerCase()];}
for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i].toLowerCase()];}}
return null;},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true;}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return true;}}}
return false;}};}();Ext.util.ClickRepeater=function(el,config)
{this.el=Ext.get(el);this.el.unselectable();Ext.apply(this,config);this.addEvents("mousedown","click","mouseup");if(!this.disabled){this.disabled=true;this.enable();}
if(this.handler){this.on("click",this.handler,this.scope||this);}
Ext.util.ClickRepeater.superclass.constructor.call(this);};Ext.extend(Ext.util.ClickRepeater,Ext.util.Observable,{interval:20,delay:250,preventDefault:true,stopDefault:false,timer:0,enable:function(){if(this.disabled){this.el.on('mousedown',this.handleMouseDown,this);if(Ext.isIE){this.el.on('dblclick',this.handleDblClick,this);}
if(this.preventDefault||this.stopDefault){this.el.on('click',this.eventOptions,this);}}
this.disabled=false;},disable:function(force){if(force||!this.disabled){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass);}
Ext.getDoc().un('mouseup',this.handleMouseUp,this);this.el.removeAllListeners();}
this.disabled=true;},setDisabled:function(disabled){this[disabled?'disable':'enable']();},eventOptions:function(e){if(this.preventDefault){e.preventDefault();}
if(this.stopDefault){e.stopEvent();}},destroy:function(){this.disable(true);Ext.destroy(this.el);this.purgeListeners();},handleDblClick:function(){clearTimeout(this.timer);this.el.blur();this.fireEvent("mousedown",this);this.fireEvent("click",this);},handleMouseDown:function(){clearTimeout(this.timer);this.el.blur();if(this.pressClass){this.el.addClass(this.pressClass);}
this.mousedownTime=new Date();Ext.getDoc().on("mouseup",this.handleMouseUp,this);this.el.on("mouseout",this.handleMouseOut,this);this.fireEvent("mousedown",this);this.fireEvent("click",this);if(this.accelerate){this.delay=400;}
this.timer=this.click.defer(this.delay||this.interval,this);},click:function(){this.fireEvent("click",this);this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12000):this.interval,this);},easeOutExpo:function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},handleMouseOut:function(){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass);}
this.el.on("mouseover",this.handleMouseReturn,this);},handleMouseReturn:function(){this.el.un("mouseover",this.handleMouseReturn,this);if(this.pressClass){this.el.addClass(this.pressClass);}
this.click();},handleMouseUp:function(){clearTimeout(this.timer);this.el.un("mouseover",this.handleMouseReturn,this);this.el.un("mouseout",this.handleMouseOut,this);Ext.getDoc().un("mouseup",this.handleMouseUp,this);this.el.removeClass(this.pressClass);this.fireEvent("mouseup",this);}});Ext.KeyNav=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(!this.disabled){this.disabled=true;this.enable();}};Ext.KeyNav.prototype={disabled:false,defaultEventAction:"stopEvent",forceKeyDown:false,relay:function(e){var k=e.getKey();var h=this.keyToHandler[k];if(h&&this[h]){if(this.doRelay(e,this[h],h)!==true){e[this.defaultEventAction]();}}},doRelay:function(e,h,hname){return h.call(this.scope||this,e);},enter:false,left:false,right:false,up:false,down:false,tab:false,esc:false,pageUp:false,pageDown:false,del:false,home:false,end:false,keyToHandler:{37:"left",39:"right",38:"up",40:"down",33:"pageUp",34:"pageDown",46:"del",36:"home",35:"end",13:"enter",27:"esc",9:"tab"},stopKeyUp:function(e){var k=e.getKey();if(k>=37&&k<=40){e.stopEvent();}},destroy:function(){this.disable();},enable:function(){if(this.disabled){if(Ext.isSafari2){this.el.on('keyup',this.stopKeyUp,this);}
this.el.on(this.isKeydown()?'keydown':'keypress',this.relay,this);this.disabled=false;}},disable:function(){if(!this.disabled){if(Ext.isSafari2){this.el.un('keyup',this.stopKeyUp,this);}
this.el.un(this.isKeydown()?'keydown':'keypress',this.relay,this);this.disabled=true;}},setDisabled:function(disabled){this[disabled?"disable":"enable"]();},isKeydown:function(){return this.forceKeyDown||Ext.EventManager.useKeydown;}};Ext.KeyMap=function(el,config,eventName){this.el=Ext.get(el);this.eventName=eventName||"keydown";this.bindings=[];if(config){this.addBinding(config);}
this.enable();};Ext.KeyMap.prototype={stopEvent:false,addBinding:function(config){if(Ext.isArray(config)){Ext.each(config,function(c){this.addBinding(c);},this);return;}
var keyCode=config.key,fn=config.fn||config.handler,scope=config.scope;if(config.stopEvent){this.stopEvent=config.stopEvent;}
if(typeof keyCode=="string"){var ks=[];var keyString=keyCode.toUpperCase();for(var j=0,len=keyString.length;j<len;j++){ks.push(keyString.charCodeAt(j));}
keyCode=ks;}
var keyArray=Ext.isArray(keyCode);var handler=function(e){if(this.checkModifiers(config,e)){var k=e.getKey();if(keyArray){for(var i=0,len=keyCode.length;i<len;i++){if(keyCode[i]==k){if(this.stopEvent){e.stopEvent();}
fn.call(scope||window,k,e);return;}}}else{if(k==keyCode){if(this.stopEvent){e.stopEvent();}
fn.call(scope||window,k,e);}}}};this.bindings.push(handler);},checkModifiers:function(config,e){var val,key,keys=['shift','ctrl','alt'];for(var i=0,len=keys.length;i<len;++i){key=keys[i];val=config[key];if(!(val===undefined||(val===e[key+'Key']))){return false;}}
return true;},on:function(key,fn,scope){var keyCode,shift,ctrl,alt;if(typeof key=="object"&&!Ext.isArray(key)){keyCode=key.key;shift=key.shift;ctrl=key.ctrl;alt=key.alt;}else{keyCode=key;}
this.addBinding({key:keyCode,shift:shift,ctrl:ctrl,alt:alt,fn:fn,scope:scope});},handleKeyDown:function(e){if(this.enabled){var b=this.bindings;for(var i=0,len=b.length;i<len;i++){b[i].call(this,e);}}},isEnabled:function(){return this.enabled;},enable:function(){if(!this.enabled){this.el.on(this.eventName,this.handleKeyDown,this);this.enabled=true;}},disable:function(){if(this.enabled){this.el.removeListener(this.eventName,this.handleKeyDown,this);this.enabled=false;}},setDisabled:function(disabled){this[disabled?"disable":"enable"]();}};Ext.util.TextMetrics=function(){var shared;return{measure:function(el,text,fixedWidth){if(!shared){shared=Ext.util.TextMetrics.Instance(el,fixedWidth);}
shared.bind(el);shared.setFixedWidth(fixedWidth||'auto');return shared.getSize(text);},createInstance:function(el,fixedWidth){return Ext.util.TextMetrics.Instance(el,fixedWidth);}};}();Ext.util.TextMetrics.Instance=function(bindTo,fixedWidth){var ml=new Ext.Element(document.createElement('div'));document.body.appendChild(ml.dom);ml.position('absolute');ml.setLeftTop(-1000,-1000);ml.hide();if(fixedWidth){ml.setWidth(fixedWidth);}
var instance={getSize:function(text){ml.update(text);var s=ml.getSize();ml.update('');return s;},bind:function(el){ml.setStyle(Ext.fly(el).getStyles('font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'));},setFixedWidth:function(width){ml.setWidth(width);},getWidth:function(text){ml.dom.style.width='auto';return this.getSize(text).width;},getHeight:function(text){return this.getSize(text).height;}};instance.bind(bindTo);return instance;};Ext.Element.addMethods({getTextWidth:function(text,min,max){return(Ext.util.TextMetrics.measure(this.dom,Ext.value(text,this.dom.innerHTML,true)).width).constrain(min||0,max||1000000);}});Ext.util.Cookies={set:function(name,value){var argv=arguments;var argc=arguments.length;var expires=(argc>2)?argv[2]:null;var path=(argc>3)?argv[3]:'/';var domain=(argc>4)?argv[4]:null;var secure=(argc>5)?argv[5]:false;document.cookie=name+"="+escape(value)+((expires===null)?"":("; expires="+expires.toGMTString()))+((path===null)?"":("; path="+path))+((domain===null)?"":("; domain="+domain))+((secure===true)?"; secure":"");},get:function(name){var arg=name+"=";var alen=arg.length;var clen=document.cookie.length;var i=0;var j=0;while(i<clen){j=i+alen;if(document.cookie.substring(i,j)==arg){return Ext.util.Cookies.getCookieVal(j);}
i=document.cookie.indexOf(" ",i)+1;if(i===0){break;}}
return null;},clear:function(name){if(Ext.util.Cookies.get(name)){document.cookie=name+"="+"; expires=Thu, 01-Jan-70 00:00:01 GMT";}},getCookieVal:function(offset){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1){endstr=document.cookie.length;}
return unescape(document.cookie.substring(offset,endstr));}};Ext.handleError=function(e){throw e;};Ext.Error=function(message){this.message=(this.lang[message])?this.lang[message]:message;};Ext.Error.prototype=new Error();Ext.apply(Ext.Error.prototype,{lang:{},name:'Ext.Error',getName:function(){return this.name;},getMessage:function(){return this.message;},toJson:function(){return Ext.encode(this);}});Ext.ComponentMgr=function(){var all=new Ext.util.MixedCollection();var types={};var ptypes={};return{register:function(c){all.add(c);},unregister:function(c){all.remove(c);},get:function(id){return all.get(id);},onAvailable:function(id,fn,scope){all.on("add",function(index,o){if(o.id==id){fn.call(scope||o,o);all.un("add",fn,scope);}});},all:all,types:types,ptypes:ptypes,isRegistered:function(xtype){return types[xtype]!==undefined;},isPluginRegistered:function(ptype){return ptypes[ptype]!==undefined;},registerType:function(xtype,cls){types[xtype]=cls;cls.xtype=xtype;},create:function(config,defaultType){return config.render?config:new types[config.xtype||defaultType](config);},registerPlugin:function(ptype,cls){ptypes[ptype]=cls;cls.ptype=ptype;},createPlugin:function(config,defaultType){var PluginCls=ptypes[config.ptype||defaultType];if(PluginCls.init){return PluginCls;}else{return new PluginCls(config);}}};}();Ext.reg=Ext.ComponentMgr.registerType;Ext.preg=Ext.ComponentMgr.registerPlugin;Ext.create=Ext.ComponentMgr.create;Ext.Component=function(config){config=config||{};if(config.initialConfig){if(config.isAction){this.baseAction=config;}
config=config.initialConfig;}else if(config.tagName||config.dom||Ext.isString(config)){config={applyTo:config,id:config.id||config};}
this.initialConfig=config;Ext.apply(this,config);this.addEvents('added','disable','enable','beforeshow','show','beforehide','hide','removed','beforerender','render','afterrender','beforedestroy','destroy','beforestaterestore','staterestore','beforestatesave','statesave');this.getId();Ext.ComponentMgr.register(this);Ext.Component.superclass.constructor.call(this);if(this.baseAction){this.baseAction.addComponent(this);}
this.initComponent();if(this.plugins){if(Ext.isArray(this.plugins)){for(var i=0,len=this.plugins.length;i<len;i++){this.plugins[i]=this.initPlugin(this.plugins[i]);}}else{this.plugins=this.initPlugin(this.plugins);}}
if(this.stateful!==false){this.initState();}
if(this.applyTo){this.applyToMarkup(this.applyTo);delete this.applyTo;}else if(this.renderTo){this.render(this.renderTo);delete this.renderTo;}};Ext.Component.AUTO_ID=1000;Ext.extend(Ext.Component,Ext.util.Observable,{disabled:false,hidden:false,autoEl:'div',disabledClass:'x-item-disabled',allowDomMove:true,autoShow:false,hideMode:'display',hideParent:false,rendered:false,tplWriteMode:'overwrite',bubbleEvents:[],ctype:'Ext.Component',actionMode:'el',getActionEl:function(){return this[this.actionMode];},initPlugin:function(p){if(p.ptype&&!Ext.isFunction(p.init)){p=Ext.ComponentMgr.createPlugin(p);}else if(Ext.isString(p)){p=Ext.ComponentMgr.createPlugin({ptype:p});}
p.init(this);return p;},initComponent:function(){if(this.listeners){this.on(this.listeners);delete this.listeners;}
this.enableBubble(this.bubbleEvents);},render:function(container,position){if(!this.rendered&&this.fireEvent('beforerender',this)!==false){if(!container&&this.el){this.el=Ext.get(this.el);container=this.el.dom.parentNode;this.allowDomMove=false;}
this.container=Ext.get(container);if(this.ctCls){this.container.addClass(this.ctCls);}
this.rendered=true;if(position!==undefined){if(Ext.isNumber(position)){position=this.container.dom.childNodes[position];}else{position=Ext.getDom(position);}}
this.onRender(this.container,position||null);if(this.autoShow){this.el.removeClass(['x-hidden','x-hide-'+this.hideMode]);}
if(this.cls){this.el.addClass(this.cls);delete this.cls;}
if(this.style){this.el.applyStyles(this.style);delete this.style;}
if(this.overCls){this.el.addClassOnOver(this.overCls);}
this.fireEvent('render',this);var contentTarget=this.getContentTarget();if(this.html){contentTarget.update(Ext.DomHelper.markup(this.html));delete this.html;}
if(this.contentEl){var ce=Ext.getDom(this.contentEl);Ext.fly(ce).removeClass(['x-hidden','x-hide-display']);contentTarget.appendChild(ce);}
if(this.tpl){if(!this.tpl.compile){this.tpl=new Ext.XTemplate(this.tpl);}
if(this.data){this.tpl[this.tplWriteMode](contentTarget,this.data);delete this.data;}}
this.afterRender(this.container);if(this.hidden){this.doHide();}
if(this.disabled){this.disable(true);}
if(this.stateful!==false){this.initStateEvents();}
this.fireEvent('afterrender',this);}
return this;},update:function(htmlOrData,loadScripts,cb){var contentTarget=this.getContentTarget();if(this.tpl&&typeof htmlOrData!=="string"){this.tpl[this.tplWriteMode](contentTarget,htmlOrData||{});}else{var html=Ext.isObject(htmlOrData)?Ext.DomHelper.markup(htmlOrData):htmlOrData;contentTarget.update(html,loadScripts,cb);}},onAdded:function(container,pos){this.ownerCt=container;this.initRef();this.fireEvent('added',this,container,pos);},onRemoved:function(){this.removeRef();this.fireEvent('removed',this,this.ownerCt);delete this.ownerCt;},initRef:function(){if(this.ref&&!this.refOwner){var levels=this.ref.split('/'),last=levels.length,i=0,t=this;while(t&&i<last){t=t.ownerCt;++i;}
if(t){t[this.refName=levels[--i]]=this;this.refOwner=t;}}},removeRef:function(){if(this.refOwner&&this.refName){delete this.refOwner[this.refName];delete this.refOwner;}},initState:function(){if(Ext.state.Manager){var id=this.getStateId();if(id){var state=Ext.state.Manager.get(id);if(state){if(this.fireEvent('beforestaterestore',this,state)!==false){this.applyState(Ext.apply({},state));this.fireEvent('staterestore',this,state);}}}}},getStateId:function(){return this.stateId||((/^(ext-comp-|ext-gen)/).test(String(this.id))?null:this.id);},initStateEvents:function(){if(this.stateEvents){for(var i=0,e;e=this.stateEvents[i];i++){this.on(e,this.saveState,this,{delay:100});}}},applyState:function(state){if(state){Ext.apply(this,state);}},getState:function(){return null;},saveState:function(){if(Ext.state.Manager&&this.stateful!==false){var id=this.getStateId();if(id){var state=this.getState();if(this.fireEvent('beforestatesave',this,state)!==false){Ext.state.Manager.set(id,state);this.fireEvent('statesave',this,state);}}}},applyToMarkup:function(el){this.allowDomMove=false;this.el=Ext.get(el);this.render(this.el.dom.parentNode);},addClass:function(cls){if(this.el){this.el.addClass(cls);}else{this.cls=this.cls?this.cls+' '+cls:cls;}
return this;},removeClass:function(cls){if(this.el){this.el.removeClass(cls);}else if(this.cls){this.cls=this.cls.split(' ').remove(cls).join(' ');}
return this;},onRender:function(ct,position){if(!this.el&&this.autoEl){if(Ext.isString(this.autoEl)){this.el=document.createElement(this.autoEl);}else{var div=document.createElement('div');Ext.DomHelper.overwrite(div,this.autoEl);this.el=div.firstChild;}
if(!this.el.id){this.el.id=this.getId();}}
if(this.el){this.el=Ext.get(this.el);if(this.allowDomMove!==false){ct.dom.insertBefore(this.el.dom,position);if(div){Ext.removeNode(div);div=null;}}}},getAutoCreate:function(){var cfg=Ext.isObject(this.autoCreate)?this.autoCreate:Ext.apply({},this.defaultAutoCreate);if(this.id&&!cfg.id){cfg.id=this.id;}
return cfg;},afterRender:Ext.emptyFn,destroy:function(){if(!this.isDestroyed){if(this.fireEvent('beforedestroy',this)!==false){this.destroying=true;this.beforeDestroy();if(this.ownerCt&&this.ownerCt.remove){this.ownerCt.remove(this,false);}
if(this.rendered){this.el.remove();if(this.actionMode=='container'||this.removeMode=='container'){this.container.remove();}}
if(this.focusTask&&this.focusTask.cancel){this.focusTask.cancel();}
this.onDestroy();Ext.ComponentMgr.unregister(this);this.fireEvent('destroy',this);this.purgeListeners();this.destroying=false;this.isDestroyed=true;}}},deleteMembers:function(){var args=arguments;for(var i=0,len=args.length;i<len;++i){delete this[args[i]];}},beforeDestroy:Ext.emptyFn,onDestroy:Ext.emptyFn,getEl:function(){return this.el;},getContentTarget:function(){return this.el;},getId:function(){return this.id||(this.id='ext-comp-'+(++Ext.Component.AUTO_ID));},getItemId:function(){return this.itemId||this.getId();},focus:function(selectText,delay){if(delay){this.focusTask=new Ext.util.DelayedTask(this.focus,this,[selectText,false]);this.focusTask.delay(Ext.isNumber(delay)?delay:10);return;}
if(this.rendered&&!this.isDestroyed){this.el.focus();if(selectText===true){this.el.dom.select();}}
return this;},blur:function(){if(this.rendered){this.el.blur();}
return this;},disable:function(silent){if(this.rendered){this.onDisable();}
this.disabled=true;if(silent!==true){this.fireEvent('disable',this);}
return this;},onDisable:function(){this.getActionEl().addClass(this.disabledClass);this.el.dom.disabled=true;},enable:function(){if(this.rendered){this.onEnable();}
this.disabled=false;this.fireEvent('enable',this);return this;},onEnable:function(){this.getActionEl().removeClass(this.disabledClass);this.el.dom.disabled=false;},setDisabled:function(disabled){return this[disabled?'disable':'enable']();},show:function(){if(this.fireEvent('beforeshow',this)!==false){this.hidden=false;if(this.autoRender){this.render(Ext.isBoolean(this.autoRender)?Ext.getBody():this.autoRender);}
if(this.rendered){this.onShow();}
this.fireEvent('show',this);}
return this;},onShow:function(){this.getVisibilityEl().removeClass('x-hide-'+this.hideMode);},hide:function(){if(this.fireEvent('beforehide',this)!==false){this.doHide();this.fireEvent('hide',this);}
return this;},doHide:function(){this.hidden=true;if(this.rendered){this.onHide();}},onHide:function(){this.getVisibilityEl().addClass('x-hide-'+this.hideMode);},getVisibilityEl:function(){return this.hideParent?this.container:this.getActionEl();},setVisible:function(visible){return this[visible?'show':'hide']();},isVisible:function(){return this.rendered&&this.getVisibilityEl().isVisible();},cloneConfig:function(overrides){overrides=overrides||{};var id=overrides.id||Ext.id();var cfg=Ext.applyIf(overrides,this.initialConfig);cfg.id=id;return new this.constructor(cfg);},getXType:function(){return this.constructor.xtype;},isXType:function(xtype,shallow){if(Ext.isFunction(xtype)){xtype=xtype.xtype;}else if(Ext.isObject(xtype)){xtype=xtype.constructor.xtype;}
return!shallow?('/'+this.getXTypes()+'/').indexOf('/'+xtype+'/')!=-1:this.constructor.xtype==xtype;},getXTypes:function(){var tc=this.constructor;if(!tc.xtypes){var c=[],sc=this;while(sc&&sc.constructor.xtype){c.unshift(sc.constructor.xtype);sc=sc.constructor.superclass;}
tc.xtypeChain=c;tc.xtypes=c.join('/');}
return tc.xtypes;},findParentBy:function(fn){for(var p=this.ownerCt;(p!=null)&&!fn(p,this);p=p.ownerCt);return p||null;},findParentByType:function(xtype){return Ext.isFunction(xtype)?this.findParentBy(function(p){return p.constructor===xtype;}):this.findParentBy(function(p){return p.constructor.xtype===xtype;});},getPositionEl:function(){return this.positionEl||this.el;},purgeListeners:function(){Ext.Component.superclass.purgeListeners.call(this);if(this.mons){this.on('beforedestroy',this.clearMons,this,{single:true});}},clearMons:function(){Ext.each(this.mons,function(m){m.item.un(m.ename,m.fn,m.scope);},this);this.mons=[];},createMons:function(){if(!this.mons){this.mons=[];this.on('beforedestroy',this.clearMons,this,{single:true});}},mon:function(item,ename,fn,scope,opt){this.createMons();if(Ext.isObject(ename)){var propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;var o=ename;for(var e in o){if(propRe.test(e)){continue;}
if(Ext.isFunction(o[e])){this.mons.push({item:item,ename:e,fn:o[e],scope:o.scope});item.on(e,o[e],o.scope,o);}else{this.mons.push({item:item,ename:e,fn:o[e],scope:o.scope});item.on(e,o[e]);}}
return;}
this.mons.push({item:item,ename:ename,fn:fn,scope:scope});item.on(ename,fn,scope,opt);},mun:function(item,ename,fn,scope){var found,mon;this.createMons();for(var i=0,len=this.mons.length;i<len;++i){mon=this.mons[i];if(item===mon.item&&ename==mon.ename&&fn===mon.fn&&scope===mon.scope){this.mons.splice(i,1);item.un(ename,fn,scope);found=true;break;}}
return found;},nextSibling:function(){if(this.ownerCt){var index=this.ownerCt.items.indexOf(this);if(index!=-1&&index+1<this.ownerCt.items.getCount()){return this.ownerCt.items.itemAt(index+1);}}
return null;},previousSibling:function(){if(this.ownerCt){var index=this.ownerCt.items.indexOf(this);if(index>0){return this.ownerCt.items.itemAt(index-1);}}
return null;},getBubbleTarget:function(){return this.ownerCt;}});Ext.reg('component',Ext.Component);Ext.Action=Ext.extend(Object,{constructor:function(config){this.initialConfig=config;this.itemId=config.itemId=(config.itemId||config.id||Ext.id());this.items=[];},isAction:true,setText:function(text){this.initialConfig.text=text;this.callEach('setText',[text]);},getText:function(){return this.initialConfig.text;},setIconClass:function(cls){this.initialConfig.iconCls=cls;this.callEach('setIconClass',[cls]);},getIconClass:function(){return this.initialConfig.iconCls;},setDisabled:function(v){this.initialConfig.disabled=v;this.callEach('setDisabled',[v]);},enable:function(){this.setDisabled(false);},disable:function(){this.setDisabled(true);},isDisabled:function(){return this.initialConfig.disabled;},setHidden:function(v){this.initialConfig.hidden=v;this.callEach('setVisible',[!v]);},show:function(){this.setHidden(false);},hide:function(){this.setHidden(true);},isHidden:function(){return this.initialConfig.hidden;},setHandler:function(fn,scope){this.initialConfig.handler=fn;this.initialConfig.scope=scope;this.callEach('setHandler',[fn,scope]);},each:function(fn,scope){Ext.each(this.items,fn,scope);},callEach:function(fnName,args){var cs=this.items;for(var i=0,len=cs.length;i<len;i++){cs[i][fnName].apply(cs[i],args);}},addComponent:function(comp){this.items.push(comp);comp.on('destroy',this.removeComponent,this);},removeComponent:function(comp){this.items.remove(comp);},execute:function(){this.initialConfig.handler.apply(this.initialConfig.scope||window,arguments);}});(function(){Ext.Layer=function(config,existingEl){config=config||{};var dh=Ext.DomHelper;var cp=config.parentEl,pel=cp?Ext.getDom(cp):document.body;if(existingEl){this.dom=Ext.getDom(existingEl);}
if(!this.dom){var o=config.dh||{tag:'div',cls:'x-layer'};this.dom=dh.append(pel,o);}
if(config.cls){this.addClass(config.cls);}
this.constrain=config.constrain!==false;this.setVisibilityMode(Ext.Element.VISIBILITY);if(config.id){this.id=this.dom.id=config.id;}else{this.id=Ext.id(this.dom);}
this.zindex=config.zindex||this.getZIndex();this.position('absolute',this.zindex);if(config.shadow){this.shadowOffset=config.shadowOffset||4;this.shadow=new Ext.Shadow({offset:this.shadowOffset,mode:config.shadow});}else{this.shadowOffset=0;}
this.useShim=config.shim!==false&&Ext.useShims;this.useDisplay=config.useDisplay;this.hide();};var supr=Ext.Element.prototype;var shims=[];Ext.extend(Ext.Layer,Ext.Element,{getZIndex:function(){return this.zindex||parseInt((this.getShim()||this).getStyle('z-index'),10)||11000;},getShim:function(){if(!this.useShim){return null;}
if(this.shim){return this.shim;}
var shim=shims.shift();if(!shim){shim=this.createShim();shim.enableDisplayMode('block');shim.dom.style.display='none';shim.dom.style.visibility='visible';}
var pn=this.dom.parentNode;if(shim.dom.parentNode!=pn){pn.insertBefore(shim.dom,this.dom);}
shim.setStyle('z-index',this.getZIndex()-2);this.shim=shim;return shim;},hideShim:function(){if(this.shim){this.shim.setDisplayed(false);shims.push(this.shim);delete this.shim;}},disableShadow:function(){if(this.shadow){this.shadowDisabled=true;this.shadow.hide();this.lastShadowOffset=this.shadowOffset;this.shadowOffset=0;}},enableShadow:function(show){if(this.shadow){this.shadowDisabled=false;this.shadowOffset=this.lastShadowOffset;delete this.lastShadowOffset;if(show){this.sync(true);}}},sync:function(doShow){var shadow=this.shadow;if(!this.updating&&this.isVisible()&&(shadow||this.useShim)){var shim=this.getShim(),w=this.getWidth(),h=this.getHeight(),l=this.getLeft(true),t=this.getTop(true);if(shadow&&!this.shadowDisabled){if(doShow&&!shadow.isVisible()){shadow.show(this);}else{shadow.realign(l,t,w,h);}
if(shim){if(doShow){shim.show();}
var shadowAdj=shadow.el.getXY(),shimStyle=shim.dom.style,shadowSize=shadow.el.getSize();shimStyle.left=(shadowAdj[0])+'px';shimStyle.top=(shadowAdj[1])+'px';shimStyle.width=(shadowSize.width)+'px';shimStyle.height=(shadowSize.height)+'px';}}else if(shim){if(doShow){shim.show();}
shim.setSize(w,h);shim.setLeftTop(l,t);}}},destroy:function(){this.hideShim();if(this.shadow){this.shadow.hide();}
this.removeAllListeners();Ext.removeNode(this.dom);delete this.dom;},remove:function(){this.destroy();},beginUpdate:function(){this.updating=true;},endUpdate:function(){this.updating=false;this.sync(true);},hideUnders:function(negOffset){if(this.shadow){this.shadow.hide();}
this.hideShim();},constrainXY:function(){if(this.constrain){var vw=Ext.lib.Dom.getViewWidth(),vh=Ext.lib.Dom.getViewHeight();var s=Ext.getDoc().getScroll();var xy=this.getXY();var x=xy[0],y=xy[1];var so=this.shadowOffset;var w=this.dom.offsetWidth+so,h=this.dom.offsetHeight+so;var moved=false;if((x+w)>vw+s.left){x=vw-w-so;moved=true;}
if((y+h)>vh+s.top){y=vh-h-so;moved=true;}
if(x<s.left){x=s.left;moved=true;}
if(y<s.top){y=s.top;moved=true;}
if(moved){if(this.avoidY){var ay=this.avoidY;if(y<=ay&&(y+h)>=ay){y=ay-h-5;}}
xy=[x,y];this.storeXY(xy);supr.setXY.call(this,xy);this.sync();}}
return this;},isVisible:function(){return this.visible;},showAction:function(){this.visible=true;if(this.useDisplay===true){this.setDisplayed('');}else if(this.lastXY){supr.setXY.call(this,this.lastXY);}else if(this.lastLT){supr.setLeftTop.call(this,this.lastLT[0],this.lastLT[1]);}},hideAction:function(){this.visible=false;if(this.useDisplay===true){this.setDisplayed(false);}else{this.setLeftTop(-10000,-10000);}},setVisible:function(v,a,d,c,e){if(v){this.showAction();}
if(a&&v){var cb=function(){this.sync(true);if(c){c();}}.createDelegate(this);supr.setVisible.call(this,true,true,d,cb,e);}else{if(!v){this.hideUnders(true);}
var cb=c;if(a){cb=function(){this.hideAction();if(c){c();}}.createDelegate(this);}
supr.setVisible.call(this,v,a,d,cb,e);if(v){this.sync(true);}else if(!a){this.hideAction();}}
return this;},storeXY:function(xy){delete this.lastLT;this.lastXY=xy;},storeLeftTop:function(left,top){delete this.lastXY;this.lastLT=[left,top];},beforeFx:function(){this.beforeAction();return Ext.Layer.superclass.beforeFx.apply(this,arguments);},afterFx:function(){Ext.Layer.superclass.afterFx.apply(this,arguments);this.sync(this.isVisible());},beforeAction:function(){if(!this.updating&&this.shadow){this.shadow.hide();}},setLeft:function(left){this.storeLeftTop(left,this.getTop(true));supr.setLeft.apply(this,arguments);this.sync();return this;},setTop:function(top){this.storeLeftTop(this.getLeft(true),top);supr.setTop.apply(this,arguments);this.sync();return this;},setLeftTop:function(left,top){this.storeLeftTop(left,top);supr.setLeftTop.apply(this,arguments);this.sync();return this;},setXY:function(xy,a,d,c,e){this.fixDisplay();this.beforeAction();this.storeXY(xy);var cb=this.createCB(c);supr.setXY.call(this,xy,a,d,cb,e);if(!a){cb();}
return this;},createCB:function(c){var el=this;return function(){el.constrainXY();el.sync(true);if(c){c();}};},setX:function(x,a,d,c,e){this.setXY([x,this.getY()],a,d,c,e);return this;},setY:function(y,a,d,c,e){this.setXY([this.getX(),y],a,d,c,e);return this;},setSize:function(w,h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setSize.call(this,w,h,a,d,cb,e);if(!a){cb();}
return this;},setWidth:function(w,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setWidth.call(this,w,a,d,cb,e);if(!a){cb();}
return this;},setHeight:function(h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setHeight.call(this,h,a,d,cb,e);if(!a){cb();}
return this;},setBounds:function(x,y,w,h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);if(!a){this.storeXY([x,y]);supr.setXY.call(this,[x,y]);supr.setSize.call(this,w,h,a,d,cb,e);cb();}else{supr.setBounds.call(this,x,y,w,h,a,d,cb,e);}
return this;},setZIndex:function(zindex){this.zindex=zindex;this.setStyle('z-index',zindex+2);if(this.shadow){this.shadow.setZIndex(zindex+1);}
if(this.shim){this.shim.setStyle('z-index',zindex);}
return this;}});})();Ext.Shadow=function(config){Ext.apply(this,config);if(typeof this.mode!="string"){this.mode=this.defaultMode;}
var o=this.offset,a={h:0};var rad=Math.floor(this.offset/2);switch(this.mode.toLowerCase()){case"drop":a.w=0;a.l=a.t=o;a.t-=1;if(Ext.isIE){a.l-=this.offset+rad;a.t-=this.offset+rad;a.w-=rad;a.h-=rad;a.t+=1;}
break;case"sides":a.w=(o*2);a.l=-o;a.t=o-1;if(Ext.isIE){a.l-=(this.offset-rad);a.t-=this.offset+rad;a.l+=1;a.w-=(this.offset-rad)*2;a.w-=rad+1;a.h-=1;}
break;case"frame":a.w=a.h=(o*2);a.l=a.t=-o;a.t+=1;a.h-=2;if(Ext.isIE){a.l-=(this.offset-rad);a.t-=(this.offset-rad);a.l+=1;a.w-=(this.offset+rad+1);a.h-=(this.offset+rad);a.h+=1;}
break;};this.adjusts=a;};Ext.Shadow.prototype={offset:4,defaultMode:"drop",show:function(target){target=Ext.get(target);if(!this.el){this.el=Ext.Shadow.Pool.pull();if(this.el.dom.nextSibling!=target.dom){this.el.insertBefore(target);}}
this.el.setStyle("z-index",this.zIndex||parseInt(target.getStyle("z-index"),10)-1);if(Ext.isIE){this.el.dom.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius="+(this.offset)+")";}
this.realign(target.getLeft(true),target.getTop(true),target.getWidth(),target.getHeight());this.el.dom.style.display="block";},isVisible:function(){return this.el?true:false;},realign:function(l,t,w,h){if(!this.el){return;}
var a=this.adjusts,d=this.el.dom,s=d.style;var iea=0;s.left=(l+a.l)+"px";s.top=(t+a.t)+"px";var sw=(w+a.w),sh=(h+a.h),sws=sw+"px",shs=sh+"px";if(s.width!=sws||s.height!=shs){s.width=sws;s.height=shs;if(!Ext.isIE){var cn=d.childNodes;var sww=Math.max(0,(sw-12))+"px";cn[0].childNodes[1].style.width=sww;cn[1].childNodes[1].style.width=sww;cn[2].childNodes[1].style.width=sww;cn[1].style.height=Math.max(0,(sh-12))+"px";}}},hide:function(){if(this.el){this.el.dom.style.display="none";Ext.Shadow.Pool.push(this.el);delete this.el;}},setZIndex:function(z){this.zIndex=z;if(this.el){this.el.setStyle("z-index",z);}}};Ext.Shadow.Pool=function(){var p=[];var markup=Ext.isIE?'<div class="x-ie-shadow"></div>':'<div class="x-shadow"><div class="xst"><div class="xstl"></div><div class="xstc"></div><div class="xstr"></div></div><div class="xsc"><div class="xsml"></div><div class="xsmc"></div><div class="xsmr"></div></div><div class="xsb"><div class="xsbl"></div><div class="xsbc"></div><div class="xsbr"></div></div></div>';return{pull:function(){var sh=p.shift();if(!sh){sh=Ext.get(Ext.DomHelper.insertHtml("beforeBegin",document.body.firstChild,markup));sh.autoBoxAdjust=false;}
return sh;},push:function(sh){p.push(sh);}};}();Ext.BoxComponent=Ext.extend(Ext.Component,{initComponent:function(){Ext.BoxComponent.superclass.initComponent.call(this);this.addEvents('resize','move');},boxReady:false,deferHeight:false,setSize:function(w,h){if(typeof w=='object'){h=w.height;w=w.width;}
if(Ext.isDefined(w)&&Ext.isDefined(this.boxMinWidth)&&(w<this.boxMinWidth)){w=this.boxMinWidth;}
if(Ext.isDefined(h)&&Ext.isDefined(this.boxMinHeight)&&(h<this.boxMinHeight)){h=this.boxMinHeight;}
if(Ext.isDefined(w)&&Ext.isDefined(this.boxMaxWidth)&&(w>this.boxMaxWidth)){w=this.boxMaxWidth;}
if(Ext.isDefined(h)&&Ext.isDefined(this.boxMaxHeight)&&(h>this.boxMaxHeight)){h=this.boxMaxHeight;}
if(!this.boxReady){this.width=w;this.height=h;return this;}
if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==w&&this.lastSize.height==h){return this;}
this.lastSize={width:w,height:h};var adj=this.adjustSize(w,h),aw=adj.width,ah=adj.height,rz;if(aw!==undefined||ah!==undefined){rz=this.getResizeEl();if(!this.deferHeight&&aw!==undefined&&ah!==undefined){rz.setSize(aw,ah);}else if(!this.deferHeight&&ah!==undefined){rz.setHeight(ah);}else if(aw!==undefined){rz.setWidth(aw);}
this.onResize(aw,ah,w,h);this.fireEvent('resize',this,aw,ah,w,h);}
return this;},setWidth:function(width){return this.setSize(width);},setHeight:function(height){return this.setSize(undefined,height);},getSize:function(){return this.getResizeEl().getSize();},getWidth:function(){return this.getResizeEl().getWidth();},getHeight:function(){return this.getResizeEl().getHeight();},getOuterSize:function(){var el=this.getResizeEl();return{width:el.getWidth()+el.getMargins('lr'),height:el.getHeight()+el.getMargins('tb')};},getPosition:function(local){var el=this.getPositionEl();if(local===true){return[el.getLeft(true),el.getTop(true)];}
return this.xy||el.getXY();},getBox:function(local){var pos=this.getPosition(local);var s=this.getSize();s.x=pos[0];s.y=pos[1];return s;},updateBox:function(box){this.setSize(box.width,box.height);this.setPagePosition(box.x,box.y);return this;},getResizeEl:function(){return this.resizeEl||this.el;},setAutoScroll:function(scroll){if(this.rendered){this.getContentTarget().setOverflow(scroll?'auto':'');}
this.autoScroll=scroll;return this;},setPosition:function(x,y){if(x&&typeof x[1]=='number'){y=x[1];x=x[0];}
this.x=x;this.y=y;if(!this.boxReady){return this;}
var adj=this.adjustPosition(x,y);var ax=adj.x,ay=adj.y;var el=this.getPositionEl();if(ax!==undefined||ay!==undefined){if(ax!==undefined&&ay!==undefined){el.setLeftTop(ax,ay);}else if(ax!==undefined){el.setLeft(ax);}else if(ay!==undefined){el.setTop(ay);}
this.onPosition(ax,ay);this.fireEvent('move',this,ax,ay);}
return this;},setPagePosition:function(x,y){if(x&&typeof x[1]=='number'){y=x[1];x=x[0];}
this.pageX=x;this.pageY=y;if(!this.boxReady){return;}
if(x===undefined||y===undefined){return;}
var p=this.getPositionEl().translatePoints(x,y);this.setPosition(p.left,p.top);return this;},afterRender:function(){Ext.BoxComponent.superclass.afterRender.call(this);if(this.resizeEl){this.resizeEl=Ext.get(this.resizeEl);}
if(this.positionEl){this.positionEl=Ext.get(this.positionEl);}
this.boxReady=true;Ext.isDefined(this.autoScroll)&&this.setAutoScroll(this.autoScroll);this.setSize(this.width,this.height);if(this.x||this.y){this.setPosition(this.x,this.y);}else if(this.pageX||this.pageY){this.setPagePosition(this.pageX,this.pageY);}},syncSize:function(){delete this.lastSize;this.setSize(this.autoWidth?undefined:this.getResizeEl().getWidth(),this.autoHeight?undefined:this.getResizeEl().getHeight());return this;},onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){},onPosition:function(x,y){},adjustSize:function(w,h){if(this.autoWidth){w='auto';}
if(this.autoHeight){h='auto';}
return{width:w,height:h};},adjustPosition:function(x,y){return{x:x,y:y};}});Ext.reg('box',Ext.BoxComponent);Ext.Spacer=Ext.extend(Ext.BoxComponent,{autoEl:'div'});Ext.reg('spacer',Ext.Spacer);Ext.SplitBar=function(dragElement,resizingElement,orientation,placement,existingProxy){this.el=Ext.get(dragElement,true);this.el.dom.unselectable="on";this.resizingEl=Ext.get(resizingElement,true);this.orientation=orientation||Ext.SplitBar.HORIZONTAL;this.minSize=0;this.maxSize=2000;this.animate=false;this.useShim=false;this.shim=null;if(!existingProxy){this.proxy=Ext.SplitBar.createProxy(this.orientation);}else{this.proxy=Ext.get(existingProxy).dom;}
this.dd=new Ext.dd.DDProxy(this.el.dom.id,"XSplitBars",{dragElId:this.proxy.id});this.dd.b4StartDrag=this.onStartProxyDrag.createDelegate(this);this.dd.endDrag=this.onEndProxyDrag.createDelegate(this);this.dragSpecs={};this.adapter=new Ext.SplitBar.BasicLayoutAdapter();this.adapter.init(this);if(this.orientation==Ext.SplitBar.HORIZONTAL){this.placement=placement||(this.el.getX()>this.resizingEl.getX()?Ext.SplitBar.LEFT:Ext.SplitBar.RIGHT);this.el.addClass("x-splitbar-h");}else{this.placement=placement||(this.el.getY()>this.resizingEl.getY()?Ext.SplitBar.TOP:Ext.SplitBar.BOTTOM);this.el.addClass("x-splitbar-v");}
this.addEvents("resize","moved","beforeresize","beforeapply");Ext.SplitBar.superclass.constructor.call(this);};Ext.extend(Ext.SplitBar,Ext.util.Observable,{onStartProxyDrag:function(x,y){this.fireEvent("beforeresize",this);this.overlay=Ext.DomHelper.append(document.body,{cls:"x-drag-overlay",html:"&#160;"},true);this.overlay.unselectable();this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.overlay.show();Ext.get(this.proxy).setDisplayed("block");var size=this.adapter.getElementSize(this);this.activeMinSize=this.getMinimumSize();this.activeMaxSize=this.getMaximumSize();var c1=size-this.activeMinSize;var c2=Math.max(this.activeMaxSize-size,0);if(this.orientation==Ext.SplitBar.HORIZONTAL){this.dd.resetConstraints();this.dd.setXConstraint(this.placement==Ext.SplitBar.LEFT?c1:c2,this.placement==Ext.SplitBar.LEFT?c2:c1,this.tickSize);this.dd.setYConstraint(0,0);}else{this.dd.resetConstraints();this.dd.setXConstraint(0,0);this.dd.setYConstraint(this.placement==Ext.SplitBar.TOP?c1:c2,this.placement==Ext.SplitBar.TOP?c2:c1,this.tickSize);}
this.dragSpecs.startSize=size;this.dragSpecs.startPoint=[x,y];Ext.dd.DDProxy.prototype.b4StartDrag.call(this.dd,x,y);},onEndProxyDrag:function(e){Ext.get(this.proxy).setDisplayed(false);var endPoint=Ext.lib.Event.getXY(e);if(this.overlay){Ext.destroy(this.overlay);delete this.overlay;}
var newSize;if(this.orientation==Ext.SplitBar.HORIZONTAL){newSize=this.dragSpecs.startSize+
(this.placement==Ext.SplitBar.LEFT?endPoint[0]-this.dragSpecs.startPoint[0]:this.dragSpecs.startPoint[0]-endPoint[0]);}else{newSize=this.dragSpecs.startSize+
(this.placement==Ext.SplitBar.TOP?endPoint[1]-this.dragSpecs.startPoint[1]:this.dragSpecs.startPoint[1]-endPoint[1]);}
newSize=Math.min(Math.max(newSize,this.activeMinSize),this.activeMaxSize);if(newSize!=this.dragSpecs.startSize){if(this.fireEvent('beforeapply',this,newSize)!==false){this.adapter.setElementSize(this,newSize);this.fireEvent("moved",this,newSize);this.fireEvent("resize",this,newSize);}}},getAdapter:function(){return this.adapter;},setAdapter:function(adapter){this.adapter=adapter;this.adapter.init(this);},getMinimumSize:function(){return this.minSize;},setMinimumSize:function(minSize){this.minSize=minSize;},getMaximumSize:function(){return this.maxSize;},setMaximumSize:function(maxSize){this.maxSize=maxSize;},setCurrentSize:function(size){var oldAnimate=this.animate;this.animate=false;this.adapter.setElementSize(this,size);this.animate=oldAnimate;},destroy:function(removeEl){Ext.destroy(this.shim,Ext.get(this.proxy));this.dd.unreg();if(removeEl){this.el.remove();}
this.purgeListeners();}});Ext.SplitBar.createProxy=function(dir){var proxy=new Ext.Element(document.createElement("div"));document.body.appendChild(proxy.dom);proxy.unselectable();var cls='x-splitbar-proxy';proxy.addClass(cls+' '+(dir==Ext.SplitBar.HORIZONTAL?cls+'-h':cls+'-v'));return proxy.dom;};Ext.SplitBar.BasicLayoutAdapter=function(){};Ext.SplitBar.BasicLayoutAdapter.prototype={init:function(s){},getElementSize:function(s){if(s.orientation==Ext.SplitBar.HORIZONTAL){return s.resizingEl.getWidth();}else{return s.resizingEl.getHeight();}},setElementSize:function(s,newSize,onComplete){if(s.orientation==Ext.SplitBar.HORIZONTAL){if(!s.animate){s.resizingEl.setWidth(newSize);if(onComplete){onComplete(s,newSize);}}else{s.resizingEl.setWidth(newSize,true,.1,onComplete,'easeOut');}}else{if(!s.animate){s.resizingEl.setHeight(newSize);if(onComplete){onComplete(s,newSize);}}else{s.resizingEl.setHeight(newSize,true,.1,onComplete,'easeOut');}}}};Ext.SplitBar.AbsoluteLayoutAdapter=function(container){this.basic=new Ext.SplitBar.BasicLayoutAdapter();this.container=Ext.get(container);};Ext.SplitBar.AbsoluteLayoutAdapter.prototype={init:function(s){this.basic.init(s);},getElementSize:function(s){return this.basic.getElementSize(s);},setElementSize:function(s,newSize,onComplete){this.basic.setElementSize(s,newSize,this.moveSplitter.createDelegate(this,[s]));},moveSplitter:function(s){var yes=Ext.SplitBar;switch(s.placement){case yes.LEFT:s.el.setX(s.resizingEl.getRight());break;case yes.RIGHT:s.el.setStyle("right",(this.container.getWidth()-s.resizingEl.getLeft())+"px");break;case yes.TOP:s.el.setY(s.resizingEl.getBottom());break;case yes.BOTTOM:s.el.setY(s.resizingEl.getTop()-s.el.getHeight());break;}}};Ext.SplitBar.VERTICAL=1;Ext.SplitBar.HORIZONTAL=2;Ext.SplitBar.LEFT=1;Ext.SplitBar.RIGHT=2;Ext.SplitBar.TOP=3;Ext.SplitBar.BOTTOM=4;Ext.Container=Ext.extend(Ext.BoxComponent,{bufferResize:50,autoDestroy:true,forceLayout:false,defaultType:'panel',resizeEvent:'resize',bubbleEvents:['add','remove'],initComponent:function(){Ext.Container.superclass.initComponent.call(this);this.addEvents('afterlayout','beforeadd','beforeremove','add','remove');var items=this.items;if(items){delete this.items;this.add(items);}},initItems:function(){if(!this.items){this.items=new Ext.util.MixedCollection(false,this.getComponentId);this.getLayout();}},setLayout:function(layout){if(this.layout&&this.layout!=layout){this.layout.setContainer(null);}
this.layout=layout;this.initItems();layout.setContainer(this);},afterRender:function(){Ext.Container.superclass.afterRender.call(this);if(!this.layout){this.layout='auto';}
if(Ext.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;this.layout=this.layoutConfig.type;}
if(Ext.isString(this.layout)){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig);}
this.setLayout(this.layout);if(this.activeItem!==undefined){var item=this.activeItem;delete this.activeItem;this.layout.setActiveItem(item);}
if(!this.ownerCt){this.doLayout(false,true);}
if(this.monitorResize===true){Ext.EventManager.onWindowResize(this.doLayout,this,[false]);}},getLayoutTarget:function(){return this.el;},getComponentId:function(comp){return comp.getItemId();},add:function(comp){this.initItems();var args=arguments.length>1;if(args||Ext.isArray(comp)){var result=[];Ext.each(args?arguments:comp,function(c){result.push(this.add(c));},this);return result;}
var c=this.lookupComponent(this.applyDefaults(comp));var index=this.items.length;if(this.fireEvent('beforeadd',this,c,index)!==false&&this.onBeforeAdd(c)!==false){this.items.add(c);c.onAdded(this,index);this.onAdd(c);this.fireEvent('add',this,c,index);}
return c;},onAdd:function(c){},onAdded:function(container,pos){this.ownerCt=container;this.initRef();this.cascade(function(c){c.initRef();});this.fireEvent('added',this,container,pos);},insert:function(index,comp){this.initItems();var a=arguments,len=a.length;if(len>2){var result=[];for(var i=len-1;i>=1;--i){result.push(this.insert(index,a[i]));}
return result;}
var c=this.lookupComponent(this.applyDefaults(comp));index=Math.min(index,this.items.length);if(this.fireEvent('beforeadd',this,c,index)!==false&&this.onBeforeAdd(c)!==false){if(c.ownerCt==this){this.items.remove(c);}
this.items.insert(index,c);c.onAdded(this,index);this.onAdd(c);this.fireEvent('add',this,c,index);}
return c;},applyDefaults:function(c){var d=this.defaults;if(d){if(Ext.isFunction(d)){d=d.call(this,c);}
if(Ext.isString(c)){c=Ext.ComponentMgr.get(c);Ext.apply(c,d);}else if(!c.events){Ext.applyIf(c,d);}else{Ext.apply(c,d);}}
return c;},onBeforeAdd:function(item){if(item.ownerCt){item.ownerCt.remove(item,false);}
if(this.hideBorders===true){item.border=(item.border===true);}},remove:function(comp,autoDestroy){this.initItems();var c=this.getComponent(comp);if(c&&this.fireEvent('beforeremove',this,c)!==false){this.doRemove(c,autoDestroy);this.fireEvent('remove',this,c);}
return c;},onRemove:function(c){},doRemove:function(c,autoDestroy){var l=this.layout,hasLayout=l&&this.rendered;if(hasLayout){l.onRemove(c);}
this.items.remove(c);c.onRemoved();this.onRemove(c);if(autoDestroy===true||(autoDestroy!==false&&this.autoDestroy)){c.destroy();}
if(hasLayout){l.afterRemove(c);}},removeAll:function(autoDestroy){this.initItems();var item,rem=[],items=[];this.items.each(function(i){rem.push(i);});for(var i=0,len=rem.length;i<len;++i){item=rem[i];this.remove(item,autoDestroy);if(item.ownerCt!==this){items.push(item);}}
return items;},getComponent:function(comp){if(Ext.isObject(comp)){comp=comp.getItemId();}
return this.items.get(comp);},lookupComponent:function(comp){if(Ext.isString(comp)){return Ext.ComponentMgr.get(comp);}else if(!comp.events){return this.createComponent(comp);}
return comp;},createComponent:function(config,defaultType){if(config.render){return config;}
var c=Ext.create(Ext.apply({ownerCt:this},config),defaultType||this.defaultType);delete c.initialConfig.ownerCt;delete c.ownerCt;return c;},canLayout:function(){var el=this.getVisibilityEl();return el&&el.dom&&!el.isStyle("display","none");},doLayout:function(shallow,force){var rendered=this.rendered,forceLayout=force||this.forceLayout;if(this.collapsed||!this.canLayout()){this.deferLayout=this.deferLayout||!shallow;if(!forceLayout){return;}
shallow=shallow&&!this.deferLayout;}else{delete this.deferLayout;}
if(rendered&&this.layout){this.layout.layout();}
if(shallow!==true&&this.items){var cs=this.items.items;for(var i=0,len=cs.length;i<len;i++){var c=cs[i];if(c.doLayout){c.doLayout(false,forceLayout);}}}
if(rendered){this.onLayout(shallow,forceLayout);}
this.hasLayout=true;delete this.forceLayout;},onLayout:Ext.emptyFn,shouldBufferLayout:function(){var hl=this.hasLayout;if(this.ownerCt){return hl?!this.hasLayoutPending():false;}
return hl;},hasLayoutPending:function(){var pending=false;this.ownerCt.bubble(function(c){if(c.layoutPending){pending=true;return false;}});return pending;},onShow:function(){Ext.Container.superclass.onShow.call(this);if(Ext.isDefined(this.deferLayout)){delete this.deferLayout;this.doLayout(true);}},getLayout:function(){if(!this.layout){var layout=new Ext.layout.AutoLayout(this.layoutConfig);this.setLayout(layout);}
return this.layout;},beforeDestroy:function(){var c;if(this.items){while(c=this.items.first()){this.doRemove(c,true);}}
if(this.monitorResize){Ext.EventManager.removeResizeListener(this.doLayout,this);}
Ext.destroy(this.layout);Ext.Container.superclass.beforeDestroy.call(this);},bubble:function(fn,scope,args){var p=this;while(p){if(fn.apply(scope||p,args||[p])===false){break;}
p=p.ownerCt;}
return this;},cascade:function(fn,scope,args){if(fn.apply(scope||this,args||[this])!==false){if(this.items){var cs=this.items.items;for(var i=0,len=cs.length;i<len;i++){if(cs[i].cascade){cs[i].cascade(fn,scope,args);}else{fn.apply(scope||cs[i],args||[cs[i]]);}}}}
return this;},findById:function(id){var m,ct=this;this.cascade(function(c){if(ct!=c&&c.id===id){m=c;return false;}});return m||null;},findByType:function(xtype,shallow){return this.findBy(function(c){return c.isXType(xtype,shallow);});},find:function(prop,value){return this.findBy(function(c){return c[prop]===value;});},findBy:function(fn,scope){var m=[],ct=this;this.cascade(function(c){if(ct!=c&&fn.call(scope||c,c,ct)===true){m.push(c);}});return m;},get:function(key){return this.items.get(key);}});Ext.Container.LAYOUTS={};Ext.reg('container',Ext.Container);Ext.layout.ContainerLayout=Ext.extend(Object,{monitorResize:false,activeItem:null,constructor:function(config){this.id=Ext.id(null,'ext-layout-');Ext.apply(this,config);},type:'container',IEMeasureHack:function(target,viewFlag){var tChildren=target.dom.childNodes,tLen=tChildren.length,c,d=[],e,i,ret;for(i=0;i<tLen;i++){c=tChildren[i];e=Ext.get(c);if(e){d[i]=e.getStyle('display');e.setStyle({display:'none'});}}
ret=target?target.getViewSize(viewFlag):{};for(i=0;i<tLen;i++){c=tChildren[i];e=Ext.get(c);if(e){e.setStyle({display:d[i]});}}
return ret;},getLayoutTargetSize:Ext.EmptyFn,layout:function(){var ct=this.container,target=ct.getLayoutTarget();if(!(this.hasLayout||Ext.isEmpty(this.targetCls))){target.addClass(this.targetCls);}
this.onLayout(ct,target);ct.fireEvent('afterlayout',ct,this);},onLayout:function(ct,target){this.renderAll(ct,target);},isValidParent:function(c,target){return target&&c.getPositionEl().dom.parentNode==(target.dom||target);},renderAll:function(ct,target){var items=ct.items.items,i,c,len=items.length;for(i=0;i<len;i++){c=items[i];if(c&&(!c.rendered||!this.isValidParent(c,target))){this.renderItem(c,i,target);}}},renderItem:function(c,position,target){if(c){if(!c.rendered){c.render(target,position);this.configureItem(c,position);}else if(!this.isValidParent(c,target)){if(Ext.isNumber(position)){position=target.dom.childNodes[position];}
target.dom.insertBefore(c.getPositionEl().dom,position||null);c.container=target;this.configureItem(c,position);}}},getRenderedItems:function(ct){var t=ct.getLayoutTarget(),cti=ct.items.items,len=cti.length,i,c,items=[];for(i=0;i<len;i++){if((c=cti[i]).rendered&&this.isValidParent(c,t)){items.push(c);}};return items;},configureItem:function(c,position){if(this.extraCls){var t=c.getPositionEl?c.getPositionEl():c;t.addClass(this.extraCls);}
if(c.doLayout&&this.forceLayout){c.doLayout();}
if(this.renderHidden&&c!=this.activeItem){c.hide();}},onRemove:function(c){if(this.activeItem==c){delete this.activeItem;}
if(c.rendered&&this.extraCls){var t=c.getPositionEl?c.getPositionEl():c;t.removeClass(this.extraCls);}},afterRemove:function(c){if(c.removeRestore){c.removeMode='container';delete c.removeRestore;}},onResize:function(){var ct=this.container,b;if(ct.collapsed){return;}
if(b=ct.bufferResize&&ct.shouldBufferLayout()){if(!this.resizeTask){this.resizeTask=new Ext.util.DelayedTask(this.runLayout,this);this.resizeBuffer=Ext.isNumber(b)?b:50;}
ct.layoutPending=true;this.resizeTask.delay(this.resizeBuffer);}else{this.runLayout();}},runLayout:function(){var ct=this.container;this.layout();ct.onLayout();delete ct.layoutPending;},setContainer:function(ct){if(this.monitorResize&&ct!=this.container){var old=this.container;if(old){old.un(old.resizeEvent,this.onResize,this);}
if(ct){ct.on(ct.resizeEvent,this.onResize,this);}}
this.container=ct;},parseMargins:function(v){if(Ext.isNumber(v)){v=v.toString();}
var ms=v.split(' '),len=ms.length;if(len==1){ms[1]=ms[2]=ms[3]=ms[0];}else if(len==2){ms[2]=ms[0];ms[3]=ms[1];}else if(len==3){ms[3]=ms[1];}
return{top:parseInt(ms[0],10)||0,right:parseInt(ms[1],10)||0,bottom:parseInt(ms[2],10)||0,left:parseInt(ms[3],10)||0};},fieldTpl:(function(){var t=new Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>','</div>');t.disableFormats=true;return t.compile();})(),destroy:function(){if(this.resizeTask&&this.resizeTask.cancel){this.resizeTask.cancel();}
if(!Ext.isEmpty(this.targetCls)){var target=this.container.getLayoutTarget();if(target){target.removeClass(this.targetCls);}}}});Ext.layout.AutoLayout=Ext.extend(Ext.layout.ContainerLayout,{type:'auto',monitorResize:true,onLayout:function(ct,target){Ext.layout.AutoLayout.superclass.onLayout.call(this,ct,target);var cs=this.getRenderedItems(ct),len=cs.length,i,c;for(i=0;i<len;i++){c=cs[i];if(c.doLayout){c.doLayout(true);}}}});Ext.Container.LAYOUTS['auto']=Ext.layout.AutoLayout;Ext.layout.FitLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:'fit',getLayoutTargetSize:function(){var target=this.container.getLayoutTarget();if(!target){return{};}
return target.getStyleSize();},onLayout:function(ct,target){Ext.layout.FitLayout.superclass.onLayout.call(this,ct,target);if(!ct.collapsed){this.setItemSize(this.activeItem||ct.items.itemAt(0),this.getLayoutTargetSize());}},setItemSize:function(item,size){if(item&&size.height>0){item.setSize(size);}}});Ext.Container.LAYOUTS['fit']=Ext.layout.FitLayout;Ext.layout.CardLayout=Ext.extend(Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,type:'card',setActiveItem:function(item){var ai=this.activeItem,ct=this.container;item=ct.getComponent(item);if(item&&ai!=item){if(ai){ai.hide();if(ai.hidden!==true){return false;}
ai.fireEvent('deactivate',ai);}
var layout=item.doLayout&&(this.layoutOnCardChange||!item.rendered);this.activeItem=item;delete item.deferLayout;item.show();this.layout();if(layout){item.doLayout();}
item.fireEvent('activate',item);}},renderAll:function(ct,target){if(this.deferredRender){this.renderItem(this.activeItem,undefined,target);}else{Ext.layout.CardLayout.superclass.renderAll.call(this,ct,target);}}});Ext.Container.LAYOUTS['card']=Ext.layout.CardLayout;Ext.layout.AnchorLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:'anchor',defaultAnchor:'100%',parseAnchorRE:/^(r|right|b|bottom)$/i,getLayoutTargetSize:function(){var target=this.container.getLayoutTarget();if(!target){return{};}
return target.getStyleSize();},onLayout:function(ct,target){Ext.layout.AnchorLayout.superclass.onLayout.call(this,ct,target);var size=this.getLayoutTargetSize();var w=size.width,h=size.height;if(w<20&&h<20){return;}
var aw,ah;if(ct.anchorSize){if(typeof ct.anchorSize=='number'){aw=ct.anchorSize;}else{aw=ct.anchorSize.width;ah=ct.anchorSize.height;}}else{aw=ct.initialConfig.width;ah=ct.initialConfig.height;}
var cs=this.getRenderedItems(ct),len=cs.length,i,c,a,cw,ch,el,vs,boxes=[];for(i=0;i<len;i++){c=cs[i];el=c.getPositionEl();if(!c.anchor&&c.items&&!Ext.isNumber(c.width)&&!(Ext.isIE6&&Ext.isStrict)){c.anchor=this.defaultAnchor;}
if(c.anchor){a=c.anchorSpec;if(!a){vs=c.anchor.split(' ');c.anchorSpec=a={right:this.parseAnchor(vs[0],c.initialConfig.width,aw),bottom:this.parseAnchor(vs[1],c.initialConfig.height,ah)};}
cw=a.right?this.adjustWidthAnchor(a.right(w)-el.getMargins('lr'),c):undefined;ch=a.bottom?this.adjustHeightAnchor(a.bottom(h)-el.getMargins('tb'),c):undefined;if(cw||ch){boxes.push({comp:c,width:cw||undefined,height:ch||undefined});}}}
for(i=0,len=boxes.length;i<len;i++){c=boxes[i];c.comp.setSize(c.width,c.height);}},parseAnchor:function(a,start,cstart){if(a&&a!='none'){var last;if(this.parseAnchorRE.test(a)){var diff=cstart-start;return function(v){if(v!==last){last=v;return v-diff;}}}else if(a.indexOf('%')!=-1){var ratio=parseFloat(a.replace('%',''))*.01;return function(v){if(v!==last){last=v;return Math.floor(v*ratio);}}}else{a=parseInt(a,10);if(!isNaN(a)){return function(v){if(v!==last){last=v;return v+a;}}}}}
return false;},adjustWidthAnchor:function(value,comp){return value;},adjustHeightAnchor:function(value,comp){return value;}});Ext.Container.LAYOUTS['anchor']=Ext.layout.AnchorLayout;Ext.layout.ColumnLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:'column',extraCls:'x-column',scrollOffset:0,targetCls:'x-column-layout-ct',isValidParent:function(c,target){return this.innerCt&&c.getPositionEl().dom.parentNode==this.innerCt.dom;},getLayoutTargetSize:function(){var target=this.container.getLayoutTarget(),ret;if(target){ret=target.getViewSize();if(Ext.isIE&&Ext.isStrict&&ret.width==0){ret=target.getStyleSize();}
ret.width-=target.getPadding('lr');ret.height-=target.getPadding('tb');}
return ret;},renderAll:function(ct,target){if(!this.innerCt){this.innerCt=target.createChild({cls:'x-column-inner'});this.innerCt.createChild({cls:'x-clear'});}
Ext.layout.ColumnLayout.superclass.renderAll.call(this,ct,this.innerCt);},onLayout:function(ct,target){var cs=ct.items.items,len=cs.length,c,i,m,margins=[];this.renderAll(ct,target);var size=this.getLayoutTargetSize();if(size.width<1&&size.height<1){return;}
var w=size.width-this.scrollOffset,h=size.height,pw=w;this.innerCt.setWidth(w);for(i=0;i<len;i++){c=cs[i];m=c.getPositionEl().getMargins('lr');margins[i]=m;if(!c.columnWidth){pw-=(c.getWidth()+m);}}
pw=pw<0?0:pw;for(i=0;i<len;i++){c=cs[i];m=margins[i];if(c.columnWidth){c.setSize(Math.floor(c.columnWidth*pw)-m);}}
if(Ext.isIE){if(i=target.getStyle('overflow')&&i!='hidden'&&!this.adjustmentPass){var ts=this.getLayoutTargetSize();if(ts.width!=size.width){this.adjustmentPass=true;this.onLayout(ct,target);}}}
delete this.adjustmentPass;}});Ext.Container.LAYOUTS['column']=Ext.layout.ColumnLayout;Ext.layout.BorderLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,rendered:false,type:'border',targetCls:'x-border-layout-ct',getLayoutTargetSize:function(){var target=this.container.getLayoutTarget();return target?target.getViewSize():{};},onLayout:function(ct,target){var collapsed,i,c,pos,items=ct.items.items,len=items.length;if(!this.rendered){collapsed=[];for(i=0;i<len;i++){c=items[i];pos=c.region;if(c.collapsed){collapsed.push(c);}
c.collapsed=false;if(!c.rendered){c.render(target,i);c.getPositionEl().addClass('x-border-panel');}
this[pos]=pos!='center'&&c.split?new Ext.layout.BorderLayout.SplitRegion(this,c.initialConfig,pos):new Ext.layout.BorderLayout.Region(this,c.initialConfig,pos);this[pos].render(target,c);}
this.rendered=true;}
var size=this.getLayoutTargetSize();if(size.width<20||size.height<20){if(collapsed){this.restoreCollapsed=collapsed;}
return;}else if(this.restoreCollapsed){collapsed=this.restoreCollapsed;delete this.restoreCollapsed;}
var w=size.width,h=size.height,centerW=w,centerH=h,centerY=0,centerX=0,n=this.north,s=this.south,west=this.west,e=this.east,c=this.center,b,m,totalWidth,totalHeight;if(!c&&Ext.layout.BorderLayout.WARN!==false){throw'No center region defined in BorderLayout '+ct.id;}
if(n&&n.isVisible()){b=n.getSize();m=n.getMargins();b.width=w-(m.left+m.right);b.x=m.left;b.y=m.top;centerY=b.height+b.y+m.bottom;centerH-=centerY;n.applyLayout(b);}
if(s&&s.isVisible()){b=s.getSize();m=s.getMargins();b.width=w-(m.left+m.right);b.x=m.left;totalHeight=(b.height+m.top+m.bottom);b.y=h-totalHeight+m.top;centerH-=totalHeight;s.applyLayout(b);}
if(west&&west.isVisible()){b=west.getSize();m=west.getMargins();b.height=centerH-(m.top+m.bottom);b.x=m.left;b.y=centerY+m.top;totalWidth=(b.width+m.left+m.right);centerX+=totalWidth;centerW-=totalWidth;west.applyLayout(b);}
if(e&&e.isVisible()){b=e.getSize();m=e.getMargins();b.height=centerH-(m.top+m.bottom);totalWidth=(b.width+m.left+m.right);b.x=w-totalWidth+m.left;b.y=centerY+m.top;centerW-=totalWidth;e.applyLayout(b);}
if(c){m=c.getMargins();var centerBox={x:centerX+m.left,y:centerY+m.top,width:centerW-(m.left+m.right),height:centerH-(m.top+m.bottom)};c.applyLayout(centerBox);}
if(collapsed){for(i=0,len=collapsed.length;i<len;i++){collapsed[i].collapse(false);}}
if(Ext.isIE&&Ext.isStrict){target.repaint();}
if(i=target.getStyle('overflow')&&i!='hidden'&&!this.adjustmentPass){var ts=this.getLayoutTargetSize();if(ts.width!=size.width||ts.height!=size.height){this.adjustmentPass=true;this.onLayout(ct,target);}}
delete this.adjustmentPass;},destroy:function(){var r=['north','south','east','west'],i,region;for(i=0;i<r.length;i++){region=this[r[i]];if(region){if(region.destroy){region.destroy();}else if(region.split){region.split.destroy(true);}}}
Ext.layout.BorderLayout.superclass.destroy.call(this);}});Ext.layout.BorderLayout.Region=function(layout,config,pos){Ext.apply(this,config);this.layout=layout;this.position=pos;this.state={};if(typeof this.margins=='string'){this.margins=this.layout.parseMargins(this.margins);}
this.margins=Ext.applyIf(this.margins||{},this.defaultMargins);if(this.collapsible){if(typeof this.cmargins=='string'){this.cmargins=this.layout.parseMargins(this.cmargins);}
if(this.collapseMode=='mini'&&!this.cmargins){this.cmargins={left:0,top:0,right:0,bottom:0};}else{this.cmargins=Ext.applyIf(this.cmargins||{},pos=='north'||pos=='south'?this.defaultNSCMargins:this.defaultEWCMargins);}}};Ext.layout.BorderLayout.Region.prototype={collapsible:false,split:false,floatable:true,minWidth:50,minHeight:50,defaultMargins:{left:0,top:0,right:0,bottom:0},defaultNSCMargins:{left:5,top:5,right:5,bottom:5},defaultEWCMargins:{left:5,top:0,right:5,bottom:0},floatingZIndex:100,isCollapsed:false,render:function(ct,p){this.panel=p;p.el.enableDisplayMode();this.targetEl=ct;this.el=p.el;var gs=p.getState,ps=this.position;p.getState=function(){return Ext.apply(gs.call(p)||{},this.state);}.createDelegate(this);if(ps!='center'){p.allowQueuedExpand=false;p.on({beforecollapse:this.beforeCollapse,collapse:this.onCollapse,beforeexpand:this.beforeExpand,expand:this.onExpand,hide:this.onHide,show:this.onShow,scope:this});if(this.collapsible||this.floatable){p.collapseEl='el';p.slideAnchor=this.getSlideAnchor();}
if(p.tools&&p.tools.toggle){p.tools.toggle.addClass('x-tool-collapse-'+ps);p.tools.toggle.addClassOnOver('x-tool-collapse-'+ps+'-over');}}},getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');tt.disableFormats=true;tt.compile();Ext.layout.BorderLayout.Region.prototype.toolTemplate=tt;}
this.collapsedEl=this.targetEl.createChild({cls:"x-layout-collapsed x-layout-collapsed-"+this.position,id:this.panel.id+'-xcollapsed'});this.collapsedEl.enableDisplayMode('block');if(this.collapseMode=='mini'){this.collapsedEl.addClass('x-layout-cmini-'+this.position);this.miniCollapsedEl=this.collapsedEl.createChild({cls:"x-layout-mini x-layout-mini-"+this.position,html:"&#160;"});this.miniCollapsedEl.addClassOnOver('x-layout-mini-over');this.collapsedEl.addClassOnOver("x-layout-collapsed-over");this.collapsedEl.on('click',this.onExpandClick,this,{stopEvent:true});}else{if(this.collapsible!==false&&!this.hideCollapseTool){var t=this.toolTemplate.append(this.collapsedEl.dom,{id:'expand-'+this.position},true);t.addClassOnOver('x-tool-expand-'+this.position+'-over');t.on('click',this.onExpandClick,this,{stopEvent:true});}
if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver("x-layout-collapsed-over");this.collapsedEl.on("click",this[this.floatable?'collapseClick':'onExpandClick'],this);}}}
return this.collapsedEl;},onExpandClick:function(e){if(this.isSlid){this.panel.expand(false);}else{this.panel.expand();}},onCollapseClick:function(e){this.panel.collapse();},beforeCollapse:function(p,animate){this.lastAnim=animate;if(this.splitEl){this.splitEl.hide();}
this.getCollapsedEl().show();var el=this.panel.getEl();this.originalZIndex=el.getStyle('z-index');el.setStyle('z-index',100);this.isCollapsed=true;this.layout.layout();},onCollapse:function(animate){this.panel.el.setStyle('z-index',1);if(this.lastAnim===false||this.panel.animCollapse===false){this.getCollapsedEl().dom.style.visibility='visible';}else{this.getCollapsedEl().slideIn(this.panel.slideAnchor,{duration:.2});}
this.state.collapsed=true;this.panel.saveState();},beforeExpand:function(animate){if(this.isSlid){this.afterSlideIn();}
var c=this.getCollapsedEl();this.el.show();if(this.position=='east'||this.position=='west'){this.panel.setSize(undefined,c.getHeight());}else{this.panel.setSize(c.getWidth(),undefined);}
c.hide();c.dom.style.visibility='hidden';this.panel.el.setStyle('z-index',this.floatingZIndex);},onExpand:function(){this.isCollapsed=false;if(this.splitEl){this.splitEl.show();}
this.layout.layout();this.panel.el.setStyle('z-index',this.originalZIndex);this.state.collapsed=false;this.panel.saveState();},collapseClick:function(e){if(this.isSlid){e.stopPropagation();this.slideIn();}else{e.stopPropagation();this.slideOut();}},onHide:function(){if(this.isCollapsed){this.getCollapsedEl().hide();}else if(this.splitEl){this.splitEl.hide();}},onShow:function(){if(this.isCollapsed){this.getCollapsedEl().show();}else if(this.splitEl){this.splitEl.show();}},isVisible:function(){return!this.panel.hidden;},getMargins:function(){return this.isCollapsed&&this.cmargins?this.cmargins:this.margins;},getSize:function(){return this.isCollapsed?this.getCollapsedEl().getSize():this.panel.getSize();},setPanel:function(panel){this.panel=panel;},getMinWidth:function(){return this.minWidth;},getMinHeight:function(){return this.minHeight;},applyLayoutCollapsed:function(box){var ce=this.getCollapsedEl();ce.setLeftTop(box.x,box.y);ce.setSize(box.width,box.height);},applyLayout:function(box){if(this.isCollapsed){this.applyLayoutCollapsed(box);}else{this.panel.setPosition(box.x,box.y);this.panel.setSize(box.width,box.height);}},beforeSlide:function(){this.panel.beforeEffect();},afterSlide:function(){this.panel.afterEffect();},initAutoHide:function(){if(this.autoHide!==false){if(!this.autoHideHd){this.autoHideSlideTask=new Ext.util.DelayedTask(this.slideIn,this);this.autoHideHd={"mouseout":function(e){if(!e.within(this.el,true)){this.autoHideSlideTask.delay(500);}},"mouseover":function(e){this.autoHideSlideTask.cancel();},scope:this};}
this.el.on(this.autoHideHd);this.collapsedEl.on(this.autoHideHd);}},clearAutoHide:function(){if(this.autoHide!==false){this.el.un("mouseout",this.autoHideHd.mouseout);this.el.un("mouseover",this.autoHideHd.mouseover);this.collapsedEl.un("mouseout",this.autoHideHd.mouseout);this.collapsedEl.un("mouseover",this.autoHideHd.mouseover);}},clearMonitor:function(){Ext.getDoc().un("click",this.slideInIf,this);},slideOut:function(){if(this.isSlid||this.el.hasActiveFx()){return;}
this.isSlid=true;var ts=this.panel.tools,dh,pc;if(ts&&ts.toggle){ts.toggle.hide();}
this.el.show();pc=this.panel.collapsed;this.panel.collapsed=false;if(this.position=='east'||this.position=='west'){dh=this.panel.deferHeight;this.panel.deferHeight=false;this.panel.setSize(undefined,this.collapsedEl.getHeight());this.panel.deferHeight=dh;}else{this.panel.setSize(this.collapsedEl.getWidth(),undefined);}
this.panel.collapsed=pc;this.restoreLT=[this.el.dom.style.left,this.el.dom.style.top];this.el.alignTo(this.collapsedEl,this.getCollapseAnchor());this.el.setStyle("z-index",this.floatingZIndex+2);this.panel.el.replaceClass('x-panel-collapsed','x-panel-floating');if(this.animFloat!==false){this.beforeSlide();this.el.slideIn(this.getSlideAnchor(),{callback:function(){this.afterSlide();this.initAutoHide();Ext.getDoc().on("click",this.slideInIf,this);},scope:this,block:true});}else{this.initAutoHide();Ext.getDoc().on("click",this.slideInIf,this);}},afterSlideIn:function(){this.clearAutoHide();this.isSlid=false;this.clearMonitor();this.el.setStyle("z-index","");this.panel.el.replaceClass('x-panel-floating','x-panel-collapsed');this.el.dom.style.left=this.restoreLT[0];this.el.dom.style.top=this.restoreLT[1];var ts=this.panel.tools;if(ts&&ts.toggle){ts.toggle.show();}},slideIn:function(cb){if(!this.isSlid||this.el.hasActiveFx()){Ext.callback(cb);return;}
this.isSlid=false;if(this.animFloat!==false){this.beforeSlide();this.el.slideOut(this.getSlideAnchor(),{callback:function(){this.el.hide();this.afterSlide();this.afterSlideIn();Ext.callback(cb);},scope:this,block:true});}else{this.el.hide();this.afterSlideIn();}},slideInIf:function(e){if(!e.within(this.el)){this.slideIn();}},anchors:{"west":"left","east":"right","north":"top","south":"bottom"},sanchors:{"west":"l","east":"r","north":"t","south":"b"},canchors:{"west":"tl-tr","east":"tr-tl","north":"tl-bl","south":"bl-tl"},getAnchor:function(){return this.anchors[this.position];},getCollapseAnchor:function(){return this.canchors[this.position];},getSlideAnchor:function(){return this.sanchors[this.position];},getAlignAdj:function(){var cm=this.cmargins;switch(this.position){case"west":return[0,0];break;case"east":return[0,0];break;case"north":return[0,0];break;case"south":return[0,0];break;}},getExpandAdj:function(){var c=this.collapsedEl,cm=this.cmargins;switch(this.position){case"west":return[-(cm.right+c.getWidth()+cm.left),0];break;case"east":return[cm.right+c.getWidth()+cm.left,0];break;case"north":return[0,-(cm.top+cm.bottom+c.getHeight())];break;case"south":return[0,cm.top+cm.bottom+c.getHeight()];break;}},destroy:function(){if(this.autoHideSlideTask&&this.autoHideSlideTask.cancel){this.autoHideSlideTask.cancel();}
Ext.destroy(this.miniCollapsedEl,this.collapsedEl);}};Ext.layout.BorderLayout.SplitRegion=function(layout,config,pos){Ext.layout.BorderLayout.SplitRegion.superclass.constructor.call(this,layout,config,pos);this.applyLayout=this.applyFns[pos];};Ext.extend(Ext.layout.BorderLayout.SplitRegion,Ext.layout.BorderLayout.Region,{splitTip:"Drag to resize.",collapsibleSplitTip:"Drag to resize. Double click to hide.",useSplitTips:false,splitSettings:{north:{orientation:Ext.SplitBar.VERTICAL,placement:Ext.SplitBar.TOP,maxFn:'getVMaxSize',minProp:'minHeight',maxProp:'maxHeight'},south:{orientation:Ext.SplitBar.VERTICAL,placement:Ext.SplitBar.BOTTOM,maxFn:'getVMaxSize',minProp:'minHeight',maxProp:'maxHeight'},east:{orientation:Ext.SplitBar.HORIZONTAL,placement:Ext.SplitBar.RIGHT,maxFn:'getHMaxSize',minProp:'minWidth',maxProp:'maxWidth'},west:{orientation:Ext.SplitBar.HORIZONTAL,placement:Ext.SplitBar.LEFT,maxFn:'getHMaxSize',minProp:'minWidth',maxProp:'maxWidth'}},applyFns:{west:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box);}
var sd=this.splitEl.dom,s=sd.style;this.panel.setPosition(box.x,box.y);var sw=sd.offsetWidth;s.left=(box.x+box.width-sw)+'px';s.top=(box.y)+'px';s.height=Math.max(0,box.height)+'px';this.panel.setSize(box.width-sw,box.height);},east:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box);}
var sd=this.splitEl.dom,s=sd.style;var sw=sd.offsetWidth;this.panel.setPosition(box.x+sw,box.y);s.left=(box.x)+'px';s.top=(box.y)+'px';s.height=Math.max(0,box.height)+'px';this.panel.setSize(box.width-sw,box.height);},north:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box);}
var sd=this.splitEl.dom,s=sd.style;var sh=sd.offsetHeight;this.panel.setPosition(box.x,box.y);s.left=(box.x)+'px';s.top=(box.y+box.height-sh)+'px';s.width=Math.max(0,box.width)+'px';this.panel.setSize(box.width,box.height-sh);},south:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box);}
var sd=this.splitEl.dom,s=sd.style;var sh=sd.offsetHeight;this.panel.setPosition(box.x,box.y+sh);s.left=(box.x)+'px';s.top=(box.y)+'px';s.width=Math.max(0,box.width)+'px';this.panel.setSize(box.width,box.height-sh);}},render:function(ct,p){Ext.layout.BorderLayout.SplitRegion.superclass.render.call(this,ct,p);var ps=this.position;this.splitEl=ct.createChild({cls:"x-layout-split x-layout-split-"+ps,html:"&#160;",id:this.panel.id+'-xsplit'});if(this.collapseMode=='mini'){this.miniSplitEl=this.splitEl.createChild({cls:"x-layout-mini x-layout-mini-"+ps,html:"&#160;"});this.miniSplitEl.addClassOnOver('x-layout-mini-over');this.miniSplitEl.on('click',this.onCollapseClick,this,{stopEvent:true});}
var s=this.splitSettings[ps];this.split=new Ext.SplitBar(this.splitEl.dom,p.el,s.orientation);this.split.tickSize=this.tickSize;this.split.placement=s.placement;this.split.getMaximumSize=this[s.maxFn].createDelegate(this);this.split.minSize=this.minSize||this[s.minProp];this.split.on("beforeapply",this.onSplitMove,this);this.split.useShim=this.useShim===true;this.maxSize=this.maxSize||this[s.maxProp];if(p.hidden){this.splitEl.hide();}
if(this.useSplitTips){this.splitEl.dom.title=this.collapsible?this.collapsibleSplitTip:this.splitTip;}
if(this.collapsible){this.splitEl.on("dblclick",this.onCollapseClick,this);}},getSize:function(){if(this.isCollapsed){return this.collapsedEl.getSize();}
var s=this.panel.getSize();if(this.position=='north'||this.position=='south'){s.height+=this.splitEl.dom.offsetHeight;}else{s.width+=this.splitEl.dom.offsetWidth;}
return s;},getHMaxSize:function(){var cmax=this.maxSize||10000;var center=this.layout.center;return Math.min(cmax,(this.el.getWidth()+center.el.getWidth())-center.getMinWidth());},getVMaxSize:function(){var cmax=this.maxSize||10000;var center=this.layout.center;return Math.min(cmax,(this.el.getHeight()+center.el.getHeight())-center.getMinHeight());},onSplitMove:function(split,newSize){var s=this.panel.getSize();this.lastSplitSize=newSize;if(this.position=='north'||this.position=='south'){this.panel.setSize(s.width,newSize);this.state.height=newSize;}else{this.panel.setSize(newSize,s.height);this.state.width=newSize;}
this.layout.layout();this.panel.saveState();return false;},getSplitBar:function(){return this.split;},destroy:function(){Ext.destroy(this.miniSplitEl,this.split,this.splitEl);Ext.layout.BorderLayout.SplitRegion.superclass.destroy.call(this);}});Ext.Container.LAYOUTS['border']=Ext.layout.BorderLayout;Ext.layout.FormLayout=Ext.extend(Ext.layout.AnchorLayout,{labelSeparator:':',trackLabels:false,type:'form',onRemove:function(c){Ext.layout.FormLayout.superclass.onRemove.call(this,c);if(this.trackLabels){c.un('show',this.onFieldShow,this);c.un('hide',this.onFieldHide,this);}
var el=c.getPositionEl(),ct=c.getItemCt&&c.getItemCt();if(c.rendered&&ct){if(el&&el.dom){el.insertAfter(ct);}
Ext.destroy(ct);Ext.destroyMembers(c,'label','itemCt');if(c.customItemCt){Ext.destroyMembers(c,'getItemCt','customItemCt');}}},setContainer:function(ct){Ext.layout.FormLayout.superclass.setContainer.call(this,ct);if(ct.labelAlign){ct.addClass('x-form-label-'+ct.labelAlign);}
if(ct.hideLabels){Ext.apply(this,{labelStyle:'display:none',elementStyle:'padding-left:0;',labelAdjust:0});}else{this.labelSeparator=ct.labelSeparator||this.labelSeparator;ct.labelWidth=ct.labelWidth||100;if(Ext.isNumber(ct.labelWidth)){var pad=Ext.isNumber(ct.labelPad)?ct.labelPad:5;Ext.apply(this,{labelAdjust:ct.labelWidth+pad,labelStyle:'width:'+ct.labelWidth+'px;',elementStyle:'padding-left:'+(ct.labelWidth+pad)+'px'});}
if(ct.labelAlign=='top'){Ext.apply(this,{labelStyle:'width:auto;',labelAdjust:0,elementStyle:'padding-left:0;'});}}},isHide:function(c){return c.hideLabel||this.container.hideLabels;},onFieldShow:function(c){c.getItemCt().removeClass('x-hide-'+c.hideMode);if(c.isComposite){c.doLayout();}},onFieldHide:function(c){c.getItemCt().addClass('x-hide-'+c.hideMode);},getLabelStyle:function(s){var ls='',items=[this.labelStyle,s];for(var i=0,len=items.length;i<len;++i){if(items[i]){ls+=items[i];if(ls.substr(-1,1)!=';'){ls+=';';}}}
return ls;},renderItem:function(c,position,target){if(c&&(c.isFormField||c.fieldLabel)&&c.inputType!='hidden'){var args=this.getTemplateArgs(c);if(Ext.isNumber(position)){position=target.dom.childNodes[position]||null;}
if(position){c.itemCt=this.fieldTpl.insertBefore(position,args,true);}else{c.itemCt=this.fieldTpl.append(target,args,true);}
if(!c.getItemCt){Ext.apply(c,{getItemCt:function(){return c.itemCt;},customItemCt:true});}
c.label=c.getItemCt().child('label.x-form-item-label');if(!c.rendered){c.render('x-form-el-'+c.id);}else if(!this.isValidParent(c,target)){Ext.fly('x-form-el-'+c.id).appendChild(c.getPositionEl());}
if(this.trackLabels){if(c.hidden){this.onFieldHide(c);}
c.on({scope:this,show:this.onFieldShow,hide:this.onFieldHide});}
this.configureItem(c);}else{Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments);}},getTemplateArgs:function(field){var noLabelSep=!field.fieldLabel||field.hideLabel;return{id:field.id,label:field.fieldLabel,itemCls:(field.itemCls||this.container.itemCls||'')+(field.hideLabel?' x-hide-label':''),clearCls:field.clearCls||'x-form-clear-left',labelStyle:this.getLabelStyle(field.labelStyle),elementStyle:this.elementStyle||'',labelSeparator:noLabelSep?'':(Ext.isDefined(field.labelSeparator)?field.labelSeparator:this.labelSeparator)};},adjustWidthAnchor:function(value,c){if(c.label&&!this.isHide(c)&&(this.container.labelAlign!='top')){var adjust=Ext.isIE6||(Ext.isIE&&!Ext.isStrict);return value-this.labelAdjust+(adjust?-3:0);}
return value;},adjustHeightAnchor:function(value,c){if(c.label&&!this.isHide(c)&&(this.container.labelAlign=='top')){return value-c.label.getHeight();}
return value;},isValidParent:function(c,target){return target&&this.container.getEl().contains(c.getPositionEl());}});Ext.Container.LAYOUTS['form']=Ext.layout.FormLayout;Ext.layout.AccordionLayout=Ext.extend(Ext.layout.FitLayout,{fill:true,autoWidth:true,titleCollapse:true,hideCollapseTool:false,collapseFirst:false,animate:false,sequence:false,activeOnTop:false,type:'accordion',renderItem:function(c){if(this.animate===false){c.animCollapse=false;}
c.collapsible=true;if(this.autoWidth){c.autoWidth=true;}
if(this.titleCollapse){c.titleCollapse=true;}
if(this.hideCollapseTool){c.hideCollapseTool=true;}
if(this.collapseFirst!==undefined){c.collapseFirst=this.collapseFirst;}
if(!this.activeItem&&!c.collapsed){this.setActiveItem(c,true);}else if(this.activeItem&&this.activeItem!=c){c.collapsed=true;}
Ext.layout.AccordionLayout.superclass.renderItem.apply(this,arguments);c.header.addClass('x-accordion-hd');c.on('beforeexpand',this.beforeExpand,this);},onRemove:function(c){Ext.layout.AccordionLayout.superclass.onRemove.call(this,c);if(c.rendered){c.header.removeClass('x-accordion-hd');}
c.un('beforeexpand',this.beforeExpand,this);},beforeExpand:function(p,anim){var ai=this.activeItem;if(ai){if(this.sequence){delete this.activeItem;if(!ai.collapsed){ai.collapse({callback:function(){p.expand(anim||true);},scope:this});return false;}}else{ai.collapse(this.animate);}}
this.setActive(p);if(this.activeOnTop){p.el.dom.parentNode.insertBefore(p.el.dom,p.el.dom.parentNode.firstChild);}
this.layout();},setItemSize:function(item,size){if(this.fill&&item){var hh=0,i,ct=this.getRenderedItems(this.container),len=ct.length,p;for(i=0;i<len;i++){if((p=ct[i])!=item&&!p.hidden){hh+=p.header.getHeight();}};size.height-=hh;item.setSize(size);}},setActiveItem:function(item){this.setActive(item,true);},setActive:function(item,expand){var ai=this.activeItem;item=this.container.getComponent(item);if(ai!=item){if(item.rendered&&item.collapsed&&expand){item.expand();}else{if(ai){ai.fireEvent('deactivate',ai);}
this.activeItem=item;item.fireEvent('activate',item);}}}});Ext.Container.LAYOUTS.accordion=Ext.layout.AccordionLayout;Ext.layout.Accordion=Ext.layout.AccordionLayout;Ext.layout.TableLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:false,type:'table',targetCls:'x-table-layout-ct',tableAttrs:null,setContainer:function(ct){Ext.layout.TableLayout.superclass.setContainer.call(this,ct);this.currentRow=0;this.currentColumn=0;this.cells=[];},onLayout:function(ct,target){var cs=ct.items.items,len=cs.length,c,i;if(!this.table){target.addClass('x-table-layout-ct');this.table=target.createChild(Ext.apply({tag:'table',cls:'x-table-layout',cellspacing:0,cn:{tag:'tbody'}},this.tableAttrs),null,true);}
this.renderAll(ct,target);},getRow:function(index){var row=this.table.tBodies[0].childNodes[index];if(!row){row=document.createElement('tr');this.table.tBodies[0].appendChild(row);}
return row;},getNextCell:function(c){var cell=this.getNextNonSpan(this.currentColumn,this.currentRow);var curCol=this.currentColumn=cell[0],curRow=this.currentRow=cell[1];for(var rowIndex=curRow;rowIndex<curRow+(c.rowspan||1);rowIndex++){if(!this.cells[rowIndex]){this.cells[rowIndex]=[];}
for(var colIndex=curCol;colIndex<curCol+(c.colspan||1);colIndex++){this.cells[rowIndex][colIndex]=true;}}
var td=document.createElement('td');if(c.cellId){td.id=c.cellId;}
var cls='x-table-layout-cell';if(c.cellCls){cls+=' '+c.cellCls;}
td.className=cls;if(c.colspan){td.colSpan=c.colspan;}
if(c.rowspan){td.rowSpan=c.rowspan;}
this.getRow(curRow).appendChild(td);return td;},getNextNonSpan:function(colIndex,rowIndex){var cols=this.columns;while((cols&&colIndex>=cols)||(this.cells[rowIndex]&&this.cells[rowIndex][colIndex])){if(cols&&colIndex>=cols){rowIndex++;colIndex=0;}else{colIndex++;}}
return[colIndex,rowIndex];},renderItem:function(c,position,target){if(!this.table){this.table=target.createChild(Ext.apply({tag:'table',cls:'x-table-layout',cellspacing:0,cn:{tag:'tbody'}},this.tableAttrs),null,true);}
if(c&&!c.rendered){c.render(this.getNextCell(c));this.configureItem(c,position);}else if(c&&!this.isValidParent(c,target)){var container=this.getNextCell(c);container.insertBefore(c.getPositionEl().dom,null);c.container=Ext.get(container);this.configureItem(c,position);}},isValidParent:function(c,target){return c.getPositionEl().up('table',5).dom.parentNode===(target.dom||target);}});Ext.Container.LAYOUTS['table']=Ext.layout.TableLayout;Ext.layout.AbsoluteLayout=Ext.extend(Ext.layout.AnchorLayout,{extraCls:'x-abs-layout-item',type:'absolute',onLayout:function(ct,target){target.position();this.paddingLeft=target.getPadding('l');this.paddingTop=target.getPadding('t');Ext.layout.AbsoluteLayout.superclass.onLayout.call(this,ct,target);},adjustWidthAnchor:function(value,comp){return value?value-comp.getPosition(true)[0]+this.paddingLeft:value;},adjustHeightAnchor:function(value,comp){return value?value-comp.getPosition(true)[1]+this.paddingTop:value;}});Ext.Container.LAYOUTS['absolute']=Ext.layout.AbsoluteLayout;Ext.layout.BoxLayout=Ext.extend(Ext.layout.ContainerLayout,{defaultMargins:{left:0,top:0,right:0,bottom:0},padding:'0',pack:'start',monitorResize:true,type:'box',scrollOffset:0,extraCls:'x-box-item',targetCls:'x-box-layout-ct',innerCls:'x-box-inner',constructor:function(config){Ext.layout.BoxLayout.superclass.constructor.call(this,config);if(Ext.isString(this.defaultMargins)){this.defaultMargins=this.parseMargins(this.defaultMargins);}},onLayout:function(container,target){Ext.layout.BoxLayout.superclass.onLayout.call(this,container,target);var items=this.getVisibleItems(container),tSize=this.getLayoutTargetSize();this.layoutTargetLastSize=tSize;this.childBoxCache=this.calculateChildBoxes(items,tSize);this.updateInnerCtSize(tSize,this.childBoxCache);this.updateChildBoxes(this.childBoxCache.boxes);this.handleTargetOverflow(tSize,container,target);},updateChildBoxes:function(boxes){for(var i=0,length=boxes.length;i<length;i++){var box=boxes[i],comp=box.component;if(box.dirtySize){comp.setSize(box.width,box.height);}
if(isNaN(box.left)||isNaN(box.top)){continue;}
comp.setPosition(box.left,box.top);}},updateInnerCtSize:Ext.emptyFn,handleTargetOverflow:function(previousTargetSize,container,target){var overflow=target.getStyle('overflow');if(overflow&&overflow!='hidden'&&!this.adjustmentPass){var newTargetSize=this.getLayoutTargetSize();if(newTargetSize.width!=previousTargetSize.width||newTargetSize.height!=previousTargetSize.height){this.adjustmentPass=true;this.onLayout(container,target);}}
delete this.adjustmentPass;},isValidParent:function(c,target){return this.innerCt&&c.getPositionEl().dom.parentNode==this.innerCt.dom;},getVisibleItems:function(ct){var ct=ct||this.container,t=ct.getLayoutTarget(),cti=ct.items.items,len=cti.length,i,c,items=[];for(i=0;i<len;i++){if((c=cti[i]).rendered&&this.isValidParent(c,t)&&c.hidden!==true&&c.collapsed!==true){items.push(c);}}
return items;},renderAll:function(ct,target){if(!this.innerCt){this.innerCt=target.createChild({cls:this.innerCls});this.padding=this.parseMargins(this.padding);}
Ext.layout.BoxLayout.superclass.renderAll.call(this,ct,this.innerCt);},getLayoutTargetSize:function(){var target=this.container.getLayoutTarget(),ret;if(target){ret=target.getViewSize();if(Ext.isIE&&Ext.isStrict&&ret.width==0){ret=target.getStyleSize();}
ret.width-=target.getPadding('lr');ret.height-=target.getPadding('tb');}
return ret;},renderItem:function(c){if(Ext.isString(c.margins)){c.margins=this.parseMargins(c.margins);}else if(!c.margins){c.margins=this.defaultMargins;}
Ext.layout.BoxLayout.superclass.renderItem.apply(this,arguments);}});Ext.layout.VBoxLayout=Ext.extend(Ext.layout.BoxLayout,{align:'left',type:'vbox',updateInnerCtSize:function(tSize,calcs){var innerCtHeight=tSize.height,innerCtWidth=calcs.meta.maxWidth+this.padding.left+this.padding.right;if(this.align=='stretch'){innerCtWidth=tSize.width;}else if(this.align=='center'){innerCtWidth=Math.max(tSize.width,innerCtWidth);}
this.innerCt.setSize(innerCtWidth||undefined,innerCtHeight||undefined);},calculateChildBoxes:function(visibleItems,targetSize){var visibleCount=visibleItems.length,padding=this.padding,topOffset=padding.top,leftOffset=padding.left,paddingVert=topOffset+padding.bottom,paddingHoriz=leftOffset+padding.right,width=targetSize.width-this.scrollOffset,height=targetSize.height,availWidth=Math.max(0,width-paddingHoriz),isStart=this.pack=='start',isCenter=this.pack=='center',isEnd=this.pack=='end',nonFlexHeight=0,maxWidth=0,totalFlex=0,boxes=[],child,childWidth,childHeight,childSize,childMargins,canLayout,i,calcs,flexedHeight,horizMargins,stretchWidth;for(i=0;i<visibleCount;i++){child=visibleItems[i];childHeight=child.height;childWidth=child.width;canLayout=!child.hasLayout&&Ext.isFunction(child.doLayout);if(!Ext.isNumber(childHeight)){if(child.flex&&!childHeight){totalFlex+=child.flex;}else{if(!childHeight&&canLayout){child.doLayout();}
childSize=child.getSize();childWidth=childSize.width;childHeight=childSize.height;}}
childMargins=child.margins;nonFlexHeight+=(childHeight||0)+childMargins.top+childMargins.bottom;if(!Ext.isNumber(childWidth)){if(canLayout){child.doLayout();}
childWidth=child.getWidth();}
maxWidth=Math.max(maxWidth,childWidth+childMargins.left+childMargins.right);boxes.push({component:child,height:childHeight||undefined,width:childWidth||undefined});}
var availableHeight=Math.max(0,(height-nonFlexHeight-paddingVert));if(isCenter){topOffset+=availableHeight/2;}else if(isEnd){topOffset+=availableHeight;}
var remainingHeight=availableHeight,remainingFlex=totalFlex;for(i=0;i<visibleCount;i++){child=visibleItems[i];calcs=boxes[i];childMargins=child.margins;horizMargins=childMargins.left+childMargins.right;topOffset+=childMargins.top;if(isStart&&child.flex&&!child.height){flexedHeight=Math.ceil((child.flex/remainingFlex)*remainingHeight);remainingHeight-=flexedHeight;remainingFlex-=child.flex;calcs.height=flexedHeight;calcs.dirtySize=true;}
calcs.left=leftOffset+childMargins.left;calcs.top=topOffset;switch(this.align){case'stretch':stretchWidth=availWidth-horizMargins;calcs.width=stretchWidth.constrain(child.minWidth||0,child.maxWidth||1000000);calcs.dirtySize=true;break;case'stretchmax':stretchWidth=maxWidth-horizMargins;calcs.width=stretchWidth.constrain(child.minWidth||0,child.maxWidth||1000000);calcs.dirtySize=true;break;case'center':var diff=availWidth-calcs.width-horizMargins;if(diff>0){calcs.left=leftOffset+horizMargins+(diff/2);}}
topOffset+=calcs.height+childMargins.bottom;}
return{boxes:boxes,meta:{maxWidth:maxWidth}};}});Ext.Container.LAYOUTS.vbox=Ext.layout.VBoxLayout;Ext.layout.HBoxLayout=Ext.extend(Ext.layout.BoxLayout,{align:'top',type:'hbox',updateInnerCtSize:function(tSize,calcs){var innerCtWidth=tSize.width,innerCtHeight=calcs.meta.maxHeight+this.padding.top+this.padding.bottom;if(this.align=='stretch'){innerCtHeight=tSize.height;}else if(this.align=='middle'){innerCtHeight=Math.max(tSize.height,innerCtHeight);}
this.innerCt.setSize(innerCtWidth||undefined,innerCtHeight||undefined);},calculateChildBoxes:function(visibleItems,targetSize){var visibleCount=visibleItems.length,padding=this.padding,topOffset=padding.top,leftOffset=padding.left,paddingVert=topOffset+padding.bottom,paddingHoriz=leftOffset+padding.right,width=targetSize.width-this.scrollOffset,height=targetSize.height,availHeight=Math.max(0,height-paddingVert),isStart=this.pack=='start',isCenter=this.pack=='center',isEnd=this.pack=='end',nonFlexWidth=0,maxHeight=0,totalFlex=0,boxes=[],child,childWidth,childHeight,childSize,childMargins,canLayout,i,calcs,flexedWidth,vertMargins,stretchHeight;for(i=0;i<visibleCount;i++){child=visibleItems[i];childHeight=child.height;childWidth=child.width;canLayout=!child.hasLayout&&Ext.isFunction(child.doLayout);if(!Ext.isNumber(childWidth)){if(child.flex&&!childWidth){totalFlex+=child.flex;}else{if(!childWidth&&canLayout){child.doLayout();}
childSize=child.getSize();childWidth=childSize.width;childHeight=childSize.height;}}
childMargins=child.margins;nonFlexWidth+=(childWidth||0)+childMargins.left+childMargins.right;if(!Ext.isNumber(childHeight)){if(canLayout){child.doLayout();}
childHeight=child.getHeight();}
maxHeight=Math.max(maxHeight,childHeight+childMargins.top+childMargins.bottom);boxes.push({component:child,height:childHeight||undefined,width:childWidth||undefined});}
var availableWidth=Math.max(0,(width-nonFlexWidth-paddingHoriz));if(isCenter){leftOffset+=availableWidth/2;}else if(isEnd){leftOffset+=availableWidth;}
var remainingWidth=availableWidth,remainingFlex=totalFlex;for(i=0;i<visibleCount;i++){child=visibleItems[i];calcs=boxes[i];childMargins=child.margins;vertMargins=childMargins.top+childMargins.bottom;leftOffset+=childMargins.left;if(isStart&&child.flex&&!child.width){flexedWidth=Math.ceil((child.flex/remainingFlex)*remainingWidth);remainingWidth-=flexedWidth;remainingFlex-=child.flex;calcs.width=flexedWidth;calcs.dirtySize=true;}
calcs.left=leftOffset;calcs.top=topOffset+childMargins.top;switch(this.align){case'stretch':stretchHeight=availHeight-vertMargins;calcs.height=stretchHeight.constrain(child.minHeight||0,child.maxHeight||1000000);calcs.dirtySize=true;break;case'stretchmax':stretchHeight=maxHeight-vertMargins;calcs.height=stretchHeight.constrain(child.minHeight||0,child.maxHeight||1000000);calcs.dirtySize=true;break;case'middle':var diff=availHeight-calcs.height-vertMargins;if(diff>0){calcs.top=topOffset+vertMargins+(diff/2);}}
leftOffset+=calcs.width+childMargins.right;}
return{boxes:boxes,meta:{maxHeight:maxHeight}};}});Ext.Container.LAYOUTS.hbox=Ext.layout.HBoxLayout;Ext.layout.ToolbarLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:'toolbar',triggerWidth:18,noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',lastOverflow:false,tableHTML:['<table cellspacing="0" class="x-toolbar-ct">','<tbody>','<tr>','<td class="x-toolbar-left" align="{0}">','<table cellspacing="0">','<tbody>','<tr class="x-toolbar-left-row"></tr>','</tbody>','</table>','</td>','<td class="x-toolbar-right" align="right">','<table cellspacing="0" class="x-toolbar-right-ct">','<tbody>','<tr>','<td>','<table cellspacing="0">','<tbody>','<tr class="x-toolbar-right-row"></tr>','</tbody>','</table>','</td>','<td>','<table cellspacing="0">','<tbody>','<tr class="x-toolbar-extras-row"></tr>','</tbody>','</table>','</td>','</tr>','</tbody>','</table>','</td>','</tr>','</tbody>','</table>'].join(""),onLayout:function(ct,target){if(!this.leftTr){var align=ct.buttonAlign=='center'?'center':'left';target.addClass('x-toolbar-layout-ct');target.insertHtml('beforeEnd',String.format(this.tableHTML,align));this.leftTr=target.child('tr.x-toolbar-left-row',true);this.rightTr=target.child('tr.x-toolbar-right-row',true);this.extrasTr=target.child('tr.x-toolbar-extras-row',true);if(this.hiddenItem==undefined){this.hiddenItems=[];}}
var side=ct.buttonAlign=='right'?this.rightTr:this.leftTr,items=ct.items.items,position=0;for(var i=0,len=items.length,c;i<len;i++,position++){c=items[i];if(c.isFill){side=this.rightTr;position=-1;}else if(!c.rendered){c.render(this.insertCell(c,side,position));}else{if(!c.xtbHidden&&!this.isValidParent(c,side.childNodes[position])){var td=this.insertCell(c,side,position);td.appendChild(c.getPositionEl().dom);c.container=Ext.get(td);}}}
this.cleanup(this.leftTr);this.cleanup(this.rightTr);this.cleanup(this.extrasTr);this.fitToSize(target);},cleanup:function(el){var cn=el.childNodes,i,c;for(i=cn.length-1;i>=0&&(c=cn[i]);i--){if(!c.firstChild){el.removeChild(c);}}},insertCell:function(c,target,position){var td=document.createElement('td');td.className='x-toolbar-cell';target.insertBefore(td,target.childNodes[position]||null);return td;},hideItem:function(item){this.hiddenItems.push(item);item.xtbHidden=true;item.xtbWidth=item.getPositionEl().dom.parentNode.offsetWidth;item.hide();},unhideItem:function(item){item.show();item.xtbHidden=false;this.hiddenItems.remove(item);},getItemWidth:function(c){return c.hidden?(c.xtbWidth||0):c.getPositionEl().dom.parentNode.offsetWidth;},fitToSize:function(target){if(this.container.enableOverflow===false){return;}
var width=target.dom.clientWidth,tableWidth=target.dom.firstChild.offsetWidth,clipWidth=width-this.triggerWidth,lastWidth=this.lastWidth||0,hiddenItems=this.hiddenItems,hasHiddens=hiddenItems.length!=0,isLarger=width>=lastWidth;this.lastWidth=width;if(tableWidth>width||(hasHiddens&&isLarger)){var items=this.container.items.items,len=items.length,loopWidth=0,item;for(var i=0;i<len;i++){item=items[i];if(!item.isFill){loopWidth+=this.getItemWidth(item);if(loopWidth>clipWidth){if(!(item.hidden||item.xtbHidden)){this.hideItem(item);}}else if(item.xtbHidden){this.unhideItem(item);}}}}
hasHiddens=hiddenItems.length!=0;if(hasHiddens){this.initMore();if(!this.lastOverflow){this.container.fireEvent('overflowchange',this.container,true);this.lastOverflow=true;}}else if(this.more){this.clearMenu();this.more.destroy();delete this.more;if(this.lastOverflow){this.container.fireEvent('overflowchange',this.container,false);this.lastOverflow=false;}}},createMenuConfig:function(component,hideOnClick){var config=Ext.apply({},component.initialConfig),group=component.toggleGroup;Ext.copyTo(config,component,['iconCls','icon','itemId','disabled','handler','scope','menu']);Ext.apply(config,{text:component.overflowText||component.text,hideOnClick:hideOnClick});if(group||component.enableToggle){Ext.apply(config,{group:group,checked:component.pressed,listeners:{checkchange:function(item,checked){component.toggle(checked);}}});}
delete config.ownerCt;delete config.xtype;delete config.id;return config;},addComponentToMenu:function(menu,component){if(component instanceof Ext.Toolbar.Separator){menu.add('-');}else if(Ext.isFunction(component.isXType)){if(component.isXType('splitbutton')){menu.add(this.createMenuConfig(component,true));}else if(component.isXType('button')){menu.add(this.createMenuConfig(component,!component.menu));}else if(component.isXType('buttongroup')){component.items.each(function(item){this.addComponentToMenu(menu,item);},this);}}},clearMenu:function(){var menu=this.moreMenu;if(menu&&menu.items){menu.items.each(function(item){delete item.menu;});}},beforeMoreShow:function(menu){var items=this.container.items.items,len=items.length,item,prev;var needsSep=function(group,item){return group.isXType('buttongroup')&&!(item instanceof Ext.Toolbar.Separator);};this.clearMenu();menu.removeAll();for(var i=0;i<len;i++){item=items[i];if(item.xtbHidden){if(prev&&(needsSep(item,prev)||needsSep(prev,item))){menu.add('-');}
this.addComponentToMenu(menu,item);prev=item;}}
if(menu.items.length<1){menu.add(this.noItemsMenuText);}},initMore:function(){if(!this.more){this.moreMenu=new Ext.menu.Menu({ownerCt:this.container,listeners:{beforeshow:this.beforeMoreShow,scope:this}});this.more=new Ext.Button({iconCls:'x-toolbar-more-icon',cls:'x-toolbar-more',menu:this.moreMenu,ownerCt:this.container});var td=this.insertCell(this.more,this.extrasTr,100);this.more.render(td);}},destroy:function(){Ext.destroy(this.more,this.moreMenu);delete this.leftTr;delete this.rightTr;delete this.extrasTr;Ext.layout.ToolbarLayout.superclass.destroy.call(this);}});Ext.Container.LAYOUTS.toolbar=Ext.layout.ToolbarLayout;Ext.layout.MenuLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:'menu',setContainer:function(ct){this.monitorResize=!ct.floating;ct.on('autosize',this.doAutoSize,this);Ext.layout.MenuLayout.superclass.setContainer.call(this,ct);},renderItem:function(c,position,target){if(!this.itemTpl){this.itemTpl=Ext.layout.MenuLayout.prototype.itemTpl=new Ext.XTemplate('<li id="{itemId}" class="{itemCls}">','<tpl if="needsIcon">','<img src="{icon}" class="{iconCls}"/>','</tpl>','</li>');}
if(c&&!c.rendered){if(Ext.isNumber(position)){position=target.dom.childNodes[position];}
var a=this.getItemArgs(c);c.render(c.positionEl=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(target,a,true));c.positionEl.menuItemId=c.getItemId();if(!a.isMenuItem&&a.needsIcon){c.positionEl.addClass('x-menu-list-item-indent');}
this.configureItem(c,position);}else if(c&&!this.isValidParent(c,target)){if(Ext.isNumber(position)){position=target.dom.childNodes[position];}
target.dom.insertBefore(c.getActionEl().dom,position||null);}},getItemArgs:function(c){var isMenuItem=c instanceof Ext.menu.Item;return{isMenuItem:isMenuItem,needsIcon:!isMenuItem&&(c.icon||c.iconCls),icon:c.icon||Ext.BLANK_IMAGE_URL,iconCls:'x-menu-item-icon '+(c.iconCls||''),itemId:'x-menu-el-'+c.id,itemCls:'x-menu-list-item '};},isValidParent:function(c,target){return c.el.up('li.x-menu-list-item',5).dom.parentNode===(target.dom||target);},onLayout:function(ct,target){Ext.layout.MenuLayout.superclass.onLayout.call(this,ct,target);this.doAutoSize();},doAutoSize:function(){var ct=this.container,w=ct.width;if(ct.floating){if(w){ct.setWidth(w);}else if(Ext.isIE){ct.setWidth(Ext.isStrict&&(Ext.isIE7||Ext.isIE8)?'auto':ct.minWidth);var el=ct.getEl(),t=el.dom.offsetWidth;ct.setWidth(ct.getLayoutTarget().getWidth()+el.getFrameWidth('lr'));}}}});Ext.Container.LAYOUTS['menu']=Ext.layout.MenuLayout;Ext.Viewport=Ext.extend(Ext.Container,{initComponent:function(){Ext.Viewport.superclass.initComponent.call(this);document.getElementsByTagName('html')[0].className+=' x-viewport';this.el=Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.dom.scroll='no';this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el;},fireResize:function(w,h){this.fireEvent('resize',this,w,h,w,h);}});Ext.reg('viewport',Ext.Viewport);Ext.Panel=Ext.extend(Ext.Container,{baseCls:'x-panel',collapsedCls:'x-panel-collapsed',maskDisabled:true,animCollapse:Ext.enableFx,headerAsText:true,buttonAlign:'right',collapsed:false,collapseFirst:true,minButtonWidth:75,elements:'body',preventBodyReset:false,padding:undefined,resizeEvent:'bodyresize',toolTarget:'header',collapseEl:'bwrap',slideAnchor:'t',disabledClass:'',deferHeight:true,expandDefaults:{duration:0.25},collapseDefaults:{duration:0.25},initComponent:function(){Ext.Panel.superclass.initComponent.call(this);this.addEvents('bodyresize','titlechange','iconchange','collapse','expand','beforecollapse','beforeexpand','beforeclose','close','activate','deactivate');if(this.unstyled){this.baseCls='x-plain';}
this.toolbars=[];if(this.tbar){this.elements+=',tbar';this.topToolbar=this.createToolbar(this.tbar);this.tbar=null;}
if(this.bbar){this.elements+=',bbar';this.bottomToolbar=this.createToolbar(this.bbar);this.bbar=null;}
if(this.header===true){this.elements+=',header';this.header=null;}else if(this.headerCfg||(this.title&&this.header!==false)){this.elements+=',header';}
if(this.footerCfg||this.footer===true){this.elements+=',footer';this.footer=null;}
if(this.buttons){this.fbar=this.buttons;this.buttons=null;}
if(this.fbar){this.createFbar(this.fbar);}
if(this.autoLoad){this.on('render',this.doAutoLoad,this,{delay:10});}},createFbar:function(fbar){var min=this.minButtonWidth;this.elements+=',footer';this.fbar=this.createToolbar(fbar,{buttonAlign:this.buttonAlign,toolbarCls:'x-panel-fbar',enableOverflow:false,defaults:function(c){return{minWidth:c.minWidth||min};}});this.fbar.items.each(function(c){c.minWidth=c.minWidth||this.minButtonWidth;},this);this.buttons=this.fbar.items.items;},createToolbar:function(tb,options){var result;if(Ext.isArray(tb)){tb={items:tb};}
result=tb.events?Ext.apply(tb,options):this.createComponent(Ext.apply({},tb,options),'toolbar');this.toolbars.push(result);return result;},createElement:function(name,pnode){if(this[name]){pnode.appendChild(this[name].dom);return;}
if(name==='bwrap'||this.elements.indexOf(name)!=-1){if(this[name+'Cfg']){this[name]=Ext.fly(pnode).createChild(this[name+'Cfg']);}else{var el=document.createElement('div');el.className=this[name+'Cls'];this[name]=Ext.get(pnode.appendChild(el));}
if(this[name+'CssClass']){this[name].addClass(this[name+'CssClass']);}
if(this[name+'Style']){this[name].applyStyles(this[name+'Style']);}}},onRender:function(ct,position){Ext.Panel.superclass.onRender.call(this,ct,position);this.createClasses();var el=this.el,d=el.dom,bw,ts;if(this.collapsible&&!this.hideCollapseTool){this.tools=this.tools?this.tools.slice(0):[];this.tools[this.collapseFirst?'unshift':'push']({id:'toggle',handler:this.toggleCollapse,scope:this});}
if(this.tools){ts=this.tools;this.elements+=(this.header!==false)?',header':'';}
this.tools={};el.addClass(this.baseCls);if(d.firstChild){this.header=el.down('.'+this.headerCls);this.bwrap=el.down('.'+this.bwrapCls);var cp=this.bwrap?this.bwrap:el;this.tbar=cp.down('.'+this.tbarCls);this.body=cp.down('.'+this.bodyCls);this.bbar=cp.down('.'+this.bbarCls);this.footer=cp.down('.'+this.footerCls);this.fromMarkup=true;}
if(this.preventBodyReset===true){el.addClass('x-panel-reset');}
if(this.cls){el.addClass(this.cls);}
if(this.buttons){this.elements+=',footer';}
if(this.frame){el.insertHtml('afterBegin',String.format(Ext.Element.boxMarkup,this.baseCls));this.createElement('header',d.firstChild.firstChild.firstChild);this.createElement('bwrap',d);bw=this.bwrap.dom;var ml=d.childNodes[1],bl=d.childNodes[2];bw.appendChild(ml);bw.appendChild(bl);var mc=bw.firstChild.firstChild.firstChild;this.createElement('tbar',mc);this.createElement('body',mc);this.createElement('bbar',mc);this.createElement('footer',bw.lastChild.firstChild.firstChild);if(!this.footer){this.bwrap.dom.lastChild.className+=' x-panel-nofooter';}
this.ft=Ext.get(this.bwrap.dom.lastChild);this.mc=Ext.get(mc);}else{this.createElement('header',d);this.createElement('bwrap',d);bw=this.bwrap.dom;this.createElement('tbar',bw);this.createElement('body',bw);this.createElement('bbar',bw);this.createElement('footer',bw);if(!this.header){this.body.addClass(this.bodyCls+'-noheader');if(this.tbar){this.tbar.addClass(this.tbarCls+'-noheader');}}}
if(Ext.isDefined(this.padding)){this.body.setStyle('padding',this.body.addUnits(this.padding));}
if(this.border===false){this.el.addClass(this.baseCls+'-noborder');this.body.addClass(this.bodyCls+'-noborder');if(this.header){this.header.addClass(this.headerCls+'-noborder');}
if(this.footer){this.footer.addClass(this.footerCls+'-noborder');}
if(this.tbar){this.tbar.addClass(this.tbarCls+'-noborder');}
if(this.bbar){this.bbar.addClass(this.bbarCls+'-noborder');}}
if(this.bodyBorder===false){this.body.addClass(this.bodyCls+'-noborder');}
this.bwrap.enableDisplayMode('block');if(this.header){this.header.unselectable();if(this.headerAsText){this.header.dom.innerHTML='<span class="'+this.headerTextCls+'">'+this.header.dom.innerHTML+'</span>';if(this.iconCls){this.setIconClass(this.iconCls);}}}
if(this.floating){this.makeFloating(this.floating);}
if(this.collapsible&&this.titleCollapse&&this.header){this.mon(this.header,'click',this.toggleCollapse,this);this.header.setStyle('cursor','pointer');}
if(ts){this.addTool.apply(this,ts);}
if(this.fbar){this.footer.addClass('x-panel-btns');this.fbar.ownerCt=this;this.fbar.render(this.footer);this.footer.createChild({cls:'x-clear'});}
if(this.tbar&&this.topToolbar){this.topToolbar.ownerCt=this;this.topToolbar.render(this.tbar);}
if(this.bbar&&this.bottomToolbar){this.bottomToolbar.ownerCt=this;this.bottomToolbar.render(this.bbar);}},setIconClass:function(cls){var old=this.iconCls;this.iconCls=cls;if(this.rendered&&this.header){if(this.frame){this.header.addClass('x-panel-icon');this.header.replaceClass(old,this.iconCls);}else{var hd=this.header,img=hd.child('img.x-panel-inline-icon');if(img){Ext.fly(img).replaceClass(old,this.iconCls);}else{var hdspan=hd.child('span.'+this.headerTextCls);if(hdspan){Ext.DomHelper.insertBefore(hdspan.dom,{tag:'img',src:Ext.BLANK_IMAGE_URL,cls:'x-panel-inline-icon '+this.iconCls});}}}}
this.fireEvent('iconchange',this,cls,old);},makeFloating:function(cfg){this.floating=true;this.el=new Ext.Layer(Ext.apply({},cfg,{shadow:Ext.isDefined(this.shadow)?this.shadow:'sides',shadowOffset:this.shadowOffset,constrain:false,shim:this.shim===false?false:undefined}),this.el);},getTopToolbar:function(){return this.topToolbar;},getBottomToolbar:function(){return this.bottomToolbar;},getFooterToolbar:function(){return this.fbar;},addButton:function(config,handler,scope){if(!this.fbar){this.createFbar([]);}
if(handler){if(Ext.isString(config)){config={text:config};}
config=Ext.apply({handler:handler,scope:scope},config);}
return this.fbar.add(config);},addTool:function(){if(!this.rendered){if(!this.tools){this.tools=[];}
Ext.each(arguments,function(arg){this.tools.push(arg);},this);return;}
if(!this[this.toolTarget]){return;}
if(!this.toolTemplate){var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');tt.disableFormats=true;tt.compile();Ext.Panel.prototype.toolTemplate=tt;}
for(var i=0,a=arguments,len=a.length;i<len;i++){var tc=a[i];if(!this.tools[tc.id]){var overCls='x-tool-'+tc.id+'-over';var t=this.toolTemplate.insertFirst(this[this.toolTarget],tc,true);this.tools[tc.id]=t;t.enableDisplayMode('block');this.mon(t,'click',this.createToolHandler(t,tc,overCls,this));if(tc.on){this.mon(t,tc.on);}
if(tc.hidden){t.hide();}
if(tc.qtip){if(Ext.isObject(tc.qtip)){Ext.QuickTips.register(Ext.apply({target:t.id},tc.qtip));}else{t.dom.qtip=tc.qtip;}}
t.addClassOnOver(overCls);}}},onLayout:function(shallow,force){Ext.Panel.superclass.onLayout.apply(this,arguments);if(this.hasLayout&&this.toolbars.length>0){Ext.each(this.toolbars,function(tb){tb.doLayout(undefined,force);});this.syncHeight();}},syncHeight:function(){var h=this.toolbarHeight,bd=this.body,lsh=this.lastSize.height,sz;if(this.autoHeight||!Ext.isDefined(lsh)||lsh=='auto'){return;}
if(h!=this.getToolbarHeight()){h=Math.max(0,lsh-this.getFrameHeight());bd.setHeight(h);sz=bd.getSize();this.toolbarHeight=this.getToolbarHeight();this.onBodyResize(sz.width,sz.height);}},onShow:function(){if(this.floating){return this.el.show();}
Ext.Panel.superclass.onShow.call(this);},onHide:function(){if(this.floating){return this.el.hide();}
Ext.Panel.superclass.onHide.call(this);},createToolHandler:function(t,tc,overCls,panel){return function(e){t.removeClass(overCls);if(tc.stopEvent!==false){e.stopEvent();}
if(tc.handler){tc.handler.call(tc.scope||t,e,t,panel,tc);}};},afterRender:function(){if(this.floating&&!this.hidden){this.el.show();}
if(this.title){this.setTitle(this.title);}
Ext.Panel.superclass.afterRender.call(this);if(this.collapsed){this.collapsed=false;this.collapse(false);}
this.initEvents();},getKeyMap:function(){if(!this.keyMap){this.keyMap=new Ext.KeyMap(this.el,this.keys);}
return this.keyMap;},initEvents:function(){if(this.keys){this.getKeyMap();}
if(this.draggable){this.initDraggable();}
if(this.toolbars.length>0){Ext.each(this.toolbars,function(tb){tb.doLayout();tb.on({scope:this,afterlayout:this.syncHeight,remove:this.syncHeight});},this);this.syncHeight();}},initDraggable:function(){this.dd=new Ext.Panel.DD(this,Ext.isBoolean(this.draggable)?null:this.draggable);},beforeEffect:function(anim){if(this.floating){this.el.beforeAction();}
if(anim!==false){this.el.addClass('x-panel-animated');}},afterEffect:function(anim){this.syncShadow();this.el.removeClass('x-panel-animated');},createEffect:function(a,cb,scope){var o={scope:scope,block:true};if(a===true){o.callback=cb;return o;}else if(!a.callback){o.callback=cb;}else{o.callback=function(){cb.call(scope);Ext.callback(a.callback,a.scope);};}
return Ext.applyIf(o,a);},collapse:function(animate){if(this.collapsed||this.el.hasFxBlock()||this.fireEvent('beforecollapse',this,animate)===false){return;}
var doAnim=animate===true||(animate!==false&&this.animCollapse);this.beforeEffect(doAnim);this.onCollapse(doAnim,animate);return this;},onCollapse:function(doAnim,animArg){if(doAnim){this[this.collapseEl].slideOut(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterCollapse,this),this.collapseDefaults));}else{this[this.collapseEl].hide(this.hideMode);this.afterCollapse(false);}},afterCollapse:function(anim){this.collapsed=true;this.el.addClass(this.collapsedCls);if(anim!==false){this[this.collapseEl].hide(this.hideMode);}
this.afterEffect(anim);this.cascade(function(c){if(c.lastSize){c.lastSize={width:undefined,height:undefined};}});this.fireEvent('collapse',this);},expand:function(animate){if(!this.collapsed||this.el.hasFxBlock()||this.fireEvent('beforeexpand',this,animate)===false){return;}
var doAnim=animate===true||(animate!==false&&this.animCollapse);this.el.removeClass(this.collapsedCls);this.beforeEffect(doAnim);this.onExpand(doAnim,animate);return this;},onExpand:function(doAnim,animArg){if(doAnim){this[this.collapseEl].slideIn(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterExpand,this),this.expandDefaults));}else{this[this.collapseEl].show(this.hideMode);this.afterExpand(false);}},afterExpand:function(anim){this.collapsed=false;if(anim!==false){this[this.collapseEl].show(this.hideMode);}
this.afterEffect(anim);if(this.deferLayout){delete this.deferLayout;this.doLayout(true);}
this.fireEvent('expand',this);},toggleCollapse:function(animate){this[this.collapsed?'expand':'collapse'](animate);return this;},onDisable:function(){if(this.rendered&&this.maskDisabled){this.el.mask();}
Ext.Panel.superclass.onDisable.call(this);},onEnable:function(){if(this.rendered&&this.maskDisabled){this.el.unmask();}
Ext.Panel.superclass.onEnable.call(this);},onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){var w=adjWidth,h=adjHeight;if(Ext.isDefined(w)||Ext.isDefined(h)){if(!this.collapsed){if(Ext.isNumber(w)){this.body.setWidth(w=this.adjustBodyWidth(w-this.getFrameWidth()));}else if(w=='auto'){w=this.body.setWidth('auto').dom.offsetWidth;}else{w=this.body.dom.offsetWidth;}
if(this.tbar){this.tbar.setWidth(w);if(this.topToolbar){this.topToolbar.setSize(w);}}
if(this.bbar){this.bbar.setWidth(w);if(this.bottomToolbar){this.bottomToolbar.setSize(w);if(Ext.isIE){this.bbar.setStyle('position','static');this.bbar.setStyle('position','');}}}
if(this.footer){this.footer.setWidth(w);if(this.fbar){this.fbar.setSize(Ext.isIE?(w-this.footer.getFrameWidth('lr')):'auto');}}
if(Ext.isNumber(h)){h=Math.max(0,h-this.getFrameHeight());this.body.setHeight(h);}else if(h=='auto'){this.body.setHeight(h);}
if(this.disabled&&this.el._mask){this.el._mask.setSize(this.el.dom.clientWidth,this.el.getHeight());}}else{this.queuedBodySize={width:w,height:h};if(!this.queuedExpand&&this.allowQueuedExpand!==false){this.queuedExpand=true;this.on('expand',function(){delete this.queuedExpand;this.onResize(this.queuedBodySize.width,this.queuedBodySize.height);},this,{single:true});}}
this.onBodyResize(w,h);}
this.syncShadow();Ext.Panel.superclass.onResize.call(this,adjWidth,adjHeight,rawWidth,rawHeight);},onBodyResize:function(w,h){this.fireEvent('bodyresize',this,w,h);},getToolbarHeight:function(){var h=0;if(this.rendered){Ext.each(this.toolbars,function(tb){h+=tb.getHeight();},this);}
return h;},adjustBodyHeight:function(h){return h;},adjustBodyWidth:function(w){return w;},onPosition:function(){this.syncShadow();},getFrameWidth:function(){var w=this.el.getFrameWidth('lr')+this.bwrap.getFrameWidth('lr');if(this.frame){var l=this.bwrap.dom.firstChild;w+=(Ext.fly(l).getFrameWidth('l')+Ext.fly(l.firstChild).getFrameWidth('r'));w+=this.mc.getFrameWidth('lr');}
return w;},getFrameHeight:function(){var h=Math.max(0,this.getHeight()-this.body.getHeight());if(isNaN(h)){h=0;}
return h;},getInnerWidth:function(){return this.getSize().width-this.getFrameWidth();},getInnerHeight:function(){return this.body.getHeight();},syncShadow:function(){if(this.floating){this.el.sync(true);}},getLayoutTarget:function(){return this.body;},getContentTarget:function(){return this.body;},setTitle:function(title,iconCls){this.title=title;if(this.header&&this.headerAsText){this.header.child('span').update(title);}
if(iconCls){this.setIconClass(iconCls);}
this.fireEvent('titlechange',this,title);return this;},getUpdater:function(){return this.body.getUpdater();},load:function(){var um=this.body.getUpdater();um.update.apply(um,arguments);return this;},beforeDestroy:function(){Ext.Panel.superclass.beforeDestroy.call(this);if(this.header){this.header.removeAllListeners();}
if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k]);}}
if(this.toolbars.length>0){Ext.each(this.toolbars,function(tb){tb.un('afterlayout',this.syncHeight,this);tb.un('remove',this.syncHeight,this);},this);}
if(Ext.isArray(this.buttons)){while(this.buttons.length){Ext.destroy(this.buttons[0]);}}
if(this.rendered){Ext.destroy(this.ft,this.header,this.footer,this.tbar,this.bbar,this.body,this.mc,this.bwrap,this.dd);if(this.fbar){Ext.destroy(this.fbar,this.fbar.el);}}
Ext.destroy(this.toolbars);},createClasses:function(){this.headerCls=this.baseCls+'-header';this.headerTextCls=this.baseCls+'-header-text';this.bwrapCls=this.baseCls+'-bwrap';this.tbarCls=this.baseCls+'-tbar';this.bodyCls=this.baseCls+'-body';this.bbarCls=this.baseCls+'-bbar';this.footerCls=this.baseCls+'-footer';},createGhost:function(cls,useShim,appendTo){var el=document.createElement('div');el.className='x-panel-ghost '+(cls?cls:'');if(this.header){el.appendChild(this.el.dom.firstChild.cloneNode(true));}
Ext.fly(el.appendChild(document.createElement('ul'))).setHeight(this.bwrap.getHeight());el.style.width=this.el.dom.offsetWidth+'px';;if(!appendTo){this.container.dom.appendChild(el);}else{Ext.getDom(appendTo).appendChild(el);}
if(useShim!==false&&this.el.useShim!==false){var layer=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},el);layer.show();return layer;}else{return new Ext.Element(el);}},doAutoLoad:function(){var u=this.body.getUpdater();if(this.renderer){u.setRenderer(this.renderer);}
u.update(Ext.isObject(this.autoLoad)?this.autoLoad:{url:this.autoLoad});},getTool:function(id){return this.tools[id];}});Ext.reg('panel',Ext.Panel);Ext.Editor=function(field,config){if(field.field){this.field=Ext.create(field.field,'textfield');config=Ext.apply({},field);delete config.field;}else{this.field=field;}
Ext.Editor.superclass.constructor.call(this,config);};Ext.extend(Ext.Editor,Ext.Component,{allowBlur:true,value:"",alignment:"c-c?",offsets:[0,0],shadow:"frame",constrain:false,swallowKeys:true,completeOnEnter:true,cancelOnEsc:true,updateEl:false,initComponent:function(){Ext.Editor.superclass.initComponent.call(this);this.addEvents("beforestartedit","startedit","beforecomplete","complete","canceledit","specialkey");},onRender:function(ct,position){this.el=new Ext.Layer({shadow:this.shadow,cls:"x-editor",parentEl:ct,shim:this.shim,shadowOffset:this.shadowOffset||4,id:this.id,constrain:this.constrain});if(this.zIndex){this.el.setZIndex(this.zIndex);}
this.el.setStyle("overflow",Ext.isGecko?"auto":"hidden");if(this.field.msgTarget!='title'){this.field.msgTarget='qtip';}
this.field.inEditor=true;this.mon(this.field,{scope:this,blur:this.onBlur,specialkey:this.onSpecialKey});if(this.field.grow){this.mon(this.field,"autosize",this.el.sync,this.el,{delay:1});}
this.field.render(this.el).show();this.field.getEl().dom.name='';if(this.swallowKeys){this.field.el.swallowEvent(['keypress','keydown']);}},onSpecialKey:function(field,e){var key=e.getKey(),complete=this.completeOnEnter&&key==e.ENTER,cancel=this.cancelOnEsc&&key==e.ESC;if(complete||cancel){e.stopEvent();if(complete){this.completeEdit();}else{this.cancelEdit();}
if(field.triggerBlur){field.triggerBlur();}}
this.fireEvent('specialkey',field,e);},startEdit:function(el,value){if(this.editing){this.completeEdit();}
this.boundEl=Ext.get(el);var v=value!==undefined?value:this.boundEl.dom.innerHTML;if(!this.rendered){this.render(this.parentEl||document.body);}
if(this.fireEvent("beforestartedit",this,this.boundEl,v)!==false){this.startValue=v;this.field.reset();this.field.setValue(v);this.realign(true);this.editing=true;this.show();}},doAutoSize:function(){if(this.autoSize){var sz=this.boundEl.getSize(),fs=this.field.getSize();switch(this.autoSize){case"width":this.setSize(sz.width,fs.height);break;case"height":this.setSize(fs.width,sz.height);break;case"none":this.setSize(fs.width,fs.height);break;default:this.setSize(sz.width,sz.height);}}},setSize:function(w,h){delete this.field.lastSize;this.field.setSize(w,h);if(this.el){if(Ext.isGecko2||Ext.isOpera){this.el.setSize(w,h);}
this.el.sync();}},realign:function(autoSize){if(autoSize===true){this.doAutoSize();}
this.el.alignTo(this.boundEl,this.alignment,this.offsets);},completeEdit:function(remainVisible){if(!this.editing){return;}
if(this.field.assertValue){this.field.assertValue();}
var v=this.getValue();if(!this.field.isValid()){if(this.revertInvalid!==false){this.cancelEdit(remainVisible);}
return;}
if(String(v)===String(this.startValue)&&this.ignoreNoChange){this.hideEdit(remainVisible);return;}
if(this.fireEvent("beforecomplete",this,v,this.startValue)!==false){v=this.getValue();if(this.updateEl&&this.boundEl){this.boundEl.update(v);}
this.hideEdit(remainVisible);this.fireEvent("complete",this,v,this.startValue);}},onShow:function(){this.el.show();if(this.hideEl!==false){this.boundEl.hide();}
this.field.show().focus(false,true);this.fireEvent("startedit",this.boundEl,this.startValue);},cancelEdit:function(remainVisible){if(this.editing){var v=this.getValue();this.setValue(this.startValue);this.hideEdit(remainVisible);this.fireEvent("canceledit",this,v,this.startValue);}},hideEdit:function(remainVisible){if(remainVisible!==true){this.editing=false;this.hide();}},onBlur:function(){if(this.allowBlur===true&&this.editing&&this.selectSameEditor!==true){this.completeEdit();}},onHide:function(){if(this.editing){this.completeEdit();return;}
this.field.blur();if(this.field.collapse){this.field.collapse();}
this.el.hide();if(this.hideEl!==false){this.boundEl.show();}},setValue:function(v){this.field.setValue(v);},getValue:function(){return this.field.getValue();},beforeDestroy:function(){Ext.destroyMembers(this,'field');delete this.parentEl;delete this.boundEl;}});Ext.reg('editor',Ext.Editor);Ext.ColorPalette=Ext.extend(Ext.Component,{itemCls:'x-color-palette',value:null,clickEvent:'click',ctype:'Ext.ColorPalette',allowReselect:false,colors:['000000','993300','333300','003300','003366','000080','333399','333333','800000','FF6600','808000','008000','008080','0000FF','666699','808080','FF0000','FF9900','99CC00','339966','33CCCC','3366FF','800080','969696','FF00FF','FFCC00','FFFF00','00FF00','00FFFF','00CCFF','993366','C0C0C0','FF99CC','FFCC99','FFFF99','CCFFCC','CCFFFF','99CCFF','CC99FF','FFFFFF'],initComponent:function(){Ext.ColorPalette.superclass.initComponent.call(this);this.addEvents('select');if(this.handler){this.on('select',this.handler,this.scope,true);}},onRender:function(container,position){this.autoEl={tag:'div',cls:this.itemCls};Ext.ColorPalette.superclass.onRender.call(this,container,position);var t=this.tpl||new Ext.XTemplate('<tpl for="."><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>');t.overwrite(this.el,this.colors);this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:'a'});if(this.clickEvent!='click'){this.mon(this.el,'click',Ext.emptyFn,this,{delegate:'a',preventDefault:true});}},afterRender:function(){Ext.ColorPalette.superclass.afterRender.call(this);if(this.value){var s=this.value;this.value=null;this.select(s,true);}},handleClick:function(e,t){e.preventDefault();if(!this.disabled){var c=t.className.match(/(?:^|\s)color-(.{6})(?:\s|$)/)[1];this.select(c.toUpperCase());}},select:function(color,suppressEvent){color=color.replace('#','');if(color!=this.value||this.allowReselect){var el=this.el;if(this.value){el.child('a.color-'+this.value).removeClass('x-color-palette-sel');}
el.child('a.color-'+color).addClass('x-color-palette-sel');this.value=color;if(suppressEvent!==true){this.fireEvent('select',this,color);}}}});Ext.reg('colorpalette',Ext.ColorPalette);Ext.DatePicker=Ext.extend(Ext.BoxComponent,{todayText:'Today',okText:'&#160;OK&#160;',cancelText:'Cancel',todayTip:'{0} (Spacebar)',minText:'This date is before the minimum date',maxText:'This date is after the maximum date',format:'m/d/y',disabledDaysText:'Disabled',disabledDatesText:'Disabled',monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:'Next Month (Control+Right)',prevText:'Previous Month (Control+Left)',monthYearText:'Choose a month (Control+Up/Down to move years)',startDay:0,showToday:true,focusOnSelect:true,initHour:12,initComponent:function(){Ext.DatePicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime(true):new Date().clearTime();this.addEvents('select');if(this.handler){this.on('select',this.handler,this.scope||this);}
this.initDisabledDays();},initDisabledDays:function(){if(!this.disabledDatesRE&&this.disabledDates){var dd=this.disabledDates,len=dd.length-1,re='(?:';Ext.each(dd,function(d,i){re+=Ext.isDate(d)?'^'+Ext.escapeRe(d.dateFormat(this.format))+'$':dd[i];if(i!=len){re+='|';}},this);this.disabledDatesRE=new RegExp(re+')');}},setDisabledDates:function(dd){if(Ext.isArray(dd)){this.disabledDates=dd;this.disabledDatesRE=null;}else{this.disabledDatesRE=dd;}
this.initDisabledDays();this.update(this.value,true);},setDisabledDays:function(dd){this.disabledDays=dd;this.update(this.value,true);},setMinDate:function(dt){this.minDate=dt;this.update(this.value,true);},setMaxDate:function(dt){this.maxDate=dt;this.update(this.value,true);},setValue:function(value){this.value=value.clearTime(true);this.update(this.value);},getValue:function(){return this.value;},focus:function(){this.update(this.activeDate);},onEnable:function(initial){Ext.DatePicker.superclass.onEnable.call(this);this.doDisabled(false);this.update(initial?this.value:this.activeDate);if(Ext.isIE){this.el.repaint();}},onDisable:function(){Ext.DatePicker.superclass.onDisable.call(this);this.doDisabled(true);if(Ext.isIE&&!Ext.isIE8){Ext.each([].concat(this.textNodes,this.el.query('th span')),function(el){Ext.fly(el).repaint();});}},doDisabled:function(disabled){this.keyNav.setDisabled(disabled);this.prevRepeater.setDisabled(disabled);this.nextRepeater.setDisabled(disabled);if(this.showToday){this.todayKeyListener.setDisabled(disabled);this.todayBtn.setDisabled(disabled);}},onRender:function(container,position){var m=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],dn=this.dayNames,i;for(i=0;i<7;i++){var d=this.startDay+i;if(d>6){d=d-7;}
m.push('<th><span>',dn[d].substr(0,1),'</span></th>');}
m[m.length]='</tr></thead><tbody><tr>';for(i=0;i<42;i++){if(i%7===0&&i!==0){m[m.length]='</tr><tr>';}
m[m.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>';}
m.push('</tr></tbody></table></td></tr>',this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':'','</table><div class="x-date-mp"></div>');var el=document.createElement('div');el.className='x-date-picker';el.innerHTML=m.join('');container.dom.insertBefore(el,position);this.el=Ext.get(el);this.eventEl=Ext.get(el.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child('td.x-date-left a'),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child('td.x-date-right a'),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down('div.x-date-mp');this.monthPicker.enableDisplayMode('block');this.keyNav=new Ext.KeyNav(this.eventEl,{'left':function(e){if(e.ctrlKey){this.showPrevMonth();}else{this.update(this.activeDate.add('d',-1));}},'right':function(e){if(e.ctrlKey){this.showNextMonth();}else{this.update(this.activeDate.add('d',1));}},'up':function(e){if(e.ctrlKey){this.showNextYear();}else{this.update(this.activeDate.add('d',-7));}},'down':function(e){if(e.ctrlKey){this.showPrevYear();}else{this.update(this.activeDate.add('d',7));}},'pageUp':function(e){this.showNextMonth();},'pageDown':function(e){this.showPrevMonth();},'enter':function(e){e.stopPropagation();return true;},scope:this});this.el.unselectable();this.cells=this.el.select('table.x-date-inner tbody td');this.textNodes=this.el.query('table.x-date-inner tbody span');this.mbtn=new Ext.Button({text:'&#160;',tooltip:this.monthYearText,renderTo:this.el.child('td.x-date-middle',true)});this.mbtn.el.child('em').addClass('x-btn-arrow');if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var today=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child('td.x-date-bottom',true),text:String.format(this.todayText,today),tooltip:String.format(this.todayTip,today),handler:this.selectToday,scope:this});}
this.mon(this.eventEl,'mousewheel',this.handleMouseWheel,this);this.mon(this.eventEl,'click',this.handleDateClick,this,{delegate:'a.x-date-date'});this.mon(this.mbtn,'click',this.showMonthPicker,this);this.onEnable(true);},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var buf=['<table border="0" cellspacing="0">'];for(var i=0;i<6;i++){buf.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(i),'</a></td>','<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(i+6),'</a></td>',i===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>');}
buf.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,'</button></td></tr>','</table>');this.monthPicker.update(buf.join(''));this.mon(this.monthPicker,'click',this.onMonthClick,this);this.mon(this.monthPicker,'dblclick',this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select('td.x-date-mp-month');this.mpYears=this.monthPicker.select('td.x-date-mp-year');this.mpMonths.each(function(m,a,i){i+=1;if((i%2)===0){m.dom.xmonth=5+Math.round(i*0.5);}else{m.dom.xmonth=Math.round((i-1)*0.5);}});}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();var size=this.el.getSize();this.monthPicker.setSize(size);this.monthPicker.child('table').setSize(size);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn('t',{duration:0.2});}},updateMPYear:function(y){this.mpyear=y;var ys=this.mpYears.elements;for(var i=1;i<=10;i++){var td=ys[i-1],y2;if((i%2)===0){y2=y+Math.round(i*0.5);td.firstChild.innerHTML=y2;td.xyear=y2;}else{y2=y-(5-Math.round(i*0.5));td.firstChild.innerHTML=y2;td.xyear=y2;}
this.mpYears.item(i-1)[y2==this.mpSelYear?'addClass':'removeClass']('x-date-mp-sel');}},updateMPMonth:function(sm){this.mpMonths.each(function(m,a,i){m[m.dom.xmonth==sm?'addClass':'removeClass']('x-date-mp-sel');});},selectMPMonth:function(m){},onMonthClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if(el.is('button.x-date-mp-cancel')){this.hideMonthPicker();}
else if(el.is('button.x-date-mp-ok')){var d=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());if(d.getMonth()!=this.mpSelMonth){d=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth();}
this.update(d);this.hideMonthPicker();}
else if((pn=el.up('td.x-date-mp-month',2))){this.mpMonths.removeClass('x-date-mp-sel');pn.addClass('x-date-mp-sel');this.mpSelMonth=pn.dom.xmonth;}
else if((pn=el.up('td.x-date-mp-year',2))){this.mpYears.removeClass('x-date-mp-sel');pn.addClass('x-date-mp-sel');this.mpSelYear=pn.dom.xyear;}
else if(el.is('a.x-date-mp-prev')){this.updateMPYear(this.mpyear-10);}
else if(el.is('a.x-date-mp-next')){this.updateMPYear(this.mpyear+10);}},onMonthDblClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if((pn=el.up('td.x-date-mp-month',2))){this.update(new Date(this.mpSelYear,pn.dom.xmonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker();}
else if((pn=el.up('td.x-date-mp-year',2))){this.update(new Date(pn.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker();}},hideMonthPicker:function(disableAnim){if(this.monthPicker){if(disableAnim===true){this.monthPicker.hide();}else{this.monthPicker.slideOut('t',{duration:0.2});}}},showPrevMonth:function(e){this.update(this.activeDate.add('mo',-1));},showNextMonth:function(e){this.update(this.activeDate.add('mo',1));},showPrevYear:function(){this.update(this.activeDate.add('y',-1));},showNextYear:function(){this.update(this.activeDate.add('y',1));},handleMouseWheel:function(e){e.stopEvent();if(!this.disabled){var delta=e.getWheelDelta();if(delta>0){this.showPrevMonth();}else if(delta<0){this.showNextMonth();}}},handleDateClick:function(e,t){e.stopEvent();if(!this.disabled&&t.dateValue&&!Ext.fly(t.parentNode).hasClass('x-date-disabled')){this.cancelFocus=this.focusOnSelect===false;this.setValue(new Date(t.dateValue));delete this.cancelFocus;this.fireEvent('select',this,this.value);}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date().clearTime());this.fireEvent('select',this,this.value);}},update:function(date,forceRefresh){if(this.rendered){var vd=this.activeDate,vis=this.isVisible();this.activeDate=date;if(!forceRefresh&&vd&&this.el){var t=date.getTime();if(vd.getMonth()==date.getMonth()&&vd.getFullYear()==date.getFullYear()){this.cells.removeClass('x-date-selected');this.cells.each(function(c){if(c.dom.firstChild.dateValue==t){c.addClass('x-date-selected');if(vis&&!this.cancelFocus){Ext.fly(c.dom.firstChild).focus(50);}
return false;}},this);return;}}
var days=date.getDaysInMonth(),firstOfMonth=date.getFirstDateOfMonth(),startingPos=firstOfMonth.getDay()-this.startDay;if(startingPos<0){startingPos+=7;}
days+=startingPos;var pm=date.add('mo',-1),prevStart=pm.getDaysInMonth()-startingPos,cells=this.cells.elements,textEls=this.textNodes,d=(new Date(pm.getFullYear(),pm.getMonth(),prevStart,this.initHour)),today=new Date().clearTime().getTime(),sel=date.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(''):false,ddaysText=this.disabledDaysText,format=this.format;if(this.showToday){var td=new Date().clearTime(),disable=(td<min||td>max||(ddMatch&&format&&ddMatch.test(td.dateFormat(format)))||(ddays&&ddays.indexOf(td.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(disable);this.todayKeyListener[disable?'disable':'enable']();}}
var setCellClass=function(cal,cell){cell.title='';var t=d.clearTime(true).getTime();cell.firstChild.dateValue=t;if(t==today){cell.className+=' x-date-today';cell.title=cal.todayText;}
if(t==sel){cell.className+=' x-date-selected';if(vis){Ext.fly(cell.firstChild).focus(50);}}
if(t<min){cell.className=' x-date-disabled';cell.title=cal.minText;return;}
if(t>max){cell.className=' x-date-disabled';cell.title=cal.maxText;return;}
if(ddays){if(ddays.indexOf(d.getDay())!=-1){cell.title=ddaysText;cell.className=' x-date-disabled';}}
if(ddMatch&&format){var fvalue=d.dateFormat(format);if(ddMatch.test(fvalue)){cell.title=ddText.replace('%0',fvalue);cell.className=' x-date-disabled';}}};var i=0;for(;i<startingPos;i++){textEls[i].innerHTML=(++prevStart);d.setDate(d.getDate()+1);cells[i].className='x-date-prevday';setCellClass(this,cells[i]);}
for(;i<days;i++){var intDay=i-startingPos+1;textEls[i].innerHTML=(intDay);d.setDate(d.getDate()+1);cells[i].className='x-date-active';setCellClass(this,cells[i]);}
var extraDays=0;for(;i<42;i++){textEls[i].innerHTML=(++extraDays);d.setDate(d.getDate()+1);cells[i].className='x-date-nextday';setCellClass(this,cells[i]);}
this.mbtn.setText(this.monthNames[date.getMonth()]+' '+date.getFullYear());if(!this.internalRender){var main=this.el.dom.firstChild,w=main.offsetWidth;this.el.setWidth(w+this.el.getBorderWidth('lr'));Ext.fly(main).setWidth(w);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){main.rows[0].cells[1].style.width=(w-(main.rows[0].cells[0].offsetWidth+main.rows[0].cells[2].offsetWidth))+'px';this.secondPass=true;this.update.defer(10,this,[date]);}}}},beforeDestroy:function(){if(this.rendered){Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);delete this.textNodes;delete this.cells.elements;}}});Ext.reg('datepicker',Ext.DatePicker);Ext.LoadMask=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(this.store){this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.onLoad});this.removeMask=Ext.value(this.removeMask,false);}else{var um=this.el.getUpdater();um.showLoadIndicator=false;um.on({scope:this,beforeupdate:this.onBeforeLoad,update:this.onLoad,failure:this.onLoad});this.removeMask=Ext.value(this.removeMask,true);}};Ext.LoadMask.prototype={msg:'Loading...',msgCls:'x-mask-loading',disabled:false,disable:function(){this.disabled=true;},enable:function(){this.disabled=false;},onLoad:function(){this.el.unmask(this.removeMask);},onBeforeLoad:function(){if(!this.disabled){this.el.mask(this.msg,this.msgCls);}},show:function(){this.onBeforeLoad();},hide:function(){this.onLoad();},destroy:function(){if(this.store){this.store.un('beforeload',this.onBeforeLoad,this);this.store.un('load',this.onLoad,this);this.store.un('exception',this.onLoad,this);}else{var um=this.el.getUpdater();um.un('beforeupdate',this.onBeforeLoad,this);um.un('update',this.onLoad,this);um.un('failure',this.onLoad,this);}}};Ext.ns('Ext.slider');Ext.slider.Thumb=Ext.extend(Object,{constructor:function(config){Ext.apply(this,config||{},{cls:'x-slider-thumb',constrain:false});Ext.slider.Thumb.superclass.constructor.call(this,config);if(this.slider.vertical){Ext.apply(this,Ext.slider.Thumb.Vertical);}},render:function(){this.el=this.slider.innerEl.insertFirst({cls:this.cls});this.initEvents();},enable:function(){this.disabled=false;this.el.removeClass(this.slider.disabledClass);},disable:function(){this.disabled=true;this.el.addClass(this.slider.disabledClass);},initEvents:function(){var el=this.el;el.addClassOnOver('x-slider-thumb-over');this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeDragStart.createDelegate(this),onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(el);},onBeforeDragStart:function(e){if(this.disabled){return false;}else{this.slider.promoteThumb(this);return true;}},onDragStart:function(e){this.el.addClass('x-slider-thumb-drag');this.dragging=true;this.dragStartValue=this.value;this.slider.fireEvent('dragstart',this.slider,e,this);},onDrag:function(e){var slider=this.slider,index=this.index,newValue=this.getNewValue();if(this.constrain){var above=slider.thumbs[index+1],below=slider.thumbs[index-1];if(below!=undefined&&newValue<=below.value)newValue=below.value;if(above!=undefined&&newValue>=above.value)newValue=above.value;}
slider.setValue(index,newValue,false);slider.fireEvent('drag',slider,e,this);},getNewValue:function(){var slider=this.slider,pos=slider.innerEl.translatePoints(this.tracker.getXY());return Ext.util.Format.round(slider.reverseValue(pos.left),slider.decimalPrecision);},onDragEnd:function(e){var slider=this.slider,value=this.value;this.el.removeClass('x-slider-thumb-drag');this.dragging=false;slider.fireEvent('dragend',slider,e);if(this.dragStartValue!=value){slider.fireEvent('changecomplete',slider,value,this);}}});Ext.slider.MultiSlider=Ext.extend(Ext.BoxComponent,{vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,constrainThumbs:true,topThumbZIndex:10000,initComponent:function(){if(!Ext.isDefined(this.value)){this.value=this.minValue;}
this.thumbs=[];Ext.slider.MultiSlider.superclass.initComponent.call(this);this.keyIncrement=Math.max(this.increment,this.keyIncrement);this.addEvents('beforechange','change','changecomplete','dragstart','drag','dragend');if(this.values==undefined||Ext.isEmpty(this.values))this.values=[0];var values=this.values;for(var i=0;i<values.length;i++){this.addThumb(values[i]);}
if(this.vertical){Ext.apply(this,Ext.slider.Vertical);}},addThumb:function(value){var thumb=new Ext.slider.Thumb({value:value,slider:this,index:this.thumbs.length,constrain:this.constrainThumbs});this.thumbs.push(thumb);if(this.rendered)thumb.render();},promoteThumb:function(topThumb){var thumbs=this.thumbs,zIndex,thumb;for(var i=0,j=thumbs.length;i<j;i++){thumb=thumbs[i];if(thumb==topThumb){zIndex=this.topThumbZIndex;}else{zIndex='';}
thumb.el.setStyle('zIndex',zIndex);}},onRender:function(){this.autoEl={cls:'x-slider '+(this.vertical?'x-slider-vert':'x-slider-horz'),cn:{cls:'x-slider-end',cn:{cls:'x-slider-inner',cn:[{tag:'a',cls:'x-slider-focus',href:"#",tabIndex:'-1',hidefocus:'on'}]}}};Ext.slider.MultiSlider.superclass.onRender.apply(this,arguments);this.endEl=this.el.first();this.innerEl=this.endEl.first();this.focusEl=this.innerEl.child('.x-slider-focus');for(var i=0;i<this.thumbs.length;i++){this.thumbs[i].render();}
var thumb=this.innerEl.child('.x-slider-thumb');this.halfThumb=(this.vertical?thumb.getHeight():thumb.getWidth())/2;this.initEvents();},initEvents:function(){this.mon(this.el,{scope:this,mousedown:this.onMouseDown,keydown:this.onKeyDown});this.focusEl.swallowEvent("click",true);},onMouseDown:function(e){if(this.disabled){return;}
var thumbClicked=false;for(var i=0;i<this.thumbs.length;i++){thumbClicked=thumbClicked||e.target==this.thumbs[i].el.dom;}
if(this.clickToChange&&!thumbClicked){var local=this.innerEl.translatePoints(e.getXY());this.onClickChange(local);}
this.focus();},onClickChange:function(local){if(local.top>this.clickRange[0]&&local.top<this.clickRange[1]){var thumb=this.getNearest(local,'left'),index=thumb.index;this.setValue(index,Ext.util.Format.round(this.reverseValue(local.left),this.decimalPrecision),undefined,true);}},getNearest:function(local,prop){var localValue=prop=='top'?this.innerEl.getHeight()-local[prop]:local[prop],clickValue=this.reverseValue(localValue),nearestDistance=(this.maxValue-this.minValue)+5,index=0,nearest=null;for(var i=0;i<this.thumbs.length;i++){var thumb=this.thumbs[i],value=thumb.value,dist=Math.abs(value-clickValue);if(Math.abs(dist<=nearestDistance)){nearest=thumb;index=i;nearestDistance=dist;}}
return nearest;},onKeyDown:function(e){if(this.disabled||this.thumbs.length!==1){e.preventDefault();return;}
var k=e.getKey(),val;switch(k){case e.UP:case e.RIGHT:e.stopEvent();val=e.ctrlKey?this.maxValue:this.getValue(0)+this.keyIncrement;this.setValue(0,val,undefined,true);break;case e.DOWN:case e.LEFT:e.stopEvent();val=e.ctrlKey?this.minValue:this.getValue(0)-this.keyIncrement;this.setValue(0,val,undefined,true);break;default:e.preventDefault();}},doSnap:function(value){if(!(this.increment&&value)){return value;}
var newValue=value,inc=this.increment,m=value%inc;if(m!=0){newValue-=m;if(m*2>=inc){newValue+=inc;}else if(m*2<-inc){newValue-=inc;}}
return newValue.constrain(this.minValue,this.maxValue);},afterRender:function(){Ext.slider.MultiSlider.superclass.afterRender.apply(this,arguments);for(var i=0;i<this.thumbs.length;i++){var thumb=this.thumbs[i];if(thumb.value!==undefined){var v=this.normalizeValue(thumb.value);if(v!==thumb.value){this.setValue(i,v,false);}else{this.moveThumb(i,this.translateValue(v),false);}}};},getRatio:function(){var w=this.innerEl.getWidth(),v=this.maxValue-this.minValue;return v==0?w:(w/v);},normalizeValue:function(v){v=this.doSnap(v);v=Ext.util.Format.round(v,this.decimalPrecision);v=v.constrain(this.minValue,this.maxValue);return v;},setMinValue:function(val){this.minValue=val;var i=0,thumbs=this.thumbs,len=thumbs.length,t;for(;i<len;++i){t=thumbs[i];t.value=t.value<val?val:t.value;}
this.syncThumb();},setMaxValue:function(val){this.maxValue=val;var i=0,thumbs=this.thumbs,len=thumbs.length,t;for(;i<len;++i){t=thumbs[i];t.value=t.value>val?val:t.value;}
this.syncThumb();},setValue:function(index,v,animate,changeComplete){var thumb=this.thumbs[index],el=thumb.el;v=this.normalizeValue(v);if(v!==thumb.value&&this.fireEvent('beforechange',this,v,thumb.value,thumb)!==false){thumb.value=v;if(this.rendered){this.moveThumb(index,this.translateValue(v),animate!==false);this.fireEvent('change',this,v,thumb);if(changeComplete){this.fireEvent('changecomplete',this,v,thumb);}}}},translateValue:function(v){var ratio=this.getRatio();return(v*ratio)-(this.minValue*ratio)-this.halfThumb;},reverseValue:function(pos){var ratio=this.getRatio();return(pos+(this.minValue*ratio))/ratio;},moveThumb:function(index,v,animate){var thumb=this.thumbs[index].el;if(!animate||this.animate===false){thumb.setLeft(v);}else{thumb.shift({left:v,stopFx:true,duration:.35});}},focus:function(){this.focusEl.focus(10);},onResize:function(w,h){var thumbs=this.thumbs,len=thumbs.length,i=0;for(;i<len;++i){thumbs[i].el.stopFx();}
this.innerEl.setWidth(w-(this.el.getPadding('l')+this.endEl.getPadding('r')));this.syncThumb();Ext.slider.MultiSlider.superclass.onResize.apply(this,arguments);},onDisable:function(){Ext.slider.MultiSlider.superclass.onDisable.call(this);for(var i=0;i<this.thumbs.length;i++){var thumb=this.thumbs[i],el=thumb.el;thumb.disable();if(Ext.isIE){var xy=el.getXY();el.hide();this.innerEl.addClass(this.disabledClass).dom.disabled=true;if(!this.thumbHolder){this.thumbHolder=this.endEl.createChild({cls:'x-slider-thumb '+this.disabledClass});}
this.thumbHolder.show().setXY(xy);}}},onEnable:function(){Ext.slider.MultiSlider.superclass.onEnable.call(this);for(var i=0;i<this.thumbs.length;i++){var thumb=this.thumbs[i],el=thumb.el;thumb.enable();if(Ext.isIE){this.innerEl.removeClass(this.disabledClass).dom.disabled=false;if(this.thumbHolder)this.thumbHolder.hide();el.show();this.syncThumb();}}},syncThumb:function(){if(this.rendered){for(var i=0;i<this.thumbs.length;i++){this.moveThumb(i,this.translateValue(this.thumbs[i].value));}}},getValue:function(index){return this.thumbs[index].value;},getValues:function(){var values=[];for(var i=0;i<this.thumbs.length;i++){values.push(this.thumbs[i].value);}
return values;},beforeDestroy:function(){Ext.destroyMembers(this,'endEl','innerEl','thumb','halfThumb','focusEl','tracker','thumbHolder');Ext.slider.MultiSlider.superclass.beforeDestroy.call(this);}});Ext.reg('multislider',Ext.slider.MultiSlider);Ext.slider.SingleSlider=Ext.extend(Ext.slider.MultiSlider,{constructor:function(config){config=config||{};Ext.applyIf(config,{values:[config.value||0]});Ext.slider.SingleSlider.superclass.constructor.call(this,config);},getValue:function(){return Ext.slider.SingleSlider.superclass.getValue.call(this,0);},setValue:function(value,animate){var args=Ext.toArray(arguments),len=args.length;if(len==1||(len<=3&&typeof arguments[1]!='number')){args.unshift(0);}
return Ext.slider.SingleSlider.superclass.setValue.apply(this,args);},syncThumb:function(){return Ext.slider.SingleSlider.superclass.syncThumb.apply(this,[0].concat(arguments));},getNearest:function(){return this.thumbs[0];}});Ext.Slider=Ext.slider.SingleSlider;Ext.reg('slider',Ext.slider.SingleSlider);Ext.slider.Vertical={onResize:function(w,h){this.innerEl.setHeight(h-(this.el.getPadding('t')+this.endEl.getPadding('b')));this.syncThumb();},getRatio:function(){var h=this.innerEl.getHeight(),v=this.maxValue-this.minValue;return h/v;},moveThumb:function(index,v,animate){var thumb=this.thumbs[index],el=thumb.el;if(!animate||this.animate===false){el.setBottom(v);}else{el.shift({bottom:v,stopFx:true,duration:.35});}},onClickChange:function(local){if(local.left>this.clickRange[0]&&local.left<this.clickRange[1]){var thumb=this.getNearest(local,'top'),index=thumb.index,value=this.minValue+this.reverseValue(this.innerEl.getHeight()-local.top);this.setValue(index,Ext.util.Format.round(value,this.decimalPrecision),undefined,true);}}};Ext.slider.Thumb.Vertical={getNewValue:function(){var slider=this.slider,innerEl=slider.innerEl,pos=innerEl.translatePoints(this.tracker.getXY()),bottom=innerEl.getHeight()-pos.top;return slider.minValue+Ext.util.Format.round(bottom/slider.getRatio(),slider.decimalPrecision);}};Ext.ProgressBar=Ext.extend(Ext.BoxComponent,{baseCls:'x-progress',animate:false,waitTimer:null,initComponent:function(){Ext.ProgressBar.superclass.initComponent.call(this);this.addEvents("update");},onRender:function(ct,position){var tpl=new Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">','<div>&#160;</div>','</div>','</div>','<div class="{cls}-text {cls}-text-back">','<div>&#160;</div>','</div>','</div>','</div>');this.el=position?tpl.insertBefore(position,{cls:this.baseCls},true):tpl.append(ct,{cls:this.baseCls},true);if(this.id){this.el.dom.id=this.id;}
var inner=this.el.dom.firstChild;this.progressBar=Ext.get(inner.firstChild);if(this.textEl){this.textEl=Ext.get(this.textEl);delete this.textTopEl;}else{this.textTopEl=Ext.get(this.progressBar.dom.firstChild);var textBackEl=Ext.get(inner.childNodes[1]);this.textTopEl.setStyle("z-index",99).addClass('x-hidden');this.textEl=new Ext.CompositeElement([this.textTopEl.dom.firstChild,textBackEl.dom.firstChild]);this.textEl.setWidth(inner.offsetWidth);}
this.progressBar.setHeight(inner.offsetHeight);},afterRender:function(){Ext.ProgressBar.superclass.afterRender.call(this);if(this.value){this.updateProgress(this.value,this.text);}else{this.updateText(this.text);}},updateProgress:function(value,text,animate){this.value=value||0;if(text){this.updateText(text);}
if(this.rendered&&!this.isDestroyed){var w=Math.floor(value*this.el.dom.firstChild.offsetWidth);this.progressBar.setWidth(w,animate===true||(animate!==false&&this.animate));if(this.textTopEl){this.textTopEl.removeClass('x-hidden').setWidth(w);}}
this.fireEvent('update',this,value,text);return this;},wait:function(o){if(!this.waitTimer){var scope=this;o=o||{};this.updateText(o.text);this.waitTimer=Ext.TaskMgr.start({run:function(i){var inc=o.increment||10;i-=1;this.updateProgress(((((i+inc)%inc)+1)*(100/inc))*0.01,null,o.animate);},interval:o.interval||1000,duration:o.duration,onStop:function(){if(o.fn){o.fn.apply(o.scope||this);}
this.reset();},scope:scope});}
return this;},isWaiting:function(){return this.waitTimer!==null;},updateText:function(text){this.text=text||'&#160;';if(this.rendered){this.textEl.update(this.text);}
return this;},syncProgressBar:function(){if(this.value){this.updateProgress(this.value,this.text);}
return this;},setSize:function(w,h){Ext.ProgressBar.superclass.setSize.call(this,w,h);if(this.textTopEl){var inner=this.el.dom.firstChild;this.textEl.setSize(inner.offsetWidth,inner.offsetHeight);}
this.syncProgressBar();return this;},reset:function(hide){this.updateProgress(0);if(this.textTopEl){this.textTopEl.addClass('x-hidden');}
this.clearTimer();if(hide===true){this.hide();}
return this;},clearTimer:function(){if(this.waitTimer){this.waitTimer.onStop=null;Ext.TaskMgr.stop(this.waitTimer);this.waitTimer=null;}},onDestroy:function(){this.clearTimer();if(this.rendered){if(this.textEl.isComposite){this.textEl.clear();}
Ext.destroyMembers(this,'textEl','progressBar','textTopEl');}
Ext.ProgressBar.superclass.onDestroy.call(this);}});Ext.reg('progress',Ext.ProgressBar);(function(){var Event=Ext.EventManager;var Dom=Ext.lib.Dom;Ext.dd.DragDrop=function(id,sGroup,config){if(id){this.init(id,sGroup,config);}};Ext.dd.DragDrop.prototype={id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true;},moveOnly:false,unlock:function(){this.locked=false;},isTarget:true,padding:null,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,b4StartDrag:function(x,y){},startDrag:function(x,y){},b4Drag:function(e){},onDrag:function(e){},onDragEnter:function(e,id){},b4DragOver:function(e){},onDragOver:function(e,id){},b4DragOut:function(e){},onDragOut:function(e,id){},b4DragDrop:function(e){},onDragDrop:function(e,id){},onInvalidDrop:function(e){},b4EndDrag:function(e){},endDrag:function(e){},b4MouseDown:function(e){},onMouseDown:function(e){},onMouseUp:function(e){},onAvailable:function(){},defaultPadding:{left:0,right:0,top:0,bottom:0},constrainTo:function(constrainTo,pad,inContent){if(Ext.isNumber(pad)){pad={left:pad,right:pad,top:pad,bottom:pad};}
pad=pad||this.defaultPadding;var b=Ext.get(this.getEl()).getBox(),ce=Ext.get(constrainTo),s=ce.getScroll(),c,cd=ce.dom;if(cd==document.body){c={x:s.left,y:s.top,width:Ext.lib.Dom.getViewWidth(),height:Ext.lib.Dom.getViewHeight()};}else{var xy=ce.getXY();c={x:xy[0],y:xy[1],width:cd.clientWidth,height:cd.clientHeight};}
var topSpace=b.y-c.y,leftSpace=b.x-c.x;this.resetConstraints();this.setXConstraint(leftSpace-(pad.left||0),c.width-leftSpace-b.width-(pad.right||0),this.xTickSize);this.setYConstraint(topSpace-(pad.top||0),c.height-topSpace-b.height-(pad.bottom||0),this.yTickSize);},getEl:function(){if(!this._domRef){this._domRef=Ext.getDom(this.id);}
return this._domRef;},getDragEl:function(){return Ext.getDom(this.dragElId);},init:function(id,sGroup,config){this.initTarget(id,sGroup,config);Event.on(this.id,"mousedown",this.handleMouseDown,this);},initTarget:function(id,sGroup,config){this.config=config||{};this.DDM=Ext.dd.DDM;this.groups={};if(typeof id!=="string"){id=Ext.id(id);}
this.id=id;this.addToGroup((sGroup)?sGroup:"default");this.handleElId=id;this.setDragElId(id);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();this.handleOnAvailable();},applyConfig:function(){this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false);},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable();},setPadding:function(iTop,iRight,iBot,iLeft){if(!iRight&&0!==iRight){this.padding=[iTop,iTop,iTop,iTop];}else if(!iBot&&0!==iBot){this.padding=[iTop,iRight,iTop,iRight];}else{this.padding=[iTop,iRight,iBot,iLeft];}},setInitPosition:function(diffX,diffY){var el=this.getEl();if(!this.DDM.verifyEl(el)){return;}
var dx=diffX||0;var dy=diffY||0;var p=Dom.getXY(el);this.initPageX=p[0]-dx;this.initPageY=p[1]-dy;this.lastPageX=p[0];this.lastPageY=p[1];this.setStartPosition(p);},setStartPosition:function(pos){var p=pos||Dom.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=p[0];this.startPageY=p[1];},addToGroup:function(sGroup){this.groups[sGroup]=true;this.DDM.regDragDrop(this,sGroup);},removeFromGroup:function(sGroup){if(this.groups[sGroup]){delete this.groups[sGroup];}
this.DDM.removeDDFromGroup(this,sGroup);},setDragElId:function(id){this.dragElId=id;},setHandleElId:function(id){if(typeof id!=="string"){id=Ext.id(id);}
this.handleElId=id;this.DDM.regHandle(this.id,id);},setOuterHandleElId:function(id){if(typeof id!=="string"){id=Ext.id(id);}
Event.on(id,"mousedown",this.handleMouseDown,this);this.setHandleElId(id);this.hasOuterHandles=true;},unreg:function(){Event.un(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this);},destroy:function(){this.unreg();},isLocked:function(){return(this.DDM.isLocked()||this.locked);},handleMouseDown:function(e,oDD){if(this.primaryButtonOnly&&e.button!=0){return;}
if(this.isLocked()){return;}
this.DDM.refreshCache(this.groups);var pt=new Ext.lib.Point(Ext.lib.Event.getPageX(e),Ext.lib.Event.getPageY(e));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(pt,this)){}else{if(this.clickValidator(e)){this.setStartPosition();this.b4MouseDown(e);this.onMouseDown(e);this.DDM.handleMouseDown(e,this);this.DDM.stopEvent(e);}else{}}},clickValidator:function(e){var target=e.getTarget();return(this.isValidHandleChild(target)&&(this.id==this.handleElId||this.DDM.handleWasClicked(target,this.id)));},addInvalidHandleType:function(tagName){var type=tagName.toUpperCase();this.invalidHandleTypes[type]=type;},addInvalidHandleId:function(id){if(typeof id!=="string"){id=Ext.id(id);}
this.invalidHandleIds[id]=id;},addInvalidHandleClass:function(cssClass){this.invalidHandleClasses.push(cssClass);},removeInvalidHandleType:function(tagName){var type=tagName.toUpperCase();delete this.invalidHandleTypes[type];},removeInvalidHandleId:function(id){if(typeof id!=="string"){id=Ext.id(id);}
delete this.invalidHandleIds[id];},removeInvalidHandleClass:function(cssClass){for(var i=0,len=this.invalidHandleClasses.length;i<len;++i){if(this.invalidHandleClasses[i]==cssClass){delete this.invalidHandleClasses[i];}}},isValidHandleChild:function(node){var valid=true;var nodeName;try{nodeName=node.nodeName.toUpperCase();}catch(e){nodeName=node.nodeName;}
valid=valid&&!this.invalidHandleTypes[nodeName];valid=valid&&!this.invalidHandleIds[node.id];for(var i=0,len=this.invalidHandleClasses.length;valid&&i<len;++i){valid=!Ext.fly(node).hasClass(this.invalidHandleClasses[i]);}
return valid;},setXTicks:function(iStartX,iTickSize){this.xTicks=[];this.xTickSize=iTickSize;var tickMap={};for(var i=this.initPageX;i>=this.minX;i=i-iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true;}}
for(i=this.initPageX;i<=this.maxX;i=i+iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true;}}
this.xTicks.sort(this.DDM.numericSort);},setYTicks:function(iStartY,iTickSize){this.yTicks=[];this.yTickSize=iTickSize;var tickMap={};for(var i=this.initPageY;i>=this.minY;i=i-iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true;}}
for(i=this.initPageY;i<=this.maxY;i=i+iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true;}}
this.yTicks.sort(this.DDM.numericSort);},setXConstraint:function(iLeft,iRight,iTickSize){this.leftConstraint=iLeft;this.rightConstraint=iRight;this.minX=this.initPageX-iLeft;this.maxX=this.initPageX+iRight;if(iTickSize){this.setXTicks(this.initPageX,iTickSize);}
this.constrainX=true;},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks();},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0;},setYConstraint:function(iUp,iDown,iTickSize){this.topConstraint=iUp;this.bottomConstraint=iDown;this.minY=this.initPageY-iUp;this.maxY=this.initPageY+iDown;if(iTickSize){this.setYTicks(this.initPageY,iTickSize);}
this.constrainY=true;},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var dx=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var dy=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(dx,dy);}else{this.setInitPosition();}
if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize);}
if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize);}},getTick:function(val,tickArray){if(!tickArray){return val;}else if(tickArray[0]>=val){return tickArray[0];}else{for(var i=0,len=tickArray.length;i<len;++i){var next=i+1;if(tickArray[next]&&tickArray[next]>=val){var diff1=val-tickArray[i];var diff2=tickArray[next]-val;return(diff2>diff1)?tickArray[i]:tickArray[next];}}
return tickArray[tickArray.length-1];}},toString:function(){return("DragDrop "+this.id);}};})();if(!Ext.dd.DragDropMgr){Ext.dd.DragDropMgr=function(){var Event=Ext.EventManager;return{ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,init:function(){this.initialized=true;},POINT:0,INTERSECT:1,mode:0,_execOnAll:function(sMethod,args){for(var i in this.ids){for(var j in this.ids[i]){var oDD=this.ids[i][j];if(!this.isTypeOfDD(oDD)){continue;}
oDD[sMethod].apply(oDD,args);}}},_onLoad:function(){this.init();Event.on(document,"mouseup",this.handleMouseUp,this,true);Event.on(document,"mousemove",this.handleMouseMove,this,true);Event.on(window,"unload",this._onUnload,this,true);Event.on(window,"resize",this._onResize,this,true);},_onResize:function(e){this._execOnAll("resetConstraints",[]);},lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isLocked:function(){return this.locked;},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:350,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,regDragDrop:function(oDD,sGroup){if(!this.initialized){this.init();}
if(!this.ids[sGroup]){this.ids[sGroup]={};}
this.ids[sGroup][oDD.id]=oDD;},removeDDFromGroup:function(oDD,sGroup){if(!this.ids[sGroup]){this.ids[sGroup]={};}
var obj=this.ids[sGroup];if(obj&&obj[oDD.id]){delete obj[oDD.id];}},_remove:function(oDD){for(var g in oDD.groups){if(g&&this.ids[g]&&this.ids[g][oDD.id]){delete this.ids[g][oDD.id];}}
delete this.handleIds[oDD.id];},regHandle:function(sDDId,sHandleId){if(!this.handleIds[sDDId]){this.handleIds[sDDId]={};}
this.handleIds[sDDId][sHandleId]=sHandleId;},isDragDrop:function(id){return(this.getDDById(id))?true:false;},getRelated:function(p_oDD,bTargetsOnly){var oDDs=[];for(var i in p_oDD.groups){for(var j in this.ids[i]){var dd=this.ids[i][j];if(!this.isTypeOfDD(dd)){continue;}
if(!bTargetsOnly||dd.isTarget){oDDs[oDDs.length]=dd;}}}
return oDDs;},isLegalTarget:function(oDD,oTargetDD){var targets=this.getRelated(oDD,true);for(var i=0,len=targets.length;i<len;++i){if(targets[i].id==oTargetDD.id){return true;}}
return false;},isTypeOfDD:function(oDD){return(oDD&&oDD.__ygDragDrop);},isHandle:function(sDDId,sHandleId){return(this.handleIds[sDDId]&&this.handleIds[sDDId][sHandleId]);},getDDById:function(id){for(var i in this.ids){if(this.ids[i][id]){return this.ids[i][id];}}
return null;},handleMouseDown:function(e,oDD){if(Ext.QuickTips){Ext.QuickTips.disable();}
if(this.dragCurrent){this.handleMouseUp(e);}
this.currentTarget=e.getTarget();this.dragCurrent=oDD;var el=oDD.getEl();this.startX=e.getPageX();this.startY=e.getPageY();this.deltaX=this.startX-el.offsetLeft;this.deltaY=this.startY-el.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var DDM=Ext.dd.DDM;DDM.startDrag(DDM.startX,DDM.startY);},this.clickTimeThresh);},startDrag:function(x,y){clearTimeout(this.clickTimeout);if(this.dragCurrent){this.dragCurrent.b4StartDrag(x,y);this.dragCurrent.startDrag(x,y);}
this.dragThreshMet=true;},handleMouseUp:function(e){if(Ext.QuickTips){Ext.QuickTips.enable();}
if(!this.dragCurrent){return;}
clearTimeout(this.clickTimeout);if(this.dragThreshMet){this.fireEvents(e,true);}else{}
this.stopDrag(e);this.stopEvent(e);},stopEvent:function(e){if(this.stopPropagation){e.stopPropagation();}
if(this.preventDefault){e.preventDefault();}},stopDrag:function(e){if(this.dragCurrent){if(this.dragThreshMet){this.dragCurrent.b4EndDrag(e);this.dragCurrent.endDrag(e);}
this.dragCurrent.onMouseUp(e);}
this.dragCurrent=null;this.dragOvers={};},handleMouseMove:function(e){if(!this.dragCurrent){return true;}
if(Ext.isIE&&(e.button!==0&&e.button!==1&&e.button!==2)){this.stopEvent(e);return this.handleMouseUp(e);}
if(!this.dragThreshMet){var diffX=Math.abs(this.startX-e.getPageX());var diffY=Math.abs(this.startY-e.getPageY());if(diffX>this.clickPixelThresh||diffY>this.clickPixelThresh){this.startDrag(this.startX,this.startY);}}
if(this.dragThreshMet){this.dragCurrent.b4Drag(e);this.dragCurrent.onDrag(e);if(!this.dragCurrent.moveOnly){this.fireEvents(e,false);}}
this.stopEvent(e);return true;},fireEvents:function(e,isDrop){var dc=this.dragCurrent;if(!dc||dc.isLocked()){return;}
var pt=e.getPoint();var oldOvers=[];var outEvts=[];var overEvts=[];var dropEvts=[];var enterEvts=[];for(var i in this.dragOvers){var ddo=this.dragOvers[i];if(!this.isTypeOfDD(ddo)){continue;}
if(!this.isOverTarget(pt,ddo,this.mode)){outEvts.push(ddo);}
oldOvers[i]=true;delete this.dragOvers[i];}
for(var sGroup in dc.groups){if("string"!=typeof sGroup){continue;}
for(i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(!this.isTypeOfDD(oDD)){continue;}
if(oDD.isTarget&&!oDD.isLocked()&&((oDD!=dc)||(dc.ignoreSelf===false))){if(this.isOverTarget(pt,oDD,this.mode)){if(isDrop){dropEvts.push(oDD);}else{if(!oldOvers[oDD.id]){enterEvts.push(oDD);}else{overEvts.push(oDD);}
this.dragOvers[oDD.id]=oDD;}}}}}
if(this.mode){if(outEvts.length){dc.b4DragOut(e,outEvts);dc.onDragOut(e,outEvts);}
if(enterEvts.length){dc.onDragEnter(e,enterEvts);}
if(overEvts.length){dc.b4DragOver(e,overEvts);dc.onDragOver(e,overEvts);}
if(dropEvts.length){dc.b4DragDrop(e,dropEvts);dc.onDragDrop(e,dropEvts);}}else{var len=0;for(i=0,len=outEvts.length;i<len;++i){dc.b4DragOut(e,outEvts[i].id);dc.onDragOut(e,outEvts[i].id);}
for(i=0,len=enterEvts.length;i<len;++i){dc.onDragEnter(e,enterEvts[i].id);}
for(i=0,len=overEvts.length;i<len;++i){dc.b4DragOver(e,overEvts[i].id);dc.onDragOver(e,overEvts[i].id);}
for(i=0,len=dropEvts.length;i<len;++i){dc.b4DragDrop(e,dropEvts[i].id);dc.onDragDrop(e,dropEvts[i].id);}}
if(isDrop&&!dropEvts.length){dc.onInvalidDrop(e);}},getBestMatch:function(dds){var winner=null;var len=dds.length;if(len==1){winner=dds[0];}else{for(var i=0;i<len;++i){var dd=dds[i];if(dd.cursorIsOver){winner=dd;break;}else{if(!winner||winner.overlap.getArea()<dd.overlap.getArea()){winner=dd;}}}}
return winner;},refreshCache:function(groups){for(var sGroup in groups){if("string"!=typeof sGroup){continue;}
for(var i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(this.isTypeOfDD(oDD)){var loc=this.getLocation(oDD);if(loc){this.locationCache[oDD.id]=loc;}else{delete this.locationCache[oDD.id];}}}}},verifyEl:function(el){if(el){var parent;if(Ext.isIE){try{parent=el.offsetParent;}catch(e){}}else{parent=el.offsetParent;}
if(parent){return true;}}
return false;},getLocation:function(oDD){if(!this.isTypeOfDD(oDD)){return null;}
var el=oDD.getEl(),pos,x1,x2,y1,y2,t,r,b,l;try{pos=Ext.lib.Dom.getXY(el);}catch(e){}
if(!pos){return null;}
x1=pos[0];x2=x1+el.offsetWidth;y1=pos[1];y2=y1+el.offsetHeight;t=y1-oDD.padding[0];r=x2+oDD.padding[1];b=y2+oDD.padding[2];l=x1-oDD.padding[3];return new Ext.lib.Region(t,r,b,l);},isOverTarget:function(pt,oTarget,intersect){var loc=this.locationCache[oTarget.id];if(!loc||!this.useCache){loc=this.getLocation(oTarget);this.locationCache[oTarget.id]=loc;}
if(!loc){return false;}
oTarget.cursorIsOver=loc.contains(pt);var dc=this.dragCurrent;if(!dc||!dc.getTargetCoord||(!intersect&&!dc.constrainX&&!dc.constrainY)){return oTarget.cursorIsOver;}
oTarget.overlap=null;var pos=dc.getTargetCoord(pt.x,pt.y);var el=dc.getDragEl();var curRegion=new Ext.lib.Region(pos.y,pos.x+el.offsetWidth,pos.y+el.offsetHeight,pos.x);var overlap=curRegion.intersect(loc);if(overlap){oTarget.overlap=overlap;return(intersect)?true:oTarget.cursorIsOver;}else{return false;}},_onUnload:function(e,me){Ext.dd.DragDropMgr.unregAll();},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null;}
this._execOnAll("unreg",[]);for(var i in this.elementCache){delete this.elementCache[i];}
this.elementCache={};this.ids={};},elementCache:{},getElWrapper:function(id){var oWrapper=this.elementCache[id];if(!oWrapper||!oWrapper.el){oWrapper=this.elementCache[id]=new this.ElementWrapper(Ext.getDom(id));}
return oWrapper;},getElement:function(id){return Ext.getDom(id);},getCss:function(id){var el=Ext.getDom(id);return(el)?el.style:null;},ElementWrapper:function(el){this.el=el||null;this.id=this.el&&el.id;this.css=this.el&&el.style;},getPosX:function(el){return Ext.lib.Dom.getX(el);},getPosY:function(el){return Ext.lib.Dom.getY(el);},swapNode:function(n1,n2){if(n1.swapNode){n1.swapNode(n2);}else{var p=n2.parentNode;var s=n2.nextSibling;if(s==n1){p.insertBefore(n1,n2);}else if(n2==n1.nextSibling){p.insertBefore(n2,n1);}else{n1.parentNode.replaceChild(n2,n1);p.insertBefore(n1,s);}}},getScroll:function(){var t,l,dde=document.documentElement,db=document.body;if(dde&&(dde.scrollTop||dde.scrollLeft)){t=dde.scrollTop;l=dde.scrollLeft;}else if(db){t=db.scrollTop;l=db.scrollLeft;}else{}
return{top:t,left:l};},getStyle:function(el,styleProp){return Ext.fly(el).getStyle(styleProp);},getScrollTop:function(){return this.getScroll().top;},getScrollLeft:function(){return this.getScroll().left;},moveToEl:function(moveEl,targetEl){var aCoord=Ext.lib.Dom.getXY(targetEl);Ext.lib.Dom.setXY(moveEl,aCoord);},numericSort:function(a,b){return(a-b);},_timeoutCount:0,_addListeners:function(){var DDM=Ext.dd.DDM;if(Ext.lib.Event&&document){DDM._onLoad();}else{if(DDM._timeoutCount>2000){}else{setTimeout(DDM._addListeners,10);if(document&&document.body){DDM._timeoutCount+=1;}}}},handleWasClicked:function(node,id){if(this.isHandle(id,node.id)){return true;}else{var p=node.parentNode;while(p){if(this.isHandle(id,p.id)){return true;}else{p=p.parentNode;}}}
return false;}};}();Ext.dd.DDM=Ext.dd.DragDropMgr;Ext.dd.DDM._addListeners();}
Ext.dd.DD=function(id,sGroup,config){if(id){this.init(id,sGroup,config);}};Ext.extend(Ext.dd.DD,Ext.dd.DragDrop,{scroll:true,autoOffset:function(iPageX,iPageY){var x=iPageX-this.startPageX;var y=iPageY-this.startPageY;this.setDelta(x,y);},setDelta:function(iDeltaX,iDeltaY){this.deltaX=iDeltaX;this.deltaY=iDeltaY;},setDragElPos:function(iPageX,iPageY){var el=this.getDragEl();this.alignElWithMouse(el,iPageX,iPageY);},alignElWithMouse:function(el,iPageX,iPageY){var oCoord=this.getTargetCoord(iPageX,iPageY);var fly=el.dom?el:Ext.fly(el,'_dd');if(!this.deltaSetXY){var aCoord=[oCoord.x,oCoord.y];fly.setXY(aCoord);var newLeft=fly.getLeft(true);var newTop=fly.getTop(true);this.deltaSetXY=[newLeft-oCoord.x,newTop-oCoord.y];}else{fly.setLeftTop(oCoord.x+this.deltaSetXY[0],oCoord.y+this.deltaSetXY[1]);}
this.cachePosition(oCoord.x,oCoord.y);this.autoScroll(oCoord.x,oCoord.y,el.offsetHeight,el.offsetWidth);return oCoord;},cachePosition:function(iPageX,iPageY){if(iPageX){this.lastPageX=iPageX;this.lastPageY=iPageY;}else{var aCoord=Ext.lib.Dom.getXY(this.getEl());this.lastPageX=aCoord[0];this.lastPageY=aCoord[1];}},autoScroll:function(x,y,h,w){if(this.scroll){var clientH=Ext.lib.Dom.getViewHeight();var clientW=Ext.lib.Dom.getViewWidth();var st=this.DDM.getScrollTop();var sl=this.DDM.getScrollLeft();var bot=h+y;var right=w+x;var toBot=(clientH+st-y-this.deltaY);var toRight=(clientW+sl-x-this.deltaX);var thresh=40;var scrAmt=(document.all)?80:30;if(bot>clientH&&toBot<thresh){window.scrollTo(sl,st+scrAmt);}
if(y<st&&st>0&&y-st<thresh){window.scrollTo(sl,st-scrAmt);}
if(right>clientW&&toRight<thresh){window.scrollTo(sl+scrAmt,st);}
if(x<sl&&sl>0&&x-sl<thresh){window.scrollTo(sl-scrAmt,st);}}},getTargetCoord:function(iPageX,iPageY){var x=iPageX-this.deltaX;var y=iPageY-this.deltaY;if(this.constrainX){if(x<this.minX){x=this.minX;}
if(x>this.maxX){x=this.maxX;}}
if(this.constrainY){if(y<this.minY){y=this.minY;}
if(y>this.maxY){y=this.maxY;}}
x=this.getTick(x,this.xTicks);y=this.getTick(y,this.yTicks);return{x:x,y:y};},applyConfig:function(){Ext.dd.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false);},b4MouseDown:function(e){this.autoOffset(e.getPageX(),e.getPageY());},b4Drag:function(e){this.setDragElPos(e.getPageX(),e.getPageY());},toString:function(){return("DD "+this.id);}});Ext.dd.DDProxy=function(id,sGroup,config){if(id){this.init(id,sGroup,config);this.initFrame();}};Ext.dd.DDProxy.dragElId="ygddfdiv";Ext.extend(Ext.dd.DDProxy,Ext.dd.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var self=this;var body=document.body;if(!body||!body.firstChild){setTimeout(function(){self.createFrame();},50);return;}
var div=this.getDragEl();if(!div){div=document.createElement("div");div.id=this.dragElId;var s=div.style;s.position="absolute";s.visibility="hidden";s.cursor="move";s.border="2px solid #aaa";s.zIndex=999;body.insertBefore(div,body.firstChild);}},initFrame:function(){this.createFrame();},applyConfig:function(){Ext.dd.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||Ext.dd.DDProxy.dragElId);},showFrame:function(iPageX,iPageY){var el=this.getEl();var dragEl=this.getDragEl();var s=dragEl.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(s.width,10)/2),Math.round(parseInt(s.height,10)/2));}
this.setDragElPos(iPageX,iPageY);Ext.fly(dragEl).show();},_resizeProxy:function(){if(this.resizeFrame){var el=this.getEl();Ext.fly(this.getDragEl()).setSize(el.offsetWidth,el.offsetHeight);}},b4MouseDown:function(e){var x=e.getPageX();var y=e.getPageY();this.autoOffset(x,y);this.setDragElPos(x,y);},b4StartDrag:function(x,y){this.showFrame(x,y);},b4EndDrag:function(e){Ext.fly(this.getDragEl()).hide();},endDrag:function(e){var lel=this.getEl();var del=this.getDragEl();del.style.visibility="";this.beforeMove();lel.style.visibility="hidden";Ext.dd.DDM.moveToEl(lel,del);del.style.visibility="hidden";lel.style.visibility="";this.afterDrag();},beforeMove:function(){},afterDrag:function(){},toString:function(){return("DDProxy "+this.id);}});Ext.dd.DDTarget=function(id,sGroup,config){if(id){this.initTarget(id,sGroup,config);}};Ext.extend(Ext.dd.DDTarget,Ext.dd.DragDrop,{getDragEl:Ext.emptyFn,isValidHandleChild:Ext.emptyFn,startDrag:Ext.emptyFn,endDrag:Ext.emptyFn,onDrag:Ext.emptyFn,onDragDrop:Ext.emptyFn,onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,onDragOver:Ext.emptyFn,onInvalidDrop:Ext.emptyFn,onMouseDown:Ext.emptyFn,onMouseUp:Ext.emptyFn,setXConstraint:Ext.emptyFn,setYConstraint:Ext.emptyFn,resetConstraints:Ext.emptyFn,clearConstraints:Ext.emptyFn,clearTicks:Ext.emptyFn,setInitPosition:Ext.emptyFn,setDragElId:Ext.emptyFn,setHandleElId:Ext.emptyFn,setOuterHandleElId:Ext.emptyFn,addInvalidHandleClass:Ext.emptyFn,addInvalidHandleId:Ext.emptyFn,addInvalidHandleType:Ext.emptyFn,removeInvalidHandleClass:Ext.emptyFn,removeInvalidHandleId:Ext.emptyFn,removeInvalidHandleType:Ext.emptyFn,toString:function(){return("DDTarget "+this.id);}});Ext.dd.DragTracker=Ext.extend(Ext.util.Observable,{active:false,tolerance:5,autoStart:false,constructor:function(config){Ext.apply(this,config);this.addEvents('mousedown','mouseup','mousemove','dragstart','dragend','drag');this.dragRegion=new Ext.lib.Region(0,0,0,0);if(this.el){this.initEl(this.el);}
Ext.dd.DragTracker.superclass.constructor.call(this,config);},initEl:function(el){this.el=Ext.get(el);el.on('mousedown',this.onMouseDown,this,this.delegate?{delegate:this.delegate}:undefined);},destroy:function(){this.el.un('mousedown',this.onMouseDown,this);},onMouseDown:function(e,target){if(this.fireEvent('mousedown',this,e)!==false&&this.onBeforeStart(e)!==false){this.startXY=this.lastXY=e.getXY();this.dragTarget=this.delegate?target:this.el.dom;if(this.preventDefault!==false){e.preventDefault();}
var doc=Ext.getDoc();doc.on('mouseup',this.onMouseUp,this);doc.on('mousemove',this.onMouseMove,this);doc.on('selectstart',this.stopSelect,this);if(this.autoStart){this.timer=this.triggerStart.defer(this.autoStart===true?1000:this.autoStart,this);}}},onMouseMove:function(e,target){if(this.active&&Ext.isIE&&!e.browserEvent.button){e.preventDefault();this.onMouseUp(e);return;}
e.preventDefault();var xy=e.getXY(),s=this.startXY;this.lastXY=xy;if(!this.active){if(Math.abs(s[0]-xy[0])>this.tolerance||Math.abs(s[1]-xy[1])>this.tolerance){this.triggerStart();}else{return;}}
this.fireEvent('mousemove',this,e);this.onDrag(e);this.fireEvent('drag',this,e);},onMouseUp:function(e){var doc=Ext.getDoc();doc.un('mousemove',this.onMouseMove,this);doc.un('mouseup',this.onMouseUp,this);doc.un('selectstart',this.stopSelect,this);e.preventDefault();this.clearStart();var wasActive=this.active;this.active=false;delete this.elRegion;this.fireEvent('mouseup',this,e);if(wasActive){this.onEnd(e);this.fireEvent('dragend',this,e);}},triggerStart:function(isTimer){this.clearStart();this.active=true;this.onStart(this.startXY);this.fireEvent('dragstart',this,this.startXY);},clearStart:function(){if(this.timer){clearTimeout(this.timer);delete this.timer;}},stopSelect:function(e){e.stopEvent();return false;},onBeforeStart:function(e){},onStart:function(xy){},onDrag:function(e){},onEnd:function(e){},getDragTarget:function(){return this.dragTarget;},getDragCt:function(){return this.el;},getXY:function(constrain){return constrain?this.constrainModes[constrain].call(this,this.lastXY):this.lastXY;},getOffset:function(constrain){var xy=this.getXY(constrain);var s=this.startXY;return[s[0]-xy[0],s[1]-xy[1]];},constrainModes:{'point':function(xy){if(!this.elRegion){this.elRegion=this.getDragCt().getRegion();}
var dr=this.dragRegion;dr.left=xy[0];dr.top=xy[1];dr.right=xy[0];dr.bottom=xy[1];dr.constrainTo(this.elRegion);return[dr.left,dr.top];}}});Ext.dd.ScrollManager=function(){var ddm=Ext.dd.DragDropMgr;var els={};var dragEl=null;var proc={};var onStop=function(e){dragEl=null;clearProc();};var triggerRefresh=function(){if(ddm.dragCurrent){ddm.refreshCache(ddm.dragCurrent.groups);}};var doScroll=function(){if(ddm.dragCurrent){var dds=Ext.dd.ScrollManager;var inc=proc.el.ddScrollConfig?proc.el.ddScrollConfig.increment:dds.increment;if(!dds.animate){if(proc.el.scroll(proc.dir,inc)){triggerRefresh();}}else{proc.el.scroll(proc.dir,inc,true,dds.animDuration,triggerRefresh);}}};var clearProc=function(){if(proc.id){clearInterval(proc.id);}
proc.id=0;proc.el=null;proc.dir="";};var startProc=function(el,dir){clearProc();proc.el=el;proc.dir=dir;var freq=(el.ddScrollConfig&&el.ddScrollConfig.frequency)?el.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency;proc.id=setInterval(doScroll,freq);};var onFire=function(e,isDrop){if(isDrop||!ddm.dragCurrent){return;}
var dds=Ext.dd.ScrollManager;if(!dragEl||dragEl!=ddm.dragCurrent){dragEl=ddm.dragCurrent;dds.refreshCache();}
var xy=Ext.lib.Event.getXY(e);var pt=new Ext.lib.Point(xy[0],xy[1]);for(var id in els){var el=els[id],r=el._region;var c=el.ddScrollConfig?el.ddScrollConfig:dds;if(r&&r.contains(pt)&&el.isScrollable()){if(r.bottom-pt.y<=c.vthresh){if(proc.el!=el){startProc(el,"down");}
return;}else if(r.right-pt.x<=c.hthresh){if(proc.el!=el){startProc(el,"left");}
return;}else if(pt.y-r.top<=c.vthresh){if(proc.el!=el){startProc(el,"up");}
return;}else if(pt.x-r.left<=c.hthresh){if(proc.el!=el){startProc(el,"right");}
return;}}}
clearProc();};ddm.fireEvents=ddm.fireEvents.createSequence(onFire,ddm);ddm.stopDrag=ddm.stopDrag.createSequence(onStop,ddm);return{register:function(el){if(Ext.isArray(el)){for(var i=0,len=el.length;i<len;i++){this.register(el[i]);}}else{el=Ext.get(el);els[el.id]=el;}},unregister:function(el){if(Ext.isArray(el)){for(var i=0,len=el.length;i<len;i++){this.unregister(el[i]);}}else{el=Ext.get(el);delete els[el.id];}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:.4,refreshCache:function(){for(var id in els){if(typeof els[id]=='object'){els[id]._region=els[id].getRegion();}}}};}();Ext.dd.Registry=function(){var elements={};var handles={};var autoIdSeed=0;var getId=function(el,autogen){if(typeof el=="string"){return el;}
var id=el.id;if(!id&&autogen!==false){id="extdd-"+(++autoIdSeed);el.id=id;}
return id;};return{register:function(el,data){data=data||{};if(typeof el=="string"){el=document.getElementById(el);}
data.ddel=el;elements[getId(el)]=data;if(data.isHandle!==false){handles[data.ddel.id]=data;}
if(data.handles){var hs=data.handles;for(var i=0,len=hs.length;i<len;i++){handles[getId(hs[i])]=data;}}},unregister:function(el){var id=getId(el,false);var data=elements[id];if(data){delete elements[id];if(data.handles){var hs=data.handles;for(var i=0,len=hs.length;i<len;i++){delete handles[getId(hs[i],false)];}}}},getHandle:function(id){if(typeof id!="string"){id=id.id;}
return handles[id];},getHandleFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);return t?handles[t.id]:null;},getTarget:function(id){if(typeof id!="string"){id=id.id;}
return elements[id];},getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);return t?elements[t.id]||handles[t.id]:null;}};}();Ext.dd.StatusProxy=function(config){Ext.apply(this,config);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,tag:"div",cls:"x-dd-drag-proxy "+this.dropNotAllowed,children:[{tag:"div",cls:"x-dd-drop-icon"},{tag:"div",cls:"x-dd-drag-ghost"}]},shadow:!config||config.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1]);this.dropStatus=this.dropNotAllowed;};Ext.dd.StatusProxy.prototype={dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",setStatus:function(cssClass){cssClass=cssClass||this.dropNotAllowed;if(this.dropStatus!=cssClass){this.el.replaceClass(this.dropStatus,cssClass);this.dropStatus=cssClass;}},reset:function(clearGhost){this.el.dom.className="x-dd-drag-proxy "+this.dropNotAllowed;this.dropStatus=this.dropNotAllowed;if(clearGhost){this.ghost.update("");}},update:function(html){if(typeof html=="string"){this.ghost.update(html);}else{this.ghost.update("");html.style.margin="0";this.ghost.dom.appendChild(html);}
var el=this.ghost.dom.firstChild;if(el){Ext.fly(el).setStyle('float','none');}},getEl:function(){return this.el;},getGhost:function(){return this.ghost;},hide:function(clear){this.el.hide();if(clear){this.reset(true);}},stop:function(){if(this.anim&&this.anim.isAnimated&&this.anim.isAnimated()){this.anim.stop();}},show:function(){this.el.show();},sync:function(){this.el.sync();},repair:function(xy,callback,scope){this.callback=callback;this.scope=scope;if(xy&&this.animRepair!==false){this.el.addClass("x-dd-drag-repair");this.el.hideUnders(true);this.anim=this.el.shift({duration:this.repairDuration||.5,easing:'easeOut',xy:xy,stopFx:true,callback:this.afterRepair,scope:this});}else{this.afterRepair();}},afterRepair:function(){this.hide(true);if(typeof this.callback=="function"){this.callback.call(this.scope||this);}
this.callback=null;this.scope=null;},destroy:function(){Ext.destroy(this.ghost,this.el);}};Ext.dd.DragSource=function(el,config){this.el=Ext.get(el);if(!this.dragData){this.dragData={};}
Ext.apply(this,config);if(!this.proxy){this.proxy=new Ext.dd.StatusProxy();}
Ext.dd.DragSource.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{dragElId:this.proxy.id,resizeFrame:false,isTarget:false,scroll:this.scroll===true});this.dragging=false;};Ext.extend(Ext.dd.DragSource,Ext.dd.DDProxy,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",getDragData:function(e){return this.dragData;},onDragEnter:function(e,id){var target=Ext.dd.DragDropMgr.getDDById(id);this.cachedTarget=target;if(this.beforeDragEnter(target,e,id)!==false){if(target.isNotifyTarget){var status=target.notifyEnter(this,e,this.dragData);this.proxy.setStatus(status);}else{this.proxy.setStatus(this.dropAllowed);}
if(this.afterDragEnter){this.afterDragEnter(target,e,id);}}},beforeDragEnter:function(target,e,id){return true;},alignElWithMouse:function(){Ext.dd.DragSource.superclass.alignElWithMouse.apply(this,arguments);this.proxy.sync();},onDragOver:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragOver(target,e,id)!==false){if(target.isNotifyTarget){var status=target.notifyOver(this,e,this.dragData);this.proxy.setStatus(status);}
if(this.afterDragOver){this.afterDragOver(target,e,id);}}},beforeDragOver:function(target,e,id){return true;},onDragOut:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragOut(target,e,id)!==false){if(target.isNotifyTarget){target.notifyOut(this,e,this.dragData);}
this.proxy.reset();if(this.afterDragOut){this.afterDragOut(target,e,id);}}
this.cachedTarget=null;},beforeDragOut:function(target,e,id){return true;},onDragDrop:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragDrop(target,e,id)!==false){if(target.isNotifyTarget){if(target.notifyDrop(this,e,this.dragData)){this.onValidDrop(target,e,id);}else{this.onInvalidDrop(target,e,id);}}else{this.onValidDrop(target,e,id);}
if(this.afterDragDrop){this.afterDragDrop(target,e,id);}}
delete this.cachedTarget;},beforeDragDrop:function(target,e,id){return true;},onValidDrop:function(target,e,id){this.hideProxy();if(this.afterValidDrop){this.afterValidDrop(target,e,id);}},getRepairXY:function(e,data){return this.el.getXY();},onInvalidDrop:function(target,e,id){this.beforeInvalidDrop(target,e,id);if(this.cachedTarget){if(this.cachedTarget.isNotifyTarget){this.cachedTarget.notifyOut(this,e,this.dragData);}
this.cacheTarget=null;}
this.proxy.repair(this.getRepairXY(e,this.dragData),this.afterRepair,this);if(this.afterInvalidDrop){this.afterInvalidDrop(e,id);}},afterRepair:function(){if(Ext.enableFx){this.el.highlight(this.hlColor||"c3daf9");}
this.dragging=false;},beforeInvalidDrop:function(target,e,id){return true;},handleMouseDown:function(e){if(this.dragging){return;}
var data=this.getDragData(e);if(data&&this.onBeforeDrag(data,e)!==false){this.dragData=data;this.proxy.stop();Ext.dd.DragSource.superclass.handleMouseDown.apply(this,arguments);}},onBeforeDrag:function(data,e){return true;},onStartDrag:Ext.emptyFn,startDrag:function(x,y){this.proxy.reset();this.dragging=true;this.proxy.update("");this.onInitDrag(x,y);this.proxy.show();},onInitDrag:function(x,y){var clone=this.el.dom.cloneNode(true);clone.id=Ext.id();this.proxy.update(clone);this.onStartDrag(x,y);return true;},getProxy:function(){return this.proxy;},hideProxy:function(){this.proxy.hide();this.proxy.reset(true);this.dragging=false;},triggerCacheRefresh:function(){Ext.dd.DDM.refreshCache(this.groups);},b4EndDrag:function(e){},endDrag:function(e){this.onEndDrag(this.dragData,e);},onEndDrag:function(data,e){},autoOffset:function(x,y){this.setDelta(-12,-20);},destroy:function(){Ext.dd.DragSource.superclass.destroy.call(this);Ext.destroy(this.proxy);}});Ext.dd.DropTarget=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(this.containerScroll){Ext.dd.ScrollManager.register(this.el);}
Ext.dd.DropTarget.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{isTarget:true});};Ext.extend(Ext.dd.DropTarget,Ext.dd.DDTarget,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",isTarget:true,isNotifyTarget:true,notifyEnter:function(dd,e,data){if(this.overClass){this.el.addClass(this.overClass);}
return this.dropAllowed;},notifyOver:function(dd,e,data){return this.dropAllowed;},notifyOut:function(dd,e,data){if(this.overClass){this.el.removeClass(this.overClass);}},notifyDrop:function(dd,e,data){return false;}});Ext.dd.DragZone=function(el,config){Ext.dd.DragZone.superclass.constructor.call(this,el,config);if(this.containerScroll){Ext.dd.ScrollManager.register(this.el);}};Ext.extend(Ext.dd.DragZone,Ext.dd.DragSource,{getDragData:function(e){return Ext.dd.Registry.getHandleFromEvent(e);},onInitDrag:function(x,y){this.proxy.update(this.dragData.ddel.cloneNode(true));this.onStartDrag(x,y);return true;},afterRepair:function(){if(Ext.enableFx){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9");}
this.dragging=false;},getRepairXY:function(e){return Ext.Element.fly(this.dragData.ddel).getXY();}});Ext.dd.DropZone=function(el,config){Ext.dd.DropZone.superclass.constructor.call(this,el,config);};Ext.extend(Ext.dd.DropZone,Ext.dd.DropTarget,{getTargetFromEvent:function(e){return Ext.dd.Registry.getTargetFromEvent(e);},onNodeEnter:function(n,dd,e,data){},onNodeOver:function(n,dd,e,data){return this.dropAllowed;},onNodeOut:function(n,dd,e,data){},onNodeDrop:function(n,dd,e,data){return false;},onContainerOver:function(dd,e,data){return this.dropNotAllowed;},onContainerDrop:function(dd,e,data){return false;},notifyEnter:function(dd,e,data){return this.dropNotAllowed;},notifyOver:function(dd,e,data){var n=this.getTargetFromEvent(e);if(!n){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null;}
return this.onContainerOver(dd,e,data);}
if(this.lastOverNode!=n){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);}
this.onNodeEnter(n,dd,e,data);this.lastOverNode=n;}
return this.onNodeOver(n,dd,e,data);},notifyOut:function(dd,e,data){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null;}},notifyDrop:function(dd,e,data){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null;}
var n=this.getTargetFromEvent(e);return n?this.onNodeDrop(n,dd,e,data):this.onContainerDrop(dd,e,data);},triggerCacheRefresh:function(){Ext.dd.DDM.refreshCache(this.groups);}});Ext.Element.addMethods({initDD:function(group,config,overrides){var dd=new Ext.dd.DD(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides);},initDDProxy:function(group,config,overrides){var dd=new Ext.dd.DDProxy(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides);},initDDTarget:function(group,config,overrides){var dd=new Ext.dd.DDTarget(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides);}});Ext.data.Api=(function(){var validActions={};return{actions:{create:'create',read:'read',update:'update',destroy:'destroy'},restActions:{create:'POST',read:'GET',update:'PUT',destroy:'DELETE'},isAction:function(action){return(Ext.data.Api.actions[action])?true:false;},getVerb:function(name){if(validActions[name]){return validActions[name];}
for(var verb in this.actions){if(this.actions[verb]===name){validActions[name]=verb;break;}}
return(validActions[name]!==undefined)?validActions[name]:null;},isValid:function(api){var invalid=[];var crud=this.actions;for(var action in api){if(!(action in crud)){invalid.push(action);}}
return(!invalid.length)?true:invalid;},hasUniqueUrl:function(proxy,verb){var url=(proxy.api[verb])?proxy.api[verb].url:null;var unique=true;for(var action in proxy.api){if((unique=(action===verb)?true:(proxy.api[action].url!=url)?true:false)===false){break;}}
return unique;},prepare:function(proxy){if(!proxy.api){proxy.api={};}
for(var verb in this.actions){var action=this.actions[verb];proxy.api[action]=proxy.api[action]||proxy.url||proxy.directFn;if(typeof(proxy.api[action])=='string'){proxy.api[action]={url:proxy.api[action],method:(proxy.restful===true)?Ext.data.Api.restActions[action]:undefined};}}},restify:function(proxy){proxy.restful=true;for(var verb in this.restActions){proxy.api[this.actions[verb]].method||(proxy.api[this.actions[verb]].method=this.restActions[verb]);}
proxy.onWrite=proxy.onWrite.createInterceptor(function(action,o,response,rs){var reader=o.reader;var res=new Ext.data.Response({action:action,raw:response});switch(response.status){case 200:return true;break;case 201:if(Ext.isEmpty(res.raw.responseText)){res.success=true;}else{return true;}
break;case 204:res.success=true;res.data=null;break;default:return true;break;}
if(res.success===true){this.fireEvent("write",this,action,res.data,res,rs,o.request.arg);}else{this.fireEvent('exception',this,'remote',action,o,res,rs);}
o.request.callback.call(o.request.scope,res.data,res,res.success);return false;},proxy);}};})();Ext.data.Response=function(params,response){Ext.apply(this,params,{raw:response});};Ext.data.Response.prototype={message:null,success:false,status:null,root:null,raw:null,getMessage:function(){return this.message;},getSuccess:function(){return this.success;},getStatus:function(){return this.status;},getRoot:function(){return this.root;},getRawResponse:function(){return this.raw;}};Ext.data.Api.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message);},name:'Ext.data.Api'});Ext.apply(Ext.data.Api.Error.prototype,{lang:{'action-url-undefined':'No fallback url defined for this action.  When defining a DataProxy api, please be sure to define an url for each CRUD action in Ext.data.Api.actions or define a default url in addition to your api-configuration.','invalid':'received an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions defined in Ext.data.Api.actions','invalid-url':'Invalid url.  Please review your proxy configuration.','execute':'Attempted to execute an unknown action.  Valid API actions are defined in Ext.data.Api.actions"'}});Ext.data.SortTypes={none:function(s){return s;},stripTagsRE:/<\/?[^>]+>/gi,asText:function(s){return String(s).replace(this.stripTagsRE,"");},asUCText:function(s){return String(s).toUpperCase().replace(this.stripTagsRE,"");},asUCString:function(s){return String(s).toUpperCase();},asDate:function(s){if(!s){return 0;}
if(Ext.isDate(s)){return s.getTime();}
return Date.parse(String(s));},asFloat:function(s){var val=parseFloat(String(s).replace(/,/g,""));return isNaN(val)?0:val;},asInt:function(s){var val=parseInt(String(s).replace(/,/g,""),10);return isNaN(val)?0:val;}};Ext.data.Record=function(data,id){this.id=(id||id===0)?id:Ext.data.Record.id(this);this.data=data||{};};Ext.data.Record.create=function(o){var f=Ext.extend(Ext.data.Record,{});var p=f.prototype;p.fields=new Ext.util.MixedCollection(false,function(field){return field.name;});for(var i=0,len=o.length;i<len;i++){p.fields.add(new Ext.data.Field(o[i]));}
f.getField=function(name){return p.fields.get(name);};return f;};Ext.data.Record.PREFIX='ext-record';Ext.data.Record.AUTO_ID=1;Ext.data.Record.EDIT='edit';Ext.data.Record.REJECT='reject';Ext.data.Record.COMMIT='commit';Ext.data.Record.id=function(rec){rec.phantom=true;return[Ext.data.Record.PREFIX,'-',Ext.data.Record.AUTO_ID++].join('');};Ext.data.Record.prototype={dirty:false,editing:false,error:null,modified:null,phantom:false,join:function(store){this.store=store;},set:function(name,value){var encode=Ext.isPrimitive(value)?String:Ext.encode;if(encode(this.data[name])==encode(value)){return;}
this.dirty=true;if(!this.modified){this.modified={};}
if(this.modified[name]===undefined){this.modified[name]=this.data[name];}
this.data[name]=value;if(!this.editing){this.afterEdit();}},afterEdit:function(){if(this.store!=undefined&&typeof this.store.afterEdit=="function"){this.store.afterEdit(this);}},afterReject:function(){if(this.store){this.store.afterReject(this);}},afterCommit:function(){if(this.store){this.store.afterCommit(this);}},get:function(name){return this.data[name];},beginEdit:function(){this.editing=true;this.modified=this.modified||{};},cancelEdit:function(){this.editing=false;delete this.modified;},endEdit:function(){this.editing=false;if(this.dirty){this.afterEdit();}},reject:function(silent){var m=this.modified;for(var n in m){if(typeof m[n]!="function"){this.data[n]=m[n];}}
this.dirty=false;delete this.modified;this.editing=false;if(silent!==true){this.afterReject();}},commit:function(silent){this.dirty=false;delete this.modified;this.editing=false;if(silent!==true){this.afterCommit();}},getChanges:function(){var m=this.modified,cs={};for(var n in m){if(m.hasOwnProperty(n)){cs[n]=this.data[n];}}
return cs;},hasError:function(){return this.error!==null;},clearError:function(){this.error=null;},copy:function(newId){return new this.constructor(Ext.apply({},this.data),newId||this.id);},isModified:function(fieldName){return!!(this.modified&&this.modified.hasOwnProperty(fieldName));},isValid:function(){return this.fields.find(function(f){return(f.allowBlank===false&&Ext.isEmpty(this.data[f.name]))?true:false;},this)?false:true;},markDirty:function(){this.dirty=true;if(!this.modified){this.modified={};}
this.fields.each(function(f){this.modified[f.name]=this.data[f.name];},this);}};Ext.StoreMgr=Ext.apply(new Ext.util.MixedCollection(),{register:function(){for(var i=0,s;(s=arguments[i]);i++){this.add(s);}},unregister:function(){for(var i=0,s;(s=arguments[i]);i++){this.remove(this.lookup(s));}},lookup:function(id){if(Ext.isArray(id)){var fields=['field1'],expand=!Ext.isArray(id[0]);if(!expand){for(var i=2,len=id[0].length;i<=len;++i){fields.push('field'+i);}}
return new Ext.data.ArrayStore({fields:fields,data:id,expandData:expand,autoDestroy:true,autoCreated:true});}
return Ext.isObject(id)?(id.events?id:Ext.create(id,'store')):this.get(id);},getKey:function(o){return o.storeId;}});Ext.data.Store=Ext.extend(Ext.util.Observable,{writer:undefined,remoteSort:false,autoDestroy:false,pruneModifiedRecords:false,lastOptions:null,autoSave:true,batch:true,restful:false,paramNames:undefined,defaultParamNames:{start:'start',limit:'limit',sort:'sort',dir:'dir'},isDestroyed:false,hasMultiSort:false,batchKey:'_ext_batch_',constructor:function(config){this.data=new Ext.util.MixedCollection(false);this.data.getKey=function(o){return o.id;};this.removed=[];if(config&&config.data){this.inlineData=config.data;delete config.data;}
Ext.apply(this,config);this.baseParams=Ext.isObject(this.baseParams)?this.baseParams:{};this.paramNames=Ext.applyIf(this.paramNames||{},this.defaultParamNames);if((this.url||this.api)&&!this.proxy){this.proxy=new Ext.data.HttpProxy({url:this.url,api:this.api});}
if(this.restful===true&&this.proxy){this.batch=false;Ext.data.Api.restify(this.proxy);}
if(this.reader){if(!this.recordType){this.recordType=this.reader.recordType;}
if(this.reader.onMetaChange){this.reader.onMetaChange=this.reader.onMetaChange.createSequence(this.onMetaChange,this);}
if(this.writer){if(this.writer instanceof(Ext.data.DataWriter)===false){this.writer=this.buildWriter(this.writer);}
this.writer.meta=this.reader.meta;this.pruneModifiedRecords=true;}}
if(this.recordType){this.fields=this.recordType.prototype.fields;}
this.modified=[];this.addEvents('datachanged','metachange','add','remove','update','clear','exception','beforeload','load','loadexception','beforewrite','write','beforesave','save');if(this.proxy){this.relayEvents(this.proxy,['loadexception','exception']);}
if(this.writer){this.on({scope:this,add:this.createRecords,remove:this.destroyRecord,update:this.updateRecord,clear:this.onClear});}
this.sortToggle={};if(this.sortField){this.setDefaultSort(this.sortField,this.sortDir);}else if(this.sortInfo){this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction);}
Ext.data.Store.superclass.constructor.call(this);if(this.id){this.storeId=this.id;delete this.id;}
if(this.storeId){Ext.StoreMgr.register(this);}
if(this.inlineData){this.loadData(this.inlineData);delete this.inlineData;}else if(this.autoLoad){this.load.defer(10,this,[typeof this.autoLoad=='object'?this.autoLoad:undefined]);}
this.batchCounter=0;this.batches={};},buildWriter:function(config){var klass=undefined,type=(config.format||'json').toLowerCase();switch(type){case'json':klass=Ext.data.JsonWriter;break;case'xml':klass=Ext.data.XmlWriter;break;default:klass=Ext.data.JsonWriter;}
return new klass(config);},destroy:function(){if(!this.isDestroyed){if(this.storeId){Ext.StoreMgr.unregister(this);}
this.clearData();this.data=null;Ext.destroy(this.proxy);this.reader=this.writer=null;this.purgeListeners();this.isDestroyed=true;}},add:function(records){records=[].concat(records);if(records.length<1){return;}
for(var i=0,len=records.length;i<len;i++){records[i].join(this);}
var index=this.data.length;this.data.addAll(records);if(this.snapshot){this.snapshot.addAll(records);}
this.fireEvent('add',this,records,index);},addSorted:function(record){var index=this.findInsertIndex(record);this.insert(index,record);},remove:function(record){if(Ext.isArray(record)){Ext.each(record,function(r){this.remove(r);},this);return;}
var index=this.data.indexOf(record);if(index>-1){record.join(null);this.data.removeAt(index);}
if(this.pruneModifiedRecords){this.modified.remove(record);}
if(this.snapshot){this.snapshot.remove(record);}
if(index>-1){this.fireEvent('remove',this,record,index);}},removeAt:function(index){this.remove(this.getAt(index));},removeAll:function(silent){var items=[];this.each(function(rec){items.push(rec);});this.clearData();if(this.snapshot){this.snapshot.clear();}
if(this.pruneModifiedRecords){this.modified=[];}
if(silent!==true){this.fireEvent('clear',this,items);}},onClear:function(store,records){Ext.each(records,function(rec,index){this.destroyRecord(this,rec,index);},this);},insert:function(index,records){records=[].concat(records);for(var i=0,len=records.length;i<len;i++){this.data.insert(index,records[i]);records[i].join(this);}
if(this.snapshot){this.snapshot.addAll(records);}
this.fireEvent('add',this,records,index);},indexOf:function(record){return this.data.indexOf(record);},indexOfId:function(id){return this.data.indexOfKey(id);},getById:function(id){return(this.snapshot||this.data).key(id);},getAt:function(index){return this.data.itemAt(index);},getRange:function(start,end){return this.data.getRange(start,end);},storeOptions:function(o){o=Ext.apply({},o);delete o.callback;delete o.scope;this.lastOptions=o;},clearData:function(){this.data.each(function(rec){rec.join(null);});this.data.clear();},load:function(options){options=Ext.apply({},options);this.storeOptions(options);if(this.sortInfo&&this.remoteSort){var pn=this.paramNames;options.params=Ext.apply({},options.params);options.params[pn.sort]=this.sortInfo.field;options.params[pn.dir]=this.sortInfo.direction;}
try{return this.execute('read',null,options);}catch(e){this.handleException(e);return false;}},updateRecord:function(store,record,action){if(action==Ext.data.Record.EDIT&&this.autoSave===true&&(!record.phantom||(record.phantom&&record.isValid()))){this.save();}},createRecords:function(store,rs,index){for(var i=0,len=rs.length;i<len;i++){if(rs[i].phantom&&rs[i].isValid()){rs[i].markDirty();this.modified.push(rs[i]);}}
if(this.autoSave===true){this.save();}},destroyRecord:function(store,record,index){if(this.modified.indexOf(record)!=-1){this.modified.remove(record);}
if(!record.phantom){this.removed.push(record);record.lastIndex=index;if(this.autoSave===true){this.save();}}},execute:function(action,rs,options,batch){if(!Ext.data.Api.isAction(action)){throw new Ext.data.Api.Error('execute',action);}
options=Ext.applyIf(options||{},{params:{}});if(batch!==undefined){this.addToBatch(batch);}
var doRequest=true;if(action==='read'){doRequest=this.fireEvent('beforeload',this,options);Ext.applyIf(options.params,this.baseParams);}
else{if(this.writer.listful===true&&this.restful!==true){rs=(Ext.isArray(rs))?rs:[rs];}
else if(Ext.isArray(rs)&&rs.length==1){rs=rs.shift();}
if((doRequest=this.fireEvent('beforewrite',this,action,rs,options))!==false){this.writer.apply(options.params,this.baseParams,action,rs);}}
if(doRequest!==false){if(this.writer&&this.proxy.url&&!this.proxy.restful&&!Ext.data.Api.hasUniqueUrl(this.proxy,action)){options.params.xaction=action;}
this.proxy.request(Ext.data.Api.actions[action],rs,options.params,this.reader,this.createCallback(action,rs,batch),this,options);}
return doRequest;},save:function(){if(!this.writer){throw new Ext.data.Store.Error('writer-undefined');}
var queue=[],len,trans,batch,data={};if(this.removed.length){queue.push(['destroy',this.removed]);}
var rs=[].concat(this.getModifiedRecords());if(rs.length){var phantoms=[];for(var i=rs.length-1;i>=0;i--){if(rs[i].phantom===true){var rec=rs.splice(i,1).shift();if(rec.isValid()){phantoms.push(rec);}}else if(!rs[i].isValid()){rs.splice(i,1);}}
if(phantoms.length){queue.push(['create',phantoms]);}
if(rs.length){queue.push(['update',rs]);}}
len=queue.length;if(len){batch=++this.batchCounter;for(var i=0;i<len;++i){trans=queue[i];data[trans[0]]=trans[1];}
if(this.fireEvent('beforesave',this,data)!==false){for(var i=0;i<len;++i){trans=queue[i];this.doTransaction(trans[0],trans[1],batch);}
return batch;}}
return-1;},doTransaction:function(action,rs,batch){function transaction(records){try{this.execute(action,records,undefined,batch);}catch(e){this.handleException(e);}}
if(this.batch===false){for(var i=0,len=rs.length;i<len;i++){transaction.call(this,rs[i]);}}else{transaction.call(this,rs);}},addToBatch:function(batch){var b=this.batches,key=this.batchKey+batch,o=b[key];if(!o){b[key]=o={id:batch,count:0,data:{}};}
++o.count;},removeFromBatch:function(batch,action,data){var b=this.batches,key=this.batchKey+batch,o=b[key],data,arr;if(o){arr=o.data[action]||[];o.data[action]=arr.concat(data);if(o.count===1){data=o.data;delete b[key];this.fireEvent('save',this,batch,data);}else{--o.count;}}},createCallback:function(action,rs,batch){var actions=Ext.data.Api.actions;return(action=='read')?this.loadRecords:function(data,response,success){this['on'+Ext.util.Format.capitalize(action)+'Records'](success,rs,[].concat(data));if(success===true){this.fireEvent('write',this,action,data,response,rs);}
this.removeFromBatch(batch,action,data);};},clearModified:function(rs){if(Ext.isArray(rs)){for(var n=rs.length-1;n>=0;n--){this.modified.splice(this.modified.indexOf(rs[n]),1);}}else{this.modified.splice(this.modified.indexOf(rs),1);}},reMap:function(record){if(Ext.isArray(record)){for(var i=0,len=record.length;i<len;i++){this.reMap(record[i]);}}else{delete this.data.map[record._phid];this.data.map[record.id]=record;var index=this.data.keys.indexOf(record._phid);this.data.keys.splice(index,1,record.id);delete record._phid;}},onCreateRecords:function(success,rs,data){if(success===true){try{this.reader.realize(rs,data);this.reMap(rs);}
catch(e){this.handleException(e);if(Ext.isArray(rs)){this.onCreateRecords(success,rs,data);}}}},onUpdateRecords:function(success,rs,data){if(success===true){try{this.reader.update(rs,data);}catch(e){this.handleException(e);if(Ext.isArray(rs)){this.onUpdateRecords(success,rs,data);}}}},onDestroyRecords:function(success,rs,data){rs=(rs instanceof Ext.data.Record)?[rs]:[].concat(rs);for(var i=0,len=rs.length;i<len;i++){this.removed.splice(this.removed.indexOf(rs[i]),1);}
if(success===false){for(i=rs.length-1;i>=0;i--){this.insert(rs[i].lastIndex,rs[i]);}}},handleException:function(e){Ext.handleError(e);},reload:function(options){this.load(Ext.applyIf(options||{},this.lastOptions));},loadRecords:function(o,options,success){if(this.isDestroyed===true){return;}
if(!o||success===false){if(success!==false){this.fireEvent('load',this,[],options);}
if(options.callback){options.callback.call(options.scope||this,[],options,false,o);}
return;}
var r=o.records,t=o.totalRecords||r.length;if(!options||options.add!==true){if(this.pruneModifiedRecords){this.modified=[];}
for(var i=0,len=r.length;i<len;i++){r[i].join(this);}
if(this.snapshot){this.data=this.snapshot;delete this.snapshot;}
this.clearData();this.data.addAll(r);this.totalLength=t;this.applySort();this.fireEvent('datachanged',this);}else{this.totalLength=Math.max(t,this.data.length+r.length);this.add(r);}
this.fireEvent('load',this,r,options);if(options.callback){options.callback.call(options.scope||this,r,options,true);}},loadData:function(o,append){var r=this.reader.readRecords(o);this.loadRecords(r,{add:append},true);},getCount:function(){return this.data.length||0;},getTotalCount:function(){return this.totalLength||0;},getSortState:function(){return this.sortInfo;},applySort:function(){if((this.sortInfo||this.multiSortInfo)&&!this.remoteSort){this.sortData();}},sortData:function(){var sortInfo=this.hasMultiSort?this.multiSortInfo:this.sortInfo,direction=sortInfo.direction||"ASC",sorters=sortInfo.sorters,sortFns=[];if(!this.hasMultiSort){sorters=[{direction:direction,field:sortInfo.field}];}
for(var i=0,j=sorters.length;i<j;i++){sortFns.push(this.createSortFunction(sorters[i].field,sorters[i].direction));}
if(sortFns.length==0){return;}
var directionModifier=direction.toUpperCase()=="DESC"?-1:1;var fn=function(r1,r2){var result=sortFns[0].call(this,r1,r2);if(sortFns.length>1){for(var i=1,j=sortFns.length;i<j;i++){result=result||sortFns[i].call(this,r1,r2);}}
return directionModifier*result;};this.data.sort(direction,fn);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(direction,fn);}},createSortFunction:function(field,direction){direction=direction||"ASC";var directionModifier=direction.toUpperCase()=="DESC"?-1:1;var sortType=this.fields.get(field).sortType;return function(r1,r2){var v1=sortType(r1.data[field]),v2=sortType(r2.data[field]);return directionModifier*(v1>v2?1:(v1<v2?-1:0));};},setDefaultSort:function(field,dir){dir=dir?dir.toUpperCase():'ASC';this.sortInfo={field:field,direction:dir};this.sortToggle[field]=dir;},sort:function(fieldName,dir){if(Ext.isArray(arguments[0])){return this.multiSort.call(this,fieldName,dir);}else{return this.singleSort(fieldName,dir);}},singleSort:function(fieldName,dir){var field=this.fields.get(fieldName);if(!field)return false;var name=field.name,sortInfo=this.sortInfo||null,sortToggle=this.sortToggle?this.sortToggle[name]:null;if(!dir){if(sortInfo&&sortInfo.field==name){dir=(this.sortToggle[name]||'ASC').toggle('ASC','DESC');}else{dir=field.sortDir;}}
this.sortToggle[name]=dir;this.sortInfo={field:name,direction:dir};this.hasMultiSort=false;if(this.remoteSort){if(!this.load(this.lastOptions)){if(sortToggle){this.sortToggle[name]=sortToggle;}
if(sortInfo){this.sortInfo=sortInfo;}}}else{this.applySort();this.fireEvent('datachanged',this);}},multiSort:function(sorters,direction){this.hasMultiSort=true;direction=direction||"ASC";if(this.multiSortInfo&&direction==this.multiSortInfo.direction){direction=direction.toggle("ASC","DESC");}
this.multiSortInfo={sorters:sorters,direction:direction};if(this.remoteSort){this.singleSort(sorters[0].field,sorters[0].direction);}else{this.applySort();this.fireEvent('datachanged',this);}},each:function(fn,scope){this.data.each(fn,scope);},getModifiedRecords:function(){return this.modified;},sum:function(property,start,end){var rs=this.data.items,v=0;start=start||0;end=(end||end===0)?end:rs.length-1;for(var i=start;i<=end;i++){v+=(rs[i].data[property]||0);}
return v;},createFilterFn:function(property,value,anyMatch,caseSensitive,exactMatch){if(Ext.isEmpty(value,false)){return false;}
value=this.data.createValueMatcher(value,anyMatch,caseSensitive,exactMatch);return function(r){return value.test(r.data[property]);};},createMultipleFilterFn:function(filters){return function(record){var isMatch=true;for(var i=0,j=filters.length;i<j;i++){var filter=filters[i],fn=filter.fn,scope=filter.scope;isMatch=isMatch&&fn.call(scope,record);}
return isMatch;};},filter:function(property,value,anyMatch,caseSensitive,exactMatch){if(Ext.isObject(property)){property=[property];}
if(Ext.isArray(property)){var filters=[];for(var i=0,j=property.length;i<j;i++){var filter=property[i],func=filter.fn,scope=filter.scope||this;if(!Ext.isFunction(func)){func=this.createFilterFn(filter.property,filter.value,filter.anyMatch,filter.caseSensitive,filter.exactMatch);}
filters.push({fn:func,scope:scope});}
var fn=this.createMultipleFilterFn(filters);}else{var fn=this.createFilterFn(property,value,anyMatch,caseSensitive,exactMatch);}
return fn?this.filterBy(fn):this.clearFilter();},filterBy:function(fn,scope){this.snapshot=this.snapshot||this.data;this.data=this.queryBy(fn,scope||this);this.fireEvent('datachanged',this);},clearFilter:function(suppressEvent){if(this.isFiltered()){this.data=this.snapshot;delete this.snapshot;if(suppressEvent!==true){this.fireEvent('datachanged',this);}}},isFiltered:function(){return!!this.snapshot&&this.snapshot!=this.data;},query:function(property,value,anyMatch,caseSensitive){var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);return fn?this.queryBy(fn):this.data.clone();},queryBy:function(fn,scope){var data=this.snapshot||this.data;return data.filterBy(fn,scope||this);},find:function(property,value,start,anyMatch,caseSensitive){var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);return fn?this.data.findIndexBy(fn,null,start):-1;},findExact:function(property,value,start){return this.data.findIndexBy(function(rec){return rec.get(property)===value;},this,start);},findBy:function(fn,scope,start){return this.data.findIndexBy(fn,scope,start);},collect:function(dataIndex,allowNull,bypassFilter){var d=(bypassFilter===true&&this.snapshot)?this.snapshot.items:this.data.items;var v,sv,r=[],l={};for(var i=0,len=d.length;i<len;i++){v=d[i].data[dataIndex];sv=String(v);if((allowNull||!Ext.isEmpty(v))&&!l[sv]){l[sv]=true;r[r.length]=v;}}
return r;},afterEdit:function(record){if(this.modified.indexOf(record)==-1){this.modified.push(record);}
this.fireEvent('update',this,record,Ext.data.Record.EDIT);},afterReject:function(record){this.modified.remove(record);this.fireEvent('update',this,record,Ext.data.Record.REJECT);},afterCommit:function(record){this.modified.remove(record);this.fireEvent('update',this,record,Ext.data.Record.COMMIT);},commitChanges:function(){var m=this.modified.slice(0);this.modified=[];for(var i=0,len=m.length;i<len;i++){m[i].commit();}},rejectChanges:function(){var m=this.modified.slice(0);this.modified=[];for(var i=0,len=m.length;i<len;i++){m[i].reject();}
var m=this.removed.slice(0).reverse();this.removed=[];for(var i=0,len=m.length;i<len;i++){this.insert(m[i].lastIndex||0,m[i]);m[i].reject();}},onMetaChange:function(meta){this.recordType=this.reader.recordType;this.fields=this.recordType.prototype.fields;delete this.snapshot;if(this.reader.meta.sortInfo){this.sortInfo=this.reader.meta.sortInfo;}else if(this.sortInfo&&!this.fields.get(this.sortInfo.field)){delete this.sortInfo;}
if(this.writer){this.writer.meta=this.reader.meta;}
this.modified=[];this.fireEvent('metachange',this,this.reader.meta);},findInsertIndex:function(record){this.suspendEvents();var data=this.data.clone();this.data.add(record);this.applySort();var index=this.data.indexOf(record);this.data=data;this.resumeEvents();return index;},setBaseParam:function(name,value){this.baseParams=this.baseParams||{};this.baseParams[name]=value;}});Ext.reg('store',Ext.data.Store);Ext.data.Store.Error=Ext.extend(Ext.Error,{name:'Ext.data.Store'});Ext.apply(Ext.data.Store.Error.prototype,{lang:{'writer-undefined':'Attempted to execute a write-action without a DataWriter installed.'}});Ext.data.Field=Ext.extend(Object,{constructor:function(config){if(Ext.isString(config)){config={name:config};}
Ext.apply(this,config);var types=Ext.data.Types,st=this.sortType,t;if(this.type){if(Ext.isString(this.type)){this.type=Ext.data.Types[this.type.toUpperCase()]||types.AUTO;}}else{this.type=types.AUTO;}
if(Ext.isString(st)){this.sortType=Ext.data.SortTypes[st];}else if(Ext.isEmpty(st)){this.sortType=this.type.sortType;}
if(!this.convert){this.convert=this.type.convert;}},dateFormat:null,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true});Ext.data.DataReader=function(meta,recordType){this.meta=meta;this.recordType=Ext.isArray(recordType)?Ext.data.Record.create(recordType):recordType;if(this.recordType){this.buildExtractors();}};Ext.data.DataReader.prototype={getTotal:Ext.emptyFn,getRoot:Ext.emptyFn,getMessage:Ext.emptyFn,getSuccess:Ext.emptyFn,getId:Ext.emptyFn,buildExtractors:Ext.emptyFn,extractValues:Ext.emptyFn,realize:function(rs,data){if(Ext.isArray(rs)){for(var i=rs.length-1;i>=0;i--){if(Ext.isArray(data)){this.realize(rs.splice(i,1).shift(),data.splice(i,1).shift());}
else{this.realize(rs.splice(i,1).shift(),data);}}}
else{if(Ext.isArray(data)&&data.length==1){data=data.shift();}
if(!this.isData(data)){throw new Ext.data.DataReader.Error('realize',rs);}
rs.phantom=false;rs._phid=rs.id;rs.id=this.getId(data);rs.data=data;rs.commit();}},update:function(rs,data){if(Ext.isArray(rs)){for(var i=rs.length-1;i>=0;i--){if(Ext.isArray(data)){this.update(rs.splice(i,1).shift(),data.splice(i,1).shift());}
else{this.update(rs.splice(i,1).shift(),data);}}}
else{if(Ext.isArray(data)&&data.length==1){data=data.shift();}
if(this.isData(data)){rs.data=Ext.apply(rs.data,data);}
rs.commit();}},extractData:function(root,returnRecords){var rawName=(this instanceof Ext.data.JsonReader)?'json':'node';var rs=[];if(this.isData(root)&&!(this instanceof Ext.data.XmlReader)){root=[root];}
var f=this.recordType.prototype.fields,fi=f.items,fl=f.length,rs=[];if(returnRecords===true){var Record=this.recordType;for(var i=0;i<root.length;i++){var n=root[i];var record=new Record(this.extractValues(n,fi,fl),this.getId(n));record[rawName]=n;rs.push(record);}}
else{for(var i=0;i<root.length;i++){var data=this.extractValues(root[i],fi,fl);data[this.meta.idProperty]=this.getId(root[i]);rs.push(data);}}
return rs;},isData:function(data){return(data&&Ext.isObject(data)&&!Ext.isEmpty(this.getId(data)))?true:false;},onMetaChange:function(meta){delete this.ef;this.meta=meta;this.recordType=Ext.data.Record.create(meta.fields);this.buildExtractors();}};Ext.data.DataReader.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message);},name:'Ext.data.DataReader'});Ext.apply(Ext.data.DataReader.Error.prototype,{lang:{'update':"#update received invalid data from server.  Please see docs for DataReader#update and review your DataReader configuration.",'realize':"#realize was called with invalid remote-data.  Please see the docs for DataReader#realize and review your DataReader configuration.",'invalid-response':"#readResponse received an invalid response from the server."}});Ext.data.DataWriter=function(config){Ext.apply(this,config);};Ext.data.DataWriter.prototype={writeAllFields:false,listful:false,apply:function(params,baseParams,action,rs){var data=[],renderer=action+'Record';if(Ext.isArray(rs)){Ext.each(rs,function(rec){data.push(this[renderer](rec));},this);}
else if(rs instanceof Ext.data.Record){data=this[renderer](rs);}
this.render(params,baseParams,data);},render:Ext.emptyFn,updateRecord:Ext.emptyFn,createRecord:Ext.emptyFn,destroyRecord:Ext.emptyFn,toHash:function(rec,config){var map=rec.fields.map,data={},raw=(this.writeAllFields===false&&rec.phantom===false)?rec.getChanges():rec.data,m;Ext.iterate(raw,function(prop,value){if((m=map[prop])){data[m.mapping?m.mapping:m.name]=value;}});if(rec.phantom){if(rec.fields.containsKey(this.meta.idProperty)&&Ext.isEmpty(rec.data[this.meta.idProperty])){delete data[this.meta.idProperty];}}else{data[this.meta.idProperty]=rec.id}
return data;},toArray:function(data){var fields=[];Ext.iterate(data,function(k,v){fields.push({name:k,value:v});},this);return fields;}};Ext.data.DataProxy=function(conn){conn=conn||{};this.api=conn.api;this.url=conn.url;this.restful=conn.restful;this.listeners=conn.listeners;this.prettyUrls=conn.prettyUrls;this.addEvents('exception','beforeload','load','loadexception','beforewrite','write');Ext.data.DataProxy.superclass.constructor.call(this);try{Ext.data.Api.prepare(this);}catch(e){if(e instanceof Ext.data.Api.Error){e.toConsole();}}
Ext.data.DataProxy.relayEvents(this,['beforewrite','write','exception']);};Ext.extend(Ext.data.DataProxy,Ext.util.Observable,{restful:false,setApi:function(){if(arguments.length==1){var valid=Ext.data.Api.isValid(arguments[0]);if(valid===true){this.api=arguments[0];}
else{throw new Ext.data.Api.Error('invalid',valid);}}
else if(arguments.length==2){if(!Ext.data.Api.isAction(arguments[0])){throw new Ext.data.Api.Error('invalid',arguments[0]);}
this.api[arguments[0]]=arguments[1];}
Ext.data.Api.prepare(this);},isApiAction:function(action){return(this.api[action])?true:false;},request:function(action,rs,params,reader,callback,scope,options){if(!this.api[action]&&!this.load){throw new Ext.data.DataProxy.Error('action-undefined',action);}
params=params||{};if((action===Ext.data.Api.actions.read)?this.fireEvent("beforeload",this,params):this.fireEvent("beforewrite",this,action,rs,params)!==false){this.doRequest.apply(this,arguments);}
else{callback.call(scope||this,null,options,false);}},load:null,doRequest:function(action,rs,params,reader,callback,scope,options){this.load(params,reader,callback,scope,options);},onRead:Ext.emptyFn,onWrite:Ext.emptyFn,buildUrl:function(action,record){record=record||null;var url=(this.conn&&this.conn.url)?this.conn.url:(this.api[action])?this.api[action].url:this.url;if(!url){throw new Ext.data.Api.Error('invalid-url',action);}
var provides=null;var m=url.match(/(.*)(\.json|\.xml|\.html)$/);if(m){provides=m[2];url=m[1];}
if((this.restful===true||this.prettyUrls===true)&&record instanceof Ext.data.Record&&!record.phantom){url+='/'+record.id;}
return(provides===null)?url:url+provides;},destroy:function(){this.purgeListeners();}});Ext.apply(Ext.data.DataProxy,Ext.util.Observable.prototype);Ext.util.Observable.call(Ext.data.DataProxy);Ext.data.DataProxy.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message);},name:'Ext.data.DataProxy'});Ext.apply(Ext.data.DataProxy.Error.prototype,{lang:{'action-undefined':"DataProxy attempted to execute an API-action but found an undefined url / function.  Please review your Proxy url/api-configuration.",'api-invalid':'Recieved an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions from Ext.data.Api.actions.'}});Ext.data.Request=function(params){Ext.apply(this,params);};Ext.data.Request.prototype={action:undefined,rs:undefined,params:undefined,callback:Ext.emptyFn,scope:undefined,reader:undefined};Ext.data.Response=function(params){Ext.apply(this,params);};Ext.data.Response.prototype={action:undefined,success:undefined,message:undefined,data:undefined,raw:undefined,records:undefined};Ext.data.ScriptTagProxy=function(config){Ext.apply(this,config);Ext.data.ScriptTagProxy.superclass.constructor.call(this,config);this.head=document.getElementsByTagName("head")[0];};Ext.data.ScriptTagProxy.TRANS_ID=1000;Ext.extend(Ext.data.ScriptTagProxy,Ext.data.DataProxy,{timeout:30000,callbackParam:"callback",nocache:true,doRequest:function(action,rs,params,reader,callback,scope,arg){var p=Ext.urlEncode(Ext.apply(params,this.extraParams));var url=this.buildUrl(action,rs);if(!url){throw new Ext.data.Api.Error('invalid-url',url);}
url=Ext.urlAppend(url,p);if(this.nocache){url=Ext.urlAppend(url,'_dc='+(new Date().getTime()));}
var transId=++Ext.data.ScriptTagProxy.TRANS_ID;var trans={id:transId,action:action,cb:"stcCallback"+transId,scriptId:"stcScript"+transId,params:params,arg:arg,url:url,callback:callback,scope:scope,reader:reader};window[trans.cb]=this.createCallback(action,rs,trans);url+=String.format("&{0}={1}",this.callbackParam,trans.cb);if(this.autoAbort!==false){this.abort();}
trans.timeoutId=this.handleFailure.defer(this.timeout,this,[trans]);var script=document.createElement("script");script.setAttribute("src",url);script.setAttribute("type","text/javascript");script.setAttribute("id",trans.scriptId);this.head.appendChild(script);this.trans=trans;},createCallback:function(action,rs,trans){var self=this;return function(res){self.trans=false;self.destroyTrans(trans,true);if(action===Ext.data.Api.actions.read){self.onRead.call(self,action,trans,res);}else{self.onWrite.call(self,action,trans,res,rs);}};},onRead:function(action,trans,res){var result;try{result=trans.reader.readRecords(res);}catch(e){this.fireEvent("loadexception",this,trans,res,e);this.fireEvent('exception',this,'response',action,trans,res,e);trans.callback.call(trans.scope||window,null,trans.arg,false);return;}
if(result.success===false){this.fireEvent('loadexception',this,trans,res);this.fireEvent('exception',this,'remote',action,trans,res,null);}else{this.fireEvent("load",this,res,trans.arg);}
trans.callback.call(trans.scope||window,result,trans.arg,result.success);},onWrite:function(action,trans,response,rs){var reader=trans.reader;try{var res=reader.readResponse(action,response);}catch(e){this.fireEvent('exception',this,'response',action,trans,res,e);trans.callback.call(trans.scope||window,null,res,false);return;}
if(!res.success===true){this.fireEvent('exception',this,'remote',action,trans,res,rs);trans.callback.call(trans.scope||window,null,res,false);return;}
this.fireEvent("write",this,action,res.data,res,rs,trans.arg);trans.callback.call(trans.scope||window,res.data,res,true);},isLoading:function(){return this.trans?true:false;},abort:function(){if(this.isLoading()){this.destroyTrans(this.trans);}},destroyTrans:function(trans,isLoaded){this.head.removeChild(document.getElementById(trans.scriptId));clearTimeout(trans.timeoutId);if(isLoaded){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}}else{window[trans.cb]=function(){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}};}},handleFailure:function(trans){this.trans=false;this.destroyTrans(trans,false);if(trans.action===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,null,trans.arg);}
this.fireEvent('exception',this,'response',trans.action,{response:null,options:trans.arg});trans.callback.call(trans.scope||window,null,trans.arg,false);},destroy:function(){this.abort();Ext.data.ScriptTagProxy.superclass.destroy.call(this);}});Ext.data.HttpProxy=function(conn){Ext.data.HttpProxy.superclass.constructor.call(this,conn);this.conn=conn;this.conn.url=null;this.useAjax=!conn||!conn.events;var actions=Ext.data.Api.actions;this.activeRequest={};for(var verb in actions){this.activeRequest[actions[verb]]=undefined;}};Ext.extend(Ext.data.HttpProxy,Ext.data.DataProxy,{getConnection:function(){return this.useAjax?Ext.Ajax:this.conn;},setUrl:function(url,makePermanent){this.conn.url=url;if(makePermanent===true){this.url=url;this.api=null;Ext.data.Api.prepare(this);}},doRequest:function(action,rs,params,reader,cb,scope,arg){var o={method:(this.api[action])?this.api[action]['method']:undefined,request:{callback:cb,scope:scope,arg:arg},reader:reader,callback:this.createCallback(action,rs),scope:this};if(params.jsonData){o.jsonData=params.jsonData;}else if(params.xmlData){o.xmlData=params.xmlData;}else{o.params=params||{};}
this.conn.url=this.buildUrl(action,rs);if(this.useAjax){Ext.applyIf(o,this.conn);if(this.activeRequest[action]){}
this.activeRequest[action]=Ext.Ajax.request(o);}else{this.conn.request(o);}
this.conn.url=null;},createCallback:function(action,rs){return function(o,success,response){this.activeRequest[action]=undefined;if(!success){if(action===Ext.data.Api.actions.read){this.fireEvent('loadexception',this,o,response);}
this.fireEvent('exception',this,'response',action,o,response);o.request.callback.call(o.request.scope,null,o.request.arg,false);return;}
if(action===Ext.data.Api.actions.read){this.onRead(action,o,response);}else{this.onWrite(action,o,response,rs);}};},onRead:function(action,o,response){var result;try{result=o.reader.read(response);}catch(e){this.fireEvent('loadexception',this,o,response,e);this.fireEvent('exception',this,'response',action,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return;}
if(result.success===false){this.fireEvent('loadexception',this,o,response);var res=o.reader.readResponse(action,response);this.fireEvent('exception',this,'remote',action,o,res,null);}
else{this.fireEvent('load',this,o,o.request.arg);}
o.request.callback.call(o.request.scope,result,o.request.arg,result.success);},onWrite:function(action,o,response,rs){var reader=o.reader;var res;try{res=reader.readResponse(action,response);}catch(e){this.fireEvent('exception',this,'response',action,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return;}
if(res.success===true){this.fireEvent('write',this,action,res.data,res,rs,o.request.arg);}else{this.fireEvent('exception',this,'remote',action,o,res,rs);}
o.request.callback.call(o.request.scope,res.data,res,res.success);},destroy:function(){if(!this.useAjax){this.conn.abort();}else if(this.activeRequest){var actions=Ext.data.Api.actions;for(var verb in actions){if(this.activeRequest[actions[verb]]){Ext.Ajax.abort(this.activeRequest[actions[verb]]);}}}
Ext.data.HttpProxy.superclass.destroy.call(this);}});Ext.data.MemoryProxy=function(data){var api={};api[Ext.data.Api.actions.read]=true;Ext.data.MemoryProxy.superclass.constructor.call(this,{api:api});this.data=data;};Ext.extend(Ext.data.MemoryProxy,Ext.data.DataProxy,{doRequest:function(action,rs,params,reader,callback,scope,arg){params=params||{};var result;try{result=reader.readRecords(this.data);}catch(e){this.fireEvent("loadexception",this,null,arg,e);this.fireEvent('exception',this,'response',action,arg,null,e);callback.call(scope,null,arg,false);return;}
callback.call(scope,result,arg,true);}});Ext.data.Types=new function(){var st=Ext.data.SortTypes;Ext.apply(this,{stripRe:/[\$,%]/g,AUTO:{convert:function(v){return v;},sortType:st.none,type:'auto'},STRING:{convert:function(v){return(v===undefined||v===null)?'':String(v);},sortType:st.asUCString,type:'string'},INT:{convert:function(v){return v!==undefined&&v!==null&&v!==''?parseInt(String(v).replace(Ext.data.Types.stripRe,''),10):0;},sortType:st.none,type:'int'},FLOAT:{convert:function(v){return v!==undefined&&v!==null&&v!==''?parseFloat(String(v).replace(Ext.data.Types.stripRe,''),10):0;},sortType:st.none,type:'float'},BOOL:{convert:function(v){return v===true||v==='true'||v==1;},sortType:st.none,type:'bool'},DATE:{convert:function(v){var df=this.dateFormat;if(!v){return null;}
if(Ext.isDate(v)){return v;}
if(df){if(df=='timestamp'){return new Date(v*1000);}
if(df=='time'){return new Date(parseInt(v,10));}
return Date.parseDate(v,df);}
var parsed=Date.parse(v);return parsed?new Date(parsed):null;},sortType:st.asDate,type:'date'}});Ext.apply(this,{BOOLEAN:this.BOOL,INTEGER:this.INT,NUMBER:this.FLOAT});};Ext.data.JsonWriter=Ext.extend(Ext.data.DataWriter,{encode:true,encodeDelete:false,constructor:function(config){Ext.data.JsonWriter.superclass.constructor.call(this,config);},render:function(params,baseParams,data){if(this.encode===true){Ext.apply(params,baseParams);params[this.meta.root]=Ext.encode(data);}else{var jdata=Ext.apply({},baseParams);jdata[this.meta.root]=data;params.jsonData=jdata;}},createRecord:function(rec){return this.toHash(rec);},updateRecord:function(rec){return this.toHash(rec);},destroyRecord:function(rec){if(this.encodeDelete){var data={};data[this.meta.idProperty]=rec.id;return data;}else{return rec.id;}}});Ext.data.JsonReader=function(meta,recordType){meta=meta||{};Ext.applyIf(meta,{idProperty:'id',successProperty:'success',totalProperty:'total'});Ext.data.JsonReader.superclass.constructor.call(this,meta,recordType||meta.fields);};Ext.extend(Ext.data.JsonReader,Ext.data.DataReader,{read:function(response){var json=response.responseText;var o=Ext.decode(json);if(!o){throw{message:'JsonReader.read: Json object not found'};}
return this.readRecords(o);},readResponse:function(action,response){var o=(response.responseText!==undefined)?Ext.decode(response.responseText):response;if(!o){throw new Ext.data.JsonReader.Error('response');}
var root=this.getRoot(o);if(action===Ext.data.Api.actions.create){var def=Ext.isDefined(root);if(def&&Ext.isEmpty(root)){throw new Ext.data.JsonReader.Error('root-empty',this.meta.root);}
else if(!def){throw new Ext.data.JsonReader.Error('root-undefined-response',this.meta.root);}}
var res=new Ext.data.Response({action:action,success:this.getSuccess(o),data:(root)?this.extractData(root,false):[],message:this.getMessage(o),raw:o});if(Ext.isEmpty(res.success)){throw new Ext.data.JsonReader.Error('successProperty-response',this.meta.successProperty);}
return res;},readRecords:function(o){this.jsonData=o;if(o.metaData){this.onMetaChange(o.metaData);}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length,v;var root=this.getRoot(o),c=root.length,totalRecords=c,success=true;if(s.totalProperty){v=parseInt(this.getTotal(o),10);if(!isNaN(v)){totalRecords=v;}}
if(s.successProperty){v=this.getSuccess(o);if(v===false||v==='false'){success=false;}}
return{success:success,records:this.extractData(root,true),totalRecords:totalRecords};},buildExtractors:function(){if(this.ef){return;}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(s.totalProperty){this.getTotal=this.createAccessor(s.totalProperty);}
if(s.successProperty){this.getSuccess=this.createAccessor(s.successProperty);}
if(s.messageProperty){this.getMessage=this.createAccessor(s.messageProperty);}
this.getRoot=s.root?this.createAccessor(s.root):function(p){return p;};if(s.id||s.idProperty){var g=this.createAccessor(s.id||s.idProperty);this.getId=function(rec){var r=g(rec);return(r===undefined||r==='')?null:r;};}else{this.getId=function(){return null;};}
var ef=[];for(var i=0;i<fl;i++){f=fi[i];var map=(f.mapping!==undefined&&f.mapping!==null)?f.mapping:f.name;ef.push(this.createAccessor(map));}
this.ef=ef;},simpleAccess:function(obj,subsc){return obj[subsc];},createAccessor:function(){var re=/[\[\.]/;return function(expr){if(Ext.isEmpty(expr)){return Ext.emptyFn;}
if(Ext.isFunction(expr)){return expr;}
var i=String(expr).search(re);if(i>=0){return new Function('obj','return obj'+(i>0?'.':'')+expr);}
return function(obj){return obj[expr];};};}(),extractValues:function(data,items,len){var f,values={};for(var j=0;j<len;j++){f=items[j];var v=this.ef[j](data);values[f.name]=f.convert((v!==undefined)?v:f.defaultValue,data);}
return values;}});Ext.data.JsonReader.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message);},name:'Ext.data.JsonReader'});Ext.apply(Ext.data.JsonReader.Error.prototype,{lang:{'response':'An error occurred while json-decoding your server response','successProperty-response':'Could not locate your "successProperty" in your server response.  Please review your JsonReader config to ensure the config-property "successProperty" matches the property in your server-response.  See the JsonReader docs.','root-undefined-config':'Your JsonReader was configured without a "root" property.  Please review your JsonReader config and make sure to define the root property.  See the JsonReader docs.','idProperty-undefined':'Your JsonReader was configured without an "idProperty"  Please review your JsonReader configuration and ensure the "idProperty" is set (e.g.: "id").  See the JsonReader docs.','root-empty':'Data was expected to be returned by the server in the "root" property of the response.  Please review your JsonReader configuration to ensure the "root" property matches that returned in the server-response.  See JsonReader docs.'}});Ext.data.ArrayReader=Ext.extend(Ext.data.JsonReader,{readRecords:function(o){this.arrayData=o;var s=this.meta,sid=s?Ext.num(s.idIndex,s.id):null,recordType=this.recordType,fields=recordType.prototype.fields,records=[],success=true,v;var root=this.getRoot(o);for(var i=0,len=root.length;i<len;i++){var n=root[i],values={},id=((sid||sid===0)&&n[sid]!==undefined&&n[sid]!==""?n[sid]:null);for(var j=0,jlen=fields.length;j<jlen;j++){var f=fields.items[j],k=f.mapping!==undefined&&f.mapping!==null?f.mapping:j;v=n[k]!==undefined?n[k]:f.defaultValue;v=f.convert(v,n);values[f.name]=v;}
var record=new recordType(values,id);record.json=n;records[records.length]=record;}
var totalRecords=records.length;if(s.totalProperty){v=parseInt(this.getTotal(o),10);if(!isNaN(v)){totalRecords=v;}}
if(s.successProperty){v=this.getSuccess(o);if(v===false||v==='false'){success=false;}}
return{success:success,records:records,totalRecords:totalRecords};}});Ext.data.ArrayStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.ArrayStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.ArrayReader(config)}));},loadData:function(data,append){if(this.expandData===true){var r=[];for(var i=0,len=data.length;i<len;i++){r[r.length]=[data[i]];}
data=r;}
Ext.data.ArrayStore.superclass.loadData.call(this,data,append);}});Ext.reg('arraystore',Ext.data.ArrayStore);Ext.data.SimpleStore=Ext.data.ArrayStore;Ext.reg('simplestore',Ext.data.SimpleStore);Ext.data.JsonStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.JsonStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.JsonReader(config)}));}});Ext.reg('jsonstore',Ext.data.JsonStore);Ext.data.XmlWriter=function(params){Ext.data.XmlWriter.superclass.constructor.apply(this,arguments);this.tpl=(typeof(this.tpl)==='string')?new Ext.XTemplate(this.tpl).compile():this.tpl.compile();};Ext.extend(Ext.data.XmlWriter,Ext.data.DataWriter,{documentRoot:'xrequest',forceDocumentRoot:false,root:'records',xmlVersion:'1.0',xmlEncoding:'ISO-8859-15',tpl:'<tpl for="."><\u003fxml version="{version}" encoding="{encoding}"\u003f><tpl if="documentRoot"><{documentRoot}><tpl for="baseParams"><tpl for="."><{name}>{value}</{name}</tpl></tpl></tpl><tpl if="records.length&gt;1"><{root}></tpl><tpl for="records"><{parent.record}><tpl for="."><{name}>{value}</{name}></tpl></{parent.record}></tpl><tpl if="records.length&gt;1"></{root}></tpl><tpl if="documentRoot"></{documentRoot}></tpl></tpl>',render:function(params,baseParams,data){baseParams=this.toArray(baseParams);params.xmlData=this.tpl.applyTemplate({version:this.xmlVersion,encoding:this.xmlEncoding,documentRoot:(baseParams.length>0||this.forceDocumentRoot===true)?this.documentRoot:false,record:this.meta.record,root:this.root,baseParams:baseParams,records:(Ext.isArray(data[0]))?data:[data]});},createRecord:function(rec){return this.toArray(this.toHash(rec));},updateRecord:function(rec){return this.toArray(this.toHash(rec));},destroyRecord:function(rec){var data={};data[this.meta.idProperty]=rec.id;return this.toArray(data);}});Ext.data.XmlReader=function(meta,recordType){meta=meta||{};Ext.applyIf(meta,{idProperty:meta.idProperty||meta.idPath||meta.id,successProperty:meta.successProperty||meta.success});Ext.data.XmlReader.superclass.constructor.call(this,meta,recordType||meta.fields);};Ext.extend(Ext.data.XmlReader,Ext.data.DataReader,{read:function(response){var doc=response.responseXML;if(!doc){throw{message:"XmlReader.read: XML Document not available"};}
return this.readRecords(doc);},readRecords:function(doc){this.xmlData=doc;var root=doc.documentElement||doc,q=Ext.DomQuery,totalRecords=0,success=true;if(this.meta.totalProperty){totalRecords=this.getTotal(root,0);}
if(this.meta.successProperty){success=this.getSuccess(root);}
var records=this.extractData(q.select(this.meta.record,root),true);return{success:success,records:records,totalRecords:totalRecords||records.length};},readResponse:function(action,response){var q=Ext.DomQuery,doc=response.responseXML;var res=new Ext.data.Response({action:action,success:this.getSuccess(doc),message:this.getMessage(doc),data:this.extractData(q.select(this.meta.record,doc)||q.select(this.meta.root,doc),false),raw:doc});if(Ext.isEmpty(res.success)){throw new Ext.data.DataReader.Error('successProperty-response',this.meta.successProperty);}
if(action===Ext.data.Api.actions.create){var def=Ext.isDefined(res.data);if(def&&Ext.isEmpty(res.data)){throw new Ext.data.JsonReader.Error('root-empty',this.meta.root);}
else if(!def){throw new Ext.data.JsonReader.Error('root-undefined-response',this.meta.root);}}
return res;},getSuccess:function(){return true;},buildExtractors:function(){if(this.ef){return;}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(s.totalProperty){this.getTotal=this.createAccessor(s.totalProperty);}
if(s.successProperty){this.getSuccess=this.createAccessor(s.successProperty);}
if(s.messageProperty){this.getMessage=this.createAccessor(s.messageProperty);}
this.getRoot=function(res){return(!Ext.isEmpty(res[this.meta.record]))?res[this.meta.record]:res[this.meta.root];};if(s.idPath||s.idProperty){var g=this.createAccessor(s.idPath||s.idProperty);this.getId=function(rec){var id=g(rec)||rec.id;return(id===undefined||id==='')?null:id;};}else{this.getId=function(){return null;};}
var ef=[];for(var i=0;i<fl;i++){f=fi[i];var map=(f.mapping!==undefined&&f.mapping!==null)?f.mapping:f.name;ef.push(this.createAccessor(map));}
this.ef=ef;},createAccessor:function(){var q=Ext.DomQuery;return function(key){switch(key){case this.meta.totalProperty:return function(root,def){return q.selectNumber(key,root,def);};break;case this.meta.successProperty:return function(root,def){var sv=q.selectValue(key,root,true);var success=sv!==false&&sv!=='false';return success;};break;default:return function(root,def){return q.selectValue(key,root,def);};break;}};}(),extractValues:function(data,items,len){var f,values={};for(var j=0;j<len;j++){f=items[j];var v=this.ef[j](data);values[f.name]=f.convert((v!==undefined)?v:f.defaultValue,data);}
return values;}});Ext.data.XmlStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.XmlStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.XmlReader(config)}));}});Ext.reg('xmlstore',Ext.data.XmlStore);Ext.data.GroupingStore=Ext.extend(Ext.data.Store,{constructor:function(config){config=config||{};this.hasMultiSort=true;this.multiSortInfo=this.multiSortInfo||{sorters:[]};var sorters=this.multiSortInfo.sorters,groupField=config.groupField||this.groupField,sortInfo=config.sortInfo||this.sortInfo,groupDir=config.groupDir||this.groupDir;if(groupField){sorters.push({field:groupField,direction:groupDir});}
if(sortInfo){sorters.push(sortInfo);}
Ext.data.GroupingStore.superclass.constructor.call(this,config);this.addEvents('groupchange');this.applyGroupField();},remoteGroup:false,groupOnSort:false,groupDir:'ASC',clearGrouping:function(){this.groupField=false;if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;delete this.baseParams.groupDir;}
var lo=this.lastOptions;if(lo&&lo.params){delete lo.params.groupBy;delete lo.params.groupDir;}
this.reload();}else{this.sort();this.fireEvent('datachanged',this);}},groupBy:function(field,forceRegroup,direction){direction=direction?(String(direction).toUpperCase()=='DESC'?'DESC':'ASC'):this.groupDir;if(this.groupField==field&&this.groupDir==direction&&!forceRegroup){return;}
sorters=this.multiSortInfo.sorters;if(sorters.length>0&&sorters[0].field==this.groupField){sorters.shift();}
this.groupField=field;this.groupDir=direction;this.applyGroupField();var fireGroupEvent=function(){this.fireEvent('groupchange',this,this.getGroupState());};if(this.groupOnSort){this.sort(field,direction);fireGroupEvent.call(this);return;}
if(this.remoteGroup){this.on('load',fireGroupEvent,this,{single:true});this.reload();}else{this.sort(sorters);fireGroupEvent.call(this);}},sort:function(fieldName,dir){if(this.remoteSort){return Ext.data.GroupingStore.superclass.sort.call(this,fieldName,dir);}
var sorters=[];if(Ext.isArray(arguments[0])){sorters=arguments[0];}else if(fieldName==undefined){sorters=this.sortInfo?[this.sortInfo]:[];}else{var field=this.fields.get(fieldName);if(!field)return false;var name=field.name,sortInfo=this.sortInfo||null,sortToggle=this.sortToggle?this.sortToggle[name]:null;if(!dir){if(sortInfo&&sortInfo.field==name){dir=(this.sortToggle[name]||'ASC').toggle('ASC','DESC');}else{dir=field.sortDir;}}
this.sortToggle[name]=dir;this.sortInfo={field:name,direction:dir};sorters=[this.sortInfo];}
if(this.groupField){sorters.unshift({direction:this.groupDir,field:this.groupField});}
return this.multiSort.call(this,sorters,dir);},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={};}
Ext.apply(this.baseParams,{groupBy:this.groupField,groupDir:this.groupDir});var lo=this.lastOptions;if(lo&&lo.params){lo.params.groupDir=this.groupDir;delete lo.params.groupBy;}}},applyGrouping:function(alwaysFireChange){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);return true;}else{if(alwaysFireChange===true){this.fireEvent('datachanged',this);}
return false;}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField;}});Ext.reg('groupingstore',Ext.data.GroupingStore);Ext.data.DirectProxy=function(config){Ext.apply(this,config);if(typeof this.paramOrder=='string'){this.paramOrder=this.paramOrder.split(/[\s,|]/);}
Ext.data.DirectProxy.superclass.constructor.call(this,config);};Ext.extend(Ext.data.DirectProxy,Ext.data.DataProxy,{paramOrder:undefined,paramsAsHash:true,directFn:undefined,doRequest:function(action,rs,params,reader,callback,scope,options){var args=[],directFn=this.api[action]||this.directFn;switch(action){case Ext.data.Api.actions.create:args.push(params.jsonData);break;case Ext.data.Api.actions.read:if(directFn.directCfg.method.len>0){if(this.paramOrder){for(var i=0,len=this.paramOrder.length;i<len;i++){args.push(params[this.paramOrder[i]]);}}else if(this.paramsAsHash){args.push(params);}}
break;case Ext.data.Api.actions.update:args.push(params.jsonData);break;case Ext.data.Api.actions.destroy:args.push(params.jsonData);break;}
var trans={params:params||{},request:{callback:callback,scope:scope,arg:options},reader:reader};args.push(this.createCallback(action,rs,trans),this);directFn.apply(window,args);},createCallback:function(action,rs,trans){var me=this;return function(result,res){if(!res.status){if(action===Ext.data.Api.actions.read){me.fireEvent("loadexception",me,trans,res,null);}
me.fireEvent('exception',me,'remote',action,trans,res,null);trans.request.callback.call(trans.request.scope,null,trans.request.arg,false);return;}
if(action===Ext.data.Api.actions.read){me.onRead(action,trans,result,res);}else{me.onWrite(action,trans,result,res,rs);}};},onRead:function(action,trans,result,res){var records;try{records=trans.reader.readRecords(result);}
catch(ex){this.fireEvent("loadexception",this,trans,res,ex);this.fireEvent('exception',this,'response',action,trans,res,ex);trans.request.callback.call(trans.request.scope,null,trans.request.arg,false);return;}
this.fireEvent("load",this,res,trans.request.arg);trans.request.callback.call(trans.request.scope,records,trans.request.arg,true);},onWrite:function(action,trans,result,res,rs){var data=trans.reader.extractData(trans.reader.getRoot(result),false);var success=trans.reader.getSuccess(result);success=(success!==false);if(success){this.fireEvent("write",this,action,data,res,rs,trans.request.arg);}else{this.fireEvent('exception',this,'remote',action,trans,result,rs);}
trans.request.callback.call(trans.request.scope,data,res,success);}});Ext.data.DirectStore=Ext.extend(Ext.data.Store,{constructor:function(config){var c=Ext.apply({},{batchTransactions:false},config);Ext.data.DirectStore.superclass.constructor.call(this,Ext.apply(c,{proxy:Ext.isDefined(c.proxy)?c.proxy:new Ext.data.DirectProxy(Ext.copyTo({},c,'paramOrder,paramsAsHash,directFn,api')),reader:(!Ext.isDefined(c.reader)&&c.fields)?new Ext.data.JsonReader(Ext.copyTo({},c,'totalProperty,root,idProperty'),c.fields):c.reader}));}});Ext.reg('directstore',Ext.data.DirectStore);Ext.Direct=Ext.extend(Ext.util.Observable,{exceptions:{TRANSPORT:'xhr',PARSE:'parse',LOGIN:'login',SERVER:'exception'},constructor:function(){this.addEvents('event','exception');this.transactions={};this.providers={};},addProvider:function(provider){var a=arguments;if(a.length>1){for(var i=0,len=a.length;i<len;i++){this.addProvider(a[i]);}
return;}
if(!provider.events){provider=new Ext.Direct.PROVIDERS[provider.type](provider);}
provider.id=provider.id||Ext.id();this.providers[provider.id]=provider;provider.on('data',this.onProviderData,this);provider.on('exception',this.onProviderException,this);if(!provider.isConnected()){provider.connect();}
return provider;},getProvider:function(id){return this.providers[id];},removeProvider:function(id){var provider=id.id?id:this.providers[id];provider.un('data',this.onProviderData,this);provider.un('exception',this.onProviderException,this);delete this.providers[provider.id];return provider;},addTransaction:function(t){this.transactions[t.tid]=t;return t;},removeTransaction:function(t){delete this.transactions[t.tid||t];return t;},getTransaction:function(tid){return this.transactions[tid.tid||tid];},onProviderData:function(provider,e){if(Ext.isArray(e)){for(var i=0,len=e.length;i<len;i++){this.onProviderData(provider,e[i]);}
return;}
if(e.name&&e.name!='event'&&e.name!='exception'){this.fireEvent(e.name,e);}else if(e.type=='exception'){this.fireEvent('exception',e);}
this.fireEvent('event',e,provider);},createEvent:function(response,extraProps){return new Ext.Direct.eventTypes[response.type](Ext.apply(response,extraProps));}});Ext.Direct=new Ext.Direct();Ext.Direct.TID=1;Ext.Direct.PROVIDERS={};Ext.Direct.Transaction=function(config){Ext.apply(this,config);this.tid=++Ext.Direct.TID;this.retryCount=0;};Ext.Direct.Transaction.prototype={send:function(){this.provider.queueTransaction(this);},retry:function(){this.retryCount++;this.send();},getProvider:function(){return this.provider;}};Ext.Direct.Event=function(config){Ext.apply(this,config);};Ext.Direct.Event.prototype={status:true,getData:function(){return this.data;}};Ext.Direct.RemotingEvent=Ext.extend(Ext.Direct.Event,{type:'rpc',getTransaction:function(){return this.transaction||Ext.Direct.getTransaction(this.tid);}});Ext.Direct.ExceptionEvent=Ext.extend(Ext.Direct.RemotingEvent,{status:false,type:'exception'});Ext.Direct.eventTypes={'rpc':Ext.Direct.RemotingEvent,'event':Ext.Direct.Event,'exception':Ext.Direct.ExceptionEvent};Ext.direct.Provider=Ext.extend(Ext.util.Observable,{priority:1,constructor:function(config){Ext.apply(this,config);this.addEvents('connect','disconnect','data','exception');Ext.direct.Provider.superclass.constructor.call(this,config);},isConnected:function(){return false;},connect:Ext.emptyFn,disconnect:Ext.emptyFn});Ext.direct.JsonProvider=Ext.extend(Ext.direct.Provider,{parseResponse:function(xhr){if(!Ext.isEmpty(xhr.responseText)){if(typeof xhr.responseText=='object'){return xhr.responseText;}
return Ext.decode(xhr.responseText);}
return null;},getEvents:function(xhr){var data=null;try{data=this.parseResponse(xhr);}catch(e){var event=new Ext.Direct.ExceptionEvent({data:e,xhr:xhr,code:Ext.Direct.exceptions.PARSE,message:'Error parsing json response: \n\n '+data});return[event];}
var events=[];if(Ext.isArray(data)){for(var i=0,len=data.length;i<len;i++){events.push(Ext.Direct.createEvent(data[i]));}}else{events.push(Ext.Direct.createEvent(data));}
return events;}});Ext.direct.PollingProvider=Ext.extend(Ext.direct.JsonProvider,{priority:3,interval:3000,constructor:function(config){Ext.direct.PollingProvider.superclass.constructor.call(this,config);this.addEvents('beforepoll','poll');},isConnected:function(){return!!this.pollTask;},connect:function(){if(this.url&&!this.pollTask){this.pollTask=Ext.TaskMgr.start({run:function(){if(this.fireEvent('beforepoll',this)!==false){if(typeof this.url=='function'){this.url(this.baseParams);}else{Ext.Ajax.request({url:this.url,callback:this.onData,scope:this,params:this.baseParams});}}},interval:this.interval,scope:this});this.fireEvent('connect',this);}else if(!this.url){throw'Error initializing PollingProvider, no url configured.';}},disconnect:function(){if(this.pollTask){Ext.TaskMgr.stop(this.pollTask);delete this.pollTask;this.fireEvent('disconnect',this);}},onData:function(opt,success,xhr){if(success){var events=this.getEvents(xhr);for(var i=0,len=events.length;i<len;i++){var e=events[i];this.fireEvent('data',this,e);}}else{var e=new Ext.Direct.ExceptionEvent({data:e,code:Ext.Direct.exceptions.TRANSPORT,message:'Unable to connect to the server.',xhr:xhr});this.fireEvent('data',this,e);}}});Ext.Direct.PROVIDERS['polling']=Ext.direct.PollingProvider;Ext.direct.RemotingProvider=Ext.extend(Ext.direct.JsonProvider,{enableBuffer:10,maxRetries:1,timeout:undefined,constructor:function(config){Ext.direct.RemotingProvider.superclass.constructor.call(this,config);this.addEvents('beforecall','call');this.namespace=(Ext.isString(this.namespace))?Ext.ns(this.namespace):this.namespace||window;this.transactions={};this.callBuffer=[];},initAPI:function(){var o=this.actions;for(var c in o){var cls=this.namespace[c]||(this.namespace[c]={}),ms=o[c];for(var i=0,len=ms.length;i<len;i++){var m=ms[i];cls[m.name]=this.createMethod(c,m);}}},isConnected:function(){return!!this.connected;},connect:function(){if(this.url){this.initAPI();this.connected=true;this.fireEvent('connect',this);}else if(!this.url){throw'Error initializing RemotingProvider, no url configured.';}},disconnect:function(){if(this.connected){this.connected=false;this.fireEvent('disconnect',this);}},onData:function(opt,success,xhr){if(success){var events=this.getEvents(xhr);for(var i=0,len=events.length;i<len;i++){var e=events[i],t=this.getTransaction(e);this.fireEvent('data',this,e);if(t){this.doCallback(t,e,true);Ext.Direct.removeTransaction(t);}}}else{var ts=[].concat(opt.ts);for(var i=0,len=ts.length;i<len;i++){var t=this.getTransaction(ts[i]);if(t&&t.retryCount<this.maxRetries){t.retry();}else{var e=new Ext.Direct.ExceptionEvent({data:e,transaction:t,code:Ext.Direct.exceptions.TRANSPORT,message:'Unable to connect to the server.',xhr:xhr});this.fireEvent('data',this,e);if(t){this.doCallback(t,e,false);Ext.Direct.removeTransaction(t);}}}}},getCallData:function(t){return{action:t.action,method:t.method,data:t.data,type:'rpc',tid:t.tid};},doSend:function(data){var o={url:this.url,callback:this.onData,scope:this,ts:data,timeout:this.timeout},callData;if(Ext.isArray(data)){callData=[];for(var i=0,len=data.length;i<len;i++){callData.push(this.getCallData(data[i]));}}else{callData=this.getCallData(data);}
if(this.enableUrlEncode){var params={};params[Ext.isString(this.enableUrlEncode)?this.enableUrlEncode:'data']=Ext.encode(callData);o.params=params;}else{o.jsonData=callData;}
Ext.Ajax.request(o);},combineAndSend:function(){var len=this.callBuffer.length;if(len>0){this.doSend(len==1?this.callBuffer[0]:this.callBuffer);this.callBuffer=[];}},queueTransaction:function(t){if(t.form){this.processForm(t);return;}
this.callBuffer.push(t);if(this.enableBuffer){if(!this.callTask){this.callTask=new Ext.util.DelayedTask(this.combineAndSend,this);}
this.callTask.delay(Ext.isNumber(this.enableBuffer)?this.enableBuffer:10);}else{this.combineAndSend();}},doCall:function(c,m,args){var data=null,hs=args[m.len],scope=args[m.len+1];if(m.len!==0){data=args.slice(0,m.len);}
var t=new Ext.Direct.Transaction({provider:this,args:args,action:c,method:m.name,data:data,cb:scope&&Ext.isFunction(hs)?hs.createDelegate(scope):hs});if(this.fireEvent('beforecall',this,t)!==false){Ext.Direct.addTransaction(t);this.queueTransaction(t);this.fireEvent('call',this,t);}},doForm:function(c,m,form,callback,scope){var t=new Ext.Direct.Transaction({provider:this,action:c,method:m.name,args:[form,callback,scope],cb:scope&&Ext.isFunction(callback)?callback.createDelegate(scope):callback,isForm:true});if(this.fireEvent('beforecall',this,t)!==false){Ext.Direct.addTransaction(t);var isUpload=String(form.getAttribute("enctype")).toLowerCase()=='multipart/form-data',params={extTID:t.tid,extAction:c,extMethod:m.name,extType:'rpc',extUpload:String(isUpload)};Ext.apply(t,{form:Ext.getDom(form),isUpload:isUpload,params:callback&&Ext.isObject(callback.params)?Ext.apply(params,callback.params):params});this.fireEvent('call',this,t);this.processForm(t);}},processForm:function(t){Ext.Ajax.request({url:this.url,params:t.params,callback:this.onData,scope:this,form:t.form,isUpload:t.isUpload,ts:t});},createMethod:function(c,m){var f;if(!m.formHandler){f=function(){this.doCall(c,m,Array.prototype.slice.call(arguments,0));}.createDelegate(this);}else{f=function(form,callback,scope){this.doForm(c,m,form,callback,scope);}.createDelegate(this);}
f.directCfg={action:c,method:m};return f;},getTransaction:function(opt){return opt&&opt.tid?Ext.Direct.getTransaction(opt.tid):null;},doCallback:function(t,e){var fn=e.status?'success':'failure';if(t&&t.cb){var hs=t.cb,result=Ext.isDefined(e.result)?e.result:e.data;if(Ext.isFunction(hs)){hs(result,e);}else{Ext.callback(hs[fn],hs.scope,[result,e]);Ext.callback(hs.callback,hs.scope,[result,e]);}}}});Ext.Direct.PROVIDERS['remoting']=Ext.direct.RemotingProvider;Ext.Resizable=Ext.extend(Ext.util.Observable,{constructor:function(el,config){this.el=Ext.get(el);if(config&&config.wrap){config.resizeChild=this.el;this.el=this.el.wrap(typeof config.wrap=='object'?config.wrap:{cls:'xresizable-wrap'});this.el.id=this.el.dom.id=config.resizeChild.id+'-rzwrap';this.el.setStyle('overflow','hidden');this.el.setPositioning(config.resizeChild.getPositioning());config.resizeChild.clearPositioning();if(!config.width||!config.height){var csize=config.resizeChild.getSize();this.el.setSize(csize.width,csize.height);}
if(config.pinned&&!config.adjustments){config.adjustments='auto';}}
this.proxy=this.el.createProxy({tag:'div',cls:'x-resizable-proxy',id:this.el.id+'-rzproxy'},Ext.getBody());this.proxy.unselectable();this.proxy.enableDisplayMode('block');Ext.apply(this,config);if(this.pinned){this.disableTrackOver=true;this.el.addClass('x-resizable-pinned');}
var position=this.el.getStyle('position');if(position!='absolute'&&position!='fixed'){this.el.setStyle('position','relative');}
if(!this.handles){this.handles='s,e,se';if(this.multiDirectional){this.handles+=',n,w';}}
if(this.handles=='all'){this.handles='n s e w ne nw se sw';}
var hs=this.handles.split(/\s*?[,;]\s*?| /);var ps=Ext.Resizable.positions;for(var i=0,len=hs.length;i<len;i++){if(hs[i]&&ps[hs[i]]){var pos=ps[hs[i]];this[pos]=new Ext.Resizable.Handle(this,pos,this.disableTrackOver,this.transparent,this.handleCls);}}
this.corner=this.southeast;if(this.handles.indexOf('n')!=-1||this.handles.indexOf('w')!=-1){this.updateBox=true;}
this.activeHandle=null;if(this.resizeChild){if(typeof this.resizeChild=='boolean'){this.resizeChild=Ext.get(this.el.dom.firstChild,true);}else{this.resizeChild=Ext.get(this.resizeChild,true);}}
if(this.adjustments=='auto'){var rc=this.resizeChild;var hw=this.west,he=this.east,hn=this.north,hs=this.south;if(rc&&(hw||hn)){rc.position('relative');rc.setLeft(hw?hw.el.getWidth():0);rc.setTop(hn?hn.el.getHeight():0);}
this.adjustments=[(he?-he.el.getWidth():0)+(hw?-hw.el.getWidth():0),(hn?-hn.el.getHeight():0)+(hs?-hs.el.getHeight():0)-1];}
if(this.draggable){this.dd=this.dynamic?this.el.initDD(null):this.el.initDDProxy(null,{dragElId:this.proxy.id});this.dd.setHandleElId(this.resizeChild?this.resizeChild.id:this.el.id);if(this.constrainTo){this.dd.constrainTo(this.constrainTo);}}
this.addEvents('beforeresize','resize');if(this.width!==null&&this.height!==null){this.resizeTo(this.width,this.height);}else{this.updateChildSize();}
if(Ext.isIE){this.el.dom.style.zoom=1;}
Ext.Resizable.superclass.constructor.call(this);},adjustments:[0,0],animate:false,disableTrackOver:false,draggable:false,duration:0.35,dynamic:false,easing:'easeOutStrong',enabled:true,handles:false,multiDirectional:false,height:null,width:null,heightIncrement:0,widthIncrement:0,minHeight:5,minWidth:5,maxHeight:10000,maxWidth:10000,minX:0,minY:0,pinned:false,preserveRatio:false,resizeChild:false,transparent:false,resizeTo:function(width,height){this.el.setSize(width,height);this.updateChildSize();this.fireEvent('resize',this,width,height,null);},startSizing:function(e,handle){this.fireEvent('beforeresize',this,e);if(this.enabled){if(!this.overlay){this.overlay=this.el.createProxy({tag:'div',cls:'x-resizable-overlay',html:'&#160;'},Ext.getBody());this.overlay.unselectable();this.overlay.enableDisplayMode('block');this.overlay.on({scope:this,mousemove:this.onMouseMove,mouseup:this.onMouseUp});}
this.overlay.setStyle('cursor',handle.el.getStyle('cursor'));this.resizing=true;this.startBox=this.el.getBox();this.startPoint=e.getXY();this.offsets=[(this.startBox.x+this.startBox.width)-this.startPoint[0],(this.startBox.y+this.startBox.height)-this.startPoint[1]];this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.overlay.show();if(this.constrainTo){var ct=Ext.get(this.constrainTo);this.resizeRegion=ct.getRegion().adjust(ct.getFrameWidth('t'),ct.getFrameWidth('l'),-ct.getFrameWidth('b'),-ct.getFrameWidth('r'));}
this.proxy.setStyle('visibility','hidden');this.proxy.show();this.proxy.setBox(this.startBox);if(!this.dynamic){this.proxy.setStyle('visibility','visible');}}},onMouseDown:function(handle,e){if(this.enabled){e.stopEvent();this.activeHandle=handle;this.startSizing(e,handle);}},onMouseUp:function(e){this.activeHandle=null;var size=this.resizeElement();this.resizing=false;this.handleOut();this.overlay.hide();this.proxy.hide();this.fireEvent('resize',this,size.width,size.height,e);},updateChildSize:function(){if(this.resizeChild){var el=this.el;var child=this.resizeChild;var adj=this.adjustments;if(el.dom.offsetWidth){var b=el.getSize(true);child.setSize(b.width+adj[0],b.height+adj[1]);}
if(Ext.isIE){setTimeout(function(){if(el.dom.offsetWidth){var b=el.getSize(true);child.setSize(b.width+adj[0],b.height+adj[1]);}},10);}}},snap:function(value,inc,min){if(!inc||!value){return value;}
var newValue=value;var m=value%inc;if(m>0){if(m>(inc/2)){newValue=value+(inc-m);}else{newValue=value-m;}}
return Math.max(min,newValue);},resizeElement:function(){var box=this.proxy.getBox();if(this.updateBox){this.el.setBox(box,false,this.animate,this.duration,null,this.easing);}else{this.el.setSize(box.width,box.height,this.animate,this.duration,null,this.easing);}
this.updateChildSize();if(!this.dynamic){this.proxy.hide();}
if(this.draggable&&this.constrainTo){this.dd.resetConstraints();this.dd.constrainTo(this.constrainTo);}
return box;},constrain:function(v,diff,m,mx){if(v-diff<m){diff=v-m;}else if(v-diff>mx){diff=v-mx;}
return diff;},onMouseMove:function(e){if(this.enabled&&this.activeHandle){try{if(this.resizeRegion&&!this.resizeRegion.contains(e.getPoint())){return;}
var curSize=this.curSize||this.startBox,x=this.startBox.x,y=this.startBox.y,ox=x,oy=y,w=curSize.width,h=curSize.height,ow=w,oh=h,mw=this.minWidth,mh=this.minHeight,mxw=this.maxWidth,mxh=this.maxHeight,wi=this.widthIncrement,hi=this.heightIncrement,eventXY=e.getXY(),diffX=-(this.startPoint[0]-Math.max(this.minX,eventXY[0])),diffY=-(this.startPoint[1]-Math.max(this.minY,eventXY[1])),pos=this.activeHandle.position,tw,th;switch(pos){case'east':w+=diffX;w=Math.min(Math.max(mw,w),mxw);break;case'south':h+=diffY;h=Math.min(Math.max(mh,h),mxh);break;case'southeast':w+=diffX;h+=diffY;w=Math.min(Math.max(mw,w),mxw);h=Math.min(Math.max(mh,h),mxh);break;case'north':diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;break;case'west':diffX=this.constrain(w,diffX,mw,mxw);x+=diffX;w-=diffX;break;case'northeast':w+=diffX;w=Math.min(Math.max(mw,w),mxw);diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;break;case'northwest':diffX=this.constrain(w,diffX,mw,mxw);diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;x+=diffX;w-=diffX;break;case'southwest':diffX=this.constrain(w,diffX,mw,mxw);h+=diffY;h=Math.min(Math.max(mh,h),mxh);x+=diffX;w-=diffX;break;}
var sw=this.snap(w,wi,mw);var sh=this.snap(h,hi,mh);if(sw!=w||sh!=h){switch(pos){case'northeast':y-=sh-h;break;case'north':y-=sh-h;break;case'southwest':x-=sw-w;break;case'west':x-=sw-w;break;case'northwest':x-=sw-w;y-=sh-h;break;}
w=sw;h=sh;}
if(this.preserveRatio){switch(pos){case'southeast':case'east':h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);w=ow*(h/oh);break;case'south':w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);break;case'northeast':w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);break;case'north':tw=w;w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);x+=(tw-w)/2;break;case'southwest':h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);tw=w;w=ow*(h/oh);x+=tw-w;break;case'west':th=h;h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);y+=(th-h)/2;tw=w;w=ow*(h/oh);x+=tw-w;break;case'northwest':tw=w;th=h;h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);w=ow*(h/oh);y+=th-h;x+=tw-w;break;}}
this.proxy.setBounds(x,y,w,h);if(this.dynamic){this.resizeElement();}}catch(ex){}}},handleOver:function(){if(this.enabled){this.el.addClass('x-resizable-over');}},handleOut:function(){if(!this.resizing){this.el.removeClass('x-resizable-over');}},getEl:function(){return this.el;},getResizeChild:function(){return this.resizeChild;},destroy:function(removeEl){Ext.destroy(this.dd,this.overlay,this.proxy);this.overlay=null;this.proxy=null;var ps=Ext.Resizable.positions;for(var k in ps){if(typeof ps[k]!='function'&&this[ps[k]]){this[ps[k]].destroy();}}
if(removeEl){this.el.update('');Ext.destroy(this.el);this.el=null;}
this.purgeListeners();},syncHandleHeight:function(){var h=this.el.getHeight(true);if(this.west){this.west.el.setHeight(h);}
if(this.east){this.east.el.setHeight(h);}}});Ext.Resizable.positions={n:'north',s:'south',e:'east',w:'west',se:'southeast',sw:'southwest',nw:'northwest',ne:'northeast'};Ext.Resizable.Handle=Ext.extend(Object,{constructor:function(rz,pos,disableTrackOver,transparent,cls){if(!this.tpl){var tpl=Ext.DomHelper.createTemplate({tag:'div',cls:'x-resizable-handle x-resizable-handle-{0}'});tpl.compile();Ext.Resizable.Handle.prototype.tpl=tpl;}
this.position=pos;this.rz=rz;this.el=this.tpl.append(rz.el.dom,[this.position],true);this.el.unselectable();if(transparent){this.el.setOpacity(0);}
if(!Ext.isEmpty(cls)){this.el.addClass(cls);}
this.el.on('mousedown',this.onMouseDown,this);if(!disableTrackOver){this.el.on({scope:this,mouseover:this.onMouseOver,mouseout:this.onMouseOut});}},afterResize:function(rz){},onMouseDown:function(e){this.rz.onMouseDown(this,e);},onMouseOver:function(e){this.rz.handleOver(this,e);},onMouseOut:function(e){this.rz.handleOut(this,e);},destroy:function(){Ext.destroy(this.el);this.el=null;}});Ext.Window=Ext.extend(Ext.Panel,{baseCls:'x-window',resizable:true,draggable:true,closable:true,closeAction:'close',constrain:false,constrainHeader:false,plain:false,minimizable:false,maximizable:false,minHeight:100,minWidth:200,expandOnShow:true,collapsible:false,initHidden:undefined,hidden:true,elements:'header,body',frame:true,floating:true,initComponent:function(){this.initTools();Ext.Window.superclass.initComponent.call(this);this.addEvents('resize','maximize','minimize','restore');if(Ext.isDefined(this.initHidden)){this.hidden=this.initHidden;}
if(this.hidden===false){this.hidden=true;this.show();}},getState:function(){return Ext.apply(Ext.Window.superclass.getState.call(this)||{},this.getBox(true));},onRender:function(ct,position){Ext.Window.superclass.onRender.call(this,ct,position);if(this.plain){this.el.addClass('x-window-plain');}
this.focusEl=this.el.createChild({tag:'a',href:'#',cls:'x-dlg-focus',tabIndex:'-1',html:'&#160;'});this.focusEl.swallowEvent('click',true);this.proxy=this.el.createProxy('x-window-proxy');this.proxy.enableDisplayMode('block');if(this.modal){this.mask=this.container.createChild({cls:'ext-el-mask'},this.el.dom);this.mask.enableDisplayMode('block');this.mask.hide();this.mon(this.mask,'click',this.focus,this);}
if(this.maximizable){this.mon(this.header,'dblclick',this.toggleMaximize,this);}},initEvents:function(){Ext.Window.superclass.initEvents.call(this);if(this.animateTarget){this.setAnimateTarget(this.animateTarget);}
if(this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||'all',pinned:true,resizeElement:this.resizerAction,handleCls:'x-window-handle'});this.resizer.window=this;this.mon(this.resizer,'beforeresize',this.beforeResize,this);}
if(this.draggable){this.header.addClass('x-window-draggable');}
this.mon(this.el,'mousedown',this.toFront,this);this.manager=this.manager||Ext.WindowMgr;this.manager.register(this);if(this.maximized){this.maximized=false;this.maximize();}
if(this.closable){var km=this.getKeyMap();km.on(27,this.onEsc,this);km.disable();}},initDraggable:function(){this.dd=new Ext.Window.DD(this);},onEsc:function(k,e){e.stopEvent();this[this.closeAction]();},beforeDestroy:function(){if(this.rendered){this.hide();this.clearAnchor();Ext.destroy(this.focusEl,this.resizer,this.dd,this.proxy,this.mask);}
Ext.Window.superclass.beforeDestroy.call(this);},onDestroy:function(){if(this.manager){this.manager.unregister(this);}
Ext.Window.superclass.onDestroy.call(this);},initTools:function(){if(this.minimizable){this.addTool({id:'minimize',handler:this.minimize.createDelegate(this,[])});}
if(this.maximizable){this.addTool({id:'maximize',handler:this.maximize.createDelegate(this,[])});this.addTool({id:'restore',handler:this.restore.createDelegate(this,[]),hidden:true});}
if(this.closable){this.addTool({id:'close',handler:this[this.closeAction].createDelegate(this,[])});}},resizerAction:function(){var box=this.proxy.getBox();this.proxy.hide();this.window.handleResize(box);return box;},beforeResize:function(){this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);this.resizeBox=this.el.getBox();},updateHandles:function(){if(Ext.isIE&&this.resizer){this.resizer.syncHandleHeight();this.el.repaint();}},handleResize:function(box){var rz=this.resizeBox;if(rz.x!=box.x||rz.y!=box.y){this.updateBox(box);}else{this.setSize(box);if(Ext.isIE6&&Ext.isStrict){this.doLayout();}}
this.focus();this.updateHandles();this.saveState();},focus:function(){var f=this.focusEl,db=this.defaultButton,t=typeof db,el,ct;if(Ext.isDefined(db)){if(Ext.isNumber(db)&&this.fbar){f=this.fbar.items.get(db);}else if(Ext.isString(db)){f=Ext.getCmp(db);}else{f=db;}
el=f.getEl();ct=Ext.getDom(this.container);if(el&&ct){if(!Ext.lib.Region.getRegion(ct).contains(Ext.lib.Region.getRegion(el.dom))){return;}}}
f=f||this.focusEl;f.focus.defer(10,f);},setAnimateTarget:function(el){el=Ext.get(el);this.animateTarget=el;},beforeShow:function(){delete this.el.lastXY;delete this.el.lastLT;if(this.x===undefined||this.y===undefined){var xy=this.el.getAlignToXY(this.container,'c-c');var pos=this.el.translatePoints(xy[0],xy[1]);this.x=this.x===undefined?pos.left:this.x;this.y=this.y===undefined?pos.top:this.y;}
this.el.setLeftTop(this.x,this.y);if(this.expandOnShow){this.expand(false);}
if(this.modal){Ext.getBody().addClass('x-body-masked');this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.mask.show();}},show:function(animateTarget,cb,scope){if(!this.rendered){this.render(Ext.getBody());}
if(this.hidden===false){this.toFront();return this;}
if(this.fireEvent('beforeshow',this)===false){return this;}
if(cb){this.on('show',cb,scope,{single:true});}
this.hidden=false;if(Ext.isDefined(animateTarget)){this.setAnimateTarget(animateTarget);}
this.beforeShow();if(this.animateTarget){this.animShow();}else{this.afterShow();}
return this;},afterShow:function(isAnim){if(this.isDestroyed){return false;}
this.proxy.hide();this.el.setStyle('display','block');this.el.show();if(this.maximized){this.fitContainer();}
if(Ext.isMac&&Ext.isGecko2){this.cascade(this.setAutoScroll);}
if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){Ext.EventManager.onWindowResize(this.onWindowResize,this);}
this.doConstrain();this.doLayout();if(this.keyMap){this.keyMap.enable();}
this.toFront();this.updateHandles();if(isAnim&&(Ext.isIE||Ext.isWebKit)){var sz=this.getSize();this.onResize(sz.width,sz.height);}
this.onShow();this.fireEvent('show',this);},animShow:function(){this.proxy.show();this.proxy.setBox(this.animateTarget.getBox());this.proxy.setOpacity(0);var b=this.getBox();this.el.setStyle('display','none');this.proxy.shift(Ext.apply(b,{callback:this.afterShow.createDelegate(this,[true],false),scope:this,easing:'easeNone',duration:0.25,opacity:0.5}));},hide:function(animateTarget,cb,scope){if(this.hidden||this.fireEvent('beforehide',this)===false){return this;}
if(cb){this.on('hide',cb,scope,{single:true});}
this.hidden=true;if(animateTarget!==undefined){this.setAnimateTarget(animateTarget);}
if(this.modal){this.mask.hide();Ext.getBody().removeClass('x-body-masked');}
if(this.animateTarget){this.animHide();}else{this.el.hide();this.afterHide();}
return this;},afterHide:function(){this.proxy.hide();if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){Ext.EventManager.removeResizeListener(this.onWindowResize,this);}
if(this.keyMap){this.keyMap.disable();}
this.onHide();this.fireEvent('hide',this);},animHide:function(){this.proxy.setOpacity(0.5);this.proxy.show();var tb=this.getBox(false);this.proxy.setBox(tb);this.el.hide();this.proxy.shift(Ext.apply(this.animateTarget.getBox(),{callback:this.afterHide,scope:this,duration:0.25,easing:'easeNone',opacity:0}));},onShow:Ext.emptyFn,onHide:Ext.emptyFn,onWindowResize:function(){if(this.maximized){this.fitContainer();}
if(this.modal){this.mask.setSize('100%','100%');var force=this.mask.dom.offsetHeight;this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));}
this.doConstrain();},doConstrain:function(){if(this.constrain||this.constrainHeader){var offsets;if(this.constrain){offsets={right:this.el.shadowOffset,left:this.el.shadowOffset,bottom:this.el.shadowOffset};}else{var s=this.getSize();offsets={right:-(s.width-100),bottom:-(s.height-25)};}
var xy=this.el.getConstrainToXY(this.container,true,offsets);if(xy){this.setPosition(xy[0],xy[1]);}}},ghost:function(cls){var ghost=this.createGhost(cls);var box=this.getBox(true);ghost.setLeftTop(box.x,box.y);ghost.setWidth(box.width);this.el.hide();this.activeGhost=ghost;return ghost;},unghost:function(show,matchPosition){if(!this.activeGhost){return;}
if(show!==false){this.el.show();this.focus.defer(10,this);if(Ext.isMac&&Ext.isGecko2){this.cascade(this.setAutoScroll);}}
if(matchPosition!==false){this.setPosition(this.activeGhost.getLeft(true),this.activeGhost.getTop(true));}
this.activeGhost.hide();this.activeGhost.remove();delete this.activeGhost;},minimize:function(){this.fireEvent('minimize',this);return this;},close:function(){if(this.fireEvent('beforeclose',this)!==false){if(this.hidden){this.doClose();}else{this.hide(null,this.doClose,this);}}},doClose:function(){this.fireEvent('close',this);this.destroy();},maximize:function(){if(!this.maximized){this.expand(false);this.restoreSize=this.getSize();this.restorePos=this.getPosition(true);if(this.maximizable){this.tools.maximize.hide();this.tools.restore.show();}
this.maximized=true;this.el.disableShadow();if(this.dd){this.dd.lock();}
if(this.collapsible){this.tools.toggle.hide();}
this.el.addClass('x-window-maximized');this.container.addClass('x-window-maximized-ct');this.setPosition(0,0);this.fitContainer();this.fireEvent('maximize',this);}
return this;},restore:function(){if(this.maximized){var t=this.tools;this.el.removeClass('x-window-maximized');if(t.restore){t.restore.hide();}
if(t.maximize){t.maximize.show();}
this.setPosition(this.restorePos[0],this.restorePos[1]);this.setSize(this.restoreSize.width,this.restoreSize.height);delete this.restorePos;delete this.restoreSize;this.maximized=false;this.el.enableShadow(true);if(this.dd){this.dd.unlock();}
if(this.collapsible&&t.toggle){t.toggle.show();}
this.container.removeClass('x-window-maximized-ct');this.doConstrain();this.fireEvent('restore',this);}
return this;},toggleMaximize:function(){return this[this.maximized?'restore':'maximize']();},fitContainer:function(){var vs=this.container.getViewSize(false);this.setSize(vs.width,vs.height);},setZIndex:function(index){if(this.modal){this.mask.setStyle('z-index',index);}
this.el.setZIndex(++index);index+=5;if(this.resizer){this.resizer.proxy.setStyle('z-index',++index);}
this.lastZIndex=index;},alignTo:function(element,position,offsets){var xy=this.el.getAlignToXY(element,position,offsets);this.setPagePosition(xy[0],xy[1]);return this;},anchorTo:function(el,alignment,offsets,monitorScroll){this.clearAnchor();this.anchorTarget={el:el,alignment:alignment,offsets:offsets};Ext.EventManager.onWindowResize(this.doAnchor,this);var tm=typeof monitorScroll;if(tm!='undefined'){Ext.EventManager.on(window,'scroll',this.doAnchor,this,{buffer:tm=='number'?monitorScroll:50});}
return this.doAnchor();},doAnchor:function(){var o=this.anchorTarget;this.alignTo(o.el,o.alignment,o.offsets);return this;},clearAnchor:function(){if(this.anchorTarget){Ext.EventManager.removeResizeListener(this.doAnchor,this);Ext.EventManager.un(window,'scroll',this.doAnchor,this);delete this.anchorTarget;}
return this;},toFront:function(e){if(this.manager.bringToFront(this)){if(!e||!e.getTarget().focus){this.focus();}}
return this;},setActive:function(active){if(active){if(!this.maximized){this.el.enableShadow(true);}
this.fireEvent('activate',this);}else{this.el.disableShadow();this.fireEvent('deactivate',this);}},toBack:function(){this.manager.sendToBack(this);return this;},center:function(){var xy=this.el.getAlignToXY(this.container,'c-c');this.setPagePosition(xy[0],xy[1]);return this;}});Ext.reg('window',Ext.Window);Ext.Window.DD=function(win){this.win=win;Ext.Window.DD.superclass.constructor.call(this,win.el.id,'WindowDD-'+win.id);this.setHandleElId(win.header.id);this.scroll=false;};Ext.extend(Ext.Window.DD,Ext.dd.DD,{moveOnly:true,headerOffsets:[100,25],startDrag:function(){var w=this.win;this.proxy=w.ghost();if(w.constrain!==false){var so=w.el.shadowOffset;this.constrainTo(w.container,{right:so,left:so,bottom:so});}else if(w.constrainHeader!==false){var s=this.proxy.getSize();this.constrainTo(w.container,{right:-(s.width-this.headerOffsets[0]),bottom:-(s.height-this.headerOffsets[1])});}},b4Drag:Ext.emptyFn,onDrag:function(e){this.alignElWithMouse(this.proxy,e.getPageX(),e.getPageY());},endDrag:function(e){this.win.unghost();this.win.saveState();}});Ext.WindowGroup=function(){var list={};var accessList=[];var front=null;var sortWindows=function(d1,d2){return(!d1._lastAccess||d1._lastAccess<d2._lastAccess)?-1:1;};var orderWindows=function(){var a=accessList,len=a.length;if(len>0){a.sort(sortWindows);var seed=a[0].manager.zseed;for(var i=0;i<len;i++){var win=a[i];if(win&&!win.hidden){win.setZIndex(seed+(i*10));}}}
activateLast();};var setActiveWin=function(win){if(win!=front){if(front){front.setActive(false);}
front=win;if(win){win.setActive(true);}}};var activateLast=function(){for(var i=accessList.length-1;i>=0;--i){if(!accessList[i].hidden){setActiveWin(accessList[i]);return;}}
setActiveWin(null);};return{zseed:9000,register:function(win){if(win.manager){win.manager.unregister(win);}
win.manager=this;list[win.id]=win;accessList.push(win);win.on('hide',activateLast);},unregister:function(win){delete win.manager;delete list[win.id];win.un('hide',activateLast);accessList.remove(win);},get:function(id){return typeof id=="object"?id:list[id];},bringToFront:function(win){win=this.get(win);if(win!=front){win._lastAccess=new Date().getTime();orderWindows();return true;}
return false;},sendToBack:function(win){win=this.get(win);win._lastAccess=-(new Date().getTime());orderWindows();return win;},hideAll:function(){for(var id in list){if(list[id]&&typeof list[id]!="function"&&list[id].isVisible()){list[id].hide();}}},getActive:function(){return front;},getBy:function(fn,scope){var r=[];for(var i=accessList.length-1;i>=0;--i){var win=accessList[i];if(fn.call(scope||win,win)!==false){r.push(win);}}
return r;},each:function(fn,scope){for(var id in list){if(list[id]&&typeof list[id]!="function"){if(fn.call(scope||list[id],list[id])===false){return;}}}}};};Ext.WindowMgr=new Ext.WindowGroup();Ext.MessageBox=function(){var dlg,opt,mask,waitTimer,bodyEl,msgEl,textboxEl,textareaEl,progressBar,pp,iconEl,spacerEl,buttons,activeTextEl,bwidth,bufferIcon='',iconCls='',buttonNames=['ok','yes','no','cancel'];var handleButton=function(button){buttons[button].blur();if(dlg.isVisible()){dlg.hide();handleHide();Ext.callback(opt.fn,opt.scope||window,[button,activeTextEl.dom.value,opt],1);}};var handleHide=function(){if(opt&&opt.cls){dlg.el.removeClass(opt.cls);}
progressBar.reset();};var handleEsc=function(d,k,e){if(opt&&opt.closable!==false){dlg.hide();handleHide();}
if(e){e.stopEvent();}};var updateButtons=function(b){var width=0,cfg;if(!b){Ext.each(buttonNames,function(name){buttons[name].hide();});return width;}
dlg.footer.dom.style.display='';Ext.iterate(buttons,function(name,btn){cfg=b[name];if(cfg){btn.show();btn.setText(Ext.isString(cfg)?cfg:Ext.MessageBox.buttonText[name]);width+=btn.getEl().getWidth()+15;}else{btn.hide();}});return width;};return{getDialog:function(titleText){if(!dlg){var btns=[];buttons={};Ext.each(buttonNames,function(name){btns.push(buttons[name]=new Ext.Button({text:this.buttonText[name],handler:handleButton.createCallback(name),hideMode:'offsets'}));},this);dlg=new Ext.Window({autoCreate:true,title:titleText,resizable:false,constrain:true,constrainHeader:true,minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:400,height:100,minHeight:80,plain:true,footer:true,closable:true,close:function(){if(opt&&opt.buttons&&opt.buttons.no&&!opt.buttons.cancel){handleButton("no");}else{handleButton("cancel");}},fbar:new Ext.Toolbar({items:btns,enableOverflow:false})});dlg.render(document.body);dlg.getEl().addClass('x-window-dlg');mask=dlg.mask;bodyEl=dlg.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});iconEl=Ext.get(bodyEl.dom.firstChild);var contentEl=bodyEl.dom.childNodes[1];msgEl=Ext.get(contentEl.firstChild);textboxEl=Ext.get(contentEl.childNodes[2].firstChild);textboxEl.enableDisplayMode();textboxEl.addKeyListener([10,13],function(){if(dlg.isVisible()&&opt&&opt.buttons){if(opt.buttons.ok){handleButton("ok");}else if(opt.buttons.yes){handleButton("yes");}}});textareaEl=Ext.get(contentEl.childNodes[2].childNodes[1]);textareaEl.enableDisplayMode();progressBar=new Ext.ProgressBar({renderTo:bodyEl});bodyEl.createChild({cls:'x-clear'});}
return dlg;},updateText:function(text){if(!dlg.isVisible()&&!opt.width){dlg.setSize(this.maxWidth,100);}
msgEl.update(text||'&#160;');var iw=iconCls!=''?(iconEl.getWidth()+iconEl.getMargins('lr')):0,mw=msgEl.getWidth()+msgEl.getMargins('lr'),fw=dlg.getFrameWidth('lr'),bw=dlg.body.getFrameWidth('lr'),w;if(Ext.isIE&&iw>0){iw+=3;}
w=Math.max(Math.min(opt.width||iw+mw+fw+bw,opt.maxWidth||this.maxWidth),Math.max(opt.minWidth||this.minWidth,bwidth||0));if(opt.prompt===true){activeTextEl.setWidth(w-iw-fw-bw);}
if(opt.progress===true||opt.wait===true){progressBar.setSize(w-iw-fw-bw);}
if(Ext.isIE&&w==bwidth){w+=4;}
dlg.setSize(w,'auto').center();return this;},updateProgress:function(value,progressText,msg){progressBar.updateProgress(value,progressText);if(msg){this.updateText(msg);}
return this;},isVisible:function(){return dlg&&dlg.isVisible();},hide:function(){var proxy=dlg?dlg.activeGhost:null;if(this.isVisible()||proxy){dlg.hide();handleHide();if(proxy){dlg.unghost(false,false);}}
return this;},show:function(options){if(this.isVisible()){this.hide();}
opt=options;var d=this.getDialog(opt.title||"&#160;");d.setTitle(opt.title||"&#160;");var allowClose=(opt.closable!==false&&opt.progress!==true&&opt.wait!==true);d.tools.close.setDisplayed(allowClose);activeTextEl=textboxEl;opt.prompt=opt.prompt||(opt.multiline?true:false);if(opt.prompt){if(opt.multiline){textboxEl.hide();textareaEl.show();textareaEl.setHeight(Ext.isNumber(opt.multiline)?opt.multiline:this.defaultTextHeight);activeTextEl=textareaEl;}else{textboxEl.show();textareaEl.hide();}}else{textboxEl.hide();textareaEl.hide();}
activeTextEl.dom.value=opt.value||"";if(opt.prompt){d.focusEl=activeTextEl;}else{var bs=opt.buttons;var db=null;if(bs&&bs.ok){db=buttons["ok"];}else if(bs&&bs.yes){db=buttons["yes"];}
if(db){d.focusEl=db;}}
if(opt.iconCls){d.setIconClass(opt.iconCls);}
this.setIcon(Ext.isDefined(opt.icon)?opt.icon:bufferIcon);bwidth=updateButtons(opt.buttons);progressBar.setVisible(opt.progress===true||opt.wait===true);this.updateProgress(0,opt.progressText);this.updateText(opt.msg);if(opt.cls){d.el.addClass(opt.cls);}
d.proxyDrag=opt.proxyDrag===true;d.modal=opt.modal!==false;d.mask=opt.modal!==false?mask:false;if(!d.isVisible()){document.body.appendChild(dlg.el.dom);d.setAnimateTarget(opt.animEl);d.on('show',function(){if(allowClose===true){d.keyMap.enable();}else{d.keyMap.disable();}},this,{single:true});d.show(opt.animEl);}
if(opt.wait===true){progressBar.wait(opt.waitConfig);}
return this;},setIcon:function(icon){if(!dlg){bufferIcon=icon;return;}
bufferIcon=undefined;if(icon&&icon!=''){iconEl.removeClass('x-hidden');iconEl.replaceClass(iconCls,icon);bodyEl.addClass('x-dlg-icon');iconCls=icon;}else{iconEl.replaceClass(iconCls,'x-hidden');bodyEl.removeClass('x-dlg-icon');iconCls='';}
return this;},progress:function(title,msg,progressText){this.show({title:title,msg:msg,buttons:false,progress:true,closable:false,minWidth:this.minProgressWidth,progressText:progressText});return this;},wait:function(msg,title,config){this.show({title:title,msg:msg,buttons:false,closable:false,wait:true,modal:true,minWidth:this.minProgressWidth,waitConfig:config});return this;},alert:function(title,msg,fn,scope){this.show({title:title,msg:msg,buttons:this.OK,fn:fn,scope:scope,minWidth:this.minWidth});return this;},confirm:function(title,msg,fn,scope){this.show({title:title,msg:msg,buttons:this.YESNO,fn:fn,scope:scope,icon:this.QUESTION,minWidth:this.minWidth});return this;},prompt:function(title,msg,fn,scope,multiline,value){this.show({title:title,msg:msg,buttons:this.OKCANCEL,fn:fn,minWidth:this.minPromptWidth,scope:scope,prompt:true,multiline:multiline,value:value});return this;},OK:{ok:true},CANCEL:{cancel:true},OKCANCEL:{ok:true,cancel:true},YESNO:{yes:true,no:true},YESNOCANCEL:{yes:true,no:true,cancel:true},INFO:'ext-mb-info',WARNING:'ext-mb-warning',QUESTION:'ext-mb-question',ERROR:'ext-mb-error',defaultTextHeight:75,maxWidth:600,minWidth:100,minProgressWidth:250,minPromptWidth:250,buttonText:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}};}();Ext.Msg=Ext.MessageBox;Ext.dd.PanelProxy=function(panel,config){this.panel=panel;this.id=this.panel.id+'-ddproxy';Ext.apply(this,config);};Ext.dd.PanelProxy.prototype={insertProxy:true,setStatus:Ext.emptyFn,reset:Ext.emptyFn,update:Ext.emptyFn,stop:Ext.emptyFn,sync:Ext.emptyFn,getEl:function(){return this.ghost;},getGhost:function(){return this.ghost;},getProxy:function(){return this.proxy;},hide:function(){if(this.ghost){if(this.proxy){this.proxy.remove();delete this.proxy;}
this.panel.el.dom.style.display='';this.ghost.remove();delete this.ghost;}},show:function(){if(!this.ghost){this.ghost=this.panel.createGhost(undefined,undefined,Ext.getBody());this.ghost.setXY(this.panel.el.getXY());if(this.insertProxy){this.proxy=this.panel.el.insertSibling({cls:'x-panel-dd-spacer'});this.proxy.setSize(this.panel.getSize());}
this.panel.el.dom.style.display='none';}},repair:function(xy,callback,scope){this.hide();if(typeof callback=="function"){callback.call(scope||this);}},moveProxy:function(parentNode,before){if(this.proxy){parentNode.insertBefore(this.proxy.dom,before);}}};Ext.Panel.DD=function(panel,cfg){this.panel=panel;this.dragData={panel:panel};this.proxy=new Ext.dd.PanelProxy(panel,cfg);Ext.Panel.DD.superclass.constructor.call(this,panel.el,cfg);var h=panel.header;if(h){this.setHandleElId(h.id);}
(h?h:this.panel.body).setStyle('cursor','move');this.scroll=false;};Ext.extend(Ext.Panel.DD,Ext.dd.DragSource,{showFrame:Ext.emptyFn,startDrag:Ext.emptyFn,b4StartDrag:function(x,y){this.proxy.show();},b4MouseDown:function(e){var x=e.getPageX();var y=e.getPageY();this.autoOffset(x,y);},onInitDrag:function(x,y){this.onStartDrag(x,y);return true;},createFrame:Ext.emptyFn,getDragEl:function(e){return this.proxy.ghost.dom;},endDrag:function(e){this.proxy.hide();this.panel.saveState();},autoOffset:function(x,y){x-=this.startPageX;y-=this.startPageY;this.setDelta(x,y);}});Ext.state.Provider=function(){this.addEvents("statechange");this.state={};Ext.state.Provider.superclass.constructor.call(this);};Ext.extend(Ext.state.Provider,Ext.util.Observable,{get:function(name,defaultValue){return typeof this.state[name]=="undefined"?defaultValue:this.state[name];},clear:function(name){delete this.state[name];this.fireEvent("statechange",this,name,null);},set:function(name,value){this.state[name]=value;this.fireEvent("statechange",this,name,value);},decodeValue:function(cookie){var re=/^(a|n|d|b|s|o)\:(.*)$/;var matches=re.exec(unescape(cookie));if(!matches||!matches[1])return;var type=matches[1];var v=matches[2];switch(type){case"n":return parseFloat(v);case"d":return new Date(Date.parse(v));case"b":return(v=="1");case"a":var all=[];if(v!=''){Ext.each(v.split('^'),function(val){all.push(this.decodeValue(val));},this);}
return all;case"o":var all={};if(v!=''){Ext.each(v.split('^'),function(val){var kv=val.split('=');all[kv[0]]=this.decodeValue(kv[1]);},this);}
return all;default:return v;}},encodeValue:function(v){var enc;if(typeof v=="number"){enc="n:"+v;}else if(typeof v=="boolean"){enc="b:"+(v?"1":"0");}else if(Ext.isDate(v)){enc="d:"+v.toGMTString();}else if(Ext.isArray(v)){var flat="";for(var i=0,len=v.length;i<len;i++){flat+=this.encodeValue(v[i]);if(i!=len-1)flat+="^";}
enc="a:"+flat;}else if(typeof v=="object"){var flat="";for(var key in v){if(typeof v[key]!="function"&&v[key]!==undefined){flat+=key+"="+this.encodeValue(v[key])+"^";}}
enc="o:"+flat.substring(0,flat.length-1);}else{enc="s:"+v;}
return escape(enc);}});Ext.state.Manager=function(){var provider=new Ext.state.Provider();return{setProvider:function(stateProvider){provider=stateProvider;},get:function(key,defaultValue){return provider.get(key,defaultValue);},set:function(key,value){provider.set(key,value);},clear:function(key){provider.clear(key);},getProvider:function(){return provider;}};}();Ext.state.CookieProvider=function(config){Ext.state.CookieProvider.superclass.constructor.call(this);this.path="/";this.expires=new Date(new Date().getTime()+(1000*60*60*24*7));this.domain=null;this.secure=false;Ext.apply(this,config);this.state=this.readCookies();};Ext.extend(Ext.state.CookieProvider,Ext.state.Provider,{set:function(name,value){if(typeof value=="undefined"||value===null){this.clear(name);return;}
this.setCookie(name,value);Ext.state.CookieProvider.superclass.set.call(this,name,value);},clear:function(name){this.clearCookie(name);Ext.state.CookieProvider.superclass.clear.call(this,name);},readCookies:function(){var cookies={};var c=document.cookie+";";var re=/\s?(.*?)=(.*?);/g;var matches;while((matches=re.exec(c))!=null){var name=matches[1];var value=matches[2];if(name&&name.substring(0,3)=="ys-"){cookies[name.substr(3)]=this.decodeValue(value);}}
return cookies;},setCookie:function(name,value){document.cookie="ys-"+name+"="+this.encodeValue(value)+
((this.expires==null)?"":("; expires="+this.expires.toGMTString()))+
((this.path==null)?"":("; path="+this.path))+
((this.domain==null)?"":("; domain="+this.domain))+
((this.secure==true)?"; secure":"");},clearCookie:function(name){document.cookie="ys-"+name+"=null; expires=Thu, 01-Jan-70 00:00:01 GMT"+
((this.path==null)?"":("; path="+this.path))+
((this.domain==null)?"":("; domain="+this.domain))+
((this.secure==true)?"; secure":"");}});Ext.DataView=Ext.extend(Ext.BoxComponent,{selectedClass:"x-view-selected",emptyText:"",deferEmptyText:true,trackOver:false,blockRefresh:false,last:false,initComponent:function(){Ext.DataView.superclass.initComponent.call(this);if(Ext.isString(this.tpl)||Ext.isArray(this.tpl)){this.tpl=new Ext.XTemplate(this.tpl);}
this.addEvents("beforeclick","click","mouseenter","mouseleave","containerclick","dblclick","contextmenu","containercontextmenu","selectionchange","beforeselect");this.store=Ext.StoreMgr.lookup(this.store);this.all=new Ext.CompositeElementLite();this.selected=new Ext.CompositeElementLite();},afterRender:function(){Ext.DataView.superclass.afterRender.call(this);this.mon(this.getTemplateTarget(),{"click":this.onClick,"dblclick":this.onDblClick,"contextmenu":this.onContextMenu,scope:this});if(this.overClass||this.trackOver){this.mon(this.getTemplateTarget(),{"mouseover":this.onMouseOver,"mouseout":this.onMouseOut,scope:this});}
if(this.store){this.bindStore(this.store,true);}},refresh:function(){this.clearSelections(false,true);var el=this.getTemplateTarget();el.update("");var records=this.store.getRange();if(records.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){el.update(this.emptyText);}
this.all.clear();}else{this.tpl.overwrite(el,this.collectData(records,0));this.all.fill(Ext.query(this.itemSelector,el.dom));this.updateIndexes(0);}
this.hasSkippedEmptyText=true;},getTemplateTarget:function(){return this.el;},prepareData:function(data){return data;},collectData:function(records,startIndex){var r=[];for(var i=0,len=records.length;i<len;i++){r[r.length]=this.prepareData(records[i].data,startIndex+i,records[i]);}
return r;},bufferRender:function(records){var div=document.createElement('div');this.tpl.overwrite(div,this.collectData(records));return Ext.query(this.itemSelector,div);},onUpdate:function(ds,record){var index=this.store.indexOf(record);if(index>-1){var sel=this.isSelected(index);var original=this.all.elements[index];var node=this.bufferRender([record],index)[0];this.all.replaceElement(index,node,true);if(sel){this.selected.replaceElement(original,node);this.all.item(index).addClass(this.selectedClass);}
this.updateIndexes(index,index);}},onAdd:function(ds,records,index){if(this.all.getCount()===0){this.refresh();return;}
var nodes=this.bufferRender(records,index),n,a=this.all.elements;if(index<this.all.getCount()){n=this.all.item(index).insertSibling(nodes,'before',true);a.splice.apply(a,[index,0].concat(nodes));}else{n=this.all.last().insertSibling(nodes,'after',true);a.push.apply(a,nodes);}
this.updateIndexes(index);},onRemove:function(ds,record,index){this.deselect(index);this.all.removeElement(index,true);this.updateIndexes(index);if(this.store.getCount()===0){this.refresh();}},refreshNode:function(index){this.onUpdate(this.store,this.store.getAt(index));},updateIndexes:function(startIndex,endIndex){var ns=this.all.elements;startIndex=startIndex||0;endIndex=endIndex||((endIndex===0)?0:(ns.length-1));for(var i=startIndex;i<=endIndex;i++){ns[i].viewIndex=i;}},getStore:function(){return this.store;},bindStore:function(store,initial){if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy();}else{this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("datachanged",this.onDataChanged,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this);}
if(!store){this.store=null;}}
if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,beforeload:this.onBeforeLoad,datachanged:this.onDataChanged,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh});}
this.store=store;if(store){this.refresh();}},onDataChanged:function(){if(this.blockRefresh!==true){this.refresh.apply(this,arguments);}},findItemFromChild:function(node){return Ext.fly(node).findParent(this.itemSelector,this.getTemplateTarget());},onClick:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){var index=this.indexOf(item);if(this.onItemClick(item,index,e)!==false){this.fireEvent("click",this,index,item,e);}}else{if(this.fireEvent("containerclick",this,e)!==false){this.onContainerClick(e);}}},onContainerClick:function(e){this.clearSelections();},onContextMenu:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){this.fireEvent("contextmenu",this,this.indexOf(item),item,e);}else{this.fireEvent("containercontextmenu",this,e);}},onDblClick:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){this.fireEvent("dblclick",this,this.indexOf(item),item,e);}},onMouseOver:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item&&item!==this.lastItem){this.lastItem=item;Ext.fly(item).addClass(this.overClass);this.fireEvent("mouseenter",this,this.indexOf(item),item,e);}},onMouseOut:function(e){if(this.lastItem){if(!e.within(this.lastItem,true,true)){Ext.fly(this.lastItem).removeClass(this.overClass);this.fireEvent("mouseleave",this,this.indexOf(this.lastItem),this.lastItem,e);delete this.lastItem;}}},onItemClick:function(item,index,e){if(this.fireEvent("beforeclick",this,index,item,e)===false){return false;}
if(this.multiSelect){this.doMultiSelection(item,index,e);e.preventDefault();}else if(this.singleSelect){this.doSingleSelection(item,index,e);e.preventDefault();}
return true;},doSingleSelection:function(item,index,e){if(e.ctrlKey&&this.isSelected(index)){this.deselect(index);}else{this.select(index,false);}},doMultiSelection:function(item,index,e){if(e.shiftKey&&this.last!==false){var last=this.last;this.selectRange(last,index,e.ctrlKey);this.last=last;}else{if((e.ctrlKey||this.simpleSelect)&&this.isSelected(index)){this.deselect(index);}else{this.select(index,e.ctrlKey||e.shiftKey||this.simpleSelect);}}},getSelectionCount:function(){return this.selected.getCount();},getSelectedNodes:function(){return this.selected.elements;},getSelectedIndexes:function(){var indexes=[],s=this.selected.elements;for(var i=0,len=s.length;i<len;i++){indexes.push(s[i].viewIndex);}
return indexes;},getSelectedRecords:function(){var r=[],s=this.selected.elements;for(var i=0,len=s.length;i<len;i++){r[r.length]=this.store.getAt(s[i].viewIndex);}
return r;},getRecords:function(nodes){var r=[],s=nodes;for(var i=0,len=s.length;i<len;i++){r[r.length]=this.store.getAt(s[i].viewIndex);}
return r;},getRecord:function(node){return this.store.getAt(node.viewIndex);},clearSelections:function(suppressEvent,skipUpdate){if((this.multiSelect||this.singleSelect)&&this.selected.getCount()>0){if(!skipUpdate){this.selected.removeClass(this.selectedClass);}
this.selected.clear();this.last=false;if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements);}}},isSelected:function(node){return this.selected.contains(this.getNode(node));},deselect:function(node){if(this.isSelected(node)){node=this.getNode(node);this.selected.removeElement(node);if(this.last==node.viewIndex){this.last=false;}
Ext.fly(node).removeClass(this.selectedClass);this.fireEvent("selectionchange",this,this.selected.elements);}},select:function(nodeInfo,keepExisting,suppressEvent){if(Ext.isArray(nodeInfo)){if(!keepExisting){this.clearSelections(true);}
for(var i=0,len=nodeInfo.length;i<len;i++){this.select(nodeInfo[i],true,true);}
if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements);}}else{var node=this.getNode(nodeInfo);if(!keepExisting){this.clearSelections(true);}
if(node&&!this.isSelected(node)){if(this.fireEvent("beforeselect",this,node,this.selected.elements)!==false){Ext.fly(node).addClass(this.selectedClass);this.selected.add(node);this.last=node.viewIndex;if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements);}}}}},selectRange:function(start,end,keepExisting){if(!keepExisting){this.clearSelections(true);}
this.select(this.getNodes(start,end),true);},getNode:function(nodeInfo){if(Ext.isString(nodeInfo)){return document.getElementById(nodeInfo);}else if(Ext.isNumber(nodeInfo)){return this.all.elements[nodeInfo];}else if(nodeInfo instanceof Ext.data.Record){var idx=this.store.indexOf(nodeInfo);return this.all.elements[idx];}
return nodeInfo;},getNodes:function(start,end){var ns=this.all.elements;start=start||0;end=!Ext.isDefined(end)?Math.max(ns.length-1,0):end;var nodes=[],i;if(start<=end){for(i=start;i<=end&&ns[i];i++){nodes.push(ns[i]);}}else{for(i=start;i>=end&&ns[i];i--){nodes.push(ns[i]);}}
return nodes;},indexOf:function(node){node=this.getNode(node);if(Ext.isNumber(node.viewIndex)){return node.viewIndex;}
return this.all.indexOf(node);},onBeforeLoad:function(){if(this.loadingText){this.clearSelections(false,true);this.getTemplateTarget().update('<div class="loading-indicator">'+this.loadingText+'</div>');this.all.clear();}},onDestroy:function(){this.all.clear();this.selected.clear();Ext.DataView.superclass.onDestroy.call(this);this.bindStore(null);}});Ext.DataView.prototype.setStore=Ext.DataView.prototype.bindStore;Ext.reg('dataview',Ext.DataView);Ext.list.ListView=Ext.extend(Ext.DataView,{itemSelector:'dl',selectedClass:'x-list-selected',overClass:'x-list-over',scrollOffset:undefined,columnResize:true,columnSort:true,maxWidth:Ext.isIE?99:100,initComponent:function(){if(this.columnResize){this.colResizer=new Ext.list.ColumnResizer(this.colResizer);this.colResizer.init(this);}
if(this.columnSort){this.colSorter=new Ext.list.Sorter(this.columnSort);this.colSorter.init(this);}
if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{[values.width*100]}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">','{header}','</em></div>','</tpl>','<div class="x-clear"></div>','</div></div>','<div class="x-list-body"><div class="x-list-body-inner">','</div></div>');}
if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="rows">','<dl>','<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">','{[values.tpl.apply(parent)]}','</em></dt>','</tpl>','<div class="x-clear"></div>','</dl>','</tpl>');};var cs=this.columns,allocatedWidth=0,colsWithWidth=0,len=cs.length,columns=[];for(var i=0;i<len;i++){var c=cs[i];if(!c.isColumn){c.xtype=c.xtype?(/^lv/.test(c.xtype)?c.xtype:'lv'+c.xtype):'lvcolumn';c=Ext.create(c);}
if(c.width){allocatedWidth+=c.width*100;colsWithWidth++;}
columns.push(c);}
cs=this.columns=columns;if(colsWithWidth<len){var remaining=len-colsWithWidth;if(allocatedWidth<this.maxWidth){var perCol=((this.maxWidth-allocatedWidth)/remaining)/100;for(var j=0;j<len;j++){var c=cs[j];if(!c.width){c.width=perCol;}}}}
Ext.list.ListView.superclass.initComponent.call(this);},onRender:function(){this.autoEl={cls:'x-list-wrap'};Ext.list.ListView.superclass.onRender.apply(this,arguments);this.internalTpl.overwrite(this.el,{columns:this.columns});this.innerBody=Ext.get(this.el.dom.childNodes[1].firstChild);this.innerHd=Ext.get(this.el.dom.firstChild.firstChild);if(this.hideHeaders){this.el.dom.firstChild.style.display='none';}},getTemplateTarget:function(){return this.innerBody;},collectData:function(){var rs=Ext.list.ListView.superclass.collectData.apply(this,arguments);return{columns:this.columns,rows:rs}},verifyInternalSize:function(){if(this.lastSize){this.onResize(this.lastSize.width,this.lastSize.height);}},onResize:function(w,h){var bd=this.innerBody.dom;var hd=this.innerHd.dom;if(!bd){return;}
var bdp=bd.parentNode;if(Ext.isNumber(w)){var sw=w-Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((bdp.offsetWidth-bdp.clientWidth)>10)){bd.style.width=sw+'px';hd.style.width=sw+'px';}else{bd.style.width=w+'px';hd.style.width=w+'px';setTimeout(function(){if((bdp.offsetWidth-bdp.clientWidth)>10){bd.style.width=sw+'px';hd.style.width=sw+'px';}},10);}}
if(Ext.isNumber(h)){bdp.style.height=(h-hd.parentNode.offsetHeight)+'px';}},updateIndexes:function(){Ext.list.ListView.superclass.updateIndexes.apply(this,arguments);this.verifyInternalSize();},findHeaderIndex:function(hd){hd=hd.dom||hd;var pn=hd.parentNode,cs=pn.parentNode.childNodes;for(var i=0,c;c=cs[i];i++){if(c==pn){return i;}}
return-1;},setHdWidths:function(){var els=this.innerHd.dom.getElementsByTagName('div');for(var i=0,cs=this.columns,len=cs.length;i<len;i++){els[i].style.width=(cs[i].width*100)+'%';}}});Ext.reg('listview',Ext.list.ListView);Ext.ListView=Ext.list.ListView;Ext.list.Column=Ext.extend(Object,{isColumn:true,align:'left',header:'',width:null,cls:'',constructor:function(c){if(!c.tpl){c.tpl=new Ext.XTemplate('{'+c.dataIndex+'}');}
else if(Ext.isString(c.tpl)){c.tpl=new Ext.XTemplate(c.tpl);}
Ext.apply(this,c);}});Ext.reg('lvcolumn',Ext.list.Column);Ext.list.NumberColumn=Ext.extend(Ext.list.Column,{format:'0,000.00',constructor:function(c){c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':number("'+(c.format||this.format)+'")}');Ext.list.NumberColumn.superclass.constructor.call(this,c);}});Ext.reg('lvnumbercolumn',Ext.list.NumberColumn);Ext.list.DateColumn=Ext.extend(Ext.list.Column,{format:'m/d/Y',constructor:function(c){c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':date("'+(c.format||this.format)+'")}');Ext.list.DateColumn.superclass.constructor.call(this,c);}});Ext.reg('lvdatecolumn',Ext.list.DateColumn);Ext.list.BooleanColumn=Ext.extend(Ext.list.Column,{trueText:'true',falseText:'false',undefinedText:'&#160;',constructor:function(c){c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':this.format}');var t=this.trueText,f=this.falseText,u=this.undefinedText;c.tpl.format=function(v){if(v===undefined){return u;}
if(!v||v==='false'){return f;}
return t;};Ext.list.DateColumn.superclass.constructor.call(this,c);}});Ext.reg('lvbooleancolumn',Ext.list.BooleanColumn);Ext.list.ColumnResizer=Ext.extend(Ext.util.Observable,{minPct:.05,constructor:function(config){Ext.apply(this,config);Ext.list.ColumnResizer.superclass.constructor.call(this);},init:function(listView){this.view=listView;listView.on('render',this.initEvents,this);},initEvents:function(view){view.mon(view.innerHd,'mousemove',this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(view.innerHd);view.on('beforedestroy',this.tracker.destroy,this.tracker);},handleHdMove:function(e,t){var hw=5,x=e.getPageX(),hd=e.getTarget('em',3,true);if(hd){var r=hd.getRegion(),ss=hd.dom.style,pn=hd.dom.parentNode;if(x-r.left<=hw&&pn!=pn.parentNode.firstChild){this.activeHd=Ext.get(pn.previousSibling.firstChild);ss.cursor=Ext.isWebKit?'e-resize':'col-resize';}else if(r.right-x<=hw&&pn!=pn.parentNode.lastChild.previousSibling){this.activeHd=hd;ss.cursor=Ext.isWebKit?'w-resize':'col-resize';}else{delete this.activeHd;ss.cursor='';}}},onBeforeStart:function(e){this.dragHd=this.activeHd;return!!this.dragHd;},onStart:function(e){this.view.disableHeaders=true;this.proxy=this.view.el.createChild({cls:'x-list-resizer'});this.proxy.setHeight(this.view.el.getHeight());var x=this.tracker.getXY()[0],w=this.view.innerHd.getWidth();this.hdX=this.dragHd.getX();this.hdIndex=this.view.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(x-this.hdX);this.minWidth=w*this.minPct;this.maxWidth=w-(this.minWidth*(this.view.columns.length-1-this.hdIndex));},onDrag:function(e){var cursorX=this.tracker.getXY()[0];this.proxy.setWidth((cursorX-this.hdX).constrain(this.minWidth,this.maxWidth));},onEnd:function(e){var nw=this.proxy.getWidth();this.proxy.remove();var index=this.hdIndex,vw=this.view,cs=vw.columns,len=cs.length,w=this.view.innerHd.getWidth(),minPct=this.minPct*100,pct=Math.ceil((nw*vw.maxWidth)/w),diff=(cs[index].width*100)-pct,eachItem=Math.floor(diff/(len-1-index)),mod=diff-(eachItem*(len-1-index));for(var i=index+1;i<len;i++){var cw=(cs[i].width*100)+eachItem,ncw=Math.max(minPct,cw);if(cw!=ncw){mod+=cw-ncw;}
cs[i].width=ncw/100;}
cs[index].width=pct/100;cs[index+1].width+=(mod/100);delete this.dragHd;vw.setHdWidths();vw.refresh();setTimeout(function(){vw.disableHeaders=false;},100);}});Ext.ListView.ColumnResizer=Ext.list.ColumnResizer;Ext.list.Sorter=Ext.extend(Ext.util.Observable,{sortClasses:["sort-asc","sort-desc"],constructor:function(config){Ext.apply(this,config);Ext.list.Sorter.superclass.constructor.call(this);},init:function(listView){this.view=listView;listView.on('render',this.initEvents,this);},initEvents:function(view){view.mon(view.innerHd,'click',this.onHdClick,this);view.innerHd.setStyle('cursor','pointer');view.mon(view.store,'datachanged',this.updateSortState,this);this.updateSortState.defer(10,this,[view.store]);},updateSortState:function(store){var state=store.getSortState();if(!state){return;}
this.sortState=state;var cs=this.view.columns,sortColumn=-1;for(var i=0,len=cs.length;i<len;i++){if(cs[i].dataIndex==state.field){sortColumn=i;break;}}
if(sortColumn!=-1){var sortDir=state.direction;this.updateSortIcon(sortColumn,sortDir);}},updateSortIcon:function(col,dir){var sc=this.sortClasses;var hds=this.view.innerHd.select('em').removeClass(sc);hds.item(col).addClass(sc[dir=="DESC"?1:0]);},onHdClick:function(e){var hd=e.getTarget('em',3);if(hd&&!this.view.disableHeaders){var index=this.view.findHeaderIndex(hd);this.view.store.sort(this.view.columns[index].dataIndex);}}});Ext.ListView.Sorter=Ext.list.Sorter;Ext.TabPanel=Ext.extend(Ext.Panel,{deferredRender:true,tabWidth:120,minTabWidth:30,resizeTabs:false,enableTabScroll:false,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,tabPosition:'top',baseCls:'x-tab-panel',autoTabs:false,autoTabSelector:'div.x-tab',activeTab:undefined,tabMargin:2,plain:false,wheelIncrement:20,idDelimiter:'__',itemCls:'x-tab-item',elements:'body',headerAsText:false,frame:false,hideBorders:true,initComponent:function(){this.frame=false;Ext.TabPanel.superclass.initComponent.call(this);this.addEvents('beforetabchange','tabchange','contextmenu');this.setLayout(new Ext.layout.CardLayout(Ext.apply({layoutOnCardChange:this.layoutOnTabChange,deferredRender:this.deferredRender},this.layoutConfig)));if(this.tabPosition=='top'){this.elements+=',header';this.stripTarget='header';}else{this.elements+=',footer';this.stripTarget='footer';}
if(!this.stack){this.stack=Ext.TabPanel.AccessStack();}
this.initItems();},onRender:function(ct,position){Ext.TabPanel.superclass.onRender.call(this,ct,position);if(this.plain){var pos=this.tabPosition=='top'?'header':'footer';this[pos].addClass('x-tab-panel-'+pos+'-plain');}
var st=this[this.stripTarget];this.stripWrap=st.createChild({cls:'x-tab-strip-wrap',cn:{tag:'ul',cls:'x-tab-strip x-tab-strip-'+this.tabPosition}});var beforeEl=(this.tabPosition=='bottom'?this.stripWrap:null);st.createChild({cls:'x-tab-strip-spacer'},beforeEl);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'x-tab-edge',cn:[{tag:'span',cls:'x-tab-strip-text',cn:'&#160;'}]});this.strip.createChild({cls:'x-clear'});this.body.addClass('x-tab-panel-body-'+this.tabPosition);if(!this.itemTpl){var tt=new Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close"></a>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>','</em></a></li>');tt.disableFormats=true;tt.compile();Ext.TabPanel.prototype.itemTpl=tt;}
this.items.each(this.initTab,this);},afterRender:function(){Ext.TabPanel.superclass.afterRender.call(this);if(this.autoTabs){this.readTabs(false);}
if(this.activeTab!==undefined){var item=Ext.isObject(this.activeTab)?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(item);}},initEvents:function(){Ext.TabPanel.superclass.initEvents.call(this);this.mon(this.strip,{scope:this,mousedown:this.onStripMouseDown,contextmenu:this.onStripContextMenu});if(this.enableTabScroll){this.mon(this.strip,'mousewheel',this.onWheel,this);}},findTargets:function(e){var item=null,itemEl=e.getTarget('li:not(.x-tab-edge)',this.strip);if(itemEl){item=this.getComponent(itemEl.id.split(this.idDelimiter)[1]);if(item.disabled){return{close:null,item:null,el:null};}}
return{close:e.getTarget('.x-tab-strip-close',this.strip),item:item,el:itemEl};},onStripMouseDown:function(e){if(e.button!==0){return;}
e.preventDefault();var t=this.findTargets(e);if(t.close){if(t.item.fireEvent('beforeclose',t.item)!==false){t.item.fireEvent('close',t.item);this.remove(t.item);}
return;}
if(t.item&&t.item!=this.activeTab){this.setActiveTab(t.item);}},onStripContextMenu:function(e){e.preventDefault();var t=this.findTargets(e);if(t.item){this.fireEvent('contextmenu',this,t.item,e);}},readTabs:function(removeExisting){if(removeExisting===true){this.items.each(function(item){this.remove(item);},this);}
var tabs=this.el.query(this.autoTabSelector);for(var i=0,len=tabs.length;i<len;i++){var tab=tabs[i],title=tab.getAttribute('title');tab.removeAttribute('title');this.add({title:title,contentEl:tab});}},initTab:function(item,index){var before=this.strip.dom.childNodes[index],p=this.getTemplateArgs(item),el=before?this.itemTpl.insertBefore(before,p):this.itemTpl.append(this.strip,p),cls='x-tab-strip-over',tabEl=Ext.get(el);tabEl.hover(function(){if(!item.disabled){tabEl.addClass(cls);}},function(){tabEl.removeClass(cls);});if(item.tabTip){tabEl.child('span.x-tab-strip-text',true).qtip=item.tabTip;}
item.tabEl=el;tabEl.select('a').on('click',function(e){if(!e.getPageX()){this.onStripMouseDown(e);}},this,{preventDefault:true});item.on({scope:this,disable:this.onItemDisabled,enable:this.onItemEnabled,titlechange:this.onItemTitleChanged,iconchange:this.onItemIconChanged,beforeshow:this.onBeforeShowItem});},getTemplateArgs:function(item){var cls=item.closable?'x-tab-strip-closable':'';if(item.disabled){cls+=' x-item-disabled';}
if(item.iconCls){cls+=' x-tab-with-icon';}
if(item.tabCls){cls+=' '+item.tabCls;}
return{id:this.id+this.idDelimiter+item.getItemId(),text:item.title,cls:cls,iconCls:item.iconCls||''};},onAdd:function(c){Ext.TabPanel.superclass.onAdd.call(this,c);if(this.rendered){var items=this.items;this.initTab(c,items.indexOf(c));this.delegateUpdates();}},onBeforeAdd:function(item){var existing=item.events?(this.items.containsKey(item.getItemId())?item:null):this.items.get(item);if(existing){this.setActiveTab(item);return false;}
Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var es=item.elements;item.elements=es?es.replace(',header',''):es;item.border=(item.border===true);},onRemove:function(c){var te=Ext.get(c.tabEl);if(te){te.select('a').removeAllListeners();Ext.destroy(te);}
Ext.TabPanel.superclass.onRemove.call(this,c);this.stack.remove(c);delete c.tabEl;c.un('disable',this.onItemDisabled,this);c.un('enable',this.onItemEnabled,this);c.un('titlechange',this.onItemTitleChanged,this);c.un('iconchange',this.onItemIconChanged,this);c.un('beforeshow',this.onBeforeShowItem,this);if(c==this.activeTab){var next=this.stack.next();if(next){this.setActiveTab(next);}else if(this.items.getCount()>0){this.setActiveTab(0);}else{this.setActiveTab(null);}}
if(!this.destroying){this.delegateUpdates();}},onBeforeShowItem:function(item){if(item!=this.activeTab){this.setActiveTab(item);return false;}},onItemDisabled:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).addClass('x-item-disabled');}
this.stack.remove(item);},onItemEnabled:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).removeClass('x-item-disabled');}},onItemTitleChanged:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).child('span.x-tab-strip-text',true).innerHTML=item.title;}},onItemIconChanged:function(item,iconCls,oldCls){var el=this.getTabEl(item);if(el){el=Ext.get(el);el.child('span.x-tab-strip-text').replaceClass(oldCls,iconCls);el[Ext.isEmpty(iconCls)?'removeClass':'addClass']('x-tab-with-icon');}},getTabEl:function(item){var c=this.getComponent(item);return c?c.tabEl:null;},onResize:function(){Ext.TabPanel.superclass.onResize.apply(this,arguments);this.delegateUpdates();},beginUpdate:function(){this.suspendUpdates=true;},endUpdate:function(){this.suspendUpdates=false;this.delegateUpdates();},hideTabStripItem:function(item){item=this.getComponent(item);var el=this.getTabEl(item);if(el){el.style.display='none';this.delegateUpdates();}
this.stack.remove(item);},unhideTabStripItem:function(item){item=this.getComponent(item);var el=this.getTabEl(item);if(el){el.style.display='';this.delegateUpdates();}},delegateUpdates:function(){if(this.suspendUpdates){return;}
if(this.resizeTabs&&this.rendered){this.autoSizeTabs();}
if(this.enableTabScroll&&this.rendered){this.autoScrollTabs();}},autoSizeTabs:function(){var count=this.items.length,ce=this.tabPosition!='bottom'?'header':'footer',ow=this[ce].dom.offsetWidth,aw=this[ce].dom.clientWidth;if(!this.resizeTabs||count<1||!aw){return;}
var each=Math.max(Math.min(Math.floor((aw-4)/count)-this.tabMargin,this.tabWidth),this.minTabWidth);this.lastTabWidth=each;var lis=this.strip.query('li:not(.x-tab-edge)');for(var i=0,len=lis.length;i<len;i++){var li=lis[i],inner=Ext.fly(li).child('.x-tab-strip-inner',true),tw=li.offsetWidth,iw=inner.offsetWidth;inner.style.width=(each-(tw-iw))+'px';}},adjustBodyWidth:function(w){if(this.header){this.header.setWidth(w);}
if(this.footer){this.footer.setWidth(w);}
return w;},setActiveTab:function(item){item=this.getComponent(item);if(this.fireEvent('beforetabchange',this,item,this.activeTab)===false){return;}
if(!this.rendered){this.activeTab=item;return;}
if(this.activeTab!=item){if(this.activeTab){var oldEl=this.getTabEl(this.activeTab);if(oldEl){Ext.fly(oldEl).removeClass('x-tab-strip-active');}}
this.activeTab=item;if(item){var el=this.getTabEl(item);Ext.fly(el).addClass('x-tab-strip-active');this.stack.add(item);this.layout.setActiveItem(item);if(this.scrolling){this.scrollToTab(item,this.animScroll);}}
this.fireEvent('tabchange',this,item);}},getActiveTab:function(){return this.activeTab||null;},getItem:function(item){return this.getComponent(item);},autoScrollTabs:function(){this.pos=this.tabPosition=='bottom'?this.footer:this.header;var count=this.items.length,ow=this.pos.dom.offsetWidth,tw=this.pos.dom.clientWidth,wrap=this.stripWrap,wd=wrap.dom,cw=wd.offsetWidth,pos=this.getScrollPos(),l=this.edge.getOffsetsTo(this.stripWrap)[0]+pos;if(!this.enableTabScroll||count<1||cw<20){return;}
if(l<=tw){wd.scrollLeft=0;wrap.setWidth(tw);if(this.scrolling){this.scrolling=false;this.pos.removeClass('x-tab-scrolling');this.scrollLeft.hide();this.scrollRight.hide();if(Ext.isAir||Ext.isWebKit){wd.style.marginLeft='';wd.style.marginRight='';}}}else{if(!this.scrolling){this.pos.addClass('x-tab-scrolling');if(Ext.isAir||Ext.isWebKit){wd.style.marginLeft='18px';wd.style.marginRight='18px';}}
tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers();}else{this.scrollLeft.show();this.scrollRight.show();}}
this.scrolling=true;if(pos>(l-tw)){wd.scrollLeft=l-tw;}else{this.scrollToTab(this.activeTab,false);}
this.updateScrollButtons();}},createScrollers:function(){this.pos.addClass('x-tab-scrolling-'+this.tabPosition);var h=this.stripWrap.dom.offsetHeight;var sl=this.pos.insertFirst({cls:'x-tab-scroller-left'});sl.setHeight(h);sl.addClassOnOver('x-tab-scroller-left-over');this.leftRepeater=new Ext.util.ClickRepeater(sl,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=sl;var sr=this.pos.insertFirst({cls:'x-tab-scroller-right'});sr.setHeight(h);sr.addClassOnOver('x-tab-scroller-right-over');this.rightRepeater=new Ext.util.ClickRepeater(sr,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=sr;},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos();},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0;},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0;},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this};},getScrollIncrement:function(){return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100);},scrollToTab:function(item,animate){if(!item){return;}
var el=this.getTabEl(item),pos=this.getScrollPos(),area=this.getScrollArea(),left=Ext.fly(el).getOffsetsTo(this.stripWrap)[0]+pos,right=left+el.offsetWidth;if(left<pos){this.scrollTo(left,animate);}else if(right>(pos+area)){this.scrollTo(right-area,animate);}},scrollTo:function(pos,animate){this.stripWrap.scrollTo('left',pos,animate?this.getScrollAnim():false);if(!animate){this.updateScrollButtons();}},onWheel:function(e){var d=e.getWheelDelta()*this.wheelIncrement*-1;e.stopEvent();var pos=this.getScrollPos(),newpos=pos+d,sw=this.getScrollWidth()-this.getScrollArea();var s=Math.max(0,Math.min(sw,newpos));if(s!=pos){this.scrollTo(s,false);}},onScrollRight:function(){var sw=this.getScrollWidth()-this.getScrollArea(),pos=this.getScrollPos(),s=Math.min(sw,pos+this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll);}},onScrollLeft:function(){var pos=this.getScrollPos(),s=Math.max(0,pos-this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll);}},updateScrollButtons:function(){var pos=this.getScrollPos();this.scrollLeft[pos===0?'addClass':'removeClass']('x-tab-scroller-left-disabled');this.scrollRight[pos>=(this.getScrollWidth()-this.getScrollArea())?'addClass':'removeClass']('x-tab-scroller-right-disabled');},beforeDestroy:function(){Ext.destroy(this.leftRepeater,this.rightRepeater);this.deleteMembers('strip','edge','scrollLeft','scrollRight','stripWrap');this.activeTab=null;Ext.TabPanel.superclass.beforeDestroy.apply(this);}});Ext.reg('tabpanel',Ext.TabPanel);Ext.TabPanel.prototype.activate=Ext.TabPanel.prototype.setActiveTab;Ext.TabPanel.AccessStack=function(){var items=[];return{add:function(item){items.push(item);if(items.length>10){items.shift();}},remove:function(item){var s=[];for(var i=0,len=items.length;i<len;i++){if(items[i]!=item){s.push(items[i]);}}
items=s;},next:function(){return items.pop();}};};Ext.Button=Ext.extend(Ext.BoxComponent,{hidden:false,disabled:false,pressed:false,enableToggle:false,menuAlign:'tl-bl?',type:'button',menuClassTarget:'tr:nth(2)',clickEvent:'click',handleMouseEvents:true,tooltipType:'qtip',buttonSelector:'button:first-child',scale:'small',iconAlign:'left',arrowAlign:'right',initComponent:function(){Ext.Button.superclass.initComponent.call(this);this.addEvents('click','toggle','mouseover','mouseout','menushow','menuhide','menutriggerover','menutriggerout');if(this.menu){this.menu=Ext.menu.MenuMgr.get(this.menu);}
if(Ext.isString(this.toggleGroup)){this.enableToggle=true;}},getTemplateArgs:function(){return[this.type,'x-btn-'+this.scale+' x-btn-icon-'+this.scale+'-'+this.iconAlign,this.getMenuClass(),this.cls,this.id];},setButtonClass:function(){if(this.useSetClass){if(!Ext.isEmpty(this.oldCls)){this.el.removeClass([this.oldCls,'x-btn-pressed']);}
this.oldCls=(this.iconCls||this.icon)?(this.text?'x-btn-text-icon':'x-btn-icon'):'x-btn-noicon';this.el.addClass([this.oldCls,this.pressed?'x-btn-pressed':null]);}},getMenuClass:function(){return this.menu?(this.arrowAlign!='bottom'?'x-btn-arrow':'x-btn-arrow-bottom'):'';},onRender:function(ct,position){if(!this.template){if(!Ext.Button.buttonTemplate){Ext.Button.buttonTemplate=new Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em class="{2}" unselectable="on"><button type="{0}"></button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>','</tbody></table>');Ext.Button.buttonTemplate.compile();}
this.template=Ext.Button.buttonTemplate;}
var btn,targs=this.getTemplateArgs();if(position){btn=this.template.insertBefore(position,targs,true);}else{btn=this.template.append(ct,targs,true);}
this.btnEl=btn.child(this.buttonSelector);this.mon(this.btnEl,{scope:this,focus:this.onFocus,blur:this.onBlur});this.initButtonEl(btn,this.btnEl);Ext.ButtonToggleMgr.register(this);},initButtonEl:function(btn,btnEl){this.el=btn;this.setIcon(this.icon);this.setText(this.text);this.setIconClass(this.iconCls);if(Ext.isDefined(this.tabIndex)){btnEl.dom.tabIndex=this.tabIndex;}
if(this.tooltip){this.setTooltip(this.tooltip,true);}
if(this.handleMouseEvents){this.mon(btn,{scope:this,mouseover:this.onMouseOver,mousedown:this.onMouseDown});}
if(this.menu){this.mon(this.menu,{scope:this,show:this.onMenuShow,hide:this.onMenuHide});}
if(this.repeat){var repeater=new Ext.util.ClickRepeater(btn,Ext.isObject(this.repeat)?this.repeat:{});this.mon(repeater,'click',this.onClick,this);}
this.mon(btn,this.clickEvent,this.onClick,this);},afterRender:function(){Ext.Button.superclass.afterRender.call(this);this.useSetClass=true;this.setButtonClass();this.doc=Ext.getDoc();this.doAutoWidth();},setIconClass:function(cls){this.iconCls=cls;if(this.el){this.btnEl.dom.className='';this.btnEl.addClass(['x-btn-text',cls||'']);this.setButtonClass();}
return this;},setTooltip:function(tooltip,initial){if(this.rendered){if(!initial){this.clearTip();}
if(Ext.isObject(tooltip)){Ext.QuickTips.register(Ext.apply({target:this.btnEl.id},tooltip));this.tooltip=tooltip;}else{this.btnEl.dom[this.tooltipType]=tooltip;}}else{this.tooltip=tooltip;}
return this;},clearTip:function(){if(Ext.isObject(this.tooltip)){Ext.QuickTips.unregister(this.btnEl);}},beforeDestroy:function(){if(this.rendered){this.clearTip();}
if(this.menu&&this.destroyMenu!==false){Ext.destroy(this.menu);}
Ext.destroy(this.repeater);},onDestroy:function(){if(this.rendered){this.doc.un('mouseover',this.monitorMouseOver,this);this.doc.un('mouseup',this.onMouseUp,this);delete this.doc;delete this.btnEl;Ext.ButtonToggleMgr.unregister(this);}
Ext.Button.superclass.onDestroy.call(this);},doAutoWidth:function(){if(this.autoWidth!==false&&this.el&&this.text&&this.width===undefined){this.el.setWidth('auto');if(Ext.isIE7&&Ext.isStrict){var ib=this.btnEl;if(ib&&ib.getWidth()>20){ib.clip();ib.setWidth(Ext.util.TextMetrics.measure(ib,this.text).width+ib.getFrameWidth('lr'));}}
if(this.minWidth){if(this.el.getWidth()<this.minWidth){this.el.setWidth(this.minWidth);}}}},setHandler:function(handler,scope){this.handler=handler;this.scope=scope;return this;},setText:function(text){this.text=text;if(this.el){this.btnEl.update(text||'&#160;');this.setButtonClass();}
this.doAutoWidth();return this;},setIcon:function(icon){this.icon=icon;if(this.el){this.btnEl.setStyle('background-image',icon?'url('+icon+')':'');this.setButtonClass();}
return this;},getText:function(){return this.text;},toggle:function(state,suppressEvent){state=state===undefined?!this.pressed:!!state;if(state!=this.pressed){if(this.rendered){this.el[state?'addClass':'removeClass']('x-btn-pressed');}
this.pressed=state;if(!suppressEvent){this.fireEvent('toggle',this,state);if(this.toggleHandler){this.toggleHandler.call(this.scope||this,this,state);}}}
return this;},onDisable:function(){this.onDisableChange(true);},onEnable:function(){this.onDisableChange(false);},onDisableChange:function(disabled){if(this.el){if(!Ext.isIE6||!this.text){this.el[disabled?'addClass':'removeClass'](this.disabledClass);}
this.el.dom.disabled=disabled;}
this.disabled=disabled;},showMenu:function(){if(this.rendered&&this.menu){if(this.tooltip){Ext.QuickTips.getQuickTip().cancelShow(this.btnEl);}
if(this.menu.isVisible()){this.menu.hide();}
this.menu.ownerCt=this;this.menu.show(this.el,this.menuAlign);}
return this;},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide();}
return this;},hasVisibleMenu:function(){return this.menu&&this.menu.ownerCt==this&&this.menu.isVisible();},onClick:function(e){if(e){e.preventDefault();}
if(e.button!==0){return;}
if(!this.disabled){if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){this.toggle();}
if(this.menu&&!this.hasVisibleMenu()&&!this.ignoreNextClick){this.showMenu();}
this.fireEvent('click',this,e);if(this.handler){this.handler.call(this.scope||this,this,e);}}},isMenuTriggerOver:function(e,internal){return this.menu&&!internal;},isMenuTriggerOut:function(e,internal){return this.menu&&!internal;},onMouseOver:function(e){if(!this.disabled){var internal=e.within(this.el,true);if(!internal){this.el.addClass('x-btn-over');if(!this.monitoringMouseOver){this.doc.on('mouseover',this.monitorMouseOver,this);this.monitoringMouseOver=true;}
this.fireEvent('mouseover',this,e);}
if(this.isMenuTriggerOver(e,internal)){this.fireEvent('menutriggerover',this,this.menu,e);}}},monitorMouseOver:function(e){if(e.target!=this.el.dom&&!e.within(this.el)){if(this.monitoringMouseOver){this.doc.un('mouseover',this.monitorMouseOver,this);this.monitoringMouseOver=false;}
this.onMouseOut(e);}},onMouseOut:function(e){var internal=e.within(this.el)&&e.target!=this.el.dom;this.el.removeClass('x-btn-over');this.fireEvent('mouseout',this,e);if(this.isMenuTriggerOut(e,internal)){this.fireEvent('menutriggerout',this,this.menu,e);}},focus:function(){this.btnEl.focus();},blur:function(){this.btnEl.blur();},onFocus:function(e){if(!this.disabled){this.el.addClass('x-btn-focus');}},onBlur:function(e){this.el.removeClass('x-btn-focus');},getClickEl:function(e,isUp){return this.el;},onMouseDown:function(e){if(!this.disabled&&e.button===0){this.getClickEl(e).addClass('x-btn-click');this.doc.on('mouseup',this.onMouseUp,this);}},onMouseUp:function(e){if(e.button===0){this.getClickEl(e,true).removeClass('x-btn-click');this.doc.un('mouseup',this.onMouseUp,this);}},onMenuShow:function(e){if(this.menu.ownerCt==this){this.menu.ownerCt=this;this.ignoreNextClick=0;this.el.addClass('x-btn-menu-active');this.fireEvent('menushow',this,this.menu);}},onMenuHide:function(e){if(this.menu.ownerCt==this){this.el.removeClass('x-btn-menu-active');this.ignoreNextClick=this.restoreClick.defer(250,this);this.fireEvent('menuhide',this,this.menu);delete this.menu.ownerCt;}},restoreClick:function(){this.ignoreNextClick=0;}});Ext.reg('button',Ext.Button);Ext.ButtonToggleMgr=function(){var groups={};function toggleGroup(btn,state){if(state){var g=groups[btn.toggleGroup];for(var i=0,l=g.length;i<l;i++){if(g[i]!=btn){g[i].toggle(false);}}}}
return{register:function(btn){if(!btn.toggleGroup){return;}
var g=groups[btn.toggleGroup];if(!g){g=groups[btn.toggleGroup]=[];}
g.push(btn);btn.on('toggle',toggleGroup);},unregister:function(btn){if(!btn.toggleGroup){return;}
var g=groups[btn.toggleGroup];if(g){g.remove(btn);btn.un('toggle',toggleGroup);}},getPressed:function(group){var g=groups[group];if(g){for(var i=0,len=g.length;i<len;i++){if(g[i].pressed===true){return g[i];}}}
return null;}};}();Ext.SplitButton=Ext.extend(Ext.Button,{arrowSelector:'em',split:true,initComponent:function(){Ext.SplitButton.superclass.initComponent.call(this);this.addEvents("arrowclick");},onRender:function(){Ext.SplitButton.superclass.onRender.apply(this,arguments);if(this.arrowTooltip){this.el.child(this.arrowSelector).dom[this.tooltipType]=this.arrowTooltip;}},setArrowHandler:function(handler,scope){this.arrowHandler=handler;this.scope=scope;},getMenuClass:function(){return'x-btn-split'+(this.arrowAlign=='bottom'?'-bottom':'');},isClickOnArrow:function(e){if(this.arrowAlign!='bottom'){var visBtn=this.el.child('em.x-btn-split');var right=visBtn.getRegion().right-visBtn.getPadding('r');return e.getPageX()>right;}else{return e.getPageY()>this.btnEl.getRegion().bottom;}},onClick:function(e,t){e.preventDefault();if(!this.disabled){if(this.isClickOnArrow(e)){if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu();}
this.fireEvent("arrowclick",this,e);if(this.arrowHandler){this.arrowHandler.call(this.scope||this,this,e);}}else{if(this.enableToggle){this.toggle();}
this.fireEvent("click",this,e);if(this.handler){this.handler.call(this.scope||this,this,e);}}}},isMenuTriggerOver:function(e){return this.menu&&e.target.tagName==this.arrowSelector;},isMenuTriggerOut:function(e,internal){return this.menu&&e.target.tagName!=this.arrowSelector;}});Ext.reg('splitbutton',Ext.SplitButton);Ext.CycleButton=Ext.extend(Ext.SplitButton,{getItemText:function(item){if(item&&this.showText===true){var text='';if(this.prependText){text+=this.prependText;}
text+=item.text;return text;}
return undefined;},setActiveItem:function(item,suppressEvent){if(!Ext.isObject(item)){item=this.menu.getComponent(item);}
if(item){if(!this.rendered){this.text=this.getItemText(item);this.iconCls=item.iconCls;}else{var t=this.getItemText(item);if(t){this.setText(t);}
this.setIconClass(item.iconCls);}
this.activeItem=item;if(!item.checked){item.setChecked(true,false);}
if(this.forceIcon){this.setIconClass(this.forceIcon);}
if(!suppressEvent){this.fireEvent('change',this,item);}}},getActiveItem:function(){return this.activeItem;},initComponent:function(){this.addEvents("change");if(this.changeHandler){this.on('change',this.changeHandler,this.scope||this);delete this.changeHandler;}
this.itemCount=this.items.length;this.menu={cls:'x-cycle-menu',items:[]};var checked=0;Ext.each(this.items,function(item,i){Ext.apply(item,{group:item.group||this.id,itemIndex:i,checkHandler:this.checkHandler,scope:this,checked:item.checked||false});this.menu.items.push(item);if(item.checked){checked=i;}},this);Ext.CycleButton.superclass.initComponent.call(this);this.on('click',this.toggleSelected,this);this.setActiveItem(checked,true);},checkHandler:function(item,pressed){if(pressed){this.setActiveItem(item);}},toggleSelected:function(){var m=this.menu;m.render();if(!m.hasLayout){m.doLayout();}
var nextIdx,checkItem;for(var i=1;i<this.itemCount;i++){nextIdx=(this.activeItem.itemIndex+i)%this.itemCount;checkItem=m.items.itemAt(nextIdx);if(!checkItem.disabled){checkItem.setChecked(true);break;}}}});Ext.reg('cycle',Ext.CycleButton);Ext.Toolbar=function(config){if(Ext.isArray(config)){config={items:config,layout:'toolbar'};}else{config=Ext.apply({layout:'toolbar'},config);if(config.buttons){config.items=config.buttons;}}
Ext.Toolbar.superclass.constructor.call(this,config);};(function(){var T=Ext.Toolbar;Ext.extend(T,Ext.Container,{defaultType:'button',enableOverflow:false,trackMenus:true,internalDefaults:{removeMode:'container',hideParent:true},toolbarCls:'x-toolbar',initComponent:function(){T.superclass.initComponent.call(this);this.addEvents('overflowchange');},onRender:function(ct,position){if(!this.el){if(!this.autoCreate){this.autoCreate={cls:this.toolbarCls+' x-small-editor'};}
this.el=ct.createChild(Ext.apply({id:this.id},this.autoCreate),position);Ext.Toolbar.superclass.onRender.apply(this,arguments);}},lookupComponent:function(c){if(Ext.isString(c)){if(c=='-'){c=new T.Separator();}else if(c==' '){c=new T.Spacer();}else if(c=='->'){c=new T.Fill();}else{c=new T.TextItem(c);}
this.applyDefaults(c);}else{if(c.isFormField||c.render){c=this.createComponent(c);}else if(c.tag){c=new T.Item({autoEl:c});}else if(c.tagName){c=new T.Item({el:c});}else if(Ext.isObject(c)){c=c.xtype?this.createComponent(c):this.constructButton(c);}}
return c;},applyDefaults:function(c){if(!Ext.isString(c)){c=Ext.Toolbar.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d);}else{Ext.applyIf(c,d);}}
return c;},addSeparator:function(){return this.add(new T.Separator());},addSpacer:function(){return this.add(new T.Spacer());},addFill:function(){this.add(new T.Fill());},addElement:function(el){return this.addItem(new T.Item({el:el}));},addItem:function(item){return this.add.apply(this,arguments);},addButton:function(config){if(Ext.isArray(config)){var buttons=[];for(var i=0,len=config.length;i<len;i++){buttons.push(this.addButton(config[i]));}
return buttons;}
return this.add(this.constructButton(config));},addText:function(text){return this.addItem(new T.TextItem(text));},addDom:function(config){return this.add(new T.Item({autoEl:config}));},addField:function(field){return this.add(field);},insertButton:function(index,item){if(Ext.isArray(item)){var buttons=[];for(var i=0,len=item.length;i<len;i++){buttons.push(this.insertButton(index+i,item[i]));}
return buttons;}
return Ext.Toolbar.superclass.insert.call(this,index,item);},trackMenu:function(item,remove){if(this.trackMenus&&item.menu){var method=remove?'mun':'mon';this[method](item,'menutriggerover',this.onButtonTriggerOver,this);this[method](item,'menushow',this.onButtonMenuShow,this);this[method](item,'menuhide',this.onButtonMenuHide,this);}},constructButton:function(item){var b=item.events?item:this.createComponent(item,item.split?'splitbutton':this.defaultType);return b;},onAdd:function(c){Ext.Toolbar.superclass.onAdd.call(this);this.trackMenu(c);if(this.disabled){c.disable();}},onRemove:function(c){Ext.Toolbar.superclass.onRemove.call(this);this.trackMenu(c,true);},onDisable:function(){this.items.each(function(item){if(item.disable){item.disable();}});},onEnable:function(){this.items.each(function(item){if(item.enable){item.enable();}});},onButtonTriggerOver:function(btn){if(this.activeMenuBtn&&this.activeMenuBtn!=btn){this.activeMenuBtn.hideMenu();btn.showMenu();this.activeMenuBtn=btn;}},onButtonMenuShow:function(btn){this.activeMenuBtn=btn;},onButtonMenuHide:function(btn){delete this.activeMenuBtn;}});Ext.reg('toolbar',Ext.Toolbar);T.Item=Ext.extend(Ext.BoxComponent,{hideParent:true,enable:Ext.emptyFn,disable:Ext.emptyFn,focus:Ext.emptyFn});Ext.reg('tbitem',T.Item);T.Separator=Ext.extend(T.Item,{onRender:function(ct,position){this.el=ct.createChild({tag:'span',cls:'xtb-sep'},position);}});Ext.reg('tbseparator',T.Separator);T.Spacer=Ext.extend(T.Item,{onRender:function(ct,position){this.el=ct.createChild({tag:'div',cls:'xtb-spacer',style:this.width?'width:'+this.width+'px':''},position);}});Ext.reg('tbspacer',T.Spacer);T.Fill=Ext.extend(T.Item,{render:Ext.emptyFn,isFill:true});Ext.reg('tbfill',T.Fill);T.TextItem=Ext.extend(T.Item,{constructor:function(config){T.TextItem.superclass.constructor.call(this,Ext.isString(config)?{text:config}:config);},onRender:function(ct,position){this.autoEl={cls:'xtb-text',html:this.text||''};T.TextItem.superclass.onRender.call(this,ct,position);},setText:function(t){if(this.rendered){this.el.update(t);}else{this.text=t;}}});Ext.reg('tbtext',T.TextItem);T.Button=Ext.extend(Ext.Button,{});T.SplitButton=Ext.extend(Ext.SplitButton,{});Ext.reg('tbbutton',T.Button);Ext.reg('tbsplit',T.SplitButton);})();Ext.ButtonGroup=Ext.extend(Ext.Panel,{baseCls:'x-btn-group',layout:'table',defaultType:'button',frame:true,internalDefaults:{removeMode:'container',hideParent:true},initComponent:function(){this.layoutConfig=this.layoutConfig||{};Ext.applyIf(this.layoutConfig,{columns:this.columns});if(!this.title){this.addClass('x-btn-group-notitle');}
this.on('afterlayout',this.onAfterLayout,this);Ext.ButtonGroup.superclass.initComponent.call(this);},applyDefaults:function(c){c=Ext.ButtonGroup.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d);}else{Ext.applyIf(c,d);}
return c;},onAfterLayout:function(){var bodyWidth=this.body.getFrameWidth('lr')+this.body.dom.firstChild.offsetWidth;this.body.setWidth(bodyWidth);this.el.setWidth(bodyWidth+this.getFrameWidth());}});Ext.reg('buttongroup',Ext.ButtonGroup);(function(){var T=Ext.Toolbar;Ext.PagingToolbar=Ext.extend(Ext.Toolbar,{pageSize:20,displayMsg:'Displaying {0} - {1} of {2}',emptyMsg:'No data to display',beforePageText:'Page',afterPageText:'of {0}',firstText:'First Page',prevText:'Previous Page',nextText:'Next Page',lastText:'Last Page',refreshText:'Refresh',initComponent:function(){var pagingItems=[this.first=new T.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:'x-tbar-page-first',disabled:true,handler:this.moveFirst,scope:this}),this.prev=new T.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:'x-tbar-page-prev',disabled:true,handler:this.movePrevious,scope:this}),'-',this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:'x-tbar-page-number',allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new T.TextItem({text:String.format(this.afterPageText,1)}),'-',this.next=new T.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:'x-tbar-page-next',disabled:true,handler:this.moveNext,scope:this}),this.last=new T.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:'x-tbar-page-last',disabled:true,handler:this.moveLast,scope:this}),'-',this.refresh=new T.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:'x-tbar-loading',handler:this.doRefresh,scope:this})];var userItems=this.items||this.buttons||[];if(this.prependButtons){this.items=userItems.concat(pagingItems);}else{this.items=pagingItems.concat(userItems);}
delete this.buttons;if(this.displayInfo){this.items.push('->');this.items.push(this.displayItem=new T.TextItem({}));}
Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents('change','beforechange');this.on('afterlayout',this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true);},onFirstLayout:function(){if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded);}},updateInfo:function(){if(this.displayItem){var count=this.store.getCount();var msg=count==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+count,this.store.getTotalCount());this.displayItem.setText(msg);}},onLoad:function(store,r,o){if(!this.rendered){this.dsLoaded=[store,r,o];return;}
var p=this.getParams();this.cursor=(o.params&&o.params[p.start])?o.params[p.start]:0;var d=this.getPageData(),ap=d.activePage,ps=d.pages;this.afterTextItem.setText(String.format(this.afterPageText,d.pages));this.inputItem.setValue(ap);this.first.setDisabled(ap==1);this.prev.setDisabled(ap==1);this.next.setDisabled(ap==ps);this.last.setDisabled(ap==ps);this.refresh.enable();this.updateInfo();this.fireEvent('change',this,d);},getPageData:function(){var total=this.store.getTotalCount();return{total:total,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:total<this.pageSize?1:Math.ceil(total/this.pageSize)};},changePage:function(page){this.doLoad(((page-1)*this.pageSize).constrain(0,this.store.getTotalCount()));},onLoadError:function(){if(!this.rendered){return;}
this.refresh.enable();},readPage:function(d){var v=this.inputItem.getValue(),pageNum;if(!v||isNaN(pageNum=parseInt(v,10))){this.inputItem.setValue(d.activePage);return false;}
return pageNum;},onPagingFocus:function(){this.inputItem.select();},onPagingBlur:function(e){this.inputItem.setValue(this.getPageData().activePage);},onPagingKeyDown:function(field,e){var k=e.getKey(),d=this.getPageData(),pageNum;if(k==e.RETURN){e.stopEvent();pageNum=this.readPage(d);if(pageNum!==false){pageNum=Math.min(Math.max(1,pageNum),d.pages)-1;this.doLoad(pageNum*this.pageSize);}}else if(k==e.HOME||k==e.END){e.stopEvent();pageNum=k==e.HOME?1:d.pages;field.setValue(pageNum);}else if(k==e.UP||k==e.PAGEUP||k==e.DOWN||k==e.PAGEDOWN){e.stopEvent();if((pageNum=this.readPage(d))){var increment=e.shiftKey?10:1;if(k==e.DOWN||k==e.PAGEDOWN){increment*=-1;}
pageNum+=increment;if(pageNum>=1&pageNum<=d.pages){field.setValue(pageNum);}}}},getParams:function(){return this.paramNames||this.store.paramNames;},beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable();}},doLoad:function(start){var o={},pn=this.getParams();o[pn.start]=start;o[pn.limit]=this.pageSize;if(this.fireEvent('beforechange',this,o)!==false){this.store.load({params:o});}},moveFirst:function(){this.doLoad(0);},movePrevious:function(){this.doLoad(Math.max(0,this.cursor-this.pageSize));},moveNext:function(){this.doLoad(this.cursor+this.pageSize);},moveLast:function(){var total=this.store.getTotalCount(),extra=total%this.pageSize;this.doLoad(extra?(total-extra):total-this.pageSize);},doRefresh:function(){this.doLoad(this.cursor);},bindStore:function(store,initial){var doLoad;if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy();}else{this.store.un('beforeload',this.beforeLoad,this);this.store.un('load',this.onLoad,this);this.store.un('exception',this.onLoadError,this);}
if(!store){this.store=null;}}
if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError});doLoad=true;}
this.store=store;if(doLoad){this.onLoad(store,null,{});}},unbind:function(store){this.bindStore(null);},bind:function(store){this.bindStore(store);},onDestroy:function(){this.bindStore(null);Ext.PagingToolbar.superclass.onDestroy.call(this);}});})();Ext.reg('paging',Ext.PagingToolbar);Ext.History=(function(){var iframe,hiddenField;var ready=false;var currentToken;function getHash(){var href=top.location.href,i=href.indexOf("#");return i>=0?href.substr(i+1):null;}
function doSave(){hiddenField.value=currentToken;}
function handleStateChange(token){currentToken=token;Ext.History.fireEvent('change',token);}
function updateIFrame(token){var html=['<html><body><div id="state">',Ext.util.Format.htmlEncode(token),'</div></body></html>'].join('');try{var doc=iframe.contentWindow.document;doc.open();doc.write(html);doc.close();return true;}catch(e){return false;}}
function checkIFrame(){if(!iframe.contentWindow||!iframe.contentWindow.document){setTimeout(checkIFrame,10);return;}
var doc=iframe.contentWindow.document;var elem=doc.getElementById("state");var token=elem?elem.innerText:null;var hash=getHash();setInterval(function(){doc=iframe.contentWindow.document;elem=doc.getElementById("state");var newtoken=elem?elem.innerText:null;var newHash=getHash();if(newtoken!==token){token=newtoken;handleStateChange(token);top.location.hash=token;hash=token;doSave();}else if(newHash!==hash){hash=newHash;updateIFrame(newHash);}},50);ready=true;Ext.History.fireEvent('ready',Ext.History);}
function startUp(){currentToken=hiddenField.value?hiddenField.value:getHash();if(Ext.isIE){checkIFrame();}else{var hash=getHash();setInterval(function(){var newHash=getHash();if(newHash!==hash){hash=newHash;handleStateChange(hash);doSave();}},50);ready=true;Ext.History.fireEvent('ready',Ext.History);}}
return{fieldId:'x-history-field',iframeId:'x-history-frame',events:{},init:function(onReady,scope){if(ready){Ext.callback(onReady,scope,[this]);return;}
if(!Ext.isReady){Ext.onReady(function(){Ext.History.init(onReady,scope);});return;}
hiddenField=Ext.getDom(Ext.History.fieldId);if(Ext.isIE){iframe=Ext.getDom(Ext.History.iframeId);}
this.addEvents('ready','change');if(onReady){this.on('ready',onReady,scope,{single:true});}
startUp();},add:function(token,preventDup){if(preventDup!==false){if(this.getToken()==token){return true;}}
if(Ext.isIE){return updateIFrame(token);}else{top.location.hash=token;return true;}},back:function(){history.go(-1);},forward:function(){history.go(1);},getToken:function(){return ready?currentToken:getHash();}};})();Ext.apply(Ext.History,new Ext.util.Observable());Ext.Tip=Ext.extend(Ext.Panel,{minWidth:40,maxWidth:300,shadow:"sides",defaultAlign:"tl-bl?",autoRender:true,quickShowInterval:250,frame:true,hidden:true,baseCls:'x-tip',floating:{shadow:true,shim:true,useDisplay:true,constrain:false},autoHeight:true,closeAction:'hide',initComponent:function(){Ext.Tip.superclass.initComponent.call(this);if(this.closable&&!this.title){this.elements+=',header';}},afterRender:function(){Ext.Tip.superclass.afterRender.call(this);if(this.closable){this.addTool({id:'close',handler:this[this.closeAction],scope:this});}},showAt:function(xy){Ext.Tip.superclass.show.call(this);if(this.measureWidth!==false&&(!this.initialConfig||typeof this.initialConfig.width!='number')){this.doAutoWidth();}
if(this.constrainPosition){xy=this.el.adjustForConstraints(xy);}
this.setPagePosition(xy[0],xy[1]);},doAutoWidth:function(adjust){adjust=adjust||0;var bw=this.body.getTextWidth();if(this.title){bw=Math.max(bw,this.header.child('span').getTextWidth(this.title));}
bw+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding("lr")+adjust;this.setWidth(bw.constrain(this.minWidth,this.maxWidth));if(Ext.isIE7&&!this.repainted){this.el.repaint();this.repainted=true;}},showBy:function(el,pos){if(!this.rendered){this.render(Ext.getBody());}
this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign));},initDraggable:function(){this.dd=new Ext.Tip.DD(this,typeof this.draggable=='boolean'?null:this.draggable);this.header.addClass('x-tip-draggable');}});Ext.reg('tip',Ext.Tip);Ext.Tip.DD=function(tip,config){Ext.apply(this,config);this.tip=tip;Ext.Tip.DD.superclass.constructor.call(this,tip.el.id,'WindowDD-'+tip.id);this.setHandleElId(tip.header.id);this.scroll=false;};Ext.extend(Ext.Tip.DD,Ext.dd.DD,{moveOnly:true,scroll:false,headerOffsets:[100,25],startDrag:function(){this.tip.el.disableShadow();},endDrag:function(e){this.tip.el.enableShadow(true);}});Ext.ToolTip=Ext.extend(Ext.Tip,{showDelay:500,hideDelay:200,dismissDelay:5000,trackMouse:false,anchorToTarget:true,anchorOffset:0,targetCounter:0,constrainPosition:false,initComponent:function(){Ext.ToolTip.superclass.initComponent.call(this);this.lastActive=new Date();this.initTarget(this.target);this.origAnchor=this.anchor;},onRender:function(ct,position){Ext.ToolTip.superclass.onRender.call(this,ct,position);this.anchorCls='x-tip-anchor-'+this.getAnchorPosition();this.anchorEl=this.el.createChild({cls:'x-tip-anchor '+this.anchorCls});},afterRender:function(){Ext.ToolTip.superclass.afterRender.call(this);this.anchorEl.setStyle('z-index',this.el.getZIndex()+1);},initTarget:function(target){var t;if((t=Ext.get(target))){if(this.target){var tg=Ext.get(this.target);this.mun(tg,'mouseover',this.onTargetOver,this);this.mun(tg,'mouseout',this.onTargetOut,this);this.mun(tg,'mousemove',this.onMouseMove,this);}
this.mon(t,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove,scope:this});this.target=t;}
if(this.anchor){this.anchorTarget=this.target;}},onMouseMove:function(e){var t=this.delegate?e.getTarget(this.delegate):this.triggerElement=true;if(t){this.targetXY=e.getXY();if(t===this.triggerElement){if(!this.hidden&&this.trackMouse){this.setPagePosition(this.getTargetXY());}}else{this.hide();this.lastActive=new Date(0);this.onTargetOver(e);}}else if(!this.closable&&this.isVisible()){this.hide();}},getTargetXY:function(){if(this.delegate){this.anchorTarget=this.triggerElement;}
if(this.anchor){this.targetCounter++;var offsets=this.getOffsets(),xy=(this.anchorToTarget&&!this.trackMouse)?this.el.getAlignToXY(this.anchorTarget,this.getAnchorAlign()):this.targetXY,dw=Ext.lib.Dom.getViewWidth()-5,dh=Ext.lib.Dom.getViewHeight()-5,de=document.documentElement,bd=document.body,scrollX=(de.scrollLeft||bd.scrollLeft||0)+5,scrollY=(de.scrollTop||bd.scrollTop||0)+5,axy=[xy[0]+offsets[0],xy[1]+offsets[1]],sz=this.getSize();this.anchorEl.removeClass(this.anchorCls);if(this.targetCounter<2){if(axy[0]<scrollX){if(this.anchorToTarget){this.defaultAlign='l-r';if(this.mouseOffset){this.mouseOffset[0]*=-1;}}
this.anchor='left';return this.getTargetXY();}
if(axy[0]+sz.width>dw){if(this.anchorToTarget){this.defaultAlign='r-l';if(this.mouseOffset){this.mouseOffset[0]*=-1;}}
this.anchor='right';return this.getTargetXY();}
if(axy[1]<scrollY){if(this.anchorToTarget){this.defaultAlign='t-b';if(this.mouseOffset){this.mouseOffset[1]*=-1;}}
this.anchor='top';return this.getTargetXY();}
if(axy[1]+sz.height>dh){if(this.anchorToTarget){this.defaultAlign='b-t';if(this.mouseOffset){this.mouseOffset[1]*=-1;}}
this.anchor='bottom';return this.getTargetXY();}}
this.anchorCls='x-tip-anchor-'+this.getAnchorPosition();this.anchorEl.addClass(this.anchorCls);this.targetCounter=0;return axy;}else{var mouseOffset=this.getMouseOffset();return[this.targetXY[0]+mouseOffset[0],this.targetXY[1]+mouseOffset[1]];}},getMouseOffset:function(){var offset=this.anchor?[0,0]:[15,18];if(this.mouseOffset){offset[0]+=this.mouseOffset[0];offset[1]+=this.mouseOffset[1];}
return offset;},getAnchorPosition:function(){if(this.anchor){this.tipAnchor=this.anchor.charAt(0);}else{var m=this.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){throw'AnchorTip.defaultAlign is invalid';}
this.tipAnchor=m[1].charAt(0);}
switch(this.tipAnchor){case't':return'top';case'b':return'bottom';case'r':return'right';}
return'left';},getAnchorAlign:function(){switch(this.anchor){case'top':return'tl-bl';case'left':return'tl-tr';case'right':return'tr-tl';default:return'bl-tl';}},getOffsets:function(){var offsets,ap=this.getAnchorPosition().charAt(0);if(this.anchorToTarget&&!this.trackMouse){switch(ap){case't':offsets=[0,9];break;case'b':offsets=[0,-13];break;case'r':offsets=[-13,0];break;default:offsets=[9,0];break;}}else{switch(ap){case't':offsets=[-15-this.anchorOffset,30];break;case'b':offsets=[-19-this.anchorOffset,-13-this.el.dom.offsetHeight];break;case'r':offsets=[-15-this.el.dom.offsetWidth,-13-this.anchorOffset];break;default:offsets=[25,-13-this.anchorOffset];break;}}
var mouseOffset=this.getMouseOffset();offsets[0]+=mouseOffset[0];offsets[1]+=mouseOffset[1];return offsets;},onTargetOver:function(e){if(this.disabled||e.within(this.target.dom,true)){return;}
var t=e.getTarget(this.delegate);if(t){this.triggerElement=t;this.clearTimer('hide');this.targetXY=e.getXY();this.delayShow();}},delayShow:function(){if(this.hidden&&!this.showTimer){if(this.lastActive.getElapsed()<this.quickShowInterval){this.show();}else{this.showTimer=this.show.defer(this.showDelay,this);}}else if(!this.hidden&&this.autoHide!==false){this.show();}},onTargetOut:function(e){if(this.disabled||e.within(this.target.dom,true)){return;}
this.clearTimer('show');if(this.autoHide!==false){this.delayHide();}},delayHide:function(){if(!this.hidden&&!this.hideTimer){this.hideTimer=this.hide.defer(this.hideDelay,this);}},hide:function(){this.clearTimer('dismiss');this.lastActive=new Date();if(this.anchorEl){this.anchorEl.hide();}
Ext.ToolTip.superclass.hide.call(this);delete this.triggerElement;},show:function(){if(this.anchor){this.showAt([-1000,-1000]);this.origConstrainPosition=this.constrainPosition;this.constrainPosition=false;this.anchor=this.origAnchor;}
this.showAt(this.getTargetXY());if(this.anchor){this.syncAnchor();this.anchorEl.show();this.constrainPosition=this.origConstrainPosition;}else{this.anchorEl.hide();}},showAt:function(xy){this.lastActive=new Date();this.clearTimers();Ext.ToolTip.superclass.showAt.call(this,xy);if(this.dismissDelay&&this.autoHide!==false){this.dismissTimer=this.hide.defer(this.dismissDelay,this);}
if(this.anchor&&!this.anchorEl.isVisible()){this.syncAnchor();this.anchorEl.show();}},syncAnchor:function(){var anchorPos,targetPos,offset;switch(this.tipAnchor.charAt(0)){case't':anchorPos='b';targetPos='tl';offset=[20+this.anchorOffset,2];break;case'r':anchorPos='l';targetPos='tr';offset=[-2,11+this.anchorOffset];break;case'b':anchorPos='t';targetPos='bl';offset=[20+this.anchorOffset,-2];break;default:anchorPos='r';targetPos='tl';offset=[2,11+this.anchorOffset];break;}
this.anchorEl.alignTo(this.el,anchorPos+'-'+targetPos,offset);},setPagePosition:function(x,y){Ext.ToolTip.superclass.setPagePosition.call(this,x,y);if(this.anchor){this.syncAnchor();}},clearTimer:function(name){name=name+'Timer';clearTimeout(this[name]);delete this[name];},clearTimers:function(){this.clearTimer('show');this.clearTimer('dismiss');this.clearTimer('hide');},onShow:function(){Ext.ToolTip.superclass.onShow.call(this);Ext.getDoc().on('mousedown',this.onDocMouseDown,this);},onHide:function(){Ext.ToolTip.superclass.onHide.call(this);Ext.getDoc().un('mousedown',this.onDocMouseDown,this);},onDocMouseDown:function(e){if(this.autoHide!==true&&!this.closable&&!e.within(this.el.dom)){this.disable();this.doEnable.defer(100,this);}},doEnable:function(){if(!this.isDestroyed){this.enable();}},onDisable:function(){this.clearTimers();this.hide();},adjustPosition:function(x,y){if(this.contstrainPosition){var ay=this.targetXY[1],h=this.getSize().height;if(y<=ay&&(y+h)>=ay){y=ay-h-5;}}
return{x:x,y:y};},beforeDestroy:function(){this.clearTimers();Ext.destroy(this.anchorEl);delete this.anchorEl;delete this.target;delete this.anchorTarget;delete this.triggerElement;Ext.ToolTip.superclass.beforeDestroy.call(this);},onDestroy:function(){Ext.getDoc().un('mousedown',this.onDocMouseDown,this);Ext.ToolTip.superclass.onDestroy.call(this);}});Ext.reg('tooltip',Ext.ToolTip);Ext.QuickTip=Ext.extend(Ext.ToolTip,{interceptTitles:false,tagConfig:{namespace:"ext",attribute:"qtip",width:"qwidth",target:"target",title:"qtitle",hide:"hide",cls:"qclass",align:"qalign",anchor:"anchor"},initComponent:function(){this.target=this.target||Ext.getDoc();this.targets=this.targets||{};Ext.QuickTip.superclass.initComponent.call(this);},register:function(config){var cs=Ext.isArray(config)?config:arguments;for(var i=0,len=cs.length;i<len;i++){var c=cs[i];var target=c.target;if(target){if(Ext.isArray(target)){for(var j=0,jlen=target.length;j<jlen;j++){this.targets[Ext.id(target[j])]=c;}}else{this.targets[Ext.id(target)]=c;}}}},unregister:function(el){delete this.targets[Ext.id(el)];},cancelShow:function(el){var at=this.activeTarget;el=Ext.get(el).dom;if(this.isVisible()){if(at&&at.el==el){this.hide();}}else if(at&&at.el==el){this.clearTimer('show');}},getTipCfg:function(e){var t=e.getTarget(),ttp,cfg;if(this.interceptTitles&&t.title&&Ext.isString(t.title)){ttp=t.title;t.qtip=ttp;t.removeAttribute("title");e.preventDefault();}else{cfg=this.tagConfig;ttp=t.qtip||Ext.fly(t).getAttribute(cfg.attribute,cfg.namespace);}
return ttp;},onTargetOver:function(e){if(this.disabled){return;}
this.targetXY=e.getXY();var t=e.getTarget();if(!t||t.nodeType!==1||t==document||t==document.body){return;}
if(this.activeTarget&&((t==this.activeTarget.el)||Ext.fly(this.activeTarget.el).contains(t))){this.clearTimer('hide');this.show();return;}
if(t&&this.targets[t.id]){this.activeTarget=this.targets[t.id];this.activeTarget.el=t;this.anchor=this.activeTarget.anchor;if(this.anchor){this.anchorTarget=t;}
this.delayShow();return;}
var ttp,et=Ext.fly(t),cfg=this.tagConfig,ns=cfg.namespace;if(ttp=this.getTipCfg(e)){var autoHide=et.getAttribute(cfg.hide,ns);this.activeTarget={el:t,text:ttp,width:et.getAttribute(cfg.width,ns),autoHide:autoHide!="user"&&autoHide!=='false',title:et.getAttribute(cfg.title,ns),cls:et.getAttribute(cfg.cls,ns),align:et.getAttribute(cfg.align,ns)};this.anchor=et.getAttribute(cfg.anchor,ns);if(this.anchor){this.anchorTarget=t;}
this.delayShow();}},onTargetOut:function(e){if(this.activeTarget&&e.within(this.activeTarget.el)&&!this.getTipCfg(e)){return;}
this.clearTimer('show');if(this.autoHide!==false){this.delayHide();}},showAt:function(xy){var t=this.activeTarget;if(t){if(!this.rendered){this.render(Ext.getBody());this.activeTarget=t;}
if(t.width){this.setWidth(t.width);this.body.setWidth(this.adjustBodyWidth(t.width-this.getFrameWidth()));this.measureWidth=false;}else{this.measureWidth=true;}
this.setTitle(t.title||'');this.body.update(t.text);this.autoHide=t.autoHide;this.dismissDelay=t.dismissDelay||this.dismissDelay;if(this.lastCls){this.el.removeClass(this.lastCls);delete this.lastCls;}
if(t.cls){this.el.addClass(t.cls);this.lastCls=t.cls;}
if(this.anchor){this.constrainPosition=false;}else if(t.align){xy=this.el.getAlignToXY(t.el,t.align);this.constrainPosition=false;}else{this.constrainPosition=true;}}
Ext.QuickTip.superclass.showAt.call(this,xy);},hide:function(){delete this.activeTarget;Ext.QuickTip.superclass.hide.call(this);}});Ext.reg('quicktip',Ext.QuickTip);Ext.QuickTips=function(){var tip,locks=[];return{init:function(autoRender){if(!tip){if(!Ext.isReady){Ext.onReady(function(){Ext.QuickTips.init(autoRender);});return;}
tip=new Ext.QuickTip({elements:'header,body'});if(autoRender!==false){tip.render(Ext.getBody());}}},enable:function(){if(tip){locks.pop();if(locks.length<1){tip.enable();}}},disable:function(){if(tip){tip.disable();}
locks.push(1);},isEnabled:function(){return tip!==undefined&&!tip.disabled;},getQuickTip:function(){return tip;},register:function(){tip.register.apply(tip,arguments);},unregister:function(){tip.unregister.apply(tip,arguments);},tips:function(){tip.register.apply(tip,arguments);}}}();Ext.slider.Tip=Ext.extend(Ext.Tip,{minWidth:10,offsets:[0,-10],init:function(slider){slider.on({scope:this,dragstart:this.onSlide,drag:this.onSlide,dragend:this.hide,destroy:this.destroy});},onSlide:function(slider,e,thumb){this.show();this.body.update(this.getText(thumb));this.doAutoWidth();this.el.alignTo(thumb.el,'b-t?',this.offsets);},getText:function(thumb){return String(thumb.value);}});Ext.ux.SliderTip=Ext.slider.Tip;Ext.tree.TreePanel=Ext.extend(Ext.Panel,{rootVisible:true,animate:Ext.enableFx,lines:true,enableDD:false,hlDrop:Ext.enableFx,pathSeparator:'/',bubbleEvents:[],initComponent:function(){Ext.tree.TreePanel.superclass.initComponent.call(this);if(!this.eventModel){this.eventModel=new Ext.tree.TreeEventModel(this);}
var l=this.loader;if(!l){l=new Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod});}else if(Ext.isObject(l)&&!l.load){l=new Ext.tree.TreeLoader(l);}
this.loader=l;this.nodeHash={};if(this.root){var r=this.root;delete this.root;this.setRootNode(r);}
this.addEvents('append','remove','movenode','insert','beforeappend','beforeremove','beforemovenode','beforeinsert','beforeload','load','textchange','beforeexpandnode','beforecollapsenode','expandnode','disabledchange','collapsenode','beforeclick','click','containerclick','checkchange','beforedblclick','dblclick','containerdblclick','contextmenu','containercontextmenu','beforechildrenrendered','startdrag','enddrag','dragdrop','beforenodedrop','nodedrop','nodedragover');if(this.singleExpand){this.on('beforeexpandnode',this.restrictExpand,this);}},proxyNodeEvent:function(ename,a1,a2,a3,a4,a5,a6){if(ename=='collapse'||ename=='expand'||ename=='beforecollapse'||ename=='beforeexpand'||ename=='move'||ename=='beforemove'){ename=ename+'node';}
return this.fireEvent(ename,a1,a2,a3,a4,a5,a6);},getRootNode:function(){return this.root;},setRootNode:function(node){this.destroyRoot();if(!node.render){node=this.loader.createNode(node);}
this.root=node;node.ownerTree=this;node.isRoot=true;this.registerNode(node);if(!this.rootVisible){var uiP=node.attributes.uiProvider;node.ui=uiP?new uiP(node):new Ext.tree.RootTreeNodeUI(node);}
if(this.innerCt){this.clearInnerCt();this.renderRoot();}
return node;},clearInnerCt:function(){this.innerCt.update('');},renderRoot:function(){this.root.render();if(!this.rootVisible){this.root.renderChildren();}},getNodeById:function(id){return this.nodeHash[id];},registerNode:function(node){this.nodeHash[node.id]=node;},unregisterNode:function(node){delete this.nodeHash[node.id];},toString:function(){return'[Tree'+(this.id?' '+this.id:'')+']';},restrictExpand:function(node){var p=node.parentNode;if(p){if(p.expandedChild&&p.expandedChild.parentNode==p){p.expandedChild.collapse();}
p.expandedChild=node;}},getChecked:function(a,startNode){startNode=startNode||this.root;var r=[];var f=function(){if(this.attributes.checked){r.push(!a?this:(a=='id'?this.id:this.attributes[a]));}};startNode.cascade(f);return r;},getLoader:function(){return this.loader;},expandAll:function(){this.root.expand(true);},collapseAll:function(){this.root.collapse(true);},getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.tree.DefaultSelectionModel();}
return this.selModel;},expandPath:function(path,attr,callback){attr=attr||'id';var keys=path.split(this.pathSeparator);var curNode=this.root;if(curNode.attributes[attr]!=keys[1]){if(callback){callback(false,null);}
return;}
var index=1;var f=function(){if(++index==keys.length){if(callback){callback(true,curNode);}
return;}
var c=curNode.findChild(attr,keys[index]);if(!c){if(callback){callback(false,curNode);}
return;}
curNode=c;c.expand(false,false,f);};curNode.expand(false,false,f);},selectPath:function(path,attr,callback){attr=attr||'id';var keys=path.split(this.pathSeparator),v=keys.pop();if(keys.length>1){var f=function(success,node){if(success&&node){var n=node.findChild(attr,v);if(n){n.select();if(callback){callback(true,n);}}else if(callback){callback(false,n);}}else{if(callback){callback(false,n);}}};this.expandPath(keys.join(this.pathSeparator),attr,f);}else{this.root.select();if(callback){callback(true,this.root);}}},getTreeEl:function(){return this.body;},onRender:function(ct,position){Ext.tree.TreePanel.superclass.onRender.call(this,ct,position);this.el.addClass('x-tree');this.innerCt=this.body.createChild({tag:'ul',cls:'x-tree-root-ct '+
(this.useArrows?'x-tree-arrows':this.lines?'x-tree-lines':'x-tree-no-lines')});},initEvents:function(){Ext.tree.TreePanel.superclass.initEvents.call(this);if(this.containerScroll){Ext.dd.ScrollManager.register(this.body);}
if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new Ext.tree.TreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||'TreeDD',appendOnly:this.ddAppendOnly===true});}
if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new Ext.tree.TreeDragZone(this,this.dragConfig||{ddGroup:this.ddGroup||'TreeDD',scroll:this.ddScroll});}
this.getSelectionModel().init(this);},afterRender:function(){Ext.tree.TreePanel.superclass.afterRender.call(this);this.renderRoot();},beforeDestroy:function(){if(this.rendered){Ext.dd.ScrollManager.unregister(this.body);Ext.destroy(this.dropZone,this.dragZone);}
this.destroyRoot();Ext.destroy(this.loader);this.nodeHash=this.root=this.loader=null;Ext.tree.TreePanel.superclass.beforeDestroy.call(this);},destroyRoot:function(){if(this.root&&this.root.destroy){this.root.destroy(true);}}});Ext.tree.TreePanel.nodeTypes={};Ext.reg('treepanel',Ext.tree.TreePanel);Ext.tree.TreeEventModel=function(tree){this.tree=tree;this.tree.on('render',this.initEvents,this);};Ext.tree.TreeEventModel.prototype={initEvents:function(){var t=this.tree;if(t.trackMouseOver!==false){t.mon(t.innerCt,{scope:this,mouseover:this.delegateOver,mouseout:this.delegateOut});}
t.mon(t.getTreeEl(),{scope:this,click:this.delegateClick,dblclick:this.delegateDblClick,contextmenu:this.delegateContextMenu});},getNode:function(e){var t;if(t=e.getTarget('.x-tree-node-el',10)){var id=Ext.fly(t,'_treeEvents').getAttribute('tree-node-id','ext');if(id){return this.tree.getNodeById(id);}}
return null;},getNodeTarget:function(e){var t=e.getTarget('.x-tree-node-icon',1);if(!t){t=e.getTarget('.x-tree-node-el',6);}
return t;},delegateOut:function(e,t){if(!this.beforeEvent(e)){return;}
if(e.getTarget('.x-tree-ec-icon',1)){var n=this.getNode(e);this.onIconOut(e,n);if(n==this.lastEcOver){delete this.lastEcOver;}}
if((t=this.getNodeTarget(e))&&!e.within(t,true)){this.onNodeOut(e,this.getNode(e));}},delegateOver:function(e,t){if(!this.beforeEvent(e)){return;}
if(Ext.isGecko&&!this.trackingDoc){Ext.getBody().on('mouseover',this.trackExit,this);this.trackingDoc=true;}
if(this.lastEcOver){this.onIconOut(e,this.lastEcOver);delete this.lastEcOver;}
if(e.getTarget('.x-tree-ec-icon',1)){this.lastEcOver=this.getNode(e);this.onIconOver(e,this.lastEcOver);}
if(t=this.getNodeTarget(e)){this.onNodeOver(e,this.getNode(e));}},trackExit:function(e){if(this.lastOverNode){if(this.lastOverNode.ui&&!e.within(this.lastOverNode.ui.getEl())){this.onNodeOut(e,this.lastOverNode);}
delete this.lastOverNode;Ext.getBody().un('mouseover',this.trackExit,this);this.trackingDoc=false;}},delegateClick:function(e,t){if(this.beforeEvent(e)){if(e.getTarget('input[type=checkbox]',1)){this.onCheckboxClick(e,this.getNode(e));}else if(e.getTarget('.x-tree-ec-icon',1)){this.onIconClick(e,this.getNode(e));}else if(this.getNodeTarget(e)){this.onNodeClick(e,this.getNode(e));}}else{this.checkContainerEvent(e,'click');}},delegateDblClick:function(e,t){if(this.beforeEvent(e)){if(this.getNodeTarget(e)){this.onNodeDblClick(e,this.getNode(e));}}else{this.checkContainerEvent(e,'dblclick');}},delegateContextMenu:function(e,t){if(this.beforeEvent(e)){if(this.getNodeTarget(e)){this.onNodeContextMenu(e,this.getNode(e));}}else{this.checkContainerEvent(e,'contextmenu');}},checkContainerEvent:function(e,type){if(this.disabled){e.stopEvent();return false;}
this.onContainerEvent(e,type);},onContainerEvent:function(e,type){this.tree.fireEvent('container'+type,this.tree,e);},onNodeClick:function(e,node){node.ui.onClick(e);},onNodeOver:function(e,node){this.lastOverNode=node;node.ui.onOver(e);},onNodeOut:function(e,node){node.ui.onOut(e);},onIconOver:function(e,node){node.ui.addClass('x-tree-ec-over');},onIconOut:function(e,node){node.ui.removeClass('x-tree-ec-over');},onIconClick:function(e,node){node.ui.ecClick(e);},onCheckboxClick:function(e,node){node.ui.onCheckChange(e);},onNodeDblClick:function(e,node){node.ui.onDblClick(e);},onNodeContextMenu:function(e,node){node.ui.onContextMenu(e);},beforeEvent:function(e){var node=this.getNode(e);if(this.disabled||!node||!node.ui){e.stopEvent();return false;}
return true;},disable:function(){this.disabled=true;},enable:function(){this.disabled=false;}};Ext.tree.DefaultSelectionModel=Ext.extend(Ext.util.Observable,{constructor:function(config){this.selNode=null;this.addEvents('selectionchange','beforeselect');Ext.apply(this,config);Ext.tree.DefaultSelectionModel.superclass.constructor.call(this);},init:function(tree){this.tree=tree;tree.mon(tree.getTreeEl(),'keydown',this.onKeyDown,this);tree.on('click',this.onNodeClick,this);},onNodeClick:function(node,e){this.select(node);},select:function(node,selectNextNode){if(!Ext.fly(node.ui.wrap).isVisible()&&selectNextNode){return selectNextNode.call(this,node);}
var last=this.selNode;if(node==last){node.ui.onSelectedChange(true);}else if(this.fireEvent('beforeselect',this,node,last)!==false){if(last&&last.ui){last.ui.onSelectedChange(false);}
this.selNode=node;node.ui.onSelectedChange(true);this.fireEvent('selectionchange',this,node,last);}
return node;},unselect:function(node,silent){if(this.selNode==node){this.clearSelections(silent);}},clearSelections:function(silent){var n=this.selNode;if(n){n.ui.onSelectedChange(false);this.selNode=null;if(silent!==true){this.fireEvent('selectionchange',this,null);}}
return n;},getSelectedNode:function(){return this.selNode;},isSelected:function(node){return this.selNode==node;},selectPrevious:function(s){if(!(s=s||this.selNode||this.lastSelNode)){return null;}
var ps=s.previousSibling;if(ps){if(!ps.isExpanded()||ps.childNodes.length<1){return this.select(ps,this.selectPrevious);}else{var lc=ps.lastChild;while(lc&&lc.isExpanded()&&Ext.fly(lc.ui.wrap).isVisible()&&lc.childNodes.length>0){lc=lc.lastChild;}
return this.select(lc,this.selectPrevious);}}else if(s.parentNode&&(this.tree.rootVisible||!s.parentNode.isRoot)){return this.select(s.parentNode,this.selectPrevious);}
return null;},selectNext:function(s){if(!(s=s||this.selNode||this.lastSelNode)){return null;}
if(s.firstChild&&s.isExpanded()&&Ext.fly(s.ui.wrap).isVisible()){return this.select(s.firstChild,this.selectNext);}else if(s.nextSibling){return this.select(s.nextSibling,this.selectNext);}else if(s.parentNode){var newS=null;s.parentNode.bubble(function(){if(this.nextSibling){newS=this.getOwnerTree().selModel.select(this.nextSibling,this.selectNext);return false;}});return newS;}
return null;},onKeyDown:function(e){var s=this.selNode||this.lastSelNode;var sm=this;if(!s){return;}
var k=e.getKey();switch(k){case e.DOWN:e.stopEvent();this.selectNext();break;case e.UP:e.stopEvent();this.selectPrevious();break;case e.RIGHT:e.preventDefault();if(s.hasChildNodes()){if(!s.isExpanded()){s.expand();}else if(s.firstChild){this.select(s.firstChild,e);}}
break;case e.LEFT:e.preventDefault();if(s.hasChildNodes()&&s.isExpanded()){s.collapse();}else if(s.parentNode&&(this.tree.rootVisible||s.parentNode!=this.tree.getRootNode())){this.select(s.parentNode,e);}
break;};}});Ext.tree.MultiSelectionModel=Ext.extend(Ext.util.Observable,{constructor:function(config){this.selNodes=[];this.selMap={};this.addEvents('selectionchange');Ext.apply(this,config);Ext.tree.MultiSelectionModel.superclass.constructor.call(this);},init:function(tree){this.tree=tree;tree.mon(tree.getTreeEl(),'keydown',this.onKeyDown,this);tree.on('click',this.onNodeClick,this);},onNodeClick:function(node,e){if(e.ctrlKey&&this.isSelected(node)){this.unselect(node);}else{this.select(node,e,e.ctrlKey);}},select:function(node,e,keepExisting){if(keepExisting!==true){this.clearSelections(true);}
if(this.isSelected(node)){this.lastSelNode=node;return node;}
this.selNodes.push(node);this.selMap[node.id]=node;this.lastSelNode=node;node.ui.onSelectedChange(true);this.fireEvent('selectionchange',this,this.selNodes);return node;},unselect:function(node){if(this.selMap[node.id]){node.ui.onSelectedChange(false);var sn=this.selNodes;var index=sn.indexOf(node);if(index!=-1){this.selNodes.splice(index,1);}
delete this.selMap[node.id];this.fireEvent('selectionchange',this,this.selNodes);}},clearSelections:function(suppressEvent){var sn=this.selNodes;if(sn.length>0){for(var i=0,len=sn.length;i<len;i++){sn[i].ui.onSelectedChange(false);}
this.selNodes=[];this.selMap={};if(suppressEvent!==true){this.fireEvent('selectionchange',this,this.selNodes);}}},isSelected:function(node){return this.selMap[node.id]?true:false;},getSelectedNodes:function(){return this.selNodes.concat([]);},onKeyDown:Ext.tree.DefaultSelectionModel.prototype.onKeyDown,selectNext:Ext.tree.DefaultSelectionModel.prototype.selectNext,selectPrevious:Ext.tree.DefaultSelectionModel.prototype.selectPrevious});Ext.data.Tree=function(root){this.nodeHash={};this.root=null;if(root){this.setRootNode(root);}
this.addEvents("append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert");Ext.data.Tree.superclass.constructor.call(this);};Ext.extend(Ext.data.Tree,Ext.util.Observable,{pathSeparator:"/",proxyNodeEvent:function(){return this.fireEvent.apply(this,arguments);},getRootNode:function(){return this.root;},setRootNode:function(node){this.root=node;node.ownerTree=this;node.isRoot=true;this.registerNode(node);return node;},getNodeById:function(id){return this.nodeHash[id];},registerNode:function(node){this.nodeHash[node.id]=node;},unregisterNode:function(node){delete this.nodeHash[node.id];},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]";}});Ext.data.Node=function(attributes){this.attributes=attributes||{};this.leaf=this.attributes.leaf;this.id=this.attributes.id;if(!this.id){this.id=Ext.id(null,"xnode-");this.attributes.id=this.id;}
this.childNodes=[];if(!this.childNodes.indexOf){this.childNodes.indexOf=function(o){for(var i=0,len=this.length;i<len;i++){if(this[i]==o){return i;}}
return-1;};}
this.parentNode=null;this.firstChild=null;this.lastChild=null;this.previousSibling=null;this.nextSibling=null;this.addEvents({"append":true,"remove":true,"move":true,"insert":true,"beforeappend":true,"beforeremove":true,"beforemove":true,"beforeinsert":true});this.listeners=this.attributes.listeners;Ext.data.Node.superclass.constructor.call(this);};Ext.extend(Ext.data.Node,Ext.util.Observable,{fireEvent:function(evtName){if(Ext.data.Node.superclass.fireEvent.apply(this,arguments)===false){return false;}
var ot=this.getOwnerTree();if(ot){if(ot.proxyNodeEvent.apply(ot,arguments)===false){return false;}}
return true;},isLeaf:function(){return this.leaf===true;},setFirstChild:function(node){this.firstChild=node;},setLastChild:function(node){this.lastChild=node;},isLast:function(){return(!this.parentNode?true:this.parentNode.lastChild==this);},isFirst:function(){return(!this.parentNode?true:this.parentNode.firstChild==this);},hasChildNodes:function(){return!this.isLeaf()&&this.childNodes.length>0;},isExpandable:function(){return this.attributes.expandable||this.hasChildNodes();},appendChild:function(node){var multi=false;if(Ext.isArray(node)){multi=node;}else if(arguments.length>1){multi=arguments;}
if(multi){for(var i=0,len=multi.length;i<len;i++){this.appendChild(multi[i]);}}else{if(this.fireEvent("beforeappend",this.ownerTree,this,node)===false){return false;}
var index=this.childNodes.length;var oldParent=node.parentNode;if(oldParent){if(node.fireEvent("beforemove",node.getOwnerTree(),node,oldParent,this,index)===false){return false;}
oldParent.removeChild(node);}
index=this.childNodes.length;if(index===0){this.setFirstChild(node);}
this.childNodes.push(node);node.parentNode=this;var ps=this.childNodes[index-1];if(ps){node.previousSibling=ps;ps.nextSibling=node;}else{node.previousSibling=null;}
node.nextSibling=null;this.setLastChild(node);node.setOwnerTree(this.getOwnerTree());this.fireEvent("append",this.ownerTree,this,node,index);if(oldParent){node.fireEvent("move",this.ownerTree,node,oldParent,this,index);}
return node;}},removeChild:function(node,destroy){var index=this.childNodes.indexOf(node);if(index==-1){return false;}
if(this.fireEvent("beforeremove",this.ownerTree,this,node)===false){return false;}
this.childNodes.splice(index,1);if(node.previousSibling){node.previousSibling.nextSibling=node.nextSibling;}
if(node.nextSibling){node.nextSibling.previousSibling=node.previousSibling;}
if(this.firstChild==node){this.setFirstChild(node.nextSibling);}
if(this.lastChild==node){this.setLastChild(node.previousSibling);}
this.fireEvent("remove",this.ownerTree,this,node);if(destroy){node.destroy(true);}else{node.clear();}
return node;},clear:function(destroy){this.setOwnerTree(null,destroy);this.parentNode=this.previousSibling=this.nextSibling=null;if(destroy){this.firstChild=this.lastChild=null;}},destroy:function(silent){if(silent===true){this.purgeListeners();this.clear(true);Ext.each(this.childNodes,function(n){n.destroy(true);});this.childNodes=null;}else{this.remove(true);}},insertBefore:function(node,refNode){if(!refNode){return this.appendChild(node);}
if(node==refNode){return false;}
if(this.fireEvent("beforeinsert",this.ownerTree,this,node,refNode)===false){return false;}
var index=this.childNodes.indexOf(refNode);var oldParent=node.parentNode;var refIndex=index;if(oldParent==this&&this.childNodes.indexOf(node)<index){refIndex--;}
if(oldParent){if(node.fireEvent("beforemove",node.getOwnerTree(),node,oldParent,this,index,refNode)===false){return false;}
oldParent.removeChild(node);}
if(refIndex===0){this.setFirstChild(node);}
this.childNodes.splice(refIndex,0,node);node.parentNode=this;var ps=this.childNodes[refIndex-1];if(ps){node.previousSibling=ps;ps.nextSibling=node;}else{node.previousSibling=null;}
node.nextSibling=refNode;refNode.previousSibling=node;node.setOwnerTree(this.getOwnerTree());this.fireEvent("insert",this.ownerTree,this,node,refNode);if(oldParent){node.fireEvent("move",this.ownerTree,node,oldParent,this,refIndex,refNode);}
return node;},remove:function(destroy){if(this.parentNode){this.parentNode.removeChild(this,destroy);}
return this;},removeAll:function(destroy){var cn=this.childNodes,n;while((n=cn[0])){this.removeChild(n,destroy);}
return this;},item:function(index){return this.childNodes[index];},replaceChild:function(newChild,oldChild){var s=oldChild?oldChild.nextSibling:null;this.removeChild(oldChild);this.insertBefore(newChild,s);return oldChild;},indexOf:function(child){return this.childNodes.indexOf(child);},getOwnerTree:function(){if(!this.ownerTree){var p=this;while(p){if(p.ownerTree){this.ownerTree=p.ownerTree;break;}
p=p.parentNode;}}
return this.ownerTree;},getDepth:function(){var depth=0;var p=this;while(p.parentNode){++depth;p=p.parentNode;}
return depth;},setOwnerTree:function(tree,destroy){if(tree!=this.ownerTree){if(this.ownerTree){this.ownerTree.unregisterNode(this);}
this.ownerTree=tree;if(destroy!==true){Ext.each(this.childNodes,function(n){n.setOwnerTree(tree);});}
if(tree){tree.registerNode(this);}}},setId:function(id){if(id!==this.id){var t=this.ownerTree;if(t){t.unregisterNode(this);}
this.id=this.attributes.id=id;if(t){t.registerNode(this);}
this.onIdChange(id);}},onIdChange:Ext.emptyFn,getPath:function(attr){attr=attr||"id";var p=this.parentNode;var b=[this.attributes[attr]];while(p){b.unshift(p.attributes[attr]);p=p.parentNode;}
var sep=this.getOwnerTree().pathSeparator;return sep+b.join(sep);},bubble:function(fn,scope,args){var p=this;while(p){if(fn.apply(scope||p,args||[p])===false){break;}
p=p.parentNode;}},cascade:function(fn,scope,args){if(fn.apply(scope||this,args||[this])!==false){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].cascade(fn,scope,args);}}},eachChild:function(fn,scope,args){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){if(fn.apply(scope||this,args||[cs[i]])===false){break;}}},findChild:function(attribute,value,deep){return this.findChildBy(function(){return this.attributes[attribute]==value;},null,deep);},findChildBy:function(fn,scope,deep){var cs=this.childNodes,len=cs.length,i=0,n,res;for(;i<len;i++){n=cs[i];if(fn.call(scope||n,n)===true){return n;}else if(deep){res=n.findChildBy(fn,scope,deep);if(res!=null){return res;}}}
return null;},sort:function(fn,scope){var cs=this.childNodes;var len=cs.length;if(len>0){var sortFn=scope?function(){fn.apply(scope,arguments);}:fn;cs.sort(sortFn);for(var i=0;i<len;i++){var n=cs[i];n.previousSibling=cs[i-1];n.nextSibling=cs[i+1];if(i===0){this.setFirstChild(n);}
if(i==len-1){this.setLastChild(n);}}}},contains:function(node){return node.isAncestor(this);},isAncestor:function(node){var p=this.parentNode;while(p){if(p==node){return true;}
p=p.parentNode;}
return false;},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]";}});Ext.tree.TreeNode=function(attributes){attributes=attributes||{};if(Ext.isString(attributes)){attributes={text:attributes};}
this.childrenRendered=false;this.rendered=false;Ext.tree.TreeNode.superclass.constructor.call(this,attributes);this.expanded=attributes.expanded===true;this.isTarget=attributes.isTarget!==false;this.draggable=attributes.draggable!==false&&attributes.allowDrag!==false;this.allowChildren=attributes.allowChildren!==false&&attributes.allowDrop!==false;this.text=attributes.text;this.disabled=attributes.disabled===true;this.hidden=attributes.hidden===true;this.addEvents('textchange','beforeexpand','beforecollapse','expand','disabledchange','collapse','beforeclick','click','checkchange','beforedblclick','dblclick','contextmenu','beforechildrenrendered');var uiClass=this.attributes.uiProvider||this.defaultUI||Ext.tree.TreeNodeUI;this.ui=new uiClass(this);};Ext.extend(Ext.tree.TreeNode,Ext.data.Node,{preventHScroll:true,isExpanded:function(){return this.expanded;},getUI:function(){return this.ui;},getLoader:function(){var owner;return this.loader||((owner=this.getOwnerTree())&&owner.loader?owner.loader:(this.loader=new Ext.tree.TreeLoader()));},setFirstChild:function(node){var of=this.firstChild;Ext.tree.TreeNode.superclass.setFirstChild.call(this,node);if(this.childrenRendered&&of&&node!=of){of.renderIndent(true,true);}
if(this.rendered){this.renderIndent(true,true);}},setLastChild:function(node){var ol=this.lastChild;Ext.tree.TreeNode.superclass.setLastChild.call(this,node);if(this.childrenRendered&&ol&&node!=ol){ol.renderIndent(true,true);}
if(this.rendered){this.renderIndent(true,true);}},appendChild:function(n){if(!n.render&&!Ext.isArray(n)){n=this.getLoader().createNode(n);}
var node=Ext.tree.TreeNode.superclass.appendChild.call(this,n);if(node&&this.childrenRendered){node.render();}
this.ui.updateExpandIcon();return node;},removeChild:function(node,destroy){this.ownerTree.getSelectionModel().unselect(node);Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);if(!destroy){if(node.ui.rendered){node.ui.remove();}
if(this.childNodes.length<1){this.collapse(false,false);}else{this.ui.updateExpandIcon();}
if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false;}}
return node;},insertBefore:function(node,refNode){if(!node.render){node=this.getLoader().createNode(node);}
var newNode=Ext.tree.TreeNode.superclass.insertBefore.call(this,node,refNode);if(newNode&&refNode&&this.childrenRendered){node.render();}
this.ui.updateExpandIcon();return newNode;},setText:function(text){var oldText=this.text;this.text=this.attributes.text=text;if(this.rendered){this.ui.onTextChange(this,text,oldText);}
this.fireEvent('textchange',this,text,oldText);},select:function(){var t=this.getOwnerTree();if(t){t.getSelectionModel().select(this);}},unselect:function(silent){var t=this.getOwnerTree();if(t){t.getSelectionModel().unselect(this,silent);}},isSelected:function(){var t=this.getOwnerTree();return t?t.getSelectionModel().isSelected(this):false;},expand:function(deep,anim,callback,scope){if(!this.expanded){if(this.fireEvent('beforeexpand',this,deep,anim)===false){return;}
if(!this.childrenRendered){this.renderChildren();}
this.expanded=true;if(!this.isHiddenRoot()&&(this.getOwnerTree().animate&&anim!==false)||anim){this.ui.animExpand(function(){this.fireEvent('expand',this);this.runCallback(callback,scope||this,[this]);if(deep===true){this.expandChildNodes(true);}}.createDelegate(this));return;}else{this.ui.expand();this.fireEvent('expand',this);this.runCallback(callback,scope||this,[this]);}}else{this.runCallback(callback,scope||this,[this]);}
if(deep===true){this.expandChildNodes(true);}},runCallback:function(cb,scope,args){if(Ext.isFunction(cb)){cb.apply(scope,args);}},isHiddenRoot:function(){return this.isRoot&&!this.getOwnerTree().rootVisible;},collapse:function(deep,anim,callback,scope){if(this.expanded&&!this.isHiddenRoot()){if(this.fireEvent('beforecollapse',this,deep,anim)===false){return;}
this.expanded=false;if((this.getOwnerTree().animate&&anim!==false)||anim){this.ui.animCollapse(function(){this.fireEvent('collapse',this);this.runCallback(callback,scope||this,[this]);if(deep===true){this.collapseChildNodes(true);}}.createDelegate(this));return;}else{this.ui.collapse();this.fireEvent('collapse',this);this.runCallback(callback,scope||this,[this]);}}else if(!this.expanded){this.runCallback(callback,scope||this,[this]);}
if(deep===true){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].collapse(true,false);}}},delayedExpand:function(delay){if(!this.expandProcId){this.expandProcId=this.expand.defer(delay,this);}},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId);}
this.expandProcId=false;},toggle:function(){if(this.expanded){this.collapse();}else{this.expand();}},ensureVisible:function(callback,scope){var tree=this.getOwnerTree();tree.expandPath(this.parentNode?this.parentNode.getPath():this.getPath(),false,function(){var node=tree.getNodeById(this.id);tree.getTreeEl().scrollChildIntoView(node.ui.anchor);this.runCallback(callback,scope||this,[this]);}.createDelegate(this));},expandChildNodes:function(deep){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].expand(deep);}},collapseChildNodes:function(deep){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].collapse(deep);}},disable:function(){this.disabled=true;this.unselect();if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,true);}
this.fireEvent('disabledchange',this,true);},enable:function(){this.disabled=false;if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,false);}
this.fireEvent('disabledchange',this,false);},renderChildren:function(suppressEvent){if(suppressEvent!==false){this.fireEvent('beforechildrenrendered',this);}
var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].render(true);}
this.childrenRendered=true;},sort:function(fn,scope){Ext.tree.TreeNode.superclass.sort.apply(this,arguments);if(this.childrenRendered){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].render(true);}}},render:function(bulkRender){this.ui.render(bulkRender);if(!this.rendered){this.getOwnerTree().registerNode(this);this.rendered=true;if(this.expanded){this.expanded=false;this.expand(false,false);}}},renderIndent:function(deep,refresh){if(refresh){this.ui.childIndent=null;}
this.ui.renderIndent();if(deep===true&&this.childrenRendered){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].renderIndent(true,refresh);}}},beginUpdate:function(){this.childrenRendered=false;},endUpdate:function(){if(this.expanded&&this.rendered){this.renderChildren();}},destroy:function(silent){if(silent===true){this.unselect(true);}
Ext.tree.TreeNode.superclass.destroy.call(this,silent);Ext.destroy(this.ui,this.loader);this.ui=this.loader=null;},onIdChange:function(id){this.ui.onIdChange(id);}});Ext.tree.TreePanel.nodeTypes.node=Ext.tree.TreeNode;Ext.tree.AsyncTreeNode=function(config){this.loaded=config&&config.loaded===true;this.loading=false;Ext.tree.AsyncTreeNode.superclass.constructor.apply(this,arguments);this.addEvents('beforeload','load');};Ext.extend(Ext.tree.AsyncTreeNode,Ext.tree.TreeNode,{expand:function(deep,anim,callback,scope){if(this.loading){var timer;var f=function(){if(!this.loading){clearInterval(timer);this.expand(deep,anim,callback,scope);}}.createDelegate(this);timer=setInterval(f,200);return;}
if(!this.loaded){if(this.fireEvent("beforeload",this)===false){return;}
this.loading=true;this.ui.beforeLoad(this);var loader=this.loader||this.attributes.loader||this.getOwnerTree().getLoader();if(loader){loader.load(this,this.loadComplete.createDelegate(this,[deep,anim,callback,scope]),this);return;}}
Ext.tree.AsyncTreeNode.superclass.expand.call(this,deep,anim,callback,scope);},isLoading:function(){return this.loading;},loadComplete:function(deep,anim,callback,scope){this.loading=false;this.loaded=true;this.ui.afterLoad(this);this.fireEvent("load",this);this.expand(deep,anim,callback,scope);},isLoaded:function(){return this.loaded;},hasChildNodes:function(){if(!this.isLeaf()&&!this.loaded){return true;}else{return Ext.tree.AsyncTreeNode.superclass.hasChildNodes.call(this);}},reload:function(callback,scope){this.collapse(false,false);while(this.firstChild){this.removeChild(this.firstChild).destroy();}
this.childrenRendered=false;this.loaded=false;if(this.isHiddenRoot()){this.expanded=false;}
this.expand(false,false,callback,scope);}});Ext.tree.TreePanel.nodeTypes.async=Ext.tree.AsyncTreeNode;Ext.tree.TreeNodeUI=function(node){this.node=node;this.rendered=false;this.animating=false;this.wasLeaf=true;this.ecc='x-tree-ec-icon x-tree-elbow';this.emptyIcon=Ext.BLANK_IMAGE_URL;};Ext.tree.TreeNodeUI.prototype={removeChild:function(node){if(this.rendered){this.ctNode.removeChild(node.ui.getEl());}},beforeLoad:function(){this.addClass("x-tree-node-loading");},afterLoad:function(){this.removeClass("x-tree-node-loading");},onTextChange:function(node,text,oldText){if(this.rendered){this.textNode.innerHTML=text;}},onDisableChange:function(node,state){this.disabled=state;if(this.checkbox){this.checkbox.disabled=state;}
if(state){this.addClass("x-tree-node-disabled");}else{this.removeClass("x-tree-node-disabled");}},onSelectedChange:function(state){if(state){this.focus();this.addClass("x-tree-selected");}else{this.removeClass("x-tree-selected");}},onMove:function(tree,node,oldParent,newParent,index,refNode){this.childIndent=null;if(this.rendered){var targetNode=newParent.ui.getContainer();if(!targetNode){this.holder=document.createElement("div");this.holder.appendChild(this.wrap);return;}
var insertBefore=refNode?refNode.ui.getEl():null;if(insertBefore){targetNode.insertBefore(this.wrap,insertBefore);}else{targetNode.appendChild(this.wrap);}
this.node.renderIndent(true,oldParent!=newParent);}},addClass:function(cls){if(this.elNode){Ext.fly(this.elNode).addClass(cls);}},removeClass:function(cls){if(this.elNode){Ext.fly(this.elNode).removeClass(cls);}},remove:function(){if(this.rendered){this.holder=document.createElement("div");this.holder.appendChild(this.wrap);}},fireEvent:function(){return this.node.fireEvent.apply(this.node,arguments);},initEvents:function(){this.node.on("move",this.onMove,this);if(this.node.disabled){this.onDisableChange(this.node,true);}
if(this.node.hidden){this.hide();}
var ot=this.node.getOwnerTree();var dd=ot.enableDD||ot.enableDrag||ot.enableDrop;if(dd&&(!this.node.isRoot||ot.rootVisible)){Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false});}},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode];},hide:function(){this.node.hidden=true;if(this.wrap){this.wrap.style.display="none";}},show:function(){this.node.hidden=false;if(this.wrap){this.wrap.style.display="";}},onContextMenu:function(e){if(this.node.hasListener("contextmenu")||this.node.getOwnerTree().hasListener("contextmenu")){e.preventDefault();this.focus();this.fireEvent("contextmenu",this.node,e);}},onClick:function(e){if(this.dropping){e.stopEvent();return;}
if(this.fireEvent("beforeclick",this.node,e)!==false){var a=e.getTarget('a');if(!this.disabled&&this.node.attributes.href&&a){this.fireEvent("click",this.node,e);return;}else if(a&&e.ctrlKey){e.stopEvent();}
e.preventDefault();if(this.disabled){return;}
if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){this.node.toggle();}
this.fireEvent("click",this.node,e);}else{e.stopEvent();}},onDblClick:function(e){e.preventDefault();if(this.disabled){return;}
if(this.fireEvent("beforedblclick",this.node,e)!==false){if(this.checkbox){this.toggleCheck();}
if(!this.animating&&this.node.isExpandable()){this.node.toggle();}
this.fireEvent("dblclick",this.node,e);}},onOver:function(e){this.addClass('x-tree-node-over');},onOut:function(e){this.removeClass('x-tree-node-over');},onCheckChange:function(){var checked=this.checkbox.checked;this.checkbox.defaultChecked=checked;this.node.attributes.checked=checked;this.fireEvent('checkchange',this.node,checked);},ecClick:function(e){if(!this.animating&&this.node.isExpandable()){this.node.toggle();}},startDrop:function(){this.dropping=true;},endDrop:function(){setTimeout(function(){this.dropping=false;}.createDelegate(this),50);},expand:function(){this.updateExpandIcon();this.ctNode.style.display="";},focus:function(){if(!this.node.preventHScroll){try{this.anchor.focus();}catch(e){}}else{try{var noscroll=this.node.getOwnerTree().getTreeEl().dom;var l=noscroll.scrollLeft;this.anchor.focus();noscroll.scrollLeft=l;}catch(e){}}},toggleCheck:function(value){var cb=this.checkbox;if(cb){cb.checked=(value===undefined?!cb.checked:value);this.onCheckChange();}},blur:function(){try{this.anchor.blur();}catch(e){}},animExpand:function(callback){var ct=Ext.get(this.ctNode);ct.stopFx();if(!this.node.isExpandable()){this.updateExpandIcon();this.ctNode.style.display="";Ext.callback(callback);return;}
this.animating=true;this.updateExpandIcon();ct.slideIn('t',{callback:function(){this.animating=false;Ext.callback(callback);},scope:this,duration:this.node.ownerTree.duration||.25});},highlight:function(){var tree=this.node.getOwnerTree();Ext.fly(this.wrap).highlight(tree.hlColor||"C3DAF9",{endColor:tree.hlBaseColor});},collapse:function(){this.updateExpandIcon();this.ctNode.style.display="none";},animCollapse:function(callback){var ct=Ext.get(this.ctNode);ct.enableDisplayMode('block');ct.stopFx();this.animating=true;this.updateExpandIcon();ct.slideOut('t',{callback:function(){this.animating=false;Ext.callback(callback);},scope:this,duration:this.node.ownerTree.duration||.25});},getContainer:function(){return this.ctNode;},getEl:function(){return this.wrap;},appendDDGhost:function(ghostNode){ghostNode.appendChild(this.elNode.cloneNode(true));},getDDRepairXY:function(){return Ext.lib.Dom.getXY(this.iconNode);},onRender:function(){this.render();},render:function(bulkRender){var n=this.node,a=n.attributes;var targetNode=n.parentNode?n.parentNode.ui.getContainer():n.ownerTree.innerCt.dom;if(!this.rendered){this.rendered=true;this.renderElements(n,a,targetNode,bulkRender);if(a.qtip){if(this.textNode.setAttributeNS){this.textNode.setAttributeNS("ext","qtip",a.qtip);if(a.qtipTitle){this.textNode.setAttributeNS("ext","qtitle",a.qtipTitle);}}else{this.textNode.setAttribute("ext:qtip",a.qtip);if(a.qtipTitle){this.textNode.setAttribute("ext:qtitle",a.qtipTitle);}}}else if(a.qtipCfg){a.qtipCfg.target=Ext.id(this.textNode);Ext.QuickTips.register(a.qtipCfg);}
this.initEvents();if(!this.node.expanded){this.updateExpandIcon(true);}}else{if(bulkRender===true){targetNode.appendChild(this.wrap);}}},renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var cb=Ext.isBoolean(a.checked),nel,href=a.href?a.href:Ext.isGecko?"":"#",buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',a.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" />',cb?('<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/>')):'','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",'><span unselectable="on">',n.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&(nel=n.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",nel,buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[3];this.checkbox.defaultChecked=this.checkbox.checked;index++;}
this.anchor=cs[index];this.textNode=cs[index].firstChild;},getAnchor:function(){return this.anchor;},getTextEl:function(){return this.textNode;},getIconEl:function(){return this.iconNode;},isChecked:function(){return this.checkbox?this.checkbox.checked:false;},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2,cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow",hasChild=n.hasChildNodes();if(hasChild||n.attributes.expandable){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded";}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed";}
if(this.wasLeaf){this.removeClass("x-tree-node-leaf");this.wasLeaf=false;}
if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2;}}else{if(!this.wasLeaf){Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-collapsed");delete this.c1;delete this.c2;this.wasLeaf=true;}}
var ecc="x-tree-ec-icon "+cls;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc;}}},onIdChange:function(id){if(this.rendered){this.elNode.setAttribute('ext:tree-node-id',id);}},getChildIndent:function(){if(!this.childIndent){var buf=[],p=this.node;while(p){if(!p.isRoot||(p.isRoot&&p.ownerTree.rootVisible)){if(!p.isLast()){buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-elbow-line" />');}else{buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-icon" />');}}
p=p.parentNode;}
this.childIndent=buf.join("");}
return this.childIndent;},renderIndent:function(){if(this.rendered){var indent="",p=this.node.parentNode;if(p){indent=p.ui.getChildIndent();}
if(this.indentMarkup!=indent){this.indentNode.innerHTML=indent;this.indentMarkup=indent;}
this.updateExpandIcon();}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id);}
Ext.each(['textnode','anchor','checkbox','indentNode','ecNode','iconNode','elNode','ctNode','wrap','holder'],function(el){if(this[el]){Ext.fly(this[el]).remove();delete this[el];}},this);delete this.node;}};Ext.tree.RootTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{render:function(){if(!this.rendered){var targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:Ext.emptyFn,expand:Ext.emptyFn});Ext.tree.TreeLoader=function(config){this.baseParams={};Ext.apply(this,config);this.addEvents("beforeload","load","loadexception");Ext.tree.TreeLoader.superclass.constructor.call(this);if(Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/);}};Ext.extend(Ext.tree.TreeLoader,Ext.util.Observable,{uiProviders:{},clearOnLoad:true,paramOrder:undefined,paramsAsHash:false,nodeParameter:'node',directFn:undefined,load:function(node,callback,scope){if(this.clearOnLoad){while(node.firstChild){node.removeChild(node.firstChild);}}
if(this.doPreload(node)){this.runCallback(callback,scope||node,[node]);}else if(this.directFn||this.dataUrl||this.url){this.requestData(node,callback,scope||node);}},doPreload:function(node){if(node.attributes.children){if(node.childNodes.length<1){var cs=node.attributes.children;node.beginUpdate();for(var i=0,len=cs.length;i<len;i++){var cn=node.appendChild(this.createNode(cs[i]));if(this.preloadChildren){this.doPreload(cn);}}
node.endUpdate();}
return true;}
return false;},getParams:function(node){var bp=Ext.apply({},this.baseParams),np=this.nodeParameter,po=this.paramOrder;np&&(bp[np]=node.id);if(this.directFn){var buf=[node.id];if(po){if(np&&po.indexOf(np)>-1){buf=[];}
for(var i=0,len=po.length;i<len;i++){buf.push(bp[po[i]]);}}else if(this.paramsAsHash){buf=[bp];}
return buf;}else{return bp;}},requestData:function(node,callback,scope){if(this.fireEvent("beforeload",this,node,callback)!==false){if(this.directFn){var args=this.getParams(node);args.push(this.processDirectResponse.createDelegate(this,[{callback:callback,node:node,scope:scope}],true));this.directFn.apply(window,args);}else{this.transId=Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:callback,node:node,scope:scope},params:this.getParams(node)});}}else{this.runCallback(callback,scope||node,[]);}},processDirectResponse:function(result,response,args){if(response.status){this.handleResponse({responseData:Ext.isArray(result)?result:null,responseText:result,argument:args});}else{this.handleFailure({argument:args});}},runCallback:function(cb,scope,args){if(Ext.isFunction(cb)){cb.apply(scope,args);}},isLoading:function(){return!!this.transId;},abort:function(){if(this.isLoading()){Ext.Ajax.abort(this.transId);}},createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs);}
if(this.applyLoader!==false&&!attr.loader){attr.loader=this;}
if(Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}
if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr);}},processResponse:function(response,node,callback,scope){var json=response.responseText;try{var o=response.responseData||Ext.decode(json);node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n);}}
node.endUpdate();this.runCallback(callback,scope||node,[node]);}catch(e){this.handleFailure(response);}},handleResponse:function(response){this.transId=false;var a=response.argument;this.processResponse(response,a.node,a.callback,a.scope);this.fireEvent("load",this,a.node,response);},handleFailure:function(response){this.transId=false;var a=response.argument;this.fireEvent("loadexception",this,a.node,response);this.runCallback(a.callback,a.scope||a.node,[a.node]);},destroy:function(){this.abort();this.purgeListeners();}});Ext.tree.TreeFilter=function(tree,config){this.tree=tree;this.filtered={};Ext.apply(this,config);};Ext.tree.TreeFilter.prototype={clearBlank:false,reverse:false,autoClear:false,remove:false,filter:function(value,attr,startNode){attr=attr||"text";var f;if(typeof value=="string"){var vlen=value.length;if(vlen==0&&this.clearBlank){this.clear();return;}
value=value.toLowerCase();f=function(n){return n.attributes[attr].substr(0,vlen).toLowerCase()==value;};}else if(value.exec){f=function(n){return value.test(n.attributes[attr]);};}else{throw'Illegal filter type, must be string or regex';}
this.filterBy(f,null,startNode);},filterBy:function(fn,scope,startNode){startNode=startNode||this.tree.root;if(this.autoClear){this.clear();}
var af=this.filtered,rv=this.reverse;var f=function(n){if(n==startNode){return true;}
if(af[n.id]){return false;}
var m=fn.call(scope||n,n);if(!m||rv){af[n.id]=n;n.ui.hide();return false;}
return true;};startNode.cascade(f);if(this.remove){for(var id in af){if(typeof id!="function"){var n=af[id];if(n&&n.parentNode){n.parentNode.removeChild(n);}}}}},clear:function(){var t=this.tree;var af=this.filtered;for(var id in af){if(typeof id!="function"){var n=af[id];if(n){n.ui.show();}}}
this.filtered={};}};Ext.tree.TreeSorter=function(tree,config){Ext.apply(this,config);tree.on("beforechildrenrendered",this.doSort,this);tree.on("append",this.updateSort,this);tree.on("insert",this.updateSort,this);tree.on("textchange",this.updateSortParent,this);var dsc=this.dir&&this.dir.toLowerCase()=="desc";var p=this.property||"text";var sortType=this.sortType;var fs=this.folderSort;var cs=this.caseSensitive===true;var leafAttr=this.leafAttr||'leaf';this.sortFn=function(n1,n2){if(fs){if(n1.attributes[leafAttr]&&!n2.attributes[leafAttr]){return 1;}
if(!n1.attributes[leafAttr]&&n2.attributes[leafAttr]){return-1;}}
var v1=sortType?sortType(n1):(cs?n1.attributes[p]:n1.attributes[p].toUpperCase());var v2=sortType?sortType(n2):(cs?n2.attributes[p]:n2.attributes[p].toUpperCase());if(v1<v2){return dsc?+1:-1;}else if(v1>v2){return dsc?-1:+1;}else{return 0;}};};Ext.tree.TreeSorter.prototype={doSort:function(node){node.sort(this.sortFn);},compareNodes:function(n1,n2){return(n1.text.toUpperCase()>n2.text.toUpperCase()?1:-1);},updateSort:function(tree,node){if(node.childrenRendered){this.doSort.defer(1,this,[node]);}},updateSortParent:function(node){var p=node.parentNode;if(p&&p.childrenRendered){this.doSort.defer(1,this,[p]);}}};if(Ext.dd.DropZone){Ext.tree.TreeDropZone=function(tree,config){this.allowParentInsert=config.allowParentInsert||false;this.allowContainerDrop=config.allowContainerDrop||false;this.appendOnly=config.appendOnly||false;Ext.tree.TreeDropZone.superclass.constructor.call(this,tree.getTreeEl(),config);this.tree=tree;this.dragOverData={};this.lastInsertClass="x-tree-no-status";};Ext.extend(Ext.tree.TreeDropZone,Ext.dd.DropZone,{ddGroup:"TreeDD",expandDelay:1000,expandNode:function(node){if(node.hasChildNodes()&&!node.isExpanded()){node.expand(false,null,this.triggerCacheRefresh.createDelegate(this));}},queueExpand:function(node){this.expandProcId=this.expandNode.defer(this.expandDelay,this,[node]);},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId);this.expandProcId=false;}},isValidDropPoint:function(n,pt,dd,e,data){if(!n||!data){return false;}
var targetNode=n.node;var dropNode=data.node;if(!(targetNode&&targetNode.isTarget&&pt)){return false;}
if(pt=="append"&&targetNode.allowChildren===false){return false;}
if((pt=="above"||pt=="below")&&(targetNode.parentNode&&targetNode.parentNode.allowChildren===false)){return false;}
if(dropNode&&(targetNode==dropNode||dropNode.contains(targetNode))){return false;}
var overEvent=this.dragOverData;overEvent.tree=this.tree;overEvent.target=targetNode;overEvent.data=data;overEvent.point=pt;overEvent.source=dd;overEvent.rawEvent=e;overEvent.dropNode=dropNode;overEvent.cancel=false;var result=this.tree.fireEvent("nodedragover",overEvent);return overEvent.cancel===false&&result!==false;},getDropPoint:function(e,n,dd){var tn=n.node;if(tn.isRoot){return tn.allowChildren!==false?"append":false;}
var dragEl=n.ddel;var t=Ext.lib.Dom.getY(dragEl),b=t+dragEl.offsetHeight;var y=Ext.lib.Event.getPageY(e);var noAppend=tn.allowChildren===false||tn.isLeaf();if(this.appendOnly||tn.parentNode.allowChildren===false){return noAppend?false:"append";}
var noBelow=false;if(!this.allowParentInsert){noBelow=tn.hasChildNodes()&&tn.isExpanded();}
var q=(b-t)/(noAppend?2:3);if(y>=t&&y<(t+q)){return"above";}else if(!noBelow&&(noAppend||y>=b-q&&y<=b)){return"below";}else{return"append";}},onNodeEnter:function(n,dd,e,data){this.cancelExpand();},onContainerOver:function(dd,e,data){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",dd,e,data)){return this.dropAllowed;}
return this.dropNotAllowed;},onNodeOver:function(n,dd,e,data){var pt=this.getDropPoint(e,n,dd);var node=n.node;if(!this.expandProcId&&pt=="append"&&node.hasChildNodes()&&!n.node.isExpanded()){this.queueExpand(node);}else if(pt!="append"){this.cancelExpand();}
var returnCls=this.dropNotAllowed;if(this.isValidDropPoint(n,pt,dd,e,data)){if(pt){var el=n.ddel;var cls;if(pt=="above"){returnCls=n.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";cls="x-tree-drag-insert-above";}else if(pt=="below"){returnCls=n.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";cls="x-tree-drag-insert-below";}else{returnCls="x-tree-drop-ok-append";cls="x-tree-drag-append";}
if(this.lastInsertClass!=cls){Ext.fly(el).replaceClass(this.lastInsertClass,cls);this.lastInsertClass=cls;}}}
return returnCls;},onNodeOut:function(n,dd,e,data){this.cancelExpand();this.removeDropIndicators(n);},onNodeDrop:function(n,dd,e,data){var point=this.getDropPoint(e,n,dd);var targetNode=n.node;targetNode.ui.startDrop();if(!this.isValidDropPoint(n,point,dd,e,data)){targetNode.ui.endDrop();return false;}
var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,point,e):null);return this.processDrop(targetNode,data,point,dd,e,dropNode);},onContainerDrop:function(dd,e,data){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",dd,e,data)){var targetNode=this.tree.getRootNode();targetNode.ui.startDrop();var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,'append',e):null);return this.processDrop(targetNode,data,'append',dd,e,dropNode);}
return false;},processDrop:function(target,data,point,dd,e,dropNode){var dropEvent={tree:this.tree,target:target,data:data,point:point,source:dd,rawEvent:e,dropNode:dropNode,cancel:!dropNode,dropStatus:false};var retval=this.tree.fireEvent("beforenodedrop",dropEvent);if(retval===false||dropEvent.cancel===true||!dropEvent.dropNode){target.ui.endDrop();return dropEvent.dropStatus;}
target=dropEvent.target;if(point=='append'&&!target.isExpanded()){target.expand(false,null,function(){this.completeDrop(dropEvent);}.createDelegate(this));}else{this.completeDrop(dropEvent);}
return true;},completeDrop:function(de){var ns=de.dropNode,p=de.point,t=de.target;if(!Ext.isArray(ns)){ns=[ns];}
var n;for(var i=0,len=ns.length;i<len;i++){n=ns[i];if(p=="above"){t.parentNode.insertBefore(n,t);}else if(p=="below"){t.parentNode.insertBefore(n,t.nextSibling);}else{t.appendChild(n);}}
n.ui.focus();if(Ext.enableFx&&this.tree.hlDrop){n.ui.highlight();}
t.ui.endDrop();this.tree.fireEvent("nodedrop",de);},afterNodeMoved:function(dd,data,e,targetNode,dropNode){if(Ext.enableFx&&this.tree.hlDrop){dropNode.ui.focus();dropNode.ui.highlight();}
this.tree.fireEvent("nodedrop",this.tree,targetNode,data,dd,e);},getTree:function(){return this.tree;},removeDropIndicators:function(n){if(n&&n.ddel){var el=n.ddel;Ext.fly(el).removeClass(["x-tree-drag-insert-above","x-tree-drag-insert-below","x-tree-drag-append"]);this.lastInsertClass="_noclass";}},beforeDragDrop:function(target,e,id){this.cancelExpand();return true;},afterRepair:function(data){if(data&&Ext.enableFx){data.node.ui.highlight();}
this.hideProxy();}});}
if(Ext.dd.DragZone){Ext.tree.TreeDragZone=function(tree,config){Ext.tree.TreeDragZone.superclass.constructor.call(this,tree.innerCt,config);this.tree=tree;};Ext.extend(Ext.tree.TreeDragZone,Ext.dd.DragZone,{ddGroup:"TreeDD",onBeforeDrag:function(data,e){var n=data.node;return n&&n.draggable&&!n.disabled;},onInitDrag:function(e){var data=this.dragData;this.tree.getSelectionModel().select(data.node);this.tree.eventModel.disable();this.proxy.update("");data.node.ui.appendDDGhost(this.proxy.ghost.dom);this.tree.fireEvent("startdrag",this.tree,data.node,e);},getRepairXY:function(e,data){return data.node.ui.getDDRepairXY();},onEndDrag:function(data,e){this.tree.eventModel.enable.defer(100,this.tree.eventModel);this.tree.fireEvent("enddrag",this.tree,data.node,e);},onValidDrop:function(dd,e,id){this.tree.fireEvent("dragdrop",this.tree,this.dragData.node,dd,e);this.hideProxy();},beforeInvalidDrop:function(e,id){var sm=this.tree.getSelectionModel();sm.clearSelections();sm.select(this.dragData.node);},afterRepair:function(){if(Ext.enableFx&&this.tree.hlDrop){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9");}
this.dragging=false;}});}
Ext.tree.TreeEditor=function(tree,fc,config){fc=fc||{};var field=fc.events?fc:new Ext.form.TextField(fc);Ext.tree.TreeEditor.superclass.constructor.call(this,field,config);this.tree=tree;if(!tree.rendered){tree.on('render',this.initEditor,this);}else{this.initEditor(tree);}};Ext.extend(Ext.tree.TreeEditor,Ext.Editor,{alignment:"l-l",autoSize:false,hideEl:false,cls:"x-small-editor x-tree-editor",shim:false,shadow:"frame",maxWidth:250,editDelay:350,initEditor:function(tree){tree.on({scope:this,beforeclick:this.beforeNodeClick,dblclick:this.onNodeDblClick});this.on({scope:this,complete:this.updateNode,beforestartedit:this.fitToTree,specialkey:this.onSpecialKey});this.on('startedit',this.bindScroll,this,{delay:10});},fitToTree:function(ed,el){var td=this.tree.getTreeEl().dom,nd=el.dom;if(td.scrollLeft>nd.offsetLeft){td.scrollLeft=nd.offsetLeft;}
var w=Math.min(this.maxWidth,(td.clientWidth>20?td.clientWidth:td.offsetWidth)-Math.max(0,nd.offsetLeft-td.scrollLeft)-5);this.setSize(w,'');},triggerEdit:function(node,defer){this.completeEdit();if(node.attributes.editable!==false){this.editNode=node;if(this.tree.autoScroll){Ext.fly(node.ui.getEl()).scrollIntoView(this.tree.body);}
var value=node.text||'';if(!Ext.isGecko&&Ext.isEmpty(node.text)){node.setText('&#160;');}
this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[node.ui.textNode,value]);return false;}},bindScroll:function(){this.tree.getTreeEl().on('scroll',this.cancelEdit,this);},beforeNodeClick:function(node,e){clearTimeout(this.autoEditTimer);if(this.tree.getSelectionModel().isSelected(node)){e.stopEvent();return this.triggerEdit(node);}},onNodeDblClick:function(node,e){clearTimeout(this.autoEditTimer);},updateNode:function(ed,value){this.tree.getTreeEl().un('scroll',this.cancelEdit,this);this.editNode.setText(value);},onHide:function(){Ext.tree.TreeEditor.superclass.onHide.call(this);if(this.editNode){this.editNode.ui.focus.defer(50,this.editNode.ui);}},onSpecialKey:function(field,e){var k=e.getKey();if(k==e.ESC){e.stopEvent();this.cancelEdit();}else if(k==e.ENTER&&!e.hasModifier()){e.stopEvent();this.completeEdit();}},onDestroy:function(){clearTimeout(this.autoEditTimer);Ext.tree.TreeEditor.superclass.onDestroy.call(this);var tree=this.tree;tree.un('beforeclick',this.beforeNodeClick,this);tree.un('dblclick',this.onNodeDblClick,this);}});var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}
else if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}}
catch(e){}}
return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac};}(),onDomLoad=function(){if(!ua.w3){return;}
if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions();}
if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false);}
if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions();}});if(win==top){(function(){if(isDomLoaded){return;}
try{doc.documentElement.doScroll("left");}
catch(e){setTimeout(arguments.callee,0);return;}
callDomLoadFunctions();})();}}
if(ua.wk){(function(){if(isDomLoaded){return;}
if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return;}
callDomLoadFunctions();})();}
addLoadEvent(callDomLoadFunctions);}}();function callDomLoadFunctions(){if(isDomLoaded){return;}
try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t);}
catch(e){return;}
isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]();}}
function addDomLoadEvent(fn){if(isDomLoaded){fn();}
else{domLoadFnArr[domLoadFnArr.length]=fn;}}
function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false);}
else if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false);}
else if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn);}
else if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn();};}
else{win.onload=fn;}}
function main(){if(plugin){testPlayerVersion();}
else{matchVersions();}}
function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}
else if(counter<10){counter++;setTimeout(arguments.callee,10);return;}
b.removeChild(o);t=null;matchVersions();})();}
else{matchVersions();}}
function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj);}}
else if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class");}
if(obj.getAttribute("align")){att.align=obj.getAttribute("align");}
var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value");}}
showExpressInstall(att,par,id,cb);}
else{displayAltContent(obj);if(cb){cb(cbObj);}}}}
else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o;}
cb(cbObj);}}}}}
function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o;}
else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n;}}}
return r;}
function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312);}
function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null;}
else{storedAltContent=obj;storedAltContentId=replaceElemIdStr;}
att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310";}
if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137";}
doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv;}
else{par.flashvars=fv;}
if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
createSWF(att,par,replaceElemIdStr);}}
function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.replaceChild(abstractAltContent(obj),obj);}}
function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML;}
else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true));}}}}}
return ac;}
function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r;}
if(el){if(typeof attObj.id==UNDEF){attObj.id=id;}
if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i];}
else if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"';}
else if(i.toLowerCase()!="classid"){att+=' '+i+'="'+attObj[i]+'"';}}}
var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />';}}
el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+'>'+par+'</object>';objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id);}
else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m]);}
else if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m]);}}}
for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n]);}}
el.parentNode.replaceChild(o,el);r=o;}}
return r;}
function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p);}
function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.removeChild(obj);}}}
function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null;}}
obj.parentNode.removeChild(obj);}}
function getElementById(id){var el=null;try{el=doc.getElementById(id);}
catch(e){}
return el;}
function createElement(el){return doc.createElement(el);}
function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn];}
function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false;}
function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return;}
var h=doc.getElementsByTagName("head")[0];if(!h){return;}
var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null;}
if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1];}
dynamicStylesheetMedia=m;}
if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl);}}
else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"));}}}
function setVisibility(id,isVisible){if(!autoHideShow){return;}
var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v;}
else{createCSS("#"+id,"visibility:"+v);}}
function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s;}
var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);}
var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j]);}
for(var k in ua){ua[k]=null;}
ua=null;for(var l in swfobject){swfobject[l]=null;}
swfobject=null;});}}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false);}
else if(callbackFn){callbackFn({success:false,id:objectIdStr});}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr);}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i];}}
att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j];}}
if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k];}
else{par.flashvars=k+"="+flashvarsObj[k];}}}
if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true);}
callbackObj.success=true;callbackObj.ref=obj;}
else if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return;}
else{setVisibility(replaceElemIdStr,true);}
if(callbackFn){callbackFn(callbackObj);}});}
else if(callbackFn){callbackFn(callbackObj);}},switchOffAutoHideShow:function(){autoHideShow=false;},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]};},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr);}
else{return undefined;}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn);}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr);}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean);}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1];}
if(param==null){return urlEncodeIfNecessary(q);}
var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)));}}}
return"";},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block";}}
if(storedCallbackFn){storedCallbackFn(storedCallbackObj);}}
isExpressInstallActive=false;}}};}();Ext.FlashComponent=Ext.extend(Ext.BoxComponent,{flashVersion:'9.0.115',backgroundColor:'#ffffff',wmode:'opaque',flashVars:undefined,flashParams:undefined,url:undefined,swfId:undefined,swfWidth:'100%',swfHeight:'100%',expressInstall:false,initComponent:function(){Ext.FlashComponent.superclass.initComponent.call(this);this.addEvents('initialize');},onRender:function(){Ext.FlashComponent.superclass.onRender.apply(this,arguments);var params=Ext.apply({allowScriptAccess:'always',bgcolor:this.backgroundColor,wmode:this.wmode},this.flashParams),vars=Ext.apply({allowedDomain:document.location.hostname,YUISwfId:this.getId(),YUIBridgeCallback:'Ext.FlashEventProxy.onEvent'},this.flashVars);new swfobject.embedSWF(this.url,this.id,this.swfWidth,this.swfHeight,this.flashVersion,this.expressInstall?Ext.FlashComponent.EXPRESS_INSTALL_URL:undefined,vars,params);this.swf=Ext.getDom(this.id);this.el=Ext.get(this.swf);},getSwfId:function(){return this.swfId||(this.swfId="extswf"+(++Ext.Component.AUTO_ID));},getId:function(){return this.id||(this.id="extflashcmp"+(++Ext.Component.AUTO_ID));},onFlashEvent:function(e){switch(e.type){case"swfReady":this.initSwf();return;case"log":return;}
e.component=this;this.fireEvent(e.type.toLowerCase().replace(/event$/,''),e);},initSwf:function(){this.onSwfReady(!!this.isInitialized);this.isInitialized=true;this.fireEvent('initialize',this);},beforeDestroy:function(){if(this.rendered){swfobject.removeSWF(this.swf.id);}
Ext.FlashComponent.superclass.beforeDestroy.call(this);},onSwfReady:Ext.emptyFn});Ext.FlashComponent.EXPRESS_INSTALL_URL='http:/'+'/swfobject.googlecode.com/svn/trunk/swfobject/expressInstall.swf';Ext.reg('flash',Ext.FlashComponent);Ext.FlashEventProxy={onEvent:function(id,e){var fp=Ext.getCmp(id);if(fp){fp.onFlashEvent(e);}else{arguments.callee.defer(10,this,[id,e]);}}};Ext.chart.Chart=Ext.extend(Ext.FlashComponent,{refreshBuffer:100,chartStyle:{padding:10,animationEnabled:true,font:{name:'Tahoma',color:0x444444,size:11},dataTip:{padding:5,border:{color:0x99bbe8,size:1},background:{color:0xDAE7F6,alpha:.9},font:{name:'Tahoma',color:0x15428B,size:10,bold:true}}},extraStyle:null,seriesStyles:null,disableCaching:Ext.isIE||Ext.isOpera,disableCacheParam:'_dc',initComponent:function(){Ext.chart.Chart.superclass.initComponent.call(this);if(!this.url){this.url=Ext.chart.Chart.CHART_URL;}
if(this.disableCaching){this.url=Ext.urlAppend(this.url,String.format('{0}={1}',this.disableCacheParam,new Date().getTime()));}
this.addEvents('itemmouseover','itemmouseout','itemclick','itemdoubleclick','itemdragstart','itemdrag','itemdragend','beforerefresh','refresh');this.store=Ext.StoreMgr.lookup(this.store);},setStyle:function(name,value){this.swf.setStyle(name,Ext.encode(value));},setStyles:function(styles){this.swf.setStyles(Ext.encode(styles));},setSeriesStyles:function(styles){this.seriesStyles=styles;var s=[];Ext.each(styles,function(style){s.push(Ext.encode(style));});this.swf.setSeriesStyles(s);},setCategoryNames:function(names){this.swf.setCategoryNames(names);},setLegendRenderer:function(fn,scope){var chart=this;scope=scope||chart;chart.removeFnProxy(chart.legendFnName);chart.legendFnName=chart.createFnProxy(function(name){return fn.call(scope,name);});chart.swf.setLegendLabelFunction(chart.legendFnName);},setTipRenderer:function(fn,scope){var chart=this;scope=scope||chart;chart.removeFnProxy(chart.tipFnName);chart.tipFnName=chart.createFnProxy(function(item,index,series){var record=chart.store.getAt(index);return fn.call(scope,chart,record,index,series);});chart.swf.setDataTipFunction(chart.tipFnName);},setSeries:function(series){this.series=series;this.refresh();},bindStore:function(store,initial){if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy();}else{this.store.un("datachanged",this.refresh,this);this.store.un("add",this.delayRefresh,this);this.store.un("remove",this.delayRefresh,this);this.store.un("update",this.delayRefresh,this);this.store.un("clear",this.refresh,this);}}
if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,datachanged:this.refresh,add:this.delayRefresh,remove:this.delayRefresh,update:this.delayRefresh,clear:this.refresh});}
this.store=store;if(store&&!initial){this.refresh();}},onSwfReady:function(isReset){Ext.chart.Chart.superclass.onSwfReady.call(this,isReset);var ref;this.swf.setType(this.type);if(this.chartStyle){this.setStyles(Ext.apply({},this.extraStyle,this.chartStyle));}
if(this.categoryNames){this.setCategoryNames(this.categoryNames);}
if(this.tipRenderer){ref=this.getFunctionRef(this.tipRenderer);this.setTipRenderer(ref.fn,ref.scope);}
if(this.legendRenderer){ref=this.getFunctionRef(this.legendRenderer);this.setLegendRenderer(ref.fn,ref.scope);}
if(!isReset){this.bindStore(this.store,true);}
this.refresh.defer(10,this);},delayRefresh:function(){if(!this.refreshTask){this.refreshTask=new Ext.util.DelayedTask(this.refresh,this);}
this.refreshTask.delay(this.refreshBuffer);},refresh:function(){if(this.fireEvent('beforerefresh',this)!==false){var styleChanged=false;var data=[],rs=this.store.data.items;for(var j=0,len=rs.length;j<len;j++){data[j]=rs[j].data;}
var dataProvider=[];var seriesCount=0;var currentSeries=null;var i=0;if(this.series){seriesCount=this.series.length;for(i=0;i<seriesCount;i++){currentSeries=this.series[i];var clonedSeries={};for(var prop in currentSeries){if(prop=="style"&&currentSeries.style!==null){clonedSeries.style=Ext.encode(currentSeries.style);styleChanged=true;}else{clonedSeries[prop]=currentSeries[prop];}}
dataProvider.push(clonedSeries);}}
if(seriesCount>0){for(i=0;i<seriesCount;i++){currentSeries=dataProvider[i];if(!currentSeries.type){currentSeries.type=this.type;}
currentSeries.dataProvider=data;}}else{dataProvider.push({type:this.type,dataProvider:data});}
this.swf.setDataProvider(dataProvider);if(this.seriesStyles){this.setSeriesStyles(this.seriesStyles);}
this.fireEvent('refresh',this);}},createFnProxy:function(fn){var fnName='extFnProxy'+(++Ext.chart.Chart.PROXY_FN_ID);Ext.chart.Chart.proxyFunction[fnName]=fn;return'Ext.chart.Chart.proxyFunction.'+fnName;},removeFnProxy:function(fn){if(!Ext.isEmpty(fn)){fn=fn.replace('Ext.chart.Chart.proxyFunction.','');delete Ext.chart.Chart.proxyFunction[fn];}},getFunctionRef:function(val){if(Ext.isFunction(val)){return{fn:val,scope:this};}else{return{fn:val.fn,scope:val.scope||this}}},onDestroy:function(){if(this.refreshTask&&this.refreshTask.cancel){this.refreshTask.cancel();}
Ext.chart.Chart.superclass.onDestroy.call(this);this.bindStore(null);this.removeFnProxy(this.tipFnName);this.removeFnProxy(this.legendFnName);}});Ext.reg('chart',Ext.chart.Chart);Ext.chart.Chart.PROXY_FN_ID=0;Ext.chart.Chart.proxyFunction={};Ext.chart.Chart.CHART_URL='http:/'+'/yui.yahooapis.com/2.8.0/build/charts/assets/charts.swf';Ext.chart.PieChart=Ext.extend(Ext.chart.Chart,{type:'pie',onSwfReady:function(isReset){Ext.chart.PieChart.superclass.onSwfReady.call(this,isReset);this.setDataField(this.dataField);this.setCategoryField(this.categoryField);},setDataField:function(field){this.dataField=field;this.swf.setDataField(field);},setCategoryField:function(field){this.categoryField=field;this.swf.setCategoryField(field);}});Ext.reg('piechart',Ext.chart.PieChart);Ext.chart.CartesianChart=Ext.extend(Ext.chart.Chart,{onSwfReady:function(isReset){Ext.chart.CartesianChart.superclass.onSwfReady.call(this,isReset);this.labelFn=[];if(this.xField){this.setXField(this.xField);}
if(this.yField){this.setYField(this.yField);}
if(this.xAxis){this.setXAxis(this.xAxis);}
if(this.xAxes){this.setXAxes(this.xAxes);}
if(this.yAxis){this.setYAxis(this.yAxis);}
if(this.yAxes){this.setYAxes(this.yAxes);}
if(Ext.isDefined(this.constrainViewport)){this.swf.setConstrainViewport(this.constrainViewport);}},setXField:function(value){this.xField=value;this.swf.setHorizontalField(value);},setYField:function(value){this.yField=value;this.swf.setVerticalField(value);},setXAxis:function(value){this.xAxis=this.createAxis('xAxis',value);this.swf.setHorizontalAxis(this.xAxis);},setXAxes:function(value){var axis;for(var i=0;i<value.length;i++){axis=this.createAxis('xAxis'+i,value[i]);this.swf.setHorizontalAxis(axis);}},setYAxis:function(value){this.yAxis=this.createAxis('yAxis',value);this.swf.setVerticalAxis(this.yAxis);},setYAxes:function(value){var axis;for(var i=0;i<value.length;i++){axis=this.createAxis('yAxis'+i,value[i]);this.swf.setVerticalAxis(axis);}},createAxis:function(axis,value){var o=Ext.apply({},value),ref,old;if(this[axis]){old=this[axis].labelFunction;this.removeFnProxy(old);this.labelFn.remove(old);}
if(o.labelRenderer){ref=this.getFunctionRef(o.labelRenderer);o.labelFunction=this.createFnProxy(function(v){return ref.fn.call(ref.scope,v);});delete o.labelRenderer;this.labelFn.push(o.labelFunction);}
if(axis.indexOf('xAxis')>-1&&o.position=='left'){o.position='bottom';}
return o;},onDestroy:function(){Ext.chart.CartesianChart.superclass.onDestroy.call(this);Ext.each(this.labelFn,function(fn){this.removeFnProxy(fn);},this);}});Ext.reg('cartesianchart',Ext.chart.CartesianChart);Ext.chart.LineChart=Ext.extend(Ext.chart.CartesianChart,{type:'line'});Ext.reg('linechart',Ext.chart.LineChart);Ext.chart.ColumnChart=Ext.extend(Ext.chart.CartesianChart,{type:'column'});Ext.reg('columnchart',Ext.chart.ColumnChart);Ext.chart.StackedColumnChart=Ext.extend(Ext.chart.CartesianChart,{type:'stackcolumn'});Ext.reg('stackedcolumnchart',Ext.chart.StackedColumnChart);Ext.chart.BarChart=Ext.extend(Ext.chart.CartesianChart,{type:'bar'});Ext.reg('barchart',Ext.chart.BarChart);Ext.chart.StackedBarChart=Ext.extend(Ext.chart.CartesianChart,{type:'stackbar'});Ext.reg('stackedbarchart',Ext.chart.StackedBarChart);Ext.chart.Axis=function(config){Ext.apply(this,config);};Ext.chart.Axis.prototype={type:null,orientation:"horizontal",reverse:false,labelFunction:null,hideOverlappingLabels:true,labelSpacing:2};Ext.chart.NumericAxis=Ext.extend(Ext.chart.Axis,{type:"numeric",minimum:NaN,maximum:NaN,majorUnit:NaN,minorUnit:NaN,snapToUnits:true,alwaysShowZero:true,scale:"linear",roundMajorUnit:true,calculateByLabelSize:true,position:'left',adjustMaximumByMajorUnit:true,adjustMinimumByMajorUnit:true});Ext.chart.TimeAxis=Ext.extend(Ext.chart.Axis,{type:"time",minimum:null,maximum:null,majorUnit:NaN,majorTimeUnit:null,minorUnit:NaN,minorTimeUnit:null,snapToUnits:true,stackingEnabled:false,calculateByLabelSize:true});Ext.chart.CategoryAxis=Ext.extend(Ext.chart.Axis,{type:"category",categoryNames:null,calculateCategoryCount:false});Ext.chart.Series=function(config){Ext.apply(this,config);};Ext.chart.Series.prototype={type:null,displayName:null};Ext.chart.CartesianSeries=Ext.extend(Ext.chart.Series,{xField:null,yField:null,showInLegend:true,axis:'primary'});Ext.chart.ColumnSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"column"});Ext.chart.LineSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"line"});Ext.chart.BarSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"bar"});Ext.chart.PieSeries=Ext.extend(Ext.chart.Series,{type:"pie",dataField:null,categoryField:null});Ext.menu.Menu=Ext.extend(Ext.Container,{minWidth:120,shadow:'sides',subMenuAlign:'tl-tr?',defaultAlign:'tl-bl?',allowOtherMenus:false,ignoreParentClicks:false,enableScrolling:true,maxHeight:null,scrollIncrement:24,showSeparator:true,defaultOffsets:[0,0],plain:false,floating:true,zIndex:15000,hidden:true,layout:'menu',hideMode:'offsets',scrollerHeight:8,autoLayout:true,defaultType:'menuitem',bufferResize:false,initComponent:function(){if(Ext.isArray(this.initialConfig)){Ext.apply(this,{items:this.initialConfig});}
this.addEvents('click','mouseover','mouseout','itemclick');Ext.menu.MenuMgr.register(this);if(this.floating){Ext.EventManager.onWindowResize(this.hide,this);}else{if(this.initialConfig.hidden!==false){this.hidden=false;}
this.internalDefaults={hideOnClick:false};}
Ext.menu.Menu.superclass.initComponent.call(this);if(this.autoLayout){var fn=this.doLayout.createDelegate(this,[]);this.on({add:fn,remove:fn});}},getLayoutTarget:function(){return this.ul;},onRender:function(ct,position){if(!ct){ct=Ext.getBody();}
var dh={id:this.getId(),cls:'x-menu '+((this.floating)?'x-menu-floating x-layer ':'')+(this.cls||'')+(this.plain?' x-menu-plain':'')+(this.showSeparator?'':' x-menu-nosep'),style:this.style,cn:[{tag:'a',cls:'x-menu-focus',href:'#',onclick:'return false;',tabIndex:'-1'},{tag:'ul',cls:'x-menu-list'}]};if(this.floating){this.el=new Ext.Layer({shadow:this.shadow,dh:dh,constrain:false,parentEl:ct,zindex:this.zIndex});}else{this.el=ct.createChild(dh);}
Ext.menu.Menu.superclass.onRender.call(this,ct,position);if(!this.keyNav){this.keyNav=new Ext.menu.MenuNav(this);}
this.focusEl=this.el.child('a.x-menu-focus');this.ul=this.el.child('ul.x-menu-list');this.mon(this.ul,{scope:this,click:this.onClick,mouseover:this.onMouseOver,mouseout:this.onMouseOut});if(this.enableScrolling){this.mon(this.el,{scope:this,delegate:'.x-menu-scroller',click:this.onScroll,mouseover:this.deactivateActive});}},findTargetItem:function(e){var t=e.getTarget('.x-menu-list-item',this.ul,true);if(t&&t.menuItemId){return this.items.get(t.menuItemId);}},onClick:function(e){var t=this.findTargetItem(e);if(t){if(t.isFormField){this.setActiveItem(t);}else if(t instanceof Ext.menu.BaseItem){if(t.menu&&this.ignoreParentClicks){t.expandMenu();e.preventDefault();}else if(t.onClick){t.onClick(e);this.fireEvent('click',this,t,e);}}}},setActiveItem:function(item,autoExpand){if(item!=this.activeItem){this.deactivateActive();if((this.activeItem=item).isFormField){item.focus();}else{item.activate(autoExpand);}}else if(autoExpand){item.expandMenu();}},deactivateActive:function(){var a=this.activeItem;if(a){if(a.isFormField){if(a.collapse){a.collapse();}}else{a.deactivate();}
delete this.activeItem;}},tryActivate:function(start,step){var items=this.items;for(var i=start,len=items.length;i>=0&&i<len;i+=step){var item=items.get(i);if(!item.disabled&&(item.canActivate||item.isFormField)){this.setActiveItem(item,false);return item;}}
return false;},onMouseOver:function(e){var t=this.findTargetItem(e);if(t){if(t.canActivate&&!t.disabled){this.setActiveItem(t,true);}}
this.over=true;this.fireEvent('mouseover',this,e,t);},onMouseOut:function(e){var t=this.findTargetItem(e);if(t){if(t==this.activeItem&&t.shouldDeactivate&&t.shouldDeactivate(e)){this.activeItem.deactivate();delete this.activeItem;}}
this.over=false;this.fireEvent('mouseout',this,e,t);},onScroll:function(e,t){if(e){e.stopEvent();}
var ul=this.ul.dom,top=Ext.fly(t).is('.x-menu-scroller-top');ul.scrollTop+=this.scrollIncrement*(top?-1:1);if(top?ul.scrollTop<=0:ul.scrollTop+this.activeMax>=ul.scrollHeight){this.onScrollerOut(null,t);}},onScrollerIn:function(e,t){var ul=this.ul.dom,top=Ext.fly(t).is('.x-menu-scroller-top');if(top?ul.scrollTop>0:ul.scrollTop+this.activeMax<ul.scrollHeight){Ext.fly(t).addClass(['x-menu-item-active','x-menu-scroller-active']);}},onScrollerOut:function(e,t){Ext.fly(t).removeClass(['x-menu-item-active','x-menu-scroller-active']);},show:function(el,pos,parentMenu){if(this.floating){this.parentMenu=parentMenu;if(!this.el){this.render();this.doLayout(false,true);}
this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign,this.defaultOffsets),parentMenu);}else{Ext.menu.Menu.superclass.show.call(this);}},showAt:function(xy,parentMenu){if(this.fireEvent('beforeshow',this)!==false){this.parentMenu=parentMenu;if(!this.el){this.render();}
if(this.enableScrolling){this.el.setXY(xy);xy[1]=this.constrainScroll(xy[1]);xy=[this.el.adjustForConstraints(xy)[0],xy[1]];}else{xy=this.el.adjustForConstraints(xy);}
this.el.setXY(xy);this.el.show();Ext.menu.Menu.superclass.onShow.call(this);if(Ext.isIE){this.fireEvent('autosize',this);if(!Ext.isIE8){this.el.repaint();}}
this.hidden=false;this.focus();this.fireEvent('show',this);}},constrainScroll:function(y){var max,full=this.ul.setHeight('auto').getHeight(),returnY=y,normalY,parentEl,scrollTop,viewHeight;if(this.floating){parentEl=Ext.fly(this.el.dom.parentNode);scrollTop=parentEl.getScroll().top;viewHeight=parentEl.getViewSize().height;normalY=y-scrollTop;max=this.maxHeight?this.maxHeight:viewHeight-normalY;if(full>viewHeight){max=viewHeight;returnY=y-normalY;}else if(max<full){returnY=y-(full-max);max=full;}}else{max=this.getHeight();}
if(this.maxHeight){max=Math.min(this.maxHeight,max);}
if(full>max&&max>0){this.activeMax=max-this.scrollerHeight*2-this.el.getFrameWidth('tb')-Ext.num(this.el.shadowOffset,0);this.ul.setHeight(this.activeMax);this.createScrollers();this.el.select('.x-menu-scroller').setDisplayed('');}else{this.ul.setHeight(full);this.el.select('.x-menu-scroller').setDisplayed('none');}
this.ul.dom.scrollTop=0;return returnY;},createScrollers:function(){if(!this.scroller){this.scroller={pos:0,top:this.el.insertFirst({tag:'div',cls:'x-menu-scroller x-menu-scroller-top',html:'&#160;'}),bottom:this.el.createChild({tag:'div',cls:'x-menu-scroller x-menu-scroller-bottom',html:'&#160;'})};this.scroller.top.hover(this.onScrollerIn,this.onScrollerOut,this);this.scroller.topRepeater=new Ext.util.ClickRepeater(this.scroller.top,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.top],false)}});this.scroller.bottom.hover(this.onScrollerIn,this.onScrollerOut,this);this.scroller.bottomRepeater=new Ext.util.ClickRepeater(this.scroller.bottom,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.bottom],false)}});}},onLayout:function(){if(this.isVisible()){if(this.enableScrolling){this.constrainScroll(this.el.getTop());}
if(this.floating){this.el.sync();}}},focus:function(){if(!this.hidden){this.doFocus.defer(50,this);}},doFocus:function(){if(!this.hidden){this.focusEl.focus();}},hide:function(deep){if(!this.isDestroyed){this.deepHide=deep;Ext.menu.Menu.superclass.hide.call(this);delete this.deepHide;}},onHide:function(){Ext.menu.Menu.superclass.onHide.call(this);this.deactivateActive();if(this.el&&this.floating){this.el.hide();}
var pm=this.parentMenu;if(this.deepHide===true&&pm){if(pm.floating){pm.hide(true);}else{pm.deactivateActive();}}},lookupComponent:function(c){if(Ext.isString(c)){c=(c=='separator'||c=='-')?new Ext.menu.Separator():new Ext.menu.TextItem(c);this.applyDefaults(c);}else{if(Ext.isObject(c)){c=this.getMenuItem(c);}else if(c.tagName||c.el){c=new Ext.BoxComponent({el:c});}}
return c;},applyDefaults:function(c){if(!Ext.isString(c)){c=Ext.menu.Menu.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(d){if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d);}else{Ext.applyIf(c,d);}}}
return c;},getMenuItem:function(config){if(!config.isXType){if(!config.xtype&&Ext.isBoolean(config.checked)){return new Ext.menu.CheckItem(config)}
return Ext.create(config,this.defaultType);}
return config;},addSeparator:function(){return this.add(new Ext.menu.Separator());},addElement:function(el){return this.add(new Ext.menu.BaseItem({el:el}));},addItem:function(item){return this.add(item);},addMenuItem:function(config){return this.add(this.getMenuItem(config));},addText:function(text){return this.add(new Ext.menu.TextItem(text));},onDestroy:function(){Ext.EventManager.removeResizeListener(this.hide,this);var pm=this.parentMenu;if(pm&&pm.activeChild==this){delete pm.activeChild;}
delete this.parentMenu;Ext.menu.Menu.superclass.onDestroy.call(this);Ext.menu.MenuMgr.unregister(this);if(this.keyNav){this.keyNav.disable();}
var s=this.scroller;if(s){Ext.destroy(s.topRepeater,s.bottomRepeater,s.top,s.bottom);}
Ext.destroy(this.el,this.focusEl,this.ul);}});Ext.reg('menu',Ext.menu.Menu);Ext.menu.MenuNav=Ext.extend(Ext.KeyNav,function(){function up(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)-1,-1)){m.tryActivate(m.items.length-1,-1);}}
function down(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)+1,1)){m.tryActivate(0,1);}}
return{constructor:function(menu){Ext.menu.MenuNav.superclass.constructor.call(this,menu.el);this.scope=this.menu=menu;},doRelay:function(e,h){var k=e.getKey();if(this.menu.activeItem&&this.menu.activeItem.isFormField&&k!=e.TAB){return false;}
if(!this.menu.activeItem&&e.isNavKeyPress()&&k!=e.SPACE&&k!=e.RETURN){this.menu.tryActivate(0,1);return false;}
return h.call(this.scope||this,e,this.menu);},tab:function(e,m){e.stopEvent();if(e.shiftKey){up(e,m);}else{down(e,m);}},up:up,down:down,right:function(e,m){if(m.activeItem){m.activeItem.expandMenu(true);}},left:function(e,m){m.hide();if(m.parentMenu&&m.parentMenu.activeItem){m.parentMenu.activeItem.activate();}},enter:function(e,m){if(m.activeItem){e.stopPropagation();m.activeItem.onClick(e);m.fireEvent('click',this,m.activeItem);return true;}}};}());Ext.menu.MenuMgr=function(){var menus,active,groups={},attached=false,lastShow=new Date();function init(){menus={};active=new Ext.util.MixedCollection();Ext.getDoc().addKeyListener(27,function(){if(active.length>0){hideAll();}});}
function hideAll(){if(active&&active.length>0){var c=active.clone();c.each(function(m){m.hide();});return true;}
return false;}
function onHide(m){active.remove(m);if(active.length<1){Ext.getDoc().un("mousedown",onMouseDown);attached=false;}}
function onShow(m){var last=active.last();lastShow=new Date();active.add(m);if(!attached){Ext.getDoc().on("mousedown",onMouseDown);attached=true;}
if(m.parentMenu){m.getEl().setZIndex(parseInt(m.parentMenu.getEl().getStyle("z-index"),10)+3);m.parentMenu.activeChild=m;}else if(last&&!last.isDestroyed&&last.isVisible()){m.getEl().setZIndex(parseInt(last.getEl().getStyle("z-index"),10)+3);}}
function onBeforeHide(m){if(m.activeChild){m.activeChild.hide();}
if(m.autoHideTimer){clearTimeout(m.autoHideTimer);delete m.autoHideTimer;}}
function onBeforeShow(m){var pm=m.parentMenu;if(!pm&&!m.allowOtherMenus){hideAll();}else if(pm&&pm.activeChild){pm.activeChild.hide();}}
function onMouseDown(e){if(lastShow.getElapsed()>50&&active.length>0&&!e.getTarget(".x-menu")){hideAll();}}
function onBeforeCheck(mi,state){if(state){var g=groups[mi.group];for(var i=0,l=g.length;i<l;i++){if(g[i]!=mi){g[i].setChecked(false);}}}}
return{hideAll:function(){return hideAll();},register:function(menu){if(!menus){init();}
menus[menu.id]=menu;menu.on({beforehide:onBeforeHide,hide:onHide,beforeshow:onBeforeShow,show:onShow});},get:function(menu){if(typeof menu=="string"){if(!menus){return null;}
return menus[menu];}else if(menu.events){return menu;}else if(typeof menu.length=='number'){return new Ext.menu.Menu({items:menu});}else{return Ext.create(menu,'menu');}},unregister:function(menu){delete menus[menu.id];menu.un("beforehide",onBeforeHide);menu.un("hide",onHide);menu.un("beforeshow",onBeforeShow);menu.un("show",onShow);},registerCheckable:function(menuItem){var g=menuItem.group;if(g){if(!groups[g]){groups[g]=[];}
groups[g].push(menuItem);menuItem.on("beforecheckchange",onBeforeCheck);}},unregisterCheckable:function(menuItem){var g=menuItem.group;if(g){groups[g].remove(menuItem);menuItem.un("beforecheckchange",onBeforeCheck);}},getCheckedItem:function(groupId){var g=groups[groupId];if(g){for(var i=0,l=g.length;i<l;i++){if(g[i].checked){return g[i];}}}
return null;},setCheckedItem:function(groupId,itemId){var g=groups[groupId];if(g){for(var i=0,l=g.length;i<l;i++){if(g[i].id==itemId){g[i].setChecked(true);}}}
return null;}};}();Ext.menu.BaseItem=Ext.extend(Ext.Component,{canActivate:false,activeClass:"x-menu-item-active",hideOnClick:true,clickHideDelay:1,ctype:"Ext.menu.BaseItem",actionMode:"container",initComponent:function(){Ext.menu.BaseItem.superclass.initComponent.call(this);this.addEvents('click','activate','deactivate');if(this.handler){this.on("click",this.handler,this.scope);}},onRender:function(container,position){Ext.menu.BaseItem.superclass.onRender.apply(this,arguments);if(this.ownerCt&&this.ownerCt instanceof Ext.menu.Menu){this.parentMenu=this.ownerCt;}else{this.container.addClass('x-menu-list-item');this.mon(this.el,{scope:this,click:this.onClick,mouseenter:this.activate,mouseleave:this.deactivate});}},setHandler:function(handler,scope){if(this.handler){this.un("click",this.handler,this.scope);}
this.on("click",this.handler=handler,this.scope=scope);},onClick:function(e){if(!this.disabled&&this.fireEvent("click",this,e)!==false&&(this.parentMenu&&this.parentMenu.fireEvent("itemclick",this,e)!==false)){this.handleClick(e);}else{e.stopEvent();}},activate:function(){if(this.disabled){return false;}
var li=this.container;li.addClass(this.activeClass);this.region=li.getRegion().adjust(2,2,-2,-2);this.fireEvent("activate",this);return true;},deactivate:function(){this.container.removeClass(this.activeClass);this.fireEvent("deactivate",this);},shouldDeactivate:function(e){return!this.region||!this.region.contains(e.getPoint());},handleClick:function(e){var pm=this.parentMenu;if(this.hideOnClick){if(pm.floating){pm.hide.defer(this.clickHideDelay,pm,[true]);}else{pm.deactivateActive();}}},expandMenu:Ext.emptyFn,hideMenu:Ext.emptyFn});Ext.reg('menubaseitem',Ext.menu.BaseItem);Ext.menu.TextItem=Ext.extend(Ext.menu.BaseItem,{hideOnClick:false,itemCls:"x-menu-text",constructor:function(config){if(typeof config=='string'){config={text:config}}
Ext.menu.TextItem.superclass.constructor.call(this,config);},onRender:function(){var s=document.createElement("span");s.className=this.itemCls;s.innerHTML=this.text;this.el=s;Ext.menu.TextItem.superclass.onRender.apply(this,arguments);}});Ext.reg('menutextitem',Ext.menu.TextItem);Ext.menu.Separator=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-sep",hideOnClick:false,activeClass:'',onRender:function(li){var s=document.createElement("span");s.className=this.itemCls;s.innerHTML="&#160;";this.el=s;li.addClass("x-menu-sep-li");Ext.menu.Separator.superclass.onRender.apply(this,arguments);}});Ext.reg('menuseparator',Ext.menu.Separator);Ext.menu.Item=Ext.extend(Ext.menu.BaseItem,{itemCls:'x-menu-item',canActivate:true,showDelay:200,hideDelay:200,ctype:'Ext.menu.Item',initComponent:function(){Ext.menu.Item.superclass.initComponent.call(this);if(this.menu){this.menu=Ext.menu.MenuMgr.get(this.menu);this.menu.ownerCt=this;}},onRender:function(container,position){if(!this.itemTpl){this.itemTpl=Ext.menu.Item.prototype.itemTpl=new Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"','</tpl>','>','<img src="{icon}" class="x-menu-item-icon {iconCls}"/>','<span class="x-menu-item-text">{text}</span>','</a>');}
var a=this.getTemplateArgs();this.el=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(container,a,true);this.iconEl=this.el.child('img.x-menu-item-icon');this.textEl=this.el.child('.x-menu-item-text');if(!this.href){this.mon(this.el,'click',Ext.emptyFn,null,{preventDefault:true});}
Ext.menu.Item.superclass.onRender.call(this,container,position);},getTemplateArgs:function(){return{id:this.id,cls:this.itemCls+(this.menu?' x-menu-item-arrow':'')+(this.cls?' '+this.cls:''),href:this.href||'#',hrefTarget:this.hrefTarget,icon:this.icon||Ext.BLANK_IMAGE_URL,iconCls:this.iconCls||'',text:this.itemText||this.text||'&#160;'};},setText:function(text){this.text=text||'&#160;';if(this.rendered){this.textEl.update(this.text);this.parentMenu.layout.doAutoSize();}},setIconClass:function(cls){var oldCls=this.iconCls;this.iconCls=cls;if(this.rendered){this.iconEl.replaceClass(oldCls,this.iconCls);}},beforeDestroy:function(){if(this.menu){delete this.menu.ownerCt;this.menu.destroy();}
Ext.menu.Item.superclass.beforeDestroy.call(this);},handleClick:function(e){if(!this.href){e.stopEvent();}
Ext.menu.Item.superclass.handleClick.apply(this,arguments);},activate:function(autoExpand){if(Ext.menu.Item.superclass.activate.apply(this,arguments)){this.focus();if(autoExpand){this.expandMenu();}}
return true;},shouldDeactivate:function(e){if(Ext.menu.Item.superclass.shouldDeactivate.call(this,e)){if(this.menu&&this.menu.isVisible()){return!this.menu.getEl().getRegion().contains(e.getPoint());}
return true;}
return false;},deactivate:function(){Ext.menu.Item.superclass.deactivate.apply(this,arguments);this.hideMenu();},expandMenu:function(autoActivate){if(!this.disabled&&this.menu){clearTimeout(this.hideTimer);delete this.hideTimer;if(!this.menu.isVisible()&&!this.showTimer){this.showTimer=this.deferExpand.defer(this.showDelay,this,[autoActivate]);}else if(this.menu.isVisible()&&autoActivate){this.menu.tryActivate(0,1);}}},deferExpand:function(autoActivate){delete this.showTimer;this.menu.show(this.container,this.parentMenu.subMenuAlign||'tl-tr?',this.parentMenu);if(autoActivate){this.menu.tryActivate(0,1);}},hideMenu:function(){clearTimeout(this.showTimer);delete this.showTimer;if(!this.hideTimer&&this.menu&&this.menu.isVisible()){this.hideTimer=this.deferHide.defer(this.hideDelay,this);}},deferHide:function(){delete this.hideTimer;if(this.menu.over){this.parentMenu.setActiveItem(this,false);}else{this.menu.hide();}}});Ext.reg('menuitem',Ext.menu.Item);Ext.menu.CheckItem=Ext.extend(Ext.menu.Item,{itemCls:"x-menu-item x-menu-check-item",groupClass:"x-menu-group-item",checked:false,ctype:"Ext.menu.CheckItem",initComponent:function(){Ext.menu.CheckItem.superclass.initComponent.call(this);this.addEvents("beforecheckchange","checkchange");if(this.checkHandler){this.on('checkchange',this.checkHandler,this.scope);}
Ext.menu.MenuMgr.registerCheckable(this);},onRender:function(c){Ext.menu.CheckItem.superclass.onRender.apply(this,arguments);if(this.group){this.el.addClass(this.groupClass);}
if(this.checked){this.checked=false;this.setChecked(true,true);}},destroy:function(){Ext.menu.MenuMgr.unregisterCheckable(this);Ext.menu.CheckItem.superclass.destroy.apply(this,arguments);},setChecked:function(state,suppressEvent){var suppress=suppressEvent===true;if(this.checked!=state&&(suppress||this.fireEvent("beforecheckchange",this,state)!==false)){if(this.container){this.container[state?"addClass":"removeClass"]("x-menu-item-checked");}
this.checked=state;if(!suppress){this.fireEvent("checkchange",this,state);}}},handleClick:function(e){if(!this.disabled&&!(this.checked&&this.group)){this.setChecked(!this.checked);}
Ext.menu.CheckItem.superclass.handleClick.apply(this,arguments);}});Ext.reg('menucheckitem',Ext.menu.CheckItem);Ext.menu.DateMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,pickerId:null,cls:'x-date-menu',initComponent:function(){this.on('beforeshow',this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on('show',this.onShow,this,{single:true,delay:20});}
Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.DatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:'x-menu-date-item',id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,['select']);this.on('show',this.picker.focus,this.picker);this.on('select',this.menuHide,this);if(this.handler){this.on('select',this.handler,this.scope||this);}},menuHide:function(){if(this.hideOnClick){this.hide(true);}},onBeforeShow:function(){if(this.picker){this.picker.hideMonthPicker(true);}},onShow:function(){var el=this.picker.getEl();el.setWidth(el.getWidth());}});Ext.reg('datemenu',Ext.menu.DateMenu);Ext.menu.ColorMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,cls:'x-color-menu',paletteId:null,initComponent:function(){Ext.apply(this,{plain:true,showSeparator:false,items:this.palette=new Ext.ColorPalette(Ext.applyIf({id:this.paletteId},this.initialConfig))});this.palette.purgeListeners();Ext.menu.ColorMenu.superclass.initComponent.call(this);this.relayEvents(this.palette,['select']);this.on('select',this.menuHide,this);if(this.handler){this.on('select',this.handler,this.scope||this);}},menuHide:function(){if(this.hideOnClick){this.hide(true);}}});Ext.reg('colormenu',Ext.menu.ColorMenu);Ext.form.Field=Ext.extend(Ext.BoxComponent,{invalidClass:'x-form-invalid',invalidText:'The value in this field is invalid',focusClass:'x-form-focus',validationEvent:'keyup',validateOnBlur:true,validationDelay:250,defaultAutoCreate:{tag:'input',type:'text',size:'20',autocomplete:'off'},fieldClass:'x-form-field',msgTarget:'qtip',msgFx:'normal',readOnly:false,disabled:false,submitValue:true,isFormField:true,msgDisplay:'',hasFocus:false,initComponent:function(){Ext.form.Field.superclass.initComponent.call(this);this.addEvents('focus','blur','specialkey','change','invalid','valid');},getName:function(){return this.rendered&&this.el.dom.name?this.el.dom.name:this.name||this.id||'';},onRender:function(ct,position){if(!this.el){var cfg=this.getAutoCreate();if(!cfg.name){cfg.name=this.name||this.id;}
if(this.inputType){cfg.type=this.inputType;}
this.autoEl=cfg;}
Ext.form.Field.superclass.onRender.call(this,ct,position);if(this.submitValue===false){this.el.dom.removeAttribute('name');}
var type=this.el.dom.type;if(type){if(type=='password'){type='text';}
this.el.addClass('x-form-'+type);}
if(this.readOnly){this.setReadOnly(true);}
if(this.tabIndex!==undefined){this.el.dom.setAttribute('tabIndex',this.tabIndex);}
this.el.addClass([this.fieldClass,this.cls]);},getItemCt:function(){return this.itemCt;},initValue:function(){if(this.value!==undefined){this.setValue(this.value);}else if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value);}
this.originalValue=this.getValue();},isDirty:function(){if(this.disabled||!this.rendered){return false;}
return String(this.getValue())!==String(this.originalValue);},setReadOnly:function(readOnly){if(this.rendered){this.el.dom.readOnly=readOnly;}
this.readOnly=readOnly;},afterRender:function(){Ext.form.Field.superclass.afterRender.call(this);this.initEvents();this.initValue();},fireKey:function(e){if(e.isSpecialKey()){this.fireEvent('specialkey',this,e);}},reset:function(){this.setValue(this.originalValue);this.clearInvalid();},initEvents:function(){this.mon(this.el,Ext.EventManager.useKeydown?'keydown':'keypress',this.fireKey,this);this.mon(this.el,'focus',this.onFocus,this);this.mon(this.el,'blur',this.onBlur,this,this.inEditor?{buffer:10}:null);},preFocus:Ext.emptyFn,onFocus:function(){this.preFocus();if(this.focusClass){this.el.addClass(this.focusClass);}
if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent('focus',this);}},beforeBlur:Ext.emptyFn,onBlur:function(){this.beforeBlur();if(this.focusClass){this.el.removeClass(this.focusClass);}
this.hasFocus=false;if(this.validationEvent!==false&&(this.validateOnBlur||this.validationEvent=='blur')){this.validate();}
var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent('change',this,v,this.startValue);}
this.fireEvent('blur',this);this.postBlur();},postBlur:Ext.emptyFn,isValid:function(preventMark){if(this.disabled){return true;}
var restore=this.preventMark;this.preventMark=preventMark===true;var v=this.validateValue(this.processValue(this.getRawValue()));this.preventMark=restore;return v;},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();return true;}
return false;},processValue:function(value){return value;},validateValue:function(value){var error=this.getErrors(value)[0];if(error==undefined){return true;}else{this.markInvalid(error);return false;}},getErrors:function(){return[];},getActiveError:function(){return this.activeError||'';},markInvalid:function(msg){if(this.rendered&&!this.preventMark){msg=msg||this.invalidText;var mt=this.getMessageHandler();if(mt){mt.mark(this,msg);}else if(this.msgTarget){this.el.addClass(this.invalidClass);var t=Ext.getDom(this.msgTarget);if(t){t.innerHTML=msg;t.style.display=this.msgDisplay;}}}
this.setActiveError(msg);},clearInvalid:function(){if(this.rendered&&!this.preventMark){this.el.removeClass(this.invalidClass);var mt=this.getMessageHandler();if(mt){mt.clear(this);}else if(this.msgTarget){this.el.removeClass(this.invalidClass);var t=Ext.getDom(this.msgTarget);if(t){t.innerHTML='';t.style.display='none';}}}
this.unsetActiveError();},setActiveError:function(msg,suppressEvent){this.activeError=msg;if(suppressEvent!==true)this.fireEvent('invalid',this,msg);},unsetActiveError:function(suppressEvent){delete this.activeError;if(suppressEvent!==true)this.fireEvent('valid',this);},getMessageHandler:function(){return Ext.form.MessageTargets[this.msgTarget];},getErrorCt:function(){return this.el.findParent('.x-form-element',5,true)||this.el.findParent('.x-form-field-wrap',5,true);},alignErrorEl:function(){this.errorEl.setWidth(this.getErrorCt().getWidth(true)-20);},alignErrorIcon:function(){this.errorIcon.alignTo(this.el,'tl-tr',[2,0]);},getRawValue:function(){var v=this.rendered?this.el.getValue():Ext.value(this.value,'');if(v===this.emptyText){v='';}
return v;},getValue:function(){if(!this.rendered){return this.value;}
var v=this.el.getValue();if(v===this.emptyText||v===undefined){v='';}
return v;},setRawValue:function(v){return this.rendered?(this.el.dom.value=(Ext.isEmpty(v)?'':v)):'';},setValue:function(v){this.value=v;if(this.rendered){this.el.dom.value=(Ext.isEmpty(v)?'':v);this.validate();}
return this;},append:function(v){this.setValue([this.getValue(),v].join(''));}});Ext.form.MessageTargets={'qtip':{mark:function(field,msg){field.el.addClass(field.invalidClass);field.el.dom.qtip=msg;field.el.dom.qclass='x-form-invalid-tip';if(Ext.QuickTips){Ext.QuickTips.enable();}},clear:function(field){field.el.removeClass(field.invalidClass);field.el.dom.qtip='';}},'title':{mark:function(field,msg){field.el.addClass(field.invalidClass);field.el.dom.title=msg;},clear:function(field){field.el.dom.title='';}},'under':{mark:function(field,msg){field.el.addClass(field.invalidClass);if(!field.errorEl){var elp=field.getErrorCt();if(!elp){field.el.dom.title=msg;return;}
field.errorEl=elp.createChild({cls:'x-form-invalid-msg'});field.on('resize',field.alignErrorEl,field);field.on('destroy',function(){Ext.destroy(this.errorEl);},field);}
field.alignErrorEl();field.errorEl.update(msg);Ext.form.Field.msgFx[field.msgFx].show(field.errorEl,field);},clear:function(field){field.el.removeClass(field.invalidClass);if(field.errorEl){Ext.form.Field.msgFx[field.msgFx].hide(field.errorEl,field);}else{field.el.dom.title='';}}},'side':{mark:function(field,msg){field.el.addClass(field.invalidClass);if(!field.errorIcon){var elp=field.getErrorCt();if(!elp){field.el.dom.title=msg;return;}
field.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});if(field.ownerCt){field.ownerCt.on('afterlayout',field.alignErrorIcon,field);field.ownerCt.on('expand',field.alignErrorIcon,field);}
field.on('resize',field.alignErrorIcon,field);field.on('destroy',function(){Ext.destroy(this.errorIcon);},field);}
field.alignErrorIcon();field.errorIcon.dom.qtip=msg;field.errorIcon.dom.qclass='x-form-invalid-tip';field.errorIcon.show();},clear:function(field){field.el.removeClass(field.invalidClass);if(field.errorIcon){field.errorIcon.dom.qtip='';field.errorIcon.hide();}else{field.el.dom.title='';}}}};Ext.form.Field.msgFx={normal:{show:function(msgEl,f){msgEl.setDisplayed('block');},hide:function(msgEl,f){msgEl.setDisplayed(false).update('');}},slide:{show:function(msgEl,f){msgEl.slideIn('t',{stopFx:true});},hide:function(msgEl,f){msgEl.slideOut('t',{stopFx:true,useDisplay:true});}},slideRight:{show:function(msgEl,f){msgEl.fixDisplay();msgEl.alignTo(f.el,'tl-tr');msgEl.slideIn('l',{stopFx:true});},hide:function(msgEl,f){msgEl.slideOut('l',{stopFx:true,useDisplay:true});}}};Ext.reg('field',Ext.form.Field);Ext.form.TextField=Ext.extend(Ext.form.Field,{grow:false,growMin:30,growMax:800,vtype:null,maskRe:null,disableKeyFilter:false,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:'The minimum length for this field is {0}',maxLengthText:'The maximum length for this field is {0}',selectOnFocus:false,blankText:'This field is required',validator:null,regex:null,regexText:'',emptyText:null,emptyClass:'x-form-empty-field',initComponent:function(){Ext.form.TextField.superclass.initComponent.call(this);this.addEvents('autosize','keydown','keyup','keypress');},initEvents:function(){Ext.form.TextField.superclass.initEvents.call(this);if(this.validationEvent=='keyup'){this.validationTask=new Ext.util.DelayedTask(this.validate,this);this.mon(this.el,'keyup',this.filterValidation,this);}
else if(this.validationEvent!==false&&this.validationEvent!='blur'){this.mon(this.el,this.validationEvent,this.validate,this,{buffer:this.validationDelay});}
if(this.selectOnFocus||this.emptyText){this.mon(this.el,'mousedown',this.onMouseDown,this);if(this.emptyText){this.applyEmptyText();}}
if(this.maskRe||(this.vtype&&this.disableKeyFilter!==true&&(this.maskRe=Ext.form.VTypes[this.vtype+'Mask']))){this.mon(this.el,'keypress',this.filterKeys,this);}
if(this.grow){this.mon(this.el,'keyup',this.onKeyUpBuffered,this,{buffer:50});this.mon(this.el,'click',this.autoSize,this);}
if(this.enableKeyEvents){this.mon(this.el,{scope:this,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress});}},onMouseDown:function(e){if(!this.hasFocus){this.mon(this.el,'mouseup',Ext.emptyFn,this,{single:true,preventDefault:true});}},processValue:function(value){if(this.stripCharsRe){var newValue=value.replace(this.stripCharsRe,'');if(newValue!==value){this.setRawValue(newValue);return newValue;}}
return value;},filterValidation:function(e){if(!e.isNavKeyPress()){this.validationTask.delay(this.validationDelay);}},onDisable:function(){Ext.form.TextField.superclass.onDisable.call(this);if(Ext.isIE){this.el.dom.unselectable='on';}},onEnable:function(){Ext.form.TextField.superclass.onEnable.call(this);if(Ext.isIE){this.el.dom.unselectable='';}},onKeyUpBuffered:function(e){if(this.doAutoSize(e)){this.autoSize();}},doAutoSize:function(e){return!e.isNavKeyPress();},onKeyUp:function(e){this.fireEvent('keyup',this,e);},onKeyDown:function(e){this.fireEvent('keydown',this,e);},onKeyPress:function(e){this.fireEvent('keypress',this,e);},reset:function(){Ext.form.TextField.superclass.reset.call(this);this.applyEmptyText();},applyEmptyText:function(){if(this.rendered&&this.emptyText&&this.getRawValue().length<1&&!this.hasFocus){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}},preFocus:function(){var el=this.el;if(this.emptyText){if(el.dom.value==this.emptyText){this.setRawValue('');}
el.removeClass(this.emptyClass);}
if(this.selectOnFocus){el.dom.select();}},postBlur:function(){this.applyEmptyText();},filterKeys:function(e){if(e.ctrlKey){return;}
var k=e.getKey();if(Ext.isGecko&&(e.isNavKeyPress()||k==e.BACKSPACE||(k==e.DELETE&&e.button==-1))){return;}
var cc=String.fromCharCode(e.getCharCode());if(!Ext.isGecko&&e.isSpecialKey()&&!cc){return;}
if(!this.maskRe.test(cc)){e.stopEvent();}},setValue:function(v){if(this.emptyText&&this.el&&!Ext.isEmpty(v)){this.el.removeClass(this.emptyClass);}
Ext.form.TextField.superclass.setValue.apply(this,arguments);this.applyEmptyText();this.autoSize();return this;},getErrors:function(value){var errors=Ext.form.TextField.superclass.getErrors.apply(this,arguments);value=value||this.processValue(this.getRawValue());if(Ext.isFunction(this.validator)){var msg=this.validator(value);if(msg!==true){errors.push(msg);}}
if(value.length<1||value===this.emptyText){if(this.allowBlank){return errors;}else{errors.push(this.blankText);}}
if(!this.allowBlank&&(value.length<1||value===this.emptyText)){errors.push(this.blankText);}
if(value.length<this.minLength){errors.push(String.format(this.minLengthText,this.minLength));}
if(value.length>this.maxLength){errors.push(String.format(this.maxLengthText,this.maxLength));}
if(this.vtype){var vt=Ext.form.VTypes;if(!vt[this.vtype](value,this)){errors.push(this.vtypeText||vt[this.vtype+'Text']);}}
if(this.regex&&!this.regex.test(value)){errors.push(this.regexText);}
return errors;},selectText:function(start,end){var v=this.getRawValue();var doFocus=false;if(v.length>0){start=start===undefined?0:start;end=end===undefined?v.length:end;var d=this.el.dom;if(d.setSelectionRange){d.setSelectionRange(start,end);}else if(d.createTextRange){var range=d.createTextRange();range.moveStart('character',start);range.moveEnd('character',end-v.length);range.select();}
doFocus=Ext.isGecko||Ext.isOpera;}else{doFocus=true;}
if(doFocus){this.focus();}},autoSize:function(){if(!this.grow||!this.rendered){return;}
if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}
var el=this.el;var v=el.dom.value;var d=document.createElement('div');d.appendChild(document.createTextNode(v));v=d.innerHTML;Ext.removeNode(d);d=null;v+='&#160;';var w=Math.min(this.growMax,Math.max(this.metrics.getWidth(v)+10,this.growMin));this.el.setWidth(w);this.fireEvent('autosize',this,w);},onDestroy:function(){if(this.validationTask){this.validationTask.cancel();this.validationTask=null;}
Ext.form.TextField.superclass.onDestroy.call(this);}});Ext.reg('textfield',Ext.form.TextField);Ext.form.TriggerField=Ext.extend(Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"text",size:"16",autocomplete:"off"},hideTrigger:false,editable:true,readOnly:false,wrapFocusClass:'x-trigger-wrap-focus',autoSize:Ext.emptyFn,monitorTab:true,deferHeight:true,mimicing:false,actionMode:'wrap',defaultTriggerWidth:17,onResize:function(w,h){Ext.form.TriggerField.superclass.onResize.call(this,w,h);var tw=this.getTriggerWidth();if(Ext.isNumber(w)){this.el.setWidth(w-tw);}
this.wrap.setWidth(this.el.getWidth()+tw);},getTriggerWidth:function(){var tw=this.trigger.getWidth();if(!this.hideTrigger&&!this.readOnly&&tw===0){tw=this.defaultTriggerWidth;}
return tw;},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,'tl-tr',[2,0]);}},onRender:function(ct,position){this.doc=Ext.isIE?Ext.getBody():Ext.getDoc();Ext.form.TriggerField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-field-trigger-wrap'});this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});this.initTrigger();if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth());}
this.resizeEl=this.positionEl=this.wrap;},getWidth:function(){return(this.el.getWidth()+this.trigger.getWidth());},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.dom.readOnly=true;this.el.addClass('x-trigger-noedit');this.mun(this.el,'click',this.onTriggerClick,this);this.trigger.setDisplayed(false);}else{if(!this.editable){this.el.dom.readOnly=true;this.el.addClass('x-trigger-noedit');this.mon(this.el,'click',this.onTriggerClick,this);}else{this.el.dom.readOnly=false;this.el.removeClass('x-trigger-noedit');this.mun(this.el,'click',this.onTriggerClick,this);}
this.trigger.setDisplayed(!this.hideTrigger);}
this.onResize(this.width||this.wrap.getWidth());}},setHideTrigger:function(hideTrigger){if(hideTrigger!=this.hideTrigger){this.hideTrigger=hideTrigger;this.updateEditState();}},setEditable:function(editable){if(editable!=this.editable){this.editable=editable;this.updateEditState();}},setReadOnly:function(readOnly){if(readOnly!=this.readOnly){this.readOnly=readOnly;this.updateEditState();}},afterRender:function(){Ext.form.TriggerField.superclass.afterRender.call(this);this.updateEditState();},initTrigger:function(){this.mon(this.trigger,'click',this.onTriggerClick,this,{preventDefault:true});this.trigger.addClassOnOver('x-form-trigger-over');this.trigger.addClassOnClick('x-form-trigger-click');},onDestroy:function(){Ext.destroy(this.trigger,this.wrap);if(this.mimicing){this.doc.un('mousedown',this.mimicBlur,this);}
delete this.doc;Ext.form.TriggerField.superclass.onDestroy.call(this);},onFocus:function(){Ext.form.TriggerField.superclass.onFocus.call(this);if(!this.mimicing){this.wrap.addClass(this.wrapFocusClass);this.mimicing=true;this.doc.on('mousedown',this.mimicBlur,this,{delay:10});if(this.monitorTab){this.on('specialkey',this.checkTab,this);}}},checkTab:function(me,e){if(e.getKey()==e.TAB){this.triggerBlur();}},onBlur:Ext.emptyFn,mimicBlur:function(e){if(!this.isDestroyed&&!this.wrap.contains(e.target)&&this.validateBlur(e)){this.triggerBlur();}},triggerBlur:function(){this.mimicing=false;this.doc.un('mousedown',this.mimicBlur,this);if(this.monitorTab&&this.el){this.un('specialkey',this.checkTab,this);}
Ext.form.TriggerField.superclass.onBlur.call(this);if(this.wrap){this.wrap.removeClass(this.wrapFocusClass);}},beforeBlur:Ext.emptyFn,validateBlur:function(e){return true;},onTriggerClick:Ext.emptyFn});Ext.form.TwinTriggerField=Ext.extend(Ext.form.TriggerField,{initComponent:function(){Ext.form.TwinTriggerField.superclass.initComponent.call(this);this.triggerConfig={tag:'span',cls:'x-form-twin-triggers',cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class}]};},getTrigger:function(index){return this.triggers[index];},initTrigger:function(){var ts=this.trigger.select('.x-form-trigger',true);var triggerField=this;ts.each(function(t,all,index){var triggerIndex='Trigger'+(index+1);t.hide=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='none';triggerField.el.setWidth(w-triggerField.trigger.getWidth());this['hidden'+triggerIndex]=true;};t.show=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='';triggerField.el.setWidth(w-triggerField.trigger.getWidth());this['hidden'+triggerIndex]=false;};if(this['hide'+triggerIndex]){t.dom.style.display='none';this['hidden'+triggerIndex]=true;}
this.mon(t,'click',this['on'+triggerIndex+'Click'],this,{preventDefault:true});t.addClassOnOver('x-form-trigger-over');t.addClassOnClick('x-form-trigger-click');},this);this.triggers=ts.elements;},getTriggerWidth:function(){var tw=0;Ext.each(this.triggers,function(t,index){var triggerIndex='Trigger'+(index+1),w=t.getWidth();if(w===0&&!this['hidden'+triggerIndex]){tw+=this.defaultTriggerWidth;}else{tw+=w;}},this);return tw;},onDestroy:function(){Ext.destroy(this.triggers);Ext.form.TwinTriggerField.superclass.onDestroy.call(this);},onTrigger1Click:Ext.emptyFn,onTrigger2Click:Ext.emptyFn});Ext.reg('trigger',Ext.form.TriggerField);Ext.form.TextArea=Ext.extend(Ext.form.TextField,{growMin:60,growMax:1000,growAppend:'&#160;\n&#160;',enterIsSpecial:false,preventScrollbars:false,onRender:function(ct,position){if(!this.el){this.defaultAutoCreate={tag:"textarea",style:"width:100px;height:60px;",autocomplete:"off"};}
Ext.form.TextArea.superclass.onRender.call(this,ct,position);if(this.grow){this.textSizeEl=Ext.DomHelper.append(document.body,{tag:"pre",cls:"x-form-grow-sizer"});if(this.preventScrollbars){this.el.setStyle("overflow","hidden");}
this.el.setHeight(this.growMin);}},onDestroy:function(){Ext.removeNode(this.textSizeEl);Ext.form.TextArea.superclass.onDestroy.call(this);},fireKey:function(e){if(e.isSpecialKey()&&(this.enterIsSpecial||(e.getKey()!=e.ENTER||e.hasModifier()))){this.fireEvent("specialkey",this,e);}},doAutoSize:function(e){return!e.isNavKeyPress()||e.getKey()==e.ENTER;},autoSize:function(){if(!this.grow||!this.textSizeEl){return;}
var el=this.el,v=Ext.util.Format.htmlEncode(el.dom.value),ts=this.textSizeEl,h;Ext.fly(ts).setWidth(this.el.getWidth());if(v.length<1){v="&#160;&#160;";}else{v+=this.growAppend;if(Ext.isIE){v=v.replace(/\n/g,'&#160;<br />');}}
ts.innerHTML=v;h=Math.min(this.growMax,Math.max(ts.offsetHeight,this.growMin));if(h!=this.lastHeight){this.lastHeight=h;this.el.setHeight(h);this.fireEvent("autosize",this,h);}}});Ext.reg('textarea',Ext.form.TextArea);Ext.form.NumberField=Ext.extend(Ext.form.TextField,{fieldClass:"x-form-field x-form-num-field",allowDecimals:true,decimalSeparator:".",decimalPrecision:2,allowNegative:true,minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,minText:"The minimum value for this field is {0}",maxText:"The maximum value for this field is {0}",nanText:"{0} is not a valid number",baseChars:"0123456789",initEvents:function(){var allowed=this.baseChars+'';if(this.allowDecimals){allowed+=this.decimalSeparator;}
if(this.allowNegative){allowed+='-';}
this.maskRe=new RegExp('['+Ext.escapeRe(allowed)+']');Ext.form.NumberField.superclass.initEvents.call(this);},getErrors:function(value){var errors=Ext.form.NumberField.superclass.getErrors.apply(this,arguments);value=value||this.processValue(this.getRawValue());if(value.length<1){return errors;}
value=String(value).replace(this.decimalSeparator,".");if(isNaN(value)){errors.push(String.format(this.nanText,value));}
var num=this.parseValue(value);if(num<this.minValue){errors.push(String.format(this.minText,this.minValue));}
if(num>this.maxValue){errors.push(String.format(this.maxText,this.maxValue));}
return errors;},getValue:function(){return this.fixPrecision(this.parseValue(Ext.form.NumberField.superclass.getValue.call(this)));},setValue:function(v){v=Ext.isNumber(v)?v:parseFloat(String(v).replace(this.decimalSeparator,"."));v=isNaN(v)?'':String(v).replace(".",this.decimalSeparator);return Ext.form.NumberField.superclass.setValue.call(this,v);},setMinValue:function(value){this.minValue=Ext.num(value,Number.NEGATIVE_INFINITY);},setMaxValue:function(value){this.maxValue=Ext.num(value,Number.MAX_VALUE);},parseValue:function(value){value=parseFloat(String(value).replace(this.decimalSeparator,"."));return isNaN(value)?'':value;},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?'':value;}
return parseFloat(parseFloat(value).toFixed(this.decimalPrecision));},beforeBlur:function(){var v=this.parseValue(this.getRawValue());if(!Ext.isEmpty(v)){this.setValue(this.fixPrecision(v));}}});Ext.reg('numberfield',Ext.form.NumberField);Ext.form.DateField=Ext.extend(Ext.form.TriggerField,{format:"m/d/Y",altFormats:"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:'x-form-date-trigger',showToday:true,defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initTime:'12',initTimeFormat:'H',safeParse:function(value,format){if(/[gGhH]/.test(format.replace(/(\\.)/g,''))){return Date.parseDate(value,format);}else{var parsedDate=Date.parseDate(value+' '+this.initTime,format+' '+this.initTimeFormat);if(parsedDate)return parsedDate.clearTime();}},initComponent:function(){Ext.form.DateField.superclass.initComponent.call(this);this.addEvents('select');if(Ext.isString(this.minValue)){this.minValue=this.parseDate(this.minValue);}
if(Ext.isString(this.maxValue)){this.maxValue=this.parseDate(this.maxValue);}
this.disabledDatesRE=null;this.initDisabledDays();},initEvents:function(){Ext.form.DateField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"down":function(e){this.onTriggerClick();},scope:this,forceKeyDown:true});},initDisabledDays:function(){if(this.disabledDates){var dd=this.disabledDates,len=dd.length-1,re="(?:";Ext.each(dd,function(d,i){re+=Ext.isDate(d)?'^'+Ext.escapeRe(d.dateFormat(this.format))+'$':dd[i];if(i!=len){re+='|';}},this);this.disabledDatesRE=new RegExp(re+')');}},setDisabledDates:function(dd){this.disabledDates=dd;this.initDisabledDays();if(this.menu){this.menu.picker.setDisabledDates(this.disabledDatesRE);}},setDisabledDays:function(dd){this.disabledDays=dd;if(this.menu){this.menu.picker.setDisabledDays(dd);}},setMinValue:function(dt){this.minValue=(Ext.isString(dt)?this.parseDate(dt):dt);if(this.menu){this.menu.picker.setMinDate(this.minValue);}},setMaxValue:function(dt){this.maxValue=(Ext.isString(dt)?this.parseDate(dt):dt);if(this.menu){this.menu.picker.setMaxDate(this.maxValue);}},getErrors:function(value){var errors=Ext.form.DateField.superclass.getErrors.apply(this,arguments);value=this.formatDate(value||this.processValue(this.getRawValue()));if(value.length<1){return errors;}
var svalue=value;value=this.parseDate(value);if(!value){errors.push(String.format(this.invalidText,svalue,this.format));return errors;}
var time=value.getTime();if(this.minValue&&time<this.minValue.getTime()){errors.push(String.format(this.minText,this.formatDate(this.minValue)));}
if(this.maxValue&&time>this.maxValue.getTime()){errors.push(String.format(this.maxText,this.formatDate(this.maxValue)));}
if(this.disabledDays){var day=value.getDay();for(var i=0;i<this.disabledDays.length;i++){if(day===this.disabledDays[i]){errors.push(this.disabledDaysText);break;}}}
var fvalue=this.formatDate(value);if(this.disabledDatesRE&&this.disabledDatesRE.test(fvalue)){errors.push(String.format(this.disabledDatesText,fvalue));}
return errors;},validateBlur:function(){return!this.menu||!this.menu.isVisible();},getValue:function(){return this.parseDate(Ext.form.DateField.superclass.getValue.call(this))||"";},setValue:function(date){return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(date)));},parseDate:function(value){if(!value||Ext.isDate(value)){return value;}
var v=this.safeParse(value,this.format),af=this.altFormats,afa=this.altFormatsArray;if(!v&&af){afa=afa||af.split("|");for(var i=0,len=afa.length;i<len&&!v;i++){v=this.safeParse(value,afa[i]);}}
return v;},onDestroy:function(){Ext.destroy(this.menu,this.keyNav);Ext.form.DateField.superclass.onDestroy.call(this);},formatDate:function(date){return Ext.isDate(date)?date.dateFormat(this.format):date;},onTriggerClick:function(){if(this.disabled){return;}
if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false});}
this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents('on');},menuEvents:function(method){this.menu[method]('select',this.onSelect,this);this.menu[method]('hide',this.onMenuHide,this);this.menu[method]('show',this.onFocus,this);},onSelect:function(m,d){this.setValue(d);this.fireEvent('select',this,d);this.menu.hide();},onMenuHide:function(){this.focus(false,60);this.menuEvents('un');},beforeBlur:function(){var v=this.parseDate(this.getRawValue());if(v){this.setValue(v);}}});Ext.reg('datefield',Ext.form.DateField);Ext.form.DisplayField=Ext.extend(Ext.form.Field,{validationEvent:false,validateOnBlur:false,defaultAutoCreate:{tag:"div"},fieldClass:"x-form-display-field",htmlEncode:false,initEvents:Ext.emptyFn,isValid:function(){return true;},validate:function(){return true;},getRawValue:function(){var v=this.rendered?this.el.dom.innerHTML:Ext.value(this.value,'');if(v===this.emptyText){v='';}
if(this.htmlEncode){v=Ext.util.Format.htmlDecode(v);}
return v;},getValue:function(){return this.getRawValue();},getName:function(){return this.name;},setRawValue:function(v){if(this.htmlEncode){v=Ext.util.Format.htmlEncode(v);}
return this.rendered?(this.el.dom.innerHTML=(Ext.isEmpty(v)?'':v)):(this.value=v);},setValue:function(v){this.setRawValue(v);return this;}});Ext.reg('displayfield',Ext.form.DisplayField);Ext.form.ComboBox=Ext.extend(Ext.form.TriggerField,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:'',selectedClass:'x-combo-selected',listEmptyText:'',triggerClass:'x-form-arrow-trigger',shadow:'sides',listAlign:'tl-bl?',maxHeight:300,minHeight:90,triggerAction:'query',minChars:4,autoSelect:true,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:'query',loadingText:'Loading...',resizable:false,handleHeight:8,allQuery:'',mode:'remote',minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,clearFilterOnReset:true,submitValue:undefined,initComponent:function(){Ext.form.ComboBox.superclass.initComponent.call(this);this.addEvents('expand','collapse','beforeselect','select','beforequery');if(this.transform){var s=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=s.name;}
if(!this.store){this.mode='local';var d=[],opts=s.options;for(var i=0,len=opts.length;i<len;i++){var o=opts[i],value=(o.hasAttribute?o.hasAttribute('value'):o.getAttributeNode('value').specified)?o.value:o.text;if(o.selected&&Ext.isEmpty(this.value,true)){this.value=value;}
d.push([value,o.text]);}
this.store=new Ext.data.ArrayStore({'id':0,fields:['value','text'],data:d,autoDestroy:true});this.valueField='value';this.displayField='text';}
s.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(s,this.autoCreate||this.defaultAutoCreate);this.render(this.el.parentNode,s);}
Ext.removeNode(s);}
else if(this.store){this.store=Ext.StoreMgr.lookup(this.store);if(this.store.autoCreated){this.displayField=this.valueField='field1';if(!this.store.expandData){this.displayField='field2';}
this.mode='local';}}
this.selectedIndex=-1;if(this.mode=='local'){if(!Ext.isDefined(this.initialConfig.queryDelay)){this.queryDelay=10;}
if(!Ext.isDefined(this.initialConfig.minChars)){this.minChars=0;}}},onRender:function(ct,position){if(this.hiddenName&&!Ext.isDefined(this.submitValue)){this.submitValue=false;}
Ext.form.ComboBox.superclass.onRender.call(this,ct,position);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:'input',type:'hidden',name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},'before',true);}
if(Ext.isGecko){this.el.dom.setAttribute('autocomplete','off');}
if(!this.lazyInit){this.initList();}else{this.on('focus',this.initList,this,{single:true});}},initValue:function(){Ext.form.ComboBox.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=Ext.value(Ext.isDefined(this.hiddenValue)?this.hiddenValue:this.value,'');}},getParentZIndex:function(){var zindex;if(this.ownerCt){this.findParentBy(function(ct){zindex=parseInt(ct.getPositionEl().getStyle('z-index'),10);return!!zindex;});}
return zindex;},initList:function(){if(!this.list){var cls='x-combo-list',listParent=Ext.getDom(this.getListParent()||Ext.getBody()),zindex=parseInt(Ext.fly(listParent).getStyle('z-index'),10);if(!zindex){zindex=this.getParentZIndex();}
this.list=new Ext.Layer({parentEl:listParent,shadow:this.shadow,cls:[cls,this.listClass].join(' '),constrain:false,zindex:(zindex||12000)+5});var lw=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setSize(lw,0);this.list.swallowEvent('mousewheel');this.assetHeight=0;if(this.syncFont!==false){this.list.setStyle('font-size',this.el.getStyle('font-size'));}
if(this.title){this.header=this.list.createChild({cls:cls+'-hd',html:this.title});this.assetHeight+=this.header.getHeight();}
this.innerList=this.list.createChild({cls:cls+'-inner'});this.mon(this.innerList,'mouseover',this.onViewOver,this);this.mon(this.innerList,'mousemove',this.onViewMove,this);this.innerList.setWidth(lw-this.list.getFrameWidth('lr'));if(this.pageSize){this.footer=this.list.createChild({cls:cls+'-ft'});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight();}
if(!this.tpl){this.tpl='<tpl for="."><div class="'+cls+'-item">{'+this.displayField+'}</div></tpl>';}
this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||'.'+cls+'-item',emptyText:this.listEmptyText,deferEmptyText:false});this.mon(this.view,{containerclick:this.onViewClick,click:this.onViewClick,scope:this});this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:'se'});this.mon(this.resizer,'resize',function(r,w,h){this.maxHeight=h-this.handleHeight-this.list.getFrameWidth('tb')-this.assetHeight;this.listWidth=w;this.innerList.setWidth(w-this.list.getFrameWidth('lr'));this.restrictHeight();},this);this[this.pageSize?'footer':'innerList'].setStyle('margin-bottom',this.handleHeight+'px');}}},getListParent:function(){return document.body;},getStore:function(){return this.store;},bindStore:function(store,initial){if(this.store&&!initial){if(this.store!==store&&this.store.autoDestroy){this.store.destroy();}else{this.store.un('beforeload',this.onBeforeLoad,this);this.store.un('load',this.onLoad,this);this.store.un('exception',this.collapse,this);}
if(!store){this.store=null;if(this.view){this.view.bindStore(null);}
if(this.pageTb){this.pageTb.bindStore(null);}}}
if(store){if(!initial){this.lastQuery=null;if(this.pageTb){this.pageTb.bindStore(store);}}
this.store=Ext.StoreMgr.lookup(store);this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.collapse});if(this.view){this.view.bindStore(store);}}},reset:function(){Ext.form.ComboBox.superclass.reset.call(this);if(this.clearFilterOnReset&&this.mode=='local'){this.store.clearFilter();}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"up":function(e){this.inKeyMode=true;this.selectPrev();},"down":function(e){if(!this.isExpanded()){this.onTriggerClick();}else{this.inKeyMode=true;this.selectNext();}},"enter":function(e){this.onViewClick();},"esc":function(e){this.collapse();},"tab":function(e){if(this.forceSelection===true){this.collapse();}else{this.onViewClick(false);}
return true;},scope:this,doRelay:function(e,h,hname){if(hname=='down'||this.scope.isExpanded()){var relay=Ext.KeyNav.prototype.doRelay.apply(this,arguments);if(!Ext.isIE&&Ext.EventManager.useKeydown){this.scope.fireKey(e);}
return relay;}
return true;},forceKeyDown:true,defaultEventAction:'stopEvent'});this.queryDelay=Math.max(this.queryDelay||10,this.mode=='local'?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this);}
if(!this.enableKeyEvents){this.mon(this.el,'keyup',this.onKeyUp,this);}},onDestroy:function(){if(this.dqTask){this.dqTask.cancel();this.dqTask=null;}
this.bindStore(null);Ext.destroy(this.resizer,this.view,this.pageTb,this.list);Ext.destroyMembers(this,'hiddenField');Ext.form.ComboBox.superclass.onDestroy.call(this);},fireKey:function(e){if(!this.isExpanded()){Ext.form.ComboBox.superclass.fireKey.call(this,e);}},onResize:function(w,h){Ext.form.ComboBox.superclass.onResize.apply(this,arguments);if(!isNaN(w)&&this.isVisible()&&this.list){this.doResize(w);}else{this.bufferSize=w;}},doResize:function(w){if(!Ext.isDefined(this.listWidth)){var lw=Math.max(w,this.minListWidth);this.list.setWidth(lw);this.innerList.setWidth(lw-this.list.getFrameWidth('lr'));}},onEnable:function(){Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false;}},onDisable:function(){Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true;}},onBeforeLoad:function(){if(!this.hasFocus){return;}
this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+'</div>':'');this.restrictHeight();this.selectedIndex=-1;},onLoad:function(){if(!this.hasFocus){return;}
if(this.store.getCount()>0||this.listEmptyText){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select();}
if(this.autoSelect!==false&&!this.selectByValue(this.value,true)){this.select(0,true);}}else{if(this.autoSelect!==false){this.selectNext();}
if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay);}}}else{this.collapse();}},onTypeAhead:function(){if(this.store.getCount()>0){var r=this.store.getAt(0);var newValue=r.data[this.displayField];var len=newValue.length;var selStart=this.getRawValue().length;if(selStart!=len){this.setRawValue(newValue);this.selectText(selStart,newValue.length);}}},assertValue:function(){var val=this.getRawValue(),rec=this.findRecord(this.displayField,val);if(!rec&&this.forceSelection){if(val.length>0&&val!=this.emptyText){this.el.dom.value=Ext.value(this.lastSelectionText,'');this.applyEmptyText();}else{this.clearValue();}}else{if(rec){if(val==rec.get(this.displayField)&&this.value==rec.get(this.valueField)){return;}
val=rec.get(this.valueField||this.displayField);}
this.setValue(val);}},onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){this.setValue(record.data[this.valueField||this.displayField]);this.collapse();this.fireEvent('select',this,record,index);}},getName:function(){var hf=this.hiddenField;return hf&&hf.name?hf.name:this.hiddenName||Ext.form.ComboBox.superclass.getName.call(this);},getValue:function(){if(this.valueField){return Ext.isDefined(this.value)?this.value:'';}else{return Ext.form.ComboBox.superclass.getValue.call(this);}},clearValue:function(){if(this.hiddenField){this.hiddenField.value='';}
this.setRawValue('');this.lastSelectionText='';this.applyEmptyText();this.value='';},setValue:function(v){var text=v;if(this.valueField){var r=this.findRecord(this.valueField,v);if(r){text=r.data[this.displayField];}else if(Ext.isDefined(this.valueNotFoundText)){text=this.valueNotFoundText;}}
this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=Ext.value(v,'');}
Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=v;return this;},findRecord:function(prop,value){var record;if(this.store.getCount()>0){this.store.each(function(r){if(r.data[prop]==value){record=r;return false;}});}
return record;},onViewMove:function(e,t){this.inKeyMode=false;},onViewOver:function(e,t){if(this.inKeyMode){return;}
var item=this.view.findItemFromChild(t);if(item){var index=this.view.indexOf(item);this.select(index,false);}},onViewClick:function(doFocus){var index=this.view.getSelectedIndexes()[0],s=this.store,r=s.getAt(index);if(r){this.onSelect(r,index);}else{this.collapse();}
if(doFocus!==false){this.el.focus();}},restrictHeight:function(){this.innerList.dom.style.height='';var inner=this.innerList.dom,pad=this.list.getFrameWidth('tb')+(this.resizable?this.handleHeight:0)+this.assetHeight,h=Math.max(inner.clientHeight,inner.offsetHeight,inner.scrollHeight),ha=this.getPosition()[1]-Ext.getBody().getScroll().top,hb=Ext.lib.Dom.getViewHeight()-ha-this.getSize().height,space=Math.max(ha,hb,this.minHeight||0)-this.list.shadowOffset-pad-5;h=Math.min(h,space,this.maxHeight);this.innerList.setHeight(h);this.list.beginUpdate();this.list.setHeight(h+pad);this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));this.list.endUpdate();},isExpanded:function(){return this.list&&this.list.isVisible();},selectByValue:function(v,scrollIntoView){if(!Ext.isEmpty(v,true)){var r=this.findRecord(this.valueField||this.displayField,v);if(r){this.select(this.store.indexOf(r),scrollIntoView);return true;}}
return false;},select:function(index,scrollIntoView){this.selectedIndex=index;this.view.select(index);if(scrollIntoView!==false){var el=this.view.getNode(index);if(el){this.innerList.scrollChildIntoView(el,false);}}},selectNext:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0);}else if(this.selectedIndex<ct-1){this.select(this.selectedIndex+1);}}},selectPrev:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0);}else if(this.selectedIndex!==0){this.select(this.selectedIndex-1);}}},onKeyUp:function(e){var k=e.getKey();if(this.editable!==false&&this.readOnly!==true&&(k==e.BACKSPACE||!e.isSpecialKey())){this.lastKey=k;this.dqTask.delay(this.queryDelay);}
Ext.form.ComboBox.superclass.onKeyUp.call(this,e);},validateBlur:function(){return!this.list||!this.list.isVisible();},initQuery:function(){this.doQuery(this.getRawValue());},beforeBlur:function(){this.assertValue();},postBlur:function(){Ext.form.ComboBox.superclass.postBlur.call(this);this.collapse();this.inKeyMode=false;},doQuery:function(q,forceAll){q=Ext.isEmpty(q)?'':q;var qe={query:q,forceAll:forceAll,combo:this,cancel:false};if(this.fireEvent('beforequery',qe)===false||qe.cancel){return false;}
q=qe.query;forceAll=qe.forceAll;if(forceAll===true||(q.length>=this.minChars)){if(this.lastQuery!==q){this.lastQuery=q;if(this.mode=='local'){this.selectedIndex=-1;if(forceAll){this.store.clearFilter();}else{this.store.filter(this.displayField,q);}
this.onLoad();}else{this.store.baseParams[this.queryParam]=q;this.store.load({params:this.getParams(q)});this.expand();}}else{this.selectedIndex=-1;this.onLoad();}}},getParams:function(q){var p={};if(this.pageSize){p.start=0;p.limit=this.pageSize;}
return p;},collapse:function(){if(!this.isExpanded()){return;}
this.list.hide();Ext.getDoc().un('mousewheel',this.collapseIf,this);Ext.getDoc().un('mousedown',this.collapseIf,this);this.fireEvent('collapse',this);},collapseIf:function(e){if(!this.isDestroyed&&!e.within(this.wrap)&&!e.within(this.list)){this.collapse();}},expand:function(){if(this.isExpanded()||!this.hasFocus){return;}
if(this.title||this.pageSize){this.assetHeight=0;if(this.title){this.assetHeight+=this.header.getHeight();}
if(this.pageSize){this.assetHeight+=this.footer.getHeight();}}
if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}
this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));var listParent=Ext.getDom(this.getListParent()||Ext.getBody()),zindex=parseInt(Ext.fly(listParent).getStyle('z-index'),10);if(!zindex){zindex=this.getParentZIndex();}
if(zindex){this.list.setZIndex(zindex+5);}
this.list.show();if(Ext.isGecko2){this.innerList.setOverflow('auto');}
this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent('expand',this);},onTriggerClick:function(){if(this.readOnly||this.disabled){return;}
if(this.isExpanded()){this.collapse();this.el.focus();}else{this.onFocus({});if(this.triggerAction=='all'){this.doQuery(this.allQuery,true);}else{this.doQuery(this.getRawValue());}
this.el.focus();}}});Ext.reg('combo',Ext.form.ComboBox);Ext.form.Checkbox=Ext.extend(Ext.form.Field,{focusClass:undefined,fieldClass:'x-form-field',checked:false,boxLabel:'&#160;',defaultAutoCreate:{tag:'input',type:'checkbox',autocomplete:'off'},actionMode:'wrap',initComponent:function(){Ext.form.Checkbox.superclass.initComponent.call(this);this.addEvents('check');},onResize:function(){Ext.form.Checkbox.superclass.onResize.apply(this,arguments);if(!this.boxLabel&&!this.fieldLabel){this.el.alignTo(this.wrap,'c-c');}},initEvents:function(){Ext.form.Checkbox.superclass.initEvents.call(this);this.mon(this.el,{scope:this,click:this.onClick,change:this.onClick});},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,onRender:function(ct,position){Ext.form.Checkbox.superclass.onRender.call(this,ct,position);if(this.inputValue!==undefined){this.el.dom.value=this.inputValue;}
this.wrap=this.el.wrap({cls:'x-form-check-wrap'});if(this.boxLabel){this.wrap.createChild({tag:'label',htmlFor:this.el.id,cls:'x-form-cb-label',html:this.boxLabel});}
if(this.checked){this.setValue(true);}else{this.checked=this.el.dom.checked;}
if(Ext.isIE){this.wrap.repaint();}
this.resizeEl=this.positionEl=this.wrap;},onDestroy:function(){Ext.destroy(this.wrap);Ext.form.Checkbox.superclass.onDestroy.call(this);},initValue:function(){this.originalValue=this.getValue();},getValue:function(){if(this.rendered){return this.el.dom.checked;}
return this.checked;},onClick:function(){if(this.el.dom.checked!=this.checked){this.setValue(this.el.dom.checked);}},setValue:function(v){var checked=this.checked;this.checked=(v===true||v==='true'||v=='1'||String(v).toLowerCase()=='on');if(this.rendered){this.el.dom.checked=this.checked;this.el.dom.defaultChecked=this.checked;}
if(checked!=this.checked){this.fireEvent('check',this,this.checked);if(this.handler){this.handler.call(this.scope||this,this,this.checked);}}
return this;}});Ext.reg('checkbox',Ext.form.Checkbox);Ext.form.CheckboxGroup=Ext.extend(Ext.form.Field,{columns:'auto',vertical:false,allowBlank:true,blankText:"You must select at least one item in this group",defaultType:'checkbox',groupCls:'x-form-check-group',initComponent:function(){this.addEvents('change');this.on('change',this.validate,this);Ext.form.CheckboxGroup.superclass.initComponent.call(this);},onRender:function(ct,position){if(!this.el){var panelCfg={autoEl:{id:this.id},cls:this.groupCls,layout:'column',renderTo:ct,bufferResize:false};var colCfg={xtype:'container',defaultType:this.defaultType,layout:'form',defaults:{hideLabel:true,anchor:'100%'}};if(this.items[0].items){Ext.apply(panelCfg,{layoutConfig:{columns:this.items.length},defaults:this.defaults,items:this.items});for(var i=0,len=this.items.length;i<len;i++){Ext.applyIf(this.items[i],colCfg);}}else{var numCols,cols=[];if(typeof this.columns=='string'){this.columns=this.items.length;}
if(!Ext.isArray(this.columns)){var cs=[];for(var i=0;i<this.columns;i++){cs.push((100/this.columns)*.01);}
this.columns=cs;}
numCols=this.columns.length;for(var i=0;i<numCols;i++){var cc=Ext.apply({items:[]},colCfg);cc[this.columns[i]<=1?'columnWidth':'width']=this.columns[i];if(this.defaults){cc.defaults=Ext.apply(cc.defaults||{},this.defaults);}
cols.push(cc);};if(this.vertical){var rows=Math.ceil(this.items.length/numCols),ri=0;for(var i=0,len=this.items.length;i<len;i++){if(i>0&&i%rows==0){ri++;}
if(this.items[i].fieldLabel){this.items[i].hideLabel=false;}
cols[ri].items.push(this.items[i]);};}else{for(var i=0,len=this.items.length;i<len;i++){var ci=i%numCols;if(this.items[i].fieldLabel){this.items[i].hideLabel=false;}
cols[ci].items.push(this.items[i]);};}
Ext.apply(panelCfg,{layoutConfig:{columns:numCols},items:cols});}
this.panel=new Ext.Container(panelCfg);this.panel.ownerCt=this;this.el=this.panel.getEl();if(this.forId&&this.itemCls){var l=this.el.up(this.itemCls).child('label',true);if(l){l.setAttribute('htmlFor',this.forId);}}
var fields=this.panel.findBy(function(c){return c.isFormField;},this);this.items=new Ext.util.MixedCollection();this.items.addAll(fields);}
Ext.form.CheckboxGroup.superclass.onRender.call(this,ct,position);},initValue:function(){if(this.value){this.setValue.apply(this,this.buffered?this.value:[this.value]);delete this.buffered;delete this.value;}},afterRender:function(){Ext.form.CheckboxGroup.superclass.afterRender.call(this);this.eachItem(function(item){item.on('check',this.fireChecked,this);item.inGroup=true;});},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;this.panel.doLayout();}},fireChecked:function(){var arr=[];this.eachItem(function(item){if(item.checked){arr.push(item);}});this.fireEvent('change',this,arr);},getErrors:function(){var errors=Ext.form.CheckboxGroup.superclass.getErrors.apply(this,arguments);if(!this.allowBlank){var blank=true;this.eachItem(function(f){if(f.checked){return(blank=false);}});if(blank)errors.push(this.blankText);}
return errors;},isDirty:function(){if(this.disabled||!this.rendered){return false;}
var dirty=false;this.eachItem(function(item){if(item.isDirty()){dirty=true;return false;}});return dirty;},setReadOnly:function(readOnly){if(this.rendered){this.eachItem(function(item){item.setReadOnly(readOnly);});}
this.readOnly=readOnly;},onDisable:function(){this.eachItem(function(item){item.disable();});},onEnable:function(){this.eachItem(function(item){item.enable();});},onResize:function(w,h){this.panel.setSize(w,h);this.panel.doLayout();},reset:function(){if(this.originalValue){this.eachItem(function(c){if(c.setValue){c.setValue(false);c.originalValue=c.getValue();}});this.resetOriginal=true;this.setValue(this.originalValue);delete this.resetOriginal;}else{this.eachItem(function(c){if(c.reset){c.reset();}});}
(function(){this.clearInvalid();}).defer(50,this);},setValue:function(){if(this.rendered){this.onSetValue.apply(this,arguments);}else{this.buffered=true;this.value=arguments;}
return this;},onSetValue:function(id,value){if(arguments.length==1){if(Ext.isArray(id)){Ext.each(id,function(val,idx){if(Ext.isObject(val)&&val.setValue){val.setValue(true);if(this.resetOriginal===true){val.originalValue=val.getValue();}}else{var item=this.items.itemAt(idx);if(item){item.setValue(val);}}},this);}else if(Ext.isObject(id)){for(var i in id){var f=this.getBox(i);if(f){f.setValue(id[i]);}}}else{this.setValueForItem(id);}}else{var f=this.getBox(id);if(f){f.setValue(value);}}},beforeDestroy:function(){Ext.destroy(this.panel);Ext.form.CheckboxGroup.superclass.beforeDestroy.call(this);},setValueForItem:function(val){val=String(val).split(',');this.eachItem(function(item){if(val.indexOf(item.inputValue)>-1){item.setValue(true);}});},getBox:function(id){var box=null;this.eachItem(function(f){if(id==f||f.dataIndex==id||f.id==id||f.getName()==id){box=f;return false;}});return box;},getValue:function(){var out=[];this.eachItem(function(item){if(item.checked){out.push(item);}});return out;},eachItem:function(fn,scope){if(this.items&&this.items.each){this.items.each(fn,scope||this);}},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg('checkboxgroup',Ext.form.CheckboxGroup);Ext.form.CompositeField=Ext.extend(Ext.form.Field,{defaultMargins:'0 5 0 0',skipLastItemMargin:true,isComposite:true,combineErrors:true,initComponent:function(){var labels=[],items=this.items,item;for(var i=0,j=items.length;i<j;i++){item=items[i];labels.push(item.fieldLabel);Ext.apply(item,this.defaults);if(!(i==j-1&&this.skipLastItemMargin)){Ext.applyIf(item,{margins:this.defaultMargins});}}
this.fieldLabel=this.fieldLabel||this.buildLabel(labels);this.fieldErrors=new Ext.util.MixedCollection(true,function(item){return item.field;});this.fieldErrors.on({scope:this,add:this.updateInvalidMark,remove:this.updateInvalidMark,replace:this.updateInvalidMark});Ext.form.CompositeField.superclass.initComponent.apply(this,arguments);},onRender:function(ct,position){if(!this.el){var innerCt=this.innerCt=new Ext.Container({layout:'hbox',renderTo:ct,items:this.items,cls:'x-form-composite',defaultMargins:'0 3 0 0'});this.el=innerCt.getEl();var fields=innerCt.findBy(function(c){return c.isFormField;},this);this.items=new Ext.util.MixedCollection();this.items.addAll(fields);if(this.combineErrors){this.eachItem(function(field){Ext.apply(field,{markInvalid:this.onFieldMarkInvalid.createDelegate(this,[field],0),clearInvalid:this.onFieldClearInvalid.createDelegate(this,[field],0)});});}
var l=this.el.parent().parent().child('label',true);if(l){l.setAttribute('for',this.items.items[0].id);}}
Ext.form.CompositeField.superclass.onRender.apply(this,arguments);},onFieldMarkInvalid:function(field,message){var name=field.getName(),error={field:name,error:message};this.fieldErrors.replace(name,error);field.el.addClass(field.invalidClass);},onFieldClearInvalid:function(field){this.fieldErrors.removeKey(field.getName());field.el.removeClass(field.invalidClass);},updateInvalidMark:function(){var ieStrict=Ext.isIE6&&Ext.isStrict;if(this.fieldErrors.length==0){this.clearInvalid();if(ieStrict){this.clearInvalid.defer(50,this);}}else{var message=this.buildCombinedErrorMessage(this.fieldErrors.items);this.sortErrors();this.markInvalid(message);if(ieStrict){this.markInvalid(message);}}},validateValue:function(){var valid=true;this.eachItem(function(field){if(!field.isValid())valid=false;});return valid;},buildCombinedErrorMessage:function(errors){var combined=[],error;for(var i=0,j=errors.length;i<j;i++){error=errors[i];combined.push(String.format("{0}: {1}",error.field,error.error));}
return combined.join("<br />");},sortErrors:function(){var fields=this.items;this.fieldErrors.sort("ASC",function(a,b){var findByName=function(key){return function(field){return field.getName()==key;};};var aIndex=fields.findIndexBy(findByName(a.field)),bIndex=fields.findIndexBy(findByName(b.field));return aIndex<bIndex?-1:1;});},reset:function(){this.eachItem(function(item){item.reset();});(function(){this.clearInvalid();}).defer(50,this);},clearInvalidChildren:function(){this.eachItem(function(item){item.clearInvalid();});},buildLabel:function(segments){return segments.join(", ");},isDirty:function(){if(this.disabled||!this.rendered){return false;}
var dirty=false;this.eachItem(function(item){if(item.isDirty()){dirty=true;return false;}});return dirty;},eachItem:function(fn,scope){if(this.items&&this.items.each){this.items.each(fn,scope||this);}},onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){var innerCt=this.innerCt;if(this.rendered&&innerCt.rendered){innerCt.setSize(adjWidth,adjHeight);}
Ext.form.CompositeField.superclass.onResize.apply(this,arguments);},doLayout:function(shallow,force){if(this.rendered){var innerCt=this.innerCt;innerCt.forceLayout=this.ownerCt.forceLayout;innerCt.doLayout(shallow,force);}},beforeDestroy:function(){Ext.destroy(this.innerCt);Ext.form.CompositeField.superclass.beforeDestroy.call(this);},setReadOnly:function(readOnly){readOnly=readOnly||true;if(this.rendered){this.eachItem(function(item){item.setReadOnly(readOnly);});}
this.readOnly=readOnly;},onShow:function(){Ext.form.CompositeField.superclass.onShow.call(this);this.doLayout();},onDisable:function(){this.eachItem(function(item){item.disable();});},onEnable:function(){this.eachItem(function(item){item.enable();});}});Ext.reg('compositefield',Ext.form.CompositeField);Ext.form.Radio=Ext.extend(Ext.form.Checkbox,{inputType:'radio',markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,getGroupValue:function(){var p=this.el.up('form')||Ext.getBody();var c=p.child('input[name='+this.el.dom.name+']:checked',true);return c?c.value:null;},onClick:function(){if(this.el.dom.checked!=this.checked){var els=this.getCheckEl().select('input[name='+this.el.dom.name+']');els.each(function(el){if(el.dom.id==this.id){this.setValue(true);}else{Ext.getCmp(el.dom.id).setValue(false);}},this);}},setValue:function(v){if(typeof v=='boolean'){Ext.form.Radio.superclass.setValue.call(this,v);}else if(this.rendered){var r=this.getCheckEl().child('input[name='+this.el.dom.name+'][value='+v+']',true);if(r){Ext.getCmp(r.id).setValue(true);}}
return this;},getCheckEl:function(){if(this.inGroup){return this.el.up('.x-form-radio-group')}
return this.el.up('form')||Ext.getBody();}});Ext.reg('radio',Ext.form.Radio);Ext.form.RadioGroup=Ext.extend(Ext.form.CheckboxGroup,{allowBlank:true,blankText:'You must select one item in this group',defaultType:'radio',groupCls:'x-form-radio-group',getValue:function(){var out=null;this.eachItem(function(item){if(item.checked){out=item;return false;}});return out;},onSetValue:function(id,value){if(arguments.length>1){var f=this.getBox(id);if(f){f.setValue(value);if(f.checked){this.eachItem(function(item){if(item!==f){item.setValue(false);}});}}}else{this.setValueForItem(id);}},setValueForItem:function(val){val=String(val).split(',')[0];this.eachItem(function(item){item.setValue(val==item.inputValue);});},fireChecked:function(){if(!this.checkTask){this.checkTask=new Ext.util.DelayedTask(this.bufferChecked,this);}
this.checkTask.delay(10);},bufferChecked:function(){var out=null;this.eachItem(function(item){if(item.checked){out=item;return false;}});this.fireEvent('change',this,out);},onDestroy:function(){if(this.checkTask){this.checkTask.cancel();this.checkTask=null;}
Ext.form.RadioGroup.superclass.onDestroy.call(this);}});Ext.reg('radiogroup',Ext.form.RadioGroup);Ext.form.Hidden=Ext.extend(Ext.form.Field,{inputType:'hidden',onRender:function(){Ext.form.Hidden.superclass.onRender.apply(this,arguments);},initEvents:function(){this.originalValue=this.getValue();},setSize:Ext.emptyFn,setWidth:Ext.emptyFn,setHeight:Ext.emptyFn,setPosition:Ext.emptyFn,setPagePosition:Ext.emptyFn,markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn});Ext.reg('hidden',Ext.form.Hidden);Ext.form.BasicForm=Ext.extend(Ext.util.Observable,{constructor:function(el,config){Ext.apply(this,config);if(Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/);}
this.items=new Ext.util.MixedCollection(false,function(o){return o.getItemId();});this.addEvents('beforeaction','actionfailed','actioncomplete');if(el){this.initEl(el);}
Ext.form.BasicForm.superclass.constructor.call(this);},timeout:30,paramOrder:undefined,paramsAsHash:false,waitTitle:'Please Wait...',activeAction:null,trackResetOnLoad:false,initEl:function(el){this.el=Ext.get(el);this.id=this.el.id||Ext.id();if(!this.standardSubmit){this.el.on('submit',this.onSubmit,this);}
this.el.addClass('x-form');},getEl:function(){return this.el;},onSubmit:function(e){e.stopEvent();},destroy:function(bound){if(bound!==true){this.items.each(function(f){Ext.destroy(f);});Ext.destroy(this.el);}
this.items.clear();this.purgeListeners();},isValid:function(){var valid=true;this.items.each(function(f){if(!f.validate()){valid=false;}});return valid;},isDirty:function(){var dirty=false;this.items.each(function(f){if(f.isDirty()){dirty=true;return false;}});return dirty;},doAction:function(action,options){if(Ext.isString(action)){action=new Ext.form.Action.ACTION_TYPES[action](this,options);}
if(this.fireEvent('beforeaction',this,action)!==false){this.beforeAction(action);action.run.defer(100,action);}
return this;},submit:function(options){options=options||{};if(this.standardSubmit){var v=options.clientValidation===false||this.isValid();if(v){var el=this.el.dom;if(this.url&&Ext.isEmpty(el.action)){el.action=this.url;}
el.submit();}
return v;}
var submitAction=String.format('{0}submit',this.api?'direct':'');this.doAction(submitAction,options);return this;},load:function(options){var loadAction=String.format('{0}load',this.api?'direct':'');this.doAction(loadAction,options);return this;},updateRecord:function(record){record.beginEdit();var fs=record.fields;fs.each(function(f){var field=this.findField(f.name);if(field){record.set(f.name,field.getValue());}},this);record.endEdit();return this;},loadRecord:function(record){this.setValues(record.data);return this;},beforeAction:function(action){this.items.each(function(f){if(f.isFormField&&f.syncValue){f.syncValue();}});var o=action.options;if(o.waitMsg){if(this.waitMsgTarget===true){this.el.mask(o.waitMsg,'x-mask-loading');}else if(this.waitMsgTarget){this.waitMsgTarget=Ext.get(this.waitMsgTarget);this.waitMsgTarget.mask(o.waitMsg,'x-mask-loading');}else{Ext.MessageBox.wait(o.waitMsg,o.waitTitle||this.waitTitle);}}},afterAction:function(action,success){this.activeAction=null;var o=action.options;if(o.waitMsg){if(this.waitMsgTarget===true){this.el.unmask();}else if(this.waitMsgTarget){this.waitMsgTarget.unmask();}else{Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide();}}
if(success){if(o.reset){this.reset();}
Ext.callback(o.success,o.scope,[this,action]);this.fireEvent('actioncomplete',this,action);}else{Ext.callback(o.failure,o.scope,[this,action]);this.fireEvent('actionfailed',this,action);}},findField:function(id){var field=this.items.get(id);if(!Ext.isObject(field)){var findMatchingField=function(f){if(f.isFormField){if(f.dataIndex==id||f.id==id||f.getName()==id){field=f;return false;}else if(f.isComposite&&f.rendered){return f.items.each(findMatchingField);}}};this.items.each(findMatchingField);}
return field||null;},markInvalid:function(errors){if(Ext.isArray(errors)){for(var i=0,len=errors.length;i<len;i++){var fieldError=errors[i];var f=this.findField(fieldError.id);if(f){f.markInvalid(fieldError.msg);}}}else{var field,id;for(id in errors){if(!Ext.isFunction(errors[id])&&(field=this.findField(id))){field.markInvalid(errors[id]);}}}
return this;},setValues:function(values){if(Ext.isArray(values)){for(var i=0,len=values.length;i<len;i++){var v=values[i];var f=this.findField(v.id);if(f){f.setValue(v.value);if(this.trackResetOnLoad){f.originalValue=f.getValue();}}}}else{var field,id;for(id in values){if(!Ext.isFunction(values[id])&&(field=this.findField(id))){field.setValue(values[id]);if(this.trackResetOnLoad){field.originalValue=field.getValue();}}}}
return this;},getValues:function(asString){var fs=Ext.lib.Ajax.serializeForm(this.el.dom);if(asString===true){return fs;}
return Ext.urlDecode(fs);},getFieldValues:function(dirtyOnly){var o={},n,key,val;this.items.each(function(f){if(dirtyOnly!==true||f.isDirty()){n=f.getName();key=o[n];val=f.getValue();if(Ext.isDefined(key)){if(Ext.isArray(key)){o[n].push(val);}else{o[n]=[key,val];}}else{o[n]=val;}}});return o;},clearInvalid:function(){this.items.each(function(f){f.clearInvalid();});return this;},reset:function(){this.items.each(function(f){f.reset();});return this;},add:function(){this.items.addAll(Array.prototype.slice.call(arguments,0));return this;},remove:function(field){this.items.remove(field);return this;},cleanDestroyed:function(){this.items.filterBy(function(o){return!!o.isDestroyed;}).each(this.remove,this);},render:function(){this.items.each(function(f){if(f.isFormField&&!f.rendered&&document.getElementById(f.id)){f.applyToMarkup(f.id);}});return this;},applyToFields:function(o){this.items.each(function(f){Ext.apply(f,o);});return this;},applyIfToFields:function(o){this.items.each(function(f){Ext.applyIf(f,o);});return this;},callFieldMethod:function(fnName,args){args=args||[];this.items.each(function(f){if(Ext.isFunction(f[fnName])){f[fnName].apply(f,args);}});return this;}});Ext.BasicForm=Ext.form.BasicForm;Ext.FormPanel=Ext.extend(Ext.Panel,{minButtonWidth:75,labelAlign:'left',monitorValid:false,monitorPoll:200,layout:'form',initComponent:function(){this.form=this.createForm();Ext.FormPanel.superclass.initComponent.call(this);this.bodyCfg={tag:'form',cls:this.baseCls+'-body',method:this.method||'POST',id:this.formId||Ext.id()};if(this.fileUpload){this.bodyCfg.enctype='multipart/form-data';}
this.initItems();this.addEvents('clientvalidation');this.relayEvents(this.form,['beforeaction','actionfailed','actioncomplete']);},createForm:function(){var config=Ext.applyIf({listeners:{}},this.initialConfig);return new Ext.form.BasicForm(null,config);},initFields:function(){var f=this.form;var formPanel=this;var fn=function(c){if(formPanel.isField(c)){f.add(c);}else if(c.findBy&&c!=formPanel){formPanel.applySettings(c);if(c.items&&c.items.each){c.items.each(fn,this);}}};this.items.each(fn,this);},applySettings:function(c){var ct=c.ownerCt;Ext.applyIf(c,{labelAlign:ct.labelAlign,labelWidth:ct.labelWidth,itemCls:ct.itemCls});},getLayoutTarget:function(){return this.form.el;},getForm:function(){return this.form;},onRender:function(ct,position){this.initFields();Ext.FormPanel.superclass.onRender.call(this,ct,position);this.form.initEl(this.body);},beforeDestroy:function(){this.stopMonitoring();this.form.destroy(true);Ext.FormPanel.superclass.beforeDestroy.call(this);},isField:function(c){return!!c.setValue&&!!c.getValue&&!!c.markInvalid&&!!c.clearInvalid;},initEvents:function(){Ext.FormPanel.superclass.initEvents.call(this);this.on({scope:this,add:this.onAddEvent,remove:this.onRemoveEvent});if(this.monitorValid){this.startMonitoring();}},onAdd:function(c){Ext.FormPanel.superclass.onAdd.call(this,c);this.processAdd(c);},onAddEvent:function(ct,c){if(ct!==this){this.processAdd(c);}},processAdd:function(c){if(this.isField(c)){this.form.add(c);}else if(c.findBy){this.applySettings(c);this.form.add.apply(this.form,c.findBy(this.isField));}},onRemove:function(c){Ext.FormPanel.superclass.onRemove.call(this,c);this.processRemove(c);},onRemoveEvent:function(ct,c){if(ct!==this){this.processRemove(c);}},processRemove:function(c){if(!this.destroying){if(this.isField(c)){this.form.remove(c);}else if(c.findBy){Ext.each(c.findBy(this.isField),this.form.remove,this.form);if(c.isDestroyed){this.form.cleanDestroyed();}}}},startMonitoring:function(){if(!this.validTask){this.validTask=new Ext.util.TaskRunner();this.validTask.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this});}},stopMonitoring:function(){if(this.validTask){this.validTask.stopAll();this.validTask=null;}},load:function(){this.form.load.apply(this.form,arguments);},onDisable:function(){Ext.FormPanel.superclass.onDisable.call(this);if(this.form){this.form.items.each(function(){this.disable();});}},onEnable:function(){Ext.FormPanel.superclass.onEnable.call(this);if(this.form){this.form.items.each(function(){this.enable();});}},bindHandler:function(){var valid=true;this.form.items.each(function(f){if(!f.isValid(true)){valid=false;return false;}});if(this.fbar){var fitems=this.fbar.items.items;for(var i=0,len=fitems.length;i<len;i++){var btn=fitems[i];if(btn.formBind===true&&btn.disabled===valid){btn.setDisabled(!valid);}}}
this.fireEvent('clientvalidation',this,valid);}});Ext.reg('form',Ext.FormPanel);Ext.form.FormPanel=Ext.FormPanel;Ext.form.FieldSet=Ext.extend(Ext.Panel,{baseCls:'x-fieldset',layout:'form',animCollapse:false,onRender:function(ct,position){if(!this.el){this.el=document.createElement('fieldset');this.el.id=this.id;if(this.title||this.header||this.checkboxToggle){this.el.appendChild(document.createElement('legend')).className=this.baseCls+'-header';}}
Ext.form.FieldSet.superclass.onRender.call(this,ct,position);if(this.checkboxToggle){var o=typeof this.checkboxToggle=='object'?this.checkboxToggle:{tag:'input',type:'checkbox',name:this.checkboxName||this.id+'-checkbox'};this.checkbox=this.header.insertFirst(o);this.checkbox.dom.checked=!this.collapsed;this.mon(this.checkbox,'click',this.onCheckClick,this);}},onCollapse:function(doAnim,animArg){if(this.checkbox){this.checkbox.dom.checked=false;}
Ext.form.FieldSet.superclass.onCollapse.call(this,doAnim,animArg);},onExpand:function(doAnim,animArg){if(this.checkbox){this.checkbox.dom.checked=true;}
Ext.form.FieldSet.superclass.onExpand.call(this,doAnim,animArg);},onCheckClick:function(){this[this.checkbox.dom.checked?'expand':'collapse']();}});Ext.reg('fieldset',Ext.form.FieldSet);Ext.form.HtmlEditor=Ext.extend(Ext.form.Field,{enableFormat:true,enableFontSize:true,enableColors:true,enableAlignments:true,enableLists:true,enableSourceEdit:true,enableLinks:true,enableFont:true,createLinkText:'Please enter the URL for the link:',defaultLinkValue:'http:/'+'/',fontFamilies:['Arial','Courier New','Tahoma','Times New Roman','Verdana'],defaultFont:'tahoma',defaultValue:(Ext.isOpera||Ext.isIE6)?'&#160;':'&#8203;',actionMode:'wrap',validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:Ext.emptyFn,iframePad:3,hideMode:'offsets',defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},initComponent:function(){this.addEvents('initialize','activate','beforesync','beforepush','sync','push','editmodechange');},createFontOptions:function(){var buf=[],fs=this.fontFamilies,ff,lc;for(var i=0,len=fs.length;i<len;i++){ff=fs[i];lc=ff.toLowerCase();buf.push('<option value="',lc,'" style="font-family:',ff,';"',(this.defaultFont==lc?' selected="true">':'>'),ff,'</option>');}
return buf.join('');},createToolbar:function(editor){var items=[];var tipsEnabled=Ext.QuickTips&&Ext.QuickTips.isEnabled();function btn(id,toggle,handler){return{itemId:id,cls:'x-btn-icon',iconCls:'x-edit-'+id,enableToggle:toggle!==false,scope:editor,handler:handler||editor.relayBtnCmd,clickEvent:'mousedown',tooltip:tipsEnabled?editor.buttonTips[id]||undefined:undefined,overflowText:editor.buttonTips[id].title||undefined,tabIndex:-1};}
if(this.enableFont&&!Ext.isSafari2){var fontSelectItem=new Ext.Toolbar.Item({autoEl:{tag:'select',cls:'x-font-select',html:this.createFontOptions()}});items.push(fontSelectItem,'-');}
if(this.enableFormat){items.push(btn('bold'),btn('italic'),btn('underline'));}
if(this.enableFontSize){items.push('-',btn('increasefontsize',false,this.adjustFont),btn('decreasefontsize',false,this.adjustFont));}
if(this.enableColors){items.push('-',{itemId:'forecolor',cls:'x-btn-icon',iconCls:'x-edit-forecolor',clickEvent:'mousedown',tooltip:tipsEnabled?editor.buttonTips.forecolor||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({allowReselect:true,focus:Ext.emptyFn,value:'000000',plain:true,listeners:{scope:this,select:function(cp,color){this.execCmd('forecolor',Ext.isWebKit||Ext.isIE?'#'+color:color);this.deferFocus();}},clickEvent:'mousedown'})},{itemId:'backcolor',cls:'x-btn-icon',iconCls:'x-edit-backcolor',clickEvent:'mousedown',tooltip:tipsEnabled?editor.buttonTips.backcolor||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({focus:Ext.emptyFn,value:'FFFFFF',plain:true,allowReselect:true,listeners:{scope:this,select:function(cp,color){if(Ext.isGecko){this.execCmd('useCSS',false);this.execCmd('hilitecolor',color);this.execCmd('useCSS',true);this.deferFocus();}else{this.execCmd(Ext.isOpera?'hilitecolor':'backcolor',Ext.isWebKit||Ext.isIE?'#'+color:color);this.deferFocus();}}},clickEvent:'mousedown'})});}
if(this.enableAlignments){items.push('-',btn('justifyleft'),btn('justifycenter'),btn('justifyright'));}
if(!Ext.isSafari2){if(this.enableLinks){items.push('-',btn('createlink',false,this.createLink));}
if(this.enableLists){items.push('-',btn('insertorderedlist'),btn('insertunorderedlist'));}
if(this.enableSourceEdit){items.push('-',btn('sourceedit',true,function(btn){this.toggleSourceEdit(!this.sourceEditMode);}));}}
var tb=new Ext.Toolbar({renderTo:this.wrap.dom.firstChild,items:items});if(fontSelectItem){this.fontSelect=fontSelectItem.el;this.mon(this.fontSelect,'change',function(){var font=this.fontSelect.dom.value;this.relayCmd('fontname',font);this.deferFocus();},this);}
this.mon(tb.el,'click',function(e){e.preventDefault();});this.tb=tb;this.tb.doLayout();},onDisable:function(){this.wrap.mask();Ext.form.HtmlEditor.superclass.onDisable.call(this);},onEnable:function(){this.wrap.unmask();Ext.form.HtmlEditor.superclass.onEnable.call(this);},setReadOnly:function(readOnly){Ext.form.HtmlEditor.superclass.setReadOnly.call(this,readOnly);if(this.initialized){if(Ext.isIE){this.getEditorBody().contentEditable=!readOnly;}else{this.setDesignMode(!readOnly);}
var bd=this.getEditorBody();if(bd){bd.style.cursor=this.readOnly?'default':'text';}
this.disableItems(readOnly);}},getDocMarkup:function(){var h=Ext.fly(this.iframe).getHeight()-this.iframePad*2;return String.format('<html><head><style type="text/css">body{border: 0; margin: 0; padding: {0}px; height: {1}px; cursor: text}</style></head><body></body></html>',this.iframePad,h);},getEditorBody:function(){var doc=this.getDoc();return doc.body||doc.documentElement;},getDoc:function(){return Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document);},getWin:function(){return Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name];},onRender:function(ct,position){Ext.form.HtmlEditor.superclass.onRender.call(this,ct,position);this.el.dom.style.border='0 none';this.el.dom.setAttribute('tabIndex',-1);this.el.addClass('x-hidden');if(Ext.isIE){this.el.applyStyles('margin-top:-1px;margin-bottom:-1px;');}
this.wrap=this.el.wrap({cls:'x-html-editor-wrap',cn:{cls:'x-html-editor-tb'}});this.createToolbar(this);this.disableItems(true);this.tb.doLayout();this.createIFrame();if(!this.width){var sz=this.el.getSize();this.setSize(sz.width,this.height||sz.height);}
this.resizeEl=this.positionEl=this.wrap;},createIFrame:function(){var iframe=document.createElement('iframe');iframe.name=Ext.id();iframe.frameBorder='0';iframe.style.overflow='auto';this.wrap.dom.appendChild(iframe);this.iframe=iframe;this.monitorTask=Ext.TaskMgr.start({run:this.checkDesignMode,scope:this,interval:100});},initFrame:function(){Ext.TaskMgr.stop(this.monitorTask);var doc=this.getDoc();this.win=this.getWin();doc.open();doc.write(this.getDocMarkup());doc.close();var task={run:function(){var doc=this.getDoc();if(doc.body||doc.readyState=='complete'){Ext.TaskMgr.stop(task);this.setDesignMode(true);this.initEditor.defer(10,this);}},interval:10,duration:10000,scope:this};Ext.TaskMgr.start(task);},checkDesignMode:function(){if(this.wrap&&this.wrap.dom.offsetWidth){var doc=this.getDoc();if(!doc){return;}
if(!doc.editorInitialized||this.getDesignMode()!='on'){this.initFrame();}}},setDesignMode:function(mode){var doc;if(doc=this.getDoc()){if(this.readOnly){mode=false;}
doc.designMode=(/on|true/i).test(String(mode).toLowerCase())?'on':'off';}},getDesignMode:function(){var doc=this.getDoc();if(!doc){return'';}
return String(doc.designMode).toLowerCase();},disableItems:function(disabled){if(this.fontSelect){this.fontSelect.dom.disabled=disabled;}
this.tb.items.each(function(item){if(item.getItemId()!='sourceedit'){item.setDisabled(disabled);}});},onResize:function(w,h){Ext.form.HtmlEditor.superclass.onResize.apply(this,arguments);if(this.el&&this.iframe){if(Ext.isNumber(w)){var aw=w-this.wrap.getFrameWidth('lr');this.el.setWidth(aw);this.tb.setWidth(aw);this.iframe.style.width=Math.max(aw,0)+'px';}
if(Ext.isNumber(h)){var ah=h-this.wrap.getFrameWidth('tb')-this.tb.el.getHeight();this.el.setHeight(ah);this.iframe.style.height=Math.max(ah,0)+'px';var bd=this.getEditorBody();if(bd){bd.style.height=Math.max((ah-(this.iframePad*2)),0)+'px';}}}},toggleSourceEdit:function(sourceEditMode){var iframeHeight,elHeight,ls;if(sourceEditMode===undefined){sourceEditMode=!this.sourceEditMode;}
this.sourceEditMode=sourceEditMode===true;var btn=this.tb.getComponent('sourceedit');if(btn.pressed!==this.sourceEditMode){btn.toggle(this.sourceEditMode);if(!btn.xtbHidden){return;}}
if(this.sourceEditMode){ls=this.getSize();iframeHeight=Ext.get(this.iframe).getHeight();this.disableItems(true);this.syncValue();this.iframe.className='x-hidden';this.el.removeClass('x-hidden');this.el.dom.removeAttribute('tabIndex');this.el.focus();this.el.dom.style.height=iframeHeight+'px';}
else{elHeight=parseInt(this.el.dom.style.height,10);if(this.initialized){this.disableItems(this.readOnly);}
this.pushValue();this.iframe.className='';this.el.addClass('x-hidden');this.el.dom.setAttribute('tabIndex',-1);this.deferFocus();this.setSize(ls);this.iframe.style.height=elHeight+'px';}
this.fireEvent('editmodechange',this,this.sourceEditMode);},createLink:function(){var url=prompt(this.createLinkText,this.defaultLinkValue);if(url&&url!='http:/'+'/'){this.relayCmd('createlink',url);}},initEvents:function(){this.originalValue=this.getValue();},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,setValue:function(v){Ext.form.HtmlEditor.superclass.setValue.call(this,v);this.pushValue();return this;},cleanHtml:function(html){html=String(html);if(Ext.isWebKit){html=html.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,'');}
if(html.charCodeAt(0)==this.defaultValue.replace(/\D/g,'')){html=html.substring(1);}
return html;},syncValue:function(){if(this.initialized){var bd=this.getEditorBody();var html=bd.innerHTML;if(Ext.isWebKit){var bs=bd.getAttribute('style');var m=bs.match(/text-align:(.*?);/i);if(m&&m[1]){html='<div style="'+m[0]+'">'+html+'</div>';}}
html=this.cleanHtml(html);if(this.fireEvent('beforesync',this,html)!==false){this.el.dom.value=html;this.fireEvent('sync',this,html);}}},getValue:function(){this[this.sourceEditMode?'pushValue':'syncValue']();return Ext.form.HtmlEditor.superclass.getValue.call(this);},pushValue:function(){if(this.initialized){var v=this.el.dom.value;if(!this.activated&&v.length<1){v=this.defaultValue;}
if(this.fireEvent('beforepush',this,v)!==false){this.getEditorBody().innerHTML=v;if(Ext.isGecko){this.setDesignMode(false);this.setDesignMode(true);}
this.fireEvent('push',this,v);}}},deferFocus:function(){this.focus.defer(10,this);},focus:function(){if(this.win&&!this.sourceEditMode){this.win.focus();}else{this.el.focus();}},initEditor:function(){try{var dbody=this.getEditorBody(),ss=this.el.getStyles('font-size','font-family','background-image','background-repeat','background-color','color'),doc,fn;ss['background-attachment']='fixed';dbody.bgProperties='fixed';Ext.DomHelper.applyStyles(dbody,ss);doc=this.getDoc();if(doc){try{Ext.EventManager.removeAll(doc);}catch(e){}}
fn=this.onEditorEvent.createDelegate(this);Ext.EventManager.on(doc,{mousedown:fn,dblclick:fn,click:fn,keyup:fn,buffer:100});if(Ext.isGecko){Ext.EventManager.on(doc,'keypress',this.applyCommand,this);}
if(Ext.isIE||Ext.isWebKit||Ext.isOpera){Ext.EventManager.on(doc,'keydown',this.fixKeys,this);}
doc.editorInitialized=true;this.initialized=true;this.pushValue();this.setReadOnly(this.readOnly);this.fireEvent('initialize',this);}catch(e){}},onDestroy:function(){if(this.monitorTask){Ext.TaskMgr.stop(this.monitorTask);}
if(this.rendered){Ext.destroy(this.tb);var doc=this.getDoc();if(doc){try{Ext.EventManager.removeAll(doc);for(var prop in doc){delete doc[prop];}}catch(e){}}
if(this.wrap){this.wrap.dom.innerHTML='';this.wrap.remove();}}
if(this.el){this.el.removeAllListeners();this.el.remove();}
this.purgeListeners();},onFirstFocus:function(){this.activated=true;this.disableItems(this.readOnly);if(Ext.isGecko){this.win.focus();var s=this.win.getSelection();if(!s.focusNode||s.focusNode.nodeType!=3){var r=s.getRangeAt(0);r.selectNodeContents(this.getEditorBody());r.collapse(true);this.deferFocus();}
try{this.execCmd('useCSS',true);this.execCmd('styleWithCSS',false);}catch(e){}}
this.fireEvent('activate',this);},adjustFont:function(btn){var adjust=btn.getItemId()=='increasefontsize'?1:-1,doc=this.getDoc(),v=parseInt(doc.queryCommandValue('FontSize')||2,10);if((Ext.isSafari&&!Ext.isSafari2)||Ext.isChrome||Ext.isAir){if(v<=10){v=1+adjust;}else if(v<=13){v=2+adjust;}else if(v<=16){v=3+adjust;}else if(v<=18){v=4+adjust;}else if(v<=24){v=5+adjust;}else{v=6+adjust;}
v=v.constrain(1,6);}else{if(Ext.isSafari){adjust*=2;}
v=Math.max(1,v+adjust)+(Ext.isSafari?'px':0);}
this.execCmd('FontSize',v);},onEditorEvent:function(e){this.updateToolbar();},updateToolbar:function(){if(this.readOnly){return;}
if(!this.activated){this.onFirstFocus();return;}
var btns=this.tb.items.map,doc=this.getDoc();if(this.enableFont&&!Ext.isSafari2){var name=(doc.queryCommandValue('FontName')||this.defaultFont).toLowerCase();if(name!=this.fontSelect.dom.value){this.fontSelect.dom.value=name;}}
if(this.enableFormat){btns.bold.toggle(doc.queryCommandState('bold'));btns.italic.toggle(doc.queryCommandState('italic'));btns.underline.toggle(doc.queryCommandState('underline'));}
if(this.enableAlignments){btns.justifyleft.toggle(doc.queryCommandState('justifyleft'));btns.justifycenter.toggle(doc.queryCommandState('justifycenter'));btns.justifyright.toggle(doc.queryCommandState('justifyright'));}
if(!Ext.isSafari2&&this.enableLists){btns.insertorderedlist.toggle(doc.queryCommandState('insertorderedlist'));btns.insertunorderedlist.toggle(doc.queryCommandState('insertunorderedlist'));}
Ext.menu.MenuMgr.hideAll();this.syncValue();},relayBtnCmd:function(btn){this.relayCmd(btn.getItemId());},relayCmd:function(cmd,value){(function(){this.focus();this.execCmd(cmd,value);this.updateToolbar();}).defer(10,this);},execCmd:function(cmd,value){var doc=this.getDoc();doc.execCommand(cmd,false,value===undefined?null:value);this.syncValue();},applyCommand:function(e){if(e.ctrlKey){var c=e.getCharCode(),cmd;if(c>0){c=String.fromCharCode(c);switch(c){case'b':cmd='bold';break;case'i':cmd='italic';break;case'u':cmd='underline';break;}
if(cmd){this.win.focus();this.execCmd(cmd);this.deferFocus();e.preventDefault();}}}},insertAtCursor:function(text){if(!this.activated){return;}
if(Ext.isIE){this.win.focus();var doc=this.getDoc(),r=doc.selection.createRange();if(r){r.pasteHTML(text);this.syncValue();this.deferFocus();}}else{this.win.focus();this.execCmd('InsertHTML',text);this.deferFocus();}},fixKeys:function(){if(Ext.isIE){return function(e){var k=e.getKey(),doc=this.getDoc(),r;if(k==e.TAB){e.stopEvent();r=doc.selection.createRange();if(r){r.collapse(true);r.pasteHTML('&nbsp;&nbsp;&nbsp;&nbsp;');this.deferFocus();}}else if(k==e.ENTER){r=doc.selection.createRange();if(r){var target=r.parentElement();if(!target||target.tagName.toLowerCase()!='li'){e.stopEvent();r.pasteHTML('<br />');r.collapse(false);r.select();}}}};}else if(Ext.isOpera){return function(e){var k=e.getKey();if(k==e.TAB){e.stopEvent();this.win.focus();this.execCmd('InsertHTML','&nbsp;&nbsp;&nbsp;&nbsp;');this.deferFocus();}};}else if(Ext.isWebKit){return function(e){var k=e.getKey();if(k==e.TAB){e.stopEvent();this.execCmd('InsertText','\t');this.deferFocus();}else if(k==e.ENTER){e.stopEvent();this.execCmd('InsertHtml','<br /><br />');this.deferFocus();}};}}(),getToolbar:function(){return this.tb;},buttonTips:{bold:{title:'Bold (Ctrl+B)',text:'Make the selected text bold.',cls:'x-html-editor-tip'},italic:{title:'Italic (Ctrl+I)',text:'Make the selected text italic.',cls:'x-html-editor-tip'},underline:{title:'Underline (Ctrl+U)',text:'Underline the selected text.',cls:'x-html-editor-tip'},increasefontsize:{title:'Grow Text',text:'Increase the font size.',cls:'x-html-editor-tip'},decreasefontsize:{title:'Shrink Text',text:'Decrease the font size.',cls:'x-html-editor-tip'},backcolor:{title:'Text Highlight Color',text:'Change the background color of the selected text.',cls:'x-html-editor-tip'},forecolor:{title:'Font Color',text:'Change the color of the selected text.',cls:'x-html-editor-tip'},justifyleft:{title:'Align Text Left',text:'Align text to the left.',cls:'x-html-editor-tip'},justifycenter:{title:'Center Text',text:'Center text in the editor.',cls:'x-html-editor-tip'},justifyright:{title:'Align Text Right',text:'Align text to the right.',cls:'x-html-editor-tip'},insertunorderedlist:{title:'Bullet List',text:'Start a bulleted list.',cls:'x-html-editor-tip'},insertorderedlist:{title:'Numbered List',text:'Start a numbered list.',cls:'x-html-editor-tip'},createlink:{title:'Hyperlink',text:'Make the selected text a hyperlink.',cls:'x-html-editor-tip'},sourceedit:{title:'Source Edit',text:'Switch to source editing mode.',cls:'x-html-editor-tip'}}});Ext.reg('htmleditor',Ext.form.HtmlEditor);Ext.form.TimeField=Ext.extend(Ext.form.ComboBox,{minValue:undefined,maxValue:undefined,minText:"The time in this field must be equal to or after {0}",maxText:"The time in this field must be equal to or before {0}",invalidText:"{0} is not a valid time",format:"g:i A",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H|gi a|hi a|giA|hiA|gi A|hi A",increment:15,mode:'local',triggerAction:'all',typeAhead:false,initDate:'1/1/2008',initDateFormat:'j/n/Y',initComponent:function(){if(Ext.isDefined(this.minValue)){this.setMinValue(this.minValue,true);}
if(Ext.isDefined(this.maxValue)){this.setMaxValue(this.maxValue,true);}
if(!this.store){this.generateStore(true);}
Ext.form.TimeField.superclass.initComponent.call(this);},setMinValue:function(value,initial){this.setLimit(value,true,initial);return this;},setMaxValue:function(value,initial){this.setLimit(value,false,initial);return this;},generateStore:function(initial){var min=this.minValue||new Date(this.initDate).clearTime(),max=this.maxValue||new Date(this.initDate).clearTime().add('mi',(24*60)-1),times=[];while(min<=max){times.push(min.dateFormat(this.format));min=min.add('mi',this.increment);}
this.bindStore(times,initial);},setLimit:function(value,isMin,initial){var d;if(Ext.isString(value)){d=this.parseDate(value);}else if(Ext.isDate(value)){d=value;}
if(d){var val=new Date(this.initDate).clearTime();val.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds());this[isMin?'minValue':'maxValue']=val;if(!initial){this.generateStore();}}},getValue:function(){var v=Ext.form.TimeField.superclass.getValue.call(this);return this.formatDate(this.parseDate(v))||'';},setValue:function(value){return Ext.form.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(value)));},validateValue:Ext.form.DateField.prototype.validateValue,formatDate:Ext.form.DateField.prototype.formatDate,parseDate:function(value){if(!value||Ext.isDate(value)){return value;}
var id=this.initDate+' ',idf=this.initDateFormat+' ',v=Date.parseDate(id+value,idf+this.format),af=this.altFormats;if(!v&&af){if(!this.altFormatsArray){this.altFormatsArray=af.split("|");}
for(var i=0,afa=this.altFormatsArray,len=afa.length;i<len&&!v;i++){v=Date.parseDate(id+value,idf+afa[i]);}}
return v;}});Ext.reg('timefield',Ext.form.TimeField);Ext.form.SliderField=Ext.extend(Ext.form.Field,{useTips:true,tipText:null,actionMode:'wrap',initComponent:function(){var cfg=Ext.copyTo({id:this.id+'-slider'},this.initialConfig,['vertical','minValue','maxValue','decimalPrecision','keyIncrement','increment','clickToChange','animate']);if(this.useTips){var plug=this.tipText?{getText:this.tipText}:{};cfg.plugins=[new Ext.slider.Tip(plug)];}
this.slider=new Ext.Slider(cfg);Ext.form.SliderField.superclass.initComponent.call(this);},onRender:function(ct,position){this.autoCreate={id:this.id,name:this.name,type:'hidden',tag:'input'};Ext.form.SliderField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap'});this.resizeEl=this.positionEl=this.wrap;this.slider.render(this.wrap);},onResize:function(w,h,aw,ah){Ext.form.SliderField.superclass.onResize.call(this,w,h,aw,ah);this.slider.setSize(w,h);},initEvents:function(){Ext.form.SliderField.superclass.initEvents.call(this);this.slider.on('change',this.onChange,this);},onChange:function(slider,v){this.setValue(v,undefined,true);},onEnable:function(){Ext.form.SliderField.superclass.onEnable.call(this);this.slider.enable();},onDisable:function(){Ext.form.SliderField.superclass.onDisable.call(this);this.slider.disable();},beforeDestroy:function(){Ext.destroy(this.slider);Ext.form.SliderField.superclass.beforeDestroy.call(this);},alignErrorIcon:function(){this.errorIcon.alignTo(this.slider.el,'tl-tr',[2,0]);},setMinValue:function(v){this.slider.setMinValue(v);return this;},setMaxValue:function(v){this.slider.setMaxValue(v);return this;},setValue:function(v,animate,silent){if(!silent){this.slider.setValue(v,animate);}
return Ext.form.SliderField.superclass.setValue.call(this,this.slider.getValue());},getValue:function(){return this.slider.getValue();}});Ext.reg('sliderfield',Ext.form.SliderField);Ext.form.Label=Ext.extend(Ext.BoxComponent,{onRender:function(ct,position){if(!this.el){this.el=document.createElement('label');this.el.id=this.getId();this.el.innerHTML=this.text?Ext.util.Format.htmlEncode(this.text):(this.html||'');if(this.forId){this.el.setAttribute('for',this.forId);}}
Ext.form.Label.superclass.onRender.call(this,ct,position);},setText:function(t,encode){var e=encode===false;this[!e?'text':'html']=t;delete this[e?'text':'html'];if(this.rendered){this.el.dom.innerHTML=encode!==false?Ext.util.Format.htmlEncode(t):t;}
return this;}});Ext.reg('label',Ext.form.Label);Ext.form.Action=function(form,options){this.form=form;this.options=options||{};};Ext.form.Action.CLIENT_INVALID='client';Ext.form.Action.SERVER_INVALID='server';Ext.form.Action.CONNECT_FAILURE='connect';Ext.form.Action.LOAD_FAILURE='load';Ext.form.Action.prototype={type:'default',run:function(options){},success:function(response){},handleResponse:function(response){},failure:function(response){this.response=response;this.failureType=Ext.form.Action.CONNECT_FAILURE;this.form.afterAction(this,false);},processResponse:function(response){this.response=response;if(!response.responseText&&!response.responseXML){return true;}
this.result=this.handleResponse(response);return this.result;},getUrl:function(appendParams){var url=this.options.url||this.form.url||this.form.el.dom.action;if(appendParams){var p=this.getParams();if(p){url=Ext.urlAppend(url,p);}}
return url;},getMethod:function(){return(this.options.method||this.form.method||this.form.el.dom.method||'POST').toUpperCase();},getParams:function(){var bp=this.form.baseParams;var p=this.options.params;if(p){if(typeof p=="object"){p=Ext.urlEncode(Ext.applyIf(p,bp));}else if(typeof p=='string'&&bp){p+='&'+Ext.urlEncode(bp);}}else if(bp){p=Ext.urlEncode(bp);}
return p;},createCallback:function(opts){var opts=opts||{};return{success:this.success,failure:this.failure,scope:this,timeout:(opts.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined};}};Ext.form.Action.Submit=function(form,options){Ext.form.Action.Submit.superclass.constructor.call(this,form,options);};Ext.extend(Ext.form.Action.Submit,Ext.form.Action,{type:'submit',run:function(){var o=this.options,method=this.getMethod(),isGet=method=='GET';if(o.clientValidation===false||this.form.isValid()){if(o.submitEmptyText===false){var fields=this.form.items,emptyFields=[];fields.each(function(f){if(f.el.getValue()==f.emptyText){emptyFields.push(f);f.el.dom.value="";}});}
Ext.Ajax.request(Ext.apply(this.createCallback(o),{form:this.form.el.dom,url:this.getUrl(isGet),method:method,headers:o.headers,params:!isGet?this.getParams():null,isUpload:this.form.fileUpload}));if(o.submitEmptyText===false){Ext.each(emptyFields,function(f){if(f.applyEmptyText){f.applyEmptyText();}});}}else if(o.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false);}},success:function(response){var result=this.processResponse(response);if(result===true||result.success){this.form.afterAction(this,true);return;}
if(result.errors){this.form.markInvalid(result.errors);}
this.failureType=Ext.form.Action.SERVER_INVALID;this.form.afterAction(this,false);},handleResponse:function(response){if(this.form.errorReader){var rs=this.form.errorReader.read(response);var errors=[];if(rs.records){for(var i=0,len=rs.records.length;i<len;i++){var r=rs.records[i];errors[i]=r.data;}}
if(errors.length<1){errors=null;}
return{success:rs.success,errors:errors};}
return Ext.decode(response.responseText);}});Ext.form.Action.Load=function(form,options){Ext.form.Action.Load.superclass.constructor.call(this,form,options);this.reader=this.form.reader;};Ext.extend(Ext.form.Action.Load,Ext.form.Action,{type:'load',run:function(){Ext.Ajax.request(Ext.apply(this.createCallback(this.options),{method:this.getMethod(),url:this.getUrl(false),headers:this.options.headers,params:this.getParams()}));},success:function(response){var result=this.processResponse(response);if(result===true||!result.success||!result.data){this.failureType=Ext.form.Action.LOAD_FAILURE;this.form.afterAction(this,false);return;}
this.form.clearInvalid();this.form.setValues(result.data);this.form.afterAction(this,true);},handleResponse:function(response){if(this.form.reader){var rs=this.form.reader.read(response);var data=rs.records&&rs.records[0]?rs.records[0].data:null;return{success:rs.success,data:data};}
return Ext.decode(response.responseText);}});Ext.form.Action.DirectLoad=Ext.extend(Ext.form.Action.Load,{constructor:function(form,opts){Ext.form.Action.DirectLoad.superclass.constructor.call(this,form,opts);},type:'directload',run:function(){var args=this.getParams();args.push(this.success,this);this.form.api.load.apply(window,args);},getParams:function(){var buf=[],o={};var bp=this.form.baseParams;var p=this.options.params;Ext.apply(o,p,bp);var paramOrder=this.form.paramOrder;if(paramOrder){for(var i=0,len=paramOrder.length;i<len;i++){buf.push(o[paramOrder[i]]);}}else if(this.form.paramsAsHash){buf.push(o);}
return buf;},processResponse:function(result){this.result=result;return result;},success:function(response,trans){if(trans.type==Ext.Direct.exceptions.SERVER){response={};}
Ext.form.Action.DirectLoad.superclass.success.call(this,response);}});Ext.form.Action.DirectSubmit=Ext.extend(Ext.form.Action.Submit,{constructor:function(form,opts){Ext.form.Action.DirectSubmit.superclass.constructor.call(this,form,opts);},type:'directsubmit',run:function(){var o=this.options;if(o.clientValidation===false||this.form.isValid()){this.success.params=this.getParams();this.form.api.submit(this.form.el.dom,this.success,this);}else if(o.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false);}},getParams:function(){var o={};var bp=this.form.baseParams;var p=this.options.params;Ext.apply(o,p,bp);return o;},processResponse:function(result){this.result=result;return result;},success:function(response,trans){if(trans.type==Ext.Direct.exceptions.SERVER){response={};}
Ext.form.Action.DirectSubmit.superclass.success.call(this,response);}});Ext.form.Action.ACTION_TYPES={'load':Ext.form.Action.Load,'submit':Ext.form.Action.Submit,'directload':Ext.form.Action.DirectLoad,'directsubmit':Ext.form.Action.DirectSubmit};Ext.form.VTypes=function(){var alpha=/^[a-zA-Z_]+$/,alphanum=/^[a-zA-Z0-9_]+$/,email=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,url=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;return{'email':function(v){return email.test(v);},'emailText':'This field should be an e-mail address in the format "user@example.com"','emailMask':/[a-z0-9_\.\-@\+]/i,'url':function(v){return url.test(v);},'urlText':'This field should be a URL in the format "http:/'+'/www.example.com"','alpha':function(v){return alpha.test(v);},'alphaText':'This field should only contain letters and _','alphaMask':/[a-z_]/i,'alphanum':function(v){return alphanum.test(v);},'alphanumText':'This field should only contain letters, numbers and _','alphanumMask':/[a-z0-9_]/i};}();Ext.grid.GridPanel=Ext.extend(Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:'{0} selected row{1}',deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:['columnmove','columnresize','sortchange','groupchange'],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){Ext.grid.GridPanel.superclass.initComponent.call(this);if(this.columnLines){this.cls=(this.cls||'')+' x-grid-with-col-lines';}
this.autoScroll=false;this.autoWidth=false;if(Ext.isArray(this.columns)){this.colModel=new Ext.grid.ColumnModel(this.columns);delete this.columns;}
if(this.ds){this.store=this.ds;delete this.ds;}
if(this.cm){this.colModel=this.cm;delete this.cm;}
if(this.sm){this.selModel=this.sm;delete this.sm;}
this.store=Ext.StoreMgr.lookup(this.store);this.addEvents('click','dblclick','contextmenu','mousedown','mouseup','mouseover','mouseout','keypress','keydown','cellmousedown','rowmousedown','headermousedown','groupmousedown','rowbodymousedown','containermousedown','cellclick','celldblclick','rowclick','rowdblclick','headerclick','headerdblclick','groupclick','groupdblclick','containerclick','containerdblclick','rowbodyclick','rowbodydblclick','rowcontextmenu','cellcontextmenu','headercontextmenu','groupcontextmenu','containercontextmenu','rowbodycontextmenu','bodyscroll','columnresize','columnmove','sortchange','groupchange','reconfigure','viewready');},onRender:function(ct,position){Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);var c=this.getGridEl();this.el.addClass('x-grid-panel');this.mon(c,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});this.relayEvents(c,['mousedown','mouseup','mouseover','mouseout','keypress','keydown']);var view=this.getView();view.init(this);view.render();this.getSelectionModel().init(this);},initEvents:function(){Ext.grid.GridPanel.superclass.initEvents.call(this);if(this.loadMask){this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask));}},initStateEvents:function(){Ext.grid.GridPanel.superclass.initStateEvents.call(this);this.mon(this.colModel,'hiddenchange',this.saveState,this,{delay:100});},applyState:function(state){var cm=this.colModel,cs=state.columns,store=this.store,s,c,oldIndex;if(cs){for(var i=0,len=cs.length;i<len;i++){s=cs[i];c=cm.getColumnById(s.id);if(c){c.hidden=s.hidden;c.width=s.width;oldIndex=cm.getIndexById(s.id);if(oldIndex!=i){cm.moveColumn(oldIndex,i);}}}}
if(store){s=state.sort;if(s){store[store.remoteSort?'setDefaultSort':'sort'](s.field,s.direction);}
s=state.group;if(store.groupBy){if(s){store.groupBy(s);}else{store.clearGrouping();}}}
var o=Ext.apply({},state);delete o.columns;delete o.sort;Ext.grid.GridPanel.superclass.applyState.call(this,o);},getState:function(){var o={columns:[]},store=this.store,ss,gs;for(var i=0,c;(c=this.colModel.config[i]);i++){o.columns[i]={id:c.id,width:c.width};if(c.hidden){o.columns[i].hidden=true;}}
if(store){ss=store.getSortState();if(ss){o.sort=ss;}
if(store.getGroupState){gs=store.getGroupState();if(gs){o.group=gs;}}}
return o;},afterRender:function(){Ext.grid.GridPanel.superclass.afterRender.call(this);var v=this.view;this.on('bodyresize',v.layout,v);v.layout();if(this.deferRowRender){if(!this.deferRowRenderTask){this.deferRowRenderTask=new Ext.util.DelayedTask(v.afterRender,this.view);}
this.deferRowRenderTask.delay(10);}else{v.afterRender();}
this.viewReady=true;},reconfigure:function(store,colModel){var rendered=this.rendered;if(rendered){if(this.loadMask){this.loadMask.destroy();this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({},{store:store},this.initialConfig.loadMask));}}
if(this.view){this.view.initData(store,colModel);}
this.store=store;this.colModel=colModel;if(rendered){this.view.refresh(true);}
this.fireEvent('reconfigure',this,store,colModel);},onDestroy:function(){if(this.deferRowRenderTask&&this.deferRowRenderTask.cancel){this.deferRowRenderTask.cancel();}
if(this.rendered){Ext.destroy(this.view,this.loadMask);}else if(this.store&&this.store.autoDestroy){this.store.destroy();}
Ext.destroy(this.colModel,this.selModel);this.store=this.selModel=this.colModel=this.view=this.loadMask=null;Ext.grid.GridPanel.superclass.onDestroy.call(this);},processEvent:function(name,e){this.view.processEvent(name,e);},onClick:function(e){this.processEvent('click',e);},onMouseDown:function(e){this.processEvent('mousedown',e);},onContextMenu:function(e,t){this.processEvent('contextmenu',e);},onDblClick:function(e){this.processEvent('dblclick',e);},walkCells:function(row,col,step,fn,scope){var cm=this.colModel,clen=cm.getColumnCount(),ds=this.store,rlen=ds.getCount(),first=true;if(step<0){if(col<0){row--;first=false;}
while(row>=0){if(!first){col=clen-1;}
first=false;while(col>=0){if(fn.call(scope||this,row,col,cm)===true){return[row,col];}
col--;}
row--;}}else{if(col>=clen){row++;first=false;}
while(row<rlen){if(!first){col=0;}
first=false;while(col<clen){if(fn.call(scope||this,row,col,cm)===true){return[row,col];}
col++;}
row++;}}
return null;},getGridEl:function(){return this.body;},stopEditing:Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:Ext.emptyFn}:null);}
return this.selModel;},getStore:function(){return this.store;},getColumnModel:function(){return this.colModel;},getView:function(){if(!this.view){this.view=new Ext.grid.GridView(this.viewConfig);}
return this.view;},getDragDropText:function(){var count=this.selModel.getCount();return String.format(this.ddText,count,count==1?'':'s');}});Ext.reg('grid',Ext.grid.GridPanel);Ext.grid.GridView=Ext.extend(Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:['sort-asc','sort-desc'],sortAscText:'Sort Ascending',sortDescText:'Sort Descending',columnsText:'Columns',selectedRowClass:'x-grid3-row-selected',borderWidth:2,tdClass:'x-grid3-cell',hdCls:'x-grid3-hd',markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,rowBodySelectorDepth:10,cellSelector:'td.x-grid3-cell',rowSelector:'div.x-grid3-row',rowBodySelector:'div.x-grid3-row-body',firstRowCls:'x-grid3-row-first',lastRowCls:'x-grid3-row-last',rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,constructor:function(config){Ext.apply(this,config);this.addEvents('beforerowremoved','beforerowsinserted','beforerefresh','rowremoved','rowsinserted','rowupdated','refresh');Ext.grid.GridView.superclass.constructor.call(this);},initTemplates:function(){var ts=this.templates||{};if(!ts.master){ts.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>','</div>','<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>','</div>');}
if(!ts.header){ts.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>','</table>');}
if(!ts.hcell){ts.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':'','{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />','</div></td>');}
if(!ts.body){ts.body=new Ext.Template('{rows}');}
if(!ts.row){ts.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr>',(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':''),'</tbody></table></div>');}
if(!ts.cell){ts.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>','</td>');}
for(var k in ts){var t=ts[k];if(t&&Ext.isFunction(t.compile)&&!t.compiled){t.disableFormats=true;t.compile();}}
this.templates=ts;this.colRe=new RegExp('x-grid3-td-([^\\s]+)','');},fly:function(el){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body);}
this._flyweight.dom=el;return this._flyweight;},getEditorParent:function(){return this.scroller.dom;},initElements:function(){var E=Ext.Element;var el=this.grid.getGridEl().dom.firstChild;var cs=el.childNodes;this.el=new E(el);this.mainWrap=new E(cs[0]);this.mainHd=new E(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.mainHd.setDisplayed(false);}
this.innerHd=this.mainHd.dom.firstChild;this.scroller=new E(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle('overflow-x','hidden');}
this.mainBody=new E(this.scroller.dom.firstChild);this.focusEl=new E(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent('click',true);this.resizeMarker=new E(cs[1]);this.resizeProxy=new E(cs[2]);},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[];},findCell:function(el){if(!el){return false;}
return this.fly(el).findParent(this.cellSelector,this.cellSelectorDepth);},findCellIndex:function(el,requiredCls){var cell=this.findCell(el);if(cell&&(!requiredCls||this.fly(cell).hasClass(requiredCls))){return this.getCellIndex(cell);}
return false;},getCellIndex:function(el){if(el){var m=el.className.match(this.colRe);if(m&&m[1]){return this.cm.getIndexById(m[1]);}}
return false;},findHeaderCell:function(el){var cell=this.findCell(el);return cell&&this.fly(cell).hasClass(this.hdCls)?cell:null;},findHeaderIndex:function(el){return this.findCellIndex(el,this.hdCls);},findRow:function(el){if(!el){return false;}
return this.fly(el).findParent(this.rowSelector,this.rowSelectorDepth);},findRowIndex:function(el){var r=this.findRow(el);return r?r.rowIndex:false;},findRowBody:function(el){if(!el){return false;}
return this.fly(el).findParent(this.rowBodySelector,this.rowBodySelectorDepth);},getRow:function(row){return this.getRows()[row];},getCell:function(row,col){return this.getRow(row).getElementsByTagName('td')[col];},getHeaderCell:function(index){return this.mainHd.dom.getElementsByTagName('td')[index];},addRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).addClass(cls);}},removeRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).removeClass(cls);}},removeRow:function(row){Ext.removeNode(this.getRow(row));this.syncFocusEl(row);},removeRows:function(firstRow,lastRow){var bd=this.mainBody.dom;for(var rowIndex=firstRow;rowIndex<=lastRow;rowIndex++){Ext.removeNode(bd.childNodes[firstRow]);}
this.syncFocusEl(firstRow);},getScrollState:function(){var sb=this.scroller.dom;return{left:sb.scrollLeft,top:sb.scrollTop};},restoreScroll:function(state){var sb=this.scroller.dom;sb.scrollLeft=state.left;sb.scrollTop=state.top;},scrollToTop:function(){this.scroller.dom.scrollTop=0;this.scroller.dom.scrollLeft=0;},syncScroll:function(){this.syncHeaderScroll();var mb=this.scroller.dom;this.grid.fireEvent('bodyscroll',mb.scrollLeft,mb.scrollTop);},syncHeaderScroll:function(){var mb=this.scroller.dom;this.innerHd.scrollLeft=mb.scrollLeft;this.innerHd.scrollLeft=mb.scrollLeft;},updateSortIcon:function(col,dir){var sc=this.sortClasses;var hds=this.mainHd.select('td').removeClass(sc);hds.item(col).addClass(sc[dir=='DESC'?1:0]);},updateAllColumnWidths:function(){var tw=this.getTotalWidth(),clen=this.cm.getColumnCount(),ws=[],len,i;for(i=0;i<clen;i++){ws[i]=this.getColumnWidth(i);}
this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;for(i=0;i<clen;i++){var hd=this.getHeaderCell(i);hd.style.width=ws[i];}
var ns=this.getRows(),row,trow;for(i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;trow=row.firstChild.rows[0];for(var j=0;j<clen;j++){trow.childNodes[j].style.width=ws[j];}}}
this.onAllColumnWidthsUpdated(ws,tw);},updateColumnWidth:function(col,width){var w=this.getColumnWidth(col);var tw=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;var hd=this.getHeaderCell(col);hd.style.width=w;var ns=this.getRows(),row;for(var i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;row.firstChild.rows[0].childNodes[col].style.width=w;}}
this.onColumnWidthUpdated(col,w,tw);},updateColumnHidden:function(col,hidden){var tw=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;var display=hidden?'none':'';var hd=this.getHeaderCell(col);hd.style.display=display;var ns=this.getRows(),row;for(var i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;row.firstChild.rows[0].childNodes[col].style.display=display;}}
this.onColumnHiddenUpdated(col,hidden,tw);delete this.lastViewWidth;this.layout();},doRender:function(columns,records,store,startRow,colCount,stripe){var templates=this.templates,cellTemplate=templates.cell,rowTemplate=templates.row,last=colCount-1;var tstyle='width:'+this.getTotalWidth()+';';var rowBuffer=[],colBuffer=[],rowParams={tstyle:tstyle},meta={},column,record;for(var j=0,len=records.length;j<len;j++){record=records[j];colBuffer=[];var rowIndex=j+startRow;for(var i=0;i<colCount;i++){column=columns[i];meta.id=column.id;meta.css=i===0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');meta.attr=meta.cellAttr='';meta.style=column.style;meta.value=column.renderer.call(column.scope,record.data[column.name],meta,record,rowIndex,i,store);if(Ext.isEmpty(meta.value)){meta.value='&#160;';}
if(this.markDirty&&record.dirty&&Ext.isDefined(record.modified[column.name])){meta.css+=' x-grid3-dirty-cell';}
colBuffer[colBuffer.length]=cellTemplate.apply(meta);}
var alt=[];if(stripe&&((rowIndex+1)%2===0)){alt[0]='x-grid3-row-alt';}
if(record.dirty){alt[1]=' x-grid3-dirty-row';}
rowParams.cols=colCount;if(this.getRowClass){alt[2]=this.getRowClass(record,rowIndex,rowParams,store);}
rowParams.alt=alt.join(' ');rowParams.cells=colBuffer.join('');rowBuffer[rowBuffer.length]=rowTemplate.apply(rowParams);}
return rowBuffer.join('');},processRows:function(startRow,skipStripe){if(!this.ds||this.ds.getCount()<1){return;}
var rows=this.getRows(),len=rows.length,i,r;skipStripe=skipStripe||!this.grid.stripeRows;startRow=startRow||0;for(i=0;i<len;i++){r=rows[i];if(r){r.rowIndex=i;if(!skipStripe){r.className=r.className.replace(this.rowClsRe,' ');if((i+1)%2===0){r.className+=' x-grid3-row-alt';}}}}
if(startRow===0){Ext.fly(rows[0]).addClass(this.firstRowCls);}
Ext.fly(rows[rows.length-1]).addClass(this.lastRowCls);},afterRender:function(){if(!this.ds||!this.cm){return;}
this.mainBody.dom.innerHTML=this.renderRows()||'&#160;';this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText();}
this.grid.fireEvent('viewready',this.grid);},renderUI:function(){var templates=this.templates,header=this.renderHeaders(),body=templates.body.apply({rows:'&#160;'});var html=templates.master.apply({body:body,header:header,ostyle:'width:'+this.getOffsetWidth()+';',bstyle:'width:'+this.getTotalWidth()+';'});var g=this.grid;g.getGridEl().dom.innerHTML=html;this.initElements();Ext.fly(this.innerHd).on('click',this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on('scroll',this.syncScroll,this);if(g.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(g,this.mainHd.dom);}
if(g.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(g,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(g,this.mainHd.dom);}
if(g.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:g.id+'-hctx'});this.hmenu.add({itemId:'asc',text:this.sortAscText,cls:'xg-hmenu-sort-asc'},{itemId:'desc',text:this.sortDescText,cls:'xg-hmenu-sort-desc'});if(g.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:g.id+'-hcols-menu'});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add('-',{itemId:'columns',hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:'x-cols-icon'});}
this.hmenu.on('itemclick',this.handleHdMenuClick,this);}
if(g.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});}
if(g.enableDragDrop||g.enableDrag){this.dragZone=new Ext.grid.GridDragZone(g,{ddGroup:g.ddGroup||'GridDD'});}
this.updateHeaderSortState();},processEvent:function(name,e){var t=e.getTarget(),g=this.grid,header=this.findHeaderIndex(t);g.fireEvent(name,e);if(header!==false){g.fireEvent('header'+name,g,header,e);}else{var row=this.findRowIndex(t),cell,body;if(row!==false){g.fireEvent('row'+name,g,row,e);cell=this.findCellIndex(t);if(cell!==false){g.fireEvent('cell'+name,g,row,cell,e);}else{body=this.findRowBody(t);if(body){g.fireEvent('rowbody'+name,g,row,e);}}}else{g.fireEvent('container'+name,g,e);}}},layout:function(){if(!this.mainBody){return;}
var g=this.grid;var c=g.getGridEl();var csize=c.getSize(true);var vw=csize.width;if(!g.hideHeaders&&(vw<20||csize.height<20)){return;}
if(g.autoHeight){this.scroller.dom.style.overflow='visible';if(Ext.isWebKit){this.scroller.dom.style.position='static';}}else{this.el.setSize(csize.width,csize.height);var hdHeight=this.mainHd.getHeight();var vh=csize.height-(hdHeight);this.scroller.setSize(vw,vh);if(this.innerHd){this.innerHd.style.width=(vw)+'px';}}
if(this.forceFit){if(this.lastViewWidth!=vw){this.fitColumns(false,false);this.lastViewWidth=vw;}}else{this.autoExpand();this.syncHeaderScroll();}
this.onLayout(vw,vh);},onLayout:function(vw,vh){},onColumnWidthUpdated:function(col,w,tw){},onAllColumnWidthsUpdated:function(ws,tw){},onColumnHiddenUpdated:function(col,hidden,tw){},updateColumnText:function(col,text){},afterMove:function(colIndex){},init:function(grid){this.grid=grid;this.initTemplates();this.initData(grid.store,grid.colModel);this.initUI(grid);},getColumnId:function(index){return this.cm.getColumnId(index);},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+'px';},getScrollOffset:function(){return Ext.num(this.scrollOffset,Ext.getScrollBarWidth());},renderHeaders:function(){var cm=this.cm,ts=this.templates,ct=ts.hcell,cb=[],p={},len=cm.getColumnCount(),last=len-1;for(var i=0;i<len;i++){p.id=cm.getColumnId(i);p.value=cm.getColumnHeader(i)||'';p.style=this.getColumnStyle(i,true);p.tooltip=this.getColumnTooltip(i);p.css=i===0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');if(cm.config[i].align=='right'){p.istyle='padding-right:16px';}else{delete p.istyle;}
cb[cb.length]=ct.apply(p);}
return ts.header.apply({cells:cb.join(''),tstyle:'width:'+this.getTotalWidth()+';'});},getColumnTooltip:function(i){var tt=this.cm.getColumnTooltip(i);if(tt){if(Ext.QuickTips.isEnabled()){return'ext:qtip="'+tt+'"';}else{return'title="'+tt+'"';}}
return'';},beforeUpdate:function(){this.grid.stopEditing(true);},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();},focusRow:function(row){this.focusCell(row,0,false);},focusCell:function(row,col,hscroll){this.syncFocusEl(this.ensureVisible(row,col,hscroll));if(Ext.isGecko){this.focusEl.focus();}else{this.focusEl.focus.defer(1,this.focusEl);}},resolveCell:function(row,col,hscroll){if(!Ext.isNumber(row)){row=row.rowIndex;}
if(!this.ds){return null;}
if(row<0||row>=this.ds.getCount()){return null;}
col=(col!==undefined?col:0);var rowEl=this.getRow(row),cm=this.cm,colCount=cm.getColumnCount(),cellEl;if(!(hscroll===false&&col===0)){while(col<colCount&&cm.isHidden(col)){col++;}
cellEl=this.getCell(row,col);}
return{row:rowEl,cell:cellEl};},getResolvedXY:function(resolved){if(!resolved){return null;}
var s=this.scroller.dom,c=resolved.cell,r=resolved.row;return c?Ext.fly(c).getXY():[this.el.getX(),Ext.fly(r).getY()];},syncFocusEl:function(row,col,hscroll){var xy=row;if(!Ext.isArray(xy)){row=Math.min(row,Math.max(0,this.getRows().length-1));if(isNaN(row)){return;}
xy=this.getResolvedXY(this.resolveCell(row,col,hscroll));}
this.focusEl.setXY(xy||this.scroller.getXY());},ensureVisible:function(row,col,hscroll){var resolved=this.resolveCell(row,col,hscroll);if(!resolved||!resolved.row){return;}
var rowEl=resolved.row,cellEl=resolved.cell,c=this.scroller.dom,ctop=0,p=rowEl,stop=this.el.dom;while(p&&p!=stop){ctop+=p.offsetTop;p=p.offsetParent;}
ctop-=this.mainHd.dom.offsetHeight;stop=parseInt(c.scrollTop,10);var cbot=ctop+rowEl.offsetHeight,ch=c.clientHeight,sbot=stop+ch;if(ctop<stop){c.scrollTop=ctop;}else if(cbot>sbot){c.scrollTop=cbot-ch;}
if(hscroll!==false){var cleft=parseInt(cellEl.offsetLeft,10);var cright=cleft+cellEl.offsetWidth;var sleft=parseInt(c.scrollLeft,10);var sright=sleft+c.clientWidth;if(cleft<sleft){c.scrollLeft=cleft;}else if(cright>sright){c.scrollLeft=cright-c.clientWidth;}}
return this.getResolvedXY(resolved);},insertRows:function(dm,firstRow,lastRow,isUpdate){var last=dm.getCount()-1;if(!isUpdate&&firstRow===0&&lastRow>=last){this.fireEvent('beforerowsinserted',this,firstRow,lastRow);this.refresh();this.fireEvent('rowsinserted',this,firstRow,lastRow);}else{if(!isUpdate){this.fireEvent('beforerowsinserted',this,firstRow,lastRow);}
var html=this.renderRows(firstRow,lastRow),before=this.getRow(firstRow);if(before){if(firstRow===0){Ext.fly(this.getRow(0)).removeClass(this.firstRowCls);}
Ext.DomHelper.insertHtml('beforeBegin',before,html);}else{var r=this.getRow(last-1);if(r){Ext.fly(r).removeClass(this.lastRowCls);}
Ext.DomHelper.insertHtml('beforeEnd',this.mainBody.dom,html);}
if(!isUpdate){this.fireEvent('rowsinserted',this,firstRow,lastRow);this.processRows(firstRow);}else if(firstRow===0||firstRow>=last){Ext.fly(this.getRow(firstRow)).addClass(firstRow===0?this.firstRowCls:this.lastRowCls);}}
this.syncFocusEl(firstRow);},deleteRows:function(dm,firstRow,lastRow){if(dm.getRowCount()<1){this.refresh();}else{this.fireEvent('beforerowsdeleted',this,firstRow,lastRow);this.removeRows(firstRow,lastRow);this.processRows(firstRow);this.fireEvent('rowsdeleted',this,firstRow,lastRow);}},getColumnStyle:function(col,isHeader){var style=!isHeader?(this.cm.config[col].css||''):'';style+='width:'+this.getColumnWidth(col)+';';if(this.cm.isHidden(col)){style+='display:none;';}
var align=this.cm.config[col].align;if(align){style+='text-align:'+align+';';}
return style;},getColumnWidth:function(col){var w=this.cm.getColumnWidth(col);if(Ext.isNumber(w)){return(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)?w:(w-this.borderWidth>0?w-this.borderWidth:0))+'px';}
return w;},getTotalWidth:function(){return this.cm.getTotalWidth()+'px';},fitColumns:function(preventRefresh,onlyExpand,omitColumn){var cm=this.cm,i;var tw=cm.getTotalWidth(false);var aw=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();if(aw<20){return;}
var extra=aw-tw;if(extra===0){return false;}
var vc=cm.getColumnCount(true);var ac=vc-(Ext.isNumber(omitColumn)?1:0);if(ac===0){ac=1;omitColumn=undefined;}
var colCount=cm.getColumnCount();var cols=[];var extraCol=0;var width=0;var w;for(i=0;i<colCount;i++){if(!cm.isHidden(i)&&!cm.isFixed(i)&&i!==omitColumn){w=cm.getColumnWidth(i);cols.push(i);extraCol=i;cols.push(w);width+=w;}}
var frac=(aw-cm.getTotalWidth())/width;while(cols.length){w=cols.pop();i=cols.pop();cm.setColumnWidth(i,Math.max(this.grid.minColumnWidth,Math.floor(w+w*frac)),true);}
if((tw=cm.getTotalWidth(false))>aw){var adjustCol=ac!=vc?omitColumn:extraCol;cm.setColumnWidth(adjustCol,Math.max(1,cm.getColumnWidth(adjustCol)-(tw-aw)),true);}
if(preventRefresh!==true){this.updateAllColumnWidths();}
return true;},autoExpand:function(preventUpdate){var g=this.grid,cm=this.cm;if(!this.userResized&&g.autoExpandColumn){var tw=cm.getTotalWidth(false);var aw=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();if(tw!=aw){var ci=cm.getIndexById(g.autoExpandColumn);var currentWidth=cm.getColumnWidth(ci);var cw=Math.min(Math.max(((aw-tw)+currentWidth),g.autoExpandMin),g.autoExpandMax);if(cw!=currentWidth){cm.setColumnWidth(ci,cw,true);if(preventUpdate!==true){this.updateColumnWidth(ci,cw);}}}}},getColumnData:function(){var cs=[],cm=this.cm,colCount=cm.getColumnCount();for(var i=0;i<colCount;i++){var name=cm.getDataIndex(i);cs[i]={name:(!Ext.isDefined(name)?this.ds.fields.get(i).name:name),renderer:cm.getRenderer(i),scope:cm.getRendererScope(i),id:cm.getColumnId(i),style:this.getColumnStyle(i)};}
return cs;},renderRows:function(startRow,endRow){var g=this.grid,cm=g.colModel,ds=g.store,stripe=g.stripeRows;var colCount=cm.getColumnCount();if(ds.getCount()<1){return'';}
var cs=this.getColumnData();startRow=startRow||0;endRow=!Ext.isDefined(endRow)?ds.getCount()-1:endRow;var rs=ds.getRange(startRow,endRow);return this.doRender(cs,rs,ds,startRow,colCount,stripe);},renderBody:function(){var markup=this.renderRows()||'&#160;';return this.templates.body.apply({rows:markup});},refreshRow:function(record){var ds=this.ds,index;if(Ext.isNumber(record)){index=record;record=ds.getAt(index);if(!record){return;}}else{index=ds.indexOf(record);if(index<0){return;}}
this.insertRows(ds,index,index,true);this.getRow(index).rowIndex=index;this.onRemove(ds,record,index+1,true);this.fireEvent('rowupdated',this,index,record);},refresh:function(headersToo){this.fireEvent('beforerefresh',this);this.grid.stopEditing(true);var result=this.renderBody();this.mainBody.update(result).setWidth(this.getTotalWidth());if(headersToo===true){this.updateHeaders();this.updateHeaderSortState();}
this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent('refresh',this);},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+'</div>');}},updateHeaderSortState:function(){var state=this.ds.getSortState();if(!state){return;}
if(!this.sortState||(this.sortState.field!=state.field||this.sortState.direction!=state.direction)){this.grid.fireEvent('sortchange',this.grid,state);}
this.sortState=state;var sortColumn=this.cm.findColumnIndex(state.field);if(sortColumn!=-1){var sortDir=state.direction;this.updateSortIcon(sortColumn,sortDir);}},clearHeaderSortState:function(){if(!this.sortState){return;}
this.grid.fireEvent('sortchange',this.grid,null);this.mainHd.select('td').removeClass(this.sortClasses);delete this.sortState;},destroy:function(){if(this.scrollToTopTask&&this.scrollToTopTask.cancel){this.scrollToTopTask.cancel();}
if(this.colMenu){Ext.menu.MenuMgr.unregister(this.colMenu);this.colMenu.destroy();delete this.colMenu;}
if(this.hmenu){Ext.menu.MenuMgr.unregister(this.hmenu);this.hmenu.destroy();delete this.hmenu;}
this.initData(null,null);this.purgeListeners();Ext.fly(this.innerHd).un("click",this.handleHdDown,this);if(this.grid.enableColumnMove){Ext.destroy(this.columnDrag.el,this.columnDrag.proxy.ghost,this.columnDrag.proxy.el,this.columnDrop.el,this.columnDrop.proxyTop,this.columnDrop.proxyBottom,this.columnDrag.dragData.ddel,this.columnDrag.dragData.header);if(this.columnDrag.proxy.anim){Ext.destroy(this.columnDrag.proxy.anim);}
delete this.columnDrag.proxy.ghost;delete this.columnDrag.dragData.ddel;delete this.columnDrag.dragData.header;this.columnDrag.destroy();delete Ext.dd.DDM.locationCache[this.columnDrag.id];delete this.columnDrag._domRef;delete this.columnDrop.proxyTop;delete this.columnDrop.proxyBottom;this.columnDrop.destroy();delete Ext.dd.DDM.locationCache["gridHeader"+this.grid.getGridEl().id];delete this.columnDrop._domRef;delete Ext.dd.DDM.ids[this.columnDrop.ddGroup];}
if(this.splitZone){this.splitZone.destroy();delete this.splitZone._domRef;delete Ext.dd.DDM.ids["gridSplitters"+this.grid.getGridEl().id];}
Ext.fly(this.innerHd).removeAllListeners();Ext.removeNode(this.innerHd);delete this.innerHd;Ext.destroy(this.el,this.mainWrap,this.mainHd,this.scroller,this.mainBody,this.focusEl,this.resizeMarker,this.resizeProxy,this.activeHdBtn,this.dragZone,this.splitZone,this._flyweight);delete this.grid.container;if(this.dragZone){this.dragZone.destroy();}
Ext.dd.DDM.currentTarget=null;delete Ext.dd.DDM.locationCache[this.grid.getGridEl().id];Ext.EventManager.removeResizeListener(this.onWindowResize,this);},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var ct=this.grid.ownerCt;if(ct&&ct.getLayout()){ct.on('afterlayout',function(){this.fitColumns(true,true);this.updateHeaders();},this,{single:true});}else{this.fitColumns(true,true);}}else if(this.forceFit){this.fitColumns(true,false);}else if(this.grid.autoExpandColumn){this.autoExpand(true);}
this.renderUI();},initData:function(ds,cm){if(this.ds){this.ds.un('load',this.onLoad,this);this.ds.un('datachanged',this.onDataChange,this);this.ds.un('add',this.onAdd,this);this.ds.un('remove',this.onRemove,this);this.ds.un('update',this.onUpdate,this);this.ds.un('clear',this.onClear,this);if(this.ds!==ds&&this.ds.autoDestroy){this.ds.destroy();}}
if(ds){ds.on({scope:this,load:this.onLoad,datachanged:this.onDataChange,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.onClear});}
this.ds=ds;if(this.cm){this.cm.un('configchange',this.onColConfigChange,this);this.cm.un('widthchange',this.onColWidthChange,this);this.cm.un('headerchange',this.onHeaderChange,this);this.cm.un('hiddenchange',this.onHiddenChange,this);this.cm.un('columnmoved',this.onColumnMove,this);}
if(cm){delete this.lastViewWidth;cm.on({scope:this,configchange:this.onColConfigChange,widthchange:this.onColWidthChange,headerchange:this.onHeaderChange,hiddenchange:this.onHiddenChange,columnmoved:this.onColumnMove});}
this.cm=cm;},onDataChange:function(){this.refresh();this.updateHeaderSortState();this.syncFocusEl(0);},onClear:function(){this.refresh();this.syncFocusEl(0);},onUpdate:function(ds,record){this.refreshRow(record);},onAdd:function(ds,records,index){this.insertRows(ds,index,index+(records.length-1));},onRemove:function(ds,record,index,isUpdate){if(isUpdate!==true){this.fireEvent('beforerowremoved',this,index,record);}
this.removeRow(index);if(isUpdate!==true){this.processRows(index);this.applyEmptyText();this.fireEvent('rowremoved',this,index,record);}},onLoad:function(){if(Ext.isGecko){if(!this.scrollToTopTask){this.scrollToTopTask=new Ext.util.DelayedTask(this.scrollToTop,this);}
this.scrollToTopTask.delay(1);}else{this.scrollToTop();}},onColWidthChange:function(cm,col,width){this.updateColumnWidth(col,width);},onHeaderChange:function(cm,col,text){this.updateHeaders();},onHiddenChange:function(cm,col,hidden){this.updateColumnHidden(col,hidden);},onColumnMove:function(cm,oldIndex,newIndex){this.indexMap=null;var s=this.getScrollState();this.refresh(true);this.restoreScroll(s);this.afterMove(newIndex);this.grid.fireEvent('columnmove',oldIndex,newIndex);},onColConfigChange:function(){delete this.lastViewWidth;this.indexMap=null;this.refresh(true);},initUI:function(grid){grid.on('headerclick',this.onHeaderClick,this);},initEvents:function(){},onHeaderClick:function(g,index){if(this.headersDisabled||!this.cm.isSortable(index)){return;}
g.stopEditing(true);g.store.sort(this.cm.getDataIndex(index));},onRowOver:function(e,t){var row;if((row=this.findRowIndex(t))!==false){this.addRowClass(row,'x-grid3-row-over');}},onRowOut:function(e,t){var row;if((row=this.findRowIndex(t))!==false&&!e.within(this.getRow(row),true)){this.removeRowClass(row,'x-grid3-row-over');}},handleWheel:function(e){e.stopPropagation();},onRowSelect:function(row){this.addRowClass(row,this.selectedRowClass);},onRowDeselect:function(row){this.removeRowClass(row,this.selectedRowClass);},onCellSelect:function(row,col){var cell=this.getCell(row,col);if(cell){this.fly(cell).addClass('x-grid3-cell-selected');}},onCellDeselect:function(row,col){var cell=this.getCell(row,col);if(cell){this.fly(cell).removeClass('x-grid3-cell-selected');}},onColumnSplitterMoved:function(i,w){this.userResized=true;var cm=this.grid.colModel;cm.setColumnWidth(i,w,true);if(this.forceFit){this.fitColumns(true,false,i);this.updateAllColumnWidths();}else{this.updateColumnWidth(i,w);this.syncHeaderScroll();}
this.grid.fireEvent('columnresize',i,w);},handleHdMenuClick:function(item){var index=this.hdCtxIndex,cm=this.cm,ds=this.ds,id=item.getItemId();switch(id){case'asc':ds.sort(cm.getDataIndex(index),'ASC');break;case'desc':ds.sort(cm.getDataIndex(index),'DESC');break;default:index=cm.getIndexById(id.substr(4));if(index!=-1){if(item.checked&&cm.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false;}
cm.setHidden(index,item.checked);}}
return true;},isHideableColumn:function(c){return!c.hidden;},beforeColMenuShow:function(){var cm=this.cm,colCount=cm.getColumnCount();this.colMenu.removeAll();for(var i=0;i<colCount;i++){if(cm.config[i].hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:'col-'+cm.getColumnId(i),text:cm.getColumnHeader(i),checked:!cm.isHidden(i),hideOnClick:false,disabled:cm.config[i].hideable===false}));}}},handleHdDown:function(e,t){if(Ext.fly(t).hasClass('x-grid3-hd-btn')){e.stopEvent();var hd=this.findHeaderCell(t);Ext.fly(hd).addClass('x-grid3-hd-menu-open');var index=this.getCellIndex(hd);this.hdCtxIndex=index;var ms=this.hmenu.items,cm=this.cm;ms.get('asc').setDisabled(!cm.isSortable(index));ms.get('desc').setDisabled(!cm.isSortable(index));this.hmenu.on('hide',function(){Ext.fly(hd).removeClass('x-grid3-hd-menu-open');},this,{single:true});this.hmenu.show(t,'tl-bl?');}},handleHdOver:function(e,t){var hd=this.findHeaderCell(t);if(hd&&!this.headersDisabled){this.activeHdRef=t;this.activeHdIndex=this.getCellIndex(hd);var fly=this.fly(hd);this.activeHdRegion=fly.getRegion();if(!this.cm.isMenuDisabled(this.activeHdIndex)){fly.addClass('x-grid3-hd-over');this.activeHdBtn=fly.child('.x-grid3-hd-btn');if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(hd.firstChild.offsetHeight-1)+'px';}}}},handleHdMove:function(e,t){var hd=this.findHeaderCell(this.activeHdRef);if(hd&&!this.headersDisabled){var hw=this.splitHandleWidth||5,r=this.activeHdRegion,x=e.getPageX(),ss=hd.style,cur='';if(this.grid.enableColumnResize!==false){if(x-r.left<=hw&&this.cm.isResizable(this.activeHdIndex-1)){cur=Ext.isAir?'move':Ext.isWebKit?'e-resize':'col-resize';}else if(r.right-x<=(!this.activeHdBtn?hw:2)&&this.cm.isResizable(this.activeHdIndex)){cur=Ext.isAir?'move':Ext.isWebKit?'w-resize':'col-resize';}}
ss.cursor=cur;}},handleHdOut:function(e,t){var hd=this.findHeaderCell(t);if(hd&&(!Ext.isIE||!e.within(hd,true))){this.activeHdRef=null;this.fly(hd).removeClass('x-grid3-hd-over');hd.style.cursor='';}},hasRows:function(){var fc=this.mainBody.dom.firstChild;return fc&&fc.nodeType==1&&fc.className!='x-grid-empty';},bind:function(d,c){this.initData(d,c);}});Ext.grid.GridView.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{constructor:function(grid,hd){this.grid=grid;this.view=grid.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,hd,'gridSplitters'+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=this.view.splitHandleWidth||5;},b4StartDrag:function(x,y){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var h=this.view.mainWrap.getHeight();this.marker.setHeight(h);this.marker.show();this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),'tl-tl',[-2,0]);this.proxy.setHeight(h);var w=this.cm.getColumnWidth(this.cellIndex),minw=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(minw,1000);this.setYConstraint(0,0);this.minX=x-minw;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y);},allowHeaderDrag:function(e){return true;},handleMouseDown:function(e){var t=this.view.findHeaderCell(e.getTarget());if(t&&this.allowHeaderDrag(e)){var xy=this.view.fly(t).getXY(),x=xy[0],y=xy[1],exy=e.getXY(),ex=exy[0],w=t.offsetWidth,adjust=false;if((ex-x)<=this.hw){adjust=-1;}else if((x+w)-ex<=this.hw){adjust=0;}
if(adjust!==false){this.cm=this.grid.colModel;var ci=this.view.getCellIndex(t);if(adjust==-1){if(ci+adjust<0){return;}
while(this.cm.isHidden(ci+adjust)){--adjust;if(ci+adjust<0){return;}}}
this.cellIndex=ci+adjust;this.split=t.dom;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments);}}else if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(e);}}},endDrag:function(e){this.marker.hide();var v=this.view,endX=Math.max(this.minX,e.getPageX()),diff=endX-this.startPos,disabled=this.dragHeadersDisabled;v.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff);setTimeout(function(){v.headersDisabled=disabled;},50);},autoOffset:function(){this.setDelta(0,0);}});Ext.grid.HeaderDragZone=Ext.extend(Ext.dd.DragZone,{maxDragWidth:120,constructor:function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,hd);if(hd2){this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2));}
this.scroll=false;},getDragData:function(e){var t=Ext.lib.Event.getTarget(e),h=this.view.findHeaderCell(t);if(h){return{ddel:h.firstChild,header:h};}
return false;},onInitDrag:function(e){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var clone=this.dragData.ddel.cloneNode(true);clone.id=Ext.id();clone.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(clone);return true;},afterValidDrop:function(){this.completeDrop();},afterInvalidDrop:function(){this.completeDrop();},completeDrop:function(){var v=this.view,disabled=this.dragHeadersDisabled;setTimeout(function(){v.headersDisabled=disabled;},50);}});Ext.grid.HeaderDropZone=Ext.extend(Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,constructor:function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxyTop=Ext.DomHelper.append(document.body,{cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden");};this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,grid.getGridEl().dom);},getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e),cindex=this.view.findCellIndex(t);if(cindex!==false){return this.view.getHeaderCell(cindex);}},nextVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.nextSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}
h=h.nextSibling;}
return null;},prevVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.prevSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}
h=h.prevSibling;}
return null;},positionIndicator:function(h,n,e){var x=Ext.lib.Event.getPageX(e),r=Ext.lib.Dom.getRegion(n.firstChild),px,pt,py=r.top+this.proxyOffsets[1];if((r.right-x)<=(r.right-r.left)/2){px=r.right+this.view.borderWidth;pt="after";}else{px=r.left;pt="before";}
if(this.grid.colModel.isFixed(this.view.getCellIndex(n))){return false;}
px+=this.proxyOffsets[0];this.proxyTop.setLeftTop(px,py);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight();}
this.proxyBottom.setLeftTop(px,py+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return pt;},onNodeEnter:function(n,dd,e,data){if(data.header!=n){this.positionIndicator(data.header,n,e);}},onNodeOver:function(n,dd,e,data){var result=false;if(data.header!=n){result=this.positionIndicator(data.header,n,e);}
if(!result){this.proxyTop.hide();this.proxyBottom.hide();}
return result?this.dropAllowed:this.dropNotAllowed;},onNodeOut:function(n,dd,e,data){this.proxyTop.hide();this.proxyBottom.hide();},onNodeDrop:function(n,dd,e,data){var h=data.header;if(h!=n){var cm=this.grid.colModel,x=Ext.lib.Event.getPageX(e),r=Ext.lib.Dom.getRegion(n.firstChild),pt=(r.right-x)<=((r.right-r.left)/2)?"after":"before",oldIndex=this.view.getCellIndex(h),newIndex=this.view.getCellIndex(n);if(pt=="after"){newIndex++;}
if(oldIndex<newIndex){newIndex--;}
cm.moveColumn(oldIndex,newIndex);return true;}
return false;}});Ext.grid.GridView.ColumnDragZone=Ext.extend(Ext.grid.HeaderDragZone,{constructor:function(grid,hd){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,grid,hd,null);this.proxy.el.addClass('x-grid3-col-dd');},handleMouseDown:function(e){},callHandleMouseDown:function(e){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,e);}});Ext.grid.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{fly:Ext.Element.fly,constructor:function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxy=this.view.resizeProxy;Ext.grid.SplitDragZone.superclass.constructor.call(this,hd,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2));this.scroll=false;},b4StartDrag:function(x,y){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var w=this.cm.getColumnWidth(this.cellIndex);var minw=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(minw,1000);this.setYConstraint(0,0);this.minX=x-minw;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y);},handleMouseDown:function(e){var ev=Ext.EventObject.setEvent(e);var t=this.fly(ev.getTarget());if(t.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(t.dom);this.split=t.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments);}}},endDrag:function(e){this.view.headersDisabled=false;var endX=Math.max(this.minX,Ext.lib.Event.getPageX(e));var diff=endX-this.startPos;this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff);},autoOffset:function(){this.setDelta(0,0);}});Ext.grid.GridDragZone=function(grid,config){this.view=grid.getView();Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,config);this.scroll=false;this.grid=grid;this.ddel=document.createElement('div');this.ddel.className='x-grid-dd-wrap';};Ext.extend(Ext.grid.GridDragZone,Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(e){var t=Ext.lib.Event.getTarget(e);var rowIndex=this.view.findRowIndex(t);if(rowIndex!==false){var sm=this.grid.selModel;if(!sm.isSelected(rowIndex)||e.hasModifier()){sm.handleMouseDown(this.grid,rowIndex,e);}
return{grid:this.grid,ddel:this.ddel,rowIndex:rowIndex,selections:sm.getSelections()};}
return false;},onInitDrag:function(e){var data=this.dragData;this.ddel.innerHTML=this.grid.getDragDropText();this.proxy.update(this.ddel);},afterRepair:function(){this.dragging=false;},getRepairXY:function(e,data){return false;},onEndDrag:function(data,e){},onValidDrop:function(dd,e,id){this.hideProxy();},beforeInvalidDrop:function(e,id){}});Ext.grid.ColumnModel=Ext.extend(Ext.util.Observable,{defaultWidth:100,defaultSortable:false,constructor:function(config){if(config.columns){Ext.apply(this,config);this.setConfig(config.columns,true);}else{this.setConfig(config,true);}
this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");Ext.grid.ColumnModel.superclass.constructor.call(this);},getColumnId:function(index){return this.config[index].id;},getColumnAt:function(index){return this.config[index];},setConfig:function(config,initial){var i,c,len;if(!initial){delete this.totalWidth;for(i=0,len=this.config.length;i<len;i++){c=this.config[i];if(c.setEditor){c.setEditor(null);}}}
this.defaults=Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);this.config=config;this.lookup={};for(i=0,len=config.length;i<len;i++){c=Ext.applyIf(config[i],this.defaults);if(Ext.isEmpty(c.id)){c.id=i;}
if(!c.isColumn){var Cls=Ext.grid.Column.types[c.xtype||'gridcolumn'];c=new Cls(c);config[i]=c;}
this.lookup[c.id]=c;}
if(!initial){this.fireEvent('configchange',this);}},getColumnById:function(id){return this.lookup[id];},getIndexById:function(id){for(var i=0,len=this.config.length;i<len;i++){if(this.config[i].id==id){return i;}}
return-1;},moveColumn:function(oldIndex,newIndex){var c=this.config[oldIndex];this.config.splice(oldIndex,1);this.config.splice(newIndex,0,c);this.dataMap=null;this.fireEvent("columnmoved",this,oldIndex,newIndex);},getColumnCount:function(visibleOnly){if(visibleOnly===true){var c=0;for(var i=0,len=this.config.length;i<len;i++){if(!this.isHidden(i)){c++;}}
return c;}
return this.config.length;},getColumnsBy:function(fn,scope){var r=[];for(var i=0,len=this.config.length;i<len;i++){var c=this.config[i];if(fn.call(scope||this,c,i)===true){r[r.length]=c;}}
return r;},isSortable:function(col){return!!this.config[col].sortable;},isMenuDisabled:function(col){return!!this.config[col].menuDisabled;},getRenderer:function(col){if(!this.config[col].renderer){return Ext.grid.ColumnModel.defaultRenderer;}
return this.config[col].renderer;},getRendererScope:function(col){return this.config[col].scope;},setRenderer:function(col,fn){this.config[col].renderer=fn;},getColumnWidth:function(col){return this.config[col].width;},setColumnWidth:function(col,width,suppressEvent){this.config[col].width=width;this.totalWidth=null;if(!suppressEvent){this.fireEvent("widthchange",this,col,width);}},getTotalWidth:function(includeHidden){if(!this.totalWidth){this.totalWidth=0;for(var i=0,len=this.config.length;i<len;i++){if(includeHidden||!this.isHidden(i)){this.totalWidth+=this.getColumnWidth(i);}}}
return this.totalWidth;},getColumnHeader:function(col){return this.config[col].header;},setColumnHeader:function(col,header){this.config[col].header=header;this.fireEvent("headerchange",this,col,header);},getColumnTooltip:function(col){return this.config[col].tooltip;},setColumnTooltip:function(col,tooltip){this.config[col].tooltip=tooltip;},getDataIndex:function(col){return this.config[col].dataIndex;},setDataIndex:function(col,dataIndex){this.config[col].dataIndex=dataIndex;},findColumnIndex:function(dataIndex){var c=this.config;for(var i=0,len=c.length;i<len;i++){if(c[i].dataIndex==dataIndex){return i;}}
return-1;},isCellEditable:function(colIndex,rowIndex){var c=this.config[colIndex],ed=c.editable;return!!(ed||(!Ext.isDefined(ed)&&c.editor));},getCellEditor:function(colIndex,rowIndex){return this.config[colIndex].getCellEditor(rowIndex);},setEditable:function(col,editable){this.config[col].editable=editable;},isHidden:function(colIndex){return!!this.config[colIndex].hidden;},isFixed:function(colIndex){return!!this.config[colIndex].fixed;},isResizable:function(colIndex){return colIndex>=0&&this.config[colIndex].resizable!==false&&this.config[colIndex].fixed!==true;},setHidden:function(colIndex,hidden){var c=this.config[colIndex];if(c.hidden!==hidden){c.hidden=hidden;this.totalWidth=null;this.fireEvent("hiddenchange",this,colIndex,hidden);}},setEditor:function(col,editor){this.config[col].setEditor(editor);},destroy:function(){var c;for(var i=0,len=this.config.length;i<len;i++){c=this.config[i];if(c.setEditor){c.setEditor(null);}}
this.purgeListeners();}});Ext.grid.ColumnModel.defaultRenderer=function(value){if(typeof value=="string"&&value.length<1){return"&#160;";}
return value;};Ext.grid.AbstractSelectionModel=Ext.extend(Ext.util.Observable,{constructor:function(){this.locked=false;Ext.grid.AbstractSelectionModel.superclass.constructor.call(this);},init:function(grid){this.grid=grid;if(this.lockOnInit){delete this.lockOnInit;this.locked=false;this.lock();}
this.initEvents();},lock:function(){if(!this.locked){this.locked=true;var g=this.grid;if(g){g.getView().on({scope:this,beforerefresh:this.sortUnLock,refresh:this.sortLock});}else{this.lockOnInit=true;}}},sortLock:function(){this.locked=true;},sortUnLock:function(){this.locked=false;},unlock:function(){if(this.locked){this.locked=false;var g=this.grid,gv;if(g){gv=g.getView();gv.un('beforerefresh',this.sortUnLock,this);gv.un('refresh',this.sortLock,this);}else{delete this.lockOnInit;}}},isLocked:function(){return this.locked;},destroy:function(){this.unlock();this.purgeListeners();}});Ext.grid.RowSelectionModel=Ext.extend(Ext.grid.AbstractSelectionModel,{singleSelect:false,constructor:function(config){Ext.apply(this,config);this.selections=new Ext.util.MixedCollection(false,function(o){return o.id;});this.last=false;this.lastActive=false;this.addEvents('selectionchange','beforerowselect','rowselect','rowdeselect');Ext.grid.RowSelectionModel.superclass.constructor.call(this);},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on('rowmousedown',this.handleMouseDown,this);}
this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{'up':function(e){if(!e.shiftKey||this.singleSelect){this.selectPrevious(false);}else if(this.last!==false&&this.lastActive!==false){var last=this.last;this.selectRange(this.last,this.lastActive-1);this.grid.getView().focusRow(this.lastActive);if(last!==false){this.last=last;}}else{this.selectFirstRow();}},'down':function(e){if(!e.shiftKey||this.singleSelect){this.selectNext(false);}else if(this.last!==false&&this.lastActive!==false){var last=this.last;this.selectRange(this.last,this.lastActive+1);this.grid.getView().focusRow(this.lastActive);if(last!==false){this.last=last;}}else{this.selectFirstRow();}},scope:this});this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove});},onRefresh:function(){var ds=this.grid.store,index;var s=this.getSelections();this.clearSelections(true);for(var i=0,len=s.length;i<len;i++){var r=s[i];if((index=ds.indexOfId(r.id))!=-1){this.selectRow(index,true);}}
if(s.length!=this.selections.getCount()){this.fireEvent('selectionchange',this);}},onRemove:function(v,index,r){if(this.selections.remove(r)!==false){this.fireEvent('selectionchange',this);}},onRowUpdated:function(v,index,r){if(this.isSelected(r)){v.onRowSelect(index);}},selectRecords:function(records,keepExisting){if(!keepExisting){this.clearSelections();}
var ds=this.grid.store;for(var i=0,len=records.length;i<len;i++){this.selectRow(ds.indexOf(records[i]),true);}},getCount:function(){return this.selections.length;},selectFirstRow:function(){this.selectRow(0);},selectLastRow:function(keepExisting){this.selectRow(this.grid.store.getCount()-1,keepExisting);},selectNext:function(keepExisting){if(this.hasNext()){this.selectRow(this.last+1,keepExisting);this.grid.getView().focusRow(this.last);return true;}
return false;},selectPrevious:function(keepExisting){if(this.hasPrevious()){this.selectRow(this.last-1,keepExisting);this.grid.getView().focusRow(this.last);return true;}
return false;},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount();},hasPrevious:function(){return!!this.last;},getSelections:function(){return[].concat(this.selections.items);},getSelected:function(){return this.selections.itemAt(0);},each:function(fn,scope){var s=this.getSelections();for(var i=0,len=s.length;i<len;i++){if(fn.call(scope||this,s[i],i)===false){return false;}}
return true;},clearSelections:function(fast){if(this.isLocked()){return;}
if(fast!==true){var ds=this.grid.store;var s=this.selections;s.each(function(r){this.deselectRow(ds.indexOfId(r.id));},this);s.clear();}else{this.selections.clear();}
this.last=false;},selectAll:function(){if(this.isLocked()){return;}
this.selections.clear();for(var i=0,len=this.grid.store.getCount();i<len;i++){this.selectRow(i,true);}},hasSelection:function(){return this.selections.length>0;},isSelected:function(index){var r=Ext.isNumber(index)?this.grid.store.getAt(index):index;return(r&&this.selections.key(r.id)?true:false);},isIdSelected:function(id){return(this.selections.key(id)?true:false);},handleMouseDown:function(g,rowIndex,e){if(e.button!==0||this.isLocked()){return;}
var view=this.grid.getView();if(e.shiftKey&&!this.singleSelect&&this.last!==false){var last=this.last;this.selectRange(last,rowIndex,e.ctrlKey);this.last=last;view.focusRow(rowIndex);}else{var isSelected=this.isSelected(rowIndex);if(e.ctrlKey&&isSelected){this.deselectRow(rowIndex);}else if(!isSelected||this.getCount()>1){this.selectRow(rowIndex,e.ctrlKey||e.shiftKey);view.focusRow(rowIndex);}}},selectRows:function(rows,keepExisting){if(!keepExisting){this.clearSelections();}
for(var i=0,len=rows.length;i<len;i++){this.selectRow(rows[i],true);}},selectRange:function(startRow,endRow,keepExisting){var i;if(this.isLocked()){return;}
if(!keepExisting){this.clearSelections();}
if(startRow<=endRow){for(i=startRow;i<=endRow;i++){this.selectRow(i,true);}}else{for(i=startRow;i>=endRow;i--){this.selectRow(i,true);}}},deselectRange:function(startRow,endRow,preventViewNotify){if(this.isLocked()){return;}
for(var i=startRow;i<=endRow;i++){this.deselectRow(i,preventViewNotify);}},selectRow:function(index,keepExisting,preventViewNotify){if(this.isLocked()||(index<0||index>=this.grid.store.getCount())||(keepExisting&&this.isSelected(index))){return;}
var r=this.grid.store.getAt(index);if(r&&this.fireEvent('beforerowselect',this,index,keepExisting,r)!==false){if(!keepExisting||this.singleSelect){this.clearSelections();}
this.selections.add(r);this.last=this.lastActive=index;if(!preventViewNotify){this.grid.getView().onRowSelect(index);}
this.fireEvent('rowselect',this,index,r);this.fireEvent('selectionchange',this);}},deselectRow:function(index,preventViewNotify){if(this.isLocked()){return;}
if(this.last==index){this.last=false;}
if(this.lastActive==index){this.lastActive=false;}
var r=this.grid.store.getAt(index);if(r){this.selections.remove(r);if(!preventViewNotify){this.grid.getView().onRowDeselect(index);}
this.fireEvent('rowdeselect',this,index,r);this.fireEvent('selectionchange',this);}},restoreLast:function(){if(this._last){this.last=this._last;}},acceptsNav:function(row,col,cm){return!cm.isHidden(col)&&cm.isCellEditable(col,row);},onEditorKey:function(field,e){var k=e.getKey(),newCell,g=this.grid,last=g.lastEdit,ed=g.activeEditor,ae,last,r,c;var shift=e.shiftKey;if(k==e.TAB){e.stopEvent();ed.completeEdit();if(shift){newCell=g.walkCells(ed.row,ed.col-1,-1,this.acceptsNav,this);}else{newCell=g.walkCells(ed.row,ed.col+1,1,this.acceptsNav,this);}}else if(k==e.ENTER){if(this.moveEditorOnEnter!==false){if(shift){newCell=g.walkCells(last.row-1,last.col,-1,this.acceptsNav,this);}else{newCell=g.walkCells(last.row+1,last.col,1,this.acceptsNav,this);}}}
if(newCell){r=newCell[0];c=newCell[1];if(last.row!=r){this.selectRow(r);}
if(g.isEditor&&g.editing){ae=g.activeEditor;if(ae&&ae.field.triggerBlur){ae.field.triggerBlur();}}
g.startEditing(r,c);}},destroy:function(){if(this.rowNav){this.rowNav.disable();this.rowNav=null;}
Ext.grid.RowSelectionModel.superclass.destroy.call(this);}});Ext.grid.Column=Ext.extend(Object,{isColumn:true,constructor:function(config){Ext.apply(this,config);if(Ext.isString(this.renderer)){this.renderer=Ext.util.Format[this.renderer];}else if(Ext.isObject(this.renderer)){this.scope=this.renderer.scope;this.renderer=this.renderer.fn;}
if(!this.scope){this.scope=this;}
var ed=this.editor;delete this.editor;this.setEditor(ed);},renderer:function(value){if(Ext.isString(value)&&value.length<1){return'&#160;';}
return value;},getEditor:function(rowIndex){return this.editable!==false?this.editor:null;},setEditor:function(editor){var ed=this.editor;if(ed){if(ed.gridEditor){ed.gridEditor.destroy();delete ed.gridEditor;}else{ed.destroy();}}
this.editor=null;if(editor){if(!editor.isXType){editor=Ext.create(editor,'textfield');}
this.editor=editor;}},getCellEditor:function(rowIndex){var ed=this.getEditor(rowIndex);if(ed){if(!ed.startEdit){if(!ed.gridEditor){ed.gridEditor=new Ext.grid.GridEditor(ed);}
ed=ed.gridEditor;}}
return ed;}});Ext.grid.BooleanColumn=Ext.extend(Ext.grid.Column,{trueText:'true',falseText:'false',undefinedText:'&#160;',constructor:function(cfg){Ext.grid.BooleanColumn.superclass.constructor.call(this,cfg);var t=this.trueText,f=this.falseText,u=this.undefinedText;this.renderer=function(v){if(v===undefined){return u;}
if(!v||v==='false'){return f;}
return t;};}});Ext.grid.NumberColumn=Ext.extend(Ext.grid.Column,{format:'0,000.00',constructor:function(cfg){Ext.grid.NumberColumn.superclass.constructor.call(this,cfg);this.renderer=Ext.util.Format.numberRenderer(this.format);}});Ext.grid.DateColumn=Ext.extend(Ext.grid.Column,{format:'m/d/Y',constructor:function(cfg){Ext.grid.DateColumn.superclass.constructor.call(this,cfg);this.renderer=Ext.util.Format.dateRenderer(this.format);}});Ext.grid.TemplateColumn=Ext.extend(Ext.grid.Column,{constructor:function(cfg){Ext.grid.TemplateColumn.superclass.constructor.call(this,cfg);var tpl=(!Ext.isPrimitive(this.tpl)&&this.tpl.compile)?this.tpl:new Ext.XTemplate(this.tpl);this.renderer=function(value,p,r){return tpl.apply(r.data);};this.tpl=tpl;}});Ext.grid.Column.types={gridcolumn:Ext.grid.Column,booleancolumn:Ext.grid.BooleanColumn,numbercolumn:Ext.grid.NumberColumn,datecolumn:Ext.grid.DateColumn,templatecolumn:Ext.grid.TemplateColumn};Ext.grid.RowNumberer=Ext.extend(Object,{header:"",width:23,sortable:false,constructor:function(config){Ext.apply(this,config);if(this.rowspan){this.renderer=this.renderer.createDelegate(this);}},fixed:true,hideable:false,menuDisabled:true,dataIndex:'',id:'numberer',rowspan:undefined,renderer:function(v,p,record,rowIndex){if(this.rowspan){p.cellAttr='rowspan="'+this.rowspan+'"';}
return rowIndex+1;}});Ext.grid.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:'',id:'checker',constructor:function(){Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn;}},initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on('render',function(){var view=this.grid.getView();view.mainBody.on('mousedown',this.onMouseDown,this);Ext.fly(view.innerHd).on('mousedown',this.onHdMouseDown,this);},this);},handleMouseDown:function(){Ext.grid.CheckboxSelectionModel.superclass.handleMouseDown.apply(this,arguments);this.mouseHandled=true;},onMouseDown:function(e,t){if(e.button===0&&t.className=='x-grid3-row-checker'){e.stopEvent();var row=e.getTarget('.x-grid3-row');if(!this.mouseHandled&&row){var index=row.rowIndex;if(this.isSelected(index)){this.deselectRow(index);}else{this.selectRow(index,true);this.grid.getView().focusRow(index);}}}
this.mouseHandled=false;},onHdMouseDown:function(e,t){if(t.className=='x-grid3-hd-checker'){e.stopEvent();var hd=Ext.fly(t.parentNode);var isChecked=hd.hasClass('x-grid3-hd-checker-on');if(isChecked){hd.removeClass('x-grid3-hd-checker-on');this.clearSelections();}else{hd.addClass('x-grid3-hd-checker-on');this.selectAll();}}},renderer:function(v,p,record){return'<div class="x-grid3-row-checker">&#160;</div>';}});Ext.grid.CellSelectionModel=Ext.extend(Ext.grid.AbstractSelectionModel,{constructor:function(config){Ext.apply(this,config);this.selection=null;this.addEvents("beforecellselect","cellselect","selectionchange");Ext.grid.CellSelectionModel.superclass.constructor.call(this);},initEvents:function(){this.grid.on('cellmousedown',this.handleMouseDown,this);this.grid.on(Ext.EventManager.useKeydown?'keydown':'keypress',this.handleKeyDown,this);this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearSelections,beforerowsinserted:this.clearSelections});if(this.grid.isEditor){this.grid.on('beforeedit',this.beforeEdit,this);}},beforeEdit:function(e){this.select(e.row,e.column,false,true,e.record);},onRowUpdated:function(v,index,r){if(this.selection&&this.selection.record==r){v.onCellSelect(index,this.selection.cell[1]);}},onViewChange:function(){this.clearSelections(true);},getSelectedCell:function(){return this.selection?this.selection.cell:null;},clearSelections:function(preventNotify){var s=this.selection;if(s){if(preventNotify!==true){this.grid.view.onCellDeselect(s.cell[0],s.cell[1]);}
this.selection=null;this.fireEvent("selectionchange",this,null);}},hasSelection:function(){return this.selection?true:false;},handleMouseDown:function(g,row,cell,e){if(e.button!==0||this.isLocked()){return;}
this.select(row,cell);},select:function(rowIndex,colIndex,preventViewNotify,preventFocus,r){if(this.fireEvent("beforecellselect",this,rowIndex,colIndex)!==false){this.clearSelections();r=r||this.grid.store.getAt(rowIndex);this.selection={record:r,cell:[rowIndex,colIndex]};if(!preventViewNotify){var v=this.grid.getView();v.onCellSelect(rowIndex,colIndex);if(preventFocus!==true){v.focusCell(rowIndex,colIndex);}}
this.fireEvent("cellselect",this,rowIndex,colIndex);this.fireEvent("selectionchange",this,this.selection);}},isSelectable:function(rowIndex,colIndex,cm){return!cm.isHidden(colIndex);},onEditorKey:function(field,e){if(e.getKey()==e.TAB){this.handleKeyDown(e);}},handleKeyDown:function(e){if(!e.isNavKeyPress()){return;}
var k=e.getKey(),g=this.grid,s=this.selection,sm=this,walk=function(row,col,step){return g.walkCells(row,col,step,g.isEditor&&g.editing?sm.acceptsNav:sm.isSelectable,sm);},cell,newCell,r,c,ae;switch(k){case e.ESC:case e.PAGE_UP:case e.PAGE_DOWN:break;default:e.stopEvent();break;}
if(!s){cell=walk(0,0,1);if(cell){this.select(cell[0],cell[1]);}
return;}
cell=s.cell;r=cell[0];c=cell[1];switch(k){case e.TAB:if(e.shiftKey){newCell=walk(r,c-1,-1);}else{newCell=walk(r,c+1,1);}
break;case e.DOWN:newCell=walk(r+1,c,1);break;case e.UP:newCell=walk(r-1,c,-1);break;case e.RIGHT:newCell=walk(r,c+1,1);break;case e.LEFT:newCell=walk(r,c-1,-1);break;case e.ENTER:if(g.isEditor&&!g.editing){g.startEditing(r,c);return;}
break;}
if(newCell){r=newCell[0];c=newCell[1];this.select(r,c);if(g.isEditor&&g.editing){ae=g.activeEditor;if(ae&&ae.field.triggerBlur){ae.field.triggerBlur();}
g.startEditing(r,c);}}},acceptsNav:function(row,col,cm){return!cm.isHidden(col)&&cm.isCellEditable(col,row);}});Ext.grid.EditorGridPanel=Ext.extend(Ext.grid.GridPanel,{clicksToEdit:2,forceValidation:false,isEditor:true,detectEdit:false,autoEncode:false,trackMouseOver:false,initComponent:function(){Ext.grid.EditorGridPanel.superclass.initComponent.call(this);if(!this.selModel){this.selModel=new Ext.grid.CellSelectionModel();}
this.activeEditor=null;this.addEvents("beforeedit","afteredit","validateedit");},initEvents:function(){Ext.grid.EditorGridPanel.superclass.initEvents.call(this);this.getGridEl().on('mousewheel',this.stopEditing.createDelegate(this,[true]),this);this.on('columnresize',this.stopEditing,this,[true]);if(this.clicksToEdit==1){this.on("cellclick",this.onCellDblClick,this);}else{var view=this.getView();if(this.clicksToEdit=='auto'&&view.mainBody){view.mainBody.on('mousedown',this.onAutoEditClick,this);}
this.on('celldblclick',this.onCellDblClick,this);}},onResize:function(){Ext.grid.EditorGridPanel.superclass.onResize.apply(this,arguments);var ae=this.activeEditor;if(this.editing&&ae){ae.realign(true);}},onCellDblClick:function(g,row,col){this.startEditing(row,col);},onAutoEditClick:function(e,t){if(e.button!==0){return;}
var row=this.view.findRowIndex(t),col=this.view.findCellIndex(t);if(row!==false&&col!==false){this.stopEditing();if(this.selModel.getSelectedCell){var sc=this.selModel.getSelectedCell();if(sc&&sc[0]===row&&sc[1]===col){this.startEditing(row,col);}}else{if(this.selModel.isSelected(row)){this.startEditing(row,col);}}}},onEditComplete:function(ed,value,startValue){this.editing=false;this.lastActiveEditor=this.activeEditor;this.activeEditor=null;var r=ed.record,field=this.colModel.getDataIndex(ed.col);value=this.postEditValue(value,startValue,r,field);if(this.forceValidation===true||String(value)!==String(startValue)){var e={grid:this,record:r,field:field,originalValue:startValue,value:value,row:ed.row,column:ed.col,cancel:false};if(this.fireEvent("validateedit",e)!==false&&!e.cancel&&String(value)!==String(startValue)){r.set(field,e.value);delete e.cancel;this.fireEvent("afteredit",e);}}
this.view.focusCell(ed.row,ed.col);},startEditing:function(row,col){this.stopEditing();if(this.colModel.isCellEditable(col,row)){this.view.ensureVisible(row,col,true);var r=this.store.getAt(row),field=this.colModel.getDataIndex(col),e={grid:this,record:r,field:field,value:r.data[field],row:row,column:col,cancel:false};if(this.fireEvent("beforeedit",e)!==false&&!e.cancel){this.editing=true;var ed=this.colModel.getCellEditor(col,row);if(!ed){return;}
if(!ed.rendered){ed.parentEl=this.view.getEditorParent(ed);ed.on({scope:this,render:{fn:function(c){c.field.focus(false,true);},single:true,scope:this},specialkey:function(field,e){this.getSelectionModel().onEditorKey(field,e);},complete:this.onEditComplete,canceledit:this.stopEditing.createDelegate(this,[true])});}
Ext.apply(ed,{row:row,col:col,record:r});this.lastEdit={row:row,col:col};this.activeEditor=ed;ed.selectSameEditor=(this.activeEditor==this.lastActiveEditor);var v=this.preEditValue(r,field);ed.startEdit(this.view.getCell(row,col).firstChild,Ext.isDefined(v)?v:'');(function(){delete ed.selectSameEditor;}).defer(50);}}},preEditValue:function(r,field){var value=r.data[field];return this.autoEncode&&Ext.isString(value)?Ext.util.Format.htmlDecode(value):value;},postEditValue:function(value,originalValue,r,field){return this.autoEncode&&Ext.isString(value)?Ext.util.Format.htmlEncode(value):value;},stopEditing:function(cancel){if(this.editing){var ae=this.lastActiveEditor=this.activeEditor;if(ae){ae[cancel===true?'cancelEdit':'completeEdit']();this.view.focusCell(ae.row,ae.col);}
this.activeEditor=null;}
this.editing=false;}});Ext.reg('editorgrid',Ext.grid.EditorGridPanel);Ext.grid.GridEditor=function(field,config){Ext.grid.GridEditor.superclass.constructor.call(this,field,config);field.monitorTab=false;};Ext.extend(Ext.grid.GridEditor,Ext.Editor,{alignment:"tl-tl",autoSize:"width",hideEl:false,cls:"x-small-editor x-grid-editor",shim:false,shadow:false});Ext.grid.PropertyRecord=Ext.data.Record.create([{name:'name',type:'string'},'value']);Ext.grid.PropertyStore=Ext.extend(Ext.util.Observable,{constructor:function(grid,source){this.grid=grid;this.store=new Ext.data.Store({recordType:Ext.grid.PropertyRecord});this.store.on('update',this.onUpdate,this);if(source){this.setSource(source);}
Ext.grid.PropertyStore.superclass.constructor.call(this);},setSource:function(o){this.source=o;this.store.removeAll();var data=[];for(var k in o){if(this.isEditableValue(o[k])){data.push(new Ext.grid.PropertyRecord({name:k,value:o[k]},k));}}
this.store.loadRecords({records:data},{},true);},onUpdate:function(ds,record,type){if(type==Ext.data.Record.EDIT){var v=record.data.value;var oldValue=record.modified.value;if(this.grid.fireEvent('beforepropertychange',this.source,record.id,v,oldValue)!==false){this.source[record.id]=v;record.commit();this.grid.fireEvent('propertychange',this.source,record.id,v,oldValue);}else{record.reject();}}},getProperty:function(row){return this.store.getAt(row);},isEditableValue:function(val){return Ext.isPrimitive(val)||Ext.isDate(val);},setValue:function(prop,value,create){var r=this.getRec(prop);if(r){r.set('value',value);this.source[prop]=value;}else if(create){this.source[prop]=value;r=new Ext.grid.PropertyRecord({name:prop,value:value},prop);this.store.add(r);}},remove:function(prop){var r=this.getRec(prop);if(r){this.store.remove(r);delete this.source[prop];}},getRec:function(prop){return this.store.getById(prop);},getSource:function(){return this.source;}});Ext.grid.PropertyColumnModel=Ext.extend(Ext.grid.ColumnModel,{nameText:'Name',valueText:'Value',dateFormat:'m/j/Y',trueText:'true',falseText:'false',constructor:function(grid,store){var g=Ext.grid,f=Ext.form;this.grid=grid;g.PropertyColumnModel.superclass.constructor.call(this,[{header:this.nameText,width:50,sortable:true,dataIndex:'name',id:'name',menuDisabled:true},{header:this.valueText,width:50,resizable:false,dataIndex:'value',id:'value',menuDisabled:true}]);this.store=store;var bfield=new f.Field({autoCreate:{tag:'select',children:[{tag:'option',value:'true',html:this.trueText},{tag:'option',value:'false',html:this.falseText}]},getValue:function(){return this.el.dom.value=='true';}});this.editors={'date':new g.GridEditor(new f.DateField({selectOnFocus:true})),'string':new g.GridEditor(new f.TextField({selectOnFocus:true})),'number':new g.GridEditor(new f.NumberField({selectOnFocus:true,style:'text-align:left;'})),'boolean':new g.GridEditor(bfield,{autoSize:'both'})};this.renderCellDelegate=this.renderCell.createDelegate(this);this.renderPropDelegate=this.renderProp.createDelegate(this);},renderDate:function(dateVal){return dateVal.dateFormat(this.dateFormat);},renderBool:function(bVal){return this[bVal?'trueText':'falseText'];},isCellEditable:function(colIndex,rowIndex){return colIndex==1;},getRenderer:function(col){return col==1?this.renderCellDelegate:this.renderPropDelegate;},renderProp:function(v){return this.getPropertyName(v);},renderCell:function(val,meta,rec){var renderer=this.grid.customRenderers[rec.get('name')];if(renderer){return renderer.apply(this,arguments);}
var rv=val;if(Ext.isDate(val)){rv=this.renderDate(val);}else if(typeof val=='boolean'){rv=this.renderBool(val);}
return Ext.util.Format.htmlEncode(rv);},getPropertyName:function(name){var pn=this.grid.propertyNames;return pn&&pn[name]?pn[name]:name;},getCellEditor:function(colIndex,rowIndex){var p=this.store.getProperty(rowIndex),n=p.data.name,val=p.data.value;if(this.grid.customEditors[n]){return this.grid.customEditors[n];}
if(Ext.isDate(val)){return this.editors.date;}else if(typeof val=='number'){return this.editors.number;}else if(typeof val=='boolean'){return this.editors['boolean'];}else{return this.editors.string;}},destroy:function(){Ext.grid.PropertyColumnModel.superclass.destroy.call(this);for(var ed in this.editors){Ext.destroy(this.editors[ed]);}}});Ext.grid.PropertyGrid=Ext.extend(Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},initComponent:function(){this.customRenderers=this.customRenderers||{};this.customEditors=this.customEditors||{};this.lastEditRow=null;var store=new Ext.grid.PropertyStore(this);this.propStore=store;var cm=new Ext.grid.PropertyColumnModel(this,store);store.store.sort('name','ASC');this.addEvents('beforepropertychange','propertychange');this.cm=cm;this.ds=store.store;Ext.grid.PropertyGrid.superclass.initComponent.call(this);this.mon(this.selModel,'beforecellselect',function(sm,rowIndex,colIndex){if(colIndex===0){this.startEditing.defer(200,this,[rowIndex,1]);return false;}},this);},onRender:function(){Ext.grid.PropertyGrid.superclass.onRender.apply(this,arguments);this.getGridEl().addClass('x-props-grid');},afterRender:function(){Ext.grid.PropertyGrid.superclass.afterRender.apply(this,arguments);if(this.source){this.setSource(this.source);}},setSource:function(source){this.propStore.setSource(source);},getSource:function(){return this.propStore.getSource();},setProperty:function(prop,value,create){this.propStore.setValue(prop,value,create);},removeProperty:function(prop){this.propStore.remove(prop);}});Ext.reg("propertygrid",Ext.grid.PropertyGrid);Ext.grid.GroupingView=Ext.extend(Ext.grid.GridView,{groupByText:'Group By This Field',showGroupsText:'Show in Groups',hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:'(None)',ignoreAdd:false,groupTextTpl:'{text}',groupMode:'value',initTemplates:function(){Ext.grid.GroupingView.superclass.initTemplates.call(this);this.state={};var sm=this.grid.getSelectionModel();sm.on(sm.selectRow?'beforerowselect':'beforecellselect',this.onBeforeRowSelect,this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,'</div></div>','<div id="{groupId}-bd" class="x-grid-group-body">');}
this.startGroup.compile();if(!this.endGroup){this.endGroup='</div></div>';}},findGroup:function(el){return Ext.fly(el).up('.x-grid-group',this.mainBody.dom);},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[];},onAdd:function(ds,records,index){if(this.canGroup()&&!this.ignoreAdd){var ss=this.getScrollState();this.fireEvent('beforerowsinserted',ds,index,index+(records.length-1));this.refresh();this.restoreScroll(ss);this.fireEvent('rowsinserted',ds,index,index+(records.length-1));}else if(!this.canGroup()){Ext.grid.GroupingView.superclass.onAdd.apply(this,arguments);}},onRemove:function(ds,record,index,isUpdate){Ext.grid.GroupingView.superclass.onRemove.apply(this,arguments);var g=document.getElementById(record._groupId);if(g&&g.childNodes[1].childNodes.length<1){Ext.removeNode(g);}
this.applyEmptyText();},refreshRow:function(record){if(this.ds.getCount()==1){this.refresh();}else{this.isUpdating=true;Ext.grid.GroupingView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false;}},beforeMenuShow:function(){var item,items=this.hmenu.items,disabled=this.cm.config[this.hdCtxIndex].groupable===false;if((item=items.get('groupBy'))){item.setDisabled(disabled);}
if((item=items.get('showGroups'))){item.setDisabled(disabled);item.setChecked(this.enableGrouping,true);}},renderUI:function(){Ext.grid.GroupingView.superclass.renderUI.call(this);this.mainBody.on('mousedown',this.interceptMouse,this);if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add('-',{itemId:'groupBy',text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:'x-group-by-icon'});if(this.enableNoGroups){this.hmenu.add({itemId:'showGroups',text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this});}
this.hmenu.on('beforeshow',this.beforeMenuShow,this);}},processEvent:function(name,e){Ext.grid.GroupingView.superclass.processEvent.call(this,name,e);var hd=e.getTarget('.x-grid-group-hd',this.mainBody);if(hd){var field=this.getGroupField(),prefix=this.getPrefix(field),groupValue=hd.id.substring(prefix.length);groupValue=groupValue.substr(0,groupValue.length-3);if(groupValue){this.grid.fireEvent('group'+name,this.grid,field,groupValue,e);}}},onGroupByClick:function(){this.enableGrouping=true;this.grid.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));this.grid.fireEvent('groupchange',this,this.grid.store.getGroupState());this.beforeMenuShow();this.refresh();},onShowGroupsClick:function(mi,checked){this.enableGrouping=checked;if(checked){this.onGroupByClick();}else{this.grid.store.clearGrouping();this.grid.fireEvent('groupchange',this,null);}},toggleRowIndex:function(rowIndex,expanded){if(!this.canGroup()){return;}
var row=this.getRow(rowIndex);if(row){this.toggleGroup(this.findGroup(row),expanded);}},toggleGroup:function(group,expanded){var gel=Ext.get(group);expanded=Ext.isDefined(expanded)?expanded:gel.hasClass('x-grid-group-collapsed');if(this.state[gel.id]!==expanded){this.grid.stopEditing(true);this.state[gel.id]=expanded;gel[expanded?'removeClass':'addClass']('x-grid-group-collapsed');}},toggleAllGroups:function(expanded){var groups=this.getGroups();for(var i=0,len=groups.length;i<len;i++){this.toggleGroup(groups[i],expanded);}},expandAllGroups:function(){this.toggleAllGroups(true);},collapseAllGroups:function(){this.toggleAllGroups(false);},interceptMouse:function(e){var hd=e.getTarget('.x-grid-group-hd',this.mainBody);if(hd){e.stopEvent();this.toggleGroup(hd.parentNode);}},getGroup:function(v,r,groupRenderer,rowIndex,colIndex,ds){var g=groupRenderer?groupRenderer(v,{},r,rowIndex,colIndex,ds):String(v);if(g===''||g==='&#160;'){g=this.cm.config[colIndex].emptyGroupText||this.emptyGroupText;}
return g;},getGroupField:function(){return this.grid.store.getGroupState();},afterRender:function(){if(!this.ds||!this.cm){return;}
Ext.grid.GroupingView.superclass.afterRender.call(this);if(this.grid.deferRowRender){this.updateGroupWidths();}},renderRows:function(){var groupField=this.getGroupField();var eg=!!groupField;if(this.hideGroupedColumn){var colIndex=this.cm.findColumnIndex(groupField),hasLastGroupField=Ext.isDefined(this.lastGroupField);if(!eg&&hasLastGroupField){this.mainBody.update('');this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField;}else if(eg&&!hasLastGroupField){this.lastGroupField=groupField;this.cm.setHidden(colIndex,true);}else if(eg&&hasLastGroupField&&groupField!==this.lastGroupField){this.mainBody.update('');var oldIndex=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(oldIndex,false);this.lastGroupField=groupField;this.cm.setHidden(colIndex,true);}}
return Ext.grid.GroupingView.superclass.renderRows.apply(this,arguments);},doRender:function(cs,rs,ds,startRow,colCount,stripe){if(rs.length<1){return'';}
if(!this.canGroup()||this.isUpdating){return Ext.grid.GroupingView.superclass.doRender.apply(this,arguments);}
var groupField=this.getGroupField(),colIndex=this.cm.findColumnIndex(groupField),g,gstyle='width:'+this.getTotalWidth()+';',cfg=this.cm.config[colIndex],groupRenderer=cfg.groupRenderer||cfg.renderer,prefix=this.showGroupName?(cfg.groupName||cfg.header)+': ':'',groups=[],curGroup,i,len,gid;for(i=0,len=rs.length;i<len;i++){var rowIndex=startRow+i,r=rs[i],gvalue=r.data[groupField];g=this.getGroup(gvalue,r,groupRenderer,rowIndex,colIndex,ds);if(!curGroup||curGroup.group!=g){gid=this.constructId(gvalue,groupField,colIndex);this.state[gid]=!(Ext.isDefined(this.state[gid])?!this.state[gid]:this.startCollapsed);curGroup={group:g,gvalue:gvalue,text:prefix+g,groupId:gid,startRow:rowIndex,rs:[r],cls:this.state[gid]?'':'x-grid-group-collapsed',style:gstyle};groups.push(curGroup);}else{curGroup.rs.push(r);}
r._groupId=gid;}
var buf=[];for(i=0,len=groups.length;i<len;i++){g=groups[i];this.doGroupStart(buf,g,cs,ds,colCount);buf[buf.length]=Ext.grid.GroupingView.superclass.doRender.call(this,cs,g.rs,ds,g.startRow,colCount,stripe);this.doGroupEnd(buf,g,cs,ds,colCount);}
return buf.join('');},getGroupId:function(value){var field=this.getGroupField();return this.constructId(value,field,this.cm.findColumnIndex(field));},constructId:function(value,field,idx){var cfg=this.cm.config[idx],groupRenderer=cfg.groupRenderer||cfg.renderer,val=(this.groupMode=='value')?value:this.getGroup(value,{data:{}},groupRenderer,0,idx,this.ds);return this.getPrefix(field)+Ext.util.Format.htmlEncode(val);},canGroup:function(){return this.enableGrouping&&!!this.getGroupField();},getPrefix:function(field){return this.grid.getGridEl().id+'-gp-'+field+'-';},doGroupStart:function(buf,g,cs,ds,colCount){buf[buf.length]=this.startGroup.apply(g);},doGroupEnd:function(buf,g,cs,ds,colCount){buf[buf.length]=this.endGroup;},getRows:function(){if(!this.canGroup()){return Ext.grid.GroupingView.superclass.getRows.call(this);}
var r=[],gs=this.getGroups(),g,i=0,len=gs.length,j,jlen;for(;i<len;++i){g=gs[i].childNodes[1];if(g){g=g.childNodes;for(j=0,jlen=g.length;j<jlen;++j){r[r.length]=g[j];}}}
return r;},updateGroupWidths:function(){if(!this.canGroup()||!this.hasRows()){return;}
var tw=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.getScrollOffset())+'px';var gs=this.getGroups();for(var i=0,len=gs.length;i<len;i++){gs[i].firstChild.style.width=tw;}},onColumnWidthUpdated:function(col,w,tw){Ext.grid.GroupingView.superclass.onColumnWidthUpdated.call(this,col,w,tw);this.updateGroupWidths();},onAllColumnWidthsUpdated:function(ws,tw){Ext.grid.GroupingView.superclass.onAllColumnWidthsUpdated.call(this,ws,tw);this.updateGroupWidths();},onColumnHiddenUpdated:function(col,hidden,tw){Ext.grid.GroupingView.superclass.onColumnHiddenUpdated.call(this,col,hidden,tw);this.updateGroupWidths();},onLayout:function(){this.updateGroupWidths();},onBeforeRowSelect:function(sm,rowIndex){this.toggleRowIndex(rowIndex,true);}});Ext.grid.GroupingView.GROUP_ID=1000;
/* ========== ../mkt-ext-2.0/ext-overrides.js ============ */

(function(){var tempMenuMgrGet=Ext.menu.MenuMgr.get;Ext.menu.MenuMgr.get=function(menu){if(typeof menu=="string"||menu.events){return tempMenuMgrGet(menu);}else if(typeof menu.length=='number'){return new MktMenu({items:menu});}else{return new MktMenu(menu);}
return true;};Ext.apply(Ext,{BLANK_IMAGE_URL:"/images/spacer.gif"});if(typeof getEl=='undefined'){getEl=Ext.get;}
Ext.override(Ext.Element,{getNextSibling:function(selector){return this.next(selector,true);},getPreviousSibling:function(selector){return this.prev(selector,true);},getChildrenByTagName:function(cls){return this.query(cls);}});Ext.tree.TreeNode.prototype.hasUnfilteredChildren=function(filterRe){var cn=this.childNodes;if(cn==null)return;for(var i=0;i<cn.length;i++){var c=cn[i];if(!c.attributes.leaf){var filterMatch=false;if(isDefined(filterRe)){filterMatch=filterRe.test(c.filterText||c.text);}
if(!c.hidden&&(filterMatch||c.hasUnfilteredChildren(filterRe)))return true;}
else if(!c.hidden&&filterRe.test(c.filterText||c.text)){return true;};}
return false;};var emailValidator=/^([\w!#$%&''*+\-/=?^`{|}~]+)(.[\w!#$%&''*+\-/=?^`{|}~]+)*@([\w-]+\.){1,5}([A-Za-z]){2,}$/;Ext.form.VTypes.emailMask=/[a-z0-9_\.@!#$%&''*+\-/=?^`{|}~]/i;Ext.form.VTypes.email=function(v){return emailValidator.test(v);}
var tempExtMsgBoxHide=Ext.MessageBox.hide;Ext.MessageBox.hide=function(){if(Ext.MessageBox.isVisible()){tempExtMsgBoxHide.call(Ext.MessageBox);}
return Ext.MessageBox;}
Ext.override(Ext.DataView,{prepareData:function(data){var lData=[];if(data&&data.val&&isString(data.val)){lData['val']=Ext.util.Format.htmlEncode(data['val']);}else{lData=data;}
return lData;}});Ext.override(Ext.form.ComboBox,{initComponent:function(){Ext.form.ComboBox.superclass.initComponent.call(this);this.addEvents('expand','collapse','beforeselect','select','beforequery');if(this.transform){this.allowDomMove=false;var s=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=s.name;}
if(!this.store){this.mode='local';var d=[],opts=s.options;for(var i=0,len=opts.length;i<len;i++){var o=opts[i];var value=(o.hasAttribute?o.hasAttribute('value'):o.getAttribute('value')!==null)?o.value:o.text;if(o.selected){this.value=value;}
d.push([value,o.text]);}
this.store=new Ext.data.SimpleStore({'id':0,fields:['value','text'],data:d});this.valueField='value';this.displayField='text';}
s.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(s,this.autoCreate||this.defaultAutoCreate);Ext.removeNode(s);this.render(this.el.parentNode);}else{Ext.removeNode(s);}}
else if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.SimpleStore({fields:['value','text'],data:this.store});this.valueField='value';}else{this.store=new Ext.data.SimpleStore({fields:['text'],data:this.store,expandData:true});this.valueField='text';}
this.displayField='text';this.mode='local';}
this.selectedIndex=-1;if(this.mode=='local'){if(this.initialConfig.queryDelay===undefined){this.queryDelay=10;}
if(this.initialConfig.minChars===undefined){this.minChars=0;}}}});if(Ext.isIE){Ext.override(Ext.tree.TreeEditor,{triggerEdit:function(node,defer){this.completeEdit();if(node.attributes.editable!==false){this.editNode=node;if(this.tree.autoScroll){Ext.fly(node.ui.getEl()).scrollIntoView(this.tree.body);}
this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[node.ui.textNode,node.text]);return false;}}});};if(!Ext.DomQuery.byAttributeIE){Ext.DomQuery['byAttributeIE']=function(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom=="{",fn=Ext.DomQuery.operators[op],a,innerHTML;for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType!=1){continue;}
innerHTML=ci.innerHTML;if(innerHTML!==null&&innerHTML!==undefined){if(useGetStyle){a=Ext.DomQuery.getStyle(ci,attr);}else if(attr=="class"||attr=="className"){a=ci.className;}else if(attr=="for"){a=ci.htmlFor;}else if(attr=="href"){a=ci.getAttribute("href",2);}else if(attr=="style"){a=ci.getAttribute("style").cssText;}else{a=ci.getAttribute(attr);}}else{a=ci.getAttribute(attr);}
if((fn&&fn(a,value))||(!fn&&a)){result[++ri]=ci;}}
return result;};}
if(Ext.isIE7){Ext.DomQuery.matchers[2]={re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]\}])/,select:'n = Ext.DomQuery.byAttributeIE(n, "{2}", "{4}", "{3}", "{1}");'};};Ext.applyIf(Function.prototype,{waitUntil:function(waitConfig,obj,args,appendArgs){var pollingConfig={};pollingConfig['successFn']=this.createDelegate(obj,args,appendArgs);pollingConfig['pollInterval']=waitConfig.pollInterval||100;pollingConfig['timeout']=waitConfig.timeout||5000;pollingConfig['timeoutFn']=waitConfig.timoutCallback||Ext.emptyFn;pollingConfig['pollingFn']=waitConfig.pollingTest||function(){return true;};var statusInfo={};statusInfo['startTime']=new Date();statusInfo['pollCount']=1;this._waitUntilPoller(pollingConfig,statusInfo);},_waitUntilPoller:function(pollingConfig,statusInfo){var elapsedTime=(new Date()).getTime()-statusInfo.startTime.getTime();if(pollingConfig.pollingFn()){pollingConfig.successFn();}
else if(elapsedTime>pollingConfig.timeout){pollingConfig.timeoutFn();}
else{statusInfo.pollCount++;this._waitUntilPoller.defer(pollingConfig.pollInterval,this,[pollingConfig,statusInfo]);}}});var ua=navigator.userAgent.toLowerCase();var isIE9=Ext.isIE&&/trident\/5/.test(ua);Ext.applyIf(Ext,{isIE9:isIE9});if(Ext.isIE9){var connectionHeader={'Connection':'close'};if(Ext.Ajax.defaultHeaders){Ext.apply(Ext.Ajax.defaultHeaders,connectionHeader);}
else{Ext.Ajax.defaultHeaders=connectionHeader;}}
Ext.override(Ext.tree.TreeNodeUI,{onTextChange:function(node,text,oldText){if(this.rendered){var decodedText=Ext.util.Format.htmlDecode(text);this.textNode.innerHTML=Ext.util.Format.htmlEncode(decodedText);}}});Ext.grid.RowSelectionModel.override({getSelectedIndex:function(){return this.grid.store.indexOf(this.selections.itemAt(0));}});if(Ext.versionDetail.major==3){Ext.History=(function(){var iframe,hiddenField;var ready=false;var currentToken;function getHash(){var href=window.location.href,i=href.indexOf("#");return i>=0?href.substr(i+1):null;}
function doSave(){hiddenField.value=currentToken;}
function handleStateChange(token){currentToken=token;Ext.History.fireEvent('change',token);}
function updateIFrame(token){var html=['<html><body><div id="state">',Ext.util.Format.htmlEncode(token),'</div></body></html>'].join('');try{var doc=iframe.contentWindow.document;doc.open();doc.write(html);doc.close();return true;}catch(e){return false;}}
function checkIFrame(){if(!iframe.contentWindow||!iframe.contentWindow.document){setTimeout(checkIFrame,10);return;}
var doc=iframe.contentWindow.document;var elem=doc.getElementById("state");var token=elem?elem.innerText:null;var hash=getHash();setInterval(function(){doc=iframe.contentWindow.document;elem=doc.getElementById("state");var newtoken=elem?elem.innerText:null;var newHash=getHash();if(newtoken!==token){token=newtoken;handleStateChange(token);window.location.hash=token;hash=token;doSave();}else if(newHash!==hash){hash=newHash;updateIFrame(newHash);}},50);ready=true;Ext.History.fireEvent('ready',Ext.History);}
function startUp(){currentToken=hiddenField.value?hiddenField.value:getHash();if(Ext.isIE){checkIFrame();}else{var hash=getHash();setInterval(function(){var newHash=getHash();if(newHash!==hash){hash=newHash;handleStateChange(hash);doSave();}},50);ready=true;Ext.History.fireEvent('ready',Ext.History);}}
return{fieldId:'x-history-field',iframeId:'x-history-frame',events:{},init:function(onReady,scope){if(ready){Ext.callback(onReady,scope,[this]);return;}
if(!Ext.isReady){Ext.onReady(function(){Ext.History.init(onReady,scope);});return;}
hiddenField=Ext.getDom(Ext.History.fieldId);if(Ext.isIE){iframe=Ext.getDom(Ext.History.iframeId);}
this.addEvents('ready','change');if(onReady){this.on('ready',onReady,scope,{single:true});}
startUp();},add:function(token,preventDup){if(preventDup!==false){if(this.getToken()==token){return true;}}
if(Ext.isIE){return updateIFrame(token);}else{window.location.hash=token;return true;}},back:function(){history.go(-1);},forward:function(){history.go(1);},getToken:function(){return ready?currentToken:getHash();}};})();Ext.apply(Ext.History,new Ext.util.Observable());}})();
/* ========== ../mkt-ext-2.0/main/security.js ============ */

MktSecurity={_xsrfId:null,getXsrfId:function(){return this._xsrfId;},setXsrfId:function(xsrfId){this._xsrfId=xsrfId;if(Ext.Ajax.extraParams){Ext.apply(Ext.Ajax.extraParams,{xsrfId:this._xsrfId});}
else{Ext.Ajax.extraParams={xsrfId:this._xsrfId};}}};
/* ========== ../mkt-ext-2.0/Mkt.js ============ */

Ext.ns('MktUtil','Mkt','Mkt.app','Mkt.menus');MktUtil.getFirstElementByClassName=function(className,tag,root){tag=tag||'*';if(root){root=Ext.get(root).dom;if(!root){return null;}}else{root=document;}
var elements=root.getElementsByTagName(tag);if(!elements.length&&(tag=='*'&&root.all)){elements=root.all;}
for(var i=0,len=elements.length;i<len;++i){if(Ext.get(elements[i]).hasClass(className)){return elements[i];}}
return null;};MktUtil.camelCase=function(str){return str.charAt(0).toUpperCase()+str.substring(1);};MktUtil.uniqueName=function(baseName,store,fieldName,caseSensitive,seperator){seperator=seperator==undefined?'':seperator;var newValue=baseName;for(var i=1;store.find(fieldName,newValue,0,false,caseSensitive)>-1;i++){newValue=baseName+seperator+i;}
return newValue;}
MktUtil.removeProtoIdPrefix=function(node,pfx){if(isDefined(node.id))node.id=node.id.slice(pfx.length);if(isDefined(node.name))node.name=node.name.slice(pfx.length);if(node.childNodes!=null){for(var i=0;i<node.childNodes.length;i++){MktUtil.removeProtoIdPrefix(node.childNodes.item(i),pfx);}}};MktUtil.focusForm=function(formEl){var tabitems=Ext.query('[@tabindex]',$(formEl));if(tabitems.length>0){for(var ix=0;ix<tabitems.length;ix++){var el=getEl(tabitems[ix]);if(el.dom.tabindex=1)break;}
el.focus();}};MktUtil.currentLoadingScripts=[];MktUtil.loadScripts=function(scriptPaths,isLoadedFn,onLoadFn,onFailFn){var loadingKey=scriptPaths.join('#');if(MktUtil.currentLoadingScripts[loadingKey]){console.debug('Script already being loaded.');return;}
else{console.debug('Initial script load request.');MktUtil.currentLoadingScripts[loadingKey]=true;}
var timeoutFn=function(){delete MktUtil.currentLoadingScripts[loadingKey];var errorText="Scripts were not loaded: "+scriptPaths;MktSession.phoneHome({systemErrorMsg:MktMessage.SYSTEM_ERROR_REFRESH,cleanResponseText:errorText});MktMessage.showSystemError(MktMessage.SYSTEM_ERROR_REFRESH,{cleanResponseText:errorText,showDebugInfo:MktPage.isDev()});};var wrappedLoadFn=function(){delete MktUtil.currentLoadingScripts[loadingKey];onLoadFn();};var scriptHtml="";for(var i=0;i<scriptPaths.length;i++){scriptHtml+='<script type="text/javascript" src="'+scriptPaths[i]+'"></script>\n';}
var scriptDiv=document.createElement('div');scriptDiv=Ext.getBody().appendChild(scriptDiv);var callbackFn=function(){scriptDiv.remove();var waitConfig={pollingTest:isLoadedFn,timeout:30000,timoutCallback:onFailFn||timeoutFn};wrappedLoadFn.waitUntil(waitConfig);};if(isLoadedFn()){console.debug('Javascript files already loaded');callbackFn();}
else{console.debug('Loading dynamic javascript files...');scriptDiv.update(scriptHtml,true,callbackFn);}};MktUtil.getFirstElementByClassName=function(className,tag,root){tag=tag||'*';if(root){root=Ext.getDom(root);if(!root){return null;}}else{root=document;}
var elements=root.getElementsByTagName(tag);if(!elements.length&&(tag=='*'&&root.all)){elements=root.all;}
for(var i=0,len=elements.length;i<len;++i){if(Ext.get(elements[i]).hasClass(className)){return elements[i];}}
return null;};MktUtil.getClassByName=function(className,param1,param2,param3){var newClassObj=null;var nameSpaceArray=className.split('.');var classDef=window;for(var i=0;classDef&&i<nameSpaceArray.length;i++){classDef=classDef[nameSpaceArray[i]];}
if(classDef){newClassObj=new classDef(param1,param2,param3);}
return newClassObj||null;};MktUtil.selectTextByElement=function(htmlElement){if(document.selection){var range=document.body.createTextRange();range.moveToElementText(htmlElement);range.select();}
else{var range=document.createRange();range.selectNodeContents(htmlElement);window.getSelection().removeAllRanges();window.getSelection().addRange(range);}};MktUtil.findFrame=function(frameName){var myIframe=null;for(var i=0;i<top.frames.length;i++){try{if(isDefined(top.frames[i].name)&&(top.frames[i].name==frameName)){myIframe=top.frames[i];break;}}catch(e){}}
return myIframe;};mktInputCharCounter=function(pInputEl,iMaxChars,pMsgEl,pSynchedEl,copyCallback,countCallback){this.inputEl=getEl(pInputEl);this.iMaxChars=iMaxChars;if(pMsgEl!=null){this.msgEl=getEl(pMsgEl);}
if(pSynchedEl!=null)
this.synchedEl=getEl(pSynchedEl);this.copyCallback=copyCallback;this.countCallback=countCallback;this.inputEl.addListener('keyup',this.refresh,this,true);this.refresh();};mktInputCharCounter.prototype.refresh=function(){if(this.iMaxChars!=null){var length;if(isFunction(this.countCallback)!=null){length=this.countCallback(this.inputEl.dom.value);}
else{length=this.inputEl.dom.value.length;}
var remaining=this.iMaxChars-length;if(remaining>=0){this.msgEl.removeClass('mktInputCharsOver');this.msgEl.addClass('mktInputCharsRemaining');this.msgEl.dom.innerHTML=remaining+' characters remaining';}
else{this.msgEl.removeClass('mktInputCharsRemaining');this.msgEl.addClass('mktInputCharsOver');this.msgEl.dom.innerHTML=Math.abs(remaining)+' characters over';}}
if(this.synchedEl!=null){var tel=this.synchedEl.dom;var sval=this.inputEl.dom.value;if(sval==""&&(this.prefix!=""&&!isDefined(this.prefix))){this.prefix=this.synchedEl.dom.value;}
if(Ext.get('programPrefix')&&Ext.get('programPrefix').dom&&Ext.get('programPrefix').dom.value){this.prefix=Ext.get('programPrefix').dom.value;}
else if(!tel.value){this.prefix='';}
if(isFunction(this.copyCallback))sval=this.copyCallback(sval);if(tel.tagName.toLowerCase()=='input'){if(tel.type.toLowerCase()=='text'){tel.value=this.prefix+sval;}}else{tel.innerHTML=sval;}}};mktInputCharCounter.prototype.destroy=function(){this.inputEl.removeListener('keyup',this.refresh,this);};MktUtil.Basename=function(path,platform){if(!path)
return;this._path=path;if(platform)
this._platform=platform;if(typeof(this._platform)=="undefined"){if(navigator.platform.indexOf("Win")>=0){this._platform=MktUtil.Basename.WIN;}else if(navigator.platform.indexOf("Mac")>=0){this._platform=MktUtil.Basename.MAC;}else{this._platform=MktUtil.Basename.UNIX;}}
if(this._platform==MktUtil.Basename.WIN)
this._pattern=/^(.*\\)?(.*)/;else
this._pattern=/^(.*\/)?(.*)/;var rc=this._path.match(this._pattern);this._basename=rc[2];if(!this._basename)this._basename="";this._dirname=_chop(rc[1]);return;};MktUtil.Basename.VERSION="0.02";MktUtil.Basename.WIN=1;MktUtil.Basename.MAC=2;MktUtil.Basename.UNIX=3;MktUtil.Basename.platformStrs=new Array("N/A","Windows","Macintosh","UNIX");function _chop(str){if(!str)
return"";return str.substr(0,(str.length-1));}
MktUtil.Basename.prototype.basename=function(){return this._basename;};MktUtil.Basename.prototype.dirname=function(){return this._dirname;};MktUtil.Basename.prototype.path=function(){return this._path;};MktUtil.Basename.prototype.platform=function(){return this._platform;};MktUtil.Basename.prototype.platform_str=function(){return MktUtil.Basename.platformStrs[this._platform];};
/* ========== ../mkt-ext-2.0/MktMenu.js ============ */

MktMenu=function(attributes){MktMenu.superclass.constructor.call(this,attributes);};Ext.extend(MktMenu,Ext.menu.Menu,{ctype:"MktMenu",onMouseOver:function(e){if(!this.cancelHide){this.cancelHide=true;}
MktMenu.superclass.onMouseOver.call(this,e);},onMouseOut:function(e){if(this.cancelHide){delete this.cancelHide;}
MktMenu.superclass.onMouseOut.call(this,e);},getMenuItem:function(config){if(!config.isXType){if(!config.xtype&&Ext.isBoolean(config.checked)){return new Ext.menu.CheckItem(config)}
return new MktMenuItem(config);}
return config;}});MktMenuItem=function(attributes){MktMenuItem.superclass.constructor.call(this,attributes);};Ext.extend(MktMenuItem,Ext.menu.Item,{ctype:"MktMenuItem",showDelay:500,popupTooltip:'Open in new window',normMarkup:'<img src="{icon}" class="x-menu-item-icon {iconCls}" />'+'<span class="x-menu-item-text">{text}</span>',withPopupMarkup:'<div class="mktPopupContainer">'+'<div style="float:left;" class="mktPopupText">'+'<img src="{icon}" class="x-menu-item-icon {iconCls}" />'+'<span class="x-menu-item-text">{text}</span>'+'</div>'+'<div style="float: right;">'+'<img  src="{icon}" class="mktPopupImage" />'+'</div>'+'<div style="clear: left;"></div>'+'</div>',hideDelay:500,onRender:function(container,position){this.itemTpl=Ext.menu.Item.prototype.itemTpl=new Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"','</tpl>','>',(this.enablePopupItem?this.withPopupMarkup:this.normMarkup),'</a>');var a=this.getTemplateArgs();this.el=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(container,a,true);this.iconEl=this.el.child('img.x-menu-item-icon');this.textEl=this.el.child('.x-menu-item-text');if(!this.href){this.mon(this.el,'click',Ext.emptyFn,null,{preventDefault:true});}
Ext.menu.Item.superclass.onRender.call(this,container,position);if(this.enablePopupItem&&!this.dtTooltip){this.dtTooltip=new Ext.util.DelayedTask(this.delayAddTooltip,this,[this.getEl()]);this.dtTooltip.delay(500);}},delayAddTooltip:function(el){var popupItems=Ext.query('.mktPopupImage',el.dom);if(popupItems&&popupItems.length){for(var i=0;i<popupItems.length;i++){if(!popupItems[i].qtip){popupItems[i].qtip=this.popupTooltip;}}}},deferHide:function(){delete this.hideTimer;if(this.menu.cancelHide){delete this.cancelHide;this.parentMenu.tryActivate(this.parentMenu.items.indexOf(this),0);return;}
this.menu.hide();}});Ext.ns('Mkt.widgets');Mkt.widgets.FilterTreeMenu=function(config){Mkt.widgets.FilterTreeMenu.superclass.constructor.call(this,config);this.plain=true;config.treeConfig=config.treeConfig||{};this.treePanel=new Mkt.widgets.ComponentFilterTreePanel(Ext.apply({dataUrl:config.treeDataUrl,frame:false,maskDisabled:true,cancelSaveExpandState:true,loader:new MktTreeLoader({uiProvider:MktTreeNodeUI,dataUrl:config.treeDataUrl}),autoScroll:true},config.treeConfig));compFilterTree=this.treePanel;config.filterConfig=config.filterConfig||{};this.palette=new Mkt.widgets.FilterTreePanel(Ext.apply(config.filterConfig,{filterBranches:false,filterBranchNames:true,layout:'fit',width:300,height:400,filterFieldPadding:10,frame:false,autoScroll:false,items:new Ext.Panel({cls:'mktSmartPaletteTree',frame:true,layout:'fit',autoScroll:false,items:[this.treePanel]})}));this.palette.bindTree(this.treePanel);this.add(this.palette);this.on('beforeshow',function(){if(this.treePanel){this.treePanel.render();}},this);};Ext.extend(Mkt.widgets.FilterTreeMenu,Ext.menu.Menu,{resizable:true,reservedHeight:10,reservedWidth:10,minWidth:313,disableMenuFocus:true,cls:'mktFilterTreeMenu',render:function(){Mkt.widgets.FilterTreeMenu.superclass.render.call(this);if(this.resizable){this.resizer=new Ext.Resizable(this.el,{pinned:true,handles:'se',resizeChild:true});this.resizer.on('resize',function(resizable,width,height,e){var palette=this.palette;palette.setHeight(height-this.reservedHeight);palette.setWidth(width-this.reservedWidth);}.createDelegate(this));}
if(this.disableMenuFocus){Ext.get(this.el).addClass('disable-menu-focus');}},getSelectedItems:function(){return this.getFilterTree().getChecked('id');},getFilterTree:function(){return this.treePanel;},getPalette:function(){return this.palette;}});Mkt.widgets.FilterTreeWindow=function(config){Mkt.widgets.FilterTreeWindow.superclass.constructor.call(this,config);this.plain=true;config.treeConfig=config.treeConfig||{};this.treePanel=new Mkt.widgets.ComponentFilterTreePanel(Ext.apply({dataUrl:config.treeDataUrl,frame:false,maskDisabled:true,cancelSaveExpandState:true,loader:new MktTreeLoader({uiProvider:MktTreeNodeUI,dataUrl:config.treeDataUrl}),autoScroll:true},config.treeConfig));var compFilterTree=this.treePanel;var selectedNodes=config.treeConfig.selectedNodes;if(!selectedNodes||selectedNodes.length==0){this.treePanel.getLoader().on({'load':function(){var rootNode=compFilterTree.getRootNode().firstChild
if(rootNode){rootNode.getUI().toggleCheck(true);}}});}
config.filterConfig=config.filterConfig||{};this.palette=new Mkt.widgets.FilterTreePanel(Ext.apply(config.filterConfig,{filterBranches:false,filterBranchNames:true,layout:'fit',width:330,height:380,filterFieldPadding:0,frame:false,autoScroll:false,items:new Ext.Panel({cls:'mktSmartPaletteTree',frame:true,layout:'fit',autoScroll:false,items:[this.treePanel]})}));this.palette.bindTree(this.treePanel);this.add(this.palette);this.on('beforeshow',function(){if(this.treePanel){this.treePanel.render();}},this);};Ext.extend(Mkt.widgets.FilterTreeWindow,Ext.Window,{resizable:true,reservedHeight:10,reservedWidth:10,minWidth:313,width:377,bodyStyle:'padding: 20px 15px 20px 15px;',disableMenuFocus:true,cls:'mktFilterTreeWindow',getSelectedItems:function(){var checkedIds=[];var checkedNodes=this.getFilterTree().getChecked();for(var i=0;i<checkedNodes.length;i++){var node=checkedNodes[i];checkedIds.push(node.attributes.id);if(this.filterType=='program'){if(node.attributes.compType=='Marketing Program'){checkedIds.push('PG'+node.attributes.compId);}
else if(node.attributes.compType=='Marketing Event'){checkedIds.push('ME'+node.attributes.compId);}}}
return checkedIds;},getFilterTree:function(){return this.treePanel;},getPalette:function(){return this.palette;}});
/* ========== ../mkt-ext-2.0/cache/MktCache.js ============ */

Ext.ns('Mkt.cache');Mkt.cache.CacheItem=function(initialValue){};Mkt.cache.CacheItem=Ext.extend(Mkt.cache.CacheItem,{value:null,lastUpdateTime:null,invalid:false,expireDate:null,lifespan:null,constructor:function(initialValue){this.setValue(initialValue);},setValue:function(newValue){this.value=newValue;this.lastUpdateTime=new Date();this.invalid=false;},getValue:function(){return this.value;},setExpireDate:function(date){if(date instanceof Date){this.expireDate=date;}
else{this.expireDate=null;}},setLifespan:function(lifespan){if(isNaN(lifespan)){this.lifespan=null;}
else{this.lifespan=lifespan;}},isValid:function(){return(!this.invalid&&!this.isExpired());},invalidate:function(){this.invalid=true;},isExpired:function(){var isExp=false;if(this.expireDate){isExp=this.expireDate<=new Date();}
if(!isExp&&this.lifespan){var currentDate=new Date();isExp=currentDate.getTime()>=this.lastUpdateTime.getTime()+this.lifespan*1000;}
return isExp;},touchLastUpdateTime:function(){this.lastUpdateTime=new Date();}});Mkt.cache.CacheManager={_cache:new Ext.util.MixedCollection(),set:function(key,newValue,extraConfig){if(key){var thisItem=this._cache.key(key);if(!thisItem){thisItem=new Mkt.cache.CacheItem(newValue);this._cache.add(key,thisItem);}
thisItem.setValue(newValue);if(extraConfig&&extraConfig.expirationDate){thisItem.setExpireDate(extraConfig.expirationDate);}
if(extraConfig&&extraConfig.lifespan){thisItem.setLifespan(extraConfig.lifespan);}}},getValue:function(key){var returnVal=null;var thisItem=this._cache.key(key);if(thisItem){returnVal=thisItem.getValue();}
return returnVal;},getCacheItem:function(key){if(this._cache.contains(key)){return this._cache.key(key);}
return null;},removeAll:function(){this._cache.clear();},remove:function(keys){this._executeForEachKey(keys,this._remove);},contains:function(key){return this._cache.containsKey(key);},containsValid:function(key){var item=this._cache.key(key);return item&&item.isValid();},invalidate:function(keys){this._executeForEachKey(keys,this._invalid);},touchLastUpdateTime:function(keys){this._executeForEachKey(keys,this._touchLastUpdateTime);},_invalid:function(scope,key){var thisItem=scope._cache.key(key);if(thisItem){thisItem.invalidate();}},_remove:function(scope,key){scope._cache.removeKey(key);},_touchLastUpdateTime:function(scope,key){var thisItem=scope._cache.key(key);if(thisItem){thisItem.touchLastUpdateTime();}},_executeForEachKey:function(keys,fnToRun){if(Ext.isArray(keys)){for(var key in keys){fnToRun(this,key);}}
else if(typeof keys==='string'){fnToRun(this,keys);}
else if(typeof keys==='object'){this._cache.eachKey(this._executeForEachKeyMatch,{mgr:this,keyMatch:keys,fnToRun:fnToRun});}},_executeForEachKeyMatch:function(key,item){if(this.keyMatch.test(key)){this.fnToRun(this.mgr,key);}}};
/* ========== ../mkt-ext-2.0/widgets/GroupSummary.js ============ */

Ext.grid.GroupSummary=function(config){Ext.apply(this,config);};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(grid){this.grid=grid;this.cm=grid.getColumnModel();this.view=grid.getView();var v=this.view;v.doGroupEnd=this.doGroupEnd.createDelegate(this);v.afterMethod('onColumnWidthUpdated',this.doWidth,this);v.afterMethod('onAllColumnWidthsUpdated',this.doAllWidths,this);v.afterMethod('onColumnHiddenUpdated',this.doHidden,this);v.afterMethod('onUpdate',this.doUpdate,this);v.afterMethod('onRemove',this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr></tbody>','</table></div>');this.rowTpl.disableFormats=true;}
this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true;}
this.cellTpl.compile();},toggleSummaries:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass('x-grid-hide-summary');}
el[visible?'removeClass':'addClass']('x-grid-hide-summary');}},renderSummary:function(o,cs){cs=cs||this.view.getColumnData();var cfg=this.cm.config;var buf=[],c,p={},cf,last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];p.id=c.id;p.style=c.style;p.css=i===0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o);}else{p.value='';}
if(p.value==undefined||p.value==="")p.value="&#160;";buf[buf.length]=this.cellTpl.apply(p);}
return this.rowTpl.apply({tstyle:'width:'+this.view.getTotalWidth()+';',cells:buf.join('')});},calculate:function(rs,cs){var data={},r,c,cfg=this.cm.config,cf;for(var j=0,jlen=rs.length;j<jlen;j++){r=rs[j];for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];if(cf.summaryType){data[c.name]=Ext.grid.GroupSummary.Calculations[cf.summaryType](data[c.name]||0,r,c.name,data,cf);}}}
for(var k=0,len2=cs.length;k<len2;k++){c=cs[k];cf=cfg[k];if(cf.summaryType){switch(cf.summaryType){case'average':var total=data[c.name+'total']||0;var count=data[c.name+'count']||0;data[c.name]=count===0?0:total/count;break;case'percent':var n=data[cf['summaryNumerator']]||0.0;var d=data[cf['summaryDenominator']]||0.0;data[c.name]=d===0.0?0.0:n/d;break;case'weighted_average':var summaryTotal=data[c.name+'Total']||0.0;var summaryWeight=data[cf['summaryWeight']]||0.0;data[c.name]=summaryTotal===0.0?0.0:summaryTotal/summaryWeight;break;default:break;}}}
return data;},doGroupEnd:function(buf,g,cs,ds,colCount){var data=this.calculate(g.rs,cs);buf.push('</div>',this.renderSummary({data:data},cs),'</div>');},doWidth:function(col,w,tw){var gs=this.view.getGroups(),s;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];if(s){s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w;}}},doAllWidths:function(ws,tw){var gs=this.view.getGroups(),s,cells,wlen=ws.length;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;cells=s.firstChild.rows[0].childNodes;for(var j=0;j<wlen;j++){cells[j].style.width=ws[j];}}},doHidden:function(col,hidden,tw){var gs=this.view.getGroups(),s,display=hidden?'none':'';for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];if(!s)continue;s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display;}},refreshSummary:function(groupValue){return this.refreshSummaryById(this.view.getGroupId(groupValue));},getSummaryNode:function(gid){var g=Ext.fly(gid,'_gsummary');if(g){return g.down('.x-grid3-summary-row',true);}
return null;},refreshSummaryById:function(gid){var g=document.getElementById(gid);if(!g){return false;}
var rs=[];this.grid.store.each(function(r){if(r._groupId==gid){rs[rs.length]=r;}});var cs=this.view.getColumnData();var data=this.calculate(rs,cs);var markup=this.renderSummary({data:data},cs);var existing=this.getSummaryNode(gid);if(existing){g.removeChild(existing);}
Ext.DomHelper.append(g,markup);return true;},doUpdate:function(ds,record){this.refreshSummaryById(record._groupId);},doRemove:function(ds,record,index,isUpdate){if(!isUpdate){this.refreshSummaryById(record._groupId);}},showSummaryMsg:function(groupValue,msg){var gid=this.view.getGroupId(groupValue);var node=this.getSummaryNode(gid);if(node){node.innerHTML='<div class="x-grid3-summary-msg">'+msg+'</div>';}}});Ext.grid.GroupSummary.Calculations={'sum':function(v,record,field,data,colConfig){return v+(record.data[field]||0);},'count':function(v,record,field,data,colConfig){return data[field+'count']?++data[field+'count']:(data[field+'count']=1);},'max':function(v,record,field,data,colConfig){var max=data[field+'max']===undefined?(data[field+'max']=v):data[field+'max'];return v>max?(data[field+'max']=v):max;},'min':function(v,record,field,data,colConfig){var min=data[field+'min']===undefined?(data[field+'min']=v):data[field+'min'];return v<min?(data[field+'min']=v):min;},'average':function(v,record,field,data,colConfig){var c=data[field+'count']?++data[field+'count']:(data[field+'count']=1);var t=(data[field+'total']=((data[field+'total']||0)+(record.data[field]||0)));return t===0?0:t/c;},'weighted_average':function(v,record,field,data,colConfig){var rowTotal=(record.data[field]||0)*(record.data[colConfig['summaryWeight']]||0);var summaryTotal=(data[field+'Total']=(data[field+'Total']||0)+rowTotal);var summaryWeight=data[colConfig['summaryWeight']]||0.0;return summaryWeight===0.0?0.0:summaryTotal/summaryWeight;},'percent':function(v,record,field,data,colConfig){var n=data[colConfig['summaryNumerator']]||0.0;var d=data[colConfig['summaryDenominator']]||0.0;return d===0.0?0.0:n/d;}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(rs,cs){var gcol=this.view.getGroupField();var gvalue=rs[0].data[gcol];var gdata=this.getSummaryData(gvalue);return gdata||Ext.grid.HybridSummary.superclass.calculate.call(this,rs,cs);},updateSummaryData:function(groupValue,data,skipRefresh){var json=this.grid.store.reader.jsonData;if(!json.summaryData){json.summaryData={};}
json.summaryData[groupValue]=data;if(!skipRefresh){this.refreshSummary(groupValue);}},getSummaryData:function(groupValue){var json=this.grid.store.reader.jsonData;if(json&&json.summaryData){return json.summaryData[groupValue];}
return null;}});
/* ========== ../mkt-ext-2.0/widgets/CanvasHeader.js ============ */

Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.CanvasHeader=Ext.extend(Ext.Panel,{titleValue:'Untitled',descValue:'Click to type a description',subtitle:'',editable:false,titleEditable:true,titleReadonlyReason:'',descEditable:true,titleId:'title',descId:'desc',actionUrl:'analytics/editReportMetaSubmit',serializeParms:{atxRenameReportId:5},enableUpdateCanvasConfig:true,cls:'mktCanvasHeader',editCls:'mktClickToEdit',noEditCls:'mktNoEdit',emptyTitleText:"Please enter a title",bodyStyle:'background: #fff; border-color: #fff; height: 65px',width:700,height:65,editWidth:700,editTitleWidth:500,editDescWidth:500,editHeight:105,savedCallback:Ext.emptyFn,initComponent:function(){this.descValue=this.descValue||"";Mkt.widgets.CanvasHeader.superclass.initComponent.call(this);this._initViewPanel();},_initViewPanel:function(){if(!this.viewTemplate){this.viewTitleId=(this.id?this.id:'')+'titleCanvasHeader';this.viewDescId=(this.id?this.id:'')+'descCanvasHeader';var title='<h1 class="text" id="'+this.viewTitleId+'">{titleValue}</h1>';var desc='<h3 class="text descValue" id="'+this.viewDescId+'">{descValue} {subtitle}</h3>';if(this.editable){if(this.titleEditable){title='<div class="{editCls}">'+title+'</div>';}
else{title='<div class="{noEditCls}" id="readonlyTitleCanvasHeader">'+title+'</div>';}
if(this.descEditable){desc='<div class="{editCls}">'+desc+'</div>';}
else{desc='<div class="{noEditCls}">'+desc+'</div>';}}
this.viewTemplate=new Ext.Template(title+desc);}
this.viewPanel=new Ext.Panel({cls:'mktTopPanel',height:this.height,width:this.width,html:this.viewTemplate.apply(this)});this.add(this.viewPanel);this.viewPanel.on('render',this._initEditEvents,this,{defer:500});},_initEditEvents:function(){if(this.editable){this.getEl().on('click',this._onClick,this);MktPage.initQuickTips();}},_onClick:function(e){var tgt=e.getTarget();if(Ext.fly(tgt).hasClass('text')){this.startEdit(e);}},startEdit:function(e){this.viewPanel.hide(true,.2);if(!this.formPanel){this._initFormPanel();}
this.formPanel.show(true,.2);var tgt=e.getTarget();if(Ext.fly(tgt).hasClass('descValue')){}
else{}},cancelEdit:function(){this.formPanel.hide(true,.2);this.viewPanel.show(true,.2);},getTitleField:function(){if(this.formPanel){return this.formPanel.items.items[0];}},getDescField:function(){if(this.formPanel){return this.formPanel.items.items[1];}},setTitle:function(title){if(this.titleValue==title){return;}
var titleField=this.getTitleField();if(titleField){titleField.setValue(Ext.util.Format.htmlDecode(title));}
var el=Ext.get(this.viewTitleId);if(el){el.update(title);}
this.titleValue=title;},setDesc:function(desc){if(this.descValue==desc){return;}
var descField=this.getDescField();if(descField){descField.setValue(Ext.util.Format.htmlDecode(desc));}
var el=Ext.get(this.viewDescId);if(el){el.update(desc);}
this.descValue=desc;},updateCanvasConfig:function(){if(!this.enableUpdateCanvasConfig){return;}
var canvas=MktCanvas.getActiveTab();if(canvas){canvas.config.title=this.newTitleValue;canvas.config.description=this.newDescValue;}},saveEdit:function(){this.serializeParms[this.titleId]=this.getTitleField().getValue();this.serializeParms[this.descId]=this.getDescField().getValue();this.newTitleValue=Ext.util.Format.htmlEncode(this.serializeParms[this.titleId]);this.newDescValue=Ext.util.Format.htmlEncode(this.serializeParms[this.descId]);this.updateCanvasConfig();MktSession.ajaxRequest(this.actionUrl,{serializeParms:this.serializeParms,containerId:this.id,onMySuccess:this.saveReponse.createDelegate(this)});},specialKey:function(formPanel,e){var key=e.getKey();var target=e.getTarget();switch(key){case 13:this.saveEdit();break;case 9:}},saveReponse:function(){if(MktPage.appVars.editCanvasHeaderError){this.formPanel.items.items[0].markInvalid(MktPage.appVars.editCanvasHeaderError);delete MktPage.appVars.editCanvasHeaderError;return;}
this.formPanel.hide(true,.2);this.titleValue=this.newTitleValue;this.descValue=this.newDescValue;this.viewPanel.body.update(this.viewTemplate.apply(this));this.viewPanel.show(true,.2);MktPage.updateFullTitle();if(isFunction(this.savedCallback)){this.savedCallback();}},_initFormPanel:function(){this.formPanel=new Ext.Panel({cls:'x-plain mktCanvasHeaderForm',bodyStyle:'background: transparent; border: transparent; margin-left: 8px;',width:this.editWidth,height:this.editHeight,autoHeight:true,buttonAlign:'right',layout:'form',defaultType:'textfield',items:[{name:this.titleId,value:Ext.util.Format.htmlDecode(this.titleValue),disabled:!this.titleEditable,blankText:this.emptyTitleText,allowBlank:false,cls:'inputH1',width:this.editTitleWidth,height:28,hideLabel:true,msgTarget:'side',tabIndex:1,listeners:{'specialkey':this.specialKey.createDelegate(this)}},{name:this.descId,value:Ext.util.Format.htmlDecode(this.descValue),disabled:!this.descEditable,cls:'inputH3',style:'margin-top: -1px',width:this.editDescWidth,height:22,hideLabel:true,tabIndex:2,listeners:{'specialkey':this.specialKey.createDelegate(this)}}],buttons:[{text:'Save',iconCls:'mkiOk',handler:this.saveEdit.createDelegate(this),tabIndex:4},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelEdit.createDelegate(this),tabIndex:5}]});this.add(this.formPanel);this.formPanel.on('render',function(){if(!this.titleEditable&&this.titleReadonlyReason.length>0){setTimeout(function(){new Ext.ToolTip({target:this.getTitleField().getEl().dom.parentNode.id,html:this.titleReadonlyReason});}.createDelegate(this),1000);}}.createDelegate(this));this.doLayout();}});
/* ========== ../mkt-ext-2.0/widgets/DateTime.js ============ */

Ext.ns('Ext.ux.form');Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:'input',type:'hidden'},timeWidth:100,dtSeparator:' ',hiddenFormat:'Y-m-d H:i:s',otherToNow:true,timePosition:'right',dateFormat:'m/d/y',timeFormat:'g:i A',initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var dateConfig=Ext.apply({},{id:this.id+'-date',format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.dateWidth||this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(dateConfig);this.df.ownerCt=this;delete(this.dateFormat);var timeConfig=Ext.apply({},{id:this.id+'-time',format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(timeConfig);this.tf.ownerCt=this;delete(this.timeFormat);this.relayEvents(this.df,['focus','specialkey','invalid','valid']);this.relayEvents(this.tf,['focus','specialkey','invalid','valid']);},onRender:function(ct,position){if(this.isRendered){return;}
Ext.ux.form.DateTime.superclass.onRender.call(this,ct,position);var t;if('below'===this.timePosition||'bellow'===this.timePosition){t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},true);}
else{t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:4px',cls:'ux-datetime-date'},{tag:'td',cls:'ux-datetime-time'}]}]},true);}
this.tableEl=t;this.wrap=t.wrap();this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if(Ext.isIE&&Ext.isStrict){t.select('input').applyStyles({top:0});}
this.on('specialkey',this.onSpecialKey,this);this.df.el.swallowEvent(['keydown','keypress']);this.tf.el.swallowEvent(['keydown','keypress']);if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,true);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon;}
this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,'tl-tr',[2,0]);},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0);},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid();},markInvalid:function(msg){this.df.markInvalid(msg);this.tf.markInvalid(msg);},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy();}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable();}
this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this;},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable();}
this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this;},focus:function(){this.df.focus();},getPositionEl:function(){return this.wrap;},getResizeEl:function(){return this.wrap;},getValue:function(){return this.dateValue?new Date(this.dateValue):'';},isValid:function(){return this.df.isValid()&&this.tf.isValid();},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible();},onBlur:function(f){if(this.wrapClick){f.focus();this.wrapClick=false;}
if(f===this.df){this.updateDate();}
else{this.updateTime();}
this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue);}
this.hasFocus=false;this.fireEvent('blur',this);}}).defer(100,this);},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this);}},onMouseDown:function(e){if(!this.disabled){this.wrapClick='td'===e.target.nodeName.toLowerCase();}},onSpecialKey:function(t,e){var key=e.getKey();if(key===e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();this.df.triggerBlur();this.tf.focus();}
if(t===this.tf&&e.shiftKey){e.stopEvent();this.tf.triggerBlur();this.df.focus();}}
if(key===e.ENTER){this.updateValue();}},setDate:function(date){this.df.setValue(date);},setTime:function(date){this.tf.setValue(date);},setSize:function(w,h){if(!w){return;}
if('below'===this.timePosition){this.df.setSize(w,h);this.tf.setSize(w,h);if(Ext.isIE){this.df.el.up('td').setWidth(w);this.tf.el.up('td').setWidth(w);}}
else{var dfWidth=w-this.timeWidth-4;if(!isNaN(dfWidth)){this.df.setSize(dfWidth,h);this.tf.setSize(this.timeWidth,h);if(Ext.isIE){this.df.el.up('td').setWidth(dfWidth);this.tf.el.up('td').setWidth(this.timeWidth);}}}},setValue:function(val){if(!val&&true===this.emptyToNow){this.setValue(new Date());return;}
else if(!val){this.setDate('');this.setTime('');this.updateValue();return;}
if('number'===typeof val){val=new Date(val);}
val=val?val:new Date(1970,0,1,0,0,0);var da,time;if(val instanceof Date){this.setDate(val);this.setTime(val);this.dateValue=new Date(val);}
else{da=val.split(this.dtSeparator);this.setDate(da[0]);if(da[1]){if(da[2]){da[1]+=da[2];}
this.setTime(da[1]);}}
this.updateValue();},setVisible:function(visible){if(visible){this.df.show();this.tf.show();}else{this.df.hide();this.tf.hide();}
return this;},show:function(){return this.setVisible(true);},hide:function(){return this.setVisible(false);},updateDate:function(){var d=this.df.getValue();if(d){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue);}}
this.dateValue.setMonth(0);this.dateValue.setFullYear(d.getFullYear());this.dateValue.setMonth(d.getMonth(),d.getDate());}
else{this.dateValue='';this.setTime('');}},updateTime:function(){var t=this.tf.getValue();if(t&&!(t instanceof Date)){t=Date.parseDate(t,this.tf.format);}
if(t&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue);}
if(this.dateValue instanceof Date){if(t){this.dateValue.setHours(t.getHours());this.dateValue.setMinutes(t.getMinutes());this.dateValue.setSeconds(t.getSeconds());}
else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0);}}},updateHidden:function(){if(this.isRendered){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):'';this.el.dom.value=value;}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return;},validate:function(){return this.df.validate()&&this.tf.validate();},renderer:function(field){var format=field.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;format+=' '+(field.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var renderer=function(val){var retval=Ext.util.Format.date(val,format);return retval;};return renderer;}});Ext.reg('xdatetime',Ext.ux.form.DateTime);
/* ========== ../mkt-ext-2.0/widgets/SmartPaletteQueue.js ============ */

Ext.namespace("Mkt","Mkt.widgets");Mkt.widgets.SmartPaletteQueue=Ext.extend(Object,{smartPaletteQueue:[],init:function(){this.populateQueue('smartcampaigns/smartpalette','flow','ac_accessMA');this.populateQueue('smartcampaigns/smartpalette','smartlist','ac_accessMA');this.populateQueue('leadDatabase/smartpalette','smartlist','ac_accessML');},isPendingRequest:function(url,actionType){for(el in this.smartPaletteQueue){if(el.url==url&&el.actionType==actionType){return true;}}
return false;},populateQueue:function(url,actionType,accessNeeded){if(!this.isPendingRequest(url,actionType)){this.smartPaletteQueue.push({url:url,actionType:actionType,accessNeeded:accessNeeded});}},removeItemFromQueue:function(url,actionType){var length=this.smartPaletteQueue.length;for(var i=0;i<length;++i){if(this.smartPaletteQueue[i].url==url&&this.smartPaletteQueue[i].actionType===actionType){this.smartPaletteQueue.splice(i,1);break;}}},processSmartPaletteQueue:function(){var length=this.smartPaletteQueue.length;for(var i=length-1;i>=0;--i){el=this.smartPaletteQueue[i];var params={'reqURL':el.url,'type':el.actionType,'jsonType':'mkto'};var outerScope=this;if(!MktSession.hasCredential(el.accessNeeded)){continue;}
MktSession.ajaxRequest(el.url,{serializeParms:params,onMySuccess:function(results,request){var reqURL=request.params.reqURL;var reqType=request.params.type;var dataURL="/"+reqURL+'?type='+reqType;if(!isDefined(Mkt.widgets._CachedTreeData[dataURL])){Mkt.widgets._CachedTreeData[dataURL]=results.JSONResults.appVars.smartPalette;}
outerScope.removeItemFromQueue(reqURL,reqType);}});}}});
/* ========== ../mkt-ext-2.0/util/util.js ============ */

function toggle(id){el=document.getElementById(id);el.style.display=el.style.display=='none'?'block':'none';}
String.prototype.escapeHTML=function(){var div=document.createElement('div');var text=document.createTextNode(this);div.appendChild(text);return div.innerHTML;};String.prototype.ellipse=function(maxLength){if(this.length>maxLength){return this.substr(0,maxLength-3)+'...';}
return this;};MktFormat={formatCurrency:function(v){if((typeof v=='number'&&isFinite(v)&&v!=0)||(typeof v=='string'&&v.length>0)){v=(Math.round((v-0)*100))/100;v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);v=String(v);var ps=v.split('.');var whole=ps[0];var sub=ps[1]?'.'+ps[1]:'.00';var r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,'$1'+','+'$2');}
v=whole+sub;if(v.charAt(0)=='-'){return'-'+v.substr(1);}}
return v;},formatFloat:function(v,addTrailingZeros){if((typeof v=='number'&&isFinite(v)&&v!=0)||(typeof v=='string'&&v.length>0)){v=(Math.round((v-0)*100))/100;if(addTrailingZeros){v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);}
v=String(v);var ps=v.split('.');var whole=ps[0];var sub=ps[1]?'.'+ps[1]:(addTrailingZeros?'.00':'');var r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,'$1'+','+'$2');}
v=whole+sub;if(v.charAt(0)=='-'){return'-'+v.substr(1);}}
return v;},formatInt:function(v){return MktFormat.formatFloat(v,false);},empty:function(v){if(!v||v=='')return"<i>Empty</i>";return v;},formatDateValue:function(v,fmt){if(v!=null&&v.format){return v.format(fmt);}
return MktFormat.empty(v);},formatDate:function(v){return MktFormat.formatDateValue(v,'M j, Y');},formatDatetime:function(v){return MktFormat.formatDateValue(v,'M j, Y  h:i A');},formatDatetimeSeconds:function(v){return MktFormat.formatDateValue(v,'M j, Y  h:i:s A');},formatDateWeek:function(v){return'Week of '+MktFormat.formatDateValue(v,'M j, Y');},formatDateMonth:function(v){return MktFormat.formatDateValue(v,'M Y');},formatDateQuarter:function(v){if(!v.format)return MktFormat.empty(v);return'Q'+Math.round(v.getMonth()/3+1)+' '+v.getFullYear();},formatDateYear:function(v){return MktFormat.formatDateValue(v,'Y');}};isArray=function(v){return v&&typeof(v)=='object'&&v.length>-1;};isSingleArray=function(v){return v&&typeof(v)=='object'&&v.length==1;};isMultiArray=function(v){return v&&typeof(v)=='object'&&v.length>1;};
/* ========== ../mkt-ext-2.0/util/vtypes.js ============ */

var vt=Ext.form.VTypes;var tokenRegex=/^\{\{.+\..+\}\}$/;var dateRegex=/^[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{4}$/;var NULL_VALUE='NULL';var integerRegex=/^[0-9]+$/;var floatRegex=/^[-+]?[0-9]+(\.[0-9]+)?$/;vt["mkt_url"]=function(v,field){if(v.indexOf('http')!==0){v='http://'+v;field.setValue(v);}
return v==NULL_VALUE||vt["url"](v,field);};vt["mkt_url_tok"]=function(v,field){if(v.indexOf('{')==0){return true;}
return v==NULL_VALUE||vt["mkt_url"](v,field);};vt["mkt_email_tok"]=function(v,field){return v==NULL_VALUE||vt['email'](v)||tokenRegex.test(v);};vt["mkt_email_tokText"]=vt["emailText"];vt["mkt_integer"]=function(v){return v==NULL_VALUE||integerRegex.test(v);};vt["mkt_integerText"]='Not a valid integer';vt["mkt_integer_tok"]=function(v,field){return vt['mkt_integer'](v)||tokenRegex.test(v);};vt["mkt_integer_tokText"]=vt["mkt_integerText"];vt["mkt_float"]=function(v){return v==NULL_VALUE||floatRegex.test(v);};vt["mkt_floatText"]='Not a valid number';vt["mkt_float_tok"]=function(v,field){return vt['mkt_float'](v)||tokenRegex.test(v);};vt["mkt_float_tokText"]=vt["mkt_floatText"];vt["mkt_date"]=function(v){return v==NULL_VALUE||dateRegex.test(v);};vt["mkt_dateText"]='Dates must be in the format mm/dd/yyyy';vt["mkt_date_tok"]=function(v,field){return v==NULL_VALUE||vt['mkt_date'](v)||tokenRegex.test(v);};vt["mkt_date_tokText"]=vt["mkt_dateText"];vt["bool"]=function(v){return v==NULL_VALUE||v=='true'||v=='false';};vt["phone"]=function(v){return v==NULL_VALUE||vt["phoneVal"].test(v);};vt["phoneVal"]=/^(d{3}[-]?){1,2}(d{4})$/;vt["phoneMask"]=/[d-]/;vt["phoneText"]='Not a valid phone number.  Must be in the format 123-4567 or 123-456-7890 (dashes optional)';vt["hostname"]=function(v){if(!vt["hostnameVal1"].test(v)){vt["hostnameText"]="Must begin with a letter and not exceed 255 characters";return false;}
vt["hostnameText"]="L[.L][.L][.L][...] where L begins with a letter, ends with a letter or number, and does not exceed 63 characters";return vt["hostnameVal2"].test(v);};vt["hostnameVal1"]=/^[a-zA-Z][-.a-zA-Z0-9]{0,254}$/;vt["hostnameVal2"]=/^[a-zA-Z]([-a-zA-Z0-9]{0,61}[a-zA-Z0-9]){0,1}([.][a-zA-Z]([-a-zA-Z0-9]{0,61}[a-zA-Z0-9]){0,1}){0,}$/;vt["hostnameText"]="Invalid Hostname";vt["ip"]=function(v){return vt["ipVal"].test(v);};vt["ipVal"]=/^([1-9][0-9]{0,1}|1[013-9][0-9]|12[0-689]|2[01][0-9]|22[0-3])([.]([1-9]{0,1}[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])){2}[.]([1-9][0-9]{0,1}|1[0-9]{2}|2[0-4][0-9]|25[0-4])$/;vt["ipText"]="1.0.0.1 - 223.255.255.254 excluding 127.x.x.x";vt["ipMask"]=/[.0-9]/;vt['ipWithRange']=function(v){return vt['ipWithRangeVal'].test(v);};vt['ipWithRangeVal']=/((^|-)([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])([.]([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]|[*])){3}){1,2}$/;vt['ipWithRangeText']='Invalid IP address';vt['ipWithRangeMask']=/[-0-9.*]/;Ext.apply(Ext.form.VTypes,{numericrange:function(val,field){if(field.startRangeField){field.startRangeField.maxValue=val;}
else if(field.endRangeField){field.endRangeField.minValue=val;}
return true;}});Ext.apply(Ext.form.VTypes,{daterange:function(val,field){var date=field.parseDate(val);var dispUpd=function(picker){var ad=picker.activeDate;picker.activeDate=null;picker.update(ad);};if(field.startDateField){var sd=field.startDateField;sd.maxValue=date;if(sd.menu&&sd.menu.picker){sd.menu.picker.maxDate=date;dispUpd(sd.menu.picker);}}else if(field.endDateField){var ed=field.endDateField;ed.minValue=date;if(ed.menu&&ed.menu.picker){ed.menu.picker.minDate=date;dispUpd(ed.menu.picker);}}
return true;}});Ext.apply(Ext.form.VTypes,{datetimerange:function(val,field){try{var parent=field.parent;if(!parent){return true;}
var startDateField=parent.startTimePicker.df;var startTimeField=parent.startTimePicker.tf;var endDateField=parent.endTimePicker.df;var endTimeField=parent.endTimePicker.tf;var startDate=startDateField.getValue();var endDate=endDateField.getValue();var datesEqual=false;if(startDate!=""&&endDate!=""){datesEqual=(startDate.toDateString()==endDate.toDateString());}
var date=field.parseDate(val);if(field.isEndDateField){startDateField.setMaxValue(date);}
if(field.isStartDateField){endDateField.setMinValue(date);}
var endTime=parent.endTimePicker.getValue();var startTime=parent.startTimePicker.getValue();if(datesEqual){startTimeField.setMaxValue(endTime);endTimeField.setMinValue(startTime);}else{var dateTime=parent.getValue();if(dateTime!=""){dateTime.setHours(0,0,0,0);endTimeField.setMinValue(dateTime);dateTime.setHours(23,59,0,0);startTimeField.setMaxValue(dateTime);}}
return true;}catch(e){return true;}}});
/* ========== ../mkt-ext-2.0/widgets/ModalForm.js ============ */

Ext.ns("Mkt.widgets","Mkt.widgets.Forms");Mkt.widgets.Forms={okButtonText:'OK',okButtonIconCls:'mkiOk',createButtonText:'Create',createButtonIconCls:'mkiAdd2',cancelButtonText:'Cancel',cancelButtonIconCls:'mkiCancel',defaultWidth:500,defaultHeight:300};MktModalForm=Mkt.widgets.Forms.ModalForm=function(config){var MktForms=Mkt.widgets.Forms;this.processContentConfig(config);this.extension=config.extension||null;var dialogConfig={id:config.id||Ext.id(),cls:'mktModalForm',iconCls:config.iconCls,width:config.width||this.defaultWidth,height:config.height||this.defaultHeight,autoCreate:true,minWidth:400,minHeight:300,syncHeightBeforeShow:true,shadow:true,modal:true,autoScroll:true,resizable:true,closable:false,fixedcenter:true};if(isDefined(config.extraRegions)){var regions=[{id:'mktDlgCenter',region:'center',bodyStyle:'background-color: transparent'}];for(var ix=0;ix<config.extraRegions.length;ix++){regions.push(config.extraRegions[ix]);}
dialogConfig.layout='border';dialogConfig.items=regions;}
if(isDefined(config.dialogOpts)){Object.extend(dialogConfig,config.dialogOpts);}
if(isDefined(config.cls))dialogConfig.cls+=' '+config.cls;if(isDefined(config.style))dialogConfig.style=config.style;var dlg=new Ext.Window(dialogConfig);dlg.setTitle(config.title);this.dlg=dlg;this.buttons=Array();if(!config.okButtonIconcls&&config.okButtonTitle===MktForms.createButtonText){config.okButtonIconCls=MktForms.createButtonIconCls;}
var okCfg={text:config.okButtonTitle||'OK',iconCls:config.okButtonIconCls||MktForms.okButtonIconCls};this.okButtonCallback=function(){this.okButtonClicked=true;this.doCallback();};this.buttons.push(dlg.addButton(okCfg,this.okButtonCallback,this));if(isUndefined(config.noCancelButton)){var cancelCfg={text:config.cancelButtonTitle||'Cancel',iconCls:config.cancelButtonIconCls||MktForms.cancelButtonIconCls};this.buttons.push(dlg.addButton(cancelCfg,this.cancel,this));}
if(isDefined(config.extraButtons)){if(isArray(config.extraButtons)){for(var ib=0;ib<config.extraButtons.length;ib++){var btn=config.extraButtons[ib];this.buttons.push(dlg.addButton({text:btn.buttonTitle,iconCls:button.buttonIconCls},btn.callback,this,{buffer:300}));}}
else{var btn=config.extraButtons;this.buttons.push(dlg.addButton({text:btn.buttonTitle,iconCls:btn.buttonIconCls},btn.callback,this,{buffer:300}));}}
dlg.render(Ext.getBody());dlg.on('show',this.load,this,true);dlg.getEl().addKeyListener(10,this.keyEnter,this);dlg.getEl().addKeyListener(13,this.keyEnter,this);this.textAreaFocused=false;var innerParent=dlg.findById('mktDlgCenter');if(innerParent!=null){innerParent=innerParent.body;}
else{innerParent=dlg.body;}
this.innerEl=innerParent.createChild({tag:'div',id:'mktModalInner'});this.checkRequired=isDefined(config.checkRequired)?config.checkRequired:true;this.requiredChecker=isDefined(config.requiredChecker)?config.requiredChecker:this.rfChecker;this.clickRequired=isDefined(config.clickRequired)?config.clickRequired:false;this.loaded=false;this.events={'okclick':true,'cancelclick':true,'load':true};MktSession.activeModalForm=this;};Ext.extend(MktModalForm,Ext.util.Observable);MktModalForm.prototype.processContentConfig=function(config){this.url=null;this.renderer=null;this.staticForm=null;if(isDefined(config.url)){this.url=config.url;this.ajopts={containerId:'mktModalInner',targetActivePanel:false,onMySuccess:this.loadDone.createDelegate(this,null,true)};Object.extend(this.ajopts,config.ajopts||{});}else if(isDefined(config.renderer)){this.renderer=config.renderer;this.rendererscope=config.rendererscope;if(isDefined(config.rendererargs)){this.rendererargs=config.rendererargs;}else{this.rendererargs=[];}}else if(isDefined(config.staticForm)){this.staticForm=config.staticForm;}};MktModalForm.prototype.show=function(animEl,callback){if(animEl){this.dlg.show(animEl);}else{this.dlg.show();}
this.callback=callback;};MktModalForm.prototype.load=function(){if(!this.loaded){if(this.url!=null){Ext.DomHelper.insertHtml('afterBegin',this.innerEl.dom,'<div class="mktModalLoading"></div>');this.ajopts.onMySuccess=this.loadDone.createDelegate(this,null,true);MktSession.ajaxRequest(this.url,this.ajopts);}else if(this.renderer!=null){var rargs=this.rendererargs;rargs.unshift(this.innerEl.dom);this.renderer.apply(this.rendererscope,rargs);MktUtil.focusForm.defer(500,this,['mktModalInner']);this.newContentLoaded();this.fireEvent('load',this);}else if(this.staticForm!=null){var protoform=$(this.staticForm).cloneNode(true);MktUtil.removeProtoIdPrefix(protoform,'p.');var newform=this.innerEl.dom.appendChild(protoform);getEl(newform).setDisplayed(true);MktUtil.focusForm(newform);this.newContentLoaded();this.fireEvent('load',this);}
this.bindCssHandlers();}};MktModalForm.prototype.bindCssHandlers=function(){var fmEls=Ext.query("form",this.innerEl.dom);if(fmEls.length==0)return true;function mktHandleTrim(el,ix,a){getEl(el).on('blur',function(){el.value=el.value.trim();});}
Ext.query('input[@type=text].mktHandleTrim',fmEls[0]).forEach(mktHandleTrim,this);function mktHandleEmail(el,ix,a){mktHandleTrim(el);}
Ext.query('input[@type=text].mktHandleEmail',fmEls[0]).forEach(mktHandleEmail,this);};MktModalForm.prototype.newContent=function(config,callback){this.processContentConfig(config);if(isDefined(config.title)){this.dlg.setTitle(config.title);}
this.loaded=false;this.callback=callback;this.innerEl.dom.innerHTML='';this.load();};MktModalForm.prototype.disableButton=function(btnIdx){this.buttons[btnIdx].disable();};MktModalForm.prototype.enableButton=function(btnIdx){this.buttons[btnIdx].enable();};MktModalForm.prototype.setButtonText=function(btnIdx,text){this.buttons[btnIdx].setText(text);};MktModalForm.prototype.hideButton=function(btnIdx){this.buttons[btnIdx].hide();};MktModalForm.prototype.showButton=function(btnIdx){this.buttons[btnIdx].show();};MktModalForm.prototype.addClientButton=function(text,callback){this.buttons.push(this.dlg.addButton(text,callback,this));return this.buttons.length-1;};MktModalForm.prototype.showProgress=function(callOptions){var options={clearContents:false,title:"Loading..."};Object.extend(options,callOptions||{});var html='<div class="mktModalLoadingIcon">Loading...</div>';var target=$('mktModalInner');if(options.clearContents){Ext.get(target).removeAllListeners();target.innerHTML='';}
Ext.DomHelper.insertHtml('afterBegin',$('mktModalInner'),html);};MktModalForm.prototype.loadDone=function(jsonObject){this.newContentLoaded();this.fireEvent('load',this,jsonObject);MktUtil.focusForm(this.innerEl.dom);if(Ext.isIE){MktUtil.focusForm.defer(1000,this,['mktModalInner']);}
this.loaded=true;};MktModalForm.prototype.close=function(){if(this.dlg&&this.dlg.animateTarget){this.dlg.animateTarget=null;}
this.dlg.hide();this.dlg.destroy(true);};MktModalForm.prototype.cancel=function(){Ext.MessageBox.hide();this.close();this.fireEvent('cancelclick',this);};MktModalForm.prototype.keyEsc=function(dlg,k,e){this.cancel();};MktModalForm.prototype.keyEnter=function(k,e){if(!this.textAreaFocused){e.stopEvent();this.doCallback();}};MktModalForm.prototype.newContentLoaded=function(){var tas=Ext.query('textarea',this.innerEl.dom);for(var ix=0;ix<tas.length;ix++){getEl(tas[ix]).on('focus',function(){this.textAreaFocused=true;},this,true);getEl(tas[ix]).on('blur',function(){this.textAreaFocused=false;},this,true);}};MktModalForm.prototype.doCallback=function(){MktModalForm.clearMessage();window.focus();if(this.clickRequired&&!this.okButtonClicked){return;}
this.okButtonClicked=false;if(this.checkRequired){if(!this.requiredChecker.call(this))return;}
this.fireEvent('okclick',this);var callback=this.callback;if(callback){var doHide=callback(this);if(doHide){this.close();}}};MktModalForm.prototype.rfChecker=function(){var fmEls=Ext.query('form',this.innerEl.dom);if(fmEls.length==0)return true;this.validateErrors=0;var rfs=Ext.query('tr.mktRequired, div.mktRequired',fmEls[0]);for(var ix=0;ix<rfs.length;ix++){this.valRow=rfs[ix];Ext.query('input[@type=text]',rfs[ix]).forEach(function(el,ix,a){this.rfCheckValError(el,ix,a);this.rfCheckIntValError(el,ix,a);},this);Ext.query('input[@type=password]',rfs[ix]).forEach(this.rfCheckValError,this);Ext.query('input[@type=file]',rfs[ix]).forEach(this.rfCheckValError,this);Ext.query('select',rfs[ix]).forEach(this.rfCheckValError,this);Ext.query('textarea',rfs[ix]).forEach(this.rfCheckValError,this);}
if(this.validateErrors>0){MktModalForm.clearMessage();MktModalForm.setMessageError('Please fill in a correct value on all required fields');return false;}else{return true;}};MktModalForm.prototype.rfCheckValError=function(el,ix,a){if(el.style.display=='none')return;if(el.value.length==0){this.validateErrors++;Ext.get(this.valRow).addClass('mktFieldError');Ext.get(el).on('change',this.rfInTxChange,this,true);Ext.get(el).on('keyup',this.rfInTxChange,this,true);}};MktModalForm.prototype.rfCheckIntValError=function(el,ix,a){var extEl=Ext.get(el);if(extEl.hasClass("mktIntValOnly")){var value=el.value;if(value.length!=0&&isNumber(value*1)){extEl.removeClass('mktFieldError');}else{this.validateErrors++;extEl.addClass('mktFieldError');extEl.addListener('change',this.rfCheckIntValChangeError,this);extEl.addListener('keyup',this.rfCheckIntValChangeError,this);}}};MktModalForm.prototype.rfCheckIntValChangeError=function(e,el){el=Ext.get(el);el.removeClass('mktFieldError');el.removeListener('change',this.rfCheckIntValChangeError);el.removeListener('keyup',this.rfCheckIntValChangeError);this.validateErrors--;if(this.validateErrors==0){MktModalForm.clearMessage();}};MktModalForm.prototype.rfInTxChange=function(e){var eTarget=e.getTarget();var eRow=e.getTarget('tr.mktRequired');Ext.get(eRow).removeClass('mktFieldError');Ext.get(eTarget).un('change',this.rfInTxChange);Ext.get(eTarget).un('keyup',this.rfInTxChange);this.validateErrors--;if(this.validateErrors==0){MktModalForm.clearMessage();}};MktModalForm.clearMessage=function(spaceFill){var ife=Ext.query('.mktModalInFormMessage',$('mktModalInner'));if(ife.length>0){var marea=ife[0];if(!spaceFill){marea.style.display='none';}}else{var marea=$('mdgMessage');}
if(marea){if(spaceFill){marea.innerHTML="&nbsp;";}else{marea.innerHTML="";}}};MktModalForm.setMessage=function(message){if(MktSession.activeModalForm&&MktSession.activeModalForm.el){MktSession.setExtWindowFormMsg(message);}else{var ife=Ext.query('.mktModalInFormMessage',$('mktModalInner'));if(ife.length>0){var marea=ife[0];if(marea.style.display=='none'){marea.style.display='block';}}else{var marea=$('mdgMessage');}
var messageHTML="<div class='mktModalMessage'>"+message+"</div>";if(marea){Ext.DomHelper.insertHtml('afterBegin',marea,messageHTML);}}};MktModalForm.setMessageError=function(message){if(MktSession.activeModalForm&&MktSession.activeModalForm.el){MktSession.setExtWindowFormError(message);}else{var ife=Ext.query('.mktModalInFormMessage',$('mktModalInner'));if(ife.length>0){var marea=ife[0];if(marea.style.display=='none'){marea.style.display='block';}}else{var marea=$('mdgMessage');}
var messageHTML="<div class='mktModalErrorMessage'>"+message+"</div>";if(marea){Ext.DomHelper.insertHtml('afterBegin',marea,messageHTML);}}};Mkt.widgets.ModalForm=Ext.extend(Ext.Window,{version:3,v3:true,useStandardButtons:true,okText:'Ok',okCls:'mkiOk',okCallback:Ext.emptyFn,cancelText:'Cancel',cancelCls:'mkiCancel',submitUrl:'',beforeSubmitCallback:Ext.emptyFn,submitSuccessCallback:Ext.emptyFn,submitFailedCallback:Ext.emtpyFn,submitCallbackScope:undefined,submitCallbackArgs:[],baseParams:{},serializedParms:{},focusedField:undefined,focusFirstInput:true,showProgressModal:false,progressMsg:'Applying update...',initComponent:function(){this.keys=this.keys||[];this.keys.push({key:Ext.EventObject.ENTER,fn:this.okButtonHandler.createDelegate(this),scope:this});this.items=this.items||[];this.messagePanel=new Ext.Panel({tpl:'<h2><div class="mktModalInFormMessage" style="display: block;"><div class="mktModalErrorMessage">{message}</div></div></h2>',baseCls:"mkt-modal-message-body",hidden:true,height:30,anchor:"99% 20%"});this.items.unshift(this.messagePanel);this.buttons=this.buttons||[];if(this.useStandardButtons){this.buttons.push({text:this.okText,iconCls:this.okCls,handler:this.okButtonHandler.createDelegate(this)});this.buttons.push({text:this.cancelText,iconCls:this.cancelCls,handler:this.cancelButtonHandler.createDelegate(this)});}
Mkt.widgets.ModalForm.superclass.initComponent.call(this);this.on('render',this.selectFirst.createDelegate(this));MktSession.activeModalForm=this;},okButtonHandler:function(){if(this.submitInProgress){return;}
if(this.beforeSubmitCallback()===false){return;};if(this.okCallback&&isFunction(this.okCallback)){this.okCallback();}
if(!this.submitUrl){return;}
if(this.showProgressModal){this.hide();this.progressModal=Ext.MessageBox.show({title:'Please wait...',msg:this.progressMsg,progress:true,wait:true,width:200,closable:false});}
else{MktSession.clockCursor();}
this.submitInProgress=true;if(this.serializeJSON){this.serializeParms=this.serializeParms||{};this.serializeParms._json=Ext.encode(this.serializeJSON);}
var parms=Ext.apply({},this.serializeParms,this.baseParams);MktSession.ajaxRequest(this.submitUrl,{serializeParms:parms,onMySuccess:this.submitSuccessHandler.createDelegate(this),onMyFailure:this.submitFailedHandler.createDelegate(this)});},close:function(){if(this.cancelCallback&&isFunction(this.cancelCallback)){this.cancelCallback();}
if(this.showProgressModal&&this.progressModal){this.progressModal.hide();}
return Mkt.widgets.ModalForm.superclass.close.call(this);},cancelButtonHandler:function(){this.close();},submitSuccessHandler:function(){MktSession.unclockCursor();this.submitInProgress=false;if(this.submitSuccessCallback&&isFunction(this.submitSuccessCallback)){var scope=this.submitCallbackScope||this;var args=this.submitCallbackArgs||[];this.submitSuccessCallback.apply(scope,args);}},submitFailedHandler:function(){this.submitInProgress=false;if(this.showProgressModal&&this.progressModal){this.progressModal.hide();this.animateTarget=undefined;this.show();}
else{MktSession.unclockCursor();}
if(this.submitFailedCallback&&isFunction(this.submitFailedCallback)){var scope=this.submitCallbackScope||this;var args=this.submitCallbackArgs||[];this.submitFailedCallback.apply(scope,args);}},selectFirst:function(){setTimeout(function(){if(this.focusedField){this.focusedField.focus();}
else if(this.focusFirstInput){var inputItems=this.getInputItems();if(inputItems.length>0){inputItems[0].focus();}}}.createDelegate(this),1000);},getInputItems:function(){var inputItems=[];this.items.each(function(){if(!this.getItemCt){return true;}
var inputEls=Ext.query('input',this.getItemCt().dom);if(inputEls.length>0){inputItems.push(this);}});return inputItems;},maskModal:function(maskMsg,maskCls,subtle){var bodyWrap=this.bwrap;if(bodyWrap){maskMsg=maskMsg||this.maskMsg||'Loading...';this.currentMaskCls=maskCls=maskCls||this.maskCls||'mktModalLoading';Ext.get(bodyWrap).mask(maskMsg,maskCls);if(subtle){var el=this.getEl();if(el){el.addClass('mktModalLoadingSubtle');}}}},unmaskModal:function(){var bodyWrap=this.bwrap;if(bodyWrap){var el=this.getEl();if(el){el.removeClass('mktModalLoadingSubtle');}
Ext.get(bodyWrap).unmask();}},showMessageError:function(message){if(!this.isVisible()){this.animateTarget=undefined;this.show();}
if(this.showProgressModal){this.progressModal.hide();}
this.messagePanel.update({message:message});this.messagePanel.show();this.messagePanel.addClass('visibleMessage');},showMessage:function(message)
{if(this._messagePanel==null){var tplString='<h2>'+'  <div class="mktModalInFormMessage" style="display: block;">'+'    <div class="mktModalMessage">{message}</div>'+'  </div>'+'</h2>';this._messagePanel=new Ext.Panel({tpl:tplString,baseCls:"mkt-modal-message-body",hidden:true,height:30,anchor:"99% 20%"});this.insert((this.messagePanel!=null?this.items.indexOf(this.messagePanel)+1:0),this._messagePanel);this.doLayout();}
this._messagePanel.update({message:message});this._messagePanel.show();this._messagePanel.addClass('visibleMessage');},showErrorMessage:function(message){this.showMessageError(message);},setErrorMessage:function(message){this.showErrorMessage(message);},setMessage:function(){this.showErrorMessage(message);},hideMessage:function(){this.messagePanel.hide();this.messagePanel.removeClass('visibleMessage');}});
/* ========== ../mkt-ext-2.0/widgets/ToolbarButton.js ============ */

Mkt.widgets.ToolbarButton=Ext.extend(Ext.Button,{ctype:"Mkt.widgets.ToolbarButton",initComponent:function(){Mkt.widgets.ToolbarButton.superclass.initComponent.call(this);this.addEvents("beforemenushow");this.on('beforedestroy',function(){if(this.menu&&this.menu.shared){delete this.menu;}});if(this.menuPreShowCb){this.on('beforemenushow',this.menuPreShowCb.createDelegate(this,this.menu,true));}},onMenuShow:function(e){if(this.showingMenu){Mkt.widgets.ToolbarButton.superclass.onMenuShow.call(this,e);}},showMenu:function(){this.showingMenu=true;if(this.menu.xtra){delete this.menu.xtra;}
this.menu.triggeredFrom='button';this.fireEvent('beforemenushow',this.menu);Mkt.widgets.ToolbarButton.superclass.showMenu.call(this);this.showingMenu=false;}});Ext.reg('mkttbbutton',Mkt.widgets.ToolbarButton);
/* ========== ../mkt-ext-2.0/util/DlManager.js ============ */

Ext.ns("Mkt","Mkt.app","Mkt.util");Mkt.app.Manager=Ext.extend(Ext.util.Observable,{registerComp:function(type,func){if(!type){return;}
this.addEvents(Ext.util.Format.lowercase(type));this.addListener(type,func);},_get:function(type,attr){var ret={};if(typeof type=="object"&&type.type&&attr==undefined){attr=type;type=type.type;}
this.fireEvent(type,attr,ret);return ret.comp;},getComp:function(type,attr){throw"Not Implemented";}});Mkt.util.DeepLinkMgr=function(){var historyDelimiter='/';var satelliteToken='!';var dlCodeMap={};return Ext.apply(new Mkt.app.Manager(),{initDlCodeMap:function(){var adminTreeMeta=MktPage.constants.adminTreeMeta;dlCodeMap={MM:{type:"Home"},WN:{type:"Home",panelIndex:1},SWN:{type:"Home",panelIndex:1},MA:{type:"MA"},MF:{type:"MA",subType:"marketingfolder"},PG:{type:"MA",subType:"marketingprogram"},SC:{type:"MA",subType:"smartcampaign"},PRG:{type:"MA",subType:"progressions"},CM:{type:"MA",compSubtype:"campaignmonitor"},ME:{type:"MA",subType:"marketingevent"},DS:{type:"Landing"},LP:{type:"Landing",subType:"page"},LT:{type:"Landing",subType:"template"},TG:{type:"Landing",subType:"test"},FO:{type:"Landing",subType:"form"},EM:{type:"Landing",subType:"email"},ET:{type:"Landing",subType:"emailTemplate"},FI:{type:"Landing",subType:"image"},ML:{type:"LeadDb"},SL:{type:"LeadDb",subType:"smartlist",compType:"Smart List"},ST:{type:"LeadDb",subType:"list",compType:"List",compSubtype:"List"},AH:{type:"Analytics",subType:""},AS:{type:"Analytics",panelId:"atxCanvasSubscriptions"},RCM:{type:"RCM",panelId:""},DM:{type:"DataMgr",panelId:""},AR:{type:"AnalyticsReport",subType:""},LD:{type:"Lead"},AD:{type:"CustAdmin",nodeId:adminTreeMeta.ROOT.nodeId},MC:{type:"CustAdmin",compSubtype:"myAccount",nodeId:adminTreeMeta.MY_ACCOUNT.nodeId},TZ:{type:"CustAdmin",compSubtype:"marketoSubscription",nodeId:adminTreeMeta.TIME_ZONE.nodeId},UR:{type:"CustAdmin",compSubtype:"users",nodeId:adminTreeMeta.USER_ROLES.nodeId,panelId:"cadCanvasUsers"},RL:{type:"CustAdmin",compSubtype:"users",nodeId:adminTreeMeta.USER_ROLES.nodeId,panelId:"cadCanvasRoles"},ZNA:{type:"CustAdmin",compSubtype:"zones",nodeId:adminTreeMeta.WORKSPACES_PARTITIONS.nodeId,panelId:"cadCanvasZones"},PRT:{type:"CustAdmin",compSubtype:"zones",nodeId:adminTreeMeta.WORKSPACES_PARTITIONS.nodeId,panelId:"cadCanvasPartitions"},SF:{type:"CustAdmin",compSubtype:"integration",panelId:"cadSfdcSettings",nodeId:adminTreeMeta.SALESFORCE.nodeId},SIP:{type:"CustAdmin",compSubtype:"lisAdmin",nodeId:adminTreeMeta.SALES_INSIGHT.nodeId,panelId:"cadLisAdmin"},SIA:{type:"CustAdmin",compSubtype:"lisAdmin",nodeId:adminTreeMeta.SALES_INSIGHT.nodeId,panelId:"cadSIAdmin"},LPA:{type:"CustAdmin",compSubtype:"integration",nodeId:adminTreeMeta.LANDING_PAGES.nodeId},EA:{type:"CustAdmin",compSubtype:"emailSettings",nodeId:adminTreeMeta.EMAIL.nodeId},SS:{type:"CustAdmin",compSubtype:"securitySettings",panelId:"cadSecuritySettings",nodeId:adminTreeMeta.LOGIN_SETTINGS.nodeId},MK:{type:"CustAdmin",compSubtype:"MKDenialSettings",panelId:"cadMKDenialSettingsCanvas",nodeId:adminTreeMeta.MK_DENIAL.nodeId},MS:{type:"CustAdmin",compSubtype:"webTracking",nodeId:adminTreeMeta.MUNCHKIN.nodeId},MW:{type:"CustAdmin",compSubtype:"mktows",nodeId:adminTreeMeta.SOAP_API.nodeId},FM:{type:"SchemaHome",nodeId:adminTreeMeta.FIELD_MANAGEMENT.nodeId},FMP:{type:"SchemaHome",panelId:"fmFieldMapping",nodeId:adminTreeMeta.FIELD_MANAGEMENT.nodeId},LL:{type:"SchemaHome",panelId:"fmLeadDisplayLayout",nodeId:adminTreeMeta.FIELD_MANAGEMENT.nodeId},SA:{type:"SysAdmin",panelId:"admCanvasAccounts",nodeId:adminTreeMeta.SYSTEM_ADMIN.nodeId},SO:{type:"CustAdmin",compSubtype:"integration",panelId:"cadSfdcObjectSync",nodeId:adminTreeMeta.SALESFORCE.nodeId},SEL:{type:"CustAdmin",compSubtype:"integration",panelId:"cadSfdcSystemErrorLog",nodeId:adminTreeMeta.SALESFORCE.nodeId},SP:{type:"CustAdmin",compSubtype:"integration",panelId:"cadSfdcProgressLogs",nodeId:adminTreeMeta.SALESFORCE.nodeId},WP:{type:"CustAdmin",compSubtype:"webinarPartner",nodeId:adminTreeMeta.WEBINARS.nodeId},TA:{type:"CustAdmin",compSubtype:"descriptors",nodeId:adminTreeMeta.DESCRIPTORS.nodeId},JS:{type:"CustAdmin",compSubtype:"jigsaw",nodeId:adminTreeMeta.JIGSAW.nodeId},ZN:{type:"Zone"},RA:{type:"CustAdmin",compSubtype:"revenueCycleAnalytics",nodeId:adminTreeMeta.REVENUECYCLEANALYTICS.nodeId},CFS:{type:"CustAdmin",compSubtype:"customFieldSync",nodeId:adminTreeMeta.CUSTOMFIELDSYNC.nodeId,panelId:"cadCustomFieldSyncCanvas"}};},getDlCodeMap:function(code){return dlCodeMap[code];},convertDlObj:function(dlArr){var dlParms={};for(var i=0;i<dlArr.length;i+=2){if(isDefined(dlArr[i+1])){dlParms[dlArr[i]]=dlArr[i+1];}}
return dlParms;},onHistoryChange:function(token){if(token.length<=0){return;}
token=token.toUpperCase();if(!this.updateMutex){var loadHome=false;if(token){var dlParms=this.getDlParams(token);if(dlParms){this.loadDl(dlParms);}else{loadHome=true;}}else{loadHome=true;}
if(loadHome){this.loadDl({type:"Home"});}}
this.updateMutex=false;},getDlParams:function(dlPath){if(this.areDlCodes(dlPath)){dlPath=this.convertDlCode(dlPath);if(isUndefined(dlCodeMap[dlPath["dlCompCode"]])){return null;}
dlPath=Ext.apply(dlPath,dlCodeMap[dlPath["dlCompCode"]]);return dlPath;}
return this.convertDlObj(token.split(this.historyDelimiter));},convertDlCode:function(dlPath){var pathStr=dlPath.toUpperCase();var path=pathStr.match(/^([a-z]+)([0-9]*)([a-z]*)([0-9]*)([a-z]*)([0-9]*)([a-z]*)([0-9]*)([!]*)/i);var pathObj={};var length=path.length;for(var i=0;i<length;i++){if(path[i]=='Z'){path[i-1]=path[i-1]+path[i]+path[i+1];path.splice(i,2);break;}}
if(path){pathObj.dlCompCode=path[1];if(path[2]){pathObj.compId=path[2];}
length=path.length;for(var i=3;i<length-1;i=i+2){if(path[i]=='LA'){pathObj.marketingProgramId=path[i+1];}
else if(path[i]=='ZN'){pathObj.dlZoneCode=path[i];pathObj.dlZoneFolderId=path[i+1];}
else if(path[i]!=""){pathObj.panelIndex=path[i].charCodeAt()-'A'.charCodeAt();}}
if(path[i]==satelliteToken){pathObj.satellite=1;}}
return pathObj;},convertDlPath:function(obj){var pathObj=[];for(key in dlCodeMap){if(key==obj.dlCompCode){pathObj.push(obj.dlCompCode);if(obj.compId!==null){pathObj.push(obj.compId||0);pathObj.push(String.fromCharCode('A'.charCodeAt()+obj.panelIndex||0));pathObj.push(obj.panelIndex+1);}
if(obj.dlZoneCode){pathObj.push(obj.dlZoneCode);}
if(obj.dlZoneFolderId){pathObj.push(obj.dlZoneFolderId);}
if(obj.marketingProgramId){pathObj.push('LA');pathObj.push('1');}}}
return pathObj.join("");},areDlCodes:function(dlPath){return!(/\//.test(dlPath));},updateHistory:function(obj){var dlPath=this.convertDlPath(obj);var runTitleFixup=false;var currToken=Ext.History.getToken()||"";if(currToken.indexOf(satelliteToken)!=-1){dlPath+=satelliteToken;}
if(dlPath&&dlPath.toUpperCase()!=currToken.toUpperCase()){this.updateMutex=true;runTitleFixup=true;Ext.History.add(dlPath,true);}
if(dlPath&&dlPath.length>0){MktPage.updateFullTitle();runTitleFixup=true;}
if(runTitleFixup){this.startTitleFixup();}},startTitleFixup:function(maxIeTitleFixup,interval){interval=interval||50;if(Ext.isIE){maxIeTitleFixup=maxIeTitleFixup||100;if(isDefined(this.intId)){clearInterval(this.intId);this.intId=undefined;}
if(isUndefined(this.intId)){var doc=window.document;var localMaxIeTitleFixup=maxIeTitleFixup;this.intId=window.setInterval(function(){if(isDefined(doc.currentTitle)&&doc.title!=doc.currentTitle){MktPage.setTitle(doc.currentTitle);}
if(localMaxIeTitleFixup<=0){clearInterval(this.intId);this.intId=undefined;}
localMaxIeTitleFixup--;}.createDelegate(this),interval);}}},registerDl:function(type,func){this.registerComp.apply(this,arguments);},loadDl:function(params){this.mapParams(params);for(key in params){this._get(key,params);}},mapParams:function(params){if(isUndefined(params))return params;if(isDefined(params.type)){if(params.type=="MA"){params.compSubtype=params.compSubtype||params.subType;}}
return null;},getDlUrl:function(compCode,compId,tabIndex,satelliteMode){var hash='#'+compCode+compId+tabIndex+(satelliteMode?'!':'');return MktSession.getUrlPrefix()+hash;}});}();MktDlManager=Mkt.util.DeepLinkMgr;MktDlManager.registerDl('type',function(params){MktMainNav['load'+params.type](params);});
/* ========== ../mkt-ext-2.0/util/JsonSansEval.js ============ */

var jsonParse=(function(){var number='(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)';var oneChar='(?:[^\\0-\\x08\\x0a-\\x1f\"\\\\]'
+'|\\\\(?:[\"/\\\\bfnrt]|u[0-9A-Fa-f]{4}))';var string='(?:\"'+oneChar+'*\")';var jsonToken=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]'
+'|'+number
+'|'+string
+')','g');var escapeSequence=new RegExp('\\\\(?:([^u])|u(.{4}))','g');var escapes={'"':'"','/':'/','\\':'\\','b':'\b','f':'\f','n':'\n','r':'\r','t':'\t'};function unescapeOne(_,ch,hex){return ch?escapes[ch]:String.fromCharCode(parseInt(hex,16));}
var EMPTY_STRING=new String('');var SLASH='\\';var firstTokenCtors={'{':Object,'[':Array};var hop=Object.hasOwnProperty;return function(json,opt_reviver){var toks=json.match(jsonToken);var result;var tok=toks[0];var topLevelPrimitive=false;if('{'===tok){result={};}else if('['===tok){result=[];}else{result=[];topLevelPrimitive=true;}
var key;var stack=[result];for(var i=1-topLevelPrimitive,n=toks.length;i<n;++i){tok=toks[i];var cont;switch(tok.charCodeAt(0)){default:cont=stack[0];cont[key||cont.length]=+(tok);key=void 0;break;case 0x22:tok=tok.substring(1,tok.length-1);if(tok.indexOf(SLASH)!==-1){tok=tok.replace(escapeSequence,unescapeOne);}
cont=stack[0];if(!key){if(cont instanceof Array){key=cont.length;}else{key=tok||EMPTY_STRING;break;}}
cont[key]=tok;key=void 0;break;case 0x5b:cont=stack[0];stack.unshift(cont[key||cont.length]=[]);key=void 0;break;case 0x5d:stack.shift();break;case 0x66:cont=stack[0];cont[key||cont.length]=false;key=void 0;break;case 0x6e:cont=stack[0];cont[key||cont.length]=null;key=void 0;break;case 0x74:cont=stack[0];cont[key||cont.length]=true;key=void 0;break;case 0x7b:cont=stack[0];stack.unshift(cont[key||cont.length]={});key=void 0;break;case 0x7d:stack.shift();break;}}
if(topLevelPrimitive){if(stack.length!==1){throw new Error();}
result=result[0];}else{if(stack.length){throw new Error();}}
if(opt_reviver){var walk=function(holder,key){var value=holder[key];if(value&&typeof value==='object'){var toDelete=null;for(var k in value){if(hop.call(value,k)&&value!==holder){var v=walk(value,k);if(v!==void 0){value[k]=v;}else{if(!toDelete){toDelete=[];}
toDelete.push(k);}}}
if(toDelete){for(var i=toDelete.length;--i>=0;){delete value[toDelete[i]];}}}
return opt_reviver.call(holder,key,value);};result=walk({'':result},'');}
return result;};})();
/* ========== ../mkt-ext-2.0/util/XdMessaging.js ============ */

Ext.ns("Mkt.util");Mkt.util.XdMessaging={mainProxyIFrameSrc:"/landingPage/xdIFrameProxy",name:'xdIFrameProxy',checkInterval:200,mainProxyIFrameFullUrl:'',setupListener:function(name,handler,win){var location=win.location;this.setupMsgHandler(location,handler);},init:function(name,handler,receiverOnly){this.runAction=handler||this.runAction;if(this.isPostMessageAvailable()){window.addEventListener('message',this.postMessageHandler.createDelegate(this),false);}
else if(!this.isXdMessagingNeeded()){return;}
else{var frameDiv=document.getElementById(name);if(frameDiv){var frame=this.getIFrame(name);Ext.get(frameDiv).on('load',this.setupListener.createDelegate(this,[name,this.runAction,frame.window]));this.mainProxyIFrameFullUrl=this.mainProxyIFrameSrc+(receiverOnly?"?receiver=true":"");frameDiv.src=this.mainProxyIFrameFullUrl;this.name=name;}}},reInitRecieverIFrame:function(){if(!this.isPostMessageAvailable()){var frame=this.getIFrame(this.name);if(frame){frame.location.hash="#";}}},runAction:function(actionMsg){var action=actionMsg.match(/([a-zA-Z\-_]*):(.*)/);if(!action||!action[1]||!action[2]){return;}
if(Mkt.util.XdMessaging.AllowedActions[action[1]]){Mkt.util.XdMessaging.AllowedActions[action[1]].apply(this,jsonParse(action[2]));}},saniFragmentMsg:function(msg){return msg.toString().replace(/^#/,'');},getHostname:function(str,withProto){var matchIndex=1;if(withProto){matchIndex=0;}
var re=new RegExp('^(?:f|ht)tp(?:s)?\://([^/]+)','im');var match=str.match(re);if(match){return match[matchIndex].toString();}},setupMsgHandler:function(location,newMsgCallbackFn){if(this.intHandle){return;}
setTimeout(this.checkMessage.createDelegate(this,[location,newMsgCallbackFn]),this.checkInterval);},checkMessage:function(location,newMsgCallbackFn){if(location&&location.hash){if(location.hash==""||location.hash=="#"){this.lastMsg="";}
else if(location.hash!=this.lastMsg){var msg=location.hash;this.lastMsg=msg;msg=this.saniFragmentMsg(location.hash);msg=decodeURIComponent(msg);newMsgCallbackFn(msg);}}
else{this.lastMsg="";}
if(location){setTimeout(this.checkMessage.createDelegate(this,[location,newMsgCallbackFn]),this.checkInterval);}},isPostMessageAvailable:function(){return window.postMessage&&!Ext.isIE;},isXdMessagingNeeded:function(){var meta=this.getXdUrlMeta();return meta['xdEditorBaseUrl']!=meta['mainAppBaseUrl'];},postMessageHandler:function(e){if(e.origin!==this.getXdBaseUrl()){return;}
if(this.runAction){this.runAction(decodeURIComponent(e.data));}},setupXdIFrameProxy:function()
{if(!this.isPostMessageAvailable()){this.setupMsgHandler(window.location,function(msg){this.relayMessage(msg);}.createDelegate(this),window);}},relayMessage:function(msg)
{if(window.parent&&window.parent.opener){window.parent.opener.window.frames[this.name].window.location.hash=msg;}},sendMessage:function(msg){var rawMessage=msg;msg=encodeURIComponent(msg);if(!this.isXdMessagingNeeded()){window.opener.Mkt.util.XdMessaging.runAction(rawMessage);}
else if(this.isPostMessageAvailable()&&window.opener){window.opener.postMessage(msg,this.getXdBaseUrl(true));}
else{this.getIFrame(this.name).location=this.getXdIFrameUrl()+"#"+msg;}},getXdUrlMeta:function(){var meta={};if(typeof lpeEditorMetadata!='undefined'&&lpeEditorMetadata['xdEditorBaseUrl']&&lpeEditorMetadata['mainAppBaseUrl']){meta=lpeEditorMetadata;}
else if(typeof MktPage!='undefined'&&MktPage.savedState&&MktPage.savedState['xdEditorBaseUrl']&&MktPage.savedState['mainAppBaseUrl']){meta=MktPage.savedState;}
return meta;},getXdIFrameUrl:function(){var baseUrl=this.getXdUrlMeta()['mainAppBaseUrl'];return(baseUrl?baseUrl:"")+this.mainProxyIFrameSrc;},getXdBaseUrl:function(srcHost){return this.getXdUrlMeta()[srcHost?'mainAppBaseUrl':'xdEditorBaseUrl'];},getIFrame:function(frameName){var iwin;if(navigator.userAgent.indexOf("Safari")!=-1){iwin=window.frames[frameName];}
else{iwin=document.getElementById(frameName).contentWindow;}
return iwin;},getSourceDomainQueryString:function(){return"explictHostname="+window.location.host;}};Mkt.util.XdMessaging.AllowedActions={markLandingPageDirty:function(lpId,nodeId){mktLandingManager.markPageDirty(lpId,nodeId);},markLandingPageTemplateDirty:function(lptId,nodeJson){Mkt.app.DesignStudio.Templates.markTemplateDirty(lptId,nodeJson);}};
/* ========== ../mkt-ext-2.0/util/mktKeyMap.js ============ */

(function(){Ext.ns('Mkt');Mkt.KeyMap=Ext.extend(Ext.KeyMap,{checkModifiers:function(config,e)
{if(config.navOnly!==false&&this._isInputElement(e.target)){return false;}
return Ext.KeyMap.prototype.checkModifiers.apply(this,arguments);},_isInputElement:function(el)
{return/input|textarea|select/i.test(el.tagName);}});})();
/* ========== mktLanding.js ============ */

function mktLandingManager(gridId,schema,colConfig){this.schema=schema;this.gridId=gridId;this.colModel=new mktFooterColumnModel(colConfig);this.selModel=new YAHOO.ext.grid.DefaultSelectionModel();this.dataModel=new mktLandingDataModel(this.schema);this.gConfig={dataModel:this.dataModel,colModel:this.colModel,autoSizeColumns:true,selModel:this.selModel,enableDragDrop:false,disableSelection:false};this.gridRendered=false;this.myPanelId=MktPage.activePanel.cName;this.rowHeight=this.getRowHeight();this.setGridSize();this.grid=new mktFooterGrid(gridId,this.gConfig);MktPage.eventMgr.on('canvasresizedone',this.canvasResized,this,true);MktPage.eventMgr.on('panelactivate',this.panelActivated,this,true);this.selModel.addListener('selectionChange',this.selectionChanged,this,true);MktPage.canvasCleanupStack.push(this.destroy.createDelegate(this));};mktLandingManager.prototype.loadGrid=function(gData){this.dataModel.loadData(gData);this.grid.render();this.gridRendered=true;this.reRenderOnShow=false;};mktLandingManager.prototype.reRenderGrid=function(){if(this.gridRendered){this.grid.reset(this.gConfig);this.grid.render();}};mktLandingManager.prototype.getRowHeight=function(){var rule=YAHOO.ext.util.CSS.getRule(["#"+this.gridId+" .ygrid-row",".ygrid-row"]);if(rule&&rule.style.height){var rowHeight=parseInt(rule.style.height,10);}else{var rowHeight=21;}
return rowHeight;};mktLandingManager.prototype.getGridSizeParameters=function(){var sp={minHeight:300,maxHeight:800,reservedHeight:142};return sp;};mktLandingManager.prototype.setGridSize=function(){var gridPanel=getEl(this.myPanelId);var cv=getEl(MktUtil.getFirstElementByClassName('mktPanelOverflow','div',gridPanel.dom));var sp=this.getGridSizeParameters();var cvh=cv.getHeight(true);cvh=Math.min(cvh,sp.maxHeight);cvh=Math.max(cvh,sp.minHeight);cvh=this.rowHeight*(Math.floor(cvh/this.rowHeight));var gridEl=getEl(this.gridId);gridEl.setHeight(cvh-sp.reservedHeight);};mktLandingManager.prototype.canvasResized=function(){var showingPanel=MktPage.activePanel.cName;if(showingPanel==this.myPanelId){this.setGridSize();this.reRenderGrid();}else{this.reRenderOnShow=true;}};mktLandingManager.prototype.panelActivated=function(panel){if(this.myPanelId==panel.cName){if(this.reRenderOnShow){this.setGridSize();this.reRenderGrid();this.reRenderOnShow=false;}}};mktLandingManager.prototype.getNumSelected=function(){return this.selModel.getCount();};mktLandingManager.prototype.getSelectedIds=function(){return this.selModel.getSelectedRowIds();};mktLandingManager.prototype.getDeployStatus=function(id){var rdx=this.dataModel.getRowIndexById(id);var dpStatus=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpStatus'));return dpStatus;};mktLandingManager.prototype.selectGridRows=function(rowId){this.selModel.selectRowsById(rowId,false);var newrow=this.grid.getRowsById(rowId);this.grid.scrollTo(newrow);};mktLandingManager.prototype.selectionChanged=function(selModel,rows,ids){};mktLandingManager.prototype.addGridRow=function(gData){if(gData[this.schema.root].length>0){this.dataModel.loadData(gData,null,true);var newId=gData[this.schema.root][0][this.schema.id];var newrow=this.grid.getRowsById(newId);this.grid.scrollTo(newrow);}};mktLandingManager.prototype.deleteGridRows=function(delData){var dellength=delData.length;if(dellength>0){var rowindexes=[];for(var ix=0;ix<dellength;ix++){var ritem=delData.shift();var row=this.grid.getRowsById(ritem[this.schema.id]);this.selModel.deselectRow(row);rowindexes[ix]=this.dataModel.getRowIndexById(ritem[this.schema.id]);}
this.dataModel.removeRowList(rowindexes);}};mktLandingManager.prototype.showDetailPanel=function(oid,area,isDraftNode,contextAccessZoneId){var parms={};parms.objId=oid;parms.lpgId=oid;if(isDefined(isDraftNode)){parms.isDraftNode=isDraftNode;}
if(isDefined(contextAccessZoneId)){parms.contextAccessZoneId=contextAccessZoneId;}
MktSession.ajaxRequest('landingPage/'+area+'Detail',{serializeParms:parms});};mktLandingManager.prototype.destroy=function(){MktPage.eventMgr.removeListener('canvasresizedone',this.canvasResized,this);MktPage.eventMgr.removeListener('panelactivate',this.panelActivated,this);this.grid.resetCSS();this.grid.destroy();};mktLandingManager.prototype.requestRefreshGrid=function(action){MktSession.ajaxRequest(action,{onMySuccess:this.processRefreshGrid.createDelegate(this)});};mktLandingManager.prototype.processRefreshGrid=function(){this.selModel.clearSelections();this.dataModel.loadData(MktPage.appVars[this.schema.root]);delete MktPage.appVars[this.schema.root];};mktLandingManager.prototype.checkInUse=function(field,eMsg,srid,panelId){if(srid.length>0){var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(!panel){return;}
for(var ix=0;ix<srid.length;ix++){var grid=panel.getGridPanel();if(grid){var store=grid.getStore();var rec=store.getById(srid[ix]);if(rec&&rec.data[field]&&rec.data[field].length>0){MktMessage.showWarning(eMsg);return true;}}}}
return false;};mktLandingManager.prototype.driveDeleteObjects=function(oids,animEl){var iuEmsg="You cannot delete "+this.oTypeText+"s that are in use.  No "+
this.oTypeText+"s were deleted.";if(mktLandingManager.prototype.checkInUse('usedBy',iuEmsg,oids,this.panelId))return;var dCount=oids.length;if(dCount==1){var rdx=this.dataModel.getRowIndexById(oids[0]);var objectName=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf(this.oPfx+'Name'));var cmsg='Are you sure you want to delete <b>'+objectName+'</b> ?';}else if(dCount>1){var cmsg='Are you sure you want to delete multiple '+this.oTypeText+'s?';}else{return;}
this.dOids=oids;MktMessage.confirmDelete('Delete '+this.oTypeText+'?',cmsg,mktLandingManager.prototype.submitDeleteObjects.createDelegate(this),animEl);};mktLandingManager.prototype.submitDeleteObjects=function(btn,unused,checked){if(this.dOids.length>0){var parms={};for(var ix=0;ix<this.dOids.length;ix++){var dItem='dobjid_'+this.dOids[ix];parms[dItem]=dItem;}
if(checked)parms.delTp=1;var uTypeText=this.oTypeText.replace(/^[a-z]/,function(m){return m.toUpperCase();});var url='landingPage/delete'+uTypeText+'Request';MktSession.ajaxRequest(url,{serializeParms:parms,onMySuccess:mktLandingManager.prototype.deleteObjectsDone.createDelegate(this)});}};mktLandingManager.prototype.deleteObjectsDone=function(){if(isDefined(MktPage.appVars.warningMessage)){MktMessage.showWarning(MktPage.appVars.warningMessage);delete MktPage.appVars.warningMessage;}
try{var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var addNodeJsons=MktPage.appVars.addedNodeJsons;if(isDefined(addNodeJsons)){MktExplorer.addNodes(addNodeJsons);delete MktPage.appVars.addedNodeJsons;}
var panel=MktCanvas.getItem(MktCanvas.getTab(this.panelId));if(panel){var grid=panel.getGridPanel();var deletedOids=MktPage.appVars.deletedOids;if(grid&&deletedOids){grid.deleteGridRows(deletedOids);}}}catch(e){if(!panel){var panel=MktCanvas.getItem(MktCanvas.getTab(this.panelId));}
if(!grid&&panel){var grid=panel.getGridPanel();}
if(grid&&panel){grid.getStore().reload();}}
var tabId=MktCanvas.getTab(this.detailPanelId);var tab=MktCanvas.getItem(tabId);if(tab){var id=tab.config.compId*1;if(this.dOids.indexOf(id)>=0){MktCanvas.remove(tabId);}}};mktLandingManager.prototype.getTargets=function(){var targets=[];if(MktPage.activePanel.cName==this.panelIdOverview){if(this.getNumSelected()>0){targets=this.getSelectedIds();}}else{targets=[MktPage.activePanel.config.cHData];}
return targets;};mktLandingManager.prototype.rndPercent=function(value,rowIdx,colIdx){if(value===""||value===null||isNaN(value))return'';var nStr=value*100+'';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1].substring(0,2):'';return x1+'%';};mktLandingManager.prototype.rndDateTime=function(val){if(val=='')return val;return MktUtil.formatDate(new Date(val*1000),"d NNN yy hh:mmp");};mktLandingManager.prototype.rndInUseBy=function(val){if(!(val instanceof Array))return'';if(val.length==0)return'Not used';var maxToShow=3;var rv='';var first=true;for(var ix=0;ix<val.length;ix++){if(ix==(maxToShow-1))break;if(!first)rv+=', ';var lv=val[ix].lpName;rv+=lv.replace(' ','&nbsp;','g');first=false;}
var leftToShow=val.length-ix;if(leftToShow==1){var lv=val[maxToShow-1].lpName;rv+=', '+lv.replace(' ','&nbsp;','g');}else if(leftToShow>1){var first=true;var tip='';for(var jx=ix;jx<val.length;jx++){if(!first)tip+=', ';tip+=val[jx].lpName;first=false;}
rv+='<span class="mktMoreTip" title="'+tip+'">, ('+leftToShow+'&nbsp;more)</span>';}
return rv;};mktLandingManager.prototype.rndURLPath=function(val){return val;};mktLandingManager.refreshTree=function(treeName){MktSession.ajaxRequest('landingPage/refresh'+treeName+'Tree',{onMySuccess:function(){MktTree.processTreeData('lpgTree');}});};mktLandingManager.editMeta=function(){MktSession.ajaxRequest('landingPage/editMetaRequest',{serializeForm:'lpMetaPanelForm',serializeParms:{lpOid:MktPage.appVars.lpOid},containerId:'lpMeta',onMySuccess:mktLandingManager.editMetaDone});};mktLandingManager.editMetaDone=function(){var nodeJson=MktPage.appVars.nodeJson;if(isDefined(nodeJson)){MktExplorer.updateNode(nodeJson.id,nodeJson);}
MktPage.updateActivePanelTitle(MktPage.appVars.lpDetailTitle.ellipse(20));};mktLandingManager.processPostAction=function(mainPanelId,detailPanelId){var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var deletedOids=MktPage.appVars.deletedOids;var panel=MktCanvas.getItem(MktCanvas.getTab(mainPanelId));if(panel){var grid=panel.getGridPanel();if(grid&&deletedOids){grid.deleteGridRows(deletedOids);}}
var tabId=MktCanvas.getTab(detailPanelId);var tab=MktCanvas.getItem(tabId);if(tab&&deletedOids){if(deletedOids.indexOf(tab.config.cHData)){MktCanvas.remove(tabId);}}};mktLandingManager.CONSTANTS={};mktLandingManager.CONSTANTS.draftStatus=0;mktLandingManager.CONSTANTS.approvedStatus=1;mktLandingManager.CONSTANTS.dirtyStatus=2;mktLandingManager.markNodeDirty=function(node){var constants=mktLandingManager.CONSTANTS;var attr=node.attributes,xtraAttr=attr.xtra;var parentNodeId=attr.parentId,parentNode,isDeployed=false,compId;if(xtraAttr.compSubtype=="page"){parentNode=MktExplorer.getNodeById(parentNodeId);if(parentNode.attributes.xtra.compType=='Landing Page Test Group'){compId=parentNode.attributes.xtra.compId;}}
if((parentNode&&parentNode.attributes.xtra.compStatus==constants.approvedStatus)||xtraAttr.compStatus==constants.approvedStatus){MktExplorer.updateNodeAttr(node.id,{compStatus:constants.dirtyStatus});if(!node.firstChild){var clonedNode=node.clone({iconCls:'mkiPencil',leaf:true,allowDrag:false,text:'Draft',xtra:Ext.apply({},{isDraftNode:true,nodeId:undefined,compStatus:constants.dirtyStatus},node.attributes.xtra)});node.leaf=false;MktExplorer.updateNodeIconCls(node.id,'mkiWebpageEdit','mkiWebpageOk');var attr=node.attributes;attr.leaf=false;attr.folder=true;attr.xtra.hasDraftNode=true;attr.xtra.compStatus=constants.dirtyStatus;attr.hasChildren=true;node.appendChild(clonedNode);}
isDeployed=true;if(!compId){compId=node.attributes.xtra.compId;}}
var testpagePanel=MktCanvas.getItem(MktCanvas.getTab('landingLPDetail'));if(testpagePanel){var grid;}};mktLandingManager.markPageDirty=function(lpId,nodeId){var constants=mktLandingManager.CONSTANTS;var node=MktExplorer.getNodeById(nodeId);if(isDefined(node)){mktLandingManager.markNodeDirty(node);}
if(MktPage.appVars.lpStatus==constants.approvedStatus){mktLPLManager.updateDetailStatus(lpId,constants.dirtyStatus);}
var pagePanel=MktCanvas.getTab('landingCanvasLP');if(pagePanel){var grid=pagePanel.getGridPanel();if(grid){var rec=grid.getStore().getById(lpId);if(rec){var status=rec.data['status']||rec.data['lpStatus'];if(rec&&status==constants.approvedStatus){rec.data['status']=rec.data['lpStatus']=constants.dirtyStatus;grid.getView().refreshRow(rec);}}}}
var detailPanel=MktCanvas.getTab('landingLPDetail');if(detailPanel){var grid=detailPanel.getGridPanel();if(grid){var rec=grid.getStore().getById(lpId);if(rec){var status=rec.data['status']||rec.data['lpStatus'];if(rec&&status==constants.approvedStatus){rec.data['status']=rec.data['lpStatus']=constants.dirtyStatus;grid.getView().refreshRow(rec);}}}}
if(Mkt.apps.localasset&&Mkt.apps.localasset.Constants){var registeredAssetManager=MktCanvas.getRegisteredItem(Mkt.apps.localasset.Constants.LOCAL_ASSET_MANAGER,Mkt.apps.localasset.Constants.TAB_NAME);if(registeredAssetManager){var matchingNodes=registeredAssetManager.getNodeById(nodeId);for(var i=0;i<matchingNodes.length;i++){var matchingNode=matchingNodes[i];var compStatus=matchingNode.attributes.xtra.compStatus;mktLandingManager.markNodeDirty(matchingNode);if(compStatus==constants.approvedStatus){Ext.apply(matchingNode.attributes.xtra,{compStatus:constants.dirtyStatus});var iconEl=Ext.get(matchingNode.getUI().getIconEl());if(iconEl){iconEl.removeClass('mkiWebpageOk');iconEl.addClass('mkiWebpageEdit');}}}}}};function mktLPLManager(){var LPLschema={root:'lplData',id:'lpId',fields:['lpName','lpType','lpStatus','lpPaused','lpURLPath','lpViews','lpConv','lpConvRate','lpUpdated']};var LPLcolConfig=[{header:"Name",useCSSAsMinWidth:true,allocatePct:60,resizable:true,sortable:true},{header:"Type",useCSSWidth:true,sortable:true,renderer:this.rndType.createDelegate(this),exportRenderer:this.rndTypeExport.createDelegate(this)},{header:"Aprv",useCSSWidth:true,tooltip:"Approved",resizable:false,sortable:true,renderer:this.rndDeployed.createDelegate(this),exportRenderer:this.rndDeployedExport.createDelegate(this)},{hidden:true},{header:"Unique URL Name",useCSSAsMinWidth:true,allocatePct:40,resizable:true,sortable:true,renderer:this.rndURLPath.createDelegate(this)},{header:"Views",useCSSWidth:true,tooltip:"Page views",resizable:false,sortable:true,rendererName:"formatIntNumber"},{header:"Conv",useCSSWidth:true,tooltip:"Conversions",resizable:false,sortable:true,rendererName:"formatIntNumber"},{header:"CnvRt",useCSSWidth:true,tooltip:"Conversion Rate",resizable:false,sortable:true,renderer:this.rndPercent.createDelegate(this),rendererName:"formatPercent"},{header:"Last Updated",useCSSWidth:true,resizable:false,sortable:true,renderer:this.rndDateTime.createDelegate(this),exportRenderer:this.rndDateTime.createDelegate(this)}];this.treeNodeType=2;this.treePfx='lpg_';this.oPfx='lp';this.oTypeText='page';this.panelIdOverview='landingCanvasLP';this.panelIdDetail='landingLPDetail';this.instanceName='lplmgr';mktLPLManager.superclass.constructor.call(this,'lplGrid',LPLschema,LPLcolConfig);this.newTB=new mktToolbarButton('mlpTBNewLP',this.tbNewSelected.createDelegate(this,['mlpTBNewLP']));this.newTBd=null;this.editTB=new mktToolbarButton('mlpTBEditLP',this.tbEditSelected.createDelegate(this));this.editTBd=null;this.previewTB=new mktToolbarButton('mlpTBPreviewLP',this.tbPreviewSelected.createDelegate(this));this.previewTBd=null;this.detailsTB=new mktToolbarButton('mlpTBDetailsLP',this.tbDetailsSelected.createDelegate(this));}
Ext.extend(mktLPLManager,mktLandingManager,{});mktLPLManager.prototype.driveDeleteObjects=function(oids,animEl){var dCount=oids.length;var tCount=0;for(var ix=0;ix<dCount;ix++){var rdx=this.dataModel.getRowIndexById(oids[ix]);if(this.dataModel.getValueAt(rdx,this.schema.fields.indexOf(this.oPfx+'Type'))==1){tCount++;}}
if(tCount==0){var dpEmsg="You cannot delete pages that are approved.  Nothing was deleted.";}else if(dCount==tCount){var dpEmsg="You cannot delete test groups that are approved.  Nothing was deleted.";}else{var dpEmsg="You cannot delete pages and test groups that are approved.  Nothing was deleted.";}
if(this.checkDeployed(oids,dpEmsg))return;if(dCount==1){var rdx=this.dataModel.getRowIndexById(oids[0]);var objectName=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf(this.oPfx+'Name'));if(tCount==0){var cmsg='Are you sure you want to delete landing page <b>'+objectName+'</b>?';}else{var cmsg='Are you sure you want to delete landing page test group <b>'+objectName+'</b>?';}}else if(dCount>1){if(tCount==0){var cmsg='Are you sure you want to delete multiple landing pages?';}else if(tCount==dCount){var cmsg='Are you sure you want to delete multiple landing page test groups?';}else{var cmsg='Are you sure you want to delete multiple landing pages and test groups?';}}else{return;}
this.dOids=oids;MktMessage.confirmDelete('Delete Landing Page',cmsg,this.submitDeleteObjects.createDelegate(this),animEl);};mktLPLManager.prototype.driveModifySelectedPages=function(action){if(MktPage.isTestdrive()){if(action=='deploy'||action=='undeploy'){MktUtil.alertNotInTestdrive();delete MktPage.appVars.lplData;return;}}
if(this.selModel.getCount()>0){var srid=this.selModel.getSelectedRowIds();var parms={};for(var ix=0;ix<srid.length;ix++){var dItem='dpageid_'+srid[ix];parms[dItem]=dItem;}
mktLPLManager.doModifyPages(action,parms);}
delete MktPage.appVars.lplData;};mktLPLManager.prototype.checkDeployed=function(srids,eMsg){if(this.getAllowedActions(srids).allowDelete){return false;}else{MktMessage.showWarning(eMsg);return true;}};mktLPLManager.prototype.driveUrlBuilder=function(animEl){if(this.selModel.getCount()>0){var srid=this.selModel.getSelectedRowIds();mktLPLManager.doUrlBuilder(srid[0],animEl);}};mktLPLManager.prototype.showDetailPanel=function(oid,isDraftNode){mktLPLManager.superclass.showDetailPanel.call(this,oid,'page',isDraftNode);};mktLPLManager.prototype.tbNewSelected=function(tbId){mktLPLManager.driveCreatePageModal(getEl(tbId));};mktLPLManager.prototype.tbEditSelected=function(){mktLPLManager.openLPEditor(this.getTargets()[0]);};mktLPLManager.prototype.tbPreviewSelected=function(){mktLPLManager.openLPPreview(undefined,this.getTargets()[0]);};mktLPLManager.prototype.tbDetailsSelected=function(){MktMainNav.loadLanding({lpgType:'page',lpgId:this.getTargets()[0]});};mktLPLManager.prototype.selectionChanged=function(selModel,rows,ids){if(ids.length==0){this.editTB.doDisable();this.previewTB.doDisable();this.detailsTB.doDisable();}else if(ids.length==1){var rdx=this.dataModel.getRowIndexById(ids[0]);var lpType=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpType'));if(lpType==0){this.editTB.doEnable();this.previewTB.doEnable();}else{this.editTB.doDisable();this.previewTB.doDisable();}
this.detailsTB.doEnable();}else{this.editTB.doDisable();this.previewTB.doDisable();this.detailsTB.doDisable();}};mktLPLManager.prototype.getAllowedActions=function(ids){var rv={allowDeploy:true,allowUndeploy:true,allowRevert:true,allowDelete:true,allowEdit:true,allowPreview:true,allowClone:true,allowConvert:true,allowURLBuild:true};if(ids.length>0){for(var ix=0;ix<ids.length;ix++){var rdx=this.dataModel.getRowIndexById(ids[ix]);var dpStatus=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpStatus'));if(dpStatus==0){rv.allowUndeploy=false;rv.allowRevert=false;}
if(dpStatus<2){rv.allowRevert=false;}
if(dpStatus>0){rv.allowDelete=false;}
var dpType=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpType'));if(dpType!=0){rv.allowEdit=false;rv.allowPreview=false;rv.allowClone=false;rv.allowConvert=false;}}}
return rv;};mktLPLManager.prototype.getPanelType=function(){if(MktPage.activePanel.cName==this.panelIdOverview){return'overview';}
if(MktPage.appVars.lpInTest){return'detailtestpage';}
if(MktPage.appVars.lpType==0){return'detailpage';}else{return'detailtest';}};mktLPLManager.prototype.getPageInfo=function(lpId,infoA,key){for(var ix=0;ix<infoA.length;ix++){if(infoA[ix].lpId==lpId)return infoA[ix][key];}
return null;};mktLPLManager.prototype.updateDetailStatus=function(){console.debug('mktLPLManager.updateDetailStatus');if(isObject(MktPage.canvasContext['landingLPDetail'])){console.debug('found detail page');if($('lpLPDashStatus')){var dpStatus=null;if(isDefined(MktPage.appVars.lpdData)){dpStatus=this.getPageInfo(MktPage.appVars.lpOid,MktPage.appVars.lpdData.lpdData,'lpStatus');}
if(dpStatus==null){if(isDefined(MktPage.appVars.lplData)){var dpStatus=this.getPageInfo(MktPage.appVars.lpOid,MktPage.appVars.lplData.lplData,'lpStatus');}}
if(dpStatus!=null){MktAppJS.dashSetText("lpLPDashStatus",this.rndDeployedText(dpStatus));}}
if($('lpLPDashPA')){var dpPaused=null;if(isDefined(MktPage.appVars.lpdData)){dpPaused=this.getPageInfo(MktPage.appVars.lpOid,MktPage.appVars.lpdData.lpdData,'lpPaused');}
if(dpPaused!=null){MktAppJS.dashSetText("lpLPDashPA",this.rndPausedText(dpPaused));}}}};mktLPLManager.prototype.processRefreshGrid=function(){this.updateDetailStatus();mktLPLManager.superclass.processRefreshGrid.call(this);};mktLPLManager.prototype.rndDeployed=function(val){if(val===''){var rv="";}else if(val===0){var rv="";}else if(val===1){var rv="<img class='lpDetailDeploy' src='/images/checked.gif' title='Approved' />";}else{var rv="<img class='lpDetailDeploy' src='/images/warning_16.gif' title='Page has changed; you must approve again for changes to take effect' />";}
return rv;};mktLPLManager.prototype.rndDeployedExport=function(val){if(val===''){var rv="";}else if(val===0){var rv="Draft";}else if(val===1){var rv="Approved";}else{var rv="Approved with draft";}
return rv;};mktLPLManager.rndDeployedText=function(val){if(val==0){var rv="<img src='/images/icons16/webpage.png' />Draft";}else if(val==1){var rv="<img src='/images/icons16/webpage_ok.png' />Approved";}else{var rv="<img src='/images/icons16/webpage_edit.png' />Approved with draft";}
return rv;};mktLPLManager.rndPausedText=function(val){if(val==0){var rv="<img src='/images/icons16/media_play_green.png' style='margin-bottom:2px;vertical-align:middle;' />&nbsp;Active";}else if(val==1){var rv="<img src='/images/icons16/media_pause.png' style='margin-bottom:2px;vertical-align:middle;' />&nbsp;Paused";}else{var rv="";}
return rv;};mktLPLManager.rndType=function(val){if(val===''){var rv="";}else if(val===0){rv='<img src="/images/icons16/cust_lp_draft.png" title="Individual Landing Page"/>';}else{rv='<img src="/images/icons16/cust_abtest_draft.png"/>';}
return rv;};mktLPLManager.rndTypeText=function(val,inTest){if(val==0){if(inTest){rv='Tested Landing Page';}else{rv='Individual Landing Page';}}else if(val==1){rv='Landing Page Test Group';}else{throw"Unknown landing page type to render "+val;}
return rv;};mktLPLManager.prototype.rndTypeExport=function(val){if(val===''){var rv="";}else if(val===0){rv='Individual Page';}else if(val===1){rv='Test Group';}else{throw"Unknown landing page type to render "+val;}
return rv;};mktLPLManager.prototype.destroy=function(){if(isObject(this.editTB))this.editTB.destroy();if(isObject(this.editTBd))this.editTB.destroy();mktLPLManager.superclass.destroy.call(this);};mktLPLManager.openLPEditor=function(pageId){var sessId="LPE_"+Math.floor(Math.random()*10001+10000);var url=MktPage.savedState.xdEditorBaseUrl+MktSession.getUrlPrefix()+"/lpeditor/editor?lpview=edit&pageId="+
pageId+"&"+Mkt.util.XdMessaging.getSourceDomainQueryString();url+="&lpeSession="+sessId;Mkt.util.Common.xdLogin(function(url){var newWind=window.open(url,"_blank","width=1024, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}.createDelegate(this,[url]));};mktLPLManager.openLPPreview=function(nodeId,pageId,deployedLatest){var tNode=MktExplorer.getNodeById(nodeId);if(isObject(tNode)){if(tNode.attributes.xtra.type=='test'){var msg='This ad references a Marketo landing page test group.  You can preview individual tested pages in this group using the Landing Pages tools.';MktMessage.showInfo(msg);return;}
pageId=pageId||tNode.attributes.xtra.compId;}
var url="/lpeditor/preview?lpview=preview&pageId="+pageId;if(isDefined(deployedLatest)&&deployedLatest){url+="&deployedLatest=true";}
if(isDefined(pageId)){url=MktPage.savedState.xdEditorBaseUrl+MktSession.getUrlPrefix()+url;Mkt.util.Common.xdLogin(function(url){var newWind=window.open(url,"_blank","width=1024, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}.createDelegate(this,[url]));}};mktLPLManager.driveCreatePageModal=function(animEl,cloneFromId,tgContext,parentId,accessZoneId,marketingProgramId){var parms={};var iconCls=null;if(cloneFromId!=null){parms.lpePgFrom=cloneFromId;var title="Clone to New Landing Page";var fht=450;iconCls='mkiTextRichColored';}else{var title="New Landing Page";var fht=400;iconCls='mkiTextRichColoredAdd';}
if(tgContext!=null){parms.lpeTgContext=tgContext;}
if(isDefined(parentId)){parms.parentId=parentId;}
if(isDefined(accessZoneId)){parms.accessZoneId=accessZoneId;}
if(isDefined(MktPage.appVars.disableActionBtn)){delete MktPage.appVars.disableActionBtn;}
if(isDefined(marketingProgramId)){parms.marketingProgramId=marketingProgramId;}
var mp=new MktModalForm({url:'/landingPage/createPageRequest',ajopts:{serializeParms:parms},title:title,iconCls:iconCls,okButtonTitle:'Create',width:850,height:fht});mp.on('load',mktLPLManager.CPLoaded,mp,true);mp.show(animEl,mktLPLManager.submitCreatePage);};mktLPLManager.submitCreatePage=function(mf){var programPickerField=Ext.getCmp('programPckr');var programId='';var cloneToMarketingProgramId='';if(isDefined(programPickerField)){if(programPickerField.selectedIndex!=-1&&programPickerField.getValue()){programId=programPickerField.getValue();}}
else{programPickerField=Ext.getCmp('cloneToProgramPicker');if(programPickerField&&programPickerField.selectedIndex!=-1&&programPickerField.getValue()){cloneToMarketingProgramId=programPickerField.getValue();}}
var params={};if(programId){params={lpeProgramId:programId};}
else if(cloneToMarketingProgramId){params={cloneToMarketingProgramId:cloneToMarketingProgramId};}
if(isDefined(MktPage.appVars.marketingProgramId)){params.marketingProgramId=MktPage.appVars.marketingProgramId;delete MktPage.appVars.marketingProgramId;var applicationPicker=Ext.getCmp('applicationList');if(applicationPicker&&applicationPicker.selectedIndex!=-1&&applicationPicker.getValue()){var applicationId=applicationPicker.getValue();if(applicationId==3){params.cloneToMarketingProgramId=params.marketingProgramId;}}}
if(mktLPLManager.isValidURL(mf)){MktSession.ajaxRequest('/landingPage/createPageSubmit',{serializeForm:'lpePageSubmitForm',serializeParms:params,onMySuccess:mktLPLManager.createPageDone.createDelegate(this)});}
return false;};mktLPLManager.movePage=function(animEl,pageId,pageName,marketingProgramId){if(marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId},onMySuccess:mktLPLManager.showMoveModal.createDelegate(this,[animEl,pageId,pageName,marketingProgramId])});}
else{mktLPLManager.showMoveModal(animEl,pageId,pageName,marketingProgramId);}};mktLPLManager.showMoveModal=function(animEl,pageId,pageName,marketingProgramId){if(MktPage.appVars.marketingProgramName){pageName=MktPage.appVars.marketingProgramName+"."+pageName;delete MktPage.appVars.marketingProgramName;}
var title='Move';var moveModal=new Mkt.apps.localasset.moveForm({title:title,compName:pageName,iconCls:'mkiTextRichExit',type:'page',submitUrl:'/landingPage/movePageSubmit',compId:pageId,baseParams:{compId:pageId}});moveModal.show();moveModal.submitSuccessCallback=mktLPLManager.moveFormDone;};mktLPLManager.moveFormDone=function(){if(isDefined(MktPage.appVars.opError)){delete MktPage.appVars.opError;return;}
var params={lpgType:'page'};if(MktPage.appVars.moveToMarketingProgramId){params.marketingProgramId=MktPage.appVars.moveToMarketingProgramId;}
if(MktPage.appVars.compId){params.lpgId=MktPage.appVars.compId;}
MktMainNav.loadLanding(params);};mktLPLManager.isValidURL=function(mf){var endsWith=function(haystack,needle){var ix=haystack.lastIndexOf(needle);return((ix!=-1)&&(ix==(haystack.length-needle.length)));};var valid=true;var urlInput=Ext.query('#lpePgUrl',mf.innerEl.dom);if(urlInput.length>0){var value=urlInput[0].value;if(endsWith(value,".html")||endsWith(value,".htm")){MktModalForm.clearMessage();MktModalForm.setMessageError("Please remove the '.html' from the URL It is added automatically");valid=false;}}
return valid;};mktLPLManager.CPLoaded=function(modal){if(isDefined(MktPage.appVars.disableActionBtn)&&MktPage.appVars.disableActionBtn){modal.disableButton(0);}
Mkt.apps.localasset.ComboManager.clearForm('all');mktLPLManager.CPCopier.call(this);};mktLPLManager.CPCopier=function(){this.removeListener('load',mktLPLManager.CPLoaded);var cc=new mktInputCharCounter('lpePgName',null,null,'lpePgUrl',function(str){return str.replace(/[^-_.a-zA-Z0-9]/g,'');});getEl('lpePgUrl').addListener('focus',function(){this.destroy();getEl('lpePgUrl').removeAllListeners();},cc,true);};mktLPLManager.callbackHook=null;mktLPLManager.createPageDone=function(){if(isDefined(MktPage.appVars.createError)){delete MktPage.appVars.createError;delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;return;}
var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var addNodeJsons=MktPage.appVars.addedNodeJsons;if(isDefined(addNodeJsons)){MktExplorer.addNodes(addNodeJsons);delete MktPage.appVars.addedNodeJsons;}
if(isDefined(MktPage.appVars.lplData)){if(isDefined(MktPage.appVars.lplData)){var pageId=MktPage.appVars.lplData.lplData[0].id;}
var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasLP'));if(panel){var gridPanel=panel.getGridPanel();if(gridPanel){gridPanel.addGridRows(MktPage.appVars.lplData.lplData);if(isDefined(MktPage.canvasHook.lplmgr)){var lm=MktPage.canvasHook.lplmgr;if(isDefined(MktPage.appVars.lplData)){if(isDefined(MktPage.appVars.lplData.delData)){lm.deleteGridRows(MktPage.appVars.lplData.delData);}
lm.addGridRow(MktPage.appVars.lplData);}else{if(isObject(MktPage.canvasHook.lpdmgr)){var ld=MktPage.canvasHook.lpdmgr;if(isDefined(ld.dataModel)){ld.addGridRow(MktPage.appVars.lpdData);}}}
lm.selectGridRows(pageId);delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;}else{mktLPLManager.callbackHook=mktLPLManager.createPageNavActivate.createCallback(pageId,false);}}}}else if(isDefined(MktPage.appVars.lpdData)){var pageId=MktPage.appVars.lpdData.lpdData[0].id;}
var lpgId=pageId||MktPage.appVars.pageId||MktPage.appVars.lpOid;if(isDefined(lpgId)){var params={lpgType:'page'};if(MktPage.appVars.marketingProgramId){params.marketingProgramId=MktPage.appVars.marketingProgramId;}
params.lpgId=lpgId;var skipLoadLanding=mktLPLManager.skipLoadLanding();if(!skipLoadLanding){MktMainNav.loadLanding(params);}
else{MktSession.clockCursor(false);}}
if(MktPage.appVars.openEditor){mktLPLManager.openLPEditor(lpgId);}
delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;};mktLPLManager.createPageNavActivate=function(pageId,openEditor){if(isObject(MktPage.canvasHook.lplmgr)){var lm=MktPage.canvasHook.lplmgr;lm.selectGridRows(pageId);if(openEditor){mktLPLManager.openLPEditor(pageId);}}};mktLPLManager.skipLoadLanding=function(){var tabConfig=MktCanvas.getActiveTab().config;var isAssetTab=Mkt.apps.localasset&&Mkt.apps.localasset.Constants.TAB_NAME==tabConfig.id;if(isAssetTab){var isChildOfSameProgram=''+MktPage.appVars.marketingProgramId===''+tabConfig.compId;return isChildOfSameProgram&&!MktPage.appVars.openEditor;}
return false;};mktLPLManager.driveCreateTestModal=function(animEl,fParentId,accessZoneId,marketingProgramId){var parms={};if(isDefined(marketingProgramId)){parms.marketingProgramId=marketingProgramId;}
if(isDefined(fParentId)){parms.fParentId=fParentId;}
if(isDefined(accessZoneId)){parms.accessZoneId=accessZoneId;}
var mp=new MktModalForm({url:'/landingPage/createTestRequest',ajopts:{serializeParms:parms},title:"New Landing Page Test Group",iconCls:'mkiCustAbtest',okButtonTitle:'Create',width:850,height:390});mp.on('load',mktLPLManager.CTLoaded,mp,true);mp.show(animEl,mktLPLManager.submitCreateTest);};mktLPLManager.CTLoaded=function(){MktAppJS.populateSelectBox('lpePgPageFrom',MktPage.appVars.tpAvailable);mktLPLManager.CPCopier.call(this);};mktLPLManager.submitCreateTest=function(mf){if(mktLPLManager.isValidURL(mf)){var selPages=[];var toSel=getEl('lpePgPageTo');for(var ix=0;ix<toSel.dom.options.length;ix++){selPages.push(toSel.dom.options[ix].value);}
var parms={};if(ix>0){parms.selPages=selPages.join(',');}
if(isDefined(MktPage.appVars.marketingProgramId)){parms.marketingProgramId=MktPage.appVars.marketingProgramId;delete MktPage.appVars.marketingProgramId;}
MktSession.ajaxRequest('/landingPage/createTestSubmit',{serializeForm:'lpeTestSubmitForm',serializeParms:parms,onMySuccess:mktLPLManager.createPageDone.createDelegate(this)});}
return false;};mktLPLManager.convertToTestGroup=function(ipId,marketingProgramId){var msg="<div>Your request will convert this landing page into a test group.  The URL for this page will be used as the URL for the test group, and this page will become the first tested page within the test group.<br /><br /> Do you want to continue?</div>";MktMessage.confirm('Convert to Test Group?',msg,'Convert',function(){mktLPLManager.convertConfirm(ipId,marketingProgramId);});};mktLPLManager.convertConfirm=function(ipId,marketingProgramId){var parms={ipId:ipId,marketingProgramId:marketingProgramId};MktSession.ajaxRequest('/landingPage/convertToTest',{serializeParms:parms,onMySuccess:mktLPLManager.convertTGDone.createCallback(ipId)});return false;};mktLPLManager.convertTGDone=function(ipId){try{var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var addNodeJsons=MktPage.appVars.addedNodeJsons;if(isDefined(addNodeJsons)){MktExplorer.addNodes(addNodeJsons);delete MktPage.appVars.addedNodeJsons;}}catch(e){if(isDefined(MktPage.canvasHook.lplmgr)){var lm=MktPage.canvasHook.lplmgr;lm.requestRefreshGrid();}else{}
delete MktPage.appVars.lplData;delete MktPage.appVars.confirmMessage;return;}
var newCTGId=MktPage.appVars.newCTGId;if(isDefined(newCTGId)){if(MktPage.appVars.marketingProgramId){var params={lpgType:'page',marketingProgramId:MktPage.appVars.marketingProgramId};delete MktPage.appVars.marketingProgramId;}
else{var params={lpgType:'page'};}
params.lpgId=newCTGId;MktMainNav.loadLanding(params);delete MktPage.appVars.newCTGId;}
delete MktPage.appVars.lplData;delete MktPage.appVars.confirmMessage;};mktLPLManager.editTGMembersModal=function(tgId,animEl,marketingProgramId){var parms={tgId:tgId,marketingProgramId:marketingProgramId};var mp=new MktModalForm({url:'/landingPage/editTGMembersRequest',ajopts:{serializeParms:parms},title:"Edit Test Group Members",iconCls:'mkiCustAbtestInformation',okButtonTitle:'Select',width:830,height:280});mp.extension=parms;mp.on('load',mktLPLManager.ETGMLoaded,mp,true);mp.show(animEl,mktLPLManager.submitEditTGMembers);};mktLPLManager.ETGMLoaded=function(){MktAppJS.populateSelectBox('lpePgPageFrom',MktPage.appVars.tpAvailable);MktAppJS.populateSelectBox('lpePgPageTo',MktPage.appVars.tpSelected);};mktLPLManager.submitEditTGMembers=function(mf){Ext.MessageBox.show({title:'Please wait...',msg:'Updating group members',progress:true,width:230,closable:false});var selPages=[];var toSel=getEl('lpePgPageTo');for(var ix=0;ix<toSel.dom.options.length;ix++){selPages.push(toSel.dom.options[ix].value);}
var parms={};if(ix>0){parms.selPages=selPages.join(',');}
parms.tgId=mf.extension.tgId;MktSession.ajaxRequest('/landingPage/editTGMembersSubmit',{serializeParms:parms,onMySuccess:mktLPLManager.editTGMembersDone.createCallback(mf)});return false;};mktLPLManager.editTGMembersDone=function(mf){if(isDefined(MktPage.appVars.editError)){delete MktPage.appVars.editError;delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;return;}
var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var addNodeJsons=MktPage.appVars.addedNodeJsons;if(isDefined(addNodeJsons)){MktExplorer.addNodes(addNodeJsons);delete MktPage.appVars.addedNodeJsons;}
if(isDefined(MktPage.canvasHook.lplmgr)){var lm=MktPage.canvasHook.lplmgr;if(isDefined(MktPage.appVars.lplData)){if(isDefined(MktPage.appVars.lplData.delData)){lm.deleteGridRows(MktPage.appVars.lplData.delData);}
lm.addGridRow(MktPage.appVars.lplData);}
if(isObject(MktPage.canvasHook.lpdmgr)){var ld=MktPage.canvasHook.lpdmgr;if((ld.tgId==mf.extension.tgId)&&(isDefined(ld.dataModel))){if(isDefined(MktPage.appVars.lpdData.delData)){ld.deleteGridRows(MktPage.appVars.lpdData.delData);}
ld.addGridRow(MktPage.appVars.lpdData);}}}
delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;};mktLPLManager.doModifyPages=function(action,parms,pageName){switch(action)
{case"deploy":msg="Approving Landing Page";break;case"undeploy":msg="Unapproving Landing Page";break;case"revert":msg="Discarding Landing Page";break;}
Ext.MessageBox.show({title:'Please wait...',msg:msg,progress:true,wait:true,width:245,closable:false});MktSession.ajaxRequest('landingPage/'+action+'PageRequest',{serializeParms:parms,onMySuccess:mktLPLManager.modifyPagesDone.createCallback(action,parms,pageName)});};mktLPLManager.modifyPagesDone=function(action,parms,pageName){MktSession.clockCursor(false);if(MktPage.appVars.result==MktSession.resultFailed){if(MktPage.appVars.redirectInUse){delete MktPage.appVars.redirectInUse;Ext.MessageBox.hide();var pageCount=0;Ext.iterate(parms,function(){pageCount++;});var msg=Mkt.apps.lpSettings.Actions.unapproveConfirmationOneOrMore;if(pageCount<=1){msg=String.format(Mkt.apps.lpSettings.Actions.unapproveConfirmation,pageName);}
parms.skipRedirectCheck=true;MktMessage.showUnapproveConfirmation(msg,mktLPLManager.doModifyPages.createCallback(action,parms),'Unapprove Landing Page?');return;}}
if(isDefined(MktPage.appVars.warningMessage)){MktMessage.show({title:MktPage.appVars.warningTitle||'Warning',msg:MktPage.appVars.warningMessage,icon:'mki48SignForbidden',buttons:[{text:'OK',iconCls:'mkiOk',handler:MktMessage.okClicked}]});delete MktPage.appVars.warningMessage;}
var data;if(MktPage.appVars.lplData&&MktPage.appVars.lplData.lplData.length){data=MktPage.appVars.lplData.lplData;}else if(MktPage.appVars.lpdData&&MktPage.appVars.lpdData.lpdData.length){data=MktPage.appVars.lpdData.lpdData;}
if(data){for(var i=0;i<data.length;i++){mktLPLManager.updateDetailStatus(data[i].id,data[i].status);}}
delete MktPage.appVars.confirmMessage;delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;Ext.MessageBox.hide();};mktLPLManager.updateDetailStatus=function(id,status){var canvas="landingLPDetail";var elId='lpLPDashStatus';var appVarsStatus='lpStatus';var panel=MktCanvas.getItem(MktCanvas.getTab(canvas));if(panel){if(panel.config.compId!=id){return;}
var el=Ext.get(elId);if(el){el.update(mktLPLManager.rndDeployedText(status));}
MktPage.appVars[appVarsStatus]=status;if(panel.publicURLButton){if(status==0){panel.publicURLButton.disable();}else{panel.publicURLButton.enable();}}}};mktLPLManager.doUrlBuilder=function(pageId,animEl){var url='/landingPage/urlBuilder?pageId='+pageId;var mf=new MktModalForm({url:url,title:'URL Builder',iconCls:'mkiWebpageInformation',width:850,height:470,cancelButtonTitle:'Close'});mf.hideButton(0);mf.on('load',mktLPLManager.ubfLoaded,mf);mf.show(animEl);};mktLPLManager.ubfLoaded=function(mf){var qpdata=Ext.util.JSON.decode(MktPage.appVars.qpdata);var trSelect='<tr><td class="mktForm2Label" style="width: 200px;"><input type="checkbox" id="lpeUBFcbdx{0}" checked><label for="lpeUBFcbdx{1}" class="lpeUBFcbLabel" style="top:-2px;">{2}</label></td><td><select id="lpeUBFsldx{3}" style="float:left;"></select></td></tr>';var trStpl=new Ext.Template(trSelect);trStpl.compile();var trText='<tr><td class="mktForm2Label" style="width: 200px;"><input type="checkbox" id="lpeUBFcbdx{0}" checked><label for="lpeUBFcbdx{1}" class="lpeUBFcbLabel" style="top: -2px;">{2}</label></td><td><input id="lpeUBFtdx{3}" type="text" class="mktMedium" style="float:left;"><div id="lpeUBFbtn{0}" style="float:left; margin-top: -1px; margin-left:10px"></div></td></tr>';var trTtpl=new Ext.Template(trText);trTtpl.compile();var trLine2='<tr><td>&nbsp;</td><td style="padding: 0px 0px 0px 4px; color: #666;">Default value: {0}</td></tr>';var trL2tpl=new Ext.Template(trLine2);trL2tpl.compile();var bAppend=Ext.query('#lpeUBFsubtitleRow',mf.innerEl.dom)[0];if(isArray(qpdata.parameters)&&qpdata.parameters.length>0){for(var pdx=0;pdx<qpdata.parameters.length;pdx++){var parm=qpdata.parameters[pdx];if(parm.type=='picklist'){var l1=trStpl.insertAfter(bAppend,[pdx,pdx,parm.field,pdx]);var options=parm.picklist;for(var opdx=0;opdx<options.length;opdx++){var sel=$("lpeUBFsldx"+pdx);sel.options[opdx]=new Option(options[opdx].name,options[opdx].value);}
getEl('lpeUBFsldx'+pdx).on('change',mktLPLManager.ubfDataChanged,{mf:mf,pdx:pdx,qpdata:qpdata});var dval=options[parm.defval].name+' ('+options[parm.defval].value+')';}else{var l1=trTtpl.insertAfter(bAppend,[pdx,pdx,parm.field,pdx]);getEl('lpeUBFtdx'+pdx).on('change',mktLPLManager.ubfDataChanged,{mf:mf,pdx:pdx,qpdata:qpdata});var dval=parm.defval;}
bAppend=trL2tpl.insertAfter(l1,[dval]);getEl('lpeUBFcbdx'+pdx).on('click',mktLPLManager.ubfDataChanged,{mf:mf,pdx:pdx,qpdata:qpdata});var refEl=Ext.get('lpeUBFbtn'+pdx);if(refEl){new Ext.Button({renderTo:refEl,iconCls:'mkiRefresh',text:'Update URL',handler:Ext.emptyFn});}}}else{$('lpeUBFafMessage').innerHTML="No available hidden form fields";}
mktLPLManager.ubfRefreshFullUrl(qpdata);};mktLPLManager.ubfRefreshFullUrl=function(qpdata){var fUrl=$('lpeUBVfullUrl');var fval=qpdata.url;if(isArray(qpdata.parameters)&&qpdata.parameters.length>0){var isFirst=true;for(var pdx=0;pdx<qpdata.parameters.length;pdx++){var cb=$('lpeUBFcbdx'+pdx);if(!cb.checked)continue;if(isFirst){fval+='?';isFirst=false;}else{fval+='&';}
var parm=qpdata.parameters[pdx];fval+=parm.name+'=';if(parm.type=='picklist'){var sel=$('lpeUBFsldx'+pdx);for(var odx=0;odx<sel.options.length;odx++){if(sel.options[odx].selected)break;}
fval+=MktSession.encodeURIComponent(qpdata.parameters[pdx].picklist[odx].value);}else{var txval=$('lpeUBFtdx'+pdx).value;fval+=MktSession.encodeURIComponent(txval);}}}
fval=fUrl.value=fval;};mktLPLManager.ubfDataChanged=function(e,ctx){var mf=ctx.mf||this.mf;var pdx=ctx.pdx||this.pdx;var qpdata=ctx.qpdata||this.qpdata;mktLPLManager.ubfRefreshFullUrl(qpdata);};mktLPLManager.staticConfirmDeleteSelectedPage=function(pageId,pageName,pageStatus,pageType,animEl){if(pageStatus==0){if(pageType=='Landing Page'){var cmsg='Are you sure you want to delete landing page <b>'+pageName+'</b>?';}else{var cmsg='Are you sure you want to delete test group <b>'+pageName+'</b>?';}
var parms={};var pItem='dobjid_'+pageId;parms[pItem]=pItem;MktMessage.confirmDelete('Delete Landing Page?',cmsg,function(){mktLPLManager.doDeletePages(parms,pageId);},animEl);}else{if(pageType=='Landing Page'){var emsg="You cannot delete an approved landing page. Please unapprove it first.";}else{var emsg="You cannot delete an approved test group.  Please unapprove it first.";}
MktMessage.showWarning(emsg,undefined,animEl);return true;}};mktLPLManager.doDeletePages=function(parms,pageId){MktSession.ajaxRequest('landingPage/deletePageRequest',{serializeParms:parms,onMySuccess:mktLPLManager.deletePagesDone.createCallback(pageId)});return true;};mktLPLManager.deletePagesDone=function(delId){if(isDefined(MktPage.appVars.warningMessage)){MktMessage.showWarning(MktPage.appVars.warningMessage);delete MktPage.appVars.warningMessage;}
if(isDefined(MktPage.canvasHook.lplmgr)&&isDefined(MktPage.appVars.lplData)){var lm=MktPage.canvasHook.lplmgr;lm.dOids=[delId];lm.deleteObjectsDone.call(lm);}else if(isDefined(MktPage.canvasHook.lpdmgr)&&isDefined(MktPage.appVars.lpdData)){var ld=MktPage.canvasHook.lpdmgr;ld.dOids=[delId];ld.deleteObjectsDone.call(ld);}
var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasLP'));if(panel){var grid=panel.getGridPanel();if(grid){panel.getGridPanel().deleteGridRows(delId);}}
var detailTabId=MktCanvas.getTab('landingLPDetail');var detailPanel=MktCanvas.getItem(detailTabId);if(detailPanel){var deletedOids=MktPage.appVars.deletedOids;for(var i=0;i<deletedOids.length;i++){if(detailPanel.config.compId==deletedOids[i]){MktCanvas.remove(detailTabId);break;}}}
if(isDefined(MktPage.appVars.marketingProgramId)&&MktPage.appVars.marketingProgramId!=null&&MktCanvas.getActiveTab().config.id=='landingLPDetail'){var context={};MktMainNav.loadMA(context);}
delete MktPage.appVars.marketingProgramId;delete MktPage.appVars.lplData;delete MktPage.appVars.deletedOids;};function mktLPFManager(){var LPFschema={root:'lpfData',id:'fmId',fields:['fmName','fmInUseBy','fmUpdated']};var LPFcolConfig=[{header:"Name",useCSSAsMinWidth:true,allocatePct:60,resizable:true,sortable:true},{header:"Used by Pages",useCSSAsMinWidth:true,allocatePct:40,resizable:true,sortable:true,renderer:this.rndInUseBy.createDelegate(this)},{header:"Last Updated",useCSSWidth:true,resizable:false,sortable:true,renderer:this.rndDateTime.createDelegate(this)}];this.treeNodeType=4;this.treePfx='lpf_';this.oPfx='fm';this.oTypeText='form';this.panelIdOverview='landingCanvasFO';this.panelIdDetail='landingFODetail';this.instanceName='lpfmgr';mktLPFManager.superclass.constructor.call(this,'lpfGrid',LPFschema,LPFcolConfig);this.newTB=new mktToolbarButton('mlpTBNewFO',this.tbNewSelected.createDelegate(this,['mlpTBNewFO']));this.newTBd=null;this.editTB=new mktToolbarButton('mlpTBEditFO',this.tbEditSelected.createDelegate(this));this.editTBd=null;this.detailsTB=new mktToolbarButton('mlpTBDetailsFO',this.tbDetailsSelected.createDelegate(this));}
Ext.extend(mktLPFManager,mktLandingManager,{});mktLPFManager.prototype.requestRefreshGrid=function(){mktLPFManager.superclass.requestRefreshGrid.call(this,'landingPage/refreshFormGrid');};mktLPFManager.prototype.showDetailPanel=function(oid){mktLPFManager.superclass.showDetailPanel.call(this,oid,'form');};mktLPFManager.prototype.tbNewSelected=function(tbId){mktLPFManager.driveCreateFormModal(getEl(tbId));};mktLPFManager.prototype.tbEditSelected=function(){var formIds=this.getTargets();var rdx=this.dataModel.getRowIndexById(formIds[0]);var formName=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('fmName'));mktLPFManager.openFormEditor(formIds[0],formName);};mktLPFManager.prototype.tbDetailsSelected=function(){MktMainNav.loadLanding({lpgType:'form',lpgId:this.getTargets()[0]});};mktLPFManager.prototype.selectionChanged=function(selModel,rows,ids){if(ids.length==0){this.editTB.doDisable();this.detailsTB.doDisable();}else if(ids.length==1){this.editTB.doEnable();this.detailsTB.doEnable();}else{this.editTB.doDisable();this.detailsTB.doDisable();}};mktLPFManager.prototype.rndInUseBy=function(val){if(!(val instanceof Array))return'';if(val.length==0)return'Not used';var maxToShow=3;var rv='';var first=true;for(var ix=0;ix<val.length;ix++){if(ix==(maxToShow-1))break;if(!first)rv+=', ';rv+=val[ix].lpName;first=false;}
var leftToShow=val.length-ix;if(leftToShow==1){rv+=', '+val[maxToShow-1].lpName;}else if(leftToShow>1){var first=true;var tip='';for(var jx=ix;jx<val.length;jx++){if(!first)tip+=', ';tip+=val[jx].lpName;first=false;}
rv+='<span class="mktMoreTip" title="'+tip+'">, ('+leftToShow+' more)</span>';}
return rv;};mktLPFManager.driveCreateFormModal=function(animEl,cloneFromId,formName,parentId,accessZoneId,marketingProgramId){var iconCls=null;if(cloneFromId&&marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId,accessZoneId:accessZoneId},onMySuccess:mktLPFManager.showCreateModal.createDelegate(this,[animEl,cloneFromId,formName,parentId,accessZoneId,marketingProgramId])});}
else{mktLPFManager.showCreateModal(animEl,cloneFromId,formName,parentId,accessZoneId,marketingProgramId);}};mktLPFManager.showCreateModal=function(animEl,cloneFromId,formName,parentId,accessZoneId,marketingProgramId){if(cloneFromId!=null){var title="Clone to Form";var fht=400;if(MktPage.appVars.marketingProgramName){formName=MktPage.appVars.marketingProgramName+"."+formName;}
iconCls='mkiFormBlueAdd';}else{var title="New Form";var fht=310;iconCls='mkiFormBlue';}
var tabIndex=1;var html='<div id="lpeFormEditForm">'+'  <form id="lpeFormSubmitForm" onsubmit="return false;">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <input type="hidden" id="parentId" name="parentId" value="" />'+'      <input type="hidden" id="accessZoneId" name="accessZoneId" value="'+accessZoneId+'" />'+'      <tr id="lpeFmCloneRow" class="" style="display:none;">'+'        <td class="mktForm2Label">From Form:</td>'+'        <td class="mktForm2Field">'+'        </td>'+'      </tr>';if(cloneFromId){html+='      <tr id="applicationRow" class="mktRequired">'+'        <td class="mktForm2Label">Clone To:</td>'+'        <td class="mktForm2Field" id="appPicker">'+'          <div class="message"></div>'+'        </td>'+'      </tr>';tabIndex=tabIndex+2;}
html+='      <tr class="mktRequired">'+'        <td class="mktForm2Label">New Form Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" id="lpeFmName" name="lpeFmName" tabIndex = "'+tabIndex+++'" value="" title="Form Name" maxlength="240"/>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" name="lpeFmDescr"  tabIndex = "'+tabIndex+++'" title="Description" rows="4"></textarea>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="">'+'        <td class="mktForm2Label">&nbsp;</td>'+'        <td class="mktForm2Field">'+'            <input type="checkbox" class="mktCheckbox"  tabIndex = "'+tabIndex+++'" checked="checked" id="lpeFmOpenEditor" name="lpeFmOpenEditor" />'+'            <label for="lpeFmOpenEditor">Open form editor for new form</label>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>';var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,html);},title:title,iconCls:iconCls,okButtonTitle:'Create',width:655,height:fht});mp.on('load',mktLPFManager.createFormLoaded,mp,true);mp.extension={};if(cloneFromId!=null){mp.extension.cloneFromId=cloneFromId;}
if(hasValue(parentId)){mp.extension.parentId=parentId;}
if(hasValue(accessZoneId)){mp.extension.accessZoneId=accessZoneId;}
if(hasValue(formName)){mp.extension.formName=formName;}
if(marketingProgramId){mp.marketingProgramId=marketingProgramId;}
mp.show(animEl,mktLPFManager.submitCreateForm);};mktLPFManager.showProgramPicker=function(mp){var programPickerBox=Mkt.apps.localasset.ComboManager.cloneProgramPicker({});programPickerBox.el.dom.setAttribute('tabIndex',2);programPickerBox.on('select',function(combo,object){mp.cloneToMarketingProgramId=object.data.programId;});};mktLPFManager.showFolderPicker=function(mp){var folderPickerBox=Mkt.apps.localasset.ComboManager.cloneFolderPicker({compType:'form'});folderPickerBox.el.dom.setAttribute('tabIndex',2);folderPickerBox.on('select',function(combo,object,index){getEl('parentId').dom.value=object.data.id;mp.extension.parentId=object.data.id;});};mktLPFManager.createFormLoaded=function(mp){var cloneFromId=mp.extension.cloneFromId;var parentId=mp.extension.parentId;var formName=mp.extension.formName;var accessZoneId=mp.extension.accessZoneId;Mkt.apps.localasset.ComboManager.clearForm('all');if(cloneFromId){var dataStore=[[1,'Design Studio...']];if(MktPage.savedState.marketingProgramEnabled||MktPage.savedState.marketingEventEnabled){if(mp.marketingProgramId){dataStore.push([2,'A Different Program...']);dataStore.push([3,'Same Program']);}
else{dataStore.push([2,'A Program...']);}}
var appPickerBox=Mkt.apps.localasset.ComboManager.applicationPicker({dataStore:dataStore,renderTo:'appPicker'});appPickerBox.el.dom.setAttribute('tabIndex',1);appPickerBox.focus();appPickerBox.on('select',function(combo,object,index){var wasProgramVisible=false,setProgramVisible=false;var wasFolderVisible=false,setFolderVisible=false;if(Ext.getCmp('cloneToProgramPicker')&&Ext.getCmp('cloneToProgramPicker').isVisible()){wasProgramVisible=true;}
if(Ext.getCmp('cloneToFolderPicker')&&Ext.getCmp('cloneToFolderPicker').isVisible()){wasFolderVisible=true;}
if(object.data&&object.data.value==2){setProgramVisible=true;}
else if(object.data&&object.data.value==1){setFolderVisible=true;}
if(setProgramVisible&&!wasProgramVisible){mktLPFManager.showProgramPicker(mp);}
else if(setFolderVisible&&!wasFolderVisible){mktLPFManager.showFolderPicker(mp);parentId=mp.extension.parentId}
if(Ext.getCmp('cloneToProgramPicker')&&!setProgramVisible){Mkt.apps.localasset.ComboManager.clearForm('program');}
if(Ext.getCmp('cloneToFolderPicker')&&!setFolderVisible){Mkt.apps.localasset.ComboManager.clearForm('folder');}
if(object.data&&object.data.value==3){mp.cloneToMarketingProgramId=mp.marketingProgramId;}});}
var cloneRow=getEl('lpeFmCloneRow');if(hasValue(cloneFromId)){cloneRow.getChildrenByTagName('td')[1].innerHTML=formName;cloneRow.enableDisplayMode().setVisible(true);}else{cloneRow.enableDisplayMode().setVisible(false);}
var fParentEl=Ext.getDom('parentId');if(isDefined(fParentEl)&&hasValue(parentId)){fParentEl.value=parentId;}
var accessZoneEl=Ext.getDom('accessZoneId');if(isDefined(accessZoneEl)&&hasValue(accessZoneId)){accessZoneEl.value=accessZoneId;}};mktLPFManager.submitCreateForm=function(mp){MktSession.clockCursor(true);var parms={};if(isDefined(mp.extension.cloneFromId)){parms.lpeFmFromId=mp.extension.cloneFromId;}
if(mp.cloneToMarketingProgramId){parms.cloneToMarketingProgramId=mp.cloneToMarketingProgramId;}
if(mp.marketingProgramId){parms.marketingProgramId=mp.marketingProgramId;}
MktSession.ajaxRequest('/landingPage/createFormSubmit',{serializeForm:'lpeFormSubmitForm',serializeParms:parms,onMySuccess:mktLPFManager.createFormDone.createDelegate(this)});return false;};mktLPFManager.callbackHook=null;mktLPFManager.createFormDone=function(){if(isDefined(MktPage.appVars.createError)){delete MktPage.appVars.createError;return;}
var formId=MktPage.appVars.lpfData.lpfData[0].id;var formName=MktPage.appVars.lpfData.lpfData[0].name;if(isDefined(MktPage.appVars.lpfData)){var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasFO'));if(panel){var grid=panel.getGridPanel();if(grid){panel.getGridPanel().addGridRows(MktPage.appVars.lpfData.lpfData);}}}
if(hasValue(formId)&&hasValue(formName)){var params={lpgType:'form',lpgId:formId};if(MktPage.appVars.marketingProgramId){params.marketingProgramId=MktPage.appVars.marketingProgramId;}
var skipLoadLanding=mktLPFManager.skipLoadLanding();if(!skipLoadLanding){MktMainNav.loadLanding(params);}
else{MktSession.clockCursor(false);}
if(MktPage.appVars.openEditor){mktLPFManager.openFormEditor(formId,formName);}}
var result=MktPage.appVars.newFormResult;if(isDefined(result)){if(result=="success"){}else{}
delete MktPage.appVars.newFormResult;}};mktLPFManager.moveForm=function(formId,formName,marketingProgramId){if(marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId},onMySuccess:mktLPFManager.showMoveModal.createDelegate(this,[formId,formName,marketingProgramId])});}
else{mktLPFManager.showMoveModal(formId,formName,marketingProgramId);}};mktLPFManager.showMoveModal=function(formId,formName,marketingProgramId){if(MktPage.appVars.marketingProgramName){formName=MktPage.appVars.marketingProgramName+"."+formName;delete MktPage.appVars.marketingProgramName;}
var title='Move';var moveModal=new Mkt.apps.localasset.moveForm({title:title,iconCls:"mkiFormBlueExit",compName:formName,type:'form',submitUrl:'/landingPage/moveFormSubmit',baseParams:{compId:formId}});moveModal.show();moveModal.submitSuccessCallback=mktLPFManager.moveFormDone;};mktLPFManager.moveFormDone=function(){if(isDefined(MktPage.appVars.opError)){delete MktPage.appVars.opError;return;}
var params={lpgType:'form'};if(MktPage.appVars.moveToMarketingProgramId){params.marketingProgramId=MktPage.appVars.moveToMarketingProgramId;}
if(MktPage.appVars.compId){params.lpgId=MktPage.appVars.compId;}
MktMainNav.loadLanding(params);};mktLPFManager.createFormNavActivate=function(formId,openEditor){if(isObject(MktPage.canvasHook.lpfmgr)){var lf=MktPage.canvasHook.lpfmgr;lf.selectGridRows(formId);if(openEditor){var rdx=lf.dataModel.getRowIndexById(formId);var formName=lf.dataModel.getValueAt(rdx,lf.schema.fields.indexOf('fmName'));mktLPFManager.openFormEditor(formId,formName);}}};mktLPFManager.skipLoadLanding=mktLPLManager.skipLoadLanding;mktLPFManager.refreshTemplates=function(doFormAsWell){Ext.MessageBox.show({title:'Please wait...',msg:'Refreshing form information',progress:true,width:230,closable:false});if(doFormAsWell){MktSession.ajaxRequest('landingPage/refreshFormTemplates?includeForm=1',{onMySuccess:mktLPFManager.refreshTemplatesDone});}else{MktSession.ajaxRequest('landingPage/refreshFormTemplates?includeForm=0',{onMySuccess:mktLPFManager.refreshTemplatesDone});}};mktLPFManager.refreshTemplatesDone=function(){if(isObject(MktPage.canvasHook.lpfmgr)){if(isDefined(MktPage.appVars.lpfData)){var lf=MktPage.canvasHook.lpfmgr;lf.addGridRow(MktPage.appVars.lpfData);delete MktPage.appVars.lpfData;}}};mktLPFManager.openFormEditor=function(formId,formName){var url=MktSession.getUrlPrefix()+"/lobeditor/formEdit?";var params={lpgObjType:'form',lpgObjAction:'edit',lpgObjId:formId,lpgObjName:formName};url+=Ext.urlEncode(params);var newWind=window.open(url,"_blank","width=1024, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktLPFManager.staticConfirmDeleteForm=function(formId,formName,animEl){var cmsg='Are you sure you want to delete <b>'+formName+'</b>?';var parms={};var dItem='dobjid_'+formId;parms[dItem]=dItem;MktMessage.confirmDelete('Delete Form?',cmsg,function(){mktLPFManager.doDeleteForm(parms,formId);},animEl);return false;};mktLPFManager.doDeleteForm=function(parms,delId){MktSession.ajaxRequest('landingPage/deleteFormRequest',{serializeParms:parms,onMySuccess:mktLPFManager.deleteFormDone.createCallback(delId)});return true;};mktLPFManager.deleteFormDone=function(delId){if(isDefined(MktPage.canvasHook.lpfmgr)){var lf=MktPage.canvasHook.lpfmgr;lf.dOids=[delId];lf.deleteObjectsDone.call(lf);}
var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var deletedOids=MktPage.appVars.deletedOids;var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasFO'));if(panel){var grid=panel.getGridPanel();if(grid&&deletedOids){grid.deleteGridRows(deletedOids);}}
var tabId=MktCanvas.getTab('landingFODetail');var tab=MktCanvas.getItem(tabId);if(tab&&deletedOids){if(deletedOids.indexOf(tab.config.cHData)){MktCanvas.remove(tabId);}}};function mktLPIManager(){var LPIschema={root:'lpiData',id:'imId',fields:['imName','imInUseBy','imUpdated','imURL']};var LPIcolConfig=[{header:"Name",useCSSAsMinWidth:true,allocatePct:60,resizable:true,sortable:true},{header:"Used by Pages",useCSSAsMinWidth:true,allocatePct:40,resizable:true,sortable:true,renderer:this.rndInUseBy.createDelegate(this)},{header:"Last Updated",useCSSWidth:true,resizable:false,sortable:true,renderer:this.rndDateTime.createDelegate(this)}];this.treeNodeType=5;this.treePfx='lpi_';this.oPfx='im';this.oTypeText='image';this.panelIdOverview='landingCanvasIM';this.panelIdDetail='landingIMDetail';this.instanceName='lpimgr';mktLPIManager.superclass.constructor.call(this,'lpiGrid',LPIschema,LPIcolConfig);this.uploadTB=new mktToolbarButton('mlpTBUploadIM',this.tbUploadSelected.createDelegate(this,['mlpTBUploadIM']));this.uploadTBd=null;this.previewTB=new mktToolbarButton('mlpTBPreviewIM',this.tbPreviewSelected.createDelegate(this));this.previewTBd=null;this.detailsTB=new mktToolbarButton('mlpTBDetailsIM',this.tbDetailsSelected.createDelegate(this));}
Ext.extend(mktLPIManager,mktLandingManager,{});mktLPIManager.prototype.requestRefreshGrid=function(){mktLPIManager.superclass.requestRefreshGrid.call(this,'landingPage/refreshImageGrid');};mktLPIManager.prototype.showDetailPanel=function(oid){mktLPIManager.superclass.showDetailPanel.call(this,oid,'image');};mktLPIManager.prototype.viewImage=function(){var imId=this.getTargets()[0];var rdx=this.dataModel.getRowIndexById(imId);var imURL=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('imURL'));mktLPIManager.staticViewImage(imId,imURL);};mktLPIManager.prototype.tbUploadSelected=function(tbId){mktLPIManager.uploadImageRequest(null,getEl(tbId),true);};mktLPIManager.prototype.tbPreviewSelected=function(){this.viewImage();};mktLPIManager.prototype.tbDetailsSelected=function(){MktMainNav.loadLanding({lpgType:'image',lpgId:this.getTargets()[0]});};mktLPIManager.prototype.selectionChanged=function(selModel,rows,ids){if(ids.length==0){this.previewTB.doDisable();this.detailsTB.doDisable();}else if(ids.length==1){this.previewTB.doEnable();this.detailsTB.doEnable();}else{this.previewTB.doDisable();this.detailsTB.doDisable();}};mktLPIManager.prototype.rndImageURL=function(val){return val;};mktLPIManager.fetchImagesRequest=function(e,animEl,app,parentId,accessZoneId,folderName){folderName=folderName||'Images and Files';var ac=0;var accessZoneIdMarkup="";if(isDefined(app))ac=1;if(!isDefined(parentId))parentId=0;if(isDefined(accessZoneId)){accessZoneIdMarkup='    <input type="hidden" id="accessZoneId" name="accessZoneId" value="" />';}
var homepage='www.example.com';if(MktPage&&MktPage.savedState){homepage=MktPage.savedState.companyHomePage;}
var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div>'+'<img src="/images/spacer.gif" class="mktPanelWatermark256 mki256HandGrab2" style="top: 0px; right: 0px;">'+'<form name="lpeFetchImagesForm" id="lpeFetchImagesForm" class="lpeFetchImagesForm">'+'  <div class="mktTopPanel">'+'    <h1>Grab Images from Webpage</h1>'+'    <h3>Enter the URL of the website and click <b>next</b>:</h3>'+'    <input type="text" name="inputUrl" id="inputUrl" value="" size="80" tabindex="1" class="mktMedium" />'+'    <input type="hidden" id="parentId" name="parentId" value="" />'+
accessZoneIdMarkup+'  </div>'+'  <div class="mktTopPanel">'+'    <h3> Images will be loaded into the folder named "'+folderName+'"</h3>'+'  </div>'+'</form>'+'</div>');},title:'Grab Images from Webpage',iconCls:'mkiHandGrab2',okButtonTitle:'Next',extension:{stage:0,appCtx:ac,parentId:parentId,accessZoneId:accessZoneId},width:850,height:520});dialog.on('okclick',mktLPIManager.fetchImagesSubmit,dialog,true);dialog.on('cancelclick',mktLPIManager.fetchImageDone,dialog,true);dialog.on('load',function(dialog){var parentId=dialog.extension.parentId;var fParentEl=Ext.getDom('parentId');if(isDefined(fParentEl)&&hasValue(parentId)){fParentEl.value=parentId;}
var accessZoneId=dialog.extension.accessZoneId;var fAccessZoneEl=Ext.getDom('accessZoneId');if(isDefined(fAccessZoneEl)&&hasValue(accessZoneId)){fAccessZoneEl.value=accessZoneId;}},dialog,true);dialog.show(animEl);};mktLPIManager.getMyForm=function(dialog){var panel=Ext.get(dialog.innerEl);if(panel==null){var panel=dialog.dlg.getLayout().getRegion('center').getActivePanel();}
return MktUtil.getFirstElementByClassName('lpeFetchImagesForm','form',panel.dom);};mktLPIManager.fetchImagesSubmit=function(dialog){var form=mktLPIManager.getMyForm(dialog);if(dialog.extension.stage==0){options={serializeForm:form,onMySuccess:mktLPIManager.fetchImagesFirstSubmitDone.createDelegate(dialog,null,true)};MktSession.ajaxRequest('lpeditor/fetchImagesRequest',options);dialog.showProgress({title:"Processing web page...",clearContents:true});}else if(dialog.extension.stage==1){options={serializeForm:form,serializeParms:{appCtx:dialog.extension.appCtx,parentId:dialog.extension.parentId},onMySuccess:mktLPIManager.fetchImagesSecondSubmitDone.createDelegate(dialog,null,true)};MktSession.ajaxRequest('lpeditor/fetchImagesSubmit',options);dialog.showProgress({title:"Processing selected images...",clearContents:true});}else{dialog.close();mktLPIManager.fetchImageDone.call(dialog);}};mktLPIManager.fetchImagesFirstSubmitDone=function(jsonObject,ajaxOptions){if(isDefined(MktPage.appVars.submitError)){delete MktPage.appVars.submitError;this.loaded=false;this.load();return;}
MktModalForm.clearMessage();var content=jsonObject.HTMLResults.fetchImagesResults;this.dlg.getUpdater().getEl().update(content,true);this.extension.stage=1;};mktLPIManager.fetchImagesSecondSubmitDone=function(jsonObject,ajaxOptions){if(isDefined(jsonObject.JSONResults.isError)&&jsonObject.JSONResults.isError){}else{MktModalForm.clearMessage();var content=jsonObject.HTMLResults.fetchImagesSubmit;this.dlg.getUpdater().getEl().update(content,true);this.extension.stage=2;this.setButtonText(1,'Close');this.buttons[0].hide();if(this.extension.appCtx==1){var newNodes=MktPage.appVars.imagesNodesJson;if(isDefined(newNodes)){MktExplorer.addNodes(newNodes);delete MktPage.appVars.imagesNodesJson;}
if(isObject(MktPage.canvasHook.lpimgr)){var li=MktPage.canvasHook.lpimgr;li.addGridRow(MktPage.appVars.lpiData);delete MktPage.appVars.lpiData;}}}};mktLPIManager.fetchImageDone=function(){mktLPIManager.uploadImageDone();};mktLPIManager.uploadImageRequest=function(e,animEl,app,fParentId,folderName,replaceAction){var ac=0;if(isDefined(app))ac=1;folderName=folderName||'Images and Files';var replaceFile='';var replaceWarning='';var overwriteChkBox='';var imId=0;if(replaceAction){Ext.apply(replaceAction,{appVarsName:'lpDetailTitle',appVarsId:'lpOid',appVarsUrl:'imURL'});sels=Mkt.util.Common.getSelections(replaceAction);replaceFile=sels[0].name;imId=sels[0].id;actInfo='Replace file "'+replaceFile+'"';actIcon='mkiDocumentExchange';actNote='<img src="/images/icons32/sign_warning.png" style="float:left; margin-right: 10px; ">'+'<h3 style="padding-top: 4px;"> Replaced file will be live on your landing pages and emails immediately</h3>';actBtnLabel='Replace';}else{actInfo='Upload image or file';actIcon='mkiDocumentUp';actNote='<h3>File will be loaded into the folder named "'+folderName+'"</h3>';actBtnLabel='Upload';overwriteChkBox='        <br/><br/><input type="checkbox" class="mktCheckbox" tabindex="2" id="imOverwrite" name="imOverwrite" style="margin-left: 10px; margin-right: 3px; vertical-align: text-middle" />'+'        <label for="imOverwrite" style="font: 14px arial; color: #666666; vertical-align: middle">Replace existing file</label>';}
var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div>'+'  <form action="/lpeditor/uploadImageSubmit" method="post" enctype="multipart/form-data" name="lpeUploadImageForm" id="lpeUploadImageForm" class="lpeUploadImageForm" target="lpeUploadImageIframe">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'      <div class="lpeUploadFileInput" style="display:block;">'+'        <div class="mktTopPanel">'+'          <h1>'+actInfo+'</h1>'+'          <h3>Click Browse to choose the file to upload</h3>'+'        </div>'+'        <input type="file" name="uploaded_file" tabindex="1" id="uploaded_file" value="" size="60" style="margin-left: 10px;" class="mktFileUpload" />'+'        <input type="hidden" id="uploadImagefParentId" name="uploadImagefParentId" value="" />'+
overwriteChkBox+'        <input type="hidden" id="replace_file" name="replace_file" value="'+replaceFile+'" />'+'        <input type="hidden" id="xsrfId" name="xsrfId" value="'+MktSecurity.getXsrfId()+'" />'+'        <br>'+'        <div class="mktTopPanel">'+actNote+'</div>'+'      </div>'+'      <div class="lpeUploadImageDiv"></div>'+'  </form>'+'</div>');},title:actBtnLabel+' Image or File',iconCls:actIcon,extension:{submitted:false,appCtx:ac,fParentId:fParentId,isReplace:replaceFile,imageId:0},okButtonTitle:actBtnLabel,width:700,height:480});dialog.on('okclick',mktLPIManager.uploadImageSubmit,dialog,true);dialog.on('load',mktLPIManager.uploadImageRequestLoaded,dialog,true);dialog.show(animEl);};mktLPIManager.uploadImageRequestLoaded=function(dialog){var panel=Ext.get(dialog.innerEl);if(!panel){var panel=dialog.dlg.getLayout().getRegion('center').getActivePanel();}
var fParentEl=Ext.getDom('uploadImagefParentId');var fParentId=dialog.extension.fParentId;if(isDefined(fParentEl)&&isDefined(fParentId)){fParentEl.value=fParentId;}
dialog.extension.form=MktUtil.getFirstElementByClassName('lpeUploadImageForm','form',panel.dom);var iframeDiv=document.createElement('div');Ext.get(iframeDiv).setStyle({display:'none'});iframeDiv.innerHTML='<iframe src="about:blank" name="lpeUploadImageIframe" id="lpeUploadImageIframe" '+'class="lpeUploadImageIframe" style="display:none;"></iframe>';dialog.extension.form.appendChild(iframeDiv);dialog.extension.iframe=MktUtil.getFirstElementByClassName('lpeUploadImageIframe','iframe',dialog.extension.form);dialog.extension.div=MktUtil.getFirstElementByClassName('lpeUploadImageDiv','div',panel.dom);dialog.extension.file=MktUtil.getFirstElementByClassName('lpeUploadFileInput','div',panel.dom);Ext.get(dialog.extension.iframe).on('load',function(e){mktLPIManager.uploadImageSubmitDone(e,this);},dialog);};mktLPIManager.uploadImageSubmit=function(dialog){if(dialog.extension.form.elements["uploaded_file"].value==''){MktSession.setModalFormError("Please select a file to upload");return;}
dialog.extension.submitted=true;dialog.extension.form.submit();};mktLPIManager.uploadImageSubmitDone=function(e,dialog){if(dialog.extension.submitted==true){var myIframe=MktUtil.findFrame('lpeUploadImageIframe');if(myIframe!=null){dialog.extension.div.innerHTML=myIframe.document.body.innerHTML;var imIdDivs=myIframe.document.getElementById('lastUploadedIMId');if(imIdDivs){dialog.extension.imageId=imIdDivs.textContent;}}
var scriptEl=Ext.getDom('uploadImageScript');if(scriptEl){eval(scriptEl.innerHTML);}
dialog.extension.file.style.display='none';dialog.setButtonText(1,"Done");if(dialog.extension.appCtx==1){dialog.on('cancelclick',mktLPIManager.uploadImageDone,dialog,true);}
if(dialog.extension.isReplace){dialog.hideButton(0);dialog.removeListener('okclick',mktLPIManager.uploadImageSubmit);}
else{dialog.setButtonText(0,"Upload Another");dialog.removeListener('okclick',mktLPIManager.uploadImageSubmit);dialog.on('okclick',mktLPIManager.uploadImageAnother,dialog,true);}}};mktLPIManager.uploadImageAnother=function(){$('mktModalInner').innerHTML='';this.removeListener('okclick',mktLPIManager.uploadImageAnother);this.on('okclick',mktLPIManager.uploadImageSubmit,this,true);this.setButtonText(0,"Upload");this.extension.submitted=false;this.loaded=false;this.load();};mktLPIManager.uploadImageDone=function(dialog){if(typeof MktCanvas!='undefined'){var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasIM'));var tab=MktCanvas.getActiveTab();if(tab){var idIMDetail='cp_landingIMDetail';if(tab.getId()==idIMDetail&&dialog.extension.imageId>0){MktMainNav.loadLanding({type:'Landing',subType:'image',lpgId:dialog.extension.imageId,id:dialog.extension.imageId});}}
if(panel){var grid=panel.getGridPanel();if(grid){grid.getStore().reload();}}}};mktLPIManager.staticConfirmDeleteImage=function(imageId,imageName,animEl){var cmsg='Are you sure you want to delete <b>'+imageName+'</b>?';var parms={};var dItem='dobjid_'+imageId;parms[dItem]=dItem;MktMessage.confirmDelete('Delete File?',cmsg,function(){mktLPIManager.doDeleteImage(parms,imageId);},animEl);return false;};mktLPIManager.doDeleteImage=function(parms,imageId){MktSession.ajaxRequest('landingPage/deleteImageRequest',{serializeParms:parms,onMySuccess:mktLPIManager.deleteImageDone.createCallback(imageId)});return true;};mktLPIManager.deleteImageDone=function(delId){if(isDefined(MktPage.canvasHook.lpimgr)){var li=MktPage.canvasHook.lpimgr;li.dOids=[delId];li.deleteObjectsDone.call(li);}
var delNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(delNodeIds)){MktExplorer.removeNodes(delNodeIds);delete MktPage.appVars.deletedNodeIds;}
var deletedOids=MktPage.appVars.deletedOids;var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasIM'));if(panel){var grid=panel.getGridPanel();if(grid&&deletedOids){grid.deleteGridRows(deletedOids);}}
var tabId=MktCanvas.getTab('landingIMDetail');var tab=MktCanvas.getItem(tabId);if(tab&&deletedOids){if(deletedOids.indexOf(tab.config.cHData)){MktCanvas.remove(tabId);}}};mktLPIManager.moveImageDone=function(){MktSession.clockCursor(false);var movedIds=MktPage.appVars.movedIds;var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasIM'));if(panel&&isDefined(movedIds)){var grid=panel.getGridPanel();if(grid&&movedIds){grid.deleteGridRows(movedIds);}}
var tabId=MktCanvas.getTab('landingIMDetail');var tab=MktCanvas.getItem(tabId);if(tab&&deletedOids){if(deletedOids.indexOf(tab.config.cHData)){MktCanvas.remove(tabId);}}};mktLPIManager.staticViewImage=function(imageId,imageURL){var newWind=window.open(imageURL,"_blank","width=800, height=600, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");return true;};function mktLPTManager(){var LPTschema={root:'lptData',id:'tmId',fields:['tmName','tmInUseBy','tmUpdated']};var LPTcolConfig=[{header:"Name",useCSSAsMinWidth:true,allocatePct:60,resizable:true,sortable:true},{header:"Used by Pages",useCSSAsMinWidth:true,allocatePct:40,resizable:true,sortable:true,renderer:this.rndInUseBy.createDelegate(this)},{header:"Last Updated",useCSSWidth:true,resizable:false,sortable:true,renderer:this.rndDateTime.createDelegate(this)}];this.treeNodeType=3;this.treePfx='lpt_';this.oPfx='tm';this.oTypeText='template';this.panelIdOverview='landingCanvasTM';this.panelIdDetail='landingTMDetail';this.instanceName='lptmgr';mktLPTManager.superclass.constructor.call(this,'lptGrid',LPTschema,LPTcolConfig);this.importTB=new mktToolbarButton('mlpTBImportTM',this.tbImportSelected.createDelegate(this,['mlpTBImportIM']));this.importTBd=null;this.exportTB=new mktToolbarButton('mlpTBExportTM',this.tbExportSelected.createDelegate(this));this.exportTBd=null;this.detailsTB=new mktToolbarButton('mlpTBDetailsTM',this.tbDetailsSelected.createDelegate(this));}
Ext.extend(mktLPTManager,mktLandingManager,{});mktLPTManager.prototype.requestRefreshGrid=function(){mktLPTManager.superclass.requestRefreshGrid.call(this,'landingPage/refreshTemplateGrid');};mktLPTManager.prototype.driveDownloadTemplate=function(tid){getEl('lptDLId').dom.value=tid;MktPage.preventNavAway(false);document.lptDLForm.submit();MktPage.preventNavAway(true);};mktLPTManager.prototype.showDetailPanel=function(oid){mktLPTManager.superclass.showDetailPanel.call(this,oid,'template');};mktLPTManager.prototype.tbImportSelected=function(tbId){mktLPTManager.driveUploadTemplate(getEl(tbId));};mktLPTManager.prototype.tbExportSelected=function(){this.driveDownloadTemplate(this.getTargets()[0]);};mktLPTManager.prototype.tbDetailsSelected=function(){MktMainNav.loadLanding({lpgType:'template',lpgId:this.getTargets()[0]});};mktLPTManager.prototype.selectionChanged=function(selModel,rows,ids){if(ids.length==0){this.exportTB.doDisable();this.detailsTB.doDisable();}else if(ids.length==1){this.exportTB.doEnable();this.detailsTB.doEnable();}else{this.exportTB.doDisable();this.detailsTB.doDisable();}};mktLPTManager.driveUploadTemplate=function(animEl,parentId,accessZoneId){var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div>'+'  <form action="/landingPage/uploadTemplate" method="post" enctype="multipart/form-data" name="lptUploadTemplateForm" id="lptUploadTemplateForm" class="lptUploadTemplateForm" target="lptUploadTemplateIframe">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">File Name:</td>'+'        <td class="mktForm2Field">'+'          <input type="file" name="fName" id="fName" value="" size="60" tabindex="1" class="mktFileUpload"/>'+'          <input type="hidden" id="parentId" name="parentId" value="" />'+'          <input type="hidden" id="accessZoneId" name="accessZoneId" value="" />'+'          <input type="hidden" id="xsrfId" name="xsrfId" value="'+MktSecurity.getXsrfId()+'" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">New Template Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" id="lptTName" name="lptTName" tabindex="2" value=""  maxlength="240"/>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="">'+'        <td class="mktForm2Label">&nbsp;</td>'+'        <td class="mktForm2Field">'+'            <input type="checkbox" class="mktCheckbox" tabindex="3" id="lptOverwrite" name="lptOverwrite" />'+'            <label for="lptOverwrite">Replace any existing template with this name</label>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>'+'<div id="lptUploadTemplateResults" style="display:none;"></div>'+'<iframe src="javascript:false" name="lptUploadTemplateIframe" id="lptUploadTemplateIframe" class="lptUploadTemplateIframe" style="display:none;"></iframe>');},title:'Import a Landing Page Template',iconCls:'mkiImport',okButtonTitle:'Import',extension:{submitted:false,parentId:parentId,accessZoneId:accessZoneId},width:780,height:240});dialog.on('okclick',mktLPTManager.uploadTemplateSubmit,dialog,true);dialog.on('load',mktLPTManager.uploadTemplateRequestLoaded,dialog,true);dialog.show(animEl);};mktLPTManager.uploadTemplateRequestLoaded=function(dialog){var parentEl=Ext.getDom('parentId');var parentId=dialog.extension.parentId;var accessZoneEl=Ext.getDom('accessZoneId');var accessZoneId=dialog.extension.accessZoneId;if(isDefined(parentEl)&&isDefined(parentId)){parentEl.value=parentId;}
if(isDefined(accessZoneEl)&&isDefined(accessZoneId)){accessZoneEl.value=accessZoneId;}
var fEl=getEl('fName');fEl.on('change',mktLPTManager.fNameChanged);dialog.extension.form=$('lptUploadTemplateForm');dialog.extension.iframe=$('lptUploadTemplateIframe');Ext.get(dialog.extension.iframe).on('load',function(e){mktLPTManager.uploadTemplateSubmitDone(e,this);},dialog);};mktLPTManager.fNameChanged=function(){var fEl=getEl('fName');var fval=fEl.dom.value;if(fval.length>0){var bn=new MktUtil.Basename(fval);var bnbase=bn.basename();var extdot=bnbase.lastIndexOf('.');if(extdot>0){bnbase=bnbase.slice(0,extdot);}
var tEl=getEl('lptTName');tEl.dom.value=bnbase;}
fEl.removeListener('change',mktLPTManager.fNameChanged);};mktLPTManager.uploadTemplateSubmit=function(dialog){dialog.extension.submitted=true;dialog.extension.form.submit();};mktLPTManager.uploadTemplateSubmitDone=function(e,dialog){if(dialog.extension.submitted==true){dialog.extension.submitted=false;var myIframe=MktUtil.findFrame('lptUploadTemplateIframe');var rDiv=$('lptUploadTemplateResults');rDiv.innerHTML=myIframe.document.body.innerHTML;var scriptEl=Ext.getDom('uploadTempalteScript');if(scriptEl){eval(scriptEl.innerHTML);}
var rCode=$('lptUploadTemplateCode');if(rCode==null){MktSession.setModalFormError("Import failed with an unknown error");return false;}else{if(rCode.innerHTML!='100'){MktSession.setModalFormError($('lptUploadTemplateMsg').innerHTML);return false;}}
MktSession.closeActiveModalForm.defer(250);var panel=MktCanvas.getItem(MktCanvas.getTab('landingCanvasTM'));if(panel){var grid=panel.getGridPanel();if(grid){grid.getStore().reload();}}}
return false;};mktLPTManager.staticConfirmDeleteTemplate=function(templateId,templateName,animEl){var cmsg='Are you sure you want to delete <b>'+templateName+'</b> ?';var parms={};var dItem='dobjid_'+templateId;parms[dItem]=dItem;MktMessage.confirmDelete('Delete Template?',cmsg,function(){mktLPTManager.doDeleteTemplate(parms,templateId);},animEl);return false;};mktLPTManager.doDeleteTemplate=function(parms,delId){MktSession.ajaxRequest('landingPage/deleteTemplateRequest',{serializeParms:parms,onMySuccess:mktLPTManager.deleteTemplateDone.createCallback(delId)});return true;};mktLPTManager.deleteTemplateDone=function(delId){if(isDefined(MktPage.canvasHook.lptmgr)){var lt=MktPage.canvasHook.lptmgr;lt.dOids=[delId];lt.deleteObjectsDone.call(lt);}
mktLandingManager.processPostAction('landingCanvasTM','landingTMDetail');};function mktLPDManager(tgId,doGrid){var LPDschema={root:'lpdData',id:'lpId',fields:['lpName','lpType','lpStatus','lpPaused','lpURLPath','lpViews','lpConv','lpConvRate','lpUpdated']};var LPDcolConfig=[{header:"Name",useCSSAsMinWidth:true,allocatePct:100,resizable:true,sortable:true},{hidden:true},{header:"Chgd",useCSSWidth:true,tooltip:"Page changed",resizable:false,sortable:true,renderer:this.rndDirty.createDelegate(this),exportRenderer:this.rndDirtyExport.createDelegate(this)},{header:"A/P",useCSSWidth:true,tooltip:"Active / Paused Status",resizable:false,sortable:true,renderer:this.rndActive.createDelegate(this),exportRenderer:this.rndActiveExport.createDelegate(this)},{hidden:true},{header:"Views",useCSSWidth:true,tooltip:"Page views",resizable:false,sortable:true,rendererName:"formatIntNumber"},{header:"Conv",useCSSWidth:true,tooltip:"Conversions",resizable:false,sortable:true,rendererName:"formatIntNumber"},{header:"CnvRt",useCSSWidth:true,tooltip:"Conversion Rate",resizable:false,sortable:true,renderer:this.rndPercent.createDelegate(this),rendererName:"formatPercent"},{header:"Last Updated",useCSSWidth:true,resizable:false,sortable:true,renderer:this.rndDateTime.createDelegate(this),exportRenderer:this.rndDateTime.createDelegate(this)}];this.tgId=tgId;this.panelIdDetail='landingLPDetail';this.oPfx='lp';this.oTypeText='page';if(doGrid===true){mktLPLManager.superclass.constructor.call(this,'lpdGrid',LPDschema,LPDcolConfig);}else{this.schema=LPDschema;}
this.editTB=null;this.previewTB=null;this.detailsTB=null;}
Ext.extend(mktLPDManager,mktLandingManager,{});mktLPDManager.prototype.getGridSizeParameters=function(){var sp={minHeight:434,maxHeight:800,reservedHeight:268};return sp;};mktLPDManager.prototype.tbEditSelected=function(){mktLPLManager.openLPEditor(this.getTargets()[0]);};mktLPDManager.prototype.tbPreviewSelected=function(){mktLPLManager.openLPPreview(undefined,this.getTargets()[0]);};mktLPDManager.prototype.tbDetailsSelected=function(){MktMainNav.loadLanding({lpgType:'page',lpgId:this.getTargets()[0]});};mktLPDManager.prototype.selectionChanged=function(selModel,rows,ids){if(ids.length==0){this.editTB.doDisable();this.previewTB.doDisable();if(this.detailsTB!==null)this.detailsTB.doDisable();}else if(ids.length==1){var rdx=this.dataModel.getRowIndexById(ids[0]);var lpType=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpType'));if(lpType==0){this.editTB.doEnable();this.previewTB.doEnable();}else{this.editTB.doDisable();this.previewTB.doDisable();}
if(this.detailsTB!==null)this.detailsTB.doEnable();}else{this.editTB.doDisable();this.previewTB.doDisable();if(this.detailsTB!==null)this.detailsTB.doDisable();}};mktLPDManager.prototype.getAllowedActions=function(ids){var rv={allowDeploy:true,allowRevert:true,allowPause:true,allowUnpause:true,allowDelete:true,allowEdit:true,allowPreview:true,allowClone:true,allowDetails:true};if(ids.length>0){for(var ix=0;ix<ids.length;ix++){if(isObject(this.dataModel)){var rdx=this.dataModel.getRowIndexById(ids[ix]);var dpStatus=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf('lpStatus'));}else{var dpStatus=MktPage.appVars.lpStatus;}
if(dpStatus==0){rv.allowRevert=false;}
if(dpStatus<2){rv.allowRevert=false;}}}
if(ids.length!=1||MktPage.appVars.lpType==0)rv.allowDetails=false;return rv;};mktLPDManager.prototype.getTargets=function(){var targets=[];if(MktPage.appVars.lpType==1){if(this.getNumSelected()>0){targets=this.getSelectedIds();}}else{targets=[MktPage.activePanel.config.cHData];}
return targets;};mktLPDManager.prototype.processRefreshGrid=function(){this.selModel.clearSelections();this.dataModel.loadData(MktPage.appVars[this.schema.root]);if(isDefined(MktPage.canvasHook.lplmgr)){var lm=MktPage.canvasHook.lplmgr;lm.selModel.clearSelections();lm.dataModel.loadData(MktPage.appVars[lm.schema.root]);lm.updateDetailStatus();}
delete MktPage.appVars.lplData;delete MktPage.appVars.lpdData;};mktLPDManager.prototype.driveDeleteObjects=function(oids,animEl){var dCount=oids.length;if(dCount==1){if(isDefined(this.dataModel)){var rdx=this.dataModel.getRowIndexById(oids[0]);var objectName=this.dataModel.getValueAt(rdx,this.schema.fields.indexOf(this.oPfx+'Name'));}else{var objectName=MktPage.activePanel.config.title;}
var cmsg='Are you sure you want to delete <b>'+objectName+'</b>?';}else if(dCount>1){var cmsg='Are you sure you want to delete multiple landing pages?';}else{return;}
this.dOids=oids;MktMessage.confirmDelete('Delete Landing Page?',cmsg,this.submitDeleteObjects.createDelegate(this),animEl);};mktLPDManager.prototype.rndDirty=function(val,rowIndex){if(val===''){var rv="";}else if(val===0){var rv="";}else if(val===1){var rv="";}else{var rv="<img class='lpDetailDirty' src='/images/warning_16.gif' title='Page has changed; you must approve again for changes to take effect' />";}
return rv;};mktLPDManager.prototype.rndDirtyExport=function(val){if(val===''){var rv="";}else if(val===0){var rv="Not changed";}else if(val===1){var rv="Not changed";}else{var rv="Changed";}
return rv;};mktLPDManager.prototype.rndActive=function(val,rowIndex){if(val===''){var rv="";}else if(!val){var rv="<img class='lpDetailActive' src='/images/icons/play_16small.gif' title='Tested page is active' />";}else{var rv="<img class='lpDetailPaused' src='/images/icons/pause_16small.gif' title='Tested page is paused' />";}
return rv;};mktLPDManager.prototype.rndActiveExport=function(val){if(val===''){var rv="";}else if(val===0){var rv="Active";}else if(val===1){var rv="Paused";}
return rv;};function mktLPASManager(){this.uploadTB=new mktToolbarButton('masTBUploadAS',this.tbUploadSelected.createDelegate(this,['masTBUploadAS']));this.uploadTB=null;this.importTB=new mktToolbarButton('masTBImportAS',this.tbEditSelected.createDelegate(this));this.importTB=null;}
function mktLPAManager(){mktLPAManager.superclass.constructor.call(this);this.treeNodeType=5;this.treePfx='lpa_';this.oPfx='as';this.oTypeText='asset';this.instanceName='lpamgr';}
Ext.extend(mktLPAManager,mktLandingManager,{});mktLPAManager.driveCrawlWebSiteModal=function(animEl){var mp=new MktModalForm({staticForm:'p.lpaCrawlWebSiteForm',title:"Crawl Web Site",okButtonTitle:'OK',width:655,height:300});mp.show(animEl,mktLPAManager.submitCrawlWebSite);};mktLPAManager.submitCrawlWebSite=function(mp){delete MktPage.appVars.pageList;delete MktPage.appVars.linkList;Ext.MessageBox.show({title:'Please wait...',msg:'Crawling web site',progress:true,width:230,closable:false});MktSession.ajaxRequest('/landingPage/crawlWebSite',{serializeForm:'lpaCrawlWebSiteSubmitForm',onMySuccess:mktLPAManager.crawlWebSiteDone.createDelegate(this)});return false;};mktLPAManager.crawlWebSiteDone=function(){if(isDefined(MktPage.appVars.crawlError)){delete MktPage.appVars.crawlError;return;}
var mp=new MktModalForm({staticForm:'p.lpaCrawlResults',title:"Crawl Web Site Results",okButtonTitle:'OK',width:655,height:440});mp.on('load',function(){var pages='';for(var i=0;i<MktPage.appVars.pageList.length;i++){if(pages.length>0){pages+='<br/>';}
pages+=MktPage.appVars.pageList[i];}
$('lpaCrawlResultsPages').innerHTML=pages;var links='';for(var i=0;i<MktPage.appVars.linkList.length;i++){if(links.length>0){links+='<br/>';}
links+=MktPage.appVars.linkList[i];}
$('lpaCrawlResultsLinks').innerHTML=links;},null,false);mp.show(null,function(){return true;});};
/* ========== mktMenuMgr.js ============ */

Ext.ns("Mkt","Mkt.menus");Mkt.menus.ToolbarMgr=Mkt.app.ToolbarMgr=function(){return Ext.apply(new Mkt.app.Manager(),{getComp:function(type,attr){return this._get.apply(this,arguments);},getToolbar:function(type,attr){return this.getComp.apply(this,arguments);}});}();Mkt.menus.MenuMgr=Mkt.app.MenuMgr=function(){return Ext.apply(new Mkt.app.Manager(),{registerMenuProvider:function(type,func){this.registerComp.apply(this,arguments);},getMenu:function(type,attr){this._get(type,attr);return attr.menu;}});}();MktMenuMgr=Mkt.menus.MenuMgr;
/* ========== mktFolder.js ============ */

Ext.namespace('MktFolder');MktFolder.CREATE="createNewFolder";MktFolder.RENAME="renameFolder";MktFolder.MOVE="moveItem";MktFolder.DELETE="deleteFolder";MktFolder.ARCHIVE="toggleArchiveFolder";MktFolder.shareMeta={'Default':{normalIconCls:'mkiFolder',masterSharedIconCls:'mkiFolderUp',sharedIconCls:'mkiFolderLock'},'Marketing Folder':{level:2,normalIconCls:'mkiFolder',masterSharedIconCls:'mkiFolderUp',sharedIconCls:'mkiFolderLock'},'Landing Page Template':{level:4,normalIconCls:'mkiFolder',masterSharedIconCls:'mkiFolderUp',sharedIconCls:'mkiFolderLock'},'Email Template':{level:4,normalIconCls:'mkiFolder',masterSharedIconCls:'mkiFolderUp',sharedIconCls:'mkiFolderLock'},'Image':{level:3,normalIconCls:'mkiFolder',masterSharedIconCls:'mkiFolderUp',sharedIconCls:'mkiFolderLock'}};MktFolder.isShowShare=function(nodeAttr){if(!MktPage.savedState.multiZone){return false;}
var nodeId=nodeAttr.id;var nodeType=nodeAttr.nodeType;var isShared=nodeAttr.isShared;if(!nodeId||!nodeType||isShared){return false;}
var node=MktExplorer.getNodeById(nodeId);if(node){var nodeDepth=node.getDepth();if(MktFolder.shareMeta[nodeType]&&MktFolder.shareMeta[nodeType]['level']==nodeDepth){return true;}}
return false;};MktFolder.getShareMeta=function(nodeKey){var node;if(isObject(nodeKey)&&nodeKey.nodeType){node=nodeKey;}
else{node=MktExplorer.getNodeById(nodeKey);}
var ret=node?MktFolder.shareMeta[node.attributes.nodeType]:undefined;return ret?ret:MktFolder.shareMeta['Default'];};MktFolder.convertToArchiveFolder=function(node,action){if(typeof node=='string'){node=MktExplorer.getNodeById(node);}
MktFolder.currNodeAction=action||MktFolder.ARCHIVE;MktFolder.currNode=node;var parms={};parms.toggleArchiveStatus='archive';parms.currNodeId=node.id;MktSession.clockCursor(true);MktSession.ajaxRequest('explorer/toggleArchiveFolder',{serializeParms:parms,onMySuccess:function(node,status){node.collapse(true);if(node.attributes){Ext.fly(node.getUI().getIconEl()).replaceClass(node.attributes.iconCls,'mkiCabinet');node.attributes.iconCls='mkiCabinet';if(node.attributes.xtra){node.attributes.xtra.isArchive=node.attributes.isArchive=true;}}
MktSession.clockCursor(false);}.createDelegate(this,[node,parms.toggleArchiveStatus])});if(MktFolder.currNode){MktFolder.currNode.unselect();}};MktFolder.convertToFolder=function(node,action){if(typeof node=='string'){node=MktExplorer.getNodeById(node);}
MktFolder.currNodeAction=action||MktFolder.ARCHIVE;MktFolder.currNode=node;var parms={};parms.toggleArchiveStatus='unArchive';parms.currNodeId=node.id;MktSession.clockCursor(true);MktSession.ajaxRequest('explorer/toggleArchiveFolder',{serializeParms:parms,onMySuccess:function(node,status){if(node.attributes){Ext.fly(node.getUI().getIconEl()).replaceClass(node.attributes.iconCls,'mkiFolder');node.attributes.iconCls='mkiFolder';if(node.attributes.xtra){node.attributes.xtra.isArchive=node.attributes.isArchive=false;}}
MktSession.clockCursor(false);}.createDelegate(this,[node,parms.toggleArchiveStatus])});if(MktFolder.currNode){MktFolder.currNode.unselect();}};MktFolder.editComplete=function(editor,value,startValue){if(value==startValue&&MktFolder.currNodeAction!=MktFolder.CREATE){MktFolder.currNodeAction="";return true;}
if(!isEmptyString(MktFolder.currNodeAction)){if(MktFolder.currNodeAction==MktFolder.CREATE){MktFolder.newFolderSubmit(value,MktFolder.currParentNode.attributes.id,MktFolder.currNode.attributes.id);}else if(MktFolder.currNodeAction==MktFolder.RENAME){MktFolder.renameFolderSubmit(value,startValue,MktFolder.currNode.attributes.id);}}
if(MktFolder.currNode){MktFolder.currNode.unselect();}
MktFolder.currNodeAction="";};MktFolder.newFolderSubmit=function(text,parentNodeId,tempNodeId){MktSession.clockCursor(true);var parms={};parms.text=text;parms.parentNodeId=parentNodeId;parms.tempNodeId=tempNodeId;MktSession.ajaxRequest('folder/createFolderSubmit',{serializeParms:parms,onMySuccess:MktFolder.newFolderSubmitDone.createDelegate(this,[tempNodeId]),onMyFailure:function(tempNodeId){var tempNode=MktExplorer.getNodeById(tempNodeId);if(tempNode){tempNode.remove();}}.createDelegate(this,[tempNodeId])});};MktFolder.newFolderSubmitDone=function(tempNodeId){var result=MktPage.appVars.result;if(result){if(result=="duplicate"){Ext.Msg.show({title:"Marketo",msg:"A folder with that name already exists. Please choose a different name and try again.",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.ERROR,fn:function(btn,text){var currNode=MktFolder.currNode;if(btn=='ok'){MktFolder.renameFolder(currNode,MktFolder.CREATE);}else if(btn=='cancel'){currNode.remove();}}});}else if(result=="fail"){MktMessage.showWarning(MktPage.appVars.errMsg);var tempNode=MktExplorer.getNodeById(tempNodeId);if(tempNode){tempNode.remove();}}}
if(result){delete MktPage.appVars.result;}};MktFolder.newFolderForm=function(parentNode){MktFolder.currParentNode=parentNode;MktFolder.currNodeAction=MktFolder.CREATE;MktFolder.newFolder(parentNode);};MktFolder.newFolder=function(parentNode,defText,defIconCls,container){var parms={parentNode:parentNode,defText:defText,defIconCls:defIconCls,container:container};if(parentNode.isExpanded()){MktFolder.attachFolderToEdit.call(parms,parentNode);}else{parentNode.getOwnerTree().addListener('expandnode',MktFolder.attachFolderToEdit,parms);parentNode.expand();}};MktFolder.attachFolderToEdit=function(node){if(node==this.parentNode){this.parentNode.getOwnerTree().removeListener('expandnode',MktFolder.attachFolderToEdit,this);var text=this.defText||'New Folder';var iconCls=this.defIconCls||'mkiFolder';var container=this.container||MktFolder;var node=this.parentNode.appendChild(new Ext.tree.TreeNode({text:text,iconCls:iconCls,leaf:true,folder:true,system:false,readonly:false,allowDrag:true,nodeType:this.parentNode.attributes.nodeType,uiProvider:MktTreeNodeUI}));this.parentNode.leaf=false;this.parentNode.attributes.leaf=false;node.render();this.parentNode.expand();container.currNode=node;MktFolder.delayedEdit.call(node);}};MktFolder.delayedEdit=function(){var parentNode=this.parentNode;var editor=parentNode.getOwnerTree().editor;setTimeout(function(){this.ensureVisible();editor.editNode=this;this.ui.textNode.renaming=true;editor.startEdit(this.ui.textNode,Ext.util.Format.htmlDecode(this.text));}.createDelegate(this),10);parentNode.removeListener('expand',MktFolder.delayedEdit,this);};MktFolder.renameFolder=function(node,action){MktFolder.currNodeAction=action||MktFolder.RENAME;MktFolder.currNode=node;var tree=node.getOwnerTree();var editor=tree.editor;setTimeout(function(){editor.editNode=node;node.ui.textNode.renaming=!node.attributes.readonly;editor.startEdit(node.ui.textNode,Ext.util.Format.htmlDecode(node.text));},10);};MktFolder.renameFolderSubmit=function(text,startValue,nodeId){MktSession.clockCursor(true);var parms={};parms.text=text;parms.nodeId=nodeId;MktSession.ajaxRequest('folder/renameFolderSubmit',{serializeParms:parms,onMySuccess:MktFolder.renameFolderSubmitDone.createDelegate({parms:parms,startValue:startValue}),onMyFailure:function(){MktFolder.currNode.setText(startValue);}.createDelegate(this)});};MktFolder.renameFolderSubmitDone=function(){var result=MktPage.appVars.result;if(result){if(result=="duplicate"){Ext.Msg.show({title:"Marketo",msg:"An object with that name already exists. Please try again with a different name.",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.ERROR,fn:function(btn,text){var currNode=MktFolder.currNode;if(btn=='ok'){MktFolder.renameFolder(currNode,MktFolder.RENAME);}else if(btn=='cancel'){currNode.setText(this.startValue);}}.createDelegate(this)});}else if(result=="fail"){MktMessage.showWarning(MktPage.appVars.errMsg);MktFolder.currNode.setText(this.startValue);}
delete MktPage.appVars.result;}};MktFolder.moveItemSubmit=function(node,destNodeId){MktFolder.currNodeAction=MktFolder.MOVE;var attr=node.attributes;var parms={};var moveTitle="Move Folder Between Workspaces";var moveMsg="Moving a folder between Workspaces may render the assets unusable";var srcParentNode=node.parentNode;var destNode=MktExplorer.getNodeById(destNodeId);if(destNode.attributes.accessZoneId!=node.attributes.accessZoneId){var moveWin=MktMessage.show({title:moveTitle,msg:moveMsg,buttons:[{text:"Move",iconCls:'mkiDataOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:'mki48Help2',okCallback:function(parms,node,srcParentNode){MktFolder.moveItem(parms,node,srcParentNode,destNodeId);this.moved=true;}.createDelegate(this,[parms,node,srcParentNode,destNodeId]),animateTarget:node.getUI().getEl()});moveWin.on('hide',function(){if(!this.moved){MktFolder.revertMove(node,srcParentNode);}
delete this.moved;}.createDelegate(this,[node,node.parentNode]));}else{MktFolder.moveItem(parms,node,srcParentNode,destNodeId);}};MktFolder.moveItem=function(parms,node,srcParentNode,destNodeId){var compType;var compId;var attr=node.attributes;var compId=attr.compId;compType=attr.compType;if(attr.folder){if(attr.nodeType=="Marketing Folder"||attr.nodeType=="Landing Page Test Group"){compId=node.id;}
if(!attr.xtra.hasDraftNode&&compType!='Marketing Program'&&compType!='Marketing Event'){compType="Folder";}}
parms.compId=compId;parms.destNodeId=destNodeId;parms.compType=compType;MktSession.clockCursor(true);MktSession.ajaxRequest('folder/moveItemSubmit',{serializeParms:parms,onMySuccess:MktFolder.moveItemSubmitDone.createDelegate({parms:parms,node:node,srcParentNode:srcParentNode}),onMyFailure:function(node,srcParentNode){MktFolder.revertMove(node,srcParentNode);}.createDelegate(this,[node,srcParentNode])});node=MktExplorer.getNodeById(destNodeId);if(node){node.leaf=false;node.attributes.leaf=false;}};MktFolder.moveItemSubmitDone=function(){var result=MktPage.appVars.result;if(result){if(result=="duplicate"){Ext.Msg.show({title:"Marketo",msg:"An object with that name already exists on the target folder. Please drag it to a different folder.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(btn,text){if(btn=='ok'){MktFolder.revertMove(this.node,this.srcParentNode);}}.createDelegate(this)});}
else if(result==MktSession.resultFailed){var errMsg=MktPage.appVars.errMsg;if(errMsg){MktMessage.showWarning(errMsg);MktFolder.revertMove(this.node,this.srcParentNode);}}
delete MktPage.appVars.result;}};MktFolder.revertMove=function(node,srcParentNode){var removedNode=node.parentNode.removeChild(node);if(removedNode){newNode=MktTreeNode.prototype.clone.call(removedNode,undefined,true);srcParentNode.appendChild(newNode);srcParentNode.expand();}};MktFolder.deleteFolder=function(node){MktFolder.currNodeAction=MktFolder.DELETE;if(node.attributes&&node.attributes.isShared){MktMessage.show403Forbidden();}
else if(node.hasChildNodes()){MktMessage.showWarning('<p>The folder <b>'+node.text+'</b> is not empty.</p><p>Please delete the contents of the folder and try again.</p>',Ext.emptyFn,node.getUI().getEl());}
else{MktMessage.confirmDelete('Delete Folder','Are you sure you want to delete <b>'+node.text+'</b>?',function(){MktFolder.deleteFolderSubmit(node.attributes.id);},node.getUI().getEl());}};MktFolder.deleteFolderSubmit=function(nodeId){MktSession.clockCursor(true);var parms={};parms.nodeId=nodeId;MktSession.ajaxRequest('folder/deleteFolderSubmit',{serializeParms:parms,onMySuccess:MktFolder.deleteFolderSubmitDone.createDelegate(this,[nodeId])});};MktFolder.deleteFolderSubmitDone=function(nodeId){if(MktPage.appVars.result==MktSession.resultSuccess){var node=MktExplorer.getNodeById(nodeId);if(node){if(node.attributes.compType&&node.attributes.compType=='Image'){MktDlManager.loadDl({type:'Landing',subType:'Image'});}
node.remove();}}};MktFolder.beforeStartEdit=function(){if(isEmptyString(MktFolder.currNodeAction)){MktFolder.currNodeAction=MktFolder.RENAME;}};MktFolder.menuItemPool={createFolder:{text:'New Folder',itemId:'createFolder',iconCls:'mkiFolderAdd',handler:function(el){el.parentMenu.hide(true);MktFolder.newFolderForm(el.parentMenu.currNode);}},convertToArchiveFolder:{text:'Convert To Archive Folder',itemId:'convertToArchiveFolder',iconCls:'mkiCabinet',handler:function(el){MktFolder.convertToArchiveFolder(el.parentMenu.currNode,"convertToArchiveFolder");el.parentMenu.hide(true);}},convertToFolder:{text:'Convert To Folder',itemId:'convertToFolder',iconCls:'mkiFolder',handler:function(el){MktFolder.convertToFolder(el.parentMenu.currNode,"convertToFolder");el.parentMenu.hide(true);}},convertToCampaignFolder:{text:'Convert To Campaign Folder',itemId:'convertToCampaignFolder',iconCls:'mkiFolder',handler:function(el){MktFolder.convertToFolder(el.parentMenu.currNode,"convertToFolder");el.parentMenu.hide(true);}},renameFolder:{text:'Rename Folder',itemId:'renameFolder',iconCls:'mkiFolderEdit',handler:function(el){el.parentMenu.hide(true);MktFolder.renameFolder(el.parentMenu.currNode);}},deleteFolder:{text:'Delete Folder',itemId:'deleteFolder',iconCls:'mkiFolderDelete',handler:function(el){el.parentMenu.hide(true);MktFolder.deleteFolder(el.parentMenu.currNode);}},share:{text:'Share Folder',itemId:'share',iconCls:'mkiUserEarth',handler:function(el){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var share=new Mkt.apps.ShareFolderForm({targetNode:currNode,folderId:currNode.id,folderName:currNode.text});}},moveFolder:{text:'Move Folder',itemId:'moveFolder',iconCls:'mkiFolderEdit',handler:function(el){MktMessage.comingSoon();}}};MktFolder.folderNodeContextMenu=function(){var fMip=MktFolder.menuItemPool;var m=Ext.menu.MenuMgr.get('folderNodeContextMenu');return m?m:MktLeadDbMenu.menuFactory("folderNodeContextMenu",fMip.createFolder,fMip.renameFolder,fMip.deleteFolder);};MktMenuMgr.registerMenuProvider('Folder',function(attr){var menu,xtraAttr=attr.xtra;if(attr.folder||attr.iconCls=='mkiFolder'){if(attr.text=='System Smart Lists'||attr.text=='Campaign Smart Lists'||attr.text=='System Campaigns'){return false;}
if(attr.nodeType=='List'||attr.nodeType=='Smart List'||attr.nodeType=='Marketing Folder'){attr.menu=MktFolder.folderNodeContextMenu();}else{return false;}
if(attr.system){attr.menu.items.get('renameFolder').disable();attr.menu.items.get('deleteFolder').disable();}else{attr.menu.items.get('renameFolder').enable();attr.menu.items.get('deleteFolder').enable();}
return true;}
return false;});MktFolder.saveExpandState=function(node,expanded)
{if(MktPage.cancelSaveExpandState||node.cancelSaveExpandState||!node){return;}
var tree=node.getOwnerTree();if(tree&&tree.cancelSaveExpandState){return;}
if(node.id<0){return;}
else if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.hasDraftNode){return;}
var parms={node:node.id,expanded:expanded};var parentNode=node.parentNode;if(parentNode&&parentNode.attributes&&parentNode.attributes.id=="RecentlyViewedroot"){parms.appArea="My Marketo";}
if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.isArchive==true){var iconCls='mkiCabinet';if(expanded){iconCls='mkiCabinetOpen';}
Ext.fly(node.getUI().getIconEl()).replaceClass(node.attributes.iconCls,iconCls);node.attributes.iconCls=iconCls;}
MktSession.ajaxRequest('/folder/saveState',{serializeParms:parms,onMySuccess:MktFolder.saveExpandStateDone.createDelegate(this,[node.id,expanded])});if(!node.attributes.leaf&&node.attributes.xtra){node.attributes.xtra.stickyCollapsed=!expanded;}};MktFolder.saveExpandStateDone=function(nodeId,expand){if(MktPage.appVars.result=="success"){MktExplorer.setCachedNodeProperty(nodeId,"expanded",expand);}};MktFolder.isArchiveAllowed=function(attr){var isSystem=attr&&attr.system?true:false;var isShared=attr&&(attr.isMasterShared||attr.isShared)?true:false;return(!isSystem&&!isShared);}
Ext.ns("Mkt","Mkt.apps");Mkt.apps.ShareFolderForm=Ext.extend(Ext.Window,{title:'Share Folder',iconCls:'mkiUserEarth',width:400,height:300,resizable:true,layout:'anchor',plain:true,folderName:"",modal:true,bodyStyle:'padding: 18px 15px 15px 15px; overflow: auto;',buttonAlign:'right',initComponent:function(){if(this.targetNode.attributes&&this.targetNode.attributes.isArchive){MktMessage.showWarning("Archived Folders cannot be shared.");return false;}
this.items=this.items||[];var animEl;if(this.targetNode){var nodeUI=this.targetNode.getUI();if(nodeUI){animEl=nodeUI.elNode;}}
this.animEl=animEl;this.items.push(new Ext.Panel({baseCls:'x-plain',cls:'modalHeader',plain:true,style:'padding-bottom: 13px;',html:"Share '"+this.folderName+"' with Workspace(s):"}));MktSession.clockCursor();MktSession.ajaxRequest('folder/getAllZones',{serializeParms:{folderId:this.folderId},onMySuccess:this.addZones.createDelegate(this,[this.animEl])});this.buttons=this.buttons||[];this.buttons.push({text:'Save',iconCls:'mkiOk',handler:function(button,event){this.setAnimateTarget(undefined);button.setDisabled(true);MktSession.clockCursor(true);var accessZones=[];var shared=false;this.items.each(function(item,index,length){if(item.boxLabel&&item.name){accessZones.push({name:Ext.util.Format.htmlDecode(item.name),checked:item.checked});if(item.checked){shared=true;}}});MktSession.ajaxRequest('folder/shareFolder',{serializeParms:{folderId:this.folderId,accessZones:Ext.util.JSON.encode(accessZones)},onMySuccess:this.addZonesDone.createDelegate(this,[button,this.folderId,shared])});}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.ShareFolderForm.superclass.initComponent.call(this);},addZones:function(animEl){var zones=MktPage.appVars.zones;var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){if(zones.length>0){for(var i=0;i<zones.length;i++){this.add(zones[i]);}
delete MktPage.appVars.zones;this.show(this.animEl);MktSession.activeModalDialog=this;}else{MktMessage.showWarning('There are no other Workspaces to share with',undefined,animEl);}}
else{MktMessage.showWarning(MktPage.appVars.errMsg,undefined,animEl);}
MktSession.unclockCursor();},addZonesDone:function(button,folderId,shared){if(MktPage.appVars.result==MktSession.resultSuccess){var sharedPaths=MktPage.appVars.sharedRootFolders;if(sharedPaths){MktExplorer.expandNodeByServerPaths(sharedPaths);delete MktPage.appVars.sharedRootFolders;}
var removedNodeIds=MktPage.appVars.removedNodeIds;if(removedNodeIds){MktExplorer.removeNodes(removedNodeIds);delete MktPage.appVars.removedNodeIds;}
var addNodeJson=MktPage.appVars.addedNodeJsons;if(addNodeJson){MktExplorer.addNodes(addNodeJson);delete MktPage.appVars.addedNodeJsons;}
var shareMeta=MktFolder.getShareMeta(folderId);var removedClass=(shared?shareMeta.normalIconCls:shareMeta.masterSharedIconCls);var addedClass=(shared?shareMeta.masterSharedIconCls:shareMeta.normalIconCls);MktExplorer.updateNodeIconCls(folderId,addedClass,removedClass);var node=MktExplorer.getNodeById(folderId);if(node){node.attributes.isMasterShared=shared;}}
if(MktPage.appVars.result){delete MktPage.appVars.result;}
if(this.buttons[0]){this.buttons[0].setDisabled(false);}}});
/* ========== mktAnalyticsMenu.js ============ */

Ext.namespace("MktAnalyticsMenu");MktAnalyticsMenu.newReport=function(animateEl,folderId,accessZoneId,isAnalyzer){MktAppJS.atxDriveCreateReportModal(animateEl,folderId,accessZoneId,isAnalyzer);};MktAnalyticsMenu.cloneReport=function(animateEl,reportId,accessZoneId,isAnalyzer){MktAppJS.atxDriveCloneReportModal(animateEl,reportId,accessZoneId,isAnalyzer);};MktAnalyticsMenu.deleteReport=function(reportId,reportName,nodeId,currNode,animEl){MktMessage.confirmDelete('Delete Report','Are you sure you want to delete <b>'+reportName+'</b>?',function(){MktSession.ajaxRequest('analytics/deleteReport',{serializeParms:{atxDeleteReportId:reportId,nodeId:nodeId},onMySuccess:function(result){if(result.JSONResults.appvars.deleteReport=='failed'){var msg=result.JSONResults.appvars.deleteReportErrMsg;MktMessage.showWarning(msg);}
MktExplorer.removeNode(nodeId);MktMainNav.loadAnalytics({});}});},animEl);};MktAnalyticsMenu.deleteSubscriptions=function(count,subscriptionIds,animEl){var s=count==1?'':'s';MktMessage.confirmDelete('Delete Subscription'+s,'Are you sure you want to delete '+count+' subscription'+s+'?',function(){MktSession.ajaxRequest('analytics/deleteSubscriptions',{serializeParms:{atxDeleteSubscriptionIds:subscriptionIds},onMySuccess:function(){MktCanvas.setActiveTab('atxCanvasSubscriptions');}});},animEl);};MktAnalyticsMenu.menuItemPool={newReport:{text:'New Report',itemId:'newReport',iconCls:'mkiChartArea',handler:function(el){var currNode=el.parentMenu.currNode;var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);if(currNode&&currNode.attributes.xtra){var xtra=currNode.attributes.xtra;var folderId;if(currNode.attributes.folder){folderId=xtra.compId;}
MktAnalyticsMenu.newReport(el.getEl(),folderId,accessZoneId);}
else{MktAnalyticsMenu.newReport(el.getEl(),undefined,accessZoneId);}
el.parentMenu.hide(true);}},newAnalyzer:{text:'New Analyzer',itemId:'newAnalyzer',iconCls:'mkiChartArea',handler:function(el){var isAnalyzer=true;var currNode=el.parentMenu.currNode;var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);if(currNode&&currNode.attributes.xtra){var xtra=currNode.attributes.xtra;var folderId;if(currNode.attributes.folder){folderId=xtra.compId;}
MktAnalyticsMenu.newReport(el.getEl(),folderId,accessZoneId,isAnalyzer);}
else{MktAnalyticsMenu.newReport(el.getEl(),undefined,accessZoneId,isAnalyzer);}
el.parentMenu.hide(true);}},cloneReport:{text:'Clone Report',itemId:'cloneReport',iconCls:'mkiChartArea',handler:function(el){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var compId;if(!currNode.attributes.folder){compId=xtra.compId;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);MktAnalyticsMenu.cloneReport(el.getEl(),compId,accessZoneId);el.parentMenu.hide(true);}},cloneAnalyzer:{text:'Clone Analyzer',itemId:'cloneReport',iconCls:'mkiChartArea',handler:function(el){var isAnalyzer=true;var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var compId;if(!currNode.attributes.folder){compId=xtra.compId;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);MktAnalyticsMenu.cloneReport(el.getEl(),compId,accessZoneId,isAnalyzer);el.parentMenu.hide(true);}},deleteReport:{text:'Delete Report',itemId:'deleteReport',iconCls:'mkiDelete2',handler:function(el){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;MktAnalyticsMenu.deleteReport(xtra.compId,currNode.text,xtra.nodeId,currNode,el.getEl());el.parentMenu.hide(true);}},deleteAnalyzer:{text:'Delete Analyzer',itemId:'deleteReport',iconCls:'mkiDelete2',handler:function(el){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;MktAnalyticsMenu.deleteReport(xtra.compId,currNode.text,xtra.nodeId,currNode,el.getEl());el.parentMenu.hide(true);}},navigateToOverviewReport:{text:'View Overview',itemId:'navigateToOverviewReport',iconCls:'mkiChartPie',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'A',true),'_blank');}else{MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToAnalyzer:{text:'View Analyzer',itemId:'navigateToAnalyzer',iconCls:'mkiChartPie',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'A',true),'_blank');}else{MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToDetailReport:{text:'View Report',itemId:'navigateToDetailReport',iconCls:'mkiTable2Run',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'B',true),'_blank');}else{if(xtra){xtra.panelId=Mkt.menus.Analytics.Toolbar.detailCanvasId;}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToSmartList:{text:'View Smart List',itemId:'navigateToSmartList',iconCls:'mkiUsers3',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'C',true),'_blank');}else{if(xtra){xtra.panelId=Mkt.menus.Analytics.Toolbar.smartlistCanvasId;}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToSubscriptions:{text:'View Subscriptions',itemId:'navigateToSubscriptions',iconCls:'mkiMail2',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'E',true),'_blank');}else{if(xtra){xtra.panelId=Mkt.menus.Analytics.Toolbar.subscriptionsCanvasId;}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToSetup:{text:'View Setup',itemId:'navigateToSetup',iconCls:'mkiGear',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'D',true),'_blank');}else{if(xtra){xtra.panelId=Mkt.menus.Analytics.Toolbar.setupCanvasId;}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToAnalyzerSetup:{text:'View Setup',itemId:'navigateToAnalyzerSetup',iconCls:'mkiGear',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('AR',currNode.attributes.xtra.compId,'B',true),'_blank');}else{if(xtra){xtra.panelId=Mkt.menus.Analytics.Toolbar.setupCanvasId;}
MktDlManager.loadDl(currNode.attributes.xtra);}}},contextSpacer:{itemId:'contextSpacer'}};(function(){var atxMip=MktAnalyticsMenu.menuItemPool;var fMip=MktFolder.menuItemPool;MktAnalyticsMenu.reportFolderMenu=function(attr){var isAnalyzer=false;var menuId="reportFolderMenu";if(attr.text=='Analyzers'&&attr.system==true){isAnalyzer=true;menuId="analyzerFolderMenu";}
var m=Ext.menu.MenuMgr.get(menuId);var config={id:menuId,extraMenuAction:true,isAnalyzer:isAnalyzer,cls:'mktPopup'};if(isDefined(attr.width))config.width=attr.width;if(m){return m;}
if(isAnalyzer){return MktLeadDbMenu.menuFactory(config,atxMip.newAnalyzer,'-',fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);}
if(savedState.MPA==true){return MktLeadDbMenu.menuFactory(config,atxMip.newReport,atxMip.newAnalyzer,'-',fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);}
return MktLeadDbMenu.menuFactory(config,atxMip.newReport,'-',fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);};MktAnalyticsMenu.reportMenu=function(attr){var isAnalyzer=false;var menuId="reportMenu";var isAnalyzer=attr.xtra.compType=='Report'&&attr.xtra.subType=='analyzer';if(isAnalyzer){isAnalyzer=true;menuId="analyzerMenu";}
var m=Ext.menu.MenuMgr.get(menuId);var config={id:menuId,extraMenuAction:true,width:160,cls:'mktPopup'};if(isDefined(attr.width))config.width=attr.width;if(m){return m;}
if(isAnalyzer){return MktLeadDbMenu.menuFactory(config,atxMip.navigateToAnalyzer,atxMip.navigateToAnalyzerSetup,'-',atxMip.cloneAnalyzer,atxMip.deleteAnalyzer);}
return MktLeadDbMenu.menuFactory(config,atxMip.navigateToOverviewReport,atxMip.navigateToDetailReport,atxMip.navigateToSmartList,atxMip.navigateToSetup,atxMip.navigateToSubscriptions,'-',atxMip.cloneReport,atxMip.deleteReport);};MktAnalyticsMenu.preShowReportMenu=function(menu,attr){var mItems=menu.items;if(attr.system){mItems.get('deleteReport').setDisabled(true);}
else{mItems.get('deleteReport').setDisabled(false);}};MktAnalyticsMenu.preshowReportFolderMenu=function(menu,attr,compType){var mItems=menu.items;var renameDisabled=false;if(compType=='Zone'){renameDisabled=true;}
if(attr.text=='Analyzers'&&attr.system==true){renameDisabled=true;}
var isArchive=false;if(attr.xtra&&attr.xtra.isArchive){isArchive=attr.xtra.isArchive;}
var isArchiveAllowed=MktFolder.isArchiveAllowed(attr);mItems.get('convertToArchiveFolder').setVisible(!isArchive&&isArchiveAllowed);mItems.get('convertToFolder').setVisible(isArchive&&isArchiveAllowed);mItems.get('renameFolder').setDisabled(renameDisabled);};})();MktMenuMgr.registerMenuProvider('Analytics',function(attr){var menu,xtraAttr=attr.xtra;if(attr.folder||xtraAttr){var compType=attr.nodeType||(xtraAttr?xtraAttr.compType:'');if(compType=='Report'||compType=='Zone'){if(attr.folder){attr.menu=MktAnalyticsMenu.reportFolderMenu(attr);MktAnalyticsMenu.preshowReportFolderMenu(attr.menu,attr,compType);}else{attr.menu=MktAnalyticsMenu.reportMenu(attr);MktAnalyticsMenu.preShowReportMenu(attr.menu,attr);}
return true;}}
else{return false;}});
/* ========== mktMa.js ============ */

Ext.namespace('MktMa');MktMa.CREATE='createNewProgramFolder';MktMa.RENAME="renameProgramFolder";MktMa.newProgramFolderSubmit=function(text,parentId,tempNodeId){MktSession.clockCursor(true);var parms={};parms.text=text;parms.parentId=parentId;parms.tempNodeId=tempNodeId;MktSession.ajaxRequest('explorer/createProgramFolder',{serializeParms:parms,onMySuccess:MktMa.newProgramFolderDone,onMyFailure:function(tempNodeId){var tempNode=MktExplorer.getNodeById(tempNodeId);if(tempNode){tempNode.remove();}}.createDelegate(this,[tempNodeId])});if(MktMa.currNode){MktMa.currNode.unselect();}};MktMa.newProgramFolderDone=function(){var result=MktPage.appVars.createProgramFolderResult;var currNode=MktMa.currNode;var nodeJson=MktPage.appVars.nodeJson;var errMsg=MktPage.appVars.createProgramFolderMsg;if(result=='success'){if(currNode){var prnNode=currNode.parentNode;var prnExpanded=prnNode.isExpanded();currNode.remove();}
if(prnExpanded){prnNode.expand();}
var progId=MktPage.appVars.createdProgramId;if(isDefined(progId)&&!MktPage.appVars.marketingProgramId){MktMainNav.loadPE({programId:progId});}
delete MktPage.appVars.nodeJson;delete MktPage.appVars.parentId;}else{if(!this.fromModal){MktMessage.showQuestion(errMsg,'OK',function(){MktMa.editProgramFolder(currNode,MktMa.CREATE);},undefined,undefined,function(){currNode.remove();});}
delete MktPage.appVars.createProgramFolderMsg;}
if(isDefined(result)){delete MktPage.appVars.createProgramFolderResult;}
delete MktMa.currNode;};MktMa.newProgramFolderForm=function(parentNode){MktMa.currParentNode=parentNode;MktMa.currNodeAction=MktMa.CREATE;MktFolder.newFolder(parentNode,'New Campaign Folder','mkiFolder',MktMa);};MktMa.editProgramFolder=function(node,action){if(typeof node=='string'){node=MktExplorer.getNodeById(node);}
MktMa.currNodeAction=action||MktMa.RENAME;node.attributes.origName=node.text;MktMa.currNode=node;var tree=node.getOwnerTree();var editor=tree.editor;setTimeout(function(){editor.editNode=node;node.ui.textNode.renaming=!node.attributes.readonly;editor.startEdit(node.ui.textNode,Ext.util.Format.htmlDecode(node.text));},10);};MktMa.editProgramFolderComplete=function(editor,value,startValue){if(value==startValue&&MktMa.currNodeAction!=MktMa.CREATE){MktMa.currNodeAction="";return true;}
if(!isEmptyString(MktMa.currNodeAction)){if(MktMa.currNodeAction==MktMa.CREATE){MktMa.newProgramFolderSubmit(value,MktMa.currParentNode.attributes.id,MktMa.currNode.attributes.id);}else if(MktMa.currNodeAction==MktMa.RENAME){MktMa.renameProgramFolderSubmit(value,startValue,MktMa.currNode.id);}}
if(MktMa.currNode){MktMa.currNode.unselect();}
MktMa.currNodeAction="";};MktMa.deleteProgramFolder=function(pid,pName,animEl){MktAppJS.phcDriveConfirmDeleteModal(pid,pName,animEl);};MktMa.renameProgramFolderSubmit=function(value,startValue,folderId){MktSession.clockCursor(true);var parms={};parms.origProgramName=startValue;parms.newProgramName=value;parms.folderId=folderId;MktSession.ajaxRequest('explorer/renameProgramFolder',{serializeParms:parms,onMySuccess:MktMa.renameProgramFolderSubmitDone,onMyFailure:function(folderId,origName){var folder=MktExplorer.getNodeById(folderId);if(folder){folder.setText(origName);}}.createDelegate(this,[folderId,startValue])});};MktMa.renameProgramFolderSubmitDone=function(){var currNode=MktMa.currNode;var progResult=MktPage.appVars.renameProgramResult;if(isDefined(progResult)){if(progResult!='success'){function renameHandler(btn){currNode.setText(currNode.attributes.origName);if(btn=='ok'){MktMa.editProgramFolder(currNode,MktMa.RENAME);}}
MktMessage.showQuestion(MktPage.appVars.renameProgErrMsg,undefined,renameHandler.createDelegate(this,['ok']),undefined,undefined,renameHandler.createDelegate(this,['cancel']));delete MktPage.appVars.renameProgErrMsg;}
delete MktPage.appVars.renameProgramResult;;}
delete MktMa.currNode;};MktMa.deleteSmartCampaign=function(scId,nodeId,name,animEl){MktMessage.confirmDelete("Delete Smart Campaign?","Are you sure you want to delete <b>"+name+"</b>?",function(){var parms={};if(isDefined(scId)){parms.scId=scId;}
if(nodeId){parms.nodeId=nodeId;}
MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/deleteSmartCampaign',{serializeParms:parms,onMySuccess:MktMa.deleteSmartCampaignDone.createDelegate(parms)});},animEl);};MktMa.isProgramCompTypeFamily=function(compType){return['Marketing Event','Marketing Program'].indexOf(compType)!=-1;};MktMa.deleteSmartCampaignDone=function(){if(MktPage.appVars.deleteScResults=='success'){var nodeId=this.nodeId||MktPage.appVars.deletedNodeId;if(MktExplorer&&MktExplorer.removeNode){MktExplorer.removeNode(nodeId);}
if(this.scId==MktPage.appVars.smartCampaignId){MktMainNav.loadPE({});}
if(isDefined(MktPage.appVars.deletedNodeId)){delete MktPage.appVars.deletedNodeId;}
var activeTab=MktCanvas.getActiveTab();var isAssetTab=Mkt.apps.localasset&&activeTab&&Mkt.apps.localasset.Constants.TAB_NAME==activeTab.config.id;if(MktPage.satellite&&!isAssetTab){window.setTimeout(function(){window.close();},500);}}else{if(isDefined(MktPage.appVars.deleteScResults)){MktMessage.showWarning(MktPage.appVars.deleteScErrMsg,Ext.emptyFn);delete MktPage.appVars.deleteScErrMsg;}}
if(isDefined(MktPage.appVars.deleteScResults)){delete MktPage.appVars.deleteScResults;}};MktMa.minDefaultScheduleLeadtime=300000;MktMa.getRoundedLeadDateTime=function(dateTime){var minutes=dateTime.getMinutes();var hoursInMs=3600000;if(minutes<30){dateTime.setTime(dateTime.getTime()+(hoursInMs-(minutes*60000)));}else{dateTime.setTime(dateTime.getTime()+((hoursInMs*2)-(minutes*60000)));}
return dateTime;};MktMa.scheduleRecurrence=function(animEl,e){Mkt.apps.campSchedule.show(MktPage.appVars.scheduleData,MktMa.scheduleAppvars,animEl);};MktMa.runOrScheduleCamp=function(animEl,e){if(MktMa.scheduleAppvars.errorCount>0){MktMessage.showNotAllowed(MktMa.scheduleAppvars.warningMsg);return;}
var is_runNow=(animEl.initialConfig.id=='run_once');if(!(MktMa.scheduleAppvars.warningMsg=='')){var okCallback=function(btn){if(is_runNow){Mkt.apps.campScheduleRun.show(MktMa.scheduleAppvars,animEl.el);}
else{Mkt.apps.campSchedule.show(MktPage.appVars.scheduleData,MktMa.scheduleAppvars,animEl.el);}}
MktMessage.showContinueWarning(MktMa.scheduleAppvars.warningMsg,okCallback,MktMa.scheduleAppvars.title,MktMa.scheduleAppvars.ok,animEl.el);return;}
if(is_runNow){Mkt.apps.campScheduleRun.show(MktMa.scheduleAppvars,animEl.el);}else{Mkt.apps.campSchedule.show(MktPage.appVars.scheduleData,MktMa.scheduleAppvars,animEl.el);}};MktMa.showSchedule=function(){var runCampaign=Ext.get('runCampaignImmediately');if(runCampaign){runCampaign.setStyle({display:'none'});}
var time=new Date(MktPage.appVars.currentDateTime);MktMa.schedulePicker=new Ext.ux.form.DateTime({renderTo:'runCampaignDateTimePicker',fieldLabel:'Date & Time',dateValue:time,anchor:'-18',timeConfig:{altFormats:'H:i:s',value:time,increment:60,allowBlank:true},dateConfig:{altFormats:'Y-m-d|Y-n-d',value:time,allowBlank:true}});MktMa.schedulePicker.updateValue();var dtCancel=Ext.get('runCampaignDateTimePickerCancel');if(dtCancel){dtCancel.setStyle({display:'inline'});}
var el=Ext.get('runCampaignDateTimePickerTz');if(el){el.setStyle({display:'block'});}};MktMa.getTimezone=function(){var dateTimeArr=new Date().toGMTString().split(' ');return dateTimeArr[dateTimeArr.length-1];};MktMa.cancelShownSchedule=function(){if(!MktMa.schedulePicker){return;}
var runCampaign=Ext.get('runCampaignImmediately');if(runCampaign){runCampaign.setStyle({display:'block'});}
MktMa.schedulePicker.destroy();delete MktMa.schedulePicker;var dtCancel=Ext.get('runCampaignDateTimePickerCancel');if(dtCancel){dtCancel.setStyle({display:'none'});}
var el=Ext.get('runCampaignDateTimePickerTz');if(el){el.setStyle({display:'none'});}};MktMa.getSelectedSchedule=function(){if(MktMa.schedulePicker){return MktMa.schedulePicker.getValue().format('F j, Y, g:i a');}};MktMa.cancelScheduledRun=function(scId,runId,dateTime,animEl,scheduleType){MktMessage.confirm("Cancel Scheduled Run?",'Are you sure you want to cancel the <b>'+dateTime+'</b> scheduled run?',undefined,function(button,text){MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/cancelScheduledRun',{serializeParms:{runId:runId,smartCampaignId:scId,scheduleType:scheduleType},onMySuccess:MktMa.cancelScheduledDone});},undefined,animEl);};MktMa.cancelScheduledDone=function(){MktSession.clockCursor(false);MktMa.refreshSchedule();};MktMa.addRunSchedule=function(btn,timezone){MktMa.addScheduleForm=new MktMa.widget.addScheduleForm({header:false,timezone:timezone,bodyBorder:false});MktMa.addScheduleForm.show(btn.el);};MktMa.refreshSchedule=function(){MktMa.refreshRunOnceSchedules();MktMa.refreshRecurSchedules();};MktMa.refreshRunOnceSchedules=function(){if(MktPage.appVars.scheduledRuns&&MktMa.scheduledList){MktMa.scheduledList.destroy();delete MktMa.scheduledList;MktMa.scheduledList=new MktMa.widget.ScheduledList({renderTo:'runCampaignScheduleList',schedules:MktPage.appVars.scheduledRuns});}
var el=Ext.get('scheduleRuns');if(MktPage.appVars.scheduledRuns.length>0){el.dom.style.display="";}else{el.dom.style.display="none";}};MktMa.refreshRecurSchedules=function(){if(MktPage.appVars.scheduledRecurRuns&&MktMa.scheduledRecurList){MktMa.scheduledRecurList.destroy();delete MktMa.scheduledRecurList;MktMa.scheduledRecurList=new MktMa.widget.ScheduledList({renderTo:'runRecurScheduleList',scheduleType:'recur',schedules:MktPage.appVars.scheduledRecurRuns});}};MktMa.isScheduleReasonable=function(dateTime,minLeadTime,tzOffset){minLeadTime=minLeadTime||MktMa.minDefaultScheduleLeadtime;if(dateTime){var now=new Date();tzOffset=(tzOffset/3600);var selDateTime=new Date((dateTime+" GMT"+(tzOffset<0?"":"+"))+tzOffset);if(selDateTime.getTime()-now.getTime()>=minLeadTime){return true;}else{return false;}}else{return true;}};MktMa.goToCampaignSummary=function(){if(!MktPage.appVars.SmartCampaignExecutionError){MktPage.clearPanelContentValid('smartCampaignOverview');MktPage.activatePanel('smartCampaignOverview');}};MktMa.goToCampaignSchedule=function(){if(!MktPage.appVars.SmartCampaignExecutionError){MktPage.clearPanelContentValid('campaignCanvasDetailSchedule');MktPage.activatePanel('campaignCanvasDetailSchedule');}};MktMa.runOnceDone=function(){if(!MktPage.appVars.SmartCampaignExecutionError){if(MktPage.appVars.result.refresh){MktMa.goToCampaignSchedule();}else{MktMa.refreshRunOnceSchedules();}}};MktMa.applyRecurSchduleDone=function(){if(MktPage.appVars.scheduleSummary){Ext.fly('scheduleSummary').update(MktPage.appVars.scheduleSummary);}
MktMa.refreshRecurSchedules();MktPage.appVars.scheduleData=Mkt.apps.campSchedule.newScheduleData;if(MktPage.appVars.warning&&MktPage.appVars.warning){var warningConfig={title:'Warning',width:400,wait:false,msg:MktPage.appVars.warningMsg,buttons:{ok:'Ok'}};Ext.Msg.show(warningConfig);}};Ext.ns('MktMa.widget');MktMa.widget.ScheduledList=Ext.extend(Ext.Panel,{header:false,bodyBorder:false,border:false,hideBorders:true,initComponent:function(){if(this.schedules.length>0){this.items=this.items||[];}
var handler=(this.scheduleType=='runOnce')?'MktMa.cancelScheduledRun':'MktMa.cancelRecurScheduledRun';for(i=0;i<this.schedules.length;i++){var id=Ext.id();this.items.push({header:false,hideBorders:true,bodyBorder:false,border:false,html:'<div style="float:left; min-width:160px;">'+this.schedules[i]['usertime']+' </div>'+'<div style="float:left; position:relative; margin-left:10px; height:20px; cursor:pointer;" '+'onclick="MktMa.cancelScheduledRun('+MktPage.appVars.smartCampaignId+', '+this.schedules[i]['id']+', \''+this.schedules[i]['usertime']+'\', \''+id+'\', \''+this.scheduleType+'\'); return false;">'+'<div id="'+id+'" class="mkiDeleteSmall scheduleCancelTooltip" style="height:16px; width:16px;"></div>'+'</div>'});}
MktMa.widget.ScheduledList.superclass.initComponent.apply(this);this.on('render',function(){window.setTimeout(function(){var cancelTooltips=Ext.query('.scheduleCancelTooltip');for(i=0;i<cancelTooltips.length;i++){new Ext.ToolTip({target:cancelTooltips[i].id,html:'Cancel this scheduled campaign'});}},2000);});}});MktMa.widget.addScheduleForm=Ext.extend(Ext.Window,{title:'New Run',width:380,height:170,resizable:false,layout:'anchor',plain:true,modal:true,border:false,plain:false,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',initComponent:function(){this.items=this.items||[];var time=new Date(MktPage.appVars.currentDateTime);var scheduleDateTime=new Ext.ux.form.DateTime({otherToNow:true,fieldLabel:'Date & Time',anchor:'-18',timeWidth:100,dateWidth:140,timeConfig:{altFormats:'H:i:s',value:time,increment:60,allowBlank:true},dateConfig:{altFormats:'Y-m-d|Y-n-d',value:time,allowBlank:true}});this.items.push({xtype:'fieldset',title:'Date and Time',style:"margin-top: 7px;",anchor:'100% 90%',dateValue:time,cls:'mktFieldsetCheckboxes mktPanelPlain',defaults:{height:23,hideLabel:true},items:[{layout:'column',items:[{columnWidth:.97,cls:'mktPanelPlain',items:[scheduleDateTime]},{width:47,cls:'mktPanelPlain mktPlainTextTz',html:"("+this.timezone+")"}]}]});this.dateTimeField=scheduleDateTime;this.buttons=this.buttons||[];this.buttons.push({text:'Run Campaign',iconCls:'mkiClockRun',handler:function(button,event){this.dateTimeField.updateValue();if(!this.dateTimeField.isValid()){MktMessage.showWarning("Invalid date and time.",undefined,button.el);}else{button.setDisabled(true);MktSession.clockCursor(true);if(!MktMa.runImmediately(undefined,{selDateTime:this.dateTimeField.getValue().format('F j, Y, g:i a'),callback:this.addScheduleRunDone.createDelegate(this)})){button.setDisabled(false);}}}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});MktMa.widget.addScheduleForm.superclass.initComponent.call(this);},addScheduleRunDone:function(){if(!MktPage.appVars.SmartCampaignExecutionError){MktPage.clearPanelContentValid('smartCampaignOverview');MktMa.refreshSchedule();this.close();}}});
/* ========== ../mkt-ext-2.0/apps/LpTemplate.js ============ */

Ext.ns("Mkt","Mkt.app","Mkt.app.DesignStudio");Mkt.app.DesignStudio.Templates={overviewCanvasId:'landingCanvasTM',detailCanvasId:'landingTMDetail',statusApproved:'p',statusApprovedWithDraft:'w',statusDraft:'l',statusDeleted:'d',statusOldVersion:'v',statusSystem:'s',statusIntDraft:null,statusIntApproved:1,statusIntApprovedWithDraft:2,getActionStates:function(action){var states={showEdit:true,disableEdit:false,showPreview:true,disablePreview:false,showApprove:true,disableApprove:false,showUnapprove:false,showClone:true,disableClone:false,showDelete:true,disableDelete:false,showExport:true,disableExport:false,showDraftActions:false,showEditDraft:false,showPreviewDraft:false,showApproveDraft:false,showDiscardDraft:false};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){if(sels.length>=1){var status=this.getIntStatus(sels[0].status);if(status==this.statusIntApproved){states.showApprove=false;states.showUnapprove=true;}else if(status==this.statusIntApprovedWithDraft){states.showApprove=false;states.showEdit=false;states.showDraftActions=true;states.showUnapprove=true;}else{states.showUnapprove=false;states.showApprove=true;}}
if(sels.length>1){states.disableExport=states.disableEdit=states.disablePreview=states.disableClone=true;}}else{states.disableEdit=states.disablePreview=states.disableApprove=states.disableClone=states.disableDelete=true;}
return states;},getIntStatus:function(status){var retStat=status;if(status==this.statusApproved){retStat=this.statusIntApproved;}else if(status==this.statusApprovedWithDraft){retStat=this.statusIntApprovedWithDraft;}else if(status==null||status==0){retStat=this.statusIntDraft;}
return retStat;},newTemplate:function(parms){var parentId=parms.parentId;var accessZoneId=parms.accessZoneId;var animEl=parms.el;var cloneFromId=parms.cloneFromId;var cloneFromName=parms.cloneFromName;if(cloneFromId!=null&&cloneFromName!=null){var title="Clone to Template";var fht=360;var cloneFromHtml='<tr id="lptCloneRow">'+'  <td class="mktForm2Label">From Template:</td>'+'  <td class="mktForm2Field">'+cloneFromName+'  </td> <input type="hidden" id="cloneFromId" name="cloneFromId" value="'+cloneFromId+'" />'+'</tr>';}else{var title="New Template";var fht=310;}
var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div id="lptNewTemplateForm">'+'  <form id="lptNewTemplateSubmitForm" onsubmit="return false;">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <input type="hidden" id="parentId" name="parentId" value="'+(parentId?parentId:'')+'" />'+(cloneFromHtml||'')+'      <input type="hidden" id="accessZoneId" name="accessZoneId" value="'+(accessZoneId?accessZoneId:'')+'" />'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">New Template Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" id="lptName" name="lptName" tabindex="1" value="" title="Template Name" maxlength="240"/>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" name="lptDescr" tabindex="2" title="Description" rows="4"></textarea>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="">'+'        <td class="mktForm2Label">&nbsp;</td>'+'        <td class="mktForm2Field">'+'            <input type="checkbox" class="mktCheckbox" tabindex="3" checked="checked" id="lptTemplateOpenEditor" name="lptTemplateOpenEditor" />'+'            <label for="lptTemplateOpenEditor">Open template editor for new template</label>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:title,iconCls:'mkiWindow',okButtonTitle:'Create',width:655,height:fht});mp.show(animEl,this.newTemplateSubmit.createDelegate(this));},newTemplateSubmit:function(){var openEditor=Ext.get('lptTemplateOpenEditor').dom.checked;MktSession.ajaxRequest('/lpTemplate/createLpTemplate',{serializeForm:'lptNewTemplateSubmitForm',onMySuccess:this.newTemplateDone.createDelegate(this,[Mkt.util.Common.isValueTrue(openEditor)])});return false;},newTemplateDone:function(openEditor){var newLpTemplateId=MktPage.appVars.newLpTemplateId;if(MktPage.appVars.result==MktSession.resultSuccess){if(openEditor&&MktPage.appVars.newLpTemplateId){this.openTemplateEditor(MktPage.appVars.newLpTemplateId);}
if(newLpTemplateId){MktMainNav.loadLanding({lpgType:'template',lpgId:newLpTemplateId});delete MktPage.appVars.newLpTemplateId;}}},editTemplate:function(id){this.openTemplateEditor(id);},approveTemplate:function(ids){Ext.MessageBox.show({title:'Please wait...',msg:'Approving Landing Page Template',progress:true,wait:true,width:240,closable:false});MktSession.ajaxRequest("/lpTemplate/approve",{serializeParms:{ids:Ext.encode(ids)},onMySuccess:this.commonActionDone.createDelegate(this,[this.statusApproved])});},unapproveTemplate:function(ids){Ext.MessageBox.show({title:'Please wait...',msg:'Unapproving Landing Page Template',progress:true,wait:true,width:245,closable:false});MktSession.ajaxRequest("/lpTemplate/unapprove",{serializeParms:{ids:Ext.encode(ids)},onMySuccess:this.commonActionDone.createDelegate(this,[this.statusDraft])});},importTemplate:function(action){var accessZoneId=action.accessZoneId;var sels=Mkt.util.Common.getSelections(action);var parentId=(sels&&sels.length>=1)?sels[0].nodeId:undefined;mktLPTManager.driveUploadTemplate(Ext.getDom(action.el),parentId,accessZoneId);},exportTemplate:function(action){Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>=1){mktLPTManager.prototype.driveDownloadTemplate(sels[0].id);}},hasApprovedVersion:function(status){var intStatus=this.getIntStatus(status);return(intStatus==this.statusIntApproved||intStatus==this.statusIntApprovedWithDraft);},deleteTemplate:function(ids,name,animEl){if(isUndefined(ids)){return;}
var msg;if(ids.length==1){msg="Are you sure you want to delete <b>"+name+"</b>?";}else if(ids.length>1){msg="Are you sure you want to delete mulitple landing page templates?";}else{return;}
MktMessage.confirmDelete('Delete Template?',msg,function(){MktSession.ajaxRequest('/lpTemplate/delete',{serializeParms:{lptIds:Ext.encode(ids)},onMySuccess:this.deleteTemplateDone.createDelegate(this,[ids,animEl])});}.createDelegate(this),animEl);},deleteTemplateDone:function(ids,animEl){var result=MktPage.appVars.result;if(result==MktSession.resultFailed){if(MktPage.appVars.errMsg&&MktPage.appVars.errMsg.length>0){MktMessage.showWarning(MktPage.appVars.errMsg,undefined,animEl);}}else if(result==MktSession.resultSuccess){var tab=MktCanvas.getTab(this.detailCanvasId);var convIds=Mkt.util.Common.convertArrayValueToString(ids);if(tab&&convIds.indexOf((tab.config.compId))!=-1){if(MktCanvas.isActiveTab(tab.id)){MktCanvas.setActiveTab(this.overviewCanvasId);}
MktCanvas.remove(tab);}}
if(isDefined(MktPage.appVars.result)){delete MktPage.appVars.result;}
if(isDefined(MktPage.appVars.errMsg)){delete MktPage.appVars.errMsg;}},openTemplateEditor:function(lptId){if(isUndefined(lptId)){return;}
var url=MktPage.savedState.xdEditorBaseUrl+MktSession.getUrlPrefix()+"/lpteditor/editor?lptId="+
lptId+"&"+Mkt.util.XdMessaging.getSourceDomainQueryString();Mkt.util.Common.xdLogin(function(url){window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}.createDelegate(this,[url]));},preview:function(lptId,draft){var draftQString="";if(isDefined(lptId)){if(draft){draftQString="&draft=true";}
var url=MktPage.savedState.xdEditorBaseUrl+MktSession.getUrlPrefix()+"/lpteditor/preview?lptId="+lptId+draftQString;Mkt.util.Common.xdLogin(function(url){window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}.createDelegate(this,[url]));}},discardDraft:function(lptIds){if(isDefined(lptIds)){MktSession.clockCursor(true);MktSession.ajaxRequest("/lpTemplate/discardDraft",{serializeParms:{lptIds:Ext.encode(lptIds)},onMySuccess:this.commonActionDone.createDelegate(this,[this.statusApproved])});}},markTemplateDirty:function(lptId,nodeJson){if(!nodeJson||!lptId){return;}
if(MktExplorer)MktExplorer.replaceNodes(nodeJson);var activeTab=MktCanvas.getActiveTab();if(activeTab){var grid=activeTab.getGridPanel();if(grid){var rec=grid.getStore().getById(lptId);if(rec){var status=rec.data['status'];if(rec&&status==this.statusApproved){rec.data['status']=this.statusApprovedWithDraft;grid.getView().refreshRow(rec);}}}}
this.commonActionDone(this.statusApprovedWithDraft,[lptId],MktSession.resultSuccess);},commonActionDone:function(status,ids,result){var ids=ids||MktPage.appVars.ids;var result=result||MktPage.appVars.result;if(result==MktSession.resultSuccess){var canvas=MktCanvas.getTab(this.detailCanvasId);if(canvas){var currStatus=MktPage.appVars.status;if(status==this.statusApprovedWithDraft&&currStatus==this.statusDraft){}else{var convIds=Mkt.util.Common.convertArrayValueToString(ids);if(convIds.indexOf((canvas.config.compId))!=-1){var statusEl=Ext.get("lpTmDashStatus");if(statusEl){statusEl.update(this.renderedDetailStatus(status));}
MktPage.appVars.status=status;}}}}else if(result==MktSession.resultFailed){var errMsg=MktPage.appVars.errMsg;if(errMsg&&errMsg.length>0){MktMessage.showWarning(errMsg);}}
if(MktPage.appVars.result){delete MktPage.appVars.result;}
if(MktPage.appVars.ids){delete MktPage.appVars.ids;}
if(MktPage.appVars.errMsg){delete MktPage.appVars.errMsg;}
Ext.MessageBox.hide();MktSession.clockCursor(false);},renderedDetailStatus:function(status){var rv;if(status==this.statusDraft){rv="<img src='/images/icons16/window.png' />Draft";}else if(status==this.statusApproved){rv="<img src='/images/icons16/window_ok.png' />Approved";}else{rv="<img src='/images/icons16/window_edit.png' />Approved with draft";}
return rv;}};
/* ========== mktDs.js ============ */

Ext.namespace('Mkt','Mkt.app','Mkt.app.DesignStudio');(function(){var ds=Mkt.app.DesignStudio;ds.Images={getActionStates:function(attr){var states={disableReplace:true,disablePreview:true,disableDelete:true,disableViewDetails:true,showSeparator:true,showGrabFromWebPage:true,showUploadImage:false,showReplaceImage:false,showViewDetails:true};var sels=Mkt.util.Common.getSelections(attr);if(sels&&sels.length>0){switch(sels[0].source){case"grid":(sels.length>1)?(states.disableDelete=false):(states.disableReplace=states.disableViewDetails=states.disablePreview=states.disableDelete=false);break;case"tree":states.disableReplace=states.disableDelete=states.disableViewDetails=states.disablePreview=false;break;case"tab":states.disableReplace=states.disablePreview=states.disableDelete=false;states.showViewDetails=states.showSeparator=false;break;}}
return states;},previewImage:function(action){if(isUndefined(action)||isUndefined(action.triggeredFrom)){return;}
Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid',appVarsUrl:'imFullURL'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktLPIManager.staticViewImage(sels[0].id,sels[0].url);}},deleteImage:function(action){if(isUndefined(action)||isUndefined(action.triggeredFrom)){return;}
var parentFolderId=null;Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid',appVarsUrl:'imURL'});var sels=Mkt.util.Common.getSelections(action);if(sels.length==1){mktLPIManager.staticConfirmDeleteImage(sels[0].id,sels[0].text,action.el);}else if(sels.length>1){ds.Common.deleteObjects('image','landingCanvasIM',undefined,action.el);}}};ds.Pages={overviewPanelId:'landingCanvasLP',detailTabId:'landingLPDetail',detailPanelId:'lpDetailTitle',parmsPrefix:'dpageid_',appVarsIdName:'lpOid',appVarsStatusName:'lpStatus',appVarsTypeName:'lpType',appVarsCompType:'compType',appVarsCompSubtype:'compSubtype',appVarsUrl:'lpURLPath',draftStatus:0,approvedStatus:1,dirtyStatus:2,TypeLandingPage:0,TypeTestedPage:1,landingPage:'Landing Page',landingPageTestGroup:'Landing Page Test Group',getActionStates:function(action){var states={disableEdit:false,disablePreview:false,disableClone:false,disableConvertToTestGroup:false,disableDelete:false,disableUnapprove:true,disableEditDraft:false,disablePreviewDraft:false,disableApproveDraft:true,disableDiscardDraft:true,disableUrlBuilder:false,disableViewDetails:false,showPreview:true,showViewDetails:true,showConvertToTestGroup:true,showUrlBuilder:true,showSeparator:true,showMove:true};Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName,appVarsStatus:this.appVarsStatusName,appVarsType:this.appVarsTypeName});var sels=Mkt.util.Common.getSelections(action);if(isArray(sels)){states.selCount=sels.length;}
if(sels&&sels.length>0){switch(sels[0].source){case"grid":if(sels.length==1){states.disableViewDetails=states.disablePreview=states.disableUrlBuilder=states.disableConvertToTestGroup=states.disableClone=states.disablePreviewDraft=states.disableEdit=false;if(sels[0].lpType==this.TypeTestedPage){states.disableConvertToTestGroup=true;states.showMove=false;}}
else{states.disableConvertToTestGroup=states.disableViewDetails=states.disablePreview=states.disableUrlBuilder=states.showViewDetails=states.showSeparator=states.disableClone=states.disablePreviewDraft=states.disableEdit=true;}
break;case"tree":states.disableDelete=states.disableExport=states.disableViewDetails=false;break;case"tab":states.disableViewDetails=states.disablePreview=states.disableUrlBuilder=states.showViewDetails=states.showSeparator=states.disableConvertToTestGroup=states.disableClone=states.disablePreviewDraft=states.disableEdit=states.disableDelete=false;break;}
if(sels[0].status==this.approvedStatus){states.disablePreviewDraft=true;states.disableUnapprove=false;}else if(sels[0].status==this.dirtyStatus){states.disableDiscardDraft=states.disableApproveDraft=states.disableUnapprove=false;}else{states.disableApproveDraft=false;}
var compType=sels[0].compType;var compSubtype=sels[0].compSubtype;if(compType==this.landingPage&&compSubtype==this.landingPageTestGroup){this.getTestActionStates(action,sels,states);}else if(compType==this.landingPageTestGroup&&compSubtype==this.landingPageTestGroup){states.disableConvertToTestGroup=states.disableClone=states.disableEdit=true;states.showPreview=states.showConvertToTestGroup=states.showMove=false;}}else{states.disableViewDetails=states.disablePreview=states.disableUrlBuilder=states.showViewDetails=states.showSeparator=states.disableConvertToTestGroup=states.disableClone=states.disablePreviewDraft=states.disableEdit=states.disableDelete=true;var tab=MktCanvas.getActiveTab();if(tab&&tab.cName==this.detailTabId){var appVars=MktPage.appVars;if(appVars[this.appVarsCompType]==this.landingPageTestGroup&&appVars[this.appVarsCompSubtype]==this.landingPageTestGroup){this.getTestActionStates(action,sels,states);}else{states.showUrlBuilder=states.showConvertToTestGroup=states.showMove=appVars[action.appVarsType]==this.TypeTestedPage?false:true;}}}
return states;},getTestActionStates:function(action,sels,states){states.showConvertToTestGroup=false;states.showUrlBuilder=false;states.showMove=false;},getTestGroupActionStates:function(action){var states={showUndeployTestGroup:false,showDeployTestGroup:true};Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName,appVarsStatus:this.appVarsStatusName,appVarsType:this.appVarsTypeName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){switch(sels[0].source){case"grid":if(sels.length==1){}
else{}
break;case"tree":break;case"tab":break;}
states.showDeployTestGroup=(sels[0].status==this.draftStatus||(sels[0].status==this.dirtyStatus));states.showUndeployTestGroup=!states.showDeployTestGroup;}else{}
if(action.triggeredFrom=="button"){}
return states;},editPage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.openLPEditor(sels[0].id);}},previewPage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.openLPPreview(sels[0].nodeId,sels[0].id,true);}},clonePage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else if(sels&&sels.length>0&&sels[0].json&&sels[0].json.marketingProgramId){marketingProgramId=sels[0].json.marketingProgramId;}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels&&sels.length>0){mktLPLManager.driveCreatePageModal(action.el,sels[0].id,null,null,null,marketingProgramId);}},movePage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels&&sels.length>0){var name;if(sels[0].name){name=sels[0].name;}
else{name=sels[0].lpName;}
mktLPLManager.movePage(action.el,sels[0].id,name,marketingProgramId);}},convertToTestGroup:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.convertToTestGroup(sels[0].id);}},deletePage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName,appVarsStatus:this.appVarsStatusName,appVarsType:this.appVarsTypeName,appVarsCompType:this.appVarsCompType});var sels=Mkt.util.Common.getSelections(action);if(sels.length==1){mktLPLManager.staticConfirmDeleteSelectedPage(sels[0].id,sels[0].text,sels[0].status,sels[0].compType,action.el);}else if(sels.length>1){ds.Common.deleteObjects('page',this.overviewPanelId,this.detailTabId,action.el);}},approve:function(action){var sels=Mkt.util.Common.getSelections(action);if(sels){var parms=ds.Common.getIds(sels,this.parmsPrefix);mktLPLManager.doModifyPages('deploy',parms);}},unApprovePage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var unapproveAction=function(pageName,skipRedirectCheck){var parms=ds.Common.getIds(sels,this.parmsPrefix);parms.skipRedirectCheck=skipRedirectCheck||false;mktLPLManager.doModifyPages('undeploy',parms,pageName);}.createDelegate(this);if(MktPage.appVars.lpRedirections&&MktPage.appVars.lpRedirections.length>0){MktMessage.showUnapproveConfirmation(String.format(Mkt.apps.lpSettings.Actions.unapproveConfirmation,sels[0].name),unapproveAction.createDelegate(this,[sels[0].name,true]),'Unapprove Landing Page?',action.animEl);}
else{unapproveAction(sels[0].name);}}},editPageDraft:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.openLPEditor(sels[0].id);}},previewPageDraft:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.openLPPreview(sels[0].nodeId,sels[0].id,false);}},discardDraft:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var parms=ds.Common.getIds(sels,this.parmsPrefix);mktLPLManager.doModifyPages('revert',parms);}},urlBuilder:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.doUrlBuilder(sels[0].id,action.el);}},newTestedPage:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsId:this.appVarsIdName});var marketingProgramId=null;if(action&&action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else{var tab=MktCanvas.getActiveTab();if(tab&&tab.config&&tab.config.marketingProgramId){marketingProgramId=tab.config.marketingProgramId;}}
var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.driveCreatePageModal(action.el,null,sels[0].id,null,null,marketingProgramId);}},deleteTestGroup:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsStatus:this.appVarsStatusName,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktLPLManager.staticConfirmDeleteSelectedPage(sels[0].id,sels[0].text,sels[0].status,sels[0].subType,action.el);}},deployTestGroup:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsStatus:this.appVarsStatusName,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var parms={};parms['dpageid_'+sels[0].id]='dpageid_'+sels[0].id;mktLPLManager.doModifyPages('deploy',parms);}},undeployTestGroup:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsStatus:this.appVarsStatusName,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var parms={};parms['dpageid_'+sels[0].id]='dpageid_'+sels[0].id;if(MktPage.appVars.lpRedirections&&MktPage.appVars.lpRedirections.length>0){MktMessage.showUnapproveConfirmation(String.format(Mkt.apps.lpSettings.Actions.unapproveConfirmation,sels[0].name),function(parms){mktLPLManager.doModifyPages('undeploy',parms);}.createDelegate(this,[parms]),'Unapprove Test Group?',action.el);}
else{mktLPLManager.doModifyPages('undeploy',parms);}}},convertToTestGroup:function(action){Ext.apply(action,{appVarsName:this.detailPanelId,appVarsStatus:this.appVarsStatusName,appVarsId:this.appVarsIdName});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var marketingProgramId=null;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
mktLPLManager.convertToTestGroup(sels[0].id,marketingProgramId);}}};ds.Forms={editForm:function(action){Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktLPFManager.openFormEditor(sels[0].id,sels[0].name);}},cloneForm:function(action){Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid'});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;var accessZoneId="";if(action.xtra&&action.xtra.accessZoneId){accessZoneId=action.xtra.accessZoneId;}
if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else if(sels&&sels.length>0&&sels[0].json&&sels[0].json.marketingProgramId){marketingProgramId=sels[0].json.marketingProgramId}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels.length>0){mktLPFManager.driveCreateFormModal(action.el.dom,sels[0].id,sels[0].name,null,accessZoneId,marketingProgramId);}},moveForm:function(action){Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid'});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels&&sels.length>0){if(sels[0].id&&sels[0].name){mktLPFManager.moveForm(sels[0].id,sels[0].name,marketingProgramId);}}},deleteForm:function(action){Ext.apply(action,{appVarsName:'lpDetailTitle',appVarsId:'lpOid'});var sels=Mkt.util.Common.getSelections(action);if(sels.length==1){mktLPFManager.staticConfirmDeleteForm(sels[0].id,sels[0].text,action.el);}else if(sels.length>1){ds.Common.deleteObjects('form','landingCanvasFO',undefined,action.el);}},getActionStates:function(action){var states={showNewForm:false,showRefreshAvailableFields:false,showViewDetails:true,showSeparator:true,disableEdit:true,disableClone:true,disableDelete:true,disableViewDetails:true};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){switch(sels[0].source){case"grid":states.disableDelete=false;(sels.length>1)?null:(states.disableEdit=states.disableClone=states.disableViewDetails=false);break;case"tree":states.disableDelete=states.disableEdit=states.disableClone=states.disableViewDetails=false;break;case"tab":states.disableDelete=states.disableClone=states.disableEdit=false;states.showViewDetails=states.showSeparator=false;break;}}
if(action.triggeredFrom=="button"){states.showNewForm=true;}
return states;}};ds.Emails={draftStatus:1,approvedStatus:2,draftStatusText:'Draft',approvedStatusText:'Approved',dirtyStatusText:'Approved with draft',getActionStates:function(action){var states={disableEdit:false,disablePreview:false,disableSendTest:false,disableClone:false,disableDelete:false,disableApproveEmail:false,disableUnapproveEmail:true,disableEditDraft:true,disablePreviewDraft:true,disableSendTestDraft:true,disableApproveDraft:true,disableDiscardDraft:true,disableReturnPath:true};Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(isArray(sels)){states.selCount=sels.length;}
if(sels&&sels.length>0){switch(sels[0].source){case"tab":case"grid":if(sels.length==1){states.disableReturnPath=false;switch(sels[0].status){case this.dirtyStatusText:states.disableEdit=true;states.disableEditDraft=states.disablePreviewDraft=states.disableSendTestDraft=states.disableApproveDraft=states.disableDiscardDraft=false;case this.approvedStatusText:states.disableApproveEmail=true;states.disableUnapproveEmail=false;break;}}
else{states.disableEdit=states.disablePreview=states.disableSendTest=states.disableClone=true;var foundDraft=foundApproved=foundDirty=false;for(var i=0;i<sels.length;i++){switch(sels[i].status){case this.draftStatusText:foundDraft=true;break;case this.approvedStatusText:foundApproved=true;break;case this.dirtyStatusText:foundDirty=true;break;}}
states.disableApproveEmail=!foundDraft;states.disableUnapproveEmail=!foundApproved;states.disableApproveDraft=states.disableDiscardDraft=!foundDirty;}
break;case"tree":var data=mktEmManager.remapNodeAttr(action);if(data.status==this.approvedStatus){states.disableApproveEmail=true;states.disableUnapproveEmail=false;if(data.hasDraft){states.disableEdit=true;states.disableEditDraft=states.disablePreviewDraft=states.disableApproveDraft=states.disableSendTestDraft=states.disableApproveDraft=states.disableDiscardDraft=false;}}
break;}}else{states.disableEdit=states.disablePreview=states.disableSendTest=states.disableClone=states.disableDelete=states.disableApproveEmail=true;}
return states;},previewEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.previewEmail(sels[0].id,sels[0].name);}},sendTestEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktEmManager.sendTestEmail(sels[0].id);}},moveEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels&&sels.length>0){mktEmManager.moveEmail(sels[0].id,sels[0].name,marketingProgramId);}},cloneEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);var marketingProgramId;if(action.xtra&&action.xtra.marketingProgramId){marketingProgramId=action.xtra.marketingProgramId;}
else if(sels&&sels.length>0&&sels[0].json&&sels[0].json.marketingProgramId){marketingProgramId=sels[0].json.marketingProgramId}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
if(sels&&sels.length>0){mktEmManager.driveCreateEmailModal(action.el,sels[0].id,null,null,marketingProgramId);}},deleteEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var emails=[];for(var i=0;i<sels.length;i++){emails.push({data:sels[i]});}
mktEmManager.deleteEmails(emails,action.el);}},unapproveEmail:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.unapproveEmail(ids);}},downloadEmailHtml:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.downloadEmailHtml(sels[0].id);}},editDraft:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.editDraft(sels[0].id,sels[0].name,sels[0].hasDraft);}},previewDraft:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.previewDraft(sels[0].id,sels[0].name);}},sendTestDraft:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktEmManager.sendTestEmail(sels[0].id,true);}},approveDraft:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.approveDraft(ids);}},discardDraft:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.discardDraft(ids);}},gotoDeliverability:function(action){Ext.apply(action,{appVarsName:'emailName',appVarsId:'detailEmailId',appVarsHasDraft:'emailHasDraft',appVarsStatus:'emailStatus',appVarsUsedBy:'emailUsedBy'});var ids=[];mktEmManager.gotoDeliverability(ids);}};ds.EmailTemplates={draftStatus:1,approvedStatus:2,draftStatusText:'Draft',approvedStatusText:'Approved',dirtyStatusText:'Approved with draft',getActionStates:function(action){var states={disableEdit:false,disablePreview:false,disableSendTest:false,disableClone:false,disableDelete:false,disableApproveTemplate:false,disableUnapproveTemplate:true,disableEditDraft:true,disablePreviewDraft:true,disableSendTestDraft:true,disableApproveDraft:true,disableDiscardDraft:true};Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(isArray(sels)){states.selCount=sels.length;}
if(sels&&sels.length>0){switch(sels[0].source){case"tab":case"grid":if(sels.length==1){switch(sels[0].status){case this.dirtyStatusText:states.disableEdit=true;states.disableEditDraft=states.disablePreviewDraft=states.disableSendTestDraft=states.disableApproveDraft=states.disableDiscardDraft=false;case this.approvedStatusText:states.disableApproveTemplate=true;states.disableUnapproveTemplate=false;break;}}
else{states.disableEdit=states.disablePreview=states.disableSendTest=states.disableClone=true;var foundDraft=foundApproved=foundDirty=false;for(var i=0;i<sels.length;i++){switch(sels[i].status){case this.draftStatusText:foundDraft=true;break;case this.approvedStatusText:foundApproved=true;break;case this.dirtyStatusText:foundDirty=true;break;}}
states.disableApproveTemplate=!foundDraft;states.disableUnapproveTemplate=!foundApproved;states.disableApproveDraft=states.disableDiscardDraft=!foundDirty;}
break;case"tree":var data=mktEmManager.remapNodeAttr(action);if(data.status==this.approvedStatus){states.disableApproveTemplate=true;states.disableUnapproveTemplate=false;if(data.hasDraft){states.disableEdit=true;states.disableEditDraft=states.disablePreviewDraft=states.disableApproveDraft=states.disableSendTestDraft=states.disableApproveDraft=states.disableDiscardDraft=false;}}
break;}}else{states.disableEdit=states.disablePreview=states.disableSendTest=states.disableClone=states.disableDelete=states.disableApproveTemplate=true;}
return states;},previewTemplate:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.previewTemplate(sels[0].id,sels[0].name);}},sendTestTemplate:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var useDraft=false;if(sels[0].source=="tree"){var data=mktEmManager.remapNodeAttr(action);useDraft=data.status==this.draftStatus;}
else{useDraft=sels[0].status==this.draftStatusText;}
mktEmManager.sendTestTemplate(sels[0].id,useDraft);}},cloneTemplate:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktEmManager.driveCreateTemplateModal(action.el,sels[0].id,undefined,accessZoneId);}},deleteTemplate:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var templates=[];for(var i=0;i<sels.length;i++){templates.push({data:sels[i]});}
mktEmManager.deleteTemplates(templates,action.el);}},unapproveTemplate:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.unapproveTemplate(ids);}},editTemplateDraft:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.editTemplateDraft(sels[0].id,sels[0].name,sels[0].hasDraft);}},previewTemplateDraft:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){mktEmManager.previewTemplateDraft(sels[0].id,sels[0].name);}},sendTestTemplateDraft:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){mktEmManager.sendTestTemplate(sels[0].id,true);}},approveTemplateDraft:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.approveTemplateDraft(ids);}},discardTemplateDraft:function(action){Ext.apply(action,{appVarsName:'templateName',appVarsId:'detailTemplateId',appVarsHasDraft:'templateHasDraft',appVarsStatus:'templateStatus',appVarsUsedBy:'templateUsedBy'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktEmManager.discardTemplateDraft(ids);}}};ds.Common={getIds:function(selections,parmsPrefix){var ids={};var parmsPrefix=parmsPrefix||'';for(var i=0;i<selections.length;i++){ids[parmsPrefix+selections[i].id]=parmsPrefix+selections[i].id;}
return ids;},deleteObjects:function(type,panelId,detailTabId,animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var sels=grid.getSelectionModel().getSelections();if(sels.length>0){var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
mktLandingManager.prototype.driveDeleteObjects.call({oTypeText:type,panelId:panelId,detailPanelId:detailTabId},ids,animEl);}}},getShortType:function(longType){var lpgType=longType.toLowerCase();switch(lpgType){case'landing page':lpgType='page';break;case'landing page form':lpgType='form';break;case'landing page template':lpgType='template';break;case'email template':lpgType='emailTemplate';break;}
return lpgType;},viewDetails:function(action){if(isUndefined(action)||isUndefined(action.triggeredFrom)){return;}
Ext.apply(action,{appVarsName:action.appVarsName||'lpDetailTitle',appVarsId:action.appVarsName||'lpOid'});var sels=Mkt.util.Common.getSelections(action);if(sels.length>=1){MktMainNav.loadLanding(Ext.apply(action,sels[0],{type:'Landing',lpgId:sels[0].id}));}}};})();
/* ========== mktDsMenu.js ============ */

Ext.namespace('MktDsMenu');(function(){MktDsMenu.menuItemPool={newLandingPage:{text:'New Landing Page',itemId:'newLandingPage',iconCls:'mkiWebpage',handler:function(el){var parentId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'compId');var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);mktLPLManager.driveCreatePageModal(el.getEl(),null,null,parentId,accessZoneId);el.parentMenu.hide(true);if(el.parentMenu.currNode){delete el.parentMenu.currNode;}}},pageEdit:{text:'Edit Draft',itemId:'pageEdit',iconCls:'mkiWebpageEdit',handler:function(el){Mkt.app.DesignStudio.Pages.editPageDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},pageDraftEdit:{text:'Edit Draft',itemId:'pageDraftEdit',iconCls:'mkiWebpageEdit',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Pages.editPageDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},pagePreview:{text:'Preview',itemId:'pagePreview',iconCls:'mkiWebpageView',handler:function(el){Mkt.app.DesignStudio.Pages.previewPage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},pageDraftPreview:{text:'Preview Draft',itemId:'pageDraftPreview',iconCls:'mkiWebpageView',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Pages.previewPageDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},pageClone:{text:'Clone',itemId:'pageClone',iconCls:'mkiWebpageAdd',handler:function(el){Mkt.app.DesignStudio.Pages.clonePage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},pageMove:{text:'Move',itemId:'pageMove',iconCls:'mkiTextRichExit',handler:function(el){Mkt.app.DesignStudio.Pages.movePage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},pageConvertToTestGroup:{text:'Convert to Test Group',itemId:'pageConvertToTestGroup',iconCls:'mkiCustAbtest',handler:function(el){Mkt.app.DesignStudio.Pages.convertToTestGroup({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},pageDelete:{text:'Delete',itemId:'pageDelete',iconCls:'mkiWebpageDelete',handler:function(el){Mkt.app.DesignStudio.Pages.deletePage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:el.getEl()});el.parentMenu.hide(true);}},pageApprove:{text:'Approve',itemId:'pageApprove',iconCls:'mkiWebpageOk',handler:function(el){Mkt.app.DesignStudio.Pages.approve({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,appVarsId:'lpOid',appVarsName:'lpDetailTitle'});el.parentMenu.hide(true);}},pageDraftApprove:{text:'Approve Draft',itemId:'pageDraftApprove',iconCls:'mkiWebpageOk',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Pages.approve({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,appVarsId:'lpOid',appVarsName:'lpDetailTitle'});el.parentMenu.hide(true);}},pageUnapprove:{text:'Unapprove',itemId:'pageUnapprove',iconCls:'mkiWebpageForbidden',handler:function(item){Mkt.app.DesignStudio.Pages.unApprovePage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:item.parentMenu.xtra,animEl:item.getEl()});item.parentMenu.hide(true);}},pageDraftDiscard:{text:'Discard Draft',itemId:'pageDraftDiscard',iconCls:'mkiWebpageDelete',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Pages.discardDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},urlBuilder:{text:'URL builder',itemId:'urlBuilder',iconCls:'mkiWebpageInformation',handler:function(el){var action={triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:el.getEl()};var tab=MktCanvas.getActiveTab();if(tab&&tab.config.id=='landingLPDetail'){action.forceGetInfoFrom='appVars';}
Mkt.app.DesignStudio.Pages.urlBuilder(action);el.parentMenu.hide(true);}},newTestGroup:{text:'New Test Group',itemId:'newTestGroup',iconCls:'mkiCustAbtest',handler:function(el){var currNode=el.parentMenu.currNode;var nodeId=currNode?currNode.attributes.id:undefined;var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);mktLPLManager.driveCreateTestModal(el.getEl(),nodeId,accessZoneId);el.parentMenu.hide(true);}},editGroupMembers:{text:'Edit Group Members',itemId:'editGroupMembers',iconCls:'mkiCustAbtestInformation',handler:function(el){var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,forceGetInfoFrom:(this.parentMenu.triggeredFrom=='button')?'appVars':undefined,appVarsId:'lpTGid',xtra:el.parentMenu.xtra});if(sels.length>0){var marketingProgramId=null;if(this.parentMenu.currNode&&this.parentMenu.currNode.attributes&&this.parentMenu.currNode.attributes.marketingProgramId){marketingProgramId=this.parentMenu.currNode.attributes.marketingProgramId;}
if(!marketingProgramId){var tab=MktCanvas.getActiveTab();if(tab&&tab.config&&tab.config.marketingProgramId){marketingProgramId=tab.config.marketingProgramId;}}
mktLPLManager.editTGMembersModal(sels[0].id,el.getEl(),marketingProgramId);}
el.parentMenu.hide(true);}},newTestedPage:{text:'New Tested Page',itemId:'newTestedPage',iconCls:'mkiCustAbtestAdd',handler:function(el){Mkt.app.DesignStudio.Pages.newTestedPage({triggeredFrom:this.parentMenu.triggeredFrom,el:el.getEl(),forceGetInfoFrom:(this.parentMenu.triggeredFrom=='button')?'appVars':undefined,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},deleteTestGroup:{text:'Delete Test Group',itemId:'deleteTestGroup',iconCls:'mkiCustAbtestDelete',handler:function(el){Mkt.app.DesignStudio.Pages.deleteTestGroup({triggeredFrom:this.parentMenu.triggeredFrom,el:el.getEl(),forceGetInfoFrom:(this.parentMenu.triggeredFrom=='button')?'appVars':undefined,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},deployTestGroup:{text:'Approve Test Group',itemId:'deployTestGroup',iconCls:'mkiCustAbtestOk',handler:function(el){Mkt.app.DesignStudio.Pages.deployTestGroup({triggeredFrom:this.parentMenu.triggeredFrom,el:el.getEl(),forceGetInfoFrom:(this.parentMenu.triggeredFrom=='button')?'appVars':undefined,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},undeployTestGroup:{text:'Unapprove Test Group',itemId:'undeployTestGroup',iconCls:'mkiCustAbtestLock',handler:function(el){Mkt.app.DesignStudio.Pages.undeployTestGroup({triggeredFrom:this.parentMenu.triggeredFrom,el:el.getEl(),forceGetInfoFrom:(this.parentMenu.triggeredFrom=='button')?'appVars':undefined,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},pausePage:{text:'Pause Page',itemId:'pausePage',iconCls:'mkiMediaPause',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});parms['dpageid_'+(sels[0].id)]='dpageid_'+(sels[0].id);mktLPLManager.doModifyPages('pause',parms);el.parentMenu.hide(true);}},activatePage:{text:'Activate Page',itemId:'activatePage',iconCls:'mkiMediaPlayGreen',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});parms['dpageid_'+(sels[0].id)]='dpageid_'+(sels[0].id);mktLPLManager.doModifyPages('unpause',parms);el.parentMenu.hide(true);}},newPageTemplate:{text:'New Landing Page Template',itemId:'newPageTemplate',iconCls:'mkiWindow',handler:function(el){var parentId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'compId');var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);var parms={parentId:parentId,accessZoneId:accessZoneId,el:el.getEl()};var templates=Mkt.app.DesignStudio.Templates;templates.newTemplate.call(templates,parms);if(el.parentMenu.currNode){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}},clonePageTemplate:{text:'Clone',itemId:'clonePageTemplate',iconCls:'mkiWindow',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){if(sels[0].source=="tree"&&el.parentMenu.currNode){var currNodeAttr=el.parentMenu.currNode.attributes;if(currNodeAttr.folder&&!currNodeAttr.xtra.hasDraftNode){parms.fParentId=el.parentMenu.currNode.id;}else{parms.cloneFromId=currNodeAttr.xtra.compId;parms.cloneFromName=currNodeAttr.text;}
delete el.parentMenu.currNode;}else{parms.cloneFromId=sels[0].id;parms.cloneFromName=sels[0].text;}
parms.el=el.getEl();var templates=Mkt.app.DesignStudio.Templates;templates.newTemplate.call(templates,parms);}
el.parentMenu.hide(true);}},editPageTemplate:{text:'Edit Draft',itemId:'editPageTemplate',iconCls:'mkiWindowEdit',handler:function(el){el.parentMenu.hide(true);var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.editTemplate.call(templates,sels[0].id);}}},editPageTemplateDraft:{text:'Edit Draft',itemId:'editPageTemplateDraft',iconCls:'mkiWindowEdit',cls:'mktMenuIndent',handler:function(el){el.parentMenu.hide(true);var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.editTemplate.call(templates,sels[0].id);}}},pageTemplateImport:{text:'Import Template',itemId:'pageTemplateImport',iconCls:'mkiImport',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);Mkt.app.DesignStudio.Templates.importTemplate({triggeredFrom:el.parentMenu.triggeredFrom,el:el.getEl(),accessZoneId:accessZoneId,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},approvePageTemplate:{text:'Approve',itemId:'approvePageTemplate',iconCls:'mkiWindowOk',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
templates.approveTemplate.call(templates,ids);}
el.parentMenu.hide(true);}},approveDraftPageTemplate:{text:'Approve Draft',itemId:'approveDraftPageTemplate',iconCls:'mkiWindowOk',cls:'mktMenuIndent',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
templates.approveTemplate.call(templates,ids);}
el.parentMenu.hide(true);}},unapprovePageTemplate:{text:'Unapprove',itemId:'unapprovePageTemplate',iconCls:'mkiWindowForbidden',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
templates.unapproveTemplate.call(templates,ids);}
el.parentMenu.hide(true);}},discardDraftPageTemplate:{text:'Discard Draft',itemId:'discardDraftPageTemplate',iconCls:'mkiWindowDelete',cls:'mktMenuIndent',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
templates.discardDraft.call(templates,ids);}
el.parentMenu.hide(true);}},previewPageTemplate:{text:'Preview',itemId:'previewPageTemplate',iconCls:'mkiWindowView',handler:function(el){el.parentMenu.hide(true);var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',appVarsStatus:'status',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.preview.call(templates,sels[0].id,!templates.hasApprovedVersion(sels[0].status));}}},previewDraftPageTemplate:{text:'Preview Draft',itemId:'previewDraftPageTemplate',iconCls:'mkiWindowView',cls:'mktMenuIndent',handler:function(el){el.parentMenu.hide(true);var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.preview.call(templates,sels[0].id,true);}}},newForm:{text:'New Form',itemId:'newForm',iconCls:'mkiFormBlue',handler:function(el){var parentId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'compId');var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);mktLPFManager.driveCreateFormModal(el.getEl(),null,null,parentId,accessZoneId);if(isDefined(el.parentMenu.currNode)){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}},formEdit:{text:'Edit Form',itemId:'formEdit',iconCls:'mkiFormBlueEdit',handler:function(el){Mkt.app.DesignStudio.Forms.editForm({triggeredFrom:el.parentMenu.triggeredFrom,el:el.getEl(),xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},formClone:{text:'Clone Form',itemId:'formClone',iconCls:'mkiFormBlueAdd',handler:function(el){Mkt.app.DesignStudio.Forms.cloneForm({triggeredFrom:el.parentMenu.triggeredFrom,el:el.getEl(),xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},formMove:{text:'Move',itemId:'formMove',iconCls:'mkiFormBlueExit',handler:function(el){Mkt.app.DesignStudio.Forms.moveForm({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},formDelete:{text:'Delete Form',itemId:'formDelete',iconCls:'mkiFormBlueDelete',handler:function(el){Mkt.app.DesignStudio.Forms.deleteForm({triggeredFrom:el.parentMenu.triggeredFrom,el:el.getEl(),xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},newEmail:{text:'New Email',itemId:'newEmail',iconCls:'mkiMail2',handler:function(el){var parentId;var accessZoneId;var currNode;if(el.parentMenu.currNode){currNode=el.parentMenu.currNode;parentId=Mkt.util.Common.getNodeAttrValue(currNode,'id');delete el.parentMenu.currNode;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);mktEmManager.driveCreateEmailModal(el.getEl(),null,parentId,accessZoneId);el.parentMenu.hide(true);}},emailPreview:{text:'Preview',itemId:'emailPreview',iconCls:'mkiMail2View',handler:function(el){Mkt.app.DesignStudio.Emails.previewEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailSendTest:{text:'Send Test',itemId:'emailSendTest',iconCls:'mkiMail2Forward',handler:function(el){Mkt.app.DesignStudio.Emails.sendTestEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()},false);el.parentMenu.hide(true);}},emailMove:{text:'Move',itemId:'emailMove',iconCls:'mkiMail2Exit',handler:function(el){Mkt.app.DesignStudio.Emails.moveEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailClone:{text:'Clone',itemId:'emailClone',iconCls:'mkiMail2Add',handler:function(el){Mkt.app.DesignStudio.Emails.cloneEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailDelete:{text:'Delete',itemId:'emailDelete',iconCls:'mkiMail2Delete',handler:function(el){Mkt.app.DesignStudio.Emails.deleteEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:el.getEl()});el.parentMenu.hide(true);}},emailApprove:{text:'Approve',itemId:'emailApprove',iconCls:'mkiMail2Ok',handler:function(el){Mkt.app.DesignStudio.Emails.approveDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailUnapprove:{text:'Unapprove',itemId:'emailUnapprove',iconCls:'mkiMail2Forbidden',handler:function(el){Mkt.app.DesignStudio.Emails.unapproveEmail({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailDownloadHtml:{text:'Download HTML',itemId:'emailDownloadHtml',iconCls:'mkiFloppyDiskBlue',handler:function(el){Mkt.app.DesignStudio.Emails.downloadEmailHtml({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailEdit:{text:'Edit Draft',itemId:'emailEdit',iconCls:'mkiMail2Edit',handler:function(el){Mkt.app.DesignStudio.Emails.editDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailDraftEdit:{text:'Edit Draft',itemId:'emailDraftEdit',iconCls:'mkiMail2Edit',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Emails.editDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailDraftPreview:{text:'Preview Draft',itemId:'emailDraftPreview',iconCls:'mkiMail2View',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Emails.previewDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailDraftSendTest:{text:'Send Test of Draft',itemId:'emailDraftSendTest',iconCls:'mkiMail2Forward',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Emails.sendTestDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()},false);el.parentMenu.hide(true);}},emailDraftApprove:{text:'Approve Draft',itemId:'emailDraftApprove',iconCls:'mkiMail2Ok',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Emails.approveDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailDraftDiscard:{text:'Discard Draft',itemId:'emailDraftDiscard',iconCls:'mkiMail2Delete',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.Emails.discardDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},newEmailTemplate:{text:'New Email Template',itemId:'newEmailTemplate',iconCls:'mkiWindow',handler:function(el){var parentId;var accessZoneId;var currNode;if(el.parentMenu.currNode){currNode=el.parentMenu.currNode;parentId=Mkt.util.Common.getNodeAttrValue(currNode,'id');delete el.parentMenu.currNode;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);mktEmManager.driveCreateTemplateModal(el.getEl(),null,parentId,accessZoneId);el.parentMenu.hide(true);}},emailTemplatePreview:{text:'Preview',itemId:'emailTemplatePreview',iconCls:'mkiWindowView',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.previewTemplate({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailTemplateSendTest:{text:'Send Test',itemId:'emailTemplateSendTest',iconCls:'mkiWindowNext',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.sendTestTemplate({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()},false);el.parentMenu.hide(true);}},emailTemplateClone:{text:'Clone',itemId:'emailTemplateClone',iconCls:'mkiWindows',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.cloneTemplate({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailTemplateDelete:{text:'Delete',itemId:'emailTemplateDelete',iconCls:'mkiWindowDelete',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.deleteTemplate({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:el.getEl()});el.parentMenu.hide(true);}},emailTemplateApprove:{text:'Approve',itemId:'emailTemplateApprove',iconCls:'mkiWindowOk',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.approveTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailTemplateUnapprove:{text:'Unapprove',itemId:'emailTemplateUnapprove',iconCls:'mkiWindowForbidden',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.unapproveTemplate({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailTemplateEdit:{text:'Edit Draft',itemId:'emailTemplateEdit',iconCls:'mkiWindowEdit',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.editTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailTemplateDraftEdit:{text:'Edit Draft',itemId:'emailTemplateDraftEdit',iconCls:'mkiWindowEdit',cls:'mktMenuIndent',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.editTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailTemplateDraftPreview:{text:'Preview Draft',itemId:'emailTemplateDraftPreview',cls:'mktMenuIndent',iconCls:'mkiWindowView',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.previewTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()});el.parentMenu.hide(true);}},emailTemplateDraftSendTest:{text:'Send Test of Draft',itemId:'emailTemplateDraftSendTest',cls:'mktMenuIndent',iconCls:'mkiWindowNext',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.sendTestTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra,el:this.getEl()},false);el.parentMenu.hide(true);}},emailTemplateDraftApprove:{text:'Approve Draft',itemId:'emailTemplateDraftApprove',cls:'mktMenuIndent',iconCls:'mkiWindowOk',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.approveTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},emailTemplateDraftDiscard:{text:'Discard Draft',itemId:'emailTemplateDraftDiscard',cls:'mktMenuIndent',iconCls:'mkiWindowDelete',handler:function(el){Mkt.app.DesignStudio.EmailTemplates.discardTemplateDraft({triggeredFrom:this.parentMenu.triggeredFrom,xtra:el.parentMenu.xtra});el.parentMenu.hide(true);}},uploadImage:{text:'Upload Image or File',itemId:'uploadImage',iconCls:'mkiDocumentUp',handler:function(el){var currNode=el.parentMenu.currNode;var nodeId=currNode?currNode.attributes.id:undefined;var nodeName=currNode?currNode.attributes.text:undefined;if(!isDefined(nodeId)){nodeId=Mkt.util.Common.getNodeAttrValue(undefined,'dlZoneFolderId',true);nodeName=Mkt.util.Common.getNodeAttrValue(undefined,'folderName',true);}
mktLPIManager.uploadImageRequest(null,el.getEl(),true,nodeId,nodeName);el.parentMenu.hide(true);}},imagePreview:{text:'View',itemId:'imagePreview',iconCls:'mkiZoomIn',handler:function(el){Mkt.app.DesignStudio.Images.previewImage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:this.parentMenu.xtra});el.parentMenu.hide(true);}},replaceImage:{text:'Replace Image or File',itemId:'replaceImage',iconCls:'mkiDocumentExchange',handler:function(el){var currNode=el.parentMenu.currNode;var nodeId=currNode?currNode.attributes.id:undefined;var nodeName=currNode?currNode.attributes.text:undefined;if(!isDefined(nodeId)){nodeId=Mkt.util.Common.getNodeAttrValue(undefined,'dlZoneFolderId',true);nodeName=Mkt.util.Common.getNodeAttrValue(undefined,'folderName',true);}
replaceAction={triggeredFrom:this.parentMenu.triggeredFrom,xtra:this.parentMenu.xtra,el:el.getEl()};mktLPIManager.uploadImageRequest(null,el.getEl(),true,nodeId,nodeName,replaceAction);el.parentMenu.hide(true);}},imageDelete:{text:'Delete',itemId:'imageDelete',iconCls:'mkiDocumentDelete',handler:function(el){Mkt.app.DesignStudio.Images.deleteImage({triggeredFrom:this.parentMenu.triggeredFrom,xtra:this.parentMenu.xtra,el:el.getEl()});el.parentMenu.hide(true);}},grabFromWebPage:{text:'Grab Images from Webpage',itemId:'grabFromWebPage',iconCls:'mkiHandGrab2',handler:function(el){var currNode=el.parentMenu.currNode;var nodeId=currNode?currNode.attributes.id:undefined;var nodeName=currNode?currNode.attributes.text:undefined;var accessZoneId=currNode?currNode.attributes.accessZoneId:undefined;if(!isDefined(nodeId)){nodeId=Mkt.util.Common.getNodeAttrValue(undefined,'dlZoneFolderId',true);nodeName=Mkt.util.Common.getNodeAttrValue(undefined,'folderName',true);accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);}
mktLPIManager.fetchImagesRequest(null,el.getEl(),null,nodeId,accessZoneId,nodeName);el.parentMenu.hide(true);}},pageTemplateExport:{text:'Export',itemId:'pageTemplateExport',iconCls:'mkiExport2',handler:function(el){Mkt.app.DesignStudio.Templates.exportTemplate({triggeredFrom:el.parentMenu.triggeredFrom,el:el.getEl(),xtra:this.parentMenu.xtra});el.parentMenu.hide(true);}},pageTemplateDelete:{text:'Delete',itemId:'pageTemplateDelete',iconCls:'mkiWindowDelete',handler:function(el){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:this.parentMenu.triggeredFrom,appVarsId:'lpOid',appVarsName:'lpDetailTitle',xtra:el.parentMenu.xtra});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;var ids=[];for(var i=0;i<sels.length;i++){ids.push(sels[i].id);}
templates.deleteTemplate.call(templates,ids,sels[0].text,el.getEl());}
el.parentMenu.hide(true);}}};var fMip=MktFolder.menuItemPool;var dsMip=MktDsMenu.menuItemPool;MktDsMenu.preShowPageMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.Pages.getActionStates(Ext.applyIf(attr,{appVarsCompType:'compType',appVarsCompSubtype:'compSubtype'}));var hasDraftNode=!states.disableDiscardDraft;mItems.get('pagePreview').setDisabled(states.disablePreview);mItems.get('pagePreview').setVisible(states.showPreview);mItems.get('pageEdit').setVisible((!states.disableEdit&&!hasDraftNode)||states.selCount==0);mItems.get('pageEdit').setDisabled(states.disableEdit);mItems.get('pageApprove').setVisible((!states.disableApproveDraft&&!hasDraftNode)||states.selCount==0);mItems.get('pageApprove').setDisabled(states.disableApproveDraft);mItems.get('pageUnapprove').setVisible(!states.disableUnapprove);mItems.get('pageConvertToTestGroup').setDisabled(states.disableConvertToTestGroup);mItems.get('pageConvertToTestGroup').setVisible(states.showConvertToTestGroup);mItems.get('pageClone').setVisible(!states.disableClone||states.selCount==0);mItems.get('pageClone').setDisabled(states.disableClone);mItems.get('pageDelete').setDisabled(states.disableDelete);mItems.get('urlBuilder').setVisible(states.showUrlBuilder);mItems.get('urlBuilder').setDisabled(states.disableUrlBuilder);mItems.get('pageMove').setVisible(states.showMove);mItems.get('pageDraftActionsSeparator').setVisible(hasDraftNode);mItems.get('pageDraftActionsText').setVisible(hasDraftNode);mItems.get('pageDraftEdit').setVisible(hasDraftNode&&!states.disableEdit);mItems.get('pageDraftPreview').setVisible(hasDraftNode&&!states.disablePreviewDraft);mItems.get('pageDraftApprove').setVisible(hasDraftNode&&!states.disableApproveDraft);mItems.get('pageDraftDiscard').setVisible(hasDraftNode&&!states.disableDiscardDraft);return menu;};MktDsMenu.getPageMenu=function(attr){return MktLeadDbMenu.menuFactory("MktDsMenu.PageMenu",dsMip.pageEdit,dsMip.pagePreview,dsMip.pageApprove,dsMip.pageUnapprove,dsMip.pageConvertToTestGroup,dsMip.pageClone,dsMip.pageDelete,dsMip.urlBuilder,dsMip.pageMove,new Ext.menu.Separator({itemId:'pageDraftActionsSeparator'}),{itemId:'pageDraftActionsText',text:'Draft Actions',iconCls:'mkiPencil',cls:'mktMenuGroupText',disabledClass:' ',disabled:true},dsMip.pageDraftEdit,dsMip.pageDraftPreview,dsMip.pageDraftApprove,dsMip.pageDraftDiscard);};MktDsMenu.preShowTemplateMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.Templates.getActionStates(Ext.apply({appVarsStatus:'status'},attr));mItems.get('editPageTemplate').setVisible(states.showEdit).setDisabled(states.disableEdit);mItems.get('previewPageTemplate').setVisible(states.showPreview).setDisabled(states.disablePreview);mItems.get('approvePageTemplate').setVisible(states.showApprove).setDisabled(states.disableApprove);mItems.get('unapprovePageTemplate').setVisible(states.showUnapprove);mItems.get('clonePageTemplate').setVisible(states.showClone).setDisabled(states.disableClone);mItems.get('pageTemplateDelete').setVisible(states.showDelete).setDisabled(states.disableDelete);mItems.get('pageTemplateExport').setVisible(states.showPreview).setDisabled(states.disablePreview);mItems.get('pageTemplateDraftActionsSeparator').setVisible(states.showDraftActions);mItems.get('pageTemplateDraftActionsText').setVisible(states.showDraftActions);mItems.get('editPageTemplateDraft').setVisible(states.showDraftActions);mItems.get('previewDraftPageTemplate').setVisible(states.showDraftActions);mItems.get('approveDraftPageTemplate').setVisible(states.showDraftActions);mItems.get('discardDraftPageTemplate').setVisible(states.showDraftActions);return menu;};MktDsMenu.getTemplateMenu=function(attr){return MktLeadDbMenu.menuFactory({id:"MktDsMenu.TemplateMenu",minWidth:156},dsMip.editPageTemplate,dsMip.previewPageTemplate,dsMip.approvePageTemplate,dsMip.unapprovePageTemplate,dsMip.clonePageTemplate,dsMip.pageTemplateDelete,dsMip.pageTemplateExport,new Ext.menu.Separator({itemId:'pageTemplateDraftActionsSeparator'}),{itemId:'pageTemplateDraftActionsText',xtype:'menutextitem',text:'Draft Actions',iconCls:'mkiPencil',cls:'mktMenuGroupText',disabledClass:' ',disabled:true},dsMip.editPageTemplateDraft,dsMip.previewDraftPageTemplate,dsMip.approveDraftPageTemplate,dsMip.discardDraftPageTemplate);};MktDsMenu.preShowFormMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.Forms.getActionStates(attr);mItems.get('formEdit').setDisabled(states.disableEdit);mItems.get('formClone').setDisabled(states.disableClone);mItems.get('formDelete').setDisabled(states.disableDelete);mItems.get('formMove').setVisible(true);return menu;};MktDsMenu.getFormMenu=function(attr){return MktLeadDbMenu.menuFactory("MktDsMenu.FormMenu",dsMip.formEdit,dsMip.formClone,dsMip.formDelete,dsMip.formMove);};MktDsMenu.preShowEmailMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.Emails.getActionStates(attr);var hasDraftNode=!states.disableDiscardDraft;mItems.get('emailPreview').setDisabled(states.disablePreview);mItems.get('emailEdit').setVisible((!states.disableEdit&&!hasDraftNode)||states.selCount==0);mItems.get('emailEdit').setDisabled(states.disableEdit);mItems.get('emailApprove').setVisible(!states.disableApproveEmail||states.selCount==0);mItems.get('emailApprove').setDisabled(states.disableApproveEmail);mItems.get('emailUnapprove').setVisible(!states.disableUnapproveEmail);mItems.get('emailDownloadHtml').setVisible(!states.selCount==0);mItems.get('emailSendTest').setDisabled(states.disableSendTest);mItems.get('emailClone').setDisabled(states.disableClone);mItems.get('emailDelete').setDisabled(states.disableDelete);mItems.get('emailDraftActionsSeparator').setVisible(hasDraftNode);mItems.get('emailDraftActionsText').setVisible(hasDraftNode);mItems.get('emailDraftPreview').setVisible(hasDraftNode&&!states.disablePreviewDraft);mItems.get('emailDraftEdit').setVisible(hasDraftNode&&!states.disableEditDraft);mItems.get('emailDraftSendTest').setVisible(hasDraftNode&&!states.disableSendTestDraft);mItems.get('emailDraftApprove').setVisible(hasDraftNode&&!states.disableApproveDraft);mItems.get('emailDraftDiscard').setVisible(hasDraftNode&&!states.disableDiscardDraft);mItems.get('emailMove').setVisible(true);return menu;};MktDsMenu.getEmailMenu=function(attr){return MktLeadDbMenu.menuFactory({id:"MktDsMenu.EmailMenu",minWidth:156},dsMip.emailEdit,dsMip.emailPreview,dsMip.emailApprove,dsMip.emailUnapprove,dsMip.emailDownloadHtml,dsMip.emailSendTest,dsMip.emailClone,dsMip.emailDelete,dsMip.emailMove,new Ext.menu.Separator({itemId:'emailDraftActionsSeparator'}),{itemId:'emailDraftActionsText',xtype:'menutextitem',text:'Draft Actions',iconCls:'mkiPencil',cls:'mktMenuGroupText',disabledClass:' ',disabled:true},dsMip.emailDraftEdit,dsMip.emailDraftPreview,dsMip.emailDraftSendTest,dsMip.emailDraftApprove,dsMip.emailDraftDiscard);};MktDsMenu.preShowEmailTemplateMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.EmailTemplates.getActionStates(attr);var hasDraftNode=!states.disableDiscardDraft;mItems.get('emailTemplatePreview').setDisabled(states.disablePreview);mItems.get('emailTemplateEdit').setVisible((!states.disableEdit&&!hasDraftNode)||states.selCount==0);mItems.get('emailTemplateEdit').setDisabled(states.disableEdit);mItems.get('emailTemplateApprove').setVisible(!states.disableApproveTemplate||states.selCount==0);mItems.get('emailTemplateApprove').setDisabled(states.disableApproveTemplate);mItems.get('emailTemplateUnapprove').setVisible(!states.disableUnapproveTemplate);mItems.get('emailTemplateSendTest').setDisabled(states.disableSendTest);mItems.get('emailTemplateClone').setDisabled(states.disableClone);mItems.get('emailTemplateDelete').setDisabled(states.disableDelete);mItems.get('emailTemplateDraftActionsSeparator').setVisible(hasDraftNode);mItems.get('emailTemplateDraftActionsText').setVisible(hasDraftNode);mItems.get('emailTemplateDraftPreview').setVisible(hasDraftNode&&!states.disablePreviewDraft);mItems.get('emailTemplateDraftEdit').setVisible(hasDraftNode&&!states.disableEditDraft);mItems.get('emailTemplateDraftSendTest').setVisible(hasDraftNode&&!states.disableSendTestDraft);mItems.get('emailTemplateDraftApprove').setVisible(hasDraftNode&&!states.disableApproveDraft);mItems.get('emailTemplateDraftDiscard').setVisible(hasDraftNode&&!states.disableDiscardDraft);return menu;};MktDsMenu.getEmailTemplateMenu=function(attr){return MktLeadDbMenu.menuFactory({id:"MktDsMenu.EmailTemplateMenu",minWidth:156},dsMip.emailTemplateEdit,dsMip.emailTemplatePreview,dsMip.emailTemplateSendTest,dsMip.emailTemplateApprove,dsMip.emailTemplateUnapprove,dsMip.emailTemplateClone,dsMip.emailTemplateDelete,new Ext.menu.Separator({itemId:'emailTemplateDraftActionsSeparator'}),{itemId:'emailTemplateDraftActionsText',xtype:'menutextitem',text:'Draft Actions',iconCls:'mkiPencil',cls:'mktMenuGroupText',disabledClass:' ',disabled:true},dsMip.emailTemplateDraftEdit,dsMip.emailTemplateDraftPreview,dsMip.emailTemplateDraftSendTest,dsMip.emailTemplateDraftApprove,dsMip.emailTemplateDraftDiscard);};MktDsMenu.preShowImageMenu=function(menu,attr){var mItems=menu.items;var states=Mkt.app.DesignStudio.Images.getActionStates(attr);mItems.get('grabFromWebPage').setVisible(states.showGrabFromWebPage);mItems.get('imagePreview').setDisabled(states.disablePreview);mItems.get('imageDelete').setDisabled(states.disableDelete);mItems.get('replaceImage').setDisabled(states.disableReplace);return menu;};MktDsMenu.getImageMenu=function(attr){return MktLeadDbMenu.menuFactory("MktDsMenu.ImageMenu",dsMip.uploadImage,dsMip.grabFromWebPage,dsMip.imagePreview,dsMip.imageDelete,dsMip.replaceImage);};MktDsMenu.preShowTestpageMenu=function(menu,attr){var mItems=menu.items;var temp=Ext.apply({forceGetInfoFrom:(attr.triggeredFrom=='button')?'appVars':undefined},attr);var states=Mkt.app.DesignStudio.Pages.getTestGroupActionStates(temp);mItems.get('undeployTestGroup').setVisible(states.showUndeployTestGroup);mItems.get('deployTestGroup').setVisible(states.showDeployTestGroup);return menu;};MktDsMenu.getTestpageMenu=function(attr){return MktLeadDbMenu.menuFactory("MktDsMenu.TestpageMenu",dsMip.editGroupMembers,dsMip.newTestedPage,dsMip.deleteTestGroup,dsMip.undeployTestGroup,dsMip.deployTestGroup,dsMip.urlBuilder);};MktDsMenu.preShowFolderMenu=function(menu,attr){var mItems=menu.items;if(attr){var isImage=attr.nodeType=='Image';var isLP=attr.nodeType=='Landing Page';var node=MktExplorer.getNodeById(attr.id);var showShare=false;if(MktPage.savedState.multiZone&&!attr.system){showShare=MktFolder.isShowShare(attr);}
var isArchive=false;if(attr.xtra&&attr.xtra.isArchive){isArchive=attr.xtra.isArchive;}
mItems.get('newLandingPage').setVisible(isLP);mItems.get('newTestGroup').setVisible(isLP);var showCreateTemplate=attr.nodeType=='Landing Page Template';mItems.get('newPageTemplate').setVisible(showCreateTemplate);mItems.get('pageTemplateImport').setVisible(showCreateTemplate);mItems.get('newForm').setVisible(attr.nodeType=='Landing Page Form');mItems.get('newEmail').setVisible(attr.nodeType=='Email');mItems.get('newEmailTemplate').setVisible(attr.nodeType=='Email Template');mItems.get('uploadImage').setVisible(isImage);mItems.get('grabFromWebPage').setVisible(isImage);mItems.get('deleteFolder').setDisabled(attr.system);mItems.get('renameFolder').setDisabled(attr.system);mItems.get('share').setVisible(showShare);var isArchiveAllowed=MktFolder.isArchiveAllowed(attr);mItems.get('convertToArchiveFolder').setVisible(!isArchive&&isArchiveAllowed);mItems.get('convertToFolder').setVisible(isArchive&&isArchiveAllowed);}
return menu;};MktDsMenu.getFolderMenu=function(attr){var config={id:attr.menuId||"MktDsMenu.FolderMenu"};if(Ext.isIE){config.width=195;}
return MktLeadDbMenu.menuFactory(config,dsMip.newLandingPage,dsMip.newTestGroup,dsMip.newPageTemplate,dsMip.pageTemplateImport,dsMip.newForm,dsMip.newEmail,dsMip.newEmailTemplate,dsMip.uploadImage,dsMip.grabFromWebPage,fMip.share,new Ext.menu.Separator({itemId:'contextNewSep'}),fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);};MktDsMenu.preShowContextMenu=function(menu,attr){};MktDsMenu.getLegacySubtype=function(subType)
{var legacySubtype=subType;switch(subType){case"Landing Page":legacySubtype="page";break;case"Landing Page Template":legacySubtype="template";break;case"Landing Page Form":legacySubtype="form";break;case"Email":legacySubtype="email";break;case"Email Template":legacySubtype="emailTemplate";break;}
return legacySubtype;};MktDsMenu.getDsMenu=function(attr){var subType;var menu;var isTestGroup=((attr.xtra&&attr.xtra.subType&&attr.xtra.subType=="Landing Page Test Group")||(attr.compType&&attr.compType=="Landing Page Test Group"));if(isDefined(attr.xtra)&&isDefined(attr.xtra.subType)&&!attr.canHaveChild){attr.xtra.subType=MktDsMenu.getLegacySubtype(attr.xtra.subType);if(attr.compType=='Landing Page'&&attr.xtra.subType=='testpage'){subType='Page';}
else{subType=MktUtil.camelCase(attr.xtra.subType);if(isTestGroup){subType='Testpage';}}}else if(isDefined(attr.folder)&&attr.folder){if(attr.text=='Design Studio'||attr.compType=='Zone'){return;}
else if(isTestGroup){subType="Testpage";}
else{subType='Folder';}
Ext.apply(attr.xtra,{subType:subType});}else{return;}
if(isFunction(MktDsMenu['get'+subType+'Menu'])){var m=Ext.menu.MenuMgr.get('MktDsMenu.'+subType+'Menu');menu=m?m:MktDsMenu['get'+subType+'Menu'](attr);menu.triggeredFrom=attr.triggeredFrom;if(isDefined(MktDsMenu['preShow'+subType+'Menu'])){menu=MktDsMenu['preShow'+subType+'Menu'](menu,attr);}
MktDsMenu.preShowContextMenu(menu,attr);if(isDefined(menu)){return menu;}}};MktDsMenu.compSubtypeFixup=function(node){var parentNode=node.parentNode;if(parentNode&&parentNode.attributes.xtra){node.attributes.xtra.compSubtype=parentNode.attributes.xtra.compType;}}
MktDsMenu.showContextMenu=function(node,e){MktDsMenu.compSubtypeFixup(node);var menu=MktMenuMgr.getMenu('Landing',Ext.apply({triggeredFrom:"tree"},node.attributes));if(menu){menu.xtra=Ext.apply({},node.attributes.xtra,{triggeredFrom:"tree",text:node.text,nodeId:node.id});menu.showAt(e.xy);menu.currNode=node;Mkt.main.ExplorerPanel.nodeContextMenuSetup(node,menu);}
e.stopEvent();return false;};})();MktMenuMgr.registerMenuProvider('Landing',function(attr){attr.menu=MktDsMenu.getDsMenu(attr);});(function(){var ds=Mkt.app.DesignStudio;ds.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(ds.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=ds.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('Landing',toolbarRequestHandler);return{getNewMenuButton:function(){var dsMip=MktDsMenu.menuItemPool;return{text:'New',iconCls:'mkiColorsCmyk',menu:new Ext.menu.Menu({minWidth:200,items:[dsMip.newLandingPage,dsMip.newPageTemplate,dsMip.newTestGroup,dsMip.newForm,'-',dsMip.newEmail,dsMip.newEmailTemplate,'-',dsMip.uploadImage,dsMip.grabFromWebPage]})};},getAllCreativeHome:function(attr){var dsMip=MktDsMenu.menuItemPool;return new Ext.Toolbar({items:[this.getNewMenuButton()]});},getPage:function(attr){var items=[];if(!attr.marketingProgramId){items.push(this.getNewMenuButton());}
items.push({itemId:'dsMenuLandingPageActions_'+attr.panelId,text:'Landing Page Actions',iconCls:'mkiWebpage',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowPageMenu.createDelegate(attr),menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{text:'Edit Draft',iconCls:'mkiWebpageEdit',itemId:'pageEdit_'+attr.panelId,disabled:(attr.panelId=='landingCanvasLP'),handler:function(){Mkt.app.DesignStudio.Pages.editPage({triggeredFrom:"button",el:this.getEl()});}},{text:'Preview Page',iconCls:'mkiWebpageView',itemId:'pagePreview_'+attr.panelId,disabled:(attr.panelId=='landingCanvasLP'),handler:function(){Mkt.app.DesignStudio.Pages.previewPage({triggeredFrom:'button',el:this.getEl()});}});if(attr.panelId!='landingLPDetail'){}
if(attr.compType=='Landing Page'&&attr.compSubtype=='Landing Page Test Group'){items.push({text:'View Test Group',itemId:'viewTestGroup_'+attr.panelId,iconCls:'mkiCustAbtestGoto',handler:function(el){if(MktPage.appVars.lpTGid){MktDlManager.loadDl({type:'Landing',subType:'page',compId:MktPage.appVars.lpTGid,marketingProgramId:attr&&attr.marketingProgramId?attr.marketingProgramId:""});}}});}
return new Ext.Toolbar({items:items});},updatePageToolbarState:function(attr){var states=Mkt.app.DesignStudio.Pages.getActionStates(attr);var panelId='landingCanvasLP';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('pageEdit_'+panelId).setDisabled(states.disableEdit);tb.items.get('pagePreview_'+panelId).setDisabled(states.disablePreview);}}},getTestpage:function(attr){var pageAttr=Ext.applyIf({subType:'page'},attr);var items=!(attr.marketingProgramId)?[this.getNewMenuButton()]:[];items.push({itemId:'dsMenuTestGroupActions_'+attr.panelId,text:'Test Group Actions',iconCls:'mkiCustAbtest',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowTestpageMenu.createDelegate(attr),menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{text:'Report Settings',iconCls:'mkiClock',handler:function(button,e){Mkt.widgets.ReportSettings.show(Mkt.widgets.ReportSettings.data,undefined,button.el);}});return new Ext.Toolbar({items:items});},updateTestpageToolbarState:function(attr){var states=Mkt.app.DesignStudio.Pages.getActionStates(attr);var panelId='landingCanvasLP';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('pageEdit_'+panelId).setDisabled(states.disableEdit);tb.items.get('pagePreview_'+panelId).setDisabled(states.disablePreview);}}},getTemplate:function(attr){return new Ext.Toolbar({items:[this.getNewMenuButton(),{itemId:'dsMenuTemplateActions_'+attr.panelId,text:'Template Actions',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowTemplateMenu.createDelegate(attr),menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{itemId:'pageTemplateEditDraft_'+attr.panelId,text:'Edit Draft',disabled:(attr.panelId=='landingCanvasTM'),iconCls:'mkiWindowEdit',handler:function(){var parms={};var sels=Mkt.util.Common.getSelections({triggeredFrom:'button',appVarsId:'lpOid',appVarsName:'lpDetailTitle'});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.editTemplate.call(templates,sels[0].id);}}},{itemId:'pageTemplatePreview_'+attr.panelId,text:'Preview Template',disabled:(attr.panelId=='landingCanvasTM'),iconCls:'mkiWindowView',handler:function(){var sels=Mkt.util.Common.getSelections({triggeredFrom:'button',appVarsId:'lpOid',appVarsName:'lpDetailTitle'});if(sels.length>0){var templates=Mkt.app.DesignStudio.Templates;templates.preview.call(templates,sels[0].id);}}},{itemId:'importTemplate_'+attr.panelId,text:'Import Template',iconCls:'mkiImport',handler:function(button){var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);Mkt.app.DesignStudio.Templates.importTemplate({triggeredFrom:'button',accessZoneId:accessZoneId,el:button.el});}}]});},updateTemplateToolbarState:function(attr){var states=Mkt.app.DesignStudio.Templates.getActionStates(attr);var panelId='landingCanvasTM';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('pageTemplateEditDraft_'+panelId).setDisabled(states.disableEdit);tb.items.get('pageTemplatePreview_'+panelId).setDisabled(states.disablePreview);}}},getImage:function(attr){var items=[this.getNewMenuButton(),{itemId:'imageActions_'+attr.panelId,text:'File Actions',iconCls:'mkiHardDrive',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowImageMenu,menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{itemId:'imageUpload_'+attr.panelId,text:'Upload Image or File',iconCls:'mkiDocumentUp',handler:function(){var compId=Mkt.util.Common.getNodeAttrValue(undefined,'dlZoneFolderId',true);var folderName=Mkt.util.Common.getNodeAttrValue(undefined,'folderName',true);mktLPIManager.uploadImageRequest(null,this.getEl().dom,true,compId,folderName);}},{itemId:'imageReplace_'+attr.panelId,text:'Replace Image or File',iconCls:'mkiDocumentExchange',disabled:true,handler:function(){var compId=Mkt.util.Common.getNodeAttrValue(undefined,'dlZoneFolderId',true);var folderName=Mkt.util.Common.getNodeAttrValue(undefined,'folderName',true);replaceAction={triggeredFrom:'button',xtra:null,el:this.getEl()};mktLPIManager.uploadImageRequest(null,this.getEl().dom,true,compId,folderName,replaceAction);}}];return new Ext.Toolbar({items:items});},updateImageToolbarState:function(attr){var states=Mkt.app.DesignStudio.Images.getActionStates(attr);var panelId='landingCanvasIM';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();tb.items.get('imageReplace_'+panelId).setDisabled(states.disableReplace);}},getForm:function(attr){var editFormId='formEdit_'+attr.panelId;var items=[];if(!attr.marketingProgramId){items.push(this.getNewMenuButton());}
items.push({itemId:'dsMenuFormActions_'+attr.panelId,text:'Form Actions',iconCls:'mkiFormBlue',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowFormMenu,menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{itemId:editFormId,text:'Edit Form',iconCls:'mkiFormBlueEdit',disabled:attr.panelId=='landingCanvasFO',handler:function(){Mkt.app.DesignStudio.Forms.editForm({triggeredFrom:"button"});}});return new Ext.Toolbar(items);},updateFormToolbarState:function(attr){var states=Mkt.app.DesignStudio.Forms.getActionStates(attr);var panelId='landingCanvasFO';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('formEdit_'+panelId).setDisabled(states.disableEdit);}}},getEmail:function(attr){var items=[];if(!attr.marketingProgramId){items.push(this.getNewMenuButton());}
items.push({itemId:'dsMenuEmailActions_'+attr.panelId,text:'Email Actions',iconCls:'mkiMail2',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowEmailMenu,menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{text:'Edit Draft',itemId:'emailEdit_'+attr.panelId,iconCls:'mkiMail2Edit',disabled:(attr.panelId=='landingCanvasEM'),handler:function(button,e){Mkt.app.DesignStudio.Emails.editDraft({triggeredFrom:'button',panelId:attr.panelId});}},{text:'Preview Email',itemId:'emailPreview_'+attr.panelId,iconCls:'mkiMail2View',disabled:(attr.panelId=='landingCanvasEM'),handler:function(button,e){Mkt.app.DesignStudio.Emails.previewEmail({triggeredFrom:'button',panelId:attr.panelId});}});if(attr.deliverabilityEnabled){items.push({text:'Deliverability Tools',itemId:'gotoDeliverability_'+attr.panelId,iconCls:'mkiMail2Wrench',disabled:!attr.deliverabilityEnabled,handler:function(button,e){Mkt.app.DesignStudio.Emails.gotoDeliverability({triggeredFrom:'button',panelId:attr.panelId});}});}
return new Ext.Toolbar({items:items});},updateEmailToolbarState:function(attr){var states=Mkt.app.DesignStudio.Emails.getActionStates(attr);var panelId=isDefined(attr.panelId)?attr.panelId:'landingCanvasEM';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('emailEdit_'+panelId).setDisabled(states.disableEdit&&states.disableEditDraft);tb.items.get('emailPreview_'+panelId).setDisabled(states.disablePreview);}}},getEmailTemplate:function(attr){return new Ext.Toolbar({items:[this.getNewMenuButton(),{itemId:'dsMenuTemplateActions_'+attr.panelId,text:'Template Actions',iconCls:'mkiWindow',xtype:'mkttbbutton',menuPreShowCb:MktDsMenu.preShowEmailTemplateMenu,menu:MktMenuMgr.getMenu(attr.type,{xtra:attr})},'-',{text:'Edit Draft',itemId:'emailTemplateEdit_'+attr.panelId,iconCls:'mkiWindowEdit',disabled:(attr.panelId=='emailTemplates'),handler:function(button,e){Mkt.app.DesignStudio.EmailTemplates.editTemplateDraft({triggeredFrom:'button',panelId:attr.panelId});}},{text:'Preview Template',itemId:'emailTemplatePreview_'+attr.panelId,iconCls:'mkiWindowView',disabled:(attr.panelId=='emailTemplates'),handler:function(button,e){Mkt.app.DesignStudio.EmailTemplates.previewTemplate({triggeredFrom:'button',panelId:attr.panelId});}}]});},updateEmailTemplateToolbarState:function(attr){var states=Mkt.app.DesignStudio.Emails.getActionStates(attr);var panelId=isDefined(attr.panelId)?attr.panelId:'emailTemplates';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('emailTemplateEdit_'+panelId).setDisabled(states.disableEdit&&states.disableEditDraft);tb.items.get('emailTemplatePreview_'+panelId).setDisabled(states.disablePreview);}}}};}();})();
/* ========== mktPrototypeExtAdapter.js ============ */

function Element(){}
Element.show=function(el){return Ext.get(el).setVisibilityMode(Ext.Element.DISPLAY).setVisible(true).dom;};Element.hide=function(el){return Ext.get(el).setVisibilityMode(Ext.Element.DISPLAY).setVisible(false).dom;};Element.removeClassName=function(el,className){return Ext.get(el).removeClass(className).dom;};Element.update=function(el,html){return Ext.get(el).update(html).dom;};Element.setStyle=function(el,style){return Ext.get(el).applyStyles(style).dom;};Element.addClassName=function(el,className){return Ext.get(el).addClass(className).dom;};$=function(el){return Ext.getDom(el);};Function.prototype.bind=function(){var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)));}}
var $A=Array.from=function(iterable){if(!iterable)return[];if(iterable.toArray){return iterable.toArray();}else{var results=[];for(var i=0,length=iterable.length;i<length;i++)
results.push(iterable[i]);return results;}}
function Ajax(){}
Ajax.Request=function(url,options){if(MktPage.isDev()){Ext.Ajax.timeout=3600000;}else{Ext.Ajax.timeout=1800000;}
var o={url:url,params:options.parameters,method:options.method,success:options.onSuccess,failure:options.onFailure};if(isUndefined(options.parameters)||isNull(options.parameters)||isEmptyString(options.parameters)){o.headers={"Content-Length":0};}
return Ext.Ajax.request(o);};Object.extend=function(subclass,superClass){Ext.apply(subclass,superClass);};String.prototype.escapeHTML=function(str){var div=document.createElement('div');var text=document.createTextNode(this);div.appendChild(text);return div.innerHTML;};String.prototype.stripScripts=function(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');};String.prototype.extractScripts=function(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});};var Prototype={ScriptFragment:'(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)'}
function Form(){}
Form.serialize=function(f){return Ext.Ajax.serializeForm(f);};
/* ========== ../mkt-ext-2.0/util/DomObserver.js ============ */

Ext.ns('Ext');Ext.DomObserver=Ext.extend(Object,{constructor:function(config){this.listeners=config.listeners?config.listeners:config;},init:function(c){var p,l=this.listeners;for(p in l){if(Ext.isFunction(l[p])){l[p]=this.createHandler(l[p],c);}else{l[p].fn=this.createHandler(l[p].fn,c);}}
c.render=c.render.createSequence(function(){var e=c.getEl();if(e){e.on(l);}});},createHandler:function(fn,c){return function(e){fn.call(this,e,c);};}});
/* ========== ../mkt-ext-2.0/MktTree20.js ============ */

MktTreeNodeUI=function(attributes){MktTreeNodeUI.superclass.constructor.call(this,attributes);};Ext.extend(MktTreeNodeUI,Ext.tree.TreeNodeUI,{ctype:'MktTreeNodeUI',render:function(bulkRender){MktTreeNodeUI.superclass.render.call(this,bulkRender);attr=this.node.attributes;if(isDefined(attr.mktTipCfg)){var mktTipCfg=attr.mktTipCfg;this.mktTip=new Ext.ToolTip(Ext.applyIf(mktTipCfg,{target:this.getEl(),width:200,height:200,title:'Default Title',dismissDelay:15000}));if(isFunction(mktTipCfg.renderCb)){mktTipCfg.renderCb(this.mktTip);}}},renderElements:function(n,a,targetNode,bulkRender){var cb=typeof a.checked=='boolean';if(!cb){MktTreeNodeUI.superclass.renderElements.apply(this,arguments);return;}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',a.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />',cb?('<span class="x-tree-node-cb-ct"><input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/></span>')):'','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" />','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",'><span unselectable="on">',n.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');var nel;if(bulkRender!==true&&n.nextSibling&&(nel=n.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",nel,buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];var index=2;if(cb){this.checkbox=cs[index].childNodes[0];this.checkbox.defaultChecked=this.checkbox.checked;index++;}
this.iconNode=cs[index];index++;this.anchor=cs[index];this.textNode=cs[index].firstChild;},onOver:function(e){},onOut:function(e){},getMktTip:function(){return this.mktTip;},getMktTipCfg:function(){return mktTipCfg;}});MktTreeLoader=Ext.extend(Ext.tree.TreeLoader,{ctype:'MktTreeLoader',getParams:function(node){var params=MktTreeLoader.superclass.getParams.call(this,node);if(node.attributes.specialDescendantId){params+="&specialDescendantId="+MktSession.encodeURIComponent(node.attributes.specialDescendantId);}
return params;},createNode:function(attr){attr.uiProvider=attr.uiProvider||this.uiProvider;attr.icon=attr.icon||this.icon;if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs);}
if(this.applyLoader!==false){attr.loader=this;}
if(typeof attr.uiProvider=='string'){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}
attr.mktExpanded=attr.expanded;if(isDefined(attr.folder)&&attr.expanded){attr.cancelFirstExpand=true;}
var node=attr.leaf?new MktTreeNode(attr):new MktAsyncTreeNode(attr);return node;}});MktAsyncTreeNode=function(attributes){attributes.uiProvider=attributes.uiProvider||MktTreeNodeUI;attributes.mktExpanded=attributes.mktExpanded||false;MktAsyncTreeNode.superclass.constructor.call(this,attributes);};Ext.extend(MktAsyncTreeNode,Ext.tree.AsyncTreeNode,{ctype:"MktAsyncTreeNode",realCascade:function(fn,scope,args){if(fn.apply(scope||this,args||[this])!==false){if(this.childrenRendered){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){if(cs[i].realCascade){cs[i].realCascade(fn,scope,args);}}}else{}}},expand:function(){var attr=this.attributes;if(isDefined(attr.folder)){if(attr.cancelFirstExpand){delete this.attributes.cancelFirstExpand;}else if(this.childNodes&&this.childNodes.length>0&&attr.mktExpanded===false){MktFolder.saveExpandState(this,true);}}
MktAsyncTreeNode.superclass.expand.apply(this,arguments);attr.mktExpanded=true;},collapse:function(){var attr=this.attributes;if(attr.suppressAjaxCollapse){delete this.attributes.suppressAjaxCollapse;}else if(isDefined(attr.folder)&&attr.folder&&attr.mktExpanded===true){MktFolder.saveExpandState(this,false);}
MktAsyncTreeNode.superclass.collapse.apply(this,arguments);attr.mktExpanded=false;},replaceChild:function(newChild,oldChild){var prnNode=oldChild.parentNode;var childNodes=prnNode.childNodes;var isSelected=oldChild.isSelected();var isPrnExpanded=prnNode.isExpanded();if(oldChild.parentNode){oldChild.parentNode.attributes.suppressAjaxCollapse=true;}
if(oldChild.nextSibling){var nSibling=oldChild.nextSibling;oldChild.remove();prnNode.insertBefore(newChild,nSibling);}else{oldChild.remove();prnNode.appendChild(newChild);}
if(isSelected){newChild.render();newChild.select();}
if(isPrnExpanded){prnNode.expand(false,false);}
return oldChild;},appendChild:function(){var node=MktAsyncTreeNode.superclass.appendChild.apply(this,arguments);if(node&&this.childrenRendered){node.render();}
this.ui.updateExpandIcon();return node;}});MktTreeNode=function(attributes){attributes.uiProvider=attributes.uiProvider||MktTreeNodeUI;attributes.mktExpanded=attributes.mktExpanded||false;MktTreeNode.superclass.constructor.call(this,attributes);};Ext.extend(MktTreeNode,Ext.tree.TreeNode,{ctype:"MktTreeNode",expand:function(){var attr=this.attributes;if(isDefined(attr.folder)){if(attr.cancelFirstExpand){delete this.attributes.cancelFirstExpand;}else if(this.childNodes&&this.childNodes.length>0&&attr.mktExpanded===false){MktFolder.saveExpandState(this,true);}}
MktTreeNode.superclass.expand.apply(this,arguments);attr.mktExpanded=true;},collapse:function(){var attr=this.attributes;if(attr.suppressAjaxCollapse){delete this.attributes.suppressAjaxCollapse;}else if(isDefined(attr.folder)&&attr.folder&&attr.mktExpanded===true){MktFolder.saveExpandState(this,false);}
MktTreeNode.superclass.collapse.apply(this,arguments);attr.mktExpanded=false;},replaceChild:function(newChild,oldChild){var prnNode=oldChild.parentNode;var childNodes=prnNode.childNodes;var isSelected=oldChild.isSelected();var isPrnExpanded=prnNode.isExpanded();if(oldChild.parentNode){oldChild.parentNode.attributes.suppressAjaxCollapse=true;}
if(oldChild.nextSibling){var nSibling=oldChild.nextSibling;oldChild.remove();prnNode.insertBefore(newChild,nSibling);}else{oldChild.remove();prnNode.appendChild(newChild);}
if(isSelected){newChild.render();newChild.select();}
if(isPrnExpanded){prnNode.expand(false,false);}
return oldChild;},clone:function(attributes,useSameId,fromAttribOnly){var atts;if(!fromAttribOnly){atts=Ext.applyIf(attributes||{},this.attributes);}
else{atts=attributes||{};}
if(!useSameId){atts.id=undefined;}
if(atts.menu){delete atts.menu;}
if(atts.currNode){delete atts.currNode;}
if(atts.xtra&&atts.xtra.id&&!useSameId){delete atts.xtra.id;}
var newNodeAttr={};Ext.apply(newNodeAttr,atts);var newNode=new MktTreeNode(newNodeAttr);if(this.childNodes&&this.childNodes.length){for(var i=0;i<this.childNodes.length;i++){var clonedNode;if(this.childNodes[i].clone){clonedNode=this.childNodes[i].clone(attributes,useSameId);}
else{clonedNode=MktTreeNode.prototype.clone.call(this.childNodes[i],attributes,useSameId);}
newNode.appendChild(clonedNode);}}
else if(atts.children){for(var i=0;i<atts.children.length;i++){var clonedNode=MktTreeNode.prototype.clone.call(this,atts.children[i],useSameId,true);newNode.appendChild(clonedNode);}}
return newNode;}});
/* ========== ../mkt-ext-2.0/widgets/MaskedTreePanel.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.MaskedTreePanel=Ext.extend(Ext.tree.TreePanel,{enableLoadMask:true,maskMsg:'',beforeShowLoadMask:function(){return true;},beforeHideLoadMask:function(){return true;},initLoadMask:function(){if(this.enableLoadMask){this.addListener('beforeload',this.showLoadMask.createDelegate(this),{buffer:250});this.addListener('load',this.hideLoadMask.createDelegate(this),{buffer:250});}},showLoadMask:function(){if(!this.loadMaskConfig){this.loadMaskConfig={msg:this.maskMsg};}
if(this.enableLoadMask&&!this.loadMaskVisible&&this.beforeShowLoadMask()){var parentCont=this.findParentBy(function(){return true;});this.loadMask=new Ext.LoadMask(parentCont.body,Ext.apply({store:new Ext.data.Store()},this.loadMaskConfig));this.loadMask.show();this.loadMaskVisible=true;}},hideLoadMask:function(){if(this.loadMaskVisible){this.loadMaskVisible=false;if(this.beforeHideLoadMask()){this.loadMask.hide();}}},initComponent:function(){Mkt.widgets.MaskedTreePanel.superclass.initComponent.call(this);this.initLoadMask();}});
/* ========== ../mkt-ext-2.0/widgets/CachedTreePanel.js ============ */

Mkt.widgets.CachedTreePanel=Ext.extend(Mkt.widgets.MaskedTreePanel,{enableCache:true,useCleanCache:false,initComponent:function(){this.filterFieldWidth=this.width-7;if(this.hasCache()){var cachedData=Mkt.widgets._CachedTreeData[this.dataUrl];if(this.useCleanCache){cachedData=Ext.decode(Ext.encode(cachedData));}
this.loader=this.loader||new Ext.tree.TreeLoader();this.root=new Ext.tree.AsyncTreeNode({id:'root',text:'root',expanded:true,children:cachedData});}
else{this.loader=this.loader||new Ext.tree.TreeLoader({clearOnLoad:false,preloadChildren:true,dataUrl:this.dataUrl});this.loader.on('load',this.fillCache);this.root=new Ext.tree.AsyncTreeNode({id:'root',text:'root',expanded:true});}
Mkt.widgets.CachedTreePanel.superclass.initComponent.call(this);},hasCache:function(){var hasCache=false;if(this.enableCache){hasCache=Mkt.widgets._CachedTreeData[this.dataUrl];}
return hasCache;},fillCache:function(loader,node,response){if(!Mkt.widgets._CachedTreeData[this.dataUrl]){try{Mkt.widgets._CachedTreeData[this.dataUrl]=eval("("+response.responseText+")");}
catch(e){var reqParams={url:this.dataUrl,ajaxResult:'exception'};var parseResults={errorType:'Malformed tree JSON'};MktMessage.showSystemError(MktMessage.SYSTEM_ERROR_TREE,{request:response,parseResults:parseResults,reqParams:reqParams,showDebugInfo:MktPage.isDev(),cleanResponseText:response.responseText});MktSession.phoneHome({systemErrorMsg:MktMessage.SYSTEM_ERROR_TREE,request:response,parseResults:parseResults,reqParams:reqParams,cleanResponseText:response.responseText});}}},invalidateAllCache:function(){Mkt.widgets._CachedTreeData={};},invalidateCache:function(){if(isDefined(Mkt.widgets._CachedTreeData[this.dataUrl])){delete Mkt.widgets._CachedTreeData[this.dataUrl];}},arrangeTreeAfterCancel:Ext.emptyFn,openFolders:function(path){this.expandPath(path,'text');}});Mkt.widgets._CachedTreeData={};
/* ========== ../mkt-ext-2.0/widgets/FilterTreePanel.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.FilterTreePanel=Ext.extend(Ext.Panel,{bindTree:function(boundTree){this.boundTree=boundTree;this.boundTree.pathSeparator="\\\\\\";this.filter=new Ext.tree.TreeFilter(boundTree,{clearBlank:true,autoClear:true});if(boundTree.arrangeTreeBeforeFilter){this.arrangeTreeBeforeFilter=boundTree.arrangeTreeBeforeFilter.createDelegate(this.boundTree);}
if(boundTree.arrangeTreeAfterCancel){this.arrangeTreeAfterCancel=boundTree.arrangeTreeAfterCancel.createDelegate(this.boundTree);}},avoidSearch:true,frame:false,autoScroll:true,containerScroll:true,cls:'mktFilterTree mktPlainTbar',filterFieldEmptyText:'Find...',filterFieldTooltip:null,filterFieldCls:'mktFilterField',filterFieldSelectOnFocus:true,filterNoResultsText:'No matches for ',filterFieldConfig:{triggerClass:'mkiFindNext',disableAutosuggest:true},filterFieldWidth:null,filterFieldPadding:18,twinTriggerConfig:{cls:'mkiCustSearchClose less-subtle'},filterBranches:false,filterBranchNames:false,animate:true,animateCollapse:true,collapseFirst:false,preloadChildren:true,filterUnloadedBranches:false,disableMaskDuringFilter:true,isExplorer:false,focusFilterField:function(){this.filterField.focus(true);},showFilterActivity:function(){this.addClass('mktFilterActivity');},clearFilterActivity:function(){this.removeClass('mktFilterActivity');this.filterQueue=0;this.previousFilterText='';},initComponent:function(){this.tbar=[this.initFilterfield()];Mkt.widgets.FilterTreePanel.superclass.initComponent.call(this);},initFilterfield:function(){if(!this.filterFieldWidth){this.filterFieldWidth=this.width-this.filterFieldPadding;}
this.filterField=new Ext.form.ImprovedComboBox(Ext.apply({width:this.filterFieldWidth,cls:this.filterFieldCls,emptyText:this.filterFieldEmptyText,downKeyHandler:this.filterFieldDownKeyHandler.createDelegate(this),upKeyHandler:this.filterFieldUpKeyHandler.createDelegate(this),selectOnFocus:this.filterFieldSelectOnFocus,twinTriggerConfig:this.twinTriggerConfig,onTwinTriggerClick:this.clearFilterField.createDelegate(this)},this.filterFieldConfig));this.filterField.addListener('render',function(f){if(this.twinTrigger){this.twinTrigger.hide();}
f.el.on('keydown',this.downKeyHandler,f,{buffer:300});f.el.on('keyup',this.upKeyHandler,f,{buffer:800});});return this.filterField;},filter:null,filteredNodes:[],showFilteredNodes:function(){Ext.each(this.filteredNodes,function(n){if(n.ui){n.ui.show();}});this.filteredNodes=[];},clearFilterField:function(focus){if(focus===undefined)focus=true;if(!this.filterField||!this.filter){return;}
this.filterField.collapse();var text=this.filterField.getValue();this.filterField.setRawValue('');if(focus){this.filterField.focus();this.filterField.select();}
this.filterField.twinTrigger.hide();try{this.showFilteredNodes();this.filter.clear();this.arrangeTreeAfterCancel();this.clearFilterActivity();}
catch(e){}
this.hideTreeMessage();},filterQueue:0,previousFilterText:'',previousVisibleNodes:-1,filterFieldDownKeyHandler:function(e){var k=e.getKey();if(k==e.ESC){this.clearFilterField();return false;}
this.showFilterActivity();return true;},filterFieldUpKeyHandler:function(e){var k=e.getKey();var text=this.filterField.getValue();if(k==e.ESC){this.clearFilterField();return false;}
else if(k==e.ENTER){if(!this.enterKeyPressed(text)){return false;}}
else if(k==e.TAB){if(!this.tabKeyPressed(text)){return false;}}
if(text!==''){this.filterField.twinTrigger.show();}
else{this.filterField.twinTrigger.hide();}
this.filterTree();return true;},enterKeyPressed:function(text){return false;},tabKeyPressed:function(text){return false;},deepSearch:2,filterTree:function(init){this.filterQueue++;if(this.filterQueue>1){return true;}
var boundTree=this.boundTree;root=boundTree.root;if(this.disableMaskDuringFilter){this.boundTree.enableLoadMask=false;}
var text=this.filterField.getValue();var searchSubset=false;if(text.length>this.deepSearch&&this.previousFilterText.length>0&&text.indexOf(this.previousFilterText)===0){searchSubset=true;if(this.previousVisibleNodes===0){this.clearFilterActivity();return false;}}
if(!searchSubset){this.showFilteredNodes();}
if((!text||text.length===0)&&!init){this.clearFilterField();return false;}
if(text===this.previousFilterText){this.clearFilterActivity();return false;}
this.previousFilterText=text;if(!searchSubset){this.arrangeTreeBeforeFilter();}
var filterRe=new RegExp(Ext.escapeRe(text),'i');var avoidSearch=this.avoidSearch;function isAvoidSearchFolder(node){if(!avoidSearch||node.leaf||node.expanded){return false;}
if((isDefined(node.xtra)&&node.xtra.isArchive==true)){return true;}
else if(isDefined(node.attributes)&&isDefined(node.attributes.xtra)&&node.attributes.xtra.isArchive==true){return true;}
return false;}
var matchingPaths={};if(text.length>=this.deepSearch){var filterBranches=this.filterBranches;function findMatchingPaths(n,path){var cs=null;if(n.attributes&&n.attributes.children){cs=n.attributes.children;}
else if(n.childNodes){cs=n.childNodes;}
else{cs=n.children;}
if(!cs)return false;for(var i=0;i<cs.length;i++){var child=cs[i];if(isAvoidSearchFolder(child)||isAvoidSearchFolder(n)){return;}
if((!cs.leaf||filterBranches)&&filterRe.test(child.filterText||child.text)){matchingPaths[path]=1;}
var childPath=path+boundTree.pathSeparator+child.text;findMatchingPaths(child,childPath);}
return false;}
findMatchingPaths(root,root.getPath('text'));var pathCount=0;for(path in matchingPaths){pathCount++;}
if(pathCount>0){MktPage.cancelSaveExpandState=true;for(path in matchingPaths){boundTree.expandPath(path,'text',function(){pathCount--;if(pathCount===0){MktPage.cancelSaveExpandState=false;}});}}}
var visibleLeafNodes=0;var deepSearch=this.deepSearch;this.filter.filterBy(function(n){var keep=false;if(!n.leaf){keep=true;}
else if(filterRe.test(n.attributes.filterText||n.text)){visibleLeafNodes++;keep=true;}
else if(this.filterBranches&&filterRe.test(n.parentNode.text)&&!isAvoidSearchFolder(n.parentNode)){visibleLeafNodes++;keep=true;}
return keep;},this,root);filteredNodes=this.filteredNodes;var visibleFolders=0;var filterBranchNames=this.filterBranchNames;var filterUnloadedBranches=this.filterUnloadedBranches;MktPage.cancelSaveExpandState=true;root.cascade(function(n){if(isAvoidSearchFolder(n)==false){if(!n.hidden&&!n.leaf){if(!n.hidden&&n.hasUnfilteredChildren(filterRe)||(filterBranchNames&&(filterRe.test(n.filterText||n.text)))||(filterUnloadedBranches&&!n.loaded)){visibleFolders++;if(!n.expanded){n.cancelSaveExpandState=true;n.expand(false,false);n.cancelSaveExpandState=false;}}
else{n.ui.hide();filteredNodes.push(n);}}}
else{n.expand(true,false);n.cascade(function(children){children.expand(true,false);});if(n.hasUnfilteredChildren(filterRe)||filterRe.test(n.filterText||n.text)){visibleFolders++;n.bubble(function(node){if(node.hidden){node.ui.show();}},this);}
else{n.ui.hide();filteredNodes.push(n);}
n.collapse(false,false);}});MktPage.cancelSaveExpandState=false;this.previousVisibleNodes=visibleFolders+visibleLeafNodes;if(this.previousVisibleNodes===0){this.noResults(text);}
else{this.hideTreeMessage();}
this.filterQueue--;if(this.filterQueue>0){this.filterQueue=0;this.filterTree();}
else{this.clearFilterActivity.defer(1000,this);}
return false;},noResults:function(text){this.showTreeMessage(this.filterNoResultsText+'&ldquo;'+Ext.util.Format.htmlEncode(text)+'&rdquo;');},showTreeMessage:function(msg){this.boundTree.addClass("mktFilterNoResults");this.boundTree.el.mask(msg);},hideTreeMessage:function(){this.boundTree.el.unmask();this.boundTree.removeClass("mktFilterNoResults");},arrangeTreeBeforeFilter:Ext.emptyFn,arrangeTreeAfterCancel:Ext.emptyFn});
/* ========== ../mkt-ext-2.0/widgets/AsyncFilterTreePanel.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.AsyncFilterTreePanel=Ext.extend(Mkt.widgets.FilterTreePanel,{asyncFilterDelay:350,initComponent:function(){Mkt.widgets.AsyncFilterTreePanel.superclass.initComponent.call(this);},bindTree:function(){Mkt.widgets.AsyncFilterTreePanel.superclass.bindTree.apply(this,arguments);this.boundTree.on('beforeload',this.beforeTreeLoad);this.boundTree.on('load',this.onTreeLoad.createDelegate(this));},beforeTreeLoad:function(node){var loader=this.getLoader();loader.baseParams=loader.baseParams||{};if(this.query){Ext.apply(loader.baseParams,{query:this.query});}
if(node.getDepth()>0){this.addClass('mktHideMask');}else{this.removeClass('mktHideMask');}},onTreeLoad:function(){var boundTree=this.boundTree;var loader=boundTree.getLoader();var query="";if(loader.baseParams&&loader.baseParams.query){query=loader.baseParams.query;delete loader.baseParams.query;}
if(!boundTree.getRootNode().hasChildNodes()){this.noResults(query);}},filterTree:function(init){this.hideTreeMessage();if(!this.dtFilter){this.dtFilter=new Ext.util.DelayedTask(this.filterDelayedTask,this);}
this.dtFilter.delay(this.asyncFilterDelay);},filterDelayedTask:function(){this.boundTree.query=this.filterField.getValue();this.boundTree.getRootNode().reload();},clearFilterField:function(){Mkt.widgets.AsyncFilterTreePanel.superclass.clearFilterField.apply(this,arguments);delete this.boundTree.query;this.boundTree.getRootNode().reload();}});
/* ========== ../mkt-ext-2.0/widgets/SmartPaletteTree.js ============ */

Mkt.widgets.SmartPaletteTreePanel=Ext.extend(Mkt.widgets.CachedTreePanel,{enableLoadMask:true,ddGroup:'default',rootVisible:false,enableDrag:true,lines:true,initComponent:function(){this.on('enddrag',function(tree,node,e){var nodeUI=node.getUI();if(nodeUI&&nodeUI.elNode){Ext.get(nodeUI.elNode).removeClass('x-tree-node-over');}}.createDelegate(this));Mkt.widgets.SmartPaletteTreePanel.superclass.initComponent.call(this);},arrangeTreeAfterCancel:function(){if(this.dpType=='Smartlist'){this.root.collapse(true,false);this.openFolders('/root/Triggers');this.openFolders('/root/Filters');this.openFolders('/root/Filters/Lead History');}}});
/* ========== ../mkt-ext-2.0/widgets/CheckedTreePanel.js ============ */

Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.CheckedTreePanel=Ext.extend(Mkt.widgets.CachedTreePanel,{enableLoadMask:true,rootVisible:false,lines:true,setChecked:function(checkedIds,check){checkedIds=checkedIds||[];var len=checkedIds.length;var node;var ui;for(var i=0;i<len;i++){node=this.getNodeById(checkedIds[i]);if(node){ui=node.getUI();if(ui&&ui.checkbox){ui.checkbox.checked=check;}
node.attributes.checked=check;}}},setCheckedTotal:function(root){var nodes=root.childNodes;var node;var totalBoxes=0;var totalChecked=0;for(var i=0;i<nodes.length;i++){node=nodes[i];if(node&&!node.isLeaf()){if(!node.childredRendered){this.getLoader().doPreload(node);}
totalBoxes=0;totalChecked=0;node.cascade(function(){totalBoxes++;if(this.attributes.checked)
totalChecked++;});node.setText(node.text.split(' (')[0]+" ("+totalChecked+" of "+totalBoxes+")");this.setCheckedTotal(node);}}}});
/* ========== ../mkt-ext-2.0/widgets/ComponentFilterTreePanel.js ============ */

Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.ComponentFilterTreePanel=Ext.extend(Mkt.widgets.CheckedTreePanel,{expandCheckedNodes:true,expandParentOnly:true,checkDelay:10,nodeIdAttr:'id',maxTreeWalkDepth:100,showDebugMessage:false,initComponent:function(){Mkt.widgets.ComponentFilterTreePanel.superclass.initComponent.call(this);this.on('checkchange',this.checkChange.createDelegate(this));this.getLoader().on('load',this.treeLoad.createDelegate(this));this.debug("initComponent: selected nodes",this.selectedNodes);this.checkTask=new Ext.util.DelayedTask(this.checkNodes,this);if(this.hasCache()){this.debug("has cache: selected nodes",this.selectedNodes);this.on('load',this.cacheLoaded,this);}},debug:function(){if(this.showDebugMessage){console.debug.apply(undefined,arguments);}},log:function(msg){if(this.showDebugMessage){console.log(msg);}},cacheLoaded:function(node){this.un('load',this.cacheLoaded,this);this.checkTask.delay(this.checkDelay);},checkNodes:function(){this.expandAndCheck(this.selectedNodes);},reInitCheckedNodes:function(){var checkedNodes=this.getChecked(this.nodeIdAttr);this.setChecked(checkedNodes,false);this.checkTask.delay(this.checkDelay);},treeLoad:function(){this.log("{treeLoad} tree loaded");this.checkTask.delay(this.checkDelay);},expandAndCheck:function(nodeIds){var nodeLen=nodeIds.length;for(var i=0;i<nodeLen;i++){this.log("{expandAndCheck} nodeId: "+nodeIds[i]);this.expandPathById(nodeIds[i],function(nodeId){this.log("checking node: "+nodeId);var node=this.getNodeById(nodeId);if(node){this.setChecked([nodeId],true);}}.createDelegate(this,[nodeIds[i]]));}},expandPathById:function(id,callback){if(!this.getRootNode()){return;}
var path;var node=this.getNodeById(id);if(node){if(this.expandParentOnly&&node.parentNode){node=node.parentNode;}
path=node.getPath(this.nodeIdAttr);}else{path=this.getNodePathById(id,!this.expandParentOnly);}
if(path){this.log("{expandPathById} id: "+id+", path: "+path);this.expandPath(path,this.nodeIdAttr,callback);}},expandAllPath:function(nodeIds){var nodeCount=nodeIds.length;this.debug("{expandAllPath} expandAllPath: ",nodeIds);var node,path;for(var i=0;i<nodeCount;i++){node=this.getNodeById(nodeIds[i]);if(!node){path=this.getNodePathById(nodeIds[i],!this.expandParentOnly);if(!path){continue;}}
if(!path){if(this.expandParentOnly&&node&&node.parentNode){node=node.parentNode;}
path=node.getPath(this.nodeIdAttr);}
this.log("expanding the path: "+path);this.expandPath(path,this.nodeIdAttr);}},checkChange:function(node,checked){if(node.getDepth()==1&&checked){var hashKeys=this.getNodeHashKeys();if(hashKeys){var rootIndex=hashKeys.indexOf(node.id+"");hashKeys.splice(rootIndex,1);}
this.setChecked(hashKeys,false);}else{this.setChecked([this.getVisibleRootNode().id],false);}},getNodeHashKeys:function(){var keys=[];for(key in this.nodeHash){keys.push(key);}
return keys;},getVisibleRootNode:function(){if(this.getRootNode().childNodes){return this.getRootNode().childNodes[0];}},treeWalk:function(fn,node,scope,args){if(!fn||!isFunction(fn)){return;}
this.currentTreeWalkDepth=this.currentTreeWalkDepth||0;if(this.currentTreeWalkDepth>this.maxTreeWalkDept){return;}
if(!node){var root=this.getRootNode();node=this.rootVisible?root:root.childNodes[0];}
node=node||this.getRootNode();if(node){var children;if(node.attributes){children=node.attributes.children;}else{children=node.children;}
if(!children){return;}
var csLen=children.length;for(var i=0;i<csLen;i++){if(fn.apply(scope||children[i],[children[i]].concat([args]))!==false){if(this._hasChildren(children[i])){if(this.treeWalk(fn,children[i],scope,args)==false){return false;}}}else{return false;}}}},_hasChildren:function(node){if(!node){return false;}
if(node.children&&isArray(node.children)&&node.children.length>0){return true;}
else if(node.attributes&&node.attributes.children&&isArray(node.attributes.children)&&node.attributes.children.length>0){return true;}
return false;},_buildPath:function(id,rel){var p=rel[id];var b=[];while(p){b.unshift(p);p=rel[p];}
return b;},getNodePathById:function(id,includeNode){var path;var treeWalkArgs={nodeId:id,rel:{}};this.treeWalk(function(node,args){var parentId=node.parentId;if(parentId){args['rel'][node.id]=parentId;}
if(node.id==args.nodeId){args['matchFound']=true;return false;}}.createDelegate(this),undefined,undefined,treeWalkArgs);if(treeWalkArgs['matchFound']){var pathArr=this._buildPath(id,treeWalkArgs['rel']);if(pathArr.length>0){pathArr.unshift(this.getRootNode().id);if(includeNode!==false){pathArr.push(id);}
path=this.pathSeparator+pathArr.join(this.pathSeparator);}}
this.log("{getNodePathById} path: "+path);return path;}});
/* ========== ../mkt-ext-2.0/widgets/ColumnTree.js ============ */

Ext.tree.ColumnTree=Ext.extend(Ext.tree.TreePanel,{lines:true,borderWidth:Ext.isBorderBox?0:2,cls:'x-column-tree',onRender:function(){Ext.tree.ColumnTree.superclass.onRender.apply(this,arguments);this.headers=this.body.createChild({cls:'x-tree-headers'},this.innerCt.dom);var cols=this.columns,c;var totalWidth=0;for(var i=0,len=cols.length;i<len;i++){c=cols[i];totalWidth+=c.width;this.headers.createChild({cls:'x-tree-hd '+(c.cls?c.cls+'-hd':''),cn:{cls:'x-tree-hd-text',html:c.header},style:'width:'+(c.width-this.borderWidth)+'px;'});}
this.headers.createChild({cls:'x-clear'});this.headers.setWidth(totalWidth);this.innerCt.setWidth(totalWidth);}});Ext.tree.ColumnNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{focus:Ext.emptyFn,totalWidth:700,renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var t=n.getOwnerTree();if(isUndefined(t)){return;}
var cols=t.columns;var bw=t.borderWidth;var c=cols[0];var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<div class="x-tree-col" style="width:',c.width-bw,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',a.href?a.href:"#",'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",'>','<span unselectable="on">',n.text||(c.renderer?c.renderer(a[c.dataIndex],n,a):a[c.dataIndex]),"</span></a>","</div>"];for(var i=1,len=cols.length;i<len;i++){c=cols[i];var editable=c.editable&&a.descEditable;buf.push('<div class="x-tree-col ',(c.cls?c.cls:''),'" style="width:',c.width-bw,'px;">','<div class="x-tree-col-text node-id-',n.id,'-col-index-',i,(editable?' x-tree-col-editable':''),'">',(c.renderer?c.renderer(a[c.dataIndex],n,a):a[c.dataIndex]),"</div>","</div>");}
buf.push('<div class="x-clear"></div></div>','<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf.join(""));}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf.join(""));}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.firstChild.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];this.anchor=cs[3];this.textNode=cs[3].firstChild;if(this.elNode&&t&&t.editor){Ext.get(this.elNode).on('click',function(e,dom){if(Ext.get(dom).hasClass('x-tree-col-editable')){var tree=this.node.getOwnerTree();tree.editor.completeEdit();tree.startEdit.apply(tree,[e,dom,this.node]);}},this);}},getChildIndent:function(){if(!this.childIndent){var buf=[];var p=this.node;while(p){if(p.parentNode&&p.parentNode.isRoot&&!p.ownerTree.rootVisible){break;}
if(!p.isRoot||(p.isRoot&&p.ownerTree.rootVisible)){if(!p.isLast()){buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-elbow-line" />');}else{buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-icon" />');}}
p=p.parentNode;}
this.childIndent=buf.join("");}
return this.childIndent;},appendDDGhost:function(dom){Ext.tree.ColumnNodeUI.superclass.appendDDGhost.call(this,dom);var el=Ext.get(dom);el.setWidth(this.totalWidth);el.addClass('x-tree-col-dd-ghost');},getDDHandles:function(){return Ext.query('*',this.elNode);}});
/* ========== ../mkt-ext-2.0/main/explorer.js ============ */

Ext.namespace('Mkt','Mkt.main');Mkt.main.ExplorerPanel=Ext.extend(Mkt.widgets.FilterTreePanel,{processJSONOptions:{ignoreGroupIds:['bookmarks'],removeInactiveGroups:true,hideInactiveGroups:true,replaceGroups:true},enableCache:true,initComponent:function(){Mkt.main.ExplorerPanel.superclass.initComponent.call(this);this.treeBox=this.items.items[0];},getPrefixedUrl:function(url){var urlPrefix=MktSession.getUrlPrefix();if(url.indexOf(urlPrefix)==-1){var sep=url.indexOf("/")==0?"":"/";url=urlPrefix+sep+url;}
return url;},loadTree:function(url,ajopts){ajopts=Ext.apply({},ajopts);if(ajopts.serializeParms){ajopts.serializeParms=Ext.apply({},ajopts.serializeParms);}
url=this.getPrefixedUrl(url);var cache=Mkt.main._ExplorerPanelCachedData[url];if(this.enableCache&&cache&&cache.alwaysLoadFromCache){console.debug("Always load from cache. Using cache: ",cache);cache.loadFromLocalCache=true;this.processJSONResults(cache,undefined,url);if(isFunction(ajopts.onMySuccess)){ajopts.onMySuccess();}
return;}else if(this.enableCache&&cache){ajopts=ajopts||{};var xtraParms={};if(cache.contents[0].meta.update){xtraParms.clientTreeUpdatedAt=Ext.encode(cache.contents[0].meta.update);}
if(cache.contents[0].meta.viewedAt){xtraParms.clientTreeUpdatedAt=cache.contents[0].meta.viewedAt;}
ajopts.serializeParms=ajopts.serializeParms||{};ajopts.serializeParms=Ext.apply(ajopts.serializeParms,xtraParms);}
console.log("making a request to: "+url);ajopts.URLPrefix=false;MktSession.ajaxRequest(url,ajopts);},processJSONResults:function(exp,options,url){if(MktMainNav.activeNav!=exp.nav){return;}
if(this.enableCache){if(exp.loadFromLocalCache){console.debug("using json from the exp cache",exp);exp=Mkt.main._ExplorerPanelCachedData[url];}else if(exp.cacheUpdates&&exp.contents[0]&&exp.contents[0]['updates']&&exp.contents[0]['updates'].length>0){console.debug("updated nodes found, updating...",exp);var cachedExp=this.currExpCache=Mkt.main._ExplorerPanelCachedData[url];this.updateExpCache(cachedExp,exp);exp=cachedExp;}else if(exp.contents[0]&&exp.contents[0]['tree']&&exp.contents[0]['tree'].length>0){console.debug("adding json to cache: "+url,"exp",exp);Mkt.main._ExplorerPanelCachedData[url]=exp;}else{console.log("invalid explorer content, using the cache, will refresh it next time");exp=Mkt.main._ExplorerPanelCachedData[url];if(isDefined(exp.contents[0].meta.update)){delete exp.contents[0].meta.update;};if(isDefined(exp.contents[0].meta.viewedAt)){delete exp.contents[0].meta.viewedAt;};}
this.currExpCache=exp;}
this.processResults(exp,options);},processResults:function(exp,options){try{if(!isDefined(options)){options=this.processJSONOptions;}
var needRefresh=false;var newGroupIds=[];for(var i=0;i<exp.contents.length;i++){newGroupIds.push(exp.contents[i].meta.id);}
var items=this.treeBox.items.items;for(var i=0;i<items.length;i++){var grp=items[i];if(newGroupIds.indexOf(grp.id)==-1){if(options.removeInactiveGroups){this.remove(grp);needRefresh=true;i--;}
else if(options.hideInactiveGroups){grp.hide();}}}
var activeGroupIds=[];for(var i=0;i<exp.contents.length;i++){var groupConfig=exp.contents[i];groupConfig.active=i==0;var groupId=groupConfig.meta.id;var cGrp=this.getComponent(groupId);if(cGrp){activeGroupIds.push(groupId);if(options.replaceGroups){this.remove(cGrp);needRefresh=true;}
else{grp.show();continue;}}
if(options.ignoreGroupIds.indexOf(groupId)==-1){this._addGroup(groupConfig,options);activeGroupIds.push(groupId);needRefresh=true;}}
if(needRefresh){this.doLayout();}
if(MktExplorer.defaultFolderID&&MktExplorer.defaultFolderID!=''){MktExplorer.selectNodeById(MktExplorer.defaultFolderID);MktExplorer.defaultFolderID='';}}
catch(e){console.debug('MktExplorer.processJSONResults exception squelched ',e);console.debug('MktExplorer.processJSONResults needs refactoring!');}
this.unmask();},updateExpCache:function(cachedExp,exp){if(isUndefined(exp.contents[0])||isUndefined(exp.contents[0]['updates'])){return;}
var updates=exp.contents[0]['updates'];for(var i=0;i<updates.length;i++){if(updates[i].status&&updates[i].status=="Deleted"){this.cachedNodeDelete(updates[i].id);}else{this.cachedNodeUpdate(updates[i]);}
cachedExp['contents'][0]['meta']=exp['contents'][0]['meta'];}
if(updates){delete updates;delete exp.contents[0]['updates'];}},maskMsg:'',maskCls:'x-tree-mask-loading x-mask-loading',maskFilterField:false,mask:function(){this.hideMessage();try{this.clearFilterField(false);}
catch(e){}
if(this.maskFilterField){this.el.mask(this.maskMsg,this.maskCls);}
else{if(this.filterField)this.filterField.setDisabled(true);this.treeBox.body.mask(this.maskMsg,this.maskCls);}},unmask:function(){if(this.maskFilterField){this.el.unmask();}
else{if(this.filterField)this.filterField.setDisabled(false);this.treeBox.body.unmask();}},showMessage:function(msg){this.unmask();this.addClass("mktFilterNoResults");this.el.mask(msg);},hideMessage:function(){this.el.unmask();},_addGroup:function(config,options){this.currentGroup=config.meta.id;var tree=null;if(config.tree){tree=new Mkt.main.ExplorerDDTreePanel({id:config.meta.id+'Tree',cls:'mktTree mktTreeBox',loadMask:true,selModel:new MktExplorerSelectionModel(),loader:new MktTreeLoader({uiProvider:MktTreeNodeUI,dataUrl:"/folder/getTreeNodes"})});this.bindTree(tree);tree.on('beforenodedrop',function(dropEvent){if(dropEvent.source.dragData.node){var node=dropEvent.source.dragData.node;var destNodeId=dropEvent.target.attributes.id;MktFolder.moveItemSubmit(node,destNodeId);}});tree.editor=new Ext.tree.TreeEditor(tree,{allowBlank:false,blankText:'A name is required',selectOnFocus:true,autosize:true,cancelOnEsc:true,ignoreNoChange:true});var editor=tree.editor;editor.on('beforestartedit',function(editor,el,value){var elDom=el.dom;if(isDefined(elDom.renaming)&&elDom.renaming){MktFolder.beforeStartEdit();elDom.renaming=false;}else{return false;}});var root=new Ext.tree.AsyncTreeNode({text:'root',id:config.meta.id+'root',cls:'folder',leaf:false,expanded:true,children:config.tree});tree.setRootNode(root);this.treeBox.add(tree);}},onTree:function(groupId,event,func){if(this.boundTree&&this.currentGroup==groupId){this.boundTree.on(event,func);}},isExplorer:true,filterBranches:false,filterBranchNames:true,filterFieldEmptyText:'Quick Find...',filterFieldTooltip:"Start typing to find items in the list below. If you don't find what you're looking for, click the button on the right to search all of Marketo!",filterFieldPadding:5,filterFieldConfig:{hideTrigger:false,disableAutosuggest:false,disabled:true,displayField:'Quick Search',typeAhead:false,mode:'remote',triggerAction:'all',minChars:0,loadingText:'Searching Marketo...',itemSelector:'div.search-item',triggerClass:'mkiFindNext',listWidth:300,resizable:true,listAlign:'tl-tr',listClass:'mkt-search-marketo-results',onSelect:function(record){MktDlManager.loadDl(record.json.xtra);this.collapse();return false;},listeners:{'beforequery':{fn:function(queryEvent){if(!queryEvent.forceAll){this.collapse();return false;}
var q=this.getValue();if(q==''){this.loadingText='Loading History...';this.lastQuery=null;}
else{queryEvent.query=this.query=q;this.loadingText='Searching All Marketo for \"'+q+'\"...';}
return true;}}},store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'homepage/quickSearch',onload:function(){}}),reader:new Ext.data.JsonReader({root:'rows',totalProperty:'resultCount',id:'result_id'},[{name:'text',mapping:'text'},{name:'qtip',mapping:'qtip'},{name:'iconCls',mapping:'iconCls'},{name:'cls',mapping:'cls'},{name:'exactMatch',mapping:'exactMatch'},{name:'accessZoneId',mapping:'accessZoneId'}])}),tpl:new Ext.XTemplate('<tpl for="."><div class="search-item {cls}" ext:qtip="{qtip}">','<div class="resCt" ext:qtip="{qtip}">','<a hidefocus="on" href="#" style="text-decoration:none;position:relative;">','<div class="search-item-text" unselectable="on">','<div class="mki16 {iconCls}"></div>','<div ext:qtip="{qtip}">{text}</div>','</div>','</a>','</div>','</div></tpl>')},arrangeTreeBeforeFilter:Ext.emptyFn,arrangeTreeAfterCancel:function(initialLoad){if(!initialLoad){this.boundTree.root.cascade(function(n){if(n.expanded&&!n.attributes.leaf&&n.attributes.xtra&&n.attributes.xtra.stickyCollapsed){this.expanded=false;this.ui.collapse();}});}},enterKeyPressed:function(text){this.filterField.onTriggerClick();return true;},searchAllMarketo:function(){this.filterField.onTriggerClick();},noResults:function(text){this.showTreeMessage('<div>'+this.filterNoResultsText+'&ldquo;'+Ext.util.Format.htmlEncode(text)+'&rdquo;'+'</div>'+'<div style="margin-top: 10px; text-align: center;">'+'<div id="MktExplorerSearchAllMarketo"></div>'+'</div>');new Ext.Button({renderTo:'MktExplorerSearchAllMarketo',text:'Search All Marketo',iconCls:'mkiFindNext',handler:function(){MktExplorer.searchAllMarketo();}});},getTreeNodeFromCache:function(nodeId,cacheKey){var cache;if(isUndefined(cacheKey)){cache=this.currExpCache;}else{cache=Mkt.main._ExplorerPanelCachedData[cacheKey];}
if(isUndefined(cache)){return;}
return this.findCachedTreeNodeById(nodeId,cache.contents[0].tree);},findCachedTreeNodeById:function(nodeId,folder){var foundNode;for(var i=0;i<folder.length;i++){if(folder[i].id==nodeId){foundNode=folder[i];break;}else if(folder[i].children&&folder[i].children.length>0){var ret=this.findCachedTreeNodeById(nodeId,folder[i].children);if(isDefined(ret)){foundNode=ret;break;}}}
return foundNode;},setCachedNodeProperty:function(nodeId,property,value){var cachedNode=this.getTreeNodeFromCache(nodeId);if(cachedNode){cachedNode[property]=value;}
return cachedNode;},cachedNodeUpdate:function(nodeObj){var cachedNode=this.cachedNodeExists(nodeObj.id);if(cachedNode){if(nodeObj['parentId']!=cachedNode['parentId']){var prnCachedNode=this.getTreeNodeFromCache(cachedNode['parentId']);if(prnCachedNode){if(prnCachedNode.children.length==1){prnCachedNode.hasChildren=false;prnCachedNode.leaf=true;delete prnCachedNode.expanded;delete prnCachedNode.children;}}
this.cachedNodeDelete(nodeObj.id);this.cachedNodeAdd(nodeObj);}else{Ext.apply(cachedNode,nodeObj);}}else{this.cachedNodeAdd(nodeObj);}},cachedNodeExists:function(nodeId){return this.getTreeNodeFromCache(nodeId);},cachedNodeReplace:function(nodeId,nodeObj){var cached=this.getTreeNodeFromCache(nodeId);if(cached){Ext.apply(cached,nodeObj);}
return cached;},cachedNodeAdd:function(nodeObj){var cachedParentNode=this.cachedNodeExists(nodeObj.parentId);if(cachedParentNode){if(isUndefined(cachedParentNode.children)){cachedParentNode.children=[];}
cachedParentNode.children.push(nodeObj);}},cachedNodeDelete:function(nodeId){var nodeCache=this.getTreeNodeFromCache(nodeId);if(nodeCache){this.cachedNodeDeleteChild(nodeCache.parentId,nodeId);delete nodeCache;}},cachedNodeDeleteChild:function(parentId,nodeId){var parentNodeCache=this.getTreeNodeFromCache(parentId);if(parentNodeCache){for(var i=0;i<parentNodeCache.children.length;i++){if(parentNodeCache.children[i].id==nodeId){parentNodeCache.children.remove(parentNodeCache.children[i]);break;}}}}});Mkt.main._ExplorerPanelCachedData={};Mkt.main.ExplorerPanel.prototype.clear=function(){try{if(!this.treeBox.items)return;var items=this.treeBox.items.items;for(var i=0;i<items.length;i++){this.treeBox.remove(items[i]);}}
catch(e){console.debug('Mkt.main.ExplorerPanel.clear squelched exception ',e);console.debug('Mkt.main.ExplorerPanel.clear needs refactoring!');}};Mkt.main.ExplorerPanel.prototype.onTreeEditor=function(groupId,event,func){if(this.boundTree&&this.currentGroup==groupId){this.boundTree.editor.on(event,func);}};Mkt.main.ExplorerPanel.prototype.getNodeById=function(nodeId){if(!this.boundTree||!this.boundTree.nodeHash)return null;return this.boundTree.getNodeById(nodeId);};Mkt.main.ExplorerPanel.prototype.findNodeByName=function(name){if(!this.boundTree||!this.boundTree.root)return null;return this.boundTree.root.findChild('text',name);};Mkt.main.ExplorerPanel.prototype.findNodeByCompId=function(compType,compId){var rootNode=this.boundTree.root;var matches=[];var node=rootNode.cascade(function(){var attr=this.attributes;if(attr&&attr.xtra){if(attr.xtra.compType==compType&&attr.xtra.compId==compId){matches.push(this);}}},undefined,[compType,compId]);console.debug("MktExplorerPanel.findByCompId: Matches: ",matches);return matches;};Mkt.main.ExplorerPanel.prototype.selectNodeByName=function(name){var node=this.findNodeByName(name);if(!node)return false;return this.selectTreeNode(node);};Mkt.main.ExplorerPanel.prototype.selectNodeById=function(nodeId){var node=this.getNodeById(nodeId);if(!node)return false;return this.selectTreeNode(node);};Mkt.main.ExplorerPanel.prototype.selectPath=function(path,attr){if(!this.boundTree||!this.boundTree.nodeHash)return false;MktExplorer.boundTree.selectPath(path,attr||'text');};Mkt.main.ExplorerPanel.prototype.selectNode=Mkt.main.ExplorerPanel.prototype.selectNodeById;Mkt.main.ExplorerPanel.prototype.selectTreeNode=function(node){if(!node)return false;if(!node.isSelected()){if(node.parentNode&&!node.parentNode.isExpanded()){node.parentNode.expand();}
node.render();node.select();return true;}else{return false;}};Mkt.main.ExplorerPanel.prototype.unselectNode=function(nodeId){var node=this.getNodeById(nodeId);if(node){node.unselect();}};Mkt.main.ExplorerPanel.prototype.expandNodeByServerPaths=function(paths){if(!paths){return;}
var pathSeparator=this.boundTree.pathSeparator;var serverPathSeparator='/';var clientRootName='root';for(var i=0;i<paths.length;i++){var path=paths[i];if(path){var folders=path.split(serverPathSeparator);if(folders&&folders.length>2){folders.splice(0,2);this.boundTree.expandPath((pathSeparator+clientRootName+pathSeparator)+
folders.join(pathSeparator),'text');}}}};Mkt.main.ExplorerPanel.prototype.addNode=function(parentId,nodeConfig,selected){if(isUndefined(parentId)||isUndefined(nodeConfig)){return;}
var node=this.getNodeById(parentId);if(node){nodeConfig=Ext.applyIf(nodeConfig,{uiProvider:MktTreeNodeUI});function createNSelect(){var newNode=nodeConfig.leaf?new MktTreeNode(nodeConfig):new MktAsyncTreeNode(nodeConfig);node.leaf=false;node.attributes.leaf=false;node.appendChild(newNode);if(selected===true){newNode.ensureVisible();if(node.childrenRendered){newNode.select();}}}
if(!node.isExpanded()){node.expand(false,false,createNSelect.createDelegate(this));}else{createNSelect();}}};Mkt.main.ExplorerPanel.prototype.addNodes=function(nodeConfigs){if(isUndefined(nodeConfigs)||!isArray(nodeConfigs)||nodeConfigs.length<=0){return;}
var len=nodeConfigs.length;for(var i=0;i<len;i++){this.addNode(nodeConfigs[i].parentId,nodeConfigs[i]);}};Mkt.main.ExplorerPanel.prototype.removeNode=function(nodeId){var node=this.getNodeById(nodeId);if(node){node.remove(node);}};Mkt.main.ExplorerPanel.prototype.removeNodes=function(nodeIds){if(isUndefined(nodeIds)){return;}
if(!isArray(nodeIds)&&(isString(nodeIds)||isNumber(nodeIds))){nodeIds=[nodeIds];}
var len=nodeIds.length;for(var i=0;i<len;i++){var node=this.getNodeById(nodeIds[i]);if(isDefined(node)){node.remove();}}};Mkt.main.ExplorerPanel.prototype.replaceNode=function(oldNodeId,newNodeJson){this.removeNode(oldNodeId);this.addNode(newNodeJson.parentId,newNodeJson,false);};Mkt.main.ExplorerPanel.prototype.removeChildNodes=function(parentNodeId){var node=this.getNodeById(parentNodeId);if(isDefined(node)){var tree=node.getOwnerTree();tree.removeChildNodes(parentNodeId);}};Mkt.main.ExplorerPanel.prototype.replaceNodes=function(newNodeJsons){if(isUndefined(newNodeJsons)){return;}
if(newNodeJsons&&!isArray(newNodeJsons)&&!newNodeJsons.length){newNodeJsons=[newNodeJsons];}
var len=newNodeJsons.length;for(var i=0;i<len;i++){var node=this.getNodeById(newNodeJsons[i].id);if(isDefined(node)&&node){var selected=node.isSelected();var newNode=newNodeJsons[i].leaf?new MktTreeNode(newNodeJsons[i]):new MktAsyncTreeNode(newNodeJsons[i]);var prnNode=node.parentNode;var prnExpanded=prnNode.isExpanded();prnNode.replaceChild(newNode,node);if(selected){var tempNode=newNode;var tempPrnNode=prnNode;var tempPrnExpanded=prnExpanded;window.setTimeout(function(){function selectUnselect(){tempNode.unselect();tempNode.select();}
if(tempPrnExpanded&&!tempPrnNode.isExpanded()){tempPrnNode.expand(false,false,selectUnselect);}else{selectUnselect();}}.createDelegate(tempNode),500);}}}};Mkt.main.ExplorerPanel.prototype.expandFolder=function(folderId,deep,anim){var folder=this.getNodeById(folderId);if(folder){deep=deep||false;anim=anim||false;folder.expand(deep,anim);}};Mkt.main.ExplorerPanel.prototype.updateNodeText=function(nodeId,text){var node=this.getNodeById(nodeId);if(node){node.setText(text);}};Mkt.main.ExplorerPanel.prototype.updateNodeIconCls=function(nodeId,iconCls,rmIconCls,node){var fNode;if(isUndefined(node)){fNode=this.getNodeById(nodeId);}else{fNode=node;}
if(fNode){var iconEl=Ext.get(fNode.getUI().getIconEl());if(iconEl){if(rmIconCls){iconEl.removeClass(rmIconCls);}
iconEl.addClass(iconCls);}
else{var temp=fNode.attributes.iconCls;if(temp.indexOf(iconCls)==-1){temp+=(' '+iconCls);}
if(rmIconCls){temp=temp.replace(rmIconCls,'');}
fNode.attributes.iconCls=temp;}}};Mkt.main.ExplorerPanel.prototype.updateNodeAttr=function(containerId,nodeId,xtra,node){var fNode;if(isUndefined(xtra)){return;}else if(isDefined(node)){fNode=node;}else if(!isNull(containerId)&&!isNull(nodeId)){fNode=this.getNodeById(nodeId);}else{return;}
if(fNode){Ext.apply(fNode.attributes.xtra,xtra);if(isDefined(xtra.text)){fNode.setText(xtra.text);}}};Mkt.main.ExplorerPanel.prototype.updateNode=function(containerId,nodeId,attrib,node){var fNode;if(isUndefined(attrib)){return;}else if(isDefined(node)){fNode=node;}else if(!isNull(containerId)&&!isNull(nodeId)){fNode=this.getNodeById(nodeId);}else{return;}
if(isDefined(attrib)){var attr=fNode.attributes;if(isDefined(attrib.text)){attrib.xtra.text=attrib.text;}
this.updateNodeAttr(null,null,attrib.xtra,fNode);this.updateNodeIconCls(null,null,attrib.iconCls,attrib.rmIconCls,fNode);}};Mkt.main.ExplorerPanel.prototype.updateNodes=function(containerId,nodeJsons,stateIconCls){var c=nodeJsons.length;for(var i=0;i<c;i++){nodeJsons[i].rmIconCls=nodeJsons[i].rmIconCls||stateIconCls;this.updateNode(containerId,nodeJsons[i].id,nodeJsons[i]);}};Mkt.main.ExplorerPanel.prototype.expandAllNodes=function(containerId,accordionId){var tree=this.getTree(containerId,accordionId);if(tree){tree.expandAll();}};Mkt.main.ExplorerPanel.prototype.setCurTip=function(tip){tip.on('render',function(el){this.tip=el;},tip);};Mkt.main.ExplorerPanel.prototype.syncTipSize=function(width){if((isDefined(this.tip))&&width>=105){this.tip.setWidth(width);}};MktExplorerSelectionModel=Ext.extend(Ext.tree.DefaultSelectionModel,{init:function(tree){MktExplorerSelectionModel.superclass.init.call(this,tree);tree.getTreeEl().un("keydown",this.onKeyDown,this);}});Mkt.main.ExplorerPanel.nodeContextMenuSetup=function(node,menu){if(!node||!menu){return;}
Ext.get(node.getUI().elNode).addClass("x-tree-contextmenu");menu.on("hide",function(menu){if(!this){return;}
var nodeUI=this.getUI();if(nodeUI&&nodeUI.elNode){Ext.get(this.getUI().elNode).removeClass("x-tree-contextmenu");}}.createDelegate(node));};Ext.namespace('Mkt.main.ExplorerDDTreePanel');Mkt.main.ExplorerDDTreePanel=Ext.extend(Ext.tree.TreePanel,{frame:false,layout:'fit',autoScroll:true,containerScroll:true,animate:true,enableDD:true,ddGroup:'treeDD',rootVisible:false,bufferResize:300,enableCache:true,initEvents:function(){if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new MktDDTreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"treeDD",appendOnly:this.ddAppendOnly===true});}
Mkt.main.ExplorerDDTreePanel.superclass.initEvents.call(this);}});MktDDTreeDropZone=Ext.extend(Ext.tree.TreeDropZone,{getDropPoint:function(e,n,dd){if(dd.dragData.node){var draggedNode=dd.dragData.node;var draggedAttr=draggedNode.attributes;var dXtraAttr=draggedAttr.xtra;var dNodeType=draggedAttr.nodeType;var targetNode=n.node;var targetAttr=targetNode.attributes;var tNodeType=targetAttr.nodeType;if(draggedNode.attributes.isShared||targetAttr.isShared||draggedNode.attributes.isMasterShared){return;}
if(draggedNode.attributes.folder===false&&targetNode.attributes.accessZoneId!=draggedNode.attributes.accessZoneId){return;}
if(draggedNode.attributes.folder===true&&dXtraAttr.hasDraftNode&&targetNode.attributes.accessZoneId!=draggedNode.attributes.accessZoneId){return;}
if(isDefined(draggedNode.parentNode)&&targetNode.id==draggedNode.parentNode.id){return;}
if(targetNode.attributes.nodeType==draggedNode.attributes.nodeType&&targetNode.attributes.folder===true){if(targetAttr.xtra&&targetAttr.xtra.hasDraftNode){return;}
if(targetAttr.nodeType=='List'){if(targetAttr.text!='System Lists'){return'append';}}
else if(targetAttr.nodeType=='Smart List'){if(targetAttr.text!='System Smart Lists'){return'append';}}
else if(targetAttr.nodeType=='Landing Page Test Group'){}
else if(dNodeType=="Landing Page"){var parentNode=MktExplorer.getNodeById(draggedNode.attributes.parentId);if(parentNode){if(parentNode.attributes.nodeType=="Landing Page Test Group"){}
else if(dNodeType==targetAttr.nodeType){return'append';}}}
else if((dNodeType=="Marketing Event"||dNodeType=="Marketing Program")&&tNodeType==dNodeType){return;}
else if((dNodeType=="Marketing Event"||dNodeType=="Marketing Program")&&targetAttr.marketingProgramId){return;}
else if(draggedAttr.marketingProgramId||targetAttr.marketingProgramId){if(draggedAttr.marketingProgramId==targetAttr.marketingProgramId){return'append';}
return;}
else{return'append';}}
else if(targetNode.attributes.nodeType=="Zone"&&(dNodeType=="Marketing Folder"||dNodeType=="Report")&&!draggedAttr.marketingProgramId){return'append';}
else if(draggedAttr.marketingProgramId&&targetAttr.folder===true){if(draggedAttr.marketingProgramId==targetAttr.marketingProgramId){return'append';}
else if((targetAttr.nodeType=="Marketing Event"||targetAttr.nodeType=="Marketing Program")&&targetAttr.compId==draggedAttr.marketingProgramId){return'append';}
return;}
else if((targetNode.attributes.nodeType=='Marketing Folder')&&targetNode.attributes.folder){var dNodeType=draggedNode.attributes.nodeType;if(dNodeType=='Smart Campaign'&&draggedAttr.marketingProgramId==targetAttr.marketingProgramId){return'append';}
else if((dNodeType=='Marketing Program'||dNodeType=='Marketing Event')&&!targetAttr.marketingProgramId&&targetAttr.accessZoneId==draggedAttr.accessZoneId){return"append";}}
else if(dNodeType=='Landing Page Test Group'&&targetAttr.folder&&targetAttr.nodeType=='Landing Page'){return'append';}}
else if(dd.dragData.grid){var activeTab=MktCanvas.getActiveTab();if(activeTab){var accessZoneId=activeTab.config['accessZoneId'];}
if(!n.node.attributes.folder&&n.node.attributes.nodeType=='List'&&accessZoneId==n.node.attributes.accessZoneId){return'append';}
else if(n.node.attributes.folder&&n.node.attributes.nodeType=='Image'&&accessZoneId==n.node.attributes.accessZoneId){return'append';}}}});
/* ========== ../mkt-ext-2.0/widgets/CanvasMask ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.CanvasMask={cls:'mktFullCanvasGrid',mask:function(panel,msg,cls,subtle){msg=msg||this.maskMsg;if(subtle){panel.addClass('mktCanvasMaskSubtle');}
else{panel.removeClass('mktCanvasMaskSubtle');MktViewport.showPurpleCorners(false);}
panel.addClass('mktCanvasPanelManagerMasked');panel.body.mask(msg,cls||this.maskCls);},unmask:function(panel){panel.removeClass('mktCanvasPanelManagerMasked');panel.removeClass('mktCanvasMaskSubtle');panel.body.unmask();this.unmaskCharts(panel);},updateMaskMsg:function(panel,msg,cls,animate,animCallback){cls=cls||this.maskCls;var el=Ext.query('.'+this.maskCls,Ext.getDom(panel.getEl()));if(el&&el.length>0){var maskEl=Ext.getDom(el[0].firstChild);if(maskEl){var eMaskEl=Ext.get(maskEl);var parentMaskEl=Ext.get(maskEl.parentNode);if(animate&&parentMaskEl){parentMaskEl.fadeOut({callback:function(animCallback){this._updateMaskMsg(maskEl,msg,cls);if(parentMaskEl.dom){parentMaskEl.fadeIn();}
if(animCallback&&isFunction(animCallback)){animCallback();}}.createDelegate(this,[animCallback])});}
else{this._updateMaskMsg(maskEl,msg,cls);}}}},_updateMaskMsg:function(maskEl,msg,cls){msg=msg||"";var eMaskEl=Ext.get(maskEl);if(eMaskEl){var eParentEl=Ext.get(eMaskEl.dom.parentNode);if(typeof msg=='string'){eMaskEl.update(msg);eParentEl.addClass(cls);}
else{while(maskEl.firstChild){maskEl.removeChild(maskEl.firstChild);}
maskEl.appendChild(msg);eParentEl.addClass(cls);}}},maskMsg:'Loading...',clearForLoadMaskMsg:'Loading...',maskCls:'mktCanvasMaskActivity',unmaskCharts:function(panel){var objects=Ext.query('object',panel.body.dom).forEach(function(el,ix,a){Ext.fly(el).setStyle('visibility','visible');var embed=Ext.fly(Ext.query('embed',el)[0]);if(embed){embed.setStyle('visibility','visible');}});}};Mkt.widgets.CanvasMaskPanel=Ext.extend(Ext.Panel,{mask:function(msg,junkTabId,cls,subtle){this._isMasked=true;Mkt.widgets.CanvasMask.mask(this,msg,cls,subtle);},unmask:function(){if(!this._isMasked){return;}
this._isMasked=false;Mkt.widgets.CanvasMask.unmask(this);},_isMasked:false});
/* ========== ../mkt-ext-2.0/main/canvas.js ============ */

MktCanvasPanelManager=Ext.extend(Ext.TabPanel,{cls:"mktCanvasPanelManager",reservedHeight:20,clearCanvasHook:Ext.emptyFn,titleLength:40,afterRender:function(){MktCanvasPanelManager.superclass.afterRender.call(this);this[this.stripTarget].addClass('m-large-tabs');},add:function(config,canvasHoldingPen,jsonResponse,ajaxRequest){var existingTab=this.getTab(config.id);if(existingTab){this.remove(existingTab);existingTab=null;}
var tabId=this._makeTabId(config.id);config=Ext.apply({title:'Untitled',titleLength:this.titleLength,contentValid:true,contentValidOnceLoaded:true,hidden:false,closablePanel:false},config);var params={id:tabId,title:config.title.ellipse(config.titleLength),config:config,canvasPanelMgr:this,closable:config.closablePanel};if(!config.hideGutter){params.tbar=[{text:'',disabled:true,removeOnExtend:true}];params.gutter=[{text:'',disabled:true,removeOnExtend:true}];}
if(isDefined(config.iconCls))params.iconCls=config.iconCls;if(isDefined(config.tabTip))params.tabTip=config.tabTip;if(isDefined(config.tbar)){params.tbar=eval(config.tbar);}
if(isDefined(config.gutter)){params.gutter=eval(config.gutter);}
var panel=new MktCanvasPanel(params);MktCanvasPanelManager.superclass.add.call(this,panel);if(config.active){this.setActiveTab(config.id);}},setActiveTab:function(id,callback){if(!id){return null;}
this.requestLockedTab(null);if(this.activeTab&&this.isActiveTab(id)){if(this.activeTab.config.contentValid){return null;}
return this.reloadActiveTab(callback);}
var tab=this.getTab(id);if(!tab){this.log('tab '+id+' not found, aborting');return null;}
if(tab._lock){this.requestLockedTab(tab);return null;}
if(isDefined(callback)){tab._activateCallback=callback;}
MktCanvasPanelManager.superclass.setActiveTab.call(this,tab.id);return null;},getTabId:function(id){if(!id){return null;}
return this._makeTabId(id);},getTab:function(id){if(!id){return null;}
return this.getItem(this._makeTabId(id));},getFirstTab:function(){if(!this.items||!this.items.items){return null;}
return this.items.items[0];},reloadActiveTab:function(callback){if(this.activeTab&&this.activeTab._lock){this.requestLockedTab(this.activeTab);return;}
if(this.activeTab){this.activeTab.cancelRequest();}
if(isDefined(this.activeTab.config.url)){this.activeTab.config.contentValid=false;}
if(isDefined(callback)){tab._activateCallback=callback;}
this.activeTab.fireEvent('activate',this.activeTab);},_processCanvasMapMutex:false,processCanvasMap:function(canvasHoldingPen,jsonResponse,ajaxRequest){if(!isArray(jsonResponse.canvasmap)){console.log("CanvasPanelManager.processCanvasMap did not find a canvasmap in JSONResults");}
this._processCanvasMapMutex=true;for(var ix=0;ix<jsonResponse.canvasmap.length;ix++){var tabConfig=jsonResponse.canvasmap[ix];this.add(tabConfig,canvasHoldingPen,jsonResponse,ajaxRequest);}
if(ajaxRequest.setActivePanel){this.setActiveTab(ajaxRequest.setActivePanel);}
this._processCanvasMapMutex=false;var activeTab=this.getActiveTab();if(activeTab){activeTab.selectExplorerNode();}},clearContentValid:function(){this.activateTab.config.contentValid=false;},clearCanvas:function(){this.clearCanvasHook();if(!this.items)return;this.activeTab=null;while(MktPage.canvasCleanupStack.length>0){var cfn=MktPage.canvasCleanupStack.shift();cfn();}
this.items.each(function(item){this.stack.remove(item);},this);this.items.each(function(item){if(item.cleanup)item.cleanup();},this);this.items.each(function(item){this.remove(item);},this);this.clearCanvasHook=Ext.emptyFn;},_requestedLockedTab:null,_lockTabMsg:'Saving...',requestLockedTab:function(tabRef){if(tabRef){this._requestedLockedTab=tabRef.config.id;console.debug('MktCanvas.requestLockedTab:',this._requestedLockedTab);this.mask(null,this._lockTabsMsg);}
else{this._requestedLockedTab=null;}},lockTab:function(tabId,msg){var tab=this.getTab(tabId);if(tab){tab._lock=true;this._lockTabsMsg=msg||'Saving...';console.debug('MktCanvas.lockTab:',tabId);}
else{console.debug('MktCanvas.lockTab not found:',tabId);}},unlockTab:function(tabId){var tab=this.getTab(tabId);if(tab){tab._lock=false;console.debug('MktCanvas.unlockTab:',tabId);if(this._requestedLockedTab===tabId){console.debug('MktCanvas.unlockTab loading previously requested tab:',tabId);if(this.activeTab.config.id==this._requestedLockedTab){this.requestLockedTab(null);this.reloadActiveTab();}
else{this.setActiveTab(this._requestedLockedTab);}}}},lockTabs:function(tabIds,msg){for(var i=0;i<tabIds.length;i++){this.lockTab(tabIds[i],msg);}},unlockTabs:function(tabIds){for(var i=0;i<tabIds.length;i++){this.unlockTab(tabIds[i]);}},clearForLoad:function(msg){this.requestLockedTab(null);this.items.each(function(item){if(item.clearContentValid){item.clearContentValid();}},this);this.mask(null,msg);this.clearCanvas();this.activeTab=null;return true;},fillCanvas:function(items,tabId,isGrid){var tab;if(tabId){tab=this.getItem(this._makeTabId(tabId));}
else{tab=this.getActiveTab();}
if(!tab){console.debug("Canvas id=",tabId," was not found");return;}
if(tab.items&&tab.items.items&&tab.items.items.length>0){while(tab.items.items.length>0){tab.remove(tab.items.items[0]);}}
if(tab.body){tab.body.update('<span> </span>');}
tab.addClass('mktFullCanvas');if(isGrid){tab.setGridPanel(items);tab.addClass('mktFullCanvasGrid');}
else{tab.setGridPanel(null,false);tab.removeClass('mktFullCanvasGrid');}
if(!Ext.isArray(items)){if(!items.layout)items.layout='fit';items.height=MktCanvas.getHeight();items.width=MktCanvas.getWidth();}
tab.add(items);tab.doLayout();},fillCanvasGrid:function(items,tabId){this.fillCanvas(items,tabId,true);},extendToolbar:function(items,tabId,clearAll){var tab=this._getTbarTab(tabId);if(!tab)return;var tbar=tab.getTopToolbar();if(clearAll){tbar._extendedItemsCount=tbar.items.items.length;}
tab.initSatellite(items);this._extendTbar(tbar,items);},replaceToolbar:function(items,tabId){this.extendToolbar(items,tabId,true);},resetToolbar:function(tabId){var tab=this.getTab(tabId);if(tab.config.tbar){this.replaceToolbar(eval(tab.config.tbar),tabId);}},extendGutter:function(items,tabId,clearAll){var tab=this._getTbarTab(tabId);if(!tab)return;var gutter=tab.getGutter();if(gutter&&gutter.tbar&&clearAll){gutter.tbar._extendedItemsCount=gutter.items.items.length;}
this._extendTbar(gutter,items);},replaceGutter:function(items,tabId){this.extendGutter(items,tabId,true);},registerItem:function(key,item,tabId){var tab;if(tabId){tab=this.getItem(this._makeTabId(tabId));}
else{tab=this.getActiveTab();}
if(tab){tab.registerItem(key,item);return tab;}
else{return null;}},getRegisteredItem:function(key,tabId){var tab;if(tabId){tab=this.getItem(this._makeTabId(tabId));}
else{tab=this.getActiveTab();}
if(tab){return tab.getRegisteredItem(key);}
return null;},_getTbarTab:function(items,tabId){var tab=null;if(tabId){tab=this.getItem(this._makeTabId(tabId));}
else{tab=this.getActiveTab();}
if(!tab){console.debug("Canvas id=",tabId," was not found");}
return tab;},_extendTbar:function(tbar,items){if(!tbar){return;}
var i;for(i=0;i<tbar.items.items.length;i++){var item=tbar.items.items[i];if(item.removeOnExtend){tbar.items.remove(item);Ext.destroy(item);i--;}}
if(tbar._extendedItemsCount){for(i=tbar._extendedItemsCount;i>0;i--){var lastItem=tbar.items.last();if(lastItem.sticky){continue;}
tbar.items.remove(lastItem);Ext.destroy(lastItem);}}
tbar._extendedItemsCount=0;if(Ext.isArray(items)){for(i=0;i<items.length;i++){tbar.add(items[i]);tbar._extendedItemsCount++;}}
else{tbar.add(items);tbar._extendedItemsCount++;}
tbar.doLayout();},loadSatellite:function(tabId){var tab;if(tabId){tab=this.getItem(this._makeTabId(tabId));}
else{tab=this.getActiveTab();}
if(tab){return tab.loadSatellite();}
return null;},initEvents:function(){MktCanvasPanelManager.superclass.initEvents.call(this);this.addListener('resize',this._onResize,this);this.addListener('tabchange',function(tabPanel,tab){if(isDefined(tab.config.dlCompCode)){MktDlManager.updateHistory.call(MktDlManager,Ext.apply({panelIndex:tabPanel.items.findIndex("id",tab.id)},tab.config));}},MktDlManager,{buffer:100});this.addListener('beforetabchange',this.beforeTabChange.createDelegate(this));},_onResize:function(){if(this.activeTab){MktPage.eventMgr.fireEvent('canvasresizedone',this.activeTab,'canvasresizedone');}},_makeTabId:function(tabId){if(!tabId){return'cp_default';}else if(typeof tabId=="number"){return tabId;}
if(typeof tabId=='object'){return tabId.id;}
if(tabId.indexOf('cp_')!==0){return'cp_'+tabId;}
return tabId;},getAsyncUnmaskId:function(tabId){var asyncUnmaskId=null;var tab=this.getTab(tabId);if(tab){tab.asyncUnmaskId='async-unmask-'+Ext.id();console.debug('MktCanvas generated async unmask id:',tab.asyncUnmaskId);asyncUnmaskId=tab.asyncUnmaskId;}
return asyncUnmaskId;},mask:function(tabId,msg,cls,subtle,source){if(!this.isActiveTab(tabId)){return;}
var tab=this.getActiveTab();if(!subtle){MktViewport.showPurpleCorners(false);}
if(tab&&tab.hasGridPanel()&&source!='grid'){var grid=tab.getGridPanel();if(grid&&grid.maskGridCanvas){grid.maskGridCanvas(tab,msg,cls,subtle);}}
else{Mkt.widgets.CanvasMask.mask(this,msg,cls,subtle);}
this._isMasked=true;},unmask:function(tabId,asyncUnmaskId){if(!this.isActiveTab(tabId)||!this._isMasked){return;}
var tab=this.getTab(tabId);if(asyncUnmaskId&&tab&&tab.asyncUnmaskId!=asyncUnmaskId){console.debug('MktCanvas.unmask ignored -- received stale async unmask id:',asyncUnmaskId);return;}
MktSession.unclockCursor();this._isMasked=false;if(tab){if(tab.enablePurpleCorners){MktViewport.showPurpleCorners(true);}
else{MktViewport.showPurpleCorners(false);}}
Mkt.widgets.CanvasMask.unmask(this);},updateMaskMsg:function(tabId,msg,cls,animate,callback){if(!this.isActiveTab(tabId)||!this._isMasked){return;}
Mkt.widgets.CanvasMask.updateMaskMsg(this,msg,cls,animate,callback);},isMasked:function(){return this._isMasked;},_isMasked:false,beforeTabChange:function(tabPanel,newTab,currentTab){if(currentTab&&currentTab.beforeUnload){return currentTab.beforeUnload(newTab);}},cancelActivity:function(){MktSession.unclockCursor();var activeTab=this.getActiveTab();if(this._isMasked){var action=' &nbsp; ';var cancelMsg="Page load stopped";MktCanvas.mask(null,cancelMsg,'mktCanvasMaskActivityCanceled');}
if(activeTab){activeTab.cleanup();}},show403Forbidden:function(title,message){title=!title?"Limited Access":title;message=!message?"You do not have sufficient<br>privileges to view this page":message;MktSession.unclockCursor();var activeTab=this.getActiveTab();if(this._isMasked){var action=' &nbsp; ';var cancelMsg='<span style="font-weight: bold; padding-left: 5px">'+title+'</span><br><span style="position: relative; top: 30px; left: -15px;">'+message+'</span>';MktCanvas.mask(null,cancelMsg,'mktCanvasMaskLarge mktCanvasMask403Forbidden');}},reactivateActiveTab:function(clear){var activeTab=this.getActiveTab();if(activeTab._lock){this.requestLockedTab(activeTab.id);return;}
if(clear){activeTab.clearContentValid();}
if(activeTab){activeTab._onActivate();}},activateReactivateTab:function(tabId,clear){if(this.isActiveTab(tabId)){this.reactivateActiveTab(clear!==false);}
else{this.setActiveTab(tabId);}},isActiveTab:function(tabId){if(!tabId)return true;var activeTab=this.getActiveTab();if(activeTab)return activeTab.id==this._makeTabId(tabId);return true;},onStripMouseDown:function(e){e.preventDefault();if(e.button!==0){return;}
var t=this.findTargets(e);if(t.close){this.remove(t.item);return;}
if(t.item&&t.item!=this.activeTab){this.setActiveTab(t.item);}
else if(t.item){this.reloadActiveTab();}},log:function(msg){console.debug(msg);}});MktCanvasPanel=Ext.extend(Ext.Panel,{cls:"mktCanvasPanel",layout:'fit',autoScroll:true,enablePurpleCorners:false,hidden:true,inCancelRequest:false,_lock:false,config:{contentValid:null,contentValidOnceLoaded:null,url:null},updateTabTitle:function(title){this.config.title=title;this.setTitle(title.ellipse(this.config.titleLength));},updateTabDescription:function(description){this.config.description=description;},clearContentValid:function(){this.config.contentValid=false;},clearContentValidOnceLoaded:function(){this.config.contentValidOnceLoaded=false;},setActivateCallback:function(cb){this._activateCallback=cb;},_gridPanel:null,setGridPanel:function(grid,purple){if(!grid){return;}
this._gridPanel=grid;if(grid.canvasPanelReactivateCallback){this._reactivateCallback=grid.canvasPanelReactivateCallback.createDelegate(grid);}
this.enablePurpleCorners=true;if(isDefined(purple)){this.enablePurpleCorners=purple;}},hasGridPanel:function(){return this._gridPanel!==null;},getGridPanel:function(){if(this._gridPanel)return this._gridPanel;else if(this.items&&this.items.items){return this.items.items[0];}},registerItem:function(key,item){if(!this.registry)this.registry={};this.registry[key]=item;},getRegisteredItem:function(key){if(!this.registry){return undefined;}
return this.registry[key];},initComponent:function(){this.initSatellite(this.tbar);if(MktViewport.satellite){MktViewport.setInitialHeaderText(this.config.title.ellipse(this.config.titleLength));}
MktCanvasPanel.superclass.initComponent.call(this);this.addListener('activate',this._onActivate,this);},onRender:function(ct,position){MktCanvasPanel.superclass.onRender.call(this,ct,position);this.initGutter();},initSatellite:function(tbar){if(!MktViewport.satellite&&this.config.enableDeepLink){var panelId=this.config.id;var fill=new Ext.Toolbar.Fill();var btn=new Ext.Button({text:'',tooltip:'Open in New Window',iconCls:'mkiWindows',handler:function(){MktCanvas.loadSatellite(panelId);}});fill.removeOnExtend=true;btn.removeOnExtend=true;if(tbar.push){tbar.push(fill);tbar.push(btn);}}},_onActivate:function(){if(this._fetchSemaphore){var pass;}
else if(this.config.contentValid){this.canvasPanelMgr.mask(this.config.id);this._showContent();this._processActivateCallback();}
else if(isDefined(this.config.url)){this._fetchContent();}
else{this.log('MktCanvasPanel._onActivate hit unexpected path',this.config);}
MktPage.activePanel=this;this.cName=this.config.id;if(this.hasGridPanel()){var view=this.getGridPanel().getView();if(view instanceof MktGrids.BufferGridView){view.update();}}
this.selectExplorerNode();},selectExplorerNode:function(){if(this.canvasPanelMgr._processCanvasMapMutex){return;}
if(this.config.expNodeId){MktExplorer.selectNode(this.config.expNodeId);}
else if(this.config.expPathname){MktExplorer.selectPath(this.config.expPathname);}},getGutter:function(){return this.gutterToolbar;},initGutter:function(){if(!this.config.hideGutter&&this.tbar){this.gutterToolbar=new Ext.Toolbar({renderTo:this.tbar,cls:'mktCanvasGutter',items:this.gutter});this.syncSize();var topToolbar=this.getTopToolbar();if(topToolbar){topToolbar.on('beforedestroy',function(){if(this.gutterToolbar){this.gutterToolbar.destroy();}},this);}}},_showContent:function(){if(this.config.scriptOnly){var pass;}
else{var ce=Ext.getDom(this.config.id);if(ce){Ext.fly(ce).removeClass(['x-hidden','x-hide-display','ylayout-inactive-content']);Ext.fly(ce).setStyle('height',Ext.isIE7?'96%':'98%');try{this.body.dom.appendChild(ce);}catch(e){MktPage.showException(e,"MktCanvasPanel._showContent");}}
else{this.log('MktCanvasPanel._showContent -- error -- content container '+this.config.id+' was null');}}
if(this.config.keepMasked){this.config.originalKeepMasked=this.config.keepMasked;this.config.keepMasked=false;}
else{this.canvasPanelMgr.unmask(this.config.id);}
this.selectExplorerNode();MktPage.eventMgr.fireEvent('panelactivate',this);this._processActivateCallback();},_fetchContent:function(){try{var canvasContent=Ext.get(this.config.id);if(canvasContent){canvasContent.update('<span> </span>');}}
catch(e){console.debug('Encountered exception clearing charts from body',e);}
this._fetchSemaphore=true;delete this._cancelFetch;var opts={onMySuccess:this._fetchContentSuccess.createDelegate(this),containerId:this.config.id,canvasPanelThis:this};if(isDefined(this.config.accessZoneId)){opts.params={accessZoneId:this.config.accessZoneId};}
if(isDefined(this.config.contentParms)){Ext.apply(opts,this.config.contentParms);}
MktSession.ajaxRequest(this.config.url,opts);this.canvasPanelMgr.mask(this.config.id);if(this.config&&this.config.originalKeepMasked){this.config.keepMasked=this.config.originalKeepMasked;}},_fetchContentSuccess:function(serverJSON,request){this._fetchSemaphore=false;if(this._cancelFetch){this.log('fetch was cancelled...aborting');return;}
else if(!this.canvasPanelMgr.isActiveTab(this.config.id)){this.log('fetch for inactive tab...aborting');return;}
this.config.contentValid=true;if(!this.config.contentValidOnceLoaded){this.config.contentValid=false;}
this._showContent();},cleanup:function(){this._cancelFetch=true;this.cancelRequest();},beforeUnload:function(newTab){if(!this.config.contentValidOnceLoaded){this.cancelRequest();}},cancelRequest:function(){var reqs=this.getRegisteredItem(MktSession.cancellableRequestKey);if(reqs&&Ext.isArray(reqs)&&reqs.length>0&&this.config&&this.config.id){MktSession.cancelRequest(this.config.id,reqs);}},getInCancelRequest:function(){return this.inCancelRequest;},setInCancelRequest:function(val){this.inCancelRequest=val;},_activateCallback:null,_reactivateCallback:null,activateCount:0,_processActivateCallback:function(){if(this.activateCount===0&&this._activateCallback){this._activateCallback();}
else if(this.activateCount&&this._reactivateCallback){this._reactivateCallback();}
this.activateCount++;},loadSatellite:function(config){config=config||this.config;config.title=config.title||'';var satelliteQuery="?satellite=1";var deepLinkURL=satelliteQuery+"#"+MktDlManager.convertDlPath(config);this._satellite=window.open(deepLinkURL);try{this._satellite.document.title='Loading...';}catch(e){}
return this._satellite;},debugSize:function(){this.log('MktCanvasPanel.debugSize');this.log('viewport height',MktViewport.height);this.log('viewport center height',MktViewport.center.height);this.log('viewport center el height',MktViewport.center.el.getHeight());this.log('viewport center body height',MktViewport.center.body.getHeight());this.log('manager height',this.canvasPanelMgr.height);this.log('manager el height',this.canvasPanelMgr.el.getHeight());this.log('manager body height',this.canvasPanelMgr.body.getHeight());this.log('panel height',this.height);this.log('panel el height',this.el.getHeight());this.log('panel body height',this.body.getHeight());this.log();},log:function(msg){this.canvasPanelMgr.log(msg);}});
/* ========== ../mkt-ext-2.0/viewport/BaseViewport.js ============ */

Ext.namespace('Mkt','Mkt.viewport');Mkt.viewport.BaseViewport=function(config){Ext.apply(this,config);};Mkt.viewport.BaseViewport.prototype={userName:'',showCustAdmin:false,viewportCls:'base-viewport',showCloseButton:false,centerPanelHeaderText:'Marketo',viewport:null,toolbar:null,init:function(userName){this.maskElement=Ext.getBody();this.mask();this.userName=userName;MktViewport.viewport=new Ext.Viewport({layout:'border',cls:this.viewportCls,defaults:{collapsible:false,collapsed:false,autoScroll:false,titlebar:false,split:true,border:false},items:[{id:'north-main',baseCls:'north-main x-panel',region:'north',height:0,split:false,layout:'fit',bbar:this._buildViewportToolbar()},{id:'center-main',baseCls:'center-main x-panel',margins:'-8 2 2 2',region:'center',layout:'fit',frame:true,border:false,split:false,items:{layout:'border',id:'center-container',bodyBorder:false,border:false,frame:false,split:true,items:this._buildCenterContainer()}},{id:'south-main',baseCls:'south-main copyright',region:'south',border:false,split:false,html:!MktPage.satellite?'<div class="copyright">Copyright &copy; 2011 Marketo, Inc.  All rights reserved.</div>':''}]});var regions=this.viewport.items.items;this.north=regions[0];this.centerRegion=regions[1];this.toolbar=this.north.getBottomToolbar();return this;},enableMask:false,maskElement:null,maskMessage:'Loading...',maskCls:'mktViewportMask',maskBlackCls:'mktViewportMaskBlack',maskIconCls:'mktViewportMaskActivity',mask:function(msg,iconCls){var el=this.maskElement||this.el;if(this.enableMask&&this.maskElement){this.maskElement.addClass(this.maskCls);this.maskElement.mask(msg||this.maskMessage,iconCls||this.maskIconCls);}},unmask:function(){var el=this.maskElement||this.el;if(this.enableMask&&this.maskElement){this.maskElement.removeClass(this.maskCls);this.maskElement.unmask();}},blackMask:function(){var el=this.maskElement||this.el;if(this.enableMask&&this.maskElement){this.maskElement.addClass(this.maskBlackCls);this.maskElement.mask();}},unBlackMask:function(){var el=this.maskElement||this.el;if(this.enableMask&&this.maskElement){this.maskElement.removeClass(this.maskBlackCls);this.maskElement.unmask();}},_buildCenterContainer:function(){this.enableMask=true;return this.canvasFrame=new Ext.Panel({bodyBorder:false,html:'',listeners:{'render':function(){MktViewport.afterCenterRender();}}});},afterCenterRender:function(){MktViewport.renderCustomCorners(MktViewport.canvasFrame);MktViewport.unmask();},renderCustomCorners:function(panel){panel.bwrap.createChild({id:'mktCanvasCornerTopRight'});panel.bwrap.createChild({id:'mktCanvasCornerTopLeft'});MktViewport._createPurpleCorners(panel);},showPurpleCorners:function(show){var purps=MktViewport._purpleCornerElements;for(var p=0;p<purps.length;p++){var purp=Ext.get(purps[p]);if(purp){purp.setVisible(show);}
else{console.debug('purp not found',purps[p]);}}},maskPurpleCorners:function(mask){var purps=MktViewport._purpleCornerElements;for(var p=0;p<purps.length;p++){var purp=Ext.get(purps[p]);if(purp){if(mask){purp.addClass('mktCanvasCornerMaskedSubtle');}
else{purp.removeClass('mktCanvasCornerMaskedSubtle');}}
else{console.debug('purp not found',purps[p]);}}},_purpleCornerElements:['mktCanvasCornerBottomLeft','mktCanvasCornerBottomRight','mktCanvasCornerBottomCenter'],_createPurpleCorners:function(panel){var purps=MktViewport._purpleCornerElements;for(var p=0;p<purps.length;p++){panel.bwrap.createChild({id:purps[p],style:'visibility:hidden'});}},signOut:function(){MktSession.ajaxRequest('/user/logout');},updateHeaderText:function(txt){if(txt){this.centerPanelHeaderText=txt;if(this.centerPanelHeader){this.centerPanelHeader.body.update(txt);}}},setInitialHeaderText:function(txt){if(txt&&!this.centerPanelHeaderText){this.centerPanelHeaderText=txt;if(this.centerPanelHeader){this.centerPanelHeader.body.update(txt);}}},_buildCenterPanelHeader:function(){var cls='center-panel-header';return this.centerPanelHeader=new Ext.Panel({id:'center-panel-header',cls:cls,region:'north',height:50,html:this.centerPanelHeaderText});},_buildFauxExplorer:function(){if(!this.explorer){this.explorer={selectNode:Ext.emptyFn,selectPath:Ext.emptyFn,clear:Ext.emptyFn,mask:Ext.emptyFn,onTree:Ext.emptyFn,onTreeEditor:Ext.emptyFn,processJSONResults:Ext.emptyFn,selectNodeById:Ext.emptyFn,replaceNodes:Ext.emptyFn,addNode:Ext.emptyFn,addNodes:Ext.emptyFn,removeNodes:Ext.emptyFn,getNodeById:Ext.emptyFn,updateNodeIconCls:Ext.emptyFn,updateNodeAttr:Ext.emptyFn,fauxExplorer:true};}},_buildViewportToolbar:function(){this.tbar=[];this.tbar.push({xtype:'tbfill'});this._buildCustomToolbar();this._buildLoginToolbar();this._buildAdminToolbar();this._buildCommunityToolbar();this._buildCloseToolbar();this.tbar.push('-');this._buildHelpToolbar();this.tbar.push(' ');return this.tbar;},_buildCustomToolbar:function(){},_buildCloseToolbar:function(){if(this.showCloseButton){if(this.tbar.length>3){this.tbar.push('-');}
this.tbar.push({text:'Close',iconCls:'mkiCancel',handler:function(){MktPage.promptCounter=0;window.close();}});}},_buildHelpToolbar:function(){this.tbar.push({text:'Help',xtype:'tbsplit',menuAlign:'tr-br',iconCls:'mkiHelp',handler:this.showGuide.createDelegate(this),menu:{cls:'mktMenu',items:this.buildHelpMenuItems()}});},_buildCommunityToolbar:function(){this.tbar.push('-');this.tbar.push({text:'Community Home',iconCls:'mkiQuestionAndAnswer',url:'/guide/displaySuccessContent?contentTag=main_MarketoCommunityHome',handler:this.popupHelp});},_buildAdminToolbar:function(){if(this.showCustAdmin){this.tbar.push('-');this.tbar.push({text:'Admin',iconCls:'mkiGear',handler:function(e){MktCanvas.clearForLoad();MktMainNav.loadCustAdmin({nodeId:'300'});}});}},_buildLoginToolbar:function(){this.tbar.push({id:'logged-in-as',text:'Logged in as: '+this.userName,handler:function(e){MktCanvas.clearForLoad();MktMainNav.loadCustAdmin({compSubtype:'myAccount',setActivePanel:'cadMyAccountCanvas',nodeId:301});}});this.tbar.push('-');this.tbar.push({xtype:'button',text:'Logout',handler:function(){this.signOut();}.createDelegate(this)});},buildHelpMenuItems:function(){var items=[{text:'Get help on this section',iconCls:'mkiHelp',handler:this.showGuide.createDelegate(this)},'-',{text:'Community Home',iconCls:'mkiQuestionAndAnswer',url:'/guide/displaySuccessContent?contentTag=main_MarketoCommunityHome',handler:this.popupHelp},{text:'Support Cases',iconCls:'mkiLifebelt',url:'/guide/displaySuccessContent?contentTag=helpMenu_contactSupport',handler:this.popupHelp},'-',{text:(MktPage.isSpark())?'About Spark':'About Marketo',iconCls:(MktPage.isSpark())?'mkiSpark16':'mkiMarketo16',url:(MktPage.isSpark())?'http://www.spark.marketo.com/marketing-automation/about/':'http://www.marketo.com/about',handler:this.popupWindow}];if(MktPage.getDevMode()){items.push('-');items.push({text:'Debug Controls',iconCls:'buttonIcon mkiBugYellowInformation',handler:MktPage.showDebugControls});items.push({text:'Toggle Dev Mode',iconCls:'buttonIcon mkiBugYellowRun',handler:function(){MktPage.toggleDevMode();}});items.push({text:'Simulate PHP Exception',iconCls:'buttonIcon mkiBugYellow',handler:function(){MktSession.ajaxRequest('/homepage/simulatePHPException');}});items.push({text:'Simulate PHP Fatal Error',iconCls:'buttonIcon mkiBugRed',handler:function(){MktSession.ajaxRequest('/homepage/simulatePHPFatalError');}});}
if(MktPage.getDevMode()||MktPage.isMarketo()){items.push({text:'Clear Tree Cache',iconCls:'buttonIcon mkiBrush',handler:function(){MktSession.ajaxRequest('/homepage/clearExplorerTreeCaches');}});items.push({text:'Fixup MA Access Zones',iconCls:'buttonIcon mkiEnvironment',handler:function(){MktSession.ajaxRequest('/homepage/fixupAccessZone');}});}
return items;},popupWindow:function(item){window.open(item.url);},popupHelp:function(item){window.open(encodeURI(item.url));},showGuide:function(){var panelId=MktViewport.getGuidePanelId();if(!panelId)return;MktSession.clockCursor(true);var guideEl=Ext.DomQuery.selectNode('button.mkiHelp');if(guideEl){this.guideAnimEl=guideEl;}
else{this.guideAnimEl=null;}
panelId=this.getGuidePanelId();MktSession.ajaxRequest('guide/getPanel',{serializeParms:{panelId:panelId},onMySuccess:this._showGuideWindow.createDelegate(this)});},getGuidePanelId:function(){return null;},getGuideTitle:function(){return'Untitled';},_showGuideWindow:function(){MktSession.clockCursor(false);var config={title:"Help - "+MktViewport.getGuideTitle(),width:500,height:300,icon:'mki48Information2',msgTmpl:'<div class="mktMessageLayout mktMessageLayoutHelp {0}"><p>{1}</p></div>',buttons:[],animateTarget:MktViewport.guideAnimEl||MktViewport.el,modal:false};config.msg=MktPage.appVars.panelText||'';if(MktViewport.mayEditHelp()){if(!MktPage.appVars.panelTextExists){config.msg+=': '+MktViewport.getGuidePanelId()+'<p>'+MktMessage.loremipsum+'</p>';}
config.buttons.push({text:'View All Help',iconCls:'mkiHelp',handler:function(){window.open('/guide/all');}});config.buttons.push({text:'Edit '+MktViewport.getGuidePanelId(),iconCls:'mkiPencil',handler:MktMessage.okClicked});config.okCallback=MktViewport.editGuide;}
config.buttons.push({text:'Close',iconCls:'mkiCancel',handler:MktMessage.cancelClicked});MktMessage.show(config);},editGuide:function(){var panelId=MktViewport.getGuidePanelId();if(!panelId)return;MktPage.appVars.guidePanelId=panelId;MktSession.ajaxRequest('guide/getPanel',{serializeParms:{panelId:panelId},onMySuccess:MktViewport._showGuideEditWindow.createDelegate(MktViewport)});},_showGuideEditWindow:function(){var text=MktPage.appVars.panelText||'';Ext.Msg.show({title:"Edit Help - "+this.getGuideTitle(),width:500,msg:'Edit the text below using standard HTML:',value:text,buttons:Ext.Msg.OKCANCEL,prompt:true,multiline:400,fn:this._saveButtonClicked.createDelegate(this),animEl:this.guideAnimEl||this.el,modal:false});},_saveButtonClicked:function(button,text){if(button!='ok'){return;}
var panelId=MktPage.appVars.guidePanelId;var sessionObj=MktSession;if(window.opener&&window.opener.MktSession){sessionObj=window.opener.MktSession;}
sessionObj.ajaxRequest('guide/savePageSubmit',{params:{gidEditingId:panelId,gidHelpText:text},onMySuccess:this.showGuide.createDelegate(this)});},mayEditHelp:function(){try{if(window.opener&&window.opener.MktViewport){return window.opener.MktViewport.mayEditHelp();}}
catch(e){}
return MktPage.isDev()&&MktPage.isMarketo();},ender:null};
/* ========== ../mkt-ext-2.0/viewport/AppViewport.js ============ */

Mkt.viewport.AppViewport=Ext.extend(Mkt.viewport.BaseViewport,{explorer:null,canvas:null,enableMask:true,viewportCls:'app-viewport',getWestWidth:function(){if(!this.west){this.west=this.westRegion.items.items[1];}
return this.west.width;},init:function(){var viewport=Mkt.viewport.AppViewport.superclass.init.apply(this,arguments);this.north=this.centerRegion.items.items[0];this.center=this.centerRegion.items.items[1];this.northwest=this.westRegion.items.items[0].items.items[0];this.west=this.westRegion.items.items[0].items.items[1];return viewport;},toggleFullScreen:function(){this.westRegion.toggleCollapse();this.topTabs.toggleCollapse();},_buildCenterContainer:function(){return[this._buildWestRegion(),{id:'center-panel',cls:'mktCanvasWrap',region:'center',layout:'fit',frame:false,items:this._buildCenterRegion()}];},_buildWestRegion:function(config){return this.westRegion=new Ext.Panel({id:'west-panel',region:'west',margins:'0 0 0 5px',collapsible:false,collapsed:false,collapseDirection:'top',floatable:true,frame:false,width:225,split:true,maxSize:400,layout:'fit',height:'100%',items:this._buildWestContent()});},_buildWestContent:function(config){return this.westContent=new Ext.Panel({layout:'border',items:[{region:'north',id:'logo-container',height:70,contentEl:'mktTopNavLogo'},this._buildExplorer({el:'explorer',region:'center',width:220,minWidth:220,layout:'fit',frame:false,autoScroll:false,items:new Ext.Panel({id:'mktExplorerTreeBox',el:'explorer-body',cls:'mktTreeBox',frame:true,layout:'fit',autoScroll:false})})]});},_buildExplorer:function(config){return this.explorer=new Mkt.main.ExplorerPanel(config);},_buildCenterRegion:function(config){this.topTabs=new Ext.Panel({id:'top-tabs',region:'north',height:32,contentEl:'mktTopTabWrap',collapsible:false,collapsed:false,collapseDirection:'top',floatable:false});return this.centerRegion=new Ext.Panel({layout:'border',items:[this.topTabs,{id:'canvas-frame',baseCls:'canvas-frame x-panel',region:'center',margins:'0 6px 0 0',layout:'fit',frame:true,items:this._buildCanvas({id:'canvas',border:false}),listeners:{'render':function(panel){MktViewport.renderCustomCorners(panel);MktViewport.unmask();}}}]});},_buildCanvas:function(config){return this.canvas=new MktCanvasPanelManager(config);},getGuidePanelId:function(){if(!this.canvas||!this.canvas.activeTab){return null;}
config=this.canvas.activeTab.config;return config.guideId||config.id;},getGuideTitle:function(){if(!this.canvas||!this.canvas.activeTab){return'Marketo';}
return this.canvas.activeTab.config.title;},ender:null});MktViewport=new Mkt.viewport.AppViewport();
/* ========== ../mkt-ext-2.0/viewport/CenterPanelViewport.js ============ */

Mkt.viewport.CenterPanelViewport=Ext.extend(Mkt.viewport.BaseViewport,{enableMask:true,viewportCls:'center-panel-viewport',init:function(centerPanelHeaderText,centerPanelItems,eastPanelItems){this.centerPanelHeaderText=centerPanelHeaderText;this.centerPanelItems=centerPanelItems;this.eastPanelItems=eastPanelItems;var viewport=Mkt.viewport.CenterPanelViewport.superclass.init.apply(this,arguments);this.canvas=this.centerPanelItems;return viewport;},centerFrameBaseCls:'canvas-frame canvas-frame-grey-round x-panel',_buildCenterContainer:function(){return this.centerRegion=new Ext.Panel({id:'center-panel',cls:'mktCanvasWrap',region:'center',layout:'fit',frame:false,items:{layout:'border',items:[this._buildCenterPanelHeader(),this._buildCenterFrame(),this._buildEastPanel()]}});},_buildCenterFrame:function(){return this.canvasFrame=new Ext.Panel({id:'canvas-frame',baseCls:this.centerFrameBaseCls,region:'center',margins:'10px 6px 1px 10px',layout:'fit',frame:true,items:this.centerPanelItems});},eastPanelWidth:230,_buildEastPanel:function(){if(this.eastPanelItems===undefined){return{region:'east',visible:false};}
return{region:'east',cls:'mktEastPanel',layout:'fit',frame:false,autoScroll:false,width:this.eastPanelWidth,margins:'47px 10px 2px 0px',items:this.eastPanelItems}},_buildLoginToolbar:Ext.emptyFn,ender:null});
/* ========== ../mkt-ext-2.0/viewport/AppSatelliteViewport.js ============ */

Mkt.viewport.AppSatelliteViewport=Ext.extend(Mkt.viewport.AppViewport,{satellite:true,showCloseButton:true,showCustAdmin:false,showSaveAsButton:false,viewportCls:'app-viewport center-panel-viewport',init:function(centerPanelHeaderText){this.centerPanelHeaderText=centerPanelHeaderText;var viewport=Mkt.viewport.AppViewport.superclass.init.apply(this,arguments);this.north=this.northwest=this.west=null;this.center=this.centerRegion.items.items[0];this._buildFauxExplorer();return viewport;},_buildCenterContainer:function(){return[{id:'center-panel',cls:'mktCanvasWrap',region:'center',layout:'fit',frame:false,items:this._buildCenterRegion()}];},_buildCenterRegion:function(config){return this.centerRegion=new Ext.Panel({layout:'border',items:[(MktPage.savedState.subscriptionType=='Marketo Spark Customer')?this._buildCenterPanelHeader(true):this._buildCenterPanelHeader(),{id:'canvas-frame',baseCls:'canvas-frame canvas-frame-grey-round x-panel',region:'center',margins:'10px 6px -4px 10px',layout:'fit',frame:true,items:this._buildCanvas({id:'canvas',border:false}),listeners:{'render':function(panel){MktViewport.renderCustomCorners(panel);MktViewport.unmask();}}}]});},_buildCustomToolbar:function(){this.saveAsButton=new Ext.Button({hidden:true,text:'Save As...',iconCls:'mkiFloppyDisk',handler:function(){this.saveAsHandler.apply(this,arguments);}.createDelegate(this)});this.tbar.push(this.saveAsButton);},saveAsHandler:Ext.emptyFn,showSaveAsButton:function(show){if(this.saveAsButton){this.saveAsButton.setVisible(show);}},_buildLoginToolbar:Ext.emptyFn,ender:null});
/* ========== ../mkt-ext-2.0/widgets/message.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.message={msgTmpl:'<div class="mktMessageLayout {0}"><p>{1}</p></div>',show:function(config){console.debug('MktMessage.show',config);this._cleanupMessageWindow();if(!config.icon){config.icon='mki48Information2';}
if(config.msg&&!config.html){config.html=String.format(config.msgTmpl||this.msgTmpl,config.icon,config.msg);}
if(config.showSessionInfo){config.html+=this.buildSessionInfo();}
if(config.showDateInfo){var headerTmpl='<div style="float: right; padding-right: 10px; margin-left: 40px">{1}</div><div>{0}</div>';var dt=new Date();var date=dt.format('D M j, Y  h:i:s A O (T)');if(!config.title)config.title='Marketo';config.title=String.format(headerTmpl,config.title,date);}
var defaults={title:'Marketo',iconCls:'mkiAbout',frame:true,modal:true,resizable:true,icon:'mki48About',width:450,height:250,minWidth:440,minHeight:220,cls:'mktModalForm',closeAction:'hide',animateTarget:null,autoScroll:true,okCallback:Ext.emptyFn,cancelCallback:Ext.emptyFn};this._messageWindow=new Ext.Window(Ext.apply(defaults,config));this._messageWindow.show();return this._messageWindow;},buildSessionInfo:function(){if(!MktPage.savedState){return'';}
var browser='';if(Ext.isGecko3){browser="Gecko3";}
else if(Ext.isGecko){browser="Gecko";}
else if(Ext.isIE6){browser="IE6";}
else if(Ext.isIE7){browser="IE7";}
else if(Ext.isIE8){browser="IE8";}
else if(Ext.isIE){browser="IE";}
else if(Ext.isSafari3){browser="Webkit3";}
else if(Ext.isSafari){browser="Webkit";}
if(Ext.isWindows){browser+=' Win';}
else if(Ext.isMac){browser+=' Mac';}
var sessionInfoTmpl='<div style="position: absolute; bottom: 7px;">Session ID: {0} on {1}<br>{2} using {3}</div>';var sessionId=MktPage.savedState.sfSessionId;while(sessionId.length<5){sessionId='0'+sessionId;}
var sessionInfo=String.format(sessionInfoTmpl,sessionId,MktPage.savedState.clusterHostname,MktPage.userid,browser);return sessionInfo;},hide:function(){MktMessage._cleanupMessageWindow();},okClicked:function(){var win=MktMessage._messageWindow;if(win.okCallback)win.okCallback.call(win);win.hide();},cancelClicked:function(){var win=MktMessage._messageWindow;if(win.cancelCallback)win.cancelCallback.call(win);win.hide();},_cleanupMessageWindow:function(){try{if(this._messageWindow){this._messageWindow.hide();this._messageWindow.destroy();}}catch(e){}},comingSoon:function()
{this.showInfo("Coming soon!");},showEmailSent:function(msg,okCallback,animateTarget)
{this.show({title:'Email Sent',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48Mail2Ok',iconCls:'mkiMail2Ok',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showInfo:function(msg,okCallback,animateTarget)
{this.show({msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48Information2',iconCls:'mkiInformation2',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showUnapproveConfirmation:function(msg,okCallback,title,animateTarget)
{this.show({title:title||'Unapprove?',msg:msg,buttons:[{text:'Unapprove',iconCls:'mkiOk',handler:this.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelClicked}],icon:'mki48Information2',iconCls:'mkiInformation2',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showNotFound:function(msg,okCallback,animateTarget)
{this.show({title:'Not Found',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48Information2',iconCls:'mkiInformation2',showDateInfo:true,showSessionInfo:true,okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showDraftNotFound:function(msg,okCallback,animateTarget)
{this.show({title:'Draft Not Found',msg:msg,buttons:[{text:'Close Editor',iconCls:'mkiOk',handler:function(){window.close();}}],icon:'mki48SignForbidden',iconCls:'mkiSignForbidden',showDateInfo:true,showSessionInfo:true,okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showWarning:function(msg,okCallback,animateTarget)
{this.show({title:'Not Allowed',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48SignForbidden',iconCls:'mkiSignForbidden',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showNotAllowed:function(msg,okCallback,animateTarget)
{this.show({title:'Not Allowed',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48SignForbidden',iconCls:'mkiSignForbidden',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showContinue:function(msg,okCallback,title,continueBtn,icon,animateTarget)
{this.showContinueConfirmation(msg,okCallback,title,continueBtn,'mki48Information2','mkiInformation2',animateTarget);},showContinueWarning:function(msg,okCallback,title,continueBtn,animateTarget){this.showContinueConfirmation(msg,okCallback,title,continueBtn,'mki48SignWarning','mkiSignWarning',animateTarget);},showContinueConfirmation:function(msg,okCallback,title,continueBtn,icon,iconCls,animateTarget)
{this.show({title:title||'Continue?',msg:msg,height:275,buttons:[{text:continueBtn||'Continue',iconCls:'mkiOk',handler:this.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelClicked}],icon:icon||'mki48Information2',iconCls:iconCls||'mkiInformation2',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showStrongConfirm:function(config,callback,callbackCancel,animateTarget)
{var message="<div class='mktStrongConfirmLayout'><div class='mktStrongConfirmWatermark {0}'></div><div>{1}</div></div>";message=String.format(message,config.bgCls,config.msg);var defaults={title:config.title,buttons:[{text:config.okBtnTxt,iconCls:config.iconCls,handler:this.okClicked,disabled:true},{text:config.cancelBtnTxt,iconCls:'mkiCancel',handler:this.cancelClicked}],frame:true,modal:true,html:message,resizable:true,iconCls:config.iconCls,width:580,height:320,minWidth:440,minHeight:220,cls:'mktModalForm',closable:false,autoScroll:true,okCallback:callback||Ext.emptyFn,animateTarget:animateTarget,cancelCallback:callbackCancel||Ext.emptyFn};this._cleanupMessageWindow();this._messageWindow=new Ext.Window(defaults);this._messageWindow.show();if(config.showTextCount){new Ext.form.TextField({renderTo:'mktLeadCountWrap',width:75,id:"mktLeadCount",enableKeyEvents:true,listeners:{keyup:this.strongConfirmValidate.createDelegate(this,[config.count])}});}
if(config.showCheckbox){new Ext.form.Checkbox({renderTo:"mktAgreeCbWrap",id:"mktAgreeCb",boxLabel:config.cboxLabel,listeners:{check:this.strongConfirmValidate.createDelegate(this,[config.count])}});}
this.strongConfirmValidate(config.count);},strongConfirmValidate:function(count){var agreeCb=Ext.get("mktAgreeCb");var countEntry=Ext.get("mktLeadCount");if((!agreeCb||agreeCb.dom.checked)&&(!countEntry||countEntry.getValue()==count)){this._messageWindow.buttons[0].enable();}
else{this._messageWindow.buttons[0].disable();}},show403Forbidden:function(msg,okCallback,animateTarget)
{if(!msg){msg='You do not have sufficient privileges to perform this action';}
this.show({title:'Limited Access',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48KeyWarning',iconCls:'mkiKeyWarning',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showWarningExt:function(title,msg,okCallback,animateTarget)
{this.show({title:title,msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48SignForbidden',iconCls:'mkiSignForbidden',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showError:function(msg,okCallback,animateTarget)
{this.show({msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],showDateInfo:true,showSessionInfo:true,icon:'mki48Error',iconCls:'mkiError',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showCrit:function(msg,okCallback,animateTarget)
{this.show({title:'Marketo System Error',msg:msg,showDateInfo:true,showSessionInfo:true,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:'mki48BandAid',iconCls:'mkiBandAid',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget});},showHelp:function(title,msg,icon,animateTarget,iconCls)
{this.show({title:title||'Help',msg:msg,buttons:[{text:'OK',iconCls:'mkiOk',handler:this.okClicked}],icon:icon||'mki48Information2',iconCls:iconCls||'mkiInformation2',msgTmpl:'<div class="mktMessageLayout mktMessageLayoutHelp {0}">{1}</div>',autoHeight:true,okCallback:function(){this.hide();},animateTarget:animateTarget});},showQuestion:function(msg,okText,okCallback,okIconCls,cancelText,cancelCallback,cancelIconCls,animateTarget){var config={msg:msg,buttons:[{text:okText||"OK",iconCls:okIconCls||'mkiOk',handler:this.okClicked},{text:cancelText||'Cancel',iconCls:cancelIconCls||'mkiCancel',handler:this.cancelClicked}],icon:'mki48Help2',iconCls:'mkiHelp2',okCallback:okCallback||Ext.emptyFn,cancelCallback:cancelCallback||Ext.emptyFn,animateTarget:animateTarget};this.show(config);},confirm:function(title,msg,okText,okCallback,okIconCls,animateTarget){var config={title:title,msg:msg,buttons:[{text:okText||"OK",iconCls:okIconCls||'mkiOk',handler:this.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelClicked}],icon:'mki48About',iconCls:'mkiAbout',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget};this.show(config);},confirmDelete:function(title,msg,okCallback,animateTarget,okText){if(!isDefined(okText)){okText='Delete';}
var config={title:title,msg:msg,buttons:[{text:okText,iconCls:'mkiOk',handler:this.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelClicked}],icon:'mki48About',iconCls:'mkiAbout',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget};this.show(config);},confirmStop:function(title,msg,okCallback,okIconCls,animateTarget,okText,cancelText){if(!isDefined(okText)){okText='Delete';}
if(!isDefined(cancelText)){cancelText='Cancel';}
var config={title:title,msg:msg,buttons:[{text:okText,iconCls:okIconCls||'mkiOk',handler:this.okClicked},{text:cancelText,iconCls:'mkiCancel',handler:this.cancelClicked}],icon:'mki48About',iconCls:'mkiAbout',okCallback:okCallback||Ext.emptyFn,animateTarget:animateTarget};this.show(config);},showExport:function(msg,progressText,timeout,icon)
{if(msg==undefined)msg="Exporting your data, please wait...";if(progressText==undefined)progressText="Exporting...";if(timeout==undefined)timeout=2000;if(icon==undefined)icon='ext-mb-download';MktPage.preventNavAway(false);Ext.Msg.show({title:'Exporting Data',msg:msg,progressText:progressText,width:300,wait:true,waitConfig:{interval:200},icon:icon,iconCls:'mkiAbout',animEl:'mb7'});setTimeout(function(){MktPage.preventNavAway(true);Ext.MessageBox.hide();},timeout);},SYSTEM_ERROR_NOT_STARTED:'<p>Please help improve by reporting this error.</p>',SYSTEM_ERROR_REFRESH:'<p>The details of this error have automatically been sent to Marketo.</p><p>Please refresh your browser.</p>',SYSTEM_ERROR_GRID:'Error Loading Report',SYSTEM_ERROR_REPORT:'Error Loading Report',SYSTEM_ERROR_TIMEOUT:'<p>Report Timed Out</p><p>This report took too long to run and was cancelled.</p>',SYSTEM_ERROR_COMMUNICATION_FAILURE:'<p>Please check your network connection.</p><p>This can also be caused by the ESC key.</p>',SYSTEM_ERROR_BROWSER_ESC:'<p>The ESC key stops the page from loading.</p><p>Your action may not have been completed.</p>',SYSTEM_ERROR_SMARTLIST:'<p>The Smart List did not run successfully.</p><p>Please check your Smart List settings.</p>',SYSTEM_ERROR_TREE:'<p>The tree did not load correctly.</p><p>Please refresh your browser.</p>',showSystemError:function(msg,context){console.debug('MktMessage.showSystemError',msg,context);var title='System Error';var intro='An Error has Occurred';var width=minWidth=500;var height=minHeight=260;var iconCls='mki48BandAid';var headerIconCls='mkiBandAid';var showOkbutton=false;var showRefreshButton=true;if(msg==MktMessage.SYSTEM_ERROR_GRID||msg==MktMessage.SYSTEM_ERROR_REPORT){title=msg;intro="This report could not be loaded.";msg='<p>The details of this error have automatically been sent to Marketo.</p>';showRefreshButton=false;showOkbutton=true;}
else if(msg==MktMessage.SYSTEM_ERROR_TIMEOUT){if(!MktPage.showCommunicationFailureMessage){return;}
title='Timeout';intro="Page timed out";iconCls='mki48Hourglass';headerIconCls='mkiHourglass';showRefreshButton=true;showOkbutton=true;}
else if(msg==MktMessage.SYSTEM_ERROR_COMMUNICATION_FAILURE){if(!MktPage.showCommunicationFailureMessage){return;}
title="Communication Failure";intro="Unable to reach Marketo";iconCls='mki48SignStop';headerIconCls='mkiSignStop';showRefreshButton=false;showOkbutton=true;}
else if(msg==MktMessage.SYSTEM_ERROR_BROWSER_ESC){title="Page load stopped";intro="Page load stopped";iconCls='mki48SignStop';headerIconCls='mkiSignStop';showRefreshButton=false;showOkbutton=true;}
else if(msg==MktMessage.SYSTEM_ERROR_SMARTLIST){title='Smart List Error';iconCls='mki48Lightbulb';headerIconCls='mkiLightbulb';showRefreshButton=false;showOkbutton=true;}
else if(msg==MktMessage.SYSTEM_ERROR_TREE){title='Tree Error';intro='Error loading tree';iconCls='mki48BandAid';headerIconCls='mkiBandAid';showRefreshButton=true;showOkbutton=true;}
var tmpl='<div class="mktMessageLayout {0}"><h2>{1}</h2>{2}</div>';var html=String.format(tmpl,iconCls,intro,msg);if(context&&context.showDebugInfo){html+='<hr size="1"><div class="mktMessageLayoutDetails">';if(context.sfException){html+='Symfony Exception: '+context.sfException+'<br><br>';}
if(context.reqParams){html+='URL: '+context.reqParams.url+'<br><br>';var canvasConfig='';if(context.reqParams.canvasPanelThis){canvasConfig='<hr size="1">Canvas Panel Config: '+Ext.util.JSON.encode(context.reqParams.canvasPanelThis.config)+'<br><br>';delete context.reqParams.canvasPanelThis;}
delete context.reqParams.serializeParams;html+='Request Parameters: '+Ext.util.JSON.encode(context.reqParams)+'<br><br>';html+=canvasConfig;}
html+='<hr size="1">';if(context.request){html+='HTTP Response Status: '+context.request.status+' ('+context.request.statusText+')<br><br>';}
if(context.parseResults){html+='Error Type: '+context.parseResults.errorType+'<br><br>';}
var responseText=''+context.cleanResponseText;html+=responseText;html+='</div>';width=900;height=600;showOkbutton=true;showRefreshButton=true;}
var buttons=[];if(showOkbutton){buttons.push({text:'OK',iconCls:'mkiOk',handler:function(){MktMessage._cleanupMessageWindow();}});}
if(showRefreshButton){buttons.push({text:'Refresh Browser',iconCls:'mkiRefresh',handler:function(){MktPage.preventNavAway(false);window.location.reload();}});}
this._cleanupMessageWindow();MktMessage._messageWindow=this.show({title:title,iconCls:headerIconCls,showDateInfo:true,showSessionInfo:true,frame:true,modal:true,width:width,height:height,minWidth:minWidth,minHeight:minHeight,closeAction:'goaway',autoScroll:true,html:html,buttons:buttons,goaway:function(){MktMessage._cleanupMessageWindow();}});MktMessage._messageWindow.show();},loremipsum:'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Sed metus nibh, sodales a, porta at, vulputate eget, dui. Pellentesque ut nisl. Maecenas tortor turpis, interdum non, sodales non, iaculis ac, lacus. Vestibulum auctor, tortor quis iaculis malesuada, libero lectus bibendum purus, sit amet tincidunt quam turpis vel lacus. In pellentesque nisl non sem. Suspendisse nunc sem, pretium eget, cursus a, fringilla vel, urna.'};MktMessage=Mkt.widgets.message;
/* ========== ../mkt-ext-2.0/widgets/RowEditor.js ============ */

Ext.ns('Ext.ux.grid');Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:'hbox',cls:'x-small-editor',buttonAlign:'center',baseCls:'x-row-editor',elements:'header,footer,body',frameWidth:5,buttonPad:3,clicksToEdit:'auto',monitorValid:true,focusDelay:250,errorSummary:true,saveText:'Save',cancelText:'Cancel',commitChangesText:'Please save or cancel your changes',errorText:'Errors',defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents('beforeedit','canceledit','validateedit','afteredit');},init:function(grid){this.grid=grid;this.ownerCt=grid;if(this.clicksToEdit===2){grid.on('rowdblclick',this.onRowDblClick,this);}else{grid.on('rowclick',this.onRowClick,this);if(Ext.isIE){grid.on('rowdblclick',this.onRowDblClick,this);}}
grid.getStore().on('remove',function(){this.stopEditing(false);},this);grid.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});grid.getColumnModel().on('hiddenchange',this.verifyLayout,this,{delay:1});grid.getView().on('refresh',this.stopEditing.createDelegate(this,[]));},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un('remove',this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip);},refreshFields:function(){this.initFields();this.verifyLayout();},isDirty:function(){var dirty;this.items.each(function(f){if(String(this.values[f.id])!==String(f.getValue())){dirty=true;return false;}},this);return dirty;},startEditing:function(rowIndex,doFocus){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return;}
if(Ext.isObject(rowIndex)){rowIndex=this.grid.getStore().indexOf(rowIndex);}
if(this.fireEvent('beforeedit',this,rowIndex)!==false){this.editing=true;var g=this.grid,view=g.getView(),row=view.getRow(rowIndex),record=g.store.getAt(rowIndex);this.record=record;this.rowIndex=rowIndex;this.values={};if(!this.rendered){this.render(view.getEditorParent());}
var w=Ext.fly(row).getWidth();this.setSize(w);if(!this.initialized){this.initFields();}
var cm=g.getColumnModel(),fields=this.items.items,f,val;for(var i=0,len=cm.getColumnCount();i<len;i++){val=this.preEditValue(record,cm.getDataIndex(i));f=fields[i];f.setValue(val);this.values[f.id]=Ext.isEmpty(val)?'':val;}
this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(row).getXY());}else{this.el.setXY(Ext.fly(row).getXY(),{duration:0.15});}
if(!this.isVisible()){this.show().doLayout();}
if(doFocus!==false){this.doFocus.defer(this.focusDelay,this);}}},stopEditing:function(saveChanges){this.editing=false;if(!this.isVisible()){return;}
if(saveChanges===false||!this.isValid()){this.hide();this.fireEvent('canceledit',this,saveChanges===false);return;}
var changes={},r=this.record,hasChange=false,cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var dindex=cm.getDataIndex(i);if(!Ext.isEmpty(dindex)){var oldValue=r.data[dindex],value=this.postEditValue(fields[i].getValue(),oldValue,r,dindex);if(String(oldValue)!==String(value)){changes[dindex]=value;hasChange=true;}}}}
if(hasChange&&this.fireEvent('validateedit',this,changes,r,this.rowIndex)!==false){r.beginEdit();Ext.iterate(changes,function(name,value){r.set(name,value);});r.endEdit();this.fireEvent('afteredit',this,changes,r,this.rowIndex);}
this.hide();},verifyLayout:function(force){if(this.el&&(this.isVisible()||force===true)){var row=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(row).getWidth(),Ext.isIE?Ext.fly(row).getHeight()+2:undefined);var cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var adjust=0;if(i===(len-1)){adjust+=3;}else{adjust+=1;}
fields[i].show();fields[i].setWidth(cm.getColumnWidth(i)-adjust);}else{fields[i].hide();}}
this.doLayout();this.positionButtons();}},slideHide:function(){this.hide();},initFields:function(){var cm=this.grid.getColumnModel(),pm=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var i=0,len=cm.getColumnCount();i<len;i++){var c=cm.getColumnAt(i),ed=c.getEditor();if(!ed){ed=c.displayEditor||new Ext.form.DisplayField();}
if(i==0){ed.margins=pm('0 1 2 1');}else if(i==len-1){ed.margins=pm('0 0 2 1');}else{if(Ext.isIE){ed.margins=pm('0 0 2 0');}
else{ed.margins=pm('0 1 2 0');}}
ed.setWidth(cm.getColumnWidth(i));ed.column=c;if(ed.ownerCt!==this){ed.on('focus',this.ensureVisible,this);ed.on('specialkey',this.onKey,this);}
this.insert(i,ed);}
this.initialized=true;},onKey:function(f,e){if(e.getKey()===e.ENTER){this.stopEditing(true);e.stopPropagation();}},onGridKey:function(e){if(e.getKey()===e.ENTER&&!this.isVisible()){var r=this.grid.getSelectionModel().getSelected();if(r){var index=this.grid.store.indexOf(r);this.startEditing(index);e.stopPropagation();}}},ensureVisible:function(editor){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(editor.column.id),true);}},onRowClick:function(g,rowIndex,e){if(this.clicksToEdit=='auto'){var li=this.lastClickIndex;this.lastClickIndex=rowIndex;if(li!=rowIndex&&!this.isVisible()){return;}}
this.startEditing(rowIndex,false);this.doFocus.defer(this.focusDelay,this,[e.getPoint()]);},onRowDblClick:function(g,rowIndex,e){this.startEditing(rowIndex,false);this.doFocus.defer(this.focusDelay,this,[e.getPoint()]);},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(['keydown','keyup','keypress']);this.btns=new Ext.Panel({baseCls:'x-plain',cls:'x-btns',elements:'body',layout:'table',width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:'saveBtn',itemId:'saveBtn',xtype:'button',text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:'button',text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap);},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring();}},onShow:function(){if(this.monitorValid){this.startMonitoring();}
Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments);},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex);},positionButtons:function(){if(this.btns){var g=this.grid,h=this.el.dom.clientHeight,view=g.getView(),scroll=view.scroller.dom.scrollLeft,bw=this.btns.getWidth(),width=Math.min(g.getWidth(),g.getColumnModel().getTotalWidth());this.btns.el.shift({left:(width/2)-(bw/2)+scroll,top:h-2,stopFx:true,duration:0.2});}},preEditValue:function(r,field){var value=r.data[field];return this.autoEncode&&typeof value==='string'?Ext.util.Format.htmlDecode(value):value;},postEditValue:function(value,originalValue,r,field){return this.autoEncode&&typeof value=='string'?Ext.util.Format.htmlEncode(value):value;},doFocus:function(pt){if(this.isVisible()){var index=0,cm=this.grid.getColumnModel(),c;if(pt){index=this.getTargetColumnIndex(pt);}
for(var i=index||0,len=cm.getColumnCount();i<len;i++){c=cm.getColumnAt(i);if(!c.hidden&&c.getEditor()){c.getEditor().focus();break;}}}},getTargetColumnIndex:function(pt){var grid=this.grid,v=grid.view,x=pt.left,cms=grid.colModel.config,i=0,match=false;for(var len=cms.length,c;c=cms[i];i++){if(!c.hidden){if(Ext.fly(v.getHeaderCell(i)).getRegion().right>=x){match=i;break;}}}
return match;},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this});}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide();}},isValid:function(){var valid=true;this.items.each(function(f){if(!f.isValid(true)){valid=false;return false;}});return valid;},bindHandler:function(){if(!this.bound){return false;}
var valid=this.isValid();if(!valid&&this.errorSummary){this.showTooltip(this.getErrorText().join(''));}
this.btns.saveBtn.setDisabled(!valid);this.fireEvent('validation',this,valid);},lastVisibleColumn:function(){var i=this.items.getCount()-1,c;for(;i>=0;i--){c=this.items.items[i];if(!c.hidden){return c;}}},showTooltip:function(msg){var t=this.tooltip;if(!t){t=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:'errorTip',width:300,title:this.errorText,autoHide:false,anchor:'left',anchorToTarget:true,mouseOffset:[40,0]});}
var v=this.grid.getView(),top=parseInt(this.el.dom.style.top,10),scroll=v.scroller.dom.scrollTop,h=this.el.getHeight();if(top+h>=scroll){t.initTarget(this.lastVisibleColumn().getEl());if(!t.rendered){t.show();t.hide();}
t.body.update(msg);t.doAutoWidth(20);t.show();}else if(t.rendered){t.hide();}},getErrorText:function(){var data=['<ul>'];this.items.each(function(f){if(!f.isValid(true)){data.push('<li>',f.getActiveError(),'</li>');}});data.push('</ul>');return data;}});Ext.preg('roweditor',Ext.ux.grid.RowEditor);
/* ========== ../mkt-ext-2.0/widgets/MonthPickerPlugin.js ============ */

Ext.ux.MonthPickerPlugin=function(){var picker;var oldDateDefaults;this.init=function(pk){picker=pk;picker.onTriggerClick=picker.onTriggerClick.createSequence(onClick);picker.getValue=picker.getValue.createInterceptor(setDefaultMonthDay).createSequence(restoreDefaultMonthDay);picker.beforeBlur=picker.beforeBlur.createInterceptor(setDefaultMonthDay).createSequence(restoreDefaultMonthDay);};function setDefaultMonthDay(){oldDateDefaults=Date.defaults.d;Date.defaults.d=1;return true;}
function restoreDefaultMonthDay(ret){Date.defaults.d=oldDateDefaults;return ret;}
function onClick(e,el,opt){var p=picker.menu.picker;p.activeDate=p.activeDate.getFirstDateOfMonth();if(p.value){p.value=p.value.getFirstDateOfMonth();}
p.showMonthPicker();if(!p.disabled){p.monthPicker.stopFx();p.monthPicker.show();p.mun(p.monthPicker,'click',p.onMonthClick,p);p.mun(p.monthPicker,'dblclick',p.onMonthDblClick,p);p.onMonthClick=p.onMonthClick.createSequence(pickerClick);p.onMonthDblClick=p.onMonthDblClick.createSequence(pickerDblclick);p.mon(p.monthPicker,'click',p.onMonthClick,p);p.mon(p.monthPicker,'dblclick',p.onMonthDblClick,p);}}
function pickerClick(e,t){var el=new Ext.Element(t);if(el.is('button.x-date-mp-cancel')){picker.menu.hide();}else if(el.is('button.x-date-mp-ok')){var p=picker.menu.picker;p.setValue(p.activeDate);p.fireEvent('select',p,p.value);}}
function pickerDblclick(e,t){var el=new Ext.Element(t);if(el.parent()&&(el.parent().is('td.x-date-mp-month')||el.parent().is('td.x-date-mp-year'))){var p=picker.menu.picker;p.setValue(p.activeDate);p.fireEvent('select',p,p.value);}}};Ext.ux.MonthPickerPlugin2=Ext.extend(Ext.ux.MonthPickerPlugin,{});Ext.preg('monthPickerPlugin',Ext.ux.MonthPickerPlugin);Ext.preg('monthPickerPlugin2',Ext.ux.MonthPickerPlugin2);
/* ========== ../mkt-ext-2.0/main/page.js ============ */

MktPage={satellite:false,satelliteOpener:null,promptCounter:0,debug:false,traceHook:false,debugNextPHPSession:null,isLoggedIn:false,initNav:'no',userid:'',userFullName:null,titlePathSeparator:' \u2022 ',brandTitleSeparator:' | ',uiInitTime:null,canvasmap:null,hasCustAdmin:false,appVars:{},canvasHook:{},isTimedout:false,ciscoPodName:'cs',showCommunicationFailureMessage:false,canvasCleanupStack:[],quickTipsConfig:{showDelay:800,hideDelay:300,dismissDelay:8000,maxWidth:250,minWidth:100},xfeatures:false,sessTimeoutSecs:0,init:function(sfEnvironment,userid,userFullName,initNav,savedState,fCredentials,dlParams,hideExplorer,sessTimeoutSecs){console.debug(':: Welcome to Marketo!');console.debug(':: Customer Prefix:',savedState.custPrefix);console.debug(':: Cluster Hostname:',savedState.clusterHostname);console.debug(':: Saved State:',savedState);console.debug(' ');var token;if(userid===null){this.isLoggedIn=false;this.showCommunicationFailureMessage=false;var location=MktSession.getUrlPrefix()+"/homepage/login";token=Ext.History.getToken();if(token){location+="#"+token;}
if(sfEnvironment=='useSSL'){location="https://"+window.location.host+location;}
window.location.replace(location);return;}
this.uiInitTime=new Date();this.sfEnvironment=sfEnvironment;this.savedState=savedState;this.constants=savedState.constants;this.fCredentials=fCredentials;this.hideExplorer=hideExplorer=='true';this.viewportName=this.userName=userFullName;this.hasAdminRole=MktViewport.showCustAdmin;if(this.isDev()){Ext.Ajax.timeout=3600000;}else{Ext.Ajax.timeout=1800000;}
if(MktSession.hasCredential('guest')){Ext.apply(Ext.Ajax.extraParams,{_mktGuest:true});}
if(MktPage.isDev()||window.location.pathname.indexOf('/access/')===0){Ext.Ajax.on('beforerequest',function(conn,options){if(window.location.pathname.indexOf('/access/')===0){options.url=(options.url[0]!='/'?'/':'')+options.url;}
if(MktPage.isDev()&&!/\/search_dev.*\.php/i.test(options.url)){options.url='/search_dev.php'+(options.url[0]!='/'?'/':'')+options.url;}});}
if(isDefined(sessTimeoutSecs)&&sessTimeoutSecs>0){this.sessTimeoutSecs=sessTimeoutSecs;}
if(MktPage.savedState.xfeatures){MktPage.toggleXfeatures();}
Mkt.util.DeepLinkMgr.initDlCodeMap();Ext.History.init();token=Ext.History.getToken();if(token){if(dlParams===""){dlParams={};}
dlParams=Ext.apply(dlParams,MktDlManager.getDlParams(token));}
this.dlParams=dlParams;Ext.History.on('change',MktDlManager.onHistoryChange.createDelegate(MktDlManager));if(isDefined(dlParams.satellite)){this.satellite=true;this.viewportName=dlParams.title||'';MktViewport=new Mkt.viewport.AppSatelliteViewport(this.viewportName);this.hideExplorer=true;if(window.opener){this.satelliteOpener=window.opener;}}
this.isLoggedIn=true;this.userid=userid;this.initNav=initNav;this.eventMgr=new Ext.util.Observable();this.eventMgr.events={'contentupdated':true,'canvasresized':true,'canvasresizedone':true,'canvasresizestart':true,'panelactivate':true};this.preventNavAway(!this.satellite&&!this.isDev());var body=Ext.getBody();body.addClass(this.getBrowserCSS());var subscriptionCss=this.getSubscriptionCSS();if(subscriptionCss){body.addClass(subscriptionCss);}
body.on('contextmenu',MktPage.bodyContextClick,body,{buffer:100});this._initKeyMap();Ext.EventManager.on(document,"click",MktPage.documentClickHandler);this.initQuickTips();window.onbeforeunload=this._handleUnload;window.onunload=this.cleanup;MktViewport.init(this.viewportName);MktExplorer=MktViewport.explorer;MktCanvas=MktViewport.canvas;this._initNav();this._loadFirstPage();if(!this.satellite){(function(){var queue=new Mkt.widgets.SmartPaletteQueue;queue.init();queue.processSmartPaletteQueue();}.defer(5000,this));}
Mkt.util.XdMessaging.init('xdIFrameProxy',undefined,true);MktPage.alertBrowserSupport();},initQuickTips:function(cfg){Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),cfg||this.quickTipsConfig);},bodyContextClick:function(e,el){if(MktPage.isDev())console.debug('MktPage.bodyContextClick: ',el);return true;},_initKeyMap:function(){this.keyDownMap=new Mkt.KeyMap(document,this._keyDownMapConfig,'keydown');this.keyUpMap=new Mkt.KeyMap(document,this._keyUpMapConfig,'keyup');},_keyDownMapConfig:[{key:Ext.EventObject.ALT,handler:function(e){Ext.getBody().addClass('key-alt');}},{key:Ext.EventObject.ESC,stopEvent:true,handler:function(e){MktCanvas.cancelActivity();}},{key:'h',ctrl:true,shift:true,stopEvent:true,handler:function(e){MktViewport.showGuide();}},{key:'m',alt:true,handler:function(e){MktMainNav.loadMA({});}},{key:'d',alt:true,handler:function(e){MktMainNav.loadLanding({});}},{key:'l',alt:true,handler:function(e){MktMainNav.loadLeadDb({});}},{key:'a',alt:true,handler:function(e){MktMainNav.loadAnalytics({});}},{key:'d',ctrl:true,shift:true,stopEvent:true,handler:function(e){MktPage.toggleDevMode();}},{key:' ',alt:true,shift:true,handler:function(e){MktViewport.toggleFullScreen();}},{key:'x',ctrl:true,shift:true,stopEvent:true,handler:function(e){MktPage.toggleXfeatures();}},{key:'m',ctrl:true,shift:true,stopEvent:true,handler:function(e){var body=Ext.getBody();if(body.hasClass('UpsideDown')){body.removeClass('UpsideDown');}
else{body.addClass('UpsideDown');}}},{key:'o',ctrl:true,shift:true,stopEvent:true,handler:function(e){MktSession.requestTimer.prototype.enableDisable();}},{key:'l',ctrl:true,shift:true,stopEvent:true,handler:function(e){if(MktPage.isDev()){window.open(''+MktSession.getUrlPrefix()+'/sctest/performanceBaseLine','baseLineWin','width=950, height=850, toolbar=1, resizable=1');}}},{key:Ext.EventObject.BACKSPACE,ctrl:true,alt:true,handler:function(e){MktSession.doCustLogout();}}],toggleDevMode:function(){MktPage._devToggle=!MktPage.isDev();console.debug('Dev Mode '+(MktPage.isDev()?'enabled':'disabled'));},toggleXfeatures:function(){MktPage.xfeatures=!MktPage.xfeatures;console.debug('xfeatures '+(MktPage.xfeatures?'enabled':'disabled'));},_keyUpMapConfig:[{key:Ext.EventObject.ALT,handler:function(e){Ext.getBody().removeClass('key-alt');}}],getBrowserCSS:function(){var cls="unknown";if(Ext.isIE){if(Ext.isIE7){cls="ie7";}
else if(Ext.isIE8){cls="ie8";}
else{cls="ie6";}}
else if(Ext.isGecko){cls="ff";}
else if(Ext.isSafari){cls="safari";}
else if(Ext.isOpera){cls="opera";}
return cls;},getSubscriptionCSS:function(){var cls;if(MktPage.savedState.subscriptionType=='Marketo Spark Customer'){cls='mktSpark';}
return cls;},preventNavAway:Ext.emptyFn,_warnOnUnload:false,warnOnUnload:function(warn){MktPage._warnOnUnload=warn;if(warn){MktPage.isTimedout=false;}},_handleUnload:function(evt){MktPage.showCommunicationFailureMessage=false;if(MktPage._warnOnUnload){if(MktPage.isTimedout||MktPage.isDev()||MktPage.hasCredential('fcGuestUser')||MktSession.hasCredential('guest')){return undefined;}
if(MktPage.satellite&&Ext.isGecko&&evt.explicitOriginalTarget&&evt.explicitOriginalTarget.tagName&&isString(evt.explicitOriginalTarget.tagName)&&evt.explicitOriginalTarget.tagName.toLowerCase()=="button"){MktPage.promptCounter++;if(MktPage.promptCounter>=2){return undefined;}}
return"This will close Marketo.";}
return undefined;},_initNav:function(){if(MktPage.initNav=='yes'){MktMainNav.init();}},_loadFirstPage:function(){if(MktPage.initNav=='yes'&&isObject(MktPage.dlParams)){MktDlManager.loadDl(MktPage.dlParams);MktDlManager.startTitleFixup.call(MktDlManager);}else{MktMainNav.loadHome({firstLoad:1});}},processCanvasMap:function(canvasHoldingPen,jsonResponse,ajaxRequest){MktCanvas.processCanvasMap(canvasHoldingPen,jsonResponse,ajaxRequest);},activatePanel:function(tabId,callback){MktCanvas.setActiveTab(tabId,callback);},getActivePanel:function(){return MktCanvas.getActiveTab();},getActivePanelId:function(){return MktCanvas.getActiveTab().id;},updateActivePanelTitle:function(newtitle){var tab=MktCanvas.getActiveTab();tab.updateTabTitle(newtitle);},contentReplace:function(){MktPage.currentMenu=null;var contextName;for(contextName in MktPage.menuContext){var dMenu=MktPage.menuContext[contextName];if(isDefined(dMenu.menuName)&&isDefined(dMenu.destroy)){dMenu.destroy();delete dMenu;}}
for(contextName in MktPage.gridContext){var eGrid=MktPage.gridContext[contextName];if(isDefined(eGrid.gridName)&&isDefined(eGrid.destroy)){eGrid.destroy();delete eGrid;}}
for(contextName in MktPage.datePickerContext){var dP=MktPage.datePickerContext[contextName];if(isDefined(dP.dpName)&&isDefined(dP.destroy)){dP.destroy();delete dP;}}
MktCanvas.clearCanvas();MktPage.appVars={};},clearPanelContentValid:function(tabId){var tab=MktCanvas.getTab(tabId);if(tab&&tab.clearContentValid){tab.clearContentValid();}},_devToggle:null,isDev:function(){if(MktPage._devToggle!==null)return MktPage._devToggle;if(!isDefined(MktPage.sfEnvironment))return false;return MktPage.sfEnvironment.slice(0,3)=='dev';},isProd:function(){if(!isDefined(MktPage.sfEnvironment))return true;return MktPage.sfEnvironment.slice(0,4)=='prod';},isTestdrive:function(){if(!isDefined(MktPage.sfEnvironment))return false;return MktPage.sfEnvironment.slice(MktPage.sfEnvironment.length-3)=='_td';},hasCredential:function(fc){if(!isDefined(MktPage.sfEnvironment))return false;if(!isArray(MktPage.fCredentials))return false;return MktPage.fCredentials.some((function(e){return e==fc;}));},hasSalesInsight:function(){return MktPage.hasCredential('fcSalesInsight');},hasWorkspaces:function(){return MktPage.hasCredential('accesszones');},isMarketo:function(){return(MktPage.userid.indexOf('@marketo.com')!=-1);},getPodName:function(){return MktPage.savedState.podName;},isCiscoPod:function(){return MktPage.getPodName().toUpperCase()==MktPage.ciscoPodName.toUpperCase();}};MktPage.timedout=function(sfEnvironment,userid){MktPage.sfEnvironment=sfEnvironment;MktPage.isLoggedIn=false;MktPage.userid=userid;this.showCommunicationFailureMessage=false;window.location.replace(MktSession.getUrlPrefix()+"/homepage/login?stat=2");return;};MktPage.doRefreshUser=function(userid,userFullName){MktPage.userid=userid;MktPage.userName=userFullName;var comp=Ext.ComponentMgr.get('logged-in-as');var origText=comp.getText();var colon=origText.indexOf(':');if(colon>0){comp.setText(origText.substring(0,colon+2)+userFullName);}};MktPage.setTitle=function(title){window.document.title=Ext.util.Format.htmlDecode(title);if(Ext.isIE){window.document.currentTitle=window.document.title;}};MktPage.updateFullTitle=function(){var extendedTitle="";var firstTab=MktCanvas.items.first();var activeTab=MktCanvas.getActiveTab();if(firstTab&&firstTab.config.title){MktViewport.updateHeaderText(firstTab.config.title);}
if(firstTab&&firstTab.config.satelliteTitle){extendedTitle=firstTab.config.satelliteTitle;MktViewport.updateHeaderText(extendedTitle);}else if(firstTab&&firstTab.config.prependTitle){extendedTitle=firstTab.config.title;if(activeTab&&activeTab!=firstTab){extendedTitle=extendedTitle+" ("+activeTab.config.title+")";}}else if(firstTab&&firstTab.config.revFirstActiveTitle){extendedTitle=firstTab.config.title;if(activeTab&&activeTab!=firstTab){extendedTitle=activeTab.config.title+MktPage.titlePathSeparator+extendedTitle;}}else if(activeTab&&activeTab.config.skipAppendTitle){var pass;}else{if(activeTab){extendedTitle=activeTab.config.title;}}
var title=MktPage.mktoBrandName+MktPage.brandTitleSeparator+(extendedTitle.length>0?extendedTitle+MktPage.titlePathSeparator:'')+MktPage.topNavTitle;MktPage.setTitle(title);};MktPage.showException=function(e,location){var msg="blew up in "+location+": "+e+" [name:] "+e.name+" [message:] "+e.message;if(isDefined(e.description)){msg+=" [description:] "+e.description;}
if(isDefined(e.number)){msg+=" [number:] "+e.number;}
if(isDefined(e.lineNumber)){msg+=" [lineNumber:] "+e.lineNumber;}
if(isDefined(e.fileName)){msg+=" [fileName:] "+e.fileName;}
if(isDefined(e.stack)){msg+=" [stack:] "+e.stack;}
var systemErrorMsg=MktMessage.SYSTEM_ERROR_REFRESH;var request=null;var parseResults={success:false,errorType:'JavaScript Exception: '+e,errorHTML:systemErrorMsg,jsonObject:null};var reqParams=null;MktSession.phoneHome({request:request,parseResults:parseResults,reqParams:reqParams,cleanResponseText:msg});MktMessage.showSystemError(systemErrorMsg,{request:request,parseResults:parseResults,reqParams:reqParams,cleanResponseText:msg,showDebugInfo:MktPage.isDev()});};MktPage.buttonTest=function(container){var anchors=$(container).getElementsByTagName('a');var d=MElement.disabled(anchors[0]);for(var ix=0;ix<anchors.length;ix++){MElement.disabled(anchors[ix],!d);}};MktPage.menuContext={};MktPage.gridContext={};MktPage.datePickerContext={};MktPage.canvasContext={};MktPage.menuRenderContainerId='MDropRender';MktPage.currentMenu=null;MktPage.currentOverlay=null;MktPage.clickedInCalPicker=false;MktPage.currentCalPicker=null;MktPage.documentClickStack=[];MktPage.documentClickHandler=function(e){if(isObject(MktPage.currentMenu)){var dMenu=MktPage.currentMenu;if(isFunction(dMenu.unhighlightButton)){dMenu.unhighlightButton();}
dMenu.yMenu.hide();}
if(isObject(MktPage.currentOverlay)){var ol=MktPage.currentOverlay;ol.closeFindPopup();}
if(isObject(MktPage.currentCalPicker)){if(!MktPage.clickedInCalPicker){MktPage.currentCalPicker.hideAllCalPickers();}else{MktPage.clickedInCalPicker=false;}}
while(MktPage.documentClickStack.length>0){var cfn=MktPage.documentClickStack.shift();cfn();}};MktPage.menuHandler=function(eventType,args,dMenu){if(eventType=="show"){if(MktPage.currentOverlay!==null){MktPage.documentClickHandler();}
if(MktPage.currentMenu!==null){MktPage.documentClickHandler();}
MktPage.currentMenu=dMenu;}else{if(MktPage.currentMenu!==null){if(isFunction(MktPage.currentMenu.unhighlightButton)){MktPage.currentMenu.unhighlightButton();}}
MktPage.currentMenu=null;}};MktPage.overlayHandler=function(eventType,args,ol){if(eventType=="show"){if(MktPage.currentMenu!==null){MktPage.documentClickHandler();}
if(MktPage.currentOverlay!==null){MktPage.documentClickHandler();}
MktPage.currentOverlay=ol;}else{MktPage.currentOverlay=null;}};MktPage.showHelp=function(){if(MktPage.isDev()){Element.setStyle("debugPopup",{width:document.body.clientWidth-100,height:document.body.clientHeight-100});Element.setStyle("debugPopupContents",{width:document.body.clientWidth-143,height:document.body.clientHeight-128});Element.show("debugPopup");}};MktPage.ShowAccessSummaryForm=Ext.extend(Ext.Window,{width:350,height:400,minWidth:300,minHeight:300,title:"Unknown Zone",iconCls:'mkiKeyInformation',resizable:true,maximizable:true,layout:'fit',plain:true,modal:false,frame:true,buttonAlign:'right',initComponent:function(){this.items=this.items||[];this.treeRoot=new Ext.tree.TreeNode({allowDrag:false,allowDrop:false});this.treePanel=new Ext.tree.TreePanel({root:this.treeRoot,rootVisible:false,trackMouseOver:false,selModel:new Ext.tree.DefaultSelectionModel({listeners:{beforeselect:function(){return false;}}}),cls:'mktTreeBox-transparent',bodyStyle:{overflowY:'auto',backgroundColor:'transparent'}});this.items.push(this.treePanel);this.buttons=this.buttons||[];this.buttons.push({text:'Close',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});MktPage.ShowAccessSummaryForm.superclass.initComponent.call(this);},listeners:{show:function(comp){comp.treePanel.addClass('mktModalLoading');MktSession.ajaxRequest('zoneAdmin/showZoneSummary',{serializeParms:{zoneId:comp.zoneId,appArea:comp.appArea},onMySuccess:comp.loadSummaryDone.createDelegate(comp)});}},loadSummaryDone:function(results,request){var root=results.JSONResults.accTree;if(root!==null){MktPage.accessTreeToNodes(this.treeRoot,root);}
this.treePanel.removeClass('mktModalLoading');}});MktPage.accessTreeToNodes=function(parent,children){for(var i=0;i<children.length;i++){var child=children[i];var iconCls='';switch(child.accessLevel){case 0:iconCls='mktAccessNodeNone';break;case 10:iconCls='mktAccessNodeLimited';break;case 100:iconCls='mktAccessNodeFull';break;case 1000:iconCls='mktAccessNodeAdmin';break;default:break;}
var node=new Ext.tree.TreeNode({text:child.text,cls:iconCls,leaf:!isDefined(child.children),expanded:isDefined(child.children),allowDrag:false,allowDrop:false});parent.appendChild(node);if(isDefined(child.children)){MktPage.accessTreeToNodes(node,child.children);}}};MktPage.accessSummaryDialog;MktPage.showAccessSummary=function(el,multiZone,zoneId,zoneName,accessType,appArea){if(MktPage.accessSummaryDialog){MktPage.accessSummaryDialog.close();}
var title=accessType;if(multiZone){title=title+'&nbsp;&ndash;&nbsp;'+zoneName;}
MktPage.accessSummaryDialog=new MktPage.ShowAccessSummaryForm({title:title,zoneId:zoneId,appArea:appArea});MktPage.accessSummaryDialog.show();};MktPage.toggleDebug=function(){MktPage.debug=!MktPage.debug;alert("Debugging set "+(MktPage.debug?"on.":"off."));};MktPage.debugNextPHP=function(inputId){var input=document.getElementById(inputId);if(input&&input.value){MktPage.debugNextPHPSession=input.value;alert("Next AjaxRequest will be started with XDEBUG_SESSION_START="+input.value);}else{alert("Please enter XDEBUG Session Id to use this feature.");}};MktPage.debugPHPOff=function(){MktPage.debugNextPHPSession='STOP';};MktPage.getDevMode=function(){return(window.location.pathname.indexOf('search_dev')!=-1);};MktPage.debugControls=null;MktPage.showDebugControls=function(el){if(!MktPage.debugControls){MktPage.debugControls=new Ext.Window({el:'debugPanel',layout:'fit',width:500,height:300,closeAction:'hide',plain:true,items:new Ext.TabPanel({el:'hello-tabs',autoTabs:true,activeTab:0,deferredRender:false,border:false}),buttons:[{text:'Submit',disabled:true},{text:'Close',handler:function(){MktPage.debugControls.hide();}}]});MktPage.debugControls.show(el.getEl());}else{if(MktPage.debugControls.hidden){MktPage.debugControls.show(el.getEl());}else{MktPage.debugControls.hide();}}};MktPage.cleanup=function(timeout){var reqIds=[];MktCanvas.items.each(function(item,index,length){var reqs=item.getRegisteredItem(MktSession.cancellableRequestKey);if(reqs&&Ext.isArray(reqs)){reqIds=reqs.concat(reqIds);}});if(reqIds.length>0){timeout=timeout||0;var url="homepage/cancelRequest?_nc="+new Date().getTime()+"&ref=pageUnload&mktoReqIds="+Ext.encode(reqIds);var done=false;var img=new Image(1,1);img.onload=function(){done=true;};img.src=url;if(timeout>0){var start=new Date().getTime();while(!done){var now=new Date().getTime();if(now-start>timeout){break;}}}}};MktPage.isSpark=function(){if(MktPage.savedState){return(MktPage.savedState.subscriptionType=='Marketo Spark Customer');}
else{return Ext.select(".mktSpark");}};MktPage.alertBrowserSupport=function(){var htmlString='';var iconString='';if(MktPage.isDev()){return;}
if(Ext.isIE7||Ext.isIE8||Ext.isGecko||MktPage.satellite||Ext.isChrome){return;}else{if(Ext.isIE6){htmlString='Sorry, Internet Explorer 6 is not supported. Most of the user interface will not work.';iconString='/images/icons32/ie6.png';}else if(Ext.isChrome){htmlString='Want Marketo to officially support <br/> Chrome? <a target="_blank" href="/guide/displaySuccessContent?contentTag=page_SupportBrowser">Help us make it happen</a>';iconString='/images/icons32/chrome.png';}else if(Ext.isSafari){htmlString='Want Marketo to officially support <br/> Safari? <a target="_blank" href="/guide/displaySuccessContent?contentTag=page_SupportBrowser">Help us make it happen</a>';iconString='/images/icons32/safari.png';}else if(Ext.isOpera){htmlString='Sorry, Opera is not supported.<br/> Some user interface may not work.';iconString='/images/icons32/opera.png';}else if(Ext.isGecko2){htmlString='Sorry, FireFox 2 is not supported.<br/> Most of the user interface will not work.';iconString='/images/icons32/firefox.png';}else{htmlString='Sorry, we cannot recognize your browser type.  Some user interface may not work.';iconString='/images/icons32/browser.png';}}
brStatWin=new MktLeadDb.FloatingStatusWindow({title:"Browser Warning",height:90,width:290,renderTo:Ext.getBody(),updateTitleStatus:function(){this.setTitle(this.title);},renderStatus:function(){var container=Ext.DomHelper.append(this.body.dom,{tag:'div'});var iconContainer=Ext.DomHelper.append(container,{tag:'div'});var textContainer=Ext.DomHelper.append(container,{tag:'div',style:'position: relative; top: -40px; padding-top:8px; padding-left: 40px; font-size:12px;'});var el=Ext.DomHelper.append(textContainer,{html:htmlString},true);var imgEl=Ext.DomHelper.append(iconContainer,{tag:'img',style:'padding-top: 9px;',src:iconString});}});brStatWin.show();};
/* ========== ../mkt-ext-2.0/main/session.js ============ */

var MktSession={crlf:String.fromCharCode(13,10),htmlGuard:"+++JSON-END-SENTINEL+++",lastSelExpNode:null,lastSelWdlNode:null,lastSelLpgNode:null,activeModalForm:null,transactionId:0,resultSucess:'Success',resultSuccess:'Success',resultFailed:'Failed',resultBusy:'Busy',resultDuplicate:'Duplicate',cancellableRequestKey:'cancellableRequests',request:null,ajaxIndicatorCount:0,ender:null};MktSession.requestTimer=function(URL,timer_data){var timers=MktSession.requestTimer.prototype.timers;bunch=[{when:getCurrentTimeDate()},{url:URL},timer_data];MktSession.requestTimer.prototype.conditionalFillLog(bunch);timers.push(bunch);if(timers.length>10){timers.shift();}};MktSession.requestTimer.prototype={timers:[],shown:false,enableDisable:function(){shown=MktSession.requestTimer.prototype.shown;if(!shown){Ext.log("Enabled (timer dumping). To disable: press Ctrl-shift-T, then close log window.");MktSession.requestTimer.prototype.fillLogCached();}
else{Ext.log("Disabled (timer dumping). You can close this log window.");}
MktSession.requestTimer.prototype.shown=!shown;},conditionalFillLog:function(bunch){if(MktSession.requestTimer.prototype.shown){MktSession.requestTimer.prototype.fillLog(bunch);}},fillLog:function(bunch){var pre='';for(var i=0;i<bunch.length;i++){dict=bunch[i];for(var field in dict){if(i>0)pre='   ';Ext.log(pre+field+': '+dict[field]);}}},fillLogCached:function(){var timers=MktSession.requestTimer.prototype.timers;for(var i=0;i<timers.length;i++){MktSession.requestTimer.prototype.fillLog(timers[i]);}
MktSession.requestTimer.prototype.timers=[];}};MktSession.processPerfTest=function(request,reqParams){var dt=new Date();var elapsedTime=dt.getTime()-reqParams.startTime;var timing=request.getResponseHeader['X-Timing-Json'];var html='<h1> Results: </h1> <p> Request start at: '+
reqParams.requestDate+'<br> Response received at: '+
dt.toString()+'<br> Total Response Time(includes network): '+
elapsedTime+'ms'+'<br>';if(!isUndefined(reqParams.parseJson)){var start=new Date().getTime();var parsedResults=MktSession.parseResults(request);html+='Parse JSON Time: '+(new Date().getTime()-start)+'ms';}
if(!isUndefined(timing)){timing=eval('('+timing+')');for(var field in timing){html+=''+field+': '+timing[field]+'<br>';}}
html+=' </p> ';var divId=reqParams.id.replace("button","result");var divCmp=Ext.getCmp(divId);if(!isUndefined(divCmp)){divCmp.body.update(html);}};MktSession.doCustLogout=function(){MktPage.isLoggedIn=false;MktPage.preventNavAway(false);window.location.replace(MktSession.getUrlPrefix()+"/homepage/login");};MktSession.doCustAbort=function(stat){MktPage.isLoggedIn=false;MktPage.preventNavAway(false);window.location.replace(MktSession.getUrlPrefix()+"/homepage/login?stat="+stat);};MktSession.doSubscriptionCancelled=function(){MktPage.isLoggedIn=false;MktPage.preventNavAway(false);window.location.replace(MktSession.getUrlPrefix()+"/homepage/login?loginMsg=Subscription has been cancelled");};MktSession.doEusaDeclined=function(){MktPage.preventNavAway(false);window.location.replace(MktSession.getUrlPrefix()+"/signup/eusaDeclined");};MktSession.initMainNav=function(){if(MktPage.initNav!='yes'){MktPage.initNav='yes';MktMainNav.init();}};MktSession.getUrlPrefix=function(){var regexp=new RegExp("/search_dev.*\.php");var matches=window.location.pathname.match(regexp);var prefix;if(matches!==null){prefix=matches[0];}else{prefix="";}
return prefix;};function getCurrentTimeDate(){var currentDate=new Date();var day=currentDate.getDate();var month=currentDate.getMonth()+1;var year=currentDate.getFullYear();var hours=currentDate.getHours();var minutes=currentDate.getMinutes();var suffix="AM";if(hours>=12){suffix="PM";hours=hours-12;}
if(hours===0){hours=12;}
if(minutes<10)
minutes="0"+minutes;var currentTimeDate=month+"/"+day+"/"+year+" | "+hours+":"+minutes+" "+suffix;return currentTimeDate;}
MktSession.parseResults=function(request){var results={success:false,errorType:'?',errorHTML:MktMessage.SYSTEM_ERROR_NOT_STARTED,jsonObject:null};if(isUndefined(request.responseText)){request.responseText='';}
if(request.status==-1){results.errorType='Ajax Request Timeout ('+(Ext.Ajax.timeout/1000)+' sec)';results.errorHTML=MktMessage.SYSTEM_ERROR_TIMEOUT;return results;}
var guardIx=request.responseText.indexOf(MktSession.htmlGuard,0);var response=request.responseText;var debug=null;if(guardIx!=-1){response=request.responseText.substring(0,guardIx);if(request.responseText.length>(guardIx+MktSession.htmlGuard.length)){debug=request.responseText.substring(guardIx+MktSession.htmlGuard.length);}}
else{response=request.responseText;}
if(!response||response.length===0){results.errorType='Empty response string (probably a PHP fatal error)';results.errorHTML='Raw Response: '+request.responseText;return results;}
try{results.jsonObject=eval('('+response+')');if(results.jsonObject===false){results.errorType='JSON Decode Error (1)';results.errorHTML=response;}else{if((isDefined(results.jsonObject.JSONResults))&&(isDefined(results.jsonObject.HTMLResults))){results.success=true;results.errorType='Success';results.errorHTML='';}else{results.errorType='JSON Decode Error (2)';results.errorHTML=response;}}}catch(e){results.errorType='Exception parsing response JSON object';results.errorType+='\nException: '+e;results.errorType+='\nJSON object: '+results.jsonObject;console.debug(results.errorType,e);console.debug("JSON Object=",results.jsonObject);results.errorHTML=results.jsonObject;}
return results;};MktSession.ExtAjaxWrapper=function(config){return MktSession.ajaxRequest(config.url,config);};MktSession.encodeURIComponent=function(content){return content;};MktSession.ajaxRequest=function(url,opts){if(isUndefined(opts)){opts={};}else{opts=Ext.apply({},opts);}
opts.url=url;if(isUndefined(opts.params)){opts.params={};}
if(isUndefined(opts.headers)){opts.headers={};}
if(isUndefined(opts.URLPrefix)){var prefix=(opts.url.indexOf('/')===0)?"":"/";opts.url=MktSession.getUrlPrefix()+prefix+opts.url;}
var dt=new Date();opts.requestDate=dt.toString();MktSession.recordAjaxHistory(opts);if(MktPage.debugNextPHPSession!==null){var debug=MktPage.debugNextPHPSession;if(debug=='STOP'){debug='';}
opts.params['XDEBUG_SESSION_START']=debug;MktPage.debugNextPHPSession=null;}
if(isDefined(opts.serializeForm)&&isUndefined(opts.form)){opts.form=opts.serializeForm;}
if(isDefined(opts.serializeParms)){for(var pName in opts.serializeParms){if(typeof opts.serializeParms[pName]!='function'){opts.params[pName]=opts.serializeParms[pName];}}}
if(isDefined(opts.serializeJSON)){opts.params['_json']=Ext.encode(opts.serializeJSON);}
if(isDefined(opts.cacheRequest)&&opts.cacheRequest){var cacheKey='session.ajr.'+opts.url+'?'+Ext.urlEncode(opts.params);if(Mkt.cache.CacheManager.containsValid(cacheKey)){console.log("{ajaxRequest} found cached response for key: "+cacheKey);var req=Mkt.cache.CacheManager.getValue(cacheKey);MktSession.ajaxSuccess(req.request,req.reqParams);return;}}
if(opts.params.length===0){opts.headers['Content-Length']=0;}
opts.success=MktSession.ajaxSuccess.bind(opts);opts.exception=MktSession.ajaxException.bind(opts);opts.failure=MktSession.ajaxFailure.bind(opts);if(opts.url===''){console.debug('Ajax request with no URL!!',opts);if(MktPage.isDev()){MktMessage.showSystemError('Ajax request with no URL!');}}
if(opts.cancelQuery&&opts.canvas&&opts.params){var mktoReqId=MktSession.monitorRequest(opts.canvas);if(mktoReqId){opts.params.mktoReqId=mktoReqId;}}else{MktSession.transactionId++;}
MktPage.showCommunicationFailureMessage=true;var transaction=Ext.Ajax.request(opts);};MktSession.getRequestId=function(){if(isUndefined(MktPage)||isUndefined(MktPage.savedState)||isUndefined(MktPage.savedState.userId)||isUndefined(MktPage.savedState.sfSessionId)){return null;}
var tId=MktSession.transactionId++;var reqSep='-';var requestId='mktoReqId'+reqSep+MktPage.savedState.userId+
reqSep+MktPage.savedState.sfSessionId+reqSep+tId+
reqSep+(new Date().getTime());return requestId;};MktSession.monitorRequest=function(canvas,requestId){if(isUndefined(canvas)||canvas.length<1){return null;}
requestId=requestId||MktSession.getRequestId();var items=MktCanvas.getRegisteredItem(MktSession.cancellableRequestKey,canvas);if(!items){items=[];}
if(Ext.isArray(items)){items.push(requestId);MktCanvas.registerItem(MktSession.cancellableRequestKey,items,canvas);}
return requestId;};MktSession._doCancelRequest=function(canvas,reqIds){var reqs=Ext.encode(reqIds);console.log("Cancelling requests: "+reqs);MktSession.ajaxRequest("homepage/cancelRequest",{serializeParms:{mktoReqIds:reqs},onMySuccess:MktSession.cancelRequestDone.createDelegate(this,[canvas,reqIds])});};MktSession.cancelRequest=function(canvas,reqIds){if(reqIds&&Ext.isArray(reqIds)&&reqIds.length>0){var canvasObj=MktCanvas.getTab(canvas);if(canvasObj){if(!canvasObj.getInCancelRequest()){canvasObj.setInCancelRequest(true);}
else{return;}}
MktSession._doCancelRequest.defer(3000,this,[canvas,reqIds.splice(0)]);}};MktSession.cancelRequestDone=function(canvas,reqIds){if(MktPage.appVars.result==MktSession.resultSuccess){var canvasObj=MktCanvas.getTab(canvas);if(canvasObj){var regItem=canvasObj.getRegisteredItem(MktSession.cancellableRequestKey);if(regItem){var origLength=reqIds.length;for(var i=origLength;i>0;i--){var idx=regItem.indexOf(reqIds[i-1]);if(idx!=-1){regItem.remove(reqIds[idx]);}}
if(origLength!=regItem.length){canvasObj.registerItem(MktSession.cancellableRequestKey,regItem);}}
canvasObj.setInCancelRequest(false);}}
if(isDefined(MktPage.appVars.result)){delete MktPage.appVars.result;}};MktSession.recordAjaxHistory=function(opts){var dt=new Date();if(!MktSession.ajaxHistory){MktSession.ajaxHistory=[];}
else if(MktSession.ajaxHistory.length>10){MktSession.ajaxHistory.shift();}
var fullParams='';if(opts.serializeParms){fullParams+=Ext.urlEncode(opts.serializeParms);}
if(opts.serializeForm){fullParams+='&'+Ext.Ajax.serializeForm(opts.serializeForm);}
var shortParams=fullParams.substr(0,100);var omitted=fullParams.length-shortParams.length;if(omitted>0)shortParams+=' ( omitted '+omitted+' Bytes)';var currentCanvas='--';if(typeof MktCanvas!='undefined'&&MktCanvas.activeTab){currentCanvas=MktCanvas.activeTab.config.title;}
MktSession.ajaxHistory.push({date:opts.requestDate,url:opts.url,currentCanvas:currentCanvas,params:shortParams});};MktSession.showMessage=function(msg,level){if(level=='crit'){MktMessage.showCrit(msg);}
else if(level=='err'){MktMessage.showError(msg);}
else if(level=='warn'){MktMessage.showWarning(msg);}
else if(level=='info'){MktMessage.showInfo(msg);}
else if(level=='emailsent'){MktMessage.showEmailSent(msg);}
else if(level=='notfound'){MktMessage.showNotFound(msg);}
else if(level=='403forbidden'){MktMessage.show403Forbidden(msg);}
else if(level=='comingsoon'){MktMessage.showInfo(msg);}
else if(level=='console'){console.debug('MktSession.showMessage:',msg);}
else{MktMessage.showInfo(msg);}
return null;};MktSession.formFocus=function(formId){$('formId').focus();};MktSession.showAjaxIndicator=MktSession.hideAjaxIndicator=MktSession.initAjaxIndicator=Ext.emptyFn;MktSession.clockCursor=function(tf){if(tf!==false){Ext.get(document.body).addClass("mktWaiting");if(!MktPage.waitingMask){MktPage.waitingMask=Ext.DomHelper.append(document.body,{cls:"mktClockCursorBodyMask",cn:{tag:'div'}},true);}else{Ext.get(MktPage.waitingMask).setStyle('display','block');}
window.setTimeout('MktSession.unclockCursor()',5000);}else{Ext.get(document.body).removeClass("mktWaiting");if(MktPage.waitingMask){Ext.get(MktPage.waitingMask).setStyle('display','none');}}};MktSession.unclockCursor=function(){MktSession.clockCursor(false);};MktSession.closeActiveModalForm=function(){if(MktSession.activeModalForm){if(MktSession.activeModalForm.v3){MktSession.activeModalForm.close();}
else{MktSession.activeModalForm.dlg.close();}}
MktSession.activeModalForm=null;if(MktSession.activeModalDialog){MktSession.activeModalDialog.hide();MktSession.activeModalDialog.destroy(true);MktSession.activeModalDialog=null;}};MktSession.setModalFormMessage=function(message){var activeModalForm=MktSession.activeModalForm;if(activeModalForm&&activeModalForm.v3){activeModalForm.setMessage(message);return;}
MktModalForm.clearMessage();MktModalForm.setMessage(message);};MktSession.setModalFormError=function(message){var activeModalForm=MktSession.activeModalForm;if(activeModalForm&&activeModalForm.v3){activeModalForm.setErrorMessage(message);return;}
MktModalForm.clearMessage();MktModalForm.setMessageError(message);};MktSession.setExtWindowFormMsg=function(message){MktSession.clearExtWindowFormError();var messageHTML="<h2><div class='mktModalInFormMessage'>"+message+"</div></h2>";MktSession.setExtWindowInsertMsg(messageHTML);};MktSession.setExtWindowFormError=function(message){MktSession.clearExtWindowFormError();var messageHTML="<h2><div class='mktModalInFormMessage mktModalErrorMessage'>"+message+"</div></h2>";MktSession.setExtWindowInsertMsg(messageHTML);};MktSession.setExtWindowInsertMsg=function(messageHTML){var msg;if(MktSession.activeModalForm){msg=MktSession.activeModalForm.el.insertHtml('afterBegin',messageHTML);MktSession.activeModalForm.el.errorWrapper=Ext.get(msg);}else if(MktSession.activeModalDialog){msg=MktSession.activeModalDialog.body.insertHtml('afterBegin',messageHTML);MktSession.activeModalDialog.body.errorWrapper=Ext.get(msg);}};MktSession.clearExtWindowFormError=function(){if(MktSession.activeModalForm&&MktSession.activeModalForm.el.errorWrapper){MktSession.activeModalForm.el.errorWrapper.remove();}else if(MktSession.activeModalDialog&&MktSession.activeModalDialog.body.errorWrapper){MktSession.activeModalDialog.body.errorWrapper.remove();}};MktSession.hideModalPleaseWait=function(){Ext.MessageBox.hide();};MktSession.expandExplorer=function(){MktViewport.west.expand();};MktSession.openExplorerTab=function(tab){};MktSession.clearAlert=function(code,objClass,objId){if(isObject(MktPage.canvasHook.alertMgr)){MktPage.canvasHook.alertMgr.removeAlert(code,objId);}};MktSession.progressMessage=function(msg){var progressArea=$('msmProgressArea');if(isDOMElement(progressArea)){Element.update(progressArea,msg);Element.show(progressArea);}};MktSession.updateDiv=function(html,id,wkd,jr,request){var element=$(id);var eid=id;if(wkd.mapContainerId){element=$(request.containerId);eid=request.containerId;}
if(isDOMElement(element)){if(wkd.preAction!==null){if(isString(wkd.preAction)){eval(wkd.preAction);}else if(isFunction(wkd.preAction)){wkd.preAction(element,jr);}}
element.innerHTML=html.stripScripts();if(wkd.postAction!==null){if(isString(wkd.postAction)){eval(wkd.postAction);}else if(isFunction(wkd.postAction)){wkd.postAction(element,jr,request);}}}else{console.debug("server supplied html for element '"+eid+"' but the element is not present.");}};MktSession.cleanAllWS=function(element){var kids=element.childNodes;var ct=0;for(var ix=kids.length-1;ix>-1;ix--){if(kids[ix].nodeType==3){if(!(/\S/.test(kids[ix].nodeValue))){Element.remove(kids[ix]);ct++;}}else{ct+=MktSession.cleanAllWS(kids[ix]);}}
return ct;};MktSession.replaceNodes=function(nodeJsons){if(MktExplorer)MktExplorer.replaceNodes(nodeJsons);var registeredAssetManager=MktCanvas.getRegisteredItem(Mkt.apps.localasset.Constants.LOCAL_ASSET_MANAGER,Mkt.apps.localasset.Constants.TAB_NAME);if(registeredAssetManager){registeredAssetManager.replaceNodes(nodeJsons);}};MktSession.addNodes=function(nodeJsons){if(MktExplorer)MktExplorer.addNodes(nodeJsons);var registeredAssetManager=MktCanvas.getRegisteredItem(Mkt.apps.localasset.Constants.LOCAL_ASSET_MANAGER,Mkt.apps.localasset.Constants.TAB_NAME);if(registeredAssetManager){registeredAssetManager.addNodes(nodeJsons);}};MktSession.deleteNodes=function(ids){MktExplorer.removeNodes(ids);var registeredAssetManager=MktCanvas.getRegisteredItem(Mkt.apps.localasset.Constants.LOCAL_ASSET_MANAGER,Mkt.apps.localasset.Constants.TAB_NAME);if(registeredAssetManager){registeredAssetManager.removeNodes(ids);}};MktSession.expandFolderNode=function(id){MktExplorer.expandFolder(id);};MktSession.expandNodeByServerPaths=function(path){MktExplorer.expandNodeByServerPaths(path);};MktSession.replaceRecs=function(panelId,compId,datas){var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){if(!isNull(compId)){if(panel.config.compId!=compId){return;}}
var grid=panel.getGridPanel();if(grid){grid.updateGridRows(datas);}}};MktSession.addRecs=function(panelId,compId,datas){var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){if(!isNull(compId)){if(panel.config.compId!=compId){return;}}
var grid=panel.getGridPanel();if(grid){grid.addGridRows(datas);}}};MktSession.deleteRecs=function(panelId,compId,ids){var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){if(!isNull(compId)){if(panel.config.compId!=compId){return;}}
var grid=panel.getGridPanel();if(grid){grid.deleteGridRows(ids);}}};MktSession.removeLinkFocus=function(el,tagName){if(document.getElementsByTagName){var elScope=el||document;for(var i in a=elScope.getElementsByTagName(tagName||'a')){a[i].onmousedown=function(){this.blur();this.hideFocus=true;if(this.style&&this.style.outline){this.style.outline='none';}};a[i].onmouseout=a[i].onmouseup=function(){this.blur();this.hideFocus=false;if(this.style&&this.style.outline){this.style.outline=null;}};}}};MktSession.unmask=function(){if(isDefined(MktExplorer)){MktExplorer.unmask();}
if(isDefined(MktCanvas)){MktCanvas.unmask();}};MktSession.wellKnownDivs={content:{type:'div',preAction:MktPage.contentReplace},loginBox:{type:'div'},workingPen:{type:'div'},panelHoldingPen:{type:'div',mapContainerId:true},canvasHoldingPen:{type:'div',preAction:MktPage.contentReplace,postAction:MktPage.processCanvasMap},canvasUpdateHoldingPen:{type:'div',postAction:MktPage.processCanvasMap}};MktSession.wellKnownActions={};MktSession.wellKnownActions.doCustLogout=MktSession.doCustLogout;MktSession.wellKnownActions.doCustAbort=MktSession.doCustAbort;MktSession.wellKnownActions.doSubscriptionCancelled=MktSession.doSubscriptionCancelled;MktSession.wellKnownActions.doEusaDeclined=MktSession.doEusaDeclined;MktSession.wellKnownActions.initMainNav=MktSession.initMainNav;MktSession.wellKnownActions.closeSubForm=MktSession.closeSubForm;MktSession.wellKnownActions.formFocus=MktSession.formFocus;MktSession.wellKnownActions.closeActiveModalForm=MktSession.closeActiveModalForm;MktSession.wellKnownActions.setModalFormMessage=MktSession.setModalFormMessage;MktSession.wellKnownActions.setModalFormError=MktSession.setModalFormError;MktSession.wellKnownActions.setExtWindowFormError=MktSession.setExtWindowFormError;MktSession.wellKnownActions.openExplorerTab=MktSession.openExplorerTab;MktSession.wellKnownActions.hideModalPleaseWait=MktSession.hideModalPleaseWait;MktSession.wellKnownActions.unclockCursor=MktSession.unclockCursor;MktSession.wellKnownActions.expandExplorer=MktSession.expandExplorer;MktSession.wellKnownActions.clearAlert=MktSession.clearAlert;MktSession.wellKnownActions.unmask=MktSession.unmask;MktSession.wellKnownActions.addNodes=MktSession.addNodes;MktSession.wellKnownActions.replaceNodes=MktSession.replaceNodes;MktSession.wellKnownActions.deleteNodes=MktSession.deleteNodes;MktSession.wellKnownActions.expandFolderNode=MktSession.expandFolderNode;MktSession.wellKnownActions.expandNodeByServerPaths=MktSession.expandNodeByServerPaths;MktSession.wellKnownActions.addRecs=MktSession.addRecs;MktSession.wellKnownActions.replaceRecs=MktSession.replaceRecs;MktSession.wellKnownActions.deleteRecs=MktSession.deleteRecs;MktSession.wellKnownActions.updateDetailPanel=MktSession.updateDetailPanel;MktSession.ajaxSuccess=function(request,reqParams){if(MktPage.debug){debugger;}
MktSession.request=request;var progressArea=$('msmProgressArea');if(isDOMElement(progressArea)){progressArea.innerHTML='';Element.hide(progressArea);}
var timing=request.getResponseHeader['X-Timing-Json'];if(timing){try{timing=eval('('+timing+')');MktSession.requestTimer(reqParams.url,timing);}catch(e){}}
var isPerformanceTest=isUndefined(reqParams.performanceTest)?false:true;if(isPerformanceTest){MktSession.processPerfTest(request,reqParams);return null;}
if(MktPage.isDev()){$('debugPopupContents').innerHTML+=request.responseText.escapeHTML()+"<hr /><br />";}
var parsedResults=MktSession.parseResults(request);if(!parsedResults.success){MktSession.unclockCursor();if(isFunction(this.onMyFailure)){if(this.onMyFailure(request,reqParams))return true;}
reqParams.ajaxResult='success';MktSession.ajaxShowError(request,parsedResults,reqParams);return null;}
var JSONResults=parsedResults.jsonObject.JSONResults;var HTMLResults=parsedResults.jsonObject.HTMLResults;for(var sx=0;sx<HTMLResults.sections.length;sx++){var id=HTMLResults.sections[sx];if(isDefined(MktSession.wellKnownDivs[id])){MktSession.updateDiv(HTMLResults[id],id,MktSession.wellKnownDivs[id],JSONResults,this);}else if(!(id.indexOf('scriptOnlyDummy')===0)&&!isFunction(this.onMySuccess)){alert("server supplied html for element id '"+id+"' but the id does not match known list");}}
if(isObject(JSONResults.exp)){if(isDefined(JSONResults.exp.generationTime)){console.debug('Explorer generated: ',JSONResults.exp.generationTime);}
MktExplorer.processJSONResults(JSONResults.exp,undefined,reqParams.url);}
if(isArray(JSONResults.tree)){for(var ix=0;ix<JSONResults.tree.length;ix++){var tree=JSONResults.tree[ix];try{var element=$(tree.containerId);element.treeJSON=tree.contents;}catch(e){alert("Error processing tree "+(ix+1)+" for container "+tree.containerId);}}}
if(isDefined(JSONResults.appvars)){Ext.apply(MktPage.appVars,JSONResults.appvars);}
if(isArray(JSONResults.actions)){for(ix=0;ix<JSONResults.actions.length;ix++){var thisAction=JSONResults.actions[ix];var action=thisAction;var parameters=[];if(isDefined(thisAction.action)){action=thisAction.action;}
if(isDefined(thisAction.parameters)){parameters=thisAction.parameters;}
if(isFunction(MktSession.wellKnownActions[action])){MktSession.wellKnownActions[action].apply(MktSession,parameters);}}}
if(isFunction(this.onMySuccess)){this.onMySuccess(parsedResults.jsonObject,this);}
if(isNonEmptyString(JSONResults.message)){MktSession.showMessage(JSONResults.message,JSONResults.messageLevel);}
var scripts=[];for(sx=0;sx<HTMLResults.sections.length;sx++){var sxId=HTMLResults.sections[sx];if((sxId.indexOf('scriptOnlyDummy')===0)||(isDefined(MktSession.wellKnownDivs[sxId]))){var theseScripts=HTMLResults[sxId].extractScripts();scripts=scripts.concat(theseScripts);}}
if(scripts.length>0){window.setTimeout(MktSession.evalScripts.bind(scripts),0);}
Mkt.cache.CacheManager.touchLastUpdateTime(/^session\.ajr\..+/);if(isDefined(reqParams.cacheRequest)&&reqParams.cacheRequest){var cacheKey='session.ajr.'+reqParams.url+'?'+Ext.urlEncode(reqParams.params);delete reqParams.cacheRequest;var extraConfig={};if(MktPage.sessTimeoutSecs>0){extraConfig.lifespan=MktPage.sessTimeoutSecs;}
Mkt.cache.CacheManager.set(cacheKey,{request:request,reqParams:reqParams},extraConfig);console.log("{ajaxSuccess} caching ajax response for key: "+cacheKey);}
return null;};MktSession.parseSymfonyException=function(responseText){if(responseText.indexOf('<title>symfony exception</title>')==-1){return'';}
var rtn='';var matches=responseText.match(/(?:<h1>)(.*?)(?:<\/h1>)/);if(matches&&matches.length>1){rtn+=matches[1];}
matches=responseText.match(/(?:<h2 id="message">)(.*?)(?:<\/h2>)/);if(matches&&matches.length>1){rtn+=' - '+matches[1];}
return rtn;};MktSession.runWellKnowActions=function(actions){if(isArray(actions)){for(ix=0;ix<actions.length;ix++){var thisAction=actions[ix];var action=thisAction;var parameters=[];if(isDefined(thisAction.action)){action=thisAction.action;}
if(isDefined(thisAction.parameters)){parameters=thisAction.parameters;}
if(isFunction(MktSession.wellKnownActions[action])){MktSession.wellKnownActions[action].apply(this,parameters);}}}};MktSession.evalScripts=function(){for(var ix=0;ix<this.length;ix++){eval(this[ix]);}};MktSession.ajaxFailure=function(request,reqParams){if(isFunction(this.onMyFailure)){if(this.onMyFailure(request,reqParams))return;}
if(MktPage.debug){debugger;}
MktSession.unclockCursor();reqParams.ajaxResult='failure';MktSession.ajaxShowError(request,null,reqParams);};MktSession.ajaxException=function(request,e,reqParams){if(isFunction(this.onMyFailure)){if(this.onMyFailure(request,reqParams))return;}
if(MktPage.debug){debugger;}
MktSession.unclockCursor();var results={success:false,errorType:'Ajax Exception: '+e,errorHTML:MktMessage.SYSTEM_ERROR_REFRESH,jsonObject:null};reqParams.ajaxResult='exception';MktSession.ajaxShowError(request,results,reqParams);};MktSession.ajaxShowError=function(request,parseResults,reqParams){console.debug("Response Error");console.debug("  request: ",request);console.debug("  parseResults: ",parseResults);console.debug("  reqParams: ",reqParams);var sfException='';if(request&&request.responseText){sfException=MktSession.parseSymfonyException(request.responseText);if(sfException){console.debug("  sfException: ",sfException);}}
MktSession.unclockCursor();MktSession.hideModalPleaseWait();var systemErrorMsg=MktMessage.SYSTEM_ERROR_REFRESH;if(reqParams&&reqParams.systemErrorMsg){systemErrorMsg=reqParams.systemErrorMsg;}
else if(parseResults&&parseResults.systemErrorMsg){systemErrorMsg=parseResults.systemErrorMsg;}
else{systemErrorMsg=MktMessage.SYSTEM_ERROR_REFRESH;}
var responseIsSuccess=((request.status>=200)&&(request.status<300));var html,parms,responseStr;if(responseIsSuccess){if((request.responseText.indexOf('<html')===0)||(request.responseText.indexOf('<!DOCTYPE')===0)||(request.responseText.indexOf('<br')!=-1)||(request.responseText.indexOf('<font')!=-1)||(request.responseText.indexOf('<body')!=-1)){html=request.responseText;if(html.indexOf('loginBox')!=-1){MktPage.isTimedout=true;Ext.History.suspendEvents();window.location.replace(MktSession.getUrlPrefix()+"/homepage/login?stat=3"+window.location.hash);return null;}}
else if(parseResults){html=parseResults.errorHTML;}}
else if(request.status===0){if(MktPage.showCommunicationFailureMessage){var lastHistoryItem=this.ajaxHistory[this.ajaxHistory.length-1];if(reqParams&&lastHistoryItem&&reqParams.date==lastHistoryItem.date){MktMessage.showSystemError(MktMessage.SYSTEM_ERROR_COMMUNICATION_FAILURE,{request:request,parseResults:parseResults,reqParams:reqParams,cleanResponseText:html});}}
return null;}
else if(request.status==403){var errorMessage;var errorTitle;var isXsrfMismatch=request.responseText&&request.responseText.indexOf("XSRF Protection Mismatch:")>0;if(isXsrfMismatch){errorMessage="This page&#39;s session has expired.<br/>Please refresh your browser.";errorTitle="Page Expired";}
if(reqParams&&reqParams.serializeParms&&reqParams.serializeParms.show403Canvas){MktCanvas.show403Forbidden(errorTitle,errorMessage);}
else{MktMessage.show403Forbidden(errorMessage);}
return null;}
else if(request.status>=400&&request.status<500){parms={response:request};if(isDefined(reqParams)){parms.reqOpt=reqParams;}
responseStr="Request/response dump: "+MktSession.dumpRequest(parms);MktSession.addAjaxErrors(responseStr);return null;}
else if(request.status==-1){console.debug(MktMessage.SYSTEM_ERROR_TIMEOUT);if(parseResults===null)parseResults={};MktSession.phoneHome({systemErrorMsg:MktMessage.SYSTEM_ERROR_TIMEOUT,request:request,parseResults:parseResults,reqParams:reqParams,cleanResponseText:html});return null;}
else if(request.status==500&&MktPage.isDev()){parms={response:request};if(isDefined(reqParams)){parms.reqOpt=reqParams;}
responseStr=MktSession.dumpRequest(parms);if(isUndefined(request.responseText)){html=responseStr;}
else if((request.responseText.indexOf('<html')===0)||(request.responseText.indexOf('<!DOCTYPE')===0)||(request.responseText.indexOf('<body')!=-1)){html=request.responseText;var bodyInner=html.substring(html.indexOf('<body>')+6,html.indexOf('</body>'));html=bodyInner+responseStr;}
else{html=request.responseText+responseStr;}}
else{var pass;}
MktMessage.showSystemError(systemErrorMsg,{request:request,parseResults:parseResults,sfException:sfException,reqParams:reqParams,cleanResponseText:html,showDebugInfo:MktPage.isDev()});MktSession.phoneHome({systemErrorMsg:systemErrorMsg,request:request,parseResults:parseResults,sfException:sfException,reqParams:reqParams,cleanResponseText:html});return null;};MktSession.phoneHomeSuccess=function(conn,response,options){console.debug('MktSession.phoneHomeSuccess',conn,response,options);};MktSession.phoneHomeFailure=function(conn,response,options){console.debug('MktSession.phoneHomeFailure',conn,response,options);if(!MktPage.isDev()&&MktPage.showCommunicationFailureMessage){MktMessage.showSystemError(MktMessage.SYSTEM_ERROR_COMMUNICATION_FAILURE);}};MktSession.phoneHome=function(context){console.debug('MktSession.phoneHome context=',context);try{var errorTime=new Date();var sessionLength=errorTime-MktPage.uiInitTime;var dump={Hostname:MktPage.savedState.clusterHostname,SymfonyException:context.sfException,SessionId:MktPage.savedState.sfSessionId,UserId:MktPage.userid,UserName:MktPage.userName,UserAgent:navigator.userAgent,UISessionLength:(sessionLength/60000).toFixed(2)+' min',SessionTimedOut:MktPage.isTimedOut?'yes':'no',DevMode:MktPage.isDev()?'yes':'no',TimeOfLogin:MktPage.uiInitTime.toString(),TimeOfError:errorTime.toString()};if(context.reqParams){dump.TimeOfRequest=context.reqParams.requestDate;var lastHistoryItem=this.ajaxHistory[this.ajaxHistory.length-1];if(context.reqParams&&lastHistoryItem&&context.reqParams.date==lastHistoryItem.date){dump.IsLastRequest='yes';}
else{dump.IsLastRequest='no';}
dump.URL=context.reqParams.url;try{dump.RequestParameters=Ext.util.JSON.encode(context.reqParams);}
catch(e){console.debug(e);}
dump.ajaxResult=context.reqParams.ajaxResult;}
if(context.request){dump.HTTPStatus=context.request.status+' ('+context.request.statusText+')';}
if(context.systemErrorMsg){dump.UIErrorMsg=context.systemErrorMsg;}
try{if(context.parseResults){dump.ErrorType=context.parseResults.errorType;dump.ErrorHTML=context.parseResults.errorHTML;}}
catch(e){console.debug(e);}
try{dump.AjaxHistory=Ext.util.JSON.encode(MktSession.ajaxHistory);}
catch(e){console.debug(e);}
try{dump.CanvasPanelConfig=Ext.util.JSON.encode(MktCanvas.getActiveTab().config);if(MktPage.appvars){dump.AppVars=Ext.util.JSON.encode(MktPage.appVars);}
if(MktPage.dlParams){dump.DeepLinkParams=MktPage.dlParams;}}
catch(e){console.debug(e);}
try{if(context.request){dump.responseText=context.cleanResponseText||context.request.responseText||'';}}
catch(e){console.debug(e);}
console.debug('MktSession.phoneHome dump=',dump);Ext.Ajax.request({url:MktSession.getUrlPrefix()+'/homepage/phoneHome',success:MktSession.phoneHomeSuccess,failure:MktSession.phoneHomeFailure,params:dump});}
catch(e){console.debug('MktSession.phoneHome caught exception',e,context);if(MktPage.isDev()){throw e;}}};MktSession.dumpRequest=function(obj){return obj;};MktSession.addAjaxErrors=function(log){MktViewport.unmask();var ajaxErrors=MktPage.ajaxErrors||"";MktPage.ajaxErrors=log+'\n---------------------------\n'+ajaxErrors;var ajaxErr=Ext.get('ajaxError');if(ajaxErr){ajaxErr.sequenceFx().fadeIn({endOpacity:0.9,duration:2}).fadeOut().fadeIn({endOpacity:0.9,duration:2}).fadeOut().fadeIn({endOpacity:1.0,duration:2});}};MktSession.showAjaxErrors=function(animEl){var fs=new Ext.form.FormPanel({baseCls:'x-plain',labelWidth:55,defaultType:'textfield',items:[{fieldLabel:'Send To',name:'to',value:'Marketo',readOnly:true,anchor:'100%'},{fieldLabel:'Subject',name:'subject',value:'Client side error logs',readOnly:true,anchor:'100%'},{xtype:'textarea',hideLabel:true,value:MktPage.ajaxErrors,name:'errMsg',anchor:'100% -53'}]});var errWindow=new Ext.Window({title:'Error Logs',width:500,height:300,minWidth:300,minHeight:200,layout:'fit',plain:true,modal:true,bodyStyle:'padding:5px;',buttonAlign:'center',style:'position: fixed;',items:fs});var submitBtn=errWindow.addButton({text:'Send',handler:function(){fs.getForm().submit({url:'custAdmin/sendMessage',waitMsg:'Sending error log...',method:'POST',success:function(){errWindow.close();},failure:function(form,action){if(isDefined(action.result.error)){var msg='There was a problem sending the error log to Marketo. Please try again. <br />If problem persists, email the body of the message to critalert@marketo.com';Ext.Msg.show({title:'Error Logs',msg:msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});}}});}});var cancelBtn=errWindow.addButton({text:'Cancel',disabled:false,handler:function(){errWindow.close();}});errWindow.show(animEl);};MktSession.clearDebugContents=function(){$('debugPopupContents').innerHTML='';};MktSession.hasCredential=function(credential){return MktPage.savedState&&MktPage.savedState.credentials.indexOf(credential)!=-1;};
/* ========== ../mkt-ext-2.0/main/nav.js ============ */

var MktMainNav={topTabId:'mktTopTabList',notAllowedMsg:'Limited Access',init:function(){var container=$(this.topTabId);if(container){var elts=container.getElementsByTagName("div");for(var i=0;i<elts.length;i++){var el=Ext.fly(elts[i]);el.on("click",this.click,elts[i]);}
getEl('mktTopTabWrap').show();}else{throw"MktMainNav.init did not find element "+this.topTabId;}
if(Ext.isIE){MktSession.removeLinkFocus(document);}
this.activeNav=null;},click:function(e){try{MktSession.clockCursor(true);MktCanvas.mask(null);var fn='load'+this.id.slice(2);MktMainNav[fn]({});}catch(e){MktPage.showException(e,"MktMainNav.click");}
return false;},commonPreLoad:function(newEl,context){var topNavTitle=this.getTopNavTitle(newEl);var alreadyThere=this.activeNav==newEl;if(!alreadyThere){if(!MktViewport.canvas.clearForLoad()){return false;}
var elts=$(this.topTabId).getElementsByTagName("div");for(var i=0;i<elts.length;i++){Ext.fly(elts[i]).removeClass('on');}
var el=Ext.get(newEl);if(el){el.addClass('on');}}
var wasProgram=this.activeNav=="tnMA";var isProgram=newEl=="tnMA";var wasLanding=this.activeNav=="tnLanding";var isLanding=newEl=="tnLanding";if(wasProgram&&!isProgram){MktSession.lastSelExpNode=null;}else if(wasLanding&&!isLanding){MktSession.lastSelLpgNode=null;}
this.activeNav=newEl;var title=topNavTitle+MktPage.titlePathSeparator+mktoBrandName;MktPage.baseTitle=title;MktPage.mktoBrandName=mktoBrandName;MktPage.topNavTitle=topNavTitle;var ajopts={};if(context!==null){if(isDefined(context.setActivePanel)){ajopts.setActivePanel=context.setActivePanel;}}
ajopts.show403Canvas=true;return ajopts;},getTopNavTitle:function(newEl){switch(newEl){case"tnHome":return"My Marketo";case"tnMA":return"Marketing Activities";case"tnLanding":return"Design Studio";case"tnLeadDb":return"Lead Database";case"tnAnalytics":return"Analytics";case"tnCustAdmin":return"Admin";default:return"Marketo";}
return'';},removeBookmark:function(compId,compType,nodeId){var ajopts={};ajopts.serializeParms={'compType':compType,'compId':compId,'nodeId':nodeId};MktSession.ajaxRequest('/homepage/removeBookmark',ajopts);},addToBookmark:function(compId,compType){var ajopts={};ajopts.serializeParms={'compType':compType,'compId':compId};MktSession.ajaxRequest('/homepage/addBookmark',ajopts);}};MktMainNav.loadHome=function(context){var ajopts=MktMainNav.commonPreLoad("tnHome",context);MktSession.lastSelExpNode=null;MktSession.lastSelWdlNode=null;MktExplorer.clear();MktExplorer.mask();if(isObject(context)){var parms={};if(isDefined(context.firstLoad)){parms.firstLoad=context.firstLoad;}
if(isDefined(context.panelIndex)){parms.panelIndex=context.panelIndex;}
ajopts.serializeParms=parms;}
if(!MktPage.satellite){ajopts.onMyFailure=MktMainNav.expFailureResponse.createDelegate(this);MktExplorer.loadTree('homepage/generateFullExplorer',ajopts);}
ajopts.cacheRequest=true;MktSession.ajaxRequest('homepage/homeCanvas',ajopts);};MktMainNav.loadPE=function(context){var alreadyInMA=MktMainNav.activeNav=="tnMA";var ajopts=MktMainNav.commonPreLoad("tnMA",context);if(MktPage.initNav=='yes'){if(!alreadyInMA){MktExplorer.clear();MktExplorer.mask();var parms={};if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(!MktPage.satellite){MktSession.ajaxRequest('explorer/generateFullMaExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}}
MktCanvas.clearForLoad();if(isDefined(context.panelId)){context.programId=context.panelId;}
if(isDefined(context.compId)){context.programId=context.compId;}
ajopts=MktMainNav.commonPreLoad("tnMA",context);if(isDefined(context.panelIndex)){ajopts.panelIndex=context.panelIndex;}
if(!isDefined(context.programId)){if(isUndefined(ajopts.serializeParms)){ajopts.serializeParms={};}
if(isDefined(context.folderId)){ajopts.serializeParms.compId=context.folderId;}
ajopts.serializeParms.show403Canvas=true;ajopts.cacheRequest=true;MktSession.ajaxRequest('explorer/programCanvas',ajopts);}else{context.show403Canvas=true;ajopts.serializeParms=context;MktSession.ajaxRequest('explorer/showProgram',ajopts);}};MktMainNav.loadSmartCampaign=function(context){MktCanvas.clearForLoad();var ajopts=MktMainNav.commonPreLoad("tnMA",context);var parms={};parms.show403Canvas=true;ajopts.serializeParms=parms;if(isDefined(context.compId)){context.smartCampaignId=context.compId;}
if(isDefined(context.panelIndex)){parms.panelIndex=context.panelIndex;}
MktSession.clockCursor(true);if(isDefined(context.smartCampaignId)){parms.smartCampaignId=context.smartCampaignId;if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(isDefined(context.panelId)){parms.panelId=context.panelId;}
MktSession.ajaxRequest('smartcampaigns/showCampaign',ajopts);}else{MktSession.ajaxRequest('explorer/programCanvas',ajopts);}};MktMainNav.loadMarketingEvent=function(context){MktCanvas.clearForLoad();var topNav="tnMA";var alreadyInMA=MktMainNav.activeNav==topNav;var ajopts=MktMainNav.commonPreLoad(topNav,context);var parms={};parms.show403Canvas=true;ajopts.serializeParms=parms;MktSession.clockCursor(true);if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(isDefined(context.compId)){parms.compId=context.compId;}
if(isDefined(context.panelIndex)){parms.panelIndex=context.panelIndex;}
if(!alreadyInMA){MktExplorer.clear();MktExplorer.mask();parms=context;if(!MktPage.satellite){MktExplorer.loadTree('explorer/generateFullMaExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}
if(Mkt.cache.CacheManager.containsValid(Mkt.apps.marketingEvent.colModelCacheKey)){colLayoutTimeKey=Mkt.cache.CacheManager.getValue(Mkt.apps.marketingEvent.colModelCacheKey).colLayoutTimeKey;Ext.apply(ajopts.serializeParms,{colLayoutTimeKey:colLayoutTimeKey});}
MktSession.ajaxRequest('marketingEvent/showMarketingEvent',ajopts);}
MktMainNav.loadMarketingProgram=function(context){MktCanvas.clearForLoad();var topNav="tnMA";var alreadyInMA=MktMainNav.activeNav==topNav;var ajopts=MktMainNav.commonPreLoad(topNav,context);var parms={};parms.show403Canvas=true;ajopts.serializeParms=parms;MktSession.clockCursor(true);if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(isDefined(context.compId)){parms.compId=context.compId;}
if(isDefined(context.panelIndex)){parms.panelIndex=context.panelIndex;}
if(!alreadyInMA){MktExplorer.clear();MktExplorer.mask();parms=context;if(!MktPage.satellite){MktExplorer.loadTree('explorer/generateFullMaExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}
if(Mkt.cache.CacheManager.containsValid(Mkt.apps.marketingEvent.colModelCacheKey)){colLayoutTimeKey=Mkt.cache.CacheManager.getValue(Mkt.apps.marketingEvent.colModelCacheKey).colLayoutTimeKey;Ext.apply(ajopts.serializeParms,{colLayoutTimeKey:colLayoutTimeKey});}
MktSession.ajaxRequest('marketingEvent/showMarketingProgram',ajopts);}
MktMainNav.loadMA=function(context){var alreadyInMA=MktMainNav.activeNav=="tnMA";var ajopts=MktMainNav.commonPreLoad("tnMA",context);if(MktPage.initNav=='yes'){if(!alreadyInMA){MktExplorer.clear();MktExplorer.mask();var parms=context;if(!MktPage.satellite){MktExplorer.loadTree('explorer/generateFullMaExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}
var parms={};ajopts.serializeParms=parms;if(isDefined(context.panelIndex)){parms.panelIndex=context.panelIndex;}
if((context.compSubtype=="marketingfolder"||context.compType=="Marketing Folder")||context.subType=="marketingfolder"){MktMainNav.loadPE(context);}else if((context.compSubtype=="smartcampaign")||(context.subType=="smartcampaign")||(context.compType=="Smart Campaign")){MktMainNav.loadSmartCampaign(context);}else if((context.compSubtype=="marketingevent")||(context.subType=="marketingevent")||(context.compType=="Marketing Event")){MktMainNav.loadMarketingEvent(context);}else if((context.compSubtype=="marketingprogram")||(context.subType=="marketingprogram")||(context.compType=="Marketing Program")){MktMainNav.loadMarketingProgram(context);}else if(context.nodeType=='Flow'){MktMainNav.loadFlow();}else{if(isUndefined(context.nodeId)&&isUndefined(context.selectedNode)){var pass;}
ajopts.cacheRequest=true;MktSession.ajaxRequest('explorer/programCanvas',ajopts);}}};MktMainNav.loadFlow=function(context){console.log('Load the flow here');};MktMainNav.loadLead=function(context){var leadId=context.leadId||context.compId;if(leadId){window.location=MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+leadId;}else{if(!MktMainNav.activeNav){MktMainNav.loadHome(context);}}};MktMainNav.loadLeadDb=function(context){console.debug('MktMainNav.loadLeadDb',context);var alreadyInLDB=MktMainNav.activeNav=="tnLeadDb";var alreadyInMA=(MktMainNav.activeNav=="tnMA");var marketingProgramId;if(context.marketingProgramId){marketingProgramId=context.marketingProgramId;}
if(context.panelIndex==('X'.charCodeAt()-'A'.charCodeAt())){context.panelIndex=0;context.compType='Smart List';context.compSubtype='Smart Campaign';}
var ajopts;if(marketingProgramId){ajopts=MktMainNav.commonPreLoad("tnMA",context);}
else{ajopts=MktMainNav.commonPreLoad("tnLeadDb",context);}
if(!isDefined(ajopts.params)){ajopts.params={};}
var parms,colLayoutTimeKey;if((alreadyInMA&&marketingProgramId)||(alreadyInLDB&&!marketingProgramId)){context.show403Canvas=true;if(hasValue(context.dlZoneFolderId)){context.compId=context.dlZonefolderId;ajopts.serializeParms=context;ajopts.cacheRequest=true;MktSession.ajaxRequest('leadDatabase/showLeadsOverview',ajopts);}
else if(hasValue(context.compId)||hasValue(context.smListId)){MktCanvas.clearForLoad();ajopts.serializeParms=context;if(Mkt.cache.CacheManager.containsValid(MktLeadDb.colModelCacheKey)){colLayoutTimeKey=Mkt.cache.CacheManager.getValue(MktLeadDb.colModelCacheKey).colLayoutTimeKey;Ext.apply(ajopts.params,{colLayoutTimeKey:colLayoutTimeKey});}
if(marketingProgramId){ajopts.params.marketingProgramId=marketingProgramId;}
MktSession.ajaxRequest('leadDatabase/showCanvas',ajopts);}
else if(context.setActivePanel){var panel='ldbCanvasLeadDetail';if(hasValue(context.setActivePanel))panel=context.setActivePanel;if(MktPage.canvasContext[panel]!==null){MktPage.activatePanel(panel);}}
else{if(isDefined(context.folderId)){context.compId=context.folderId;}else{var pass;}
ajopts.serializeParms=context;ajopts.cacheRequest=true;MktSession.ajaxRequest('leadDatabase/showLeadsOverview',ajopts);}}
else{if(MktPage.initNav=='yes'){MktExplorer.clear();MktExplorer.mask();parms={};if(hasValue(context.nodeId)){parms.nodeId=context.nodeId;}
parms.show403Canvas=true;ajopts.serializeParms=parms;if(hasValue(context.dlZoneFolderId)){context.compId=context.dlZonefolderId;ajopts.serializeParms=context;ajopts.cacheRequest=true;MktSession.ajaxRequest('leadDatabase/showLeadsOverview',ajopts);}
else if(hasValue(context.compId)||hasValue(context.smListId&&context.dlCompCode!='ZN')){if(hasValue(context.panelId)){parms.panelId=context.panelId;}
if(hasValue(context.compType)){parms.compType=context.compType;}
if(hasValue(context.subType)){parms.subType=context.subType;}
if(hasValue(context.compSubtype)){parms.compSubtype=context.compSubtype;}
if(hasValue(context.query)){parms.query=context.query;}
if(hasValue(context.smListId)){parms.smListId=context.smListId;}
if(hasValue(context.compId)){parms.compId=context.compId;}
if(hasValue(context.panelIndex)){parms.panelIndex=context.panelIndex;}
if(hasValue(context.marketingProgramId)){parms.marketingProgramId=context.marketingProgramId;}
if(Mkt.cache.CacheManager.containsValid(MktLeadDb.colModelCacheKey)){colLayoutTimeKey=Mkt.cache.CacheManager.getValue(MktLeadDb.colModelCacheKey).colLayoutTimeKey;Ext.apply(ajopts.params,{colLayoutTimeKey:colLayoutTimeKey});}
MktSession.ajaxRequest('leadDatabase/showCanvas',ajopts);}else{if(isDefined(context.folderId)){parms.compId=context.folderId;}else{var pass2;}
ajopts.cacheRequest=true;MktSession.ajaxRequest('leadDatabase/showLeadsOverview',ajopts);}
if(!MktPage.satellite){ajopts.onMyFailure=MktMainNav.expFailureResponse.createDelegate(this);delete ajopts.cacheRequest;if(!marketingProgramId){MktExplorer.loadTree('leadDatabase/generateFullExplorer',ajopts);}
else{MktExplorer.loadTree('explorer/generateFullMaExplorer',ajopts);}}}}};MktMainNav.loadDataMgr=function(context){var alreadyIn=(MktMainNav.activeNav=="tnLeadDb");MktCanvas.clearForLoad();var ajopts=MktMainNav.commonPreLoad("tnLeadDb",context);var parms={};parms.compId=context.compId;parms.panelIndex=context.panelIndex;parms.compType='Data Mgr';ajopts.serializeParms=parms;MktSession.ajaxRequest('dataMgr/showDataMgrSummary',ajopts);if(!alreadyIn){MktExplorer.loadTree('leadDatabase/generateFullExplorer',ajopts);}};MktMainNav.loadAnalytics=function(context){console.debug('MktMainNav.loadAnalytics',context);var forceReload=isDefined(context.forceReload)&&context.forceReload;var alreadyIn=(MktMainNav.activeNav=="tnAnalytics")&&!forceReload;var ajopts=MktMainNav.commonPreLoad("tnAnalytics",context);context.show403Canvas=true;ajopts.serializeParms=context;if(isDefined(context.folderId)){ajopts.serializeParms.compId=context.folderId;}
ajopts.cacheRequest=true;MktSession.ajaxRequest('analytics/showAnalyticsOverview',ajopts);MktMainNav.loadAnalyticsExplorer(context,alreadyIn);};MktMainNav.loadAnalyticsReport=function(context){console.debug("MktMainNav.loadAnalyticsReports",context);MktCanvas.clearForLoad();if(!isDefined(context.nodeId)&&!isDefined(context.compId)&&!isDefined(context.reportId)){MktMainNav.loadAnalytics(context);return;}
var forceReload=isDefined(context.forceReload)&&context.forceReload;var alreadyIn=(MktMainNav.activeNav=="tnAnalytics")&&!forceReload;var ajopts=MktMainNav.commonPreLoad("tnAnalytics",context);context.show403Canvas=true;ajopts.serializeParms=context;MktSession.ajaxRequest('analytics/showReport',ajopts);MktMainNav.loadAnalyticsExplorer(context,alreadyIn);};MktMainNav.loadAnalyticsExplorer=function(context,alreadyIn){console.debug('loadAnalyticsExplorer',context,MktPage.satellite,alreadyIn);if(!MktPage.satellite&&!alreadyIn){MktExplorer.clear();MktExplorer.mask();var parms={};if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(isDefined(context.compId)){parms.compId=context.compId;}
if(!MktPage.satellite){MktExplorer.loadTree('analytics/generateFullExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}};MktMainNav.loadRCMHome=function(context){console.debug("MktMainNav.loadRCMHome",context);var forceReload=isDefined(context.forceReload)&&context.forceReload;var alreadyIn=(MktMainNav.activeNav=="tnAnalytics")&&!forceReload;var ajopts=MktMainNav.commonPreLoad("tnAnalytics",context);var parms={};if(context.isDraftNode){parms.isDraftNode=context.isDraftNode;}
ajopts.serializeParms=parms;MktSession.ajaxRequest('rcm/showRcmHome',ajopts);MktMainNav.loadAnalyticsExplorer(context,alreadyIn);};MktMainNav.loadRCM=function(context){MktCanvas.clearForLoad();console.debug("MktMainNav.loadRCM",context);var forceReload=isDefined(context.forceReload)&&context.forceReload;var alreadyIn=(MktMainNav.activeNav=="tnAnalytics")&&!forceReload;var ajopts=MktMainNav.commonPreLoad("tnAnalytics",context);ajopts.serializeParms=context;ajopts.serializeParms.approved=(window.location.search.indexOf('approved=true')!=-1)?true:false;ajopts.serializeParms.preview=(window.location.search.indexOf('preview=true')!=-1)?true:false;MktSession.ajaxRequest('rcm/showRcm',ajopts);MktMainNav.loadAnalyticsExplorer(context,alreadyIn);};MktMainNav.loadRCMTransition=function(context){console.debug("MktMainNav.loadRCMTransition",context);var ajopts={};ajopts.serializeParms=context;MktSession.ajaxRequest('rcm/showTransition',ajopts);};MktMainNav.expFailureResponse=function(request,reqParams){if(request.status==403){MktExplorer.showMessage(this.notAllowedMsg);return true;}};MktMainNav.loadLanding=function(context){var accessZoneId;var folderId;var tab;var type;var contextAccessZoneId;var cacheRequest=false;var marketingProgramId=context.marketingProgramId;var forceReload=isDefined(context.forceReload)&&context.forceReload;var alreadyInLPG=(MktMainNav.activeNav=="tnLanding")&&!forceReload;var alreadyInMA=(MktMainNav.activeNav=="tnMA")&&!forceReload;if(marketingProgramId){parms=MktMainNav.commonPreLoad("tnMA",context);}
else{MktMainNav.commonPreLoad("tnLanding",context);}
if(isDefined(context.subType)){context.lpgType=context.subType;}
if(isDefined(context.compId)&&isUndefined(context.lpgId)){context.lpgId=context.compId;}
if(isDefined(context.folderId)){folderId=context.folderId;}
if(isDefined(context.lpgType)){type=MktMainNav.getLegacyDSType(context.lpgType);}
if(isDefined(context.compType)&&context.compType=="Landing Page Test Group"){type='test';}
if(alreadyInLPG){var sid=context.lpgId||context.id||null;if(!sid){sid=null;}
if(isDefined(type)&&sid){if(type=='page'||type=='test'){tab=MktCanvas.getItem(MktCanvas.getTab('landingCanvasLP'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktLandingManager.prototype.showDetailPanel(sid,'page',context.isDraftNode,tab.config.accessZoneId);}else{MktCanvas.setActiveTab(MktCanvas.getTab('landingCanvasLP'));}
return;}}else if(type=='form'){tab=MktCanvas.getItem(MktCanvas.getTab('landingCanvasFO'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktLandingManager.prototype.showDetailPanel(sid,'form',context.isDraftNode,tab.config.accessZoneId);}else{MktCanvas.setActiveTab(MktCanvas.getTab('landingCanvasFO'));}
return;}}else if(type=='image'){tab=MktCanvas.getItem(MktCanvas.getTab('landingCanvasIM'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktLandingManager.prototype.showDetailPanel(sid,'image',false);}else{MktCanvas.setActiveTab(MktCanvas.getTab('landingCanvasIM'));}
return;}}else if(type=='template'){tab=MktCanvas.getItem(MktCanvas.getTab('landingCanvasTM'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktLandingManager.prototype.showDetailPanel(sid,'template',context.isDraftNode,tab.config.accessZoneId);}else{MktCanvas.setActiveTab(MktCanvas.getTab('landingCanvasTM'));}
return;}}else if(type=='emailTemplate'){tab=MktCanvas.getItem(MktCanvas.getTab('emailTemplates'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktEmManager.showTemplateDetailPanel(sid,context.isDraftNode,undefined,tab.config.accessZoneId);}else{MktCanvas.setActiveTab(MktCanvas.getTab('emailTemplates'));}
return;}}else if(type=='email'){tab=MktCanvas.getItem(MktCanvas.getTab('landingCanvasEM'));if(isDefined(tab)&&(tab.config.accessZoneId==context.accessZoneId||isUndefined(context.accessZoneId))){if(sid){mktEmManager.showDetailPanel(sid,context.isDraftNode,undefined,tab.config.accessZoneId);}else{MktCanvas.setActiveTab(MktCanvas.getTab('landingCanvasEM'));}
return;}}}}
if(!forceReload){MktViewport.canvas.clearForLoad();}
var parms={};if(!(alreadyInMA^alreadyInLPG)||(!marketingProgramId&&!alreadyInLPG)||(marketingProgramId&&!alreadyInMA)){MktExplorer.clear();MktExplorer.mask();parms=context;}
if(!MktPage.satellite){if(marketingProgramId&&!alreadyInMA){MktExplorer.loadTree('explorer/generateFullMaExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}
else if(!alreadyInLPG){MktExplorer.loadTree('landingPage/generateFullExplorer',{serializeParms:parms,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}
var module='landingPage';var runAction;if(isUndefined(type)||isNull(type)){runAction='allCreativeOverview';cacheRequest=true;}else{if(type=='email'||type=='emailTemplate'){module='email';}
runAction=type+'Overview';}
if(isDefined(context.lpgId)){parms.lpgId=context.lpgId;}else if(isDefined(context.xtra)&&isDefined(context.xtra.compId)){parms.lpgId=context.xtra.compId;}
if((isUndefined(parms.lpgId)||!parms.lpgId)&&isDefined(context.dlZoneFolderId)){delete parms.lpgId;parms.compId=context.dlZoneFolderId;}else if(isUndefined(context.compId)&&isDefined(context.folderId)){parms.compId=context.folderId;}
if(isDefined(context.panelId)){parms.panelId=context.panelId;}
if(isDefined(context.isDraftNode)){parms.isDraftNode=context.isDraftNode;}
parms.show403Canvas=true;parms.marketingProgramId=marketingProgramId;MktSession.ajaxRequest(module+'/'+runAction,{serializeParms:parms,cacheRequest:cacheRequest});};MktMainNav.getLegacyDSType=function(type){if(type=='page'||type=='test'||type=="Landing Page"||type=='testpage'||type=="Landing Page Test Group"){type='page';}else if(type=='form'||type=="Landing Page Form"){type='form';}else if(type=='image'||type=='Image'){type='image';}else if(type=='template'||type=='Landing Page Template'){type='template';}else if(type=='emailTemplate'||type=='Email Template'){type='emailTemplate';}else if(type=='email'||type=='Email'){type='email';}
return type;};MktMainNav.loadSysAdmin=function(context){var alreadyInAdmin=(MktMainNav.activeNav=="tnCustAdmin");var ajopts=MktMainNav.commonPreLoad("tnCustAdmin",context);if(isDefined(context.nodeId)){MktExplorer.selectNode(context.nodeId);}
MktSession.ajaxRequest('administrator/adminCanvas',ajopts);if(!alreadyInAdmin){var params={};if(isDefined(context.nodeId)){params.nodeId=context.nodeId;}
if(!MktPage.satellite){MktSession.ajaxRequest('custAdmin/generateFullExplorer',{serializeParms:params,onMySuccess:MktMainNav.loadCustAdminExplorerDone,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}};MktMainNav.loadCustAdmin=function(context){var alreadyInAdmin=(MktMainNav.activeNav=="tnCustAdmin");var ajopts=MktMainNav.commonPreLoad("tnCustAdmin",context);var hasLoadFunction=false;var url="";if(isDefined(context.compSubtype)){url='custAdmin/'+context.compSubtype+'Canvas';hasLoadFunction=(isFunction(MktMainNav['load'+MktUtil.camelCase(context.compSubtype)]));}else{url='custAdmin/homeCanvas';}
if(isDefined(context.nodeId)){MktExplorer.selectNode(context.nodeId);}
if(alreadyInAdmin){var panel=null;if(isDefined(context.activatePanel)){panel=context.activatePanel;}
if(MktPage.canvasContext[panel]){MktPage.activatePanel(panel);return;}
var parms={};if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(isDefined(context.panelId)){parms.panelId=context.panelId;}
if(isDefined(context.compSubtype)){parms.compSubtype=context.compSubtype;}
ajopts.serializeParms=parms;}
else{MktExplorer.clear();MktExplorer.mask();var params={};if(isDefined(context.nodeId)){params.nodeId=context.nodeId;}
if(!MktPage.satellite){MktExplorer.loadTree('custAdmin/generateFullExplorer',{serializeParms:params,onMySuccess:MktMainNav.loadCustAdminExplorerDone,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}
parms={};if(isDefined(context.panelId)){parms.panelId=context.panelId;}
ajopts.serializeParms=parms;}
if(hasLoadFunction){var subType=MktUtil.camelCase(context.compSubtype);if(isFunction(MktMainNav['load'+subType])){MktMainNav['load'+subType](context);return;}}else{MktSession.ajaxRequest(url,ajopts);}};MktMainNav.loadWebinarPartner=function(){var parms={};MktSession.ajaxRequest('marketingEvent/adminHome',{serializeParms:parms});};MktMainNav.loadDescriptors=function()
{var parms={};MktSession.ajaxRequest('marketingEvent/descriptors',{serializeParms:parms});};MktMainNav.loadCustAdminExplorerDone=function(){MktExplorer.onTree('cadAccSettings','click',function(node,e){MktCanvas.clearForLoad();if(isUndefined(node.attributes.xtra)){return true;}
var nodeXtra=node.attributes.xtra;if(isDefined(nodeXtra.type)){MktMainNav.loadCustAdmin(nodeXtra);}
e.stopEvent();return true;});MktExplorer.onTree('cadAccSettings','contextmenu',function(node,e){e.stopEvent();});MktExplorer.onTree('cadAccSettings','beforeclick',function(node,e){var attr=node.attributes;if(attr&&attr.disableClick){return false;}
return true;});};MktMainNav.loadSchemaHome=function(context){var alreadyInAdmin=(MktMainNav.activeNav=="tnCustAdmin");var ajopts=MktMainNav.commonPreLoad("tnCustAdmin",context);if(isDefined(context.nodeId)){MktExplorer.selectNode(context.nodeId);}
var parms={};if(isDefined(context.panelId)){parms.panelId=context.panelId;}
if(isDefined(context.populateMapping)){parms.populateMapping=context.populateMapping;}
MktSession.ajaxRequest('fieldManagement/schemaHome',{serializeParms:parms});if(!alreadyInAdmin){var params={};if(isDefined(context.nodeId)){params.nodeId=context.nodeId;}
if(!MktPage.satellite){MktSession.ajaxRequest('custAdmin/generateFullExplorer',{serializeParms:params,onMySuccess:MktMainNav.loadCustAdminExplorerDone,onMyFailure:MktMainNav.expFailureResponse.createDelegate(this)});}}};MktMainNav.loadIntegration=function(context){var parms={};var url="";if(isDefined(context.panelId)){parms.panelId=context.panelId;}
if(isDefined(context.nodeId)){parms.nodeId=context.nodeId;}
if(context.panelIndex!==undefined){parms.panelIndex=context.panelIndex;}
if(isDefined(context.panelId)){var panelId=context.panelId;if(MktPage.canvasContext[panelId]){MktPage.activatePanel(panelId);return;}
parms.panelId=panelId;switch(panelId){case'cadSfdcSettings':case'cadSfdcSystemErrorLog':case'cadSfdcProgressLogs':case'cadSfdcObjectSync':url='salesforce/settingsDetail';break;case'cadLpSettings':url='accounts/settingsCanvas';break;default:console.log('Unknown integration settings panelId');break;}}
else{url='accounts/settingsCanvas';}
if(url){MktSession.ajaxRequest(url,{serializeParms:parms});}};MktMainNav.loadEmailSettings=function(context){var parms={};if(isDefined(context.panelId)){parms.panelId=context.panelId;}
MktSession.ajaxRequest('email/settingsCanvas',{serializeParms:parms});};MktMainNav.loadZone=function(context){if(context.dlCompTypeCode){var dlCodeObj=MktDlManager.getDlCodeMap(context.dlCompTypeCode);if(context.dlCompCode=='ZN'){dlCodeObj.compId=context.compId;}
MktDlManager.loadDl(dlCodeObj);}};MktMainNav.loadJigsaw=function()
{MktSession.ajaxRequest('jigsaw/adminCanvas',{serializeParms:{}});};MktMainNav.convertLegacyNav=function(obj){var legacyNav=Ext.apply({},obj);obj.xtra={};return Ext.apply(obj.xtra,obj);};MktMainNav.markSelection=function(compId){MktExplorer.defaultFolderID=compId;MktExplorer.selectNodeById(MktExplorer.defaultFolderID);};
/* ========== ../mkt-ext-2.0/widgets/Checkbox ============ */

Ext.ns("Mkt","Mkt.widgets");Mkt.widgets.Checkbox=Ext.extend(Ext.form.Checkbox,{onClick:function(e){Mkt.widgets.Checkbox.superclass.onClick.apply(this,arguments);this.fireEvent("click",this,e);}});
/* ========== ../mkt-ext-2.0/widgets/MktPanel.js ============ */

Ext.namespace("MktPanel");MktPanel._CanvasResizableBase={canvas:0,fitToCanvas:true,reservedHeight:90,reservedWidth:0,initCanvasEvents:function(){if(isUndefined(this.myPanelId)){this.myPanelId=MktPage.activePanel.cName;}
this.initCanvasResizeEvents();this.syncHeightToCanvas();},initCanvasResizeEvents:function(){if(!this.fitToCanvas)return;MktPage.eventMgr.on('canvasresizedone',this.canvasResized,this,true);MktPage.eventMgr.on('panelactivate',this.panelActivated,this,true);MktPage.canvasCleanupStack.push(this.canvasCleanup.createDelegate(this));},syncHeightToCanvas:function(){if(!this.fitToCanvas)return;var width=MktViewport.canvas.getWidth()-this.reservedWidth;var height=MktViewport.canvas.getHeight()-this.reservedHeight-52;this.setHeight(height);this.setWidth(width);this.syncSize();if(this.items&&this.items.items){for(var i=0;i<this.items.getCount();i++){var item=this.items.items[i];try{if(item&&item.syncHeightToCanvas){item.syncHeightToCanvas();}}catch(e){}}}},panelActivated:function(panel){if(this.myPanelId==panel.cName){if(this.reRenderOnShow){this.syncHeightToCanvas();this.syncSize();this.reRenderOnShow=false;}}},canvasResized:function(){var showingPanel=MktPage.activePanel.cName;if(showingPanel==this.myPanelId){this.syncHeightToCanvas();this.syncSize();}else{this.reRenderOnShow=true;}},canvasCleanup:function(){try{MktPage.eventMgr.removeListener('canvasresizedone',this.canvasResized,this);MktPage.eventMgr.removeListener('panelactivate',this.panelActivated,this);this.destroy();}
catch(e){}}};MktPanel.CanvasResizablePanel=Ext.extend(Ext.Panel,MktPanel._CanvasResizableBase);MktPanel.CanvasResizablePanel.prototype.initEvents=function(){MktPanel.CanvasResizablePanel.superclass.initEvents.call(this);this.initCanvasEvents();};MktPanel.CanvasResizableTabPanel=Ext.extend(Ext.TabPanel,MktPanel._CanvasResizableBase);MktPanel.CanvasResizableTabPanel.prototype.initEvents=function(){MktPanel.CanvasResizableTabPanel.superclass.initEvents.call(this);this.initCanvasEvents();};MktPanel.AutoSizeChartPanel=Ext.extend(Ext.Panel,{chartId:'the id of the chart property in Mkt.apps.charts',chartEl:'the id of a DOM element that contains your chart',widthSelector:'chartAutoWidth',heightSelector:'chartAutoHeight',reservedWidth:40,reservedHeight:65,html:'',unloadHTML:'',unloadOnTabDeactivate:true,autoloadToolbar:true,chartLoaded:false,chartActive:false,loadChart:function(){if(this.chartLoaded){return;}
var chartDiv=Ext.get(this.chartEl);var html=''+chartDiv.dom.innerHTML;var parentEl=this.getEl().dom.parentNode;var newWidth=parentEl.clientWidth-this.reservedWidth;var newHeight=parentEl.clientHeight-this.reservedHeight;var swf=Ext.get('swf_'+this.chartId);if(swf){for(var i=0;i<swf.dom.childNodes.length;i++){var swfParam=swf.dom.childNodes[i];if(swfParam.nodeName=='PARAM'&&swfParam.name=='FlashVars'){html=html.replace(new RegExp('PARAM NAME="FlashVars" VALUE=""','i'),'PARAM NAME="FlashVars" VALUE="'+swfParam.value+'"');break;}}}
html=html.replace(new RegExp(''+this.widthSelector,'g'),''+newWidth);html=html.replace(new RegExp(''+this.heightSelector,'g'),''+newHeight);this.body.update(html);this.chartLoaded=true;if(this.autoloadToolbar&&this.chartId){Mkt.apps.charts[this.chartId].renderBottomToolbar();}},unloadChart:function(){if(this.unloadOnTabDeactivate){this.body.update(this.unloadHTML);this.chartLoaded=false;}},listeners:{activate:function(){this.chartActive=true;if(this.ownerCt.items.length>1){this.loadChart();}},deactivate:function(){this.chartActive=false;this.unloadChart();}},syncHeightToCanvas:function(){if(this.chartActive){this.chartLoaded=false;this.loadChart();}
else{this.chartLoaded=false;}}});
/* ========== ../mkt-ext-2.0/util/Format.js ============ */

Ext.ns('Mkt.util');Mkt.util.Format=function(){return Ext.apply(Ext.util.Format,{longDateTimeFormat:'F j, Y, g:i A',longDateTimeShortMonthFormat:'M j, Y, g:i A',longDateShortMonthFormat:'M j, Y',longDateFormat:'F j, Y',shortDateFormat:'Y-m-d',usedByRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!record){return val;}
var usedBy=record.get('usedBy');if(!usedBy){return'';}
var buff="";for(var i=0;i<usedBy.length;i++){if(i>=2){buff=buff+', ( '+(usedBy.length-i)+' more)';break;}
if(buff.length>0){buff+=', ';}
if(hasValue(usedBy[i]['lpName'])){buff+=usedBy[i]['lpName'];}else if(hasValue(usedBy[i]['compName'])){buff+=usedBy[i]['compName'];}}
return buff;},emailRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){return'<a href="mailto:'+val+'" class="mktGridLink">'+val+'</a>';}
else{return'';}},urlRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){var url=val;if(url.indexOf('http')!==0){url='http://'+url;}
return'<a href="'+url+'" target="_blank" class="mktGridLink">'+val+'</a>';}
else{return'';}},influenceNumberRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){if(val==0){return val;}
var column=meta.id;var leadId=record.id;return'<a href="leadDatabase/createSocialInfluenceList?lead='+leadId+'&column='+column+'&leads='+val+'" class="mktGridLink" target="_blank">'+val+'</a>';}
else{return'';}},adminRenderer:function(val,meta,record,rowIndex,colIndex,store){if(val){return'<div class="mki16-grid-cell mkiKey"></div>';}},userStatusRenderer:function(val,meta,record,rowIndex,colIndex,store){var iconCls='';if(val&0x1){iconCls=' mkiGhost';}
else if(val&0x2){iconCls=' mkiKey';}
else if(val&0x4){iconCls=' mkiUser';}
else if(val&0x8){iconCls=' mkiUser x-item-disabled';}
else if(val&0x10){iconCls='';}
if(val&0x20){iconCls='mktLockedUser';}
return'<div class="mki16-grid-cell '+iconCls+'"></div>';},pageTypeRenderer:function(val,meta,record,rowIndex,colIndex,store){return'<div class="mki16-grid-cell '+(val?'mkiCustAbtest':'mkiWebpage')+'"></div>';},testPageTypeRenderer:function(val,meta,record,rowIndex,colIndex,store){if(val){return'<div class="mki16-grid-cell '+(val?'mkiCustAbtest':'mkiWebpage')+'"></div>';}
return'';},documentStatusRenderer:function(val,meta,record,rowIndex,colIndex,store){var icon='';if(val==1||val=='p'){icon=' mkiOk';}else if(val==2||val=='w'){icon=' mkiSignWarning';}
return'<div class="mki16-grid-cell'+icon+'"></div>';},rateRenderer:function(val,meta,record,rowIndex,colIndex,store){if(isDefined(val)&&val){return val.toFixed(1)+'%';}else{return'';}},percentRenderer:function(val,meta,record,rowIndex,colIndex,store){if(isDefined(val)&&val){return(100.0*val).toFixed(1)+'%';}else{return'';}},currencyRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){return MktFormat.formatCurrency(val);}
else{return'';}},floatRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)&&val){return MktFormat.formatFloat(val,false);}
else{return'';}},enabledRenderer:function(val,meta,record,rowIndex,colIndex,store){if(isDefined(val)){if(val===true){return'Enabled';}
else{return'Disabled';}}
else{return'';}},makeBigNumberPretty:function(num){var ret=num;if(isNumber(num)){ret+="";var buff="",len=0;do{len=(ret.length>3?ret.length-3:0);buff=ret.slice(len)+(buff.length?",":"")+buff;ret=ret.slice(0,len);}while(ret.length);ret=buff;}
return ret;},listToSentence:function(list){var sentence=list;if(isArray(list)&&list.length>0){var buff=list;if(list.length>1){var last=list[list.length-2]+" and "+list[list.length-1];buff=buff.slice(0,list.length-2);buff.push(last);}
sentence=buff.join(', ');}
return sentence;},listToSentenceEllipsis:function(list,delimiter,maxLength,valueProp){var formattedValue='';maxLength=maxLength||999999;delimiter=delimiter||', ';var listSuffix='';if(list.length>maxLength){listSuffix=delimiter+'...';list=list.slice(0,maxLength);}
for(var i=0;i<list.length;i++){var interactionFilterValue=list[i];formattedValue+=valueProp?interactionFilterValue[valueProp]:interactionFilterValue;if(i<list.length-1){formattedValue+=delimiter;}}
formattedValue+=listSuffix;return formattedValue;},camelCase:function(str){return str.charAt(0).toUpperCase()+str.substring(1);},htmlDecode:function(value){return!value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&#039;/g,"'");},htmlEncodeArray:function(arr){var vals=[];for(var i=0;i<arr.length;i++){var val=arr[i];if(isString(val)){val=Ext.util.Format.htmlEncode(val);}
vals.push(val);}
return vals;},formatArrayText:function(val,maxlen){var s='('+val.length+') '+val.join('; ');if(maxlen!=undefined&&s.length>maxlen){s=s.substr(0,maxlen)+'... ';}
return Ext.util.Format.htmlEncode(s);},upcaseFirst:function(str){return str.charAt(0).toUpperCase()+str.substring(1);}});}();Mkt.util.Common=function(){return{getSelections:function(action){if(isUndefined(action)||isUndefined(action.triggeredFrom)){return null;}
var obj=[];if(action.triggeredFrom=="grid"||action.triggeredFrom=="button"){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid&&(action.forceGetInfoFrom!='appVars')&&!action.useCanvasConfig){var recs=grid.getSelectionModel().getSelections();if(recs){if(recs.length==1){if(recs[0].id=="ALL"){recs=grid.getSelectionModel().getVisibleSelections();}}
for(var i=0;i<recs.length;i++){var data=Ext.apply({text:recs[i].data['name'],name:recs[i].data['name'],url:recs[i].data['url'],status:recs[i].data['status']||recs[i].data['lpStatus'],type:recs[i].data['type']||recs[i].data['lpType'],compType:recs[i].data['compType'],compSubtype:recs[i].data['compSubtype'],usedBy:recs[i].data['usedBy'],hasDraft:recs[i].data['hasDraft'],id:recs[i].id,json:recs[i].json,source:'grid'},recs[i].data);obj.push(data);}}}else{if(action.useCanvasConfig){var activeTab=MktCanvas.getActiveTab();if(!activeTab||!activeTab.config){return;}
var config=activeTab.config
obj=[{id:config.compId,text:config.compName,name:config.compName,nodeId:config.expNodeId,compType:config.compType,accessZoneId:config.accessZoneId}]}
else{obj=[{id:MktPage.appVars[action.appVarsId],text:MktPage.appVars[action.appVarsName],name:MktPage.appVars[action.appVarsName],url:MktPage.appVars[action.appVarsUrl],hasDraft:MktPage.appVars[action.appVarsHasDraft],status:MktPage.appVars[action.appVarsStatus],type:MktPage.appVars[action.appVarsType],compType:MktPage.appVars[action.appVarsCompType],compSubtype:MktPage.appVars[action.appVarsCompSubtype],usedby:MktPage.appVars[action.appVarsUsedBy]}];}
obj[0]['source']='tab';}}else if(action.triggeredFrom=="tree"){if(action.xtra){obj=[{id:action.xtra.compId,name:action.xtra.text,text:action.xtra.text,hasDraft:action.xtra.hasDraftNode||((action.xtra.compType=='Email'||action.xtra.compType=='Email Template')&&(action.xtra.compStatus==1||action.xtra.text=='Draft')),url:action.xtra.url,status:action.xtra.compStatus,usedBy:action.xtra.compUsedBy,type:action.xtra.subType,compType:action.xtra.compType,compSubtype:action.xtra.compSubtype,nodeId:action.xtra.nodeId,source:'tree'}];}}
return obj;},isValueTrue:function(val){if(isString(val)){return(val.toLowerCase()==="true"||val.toLowerCase()==="on"||val.toLowerCase()==="yes"||val.toLowerCase()==="1");}else{return(isBoolean(val)||isNumber(val))?val:false;}},getNodeAttrValue:function(node,attrName,activeCanvas,activeCanvasAttrName){var val;if(node){var attr=node.attributes;if(attr&&isDefined(attr[attrName])){val=attr[attrName];}}
if(isUndefined(val)&&activeCanvas){var activeTab=MktCanvas.getActiveTab();var canvasAttrName=attrName;if(isDefined(activeCanvasAttrName)){canvasAttrName=activeCanvasAttrName;}
if(activeTab&&isDefined(activeTab.config[canvasAttrName])){val=activeTab.config[canvasAttrName];}}
return val;},convertArrayValueToString:function(arr){if(!Ext.isArray(arr)){return arr;}
for(var i=0;i<arr.length;i++){if(Ext.isArray(arr[i])){continue;}
arr[i]=arr[i]+"";}
return arr;},arrayEqual:function(arr1,arr2){if(!arr1||!arr2){return false;}else if(arr1.length!=arr2.length){return false;}else{var arr1Len=arr1.length;for(var x=0;x<arr1Len;x++){if(arr1.indexOf(arr2[x])==-1){return false;}}}
return true;},xdLogin:function(loadHandler){if(!Mkt.util.XdMessaging.isXdMessagingNeeded()){if(isDefined(loadHandler)&&isFunction(loadHandler)){loadHandler();}
return;}
Mkt.util.XdMessaging.reInitRecieverIFrame();var loginIFrame=Ext.get('xdEditorLogin');if(loginIFrame){loginIFrame.removeAllListeners();loginIFrame.on('load',loadHandler);}
var form=Ext.getDom('editorLauncher');if(form){form.submit();}},userAgentHas:function(r){return r.test(navigator.userAgent.toLowerCase());},getNextDay:function(dateString,format,daysAhead){var nextDayString=dateString;if(!format){format=Mkt.util.Format.shortDateFormat;}
if(isUndefined(daysAhead)){daysAhead=1;}
if(Ext.isIE){dateString=dateString.replace('-','/');}
var d=new Date(dateString);var nextDateString=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()+daysAhead).toUTCString();if(nextDateString){var split=nextDateString.split(' ');if(split){delete split[split.length-1];nextDayString=split.join(' ');}}
if(nextDayString){return(new Date(nextDayString)).format(format);}
else{return nextDayString;}}};}();
/* ========== ../mkt-ext-2.0/util/localeUtil.js ============ */

Ext.ns('Mkt.util','Mkt.util.locale');Mkt.util.locale.Format={VAR_WHOLE:'W',VAR_FRACT:'F',VAR_SYMBOL:'~',formatNumber:function(value,format,options){var REGEX_FRACT=eval("/"+this.VAR_FRACT+"/g");if(isNaN(value)){return value;}
var formatted=[];var precision=(format.match(REGEX_FRACT)||[]).length;if(options&&options.includeFractional===false){precision=0;}
var numValue=new Number(value);var strValue=numValue.toFixed(precision);var splitValue=strValue.split(".");var wholeNumbers=splitValue[0].split("");var fractNumbers=splitValue.length==2?splitValue[1].split(""):[];var firstWholeIndex=format.indexOf(this.VAR_WHOLE);var fractDivIdx=format.indexOf(this.VAR_FRACT)-1;var fractDivChar=fractDivIdx>0?format[fractDivIdx]:"";var validDivChar=fractDivChar!=this.VAR_WHOLE&&fractDivChar!=this.VAR_SYMBOL;for(i=format.length-1;i>=0;i--){switch(format[i]){case this.VAR_WHOLE:{if(wholeNumbers.length>0){formatted.unshift(wholeNumbers.pop());}
if(wholeNumbers.length==0){i=firstWholeIndex;}
break;}
case this.VAR_FRACT:{if(fractNumbers.length>0){formatted.unshift(fractNumbers.pop());}
break;}
default:{formatted.unshift(format[i]);}}
if(fractDivIdx==i&&precision==0&&validDivChar){formatted.shift();}}
return formatted.join("");},formatCurrency:function(value,format,currency,options){var REGEX_SYMBOL=eval("/"+this.VAR_SYMBOL+"/g");var numberFormatted=this.formatNumber(value,format,options);if(Ext.isString(numberFormatted)){numberFormatted=numberFormatted.replace(REGEX_SYMBOL,currency);}
return numberFormatted;}}
/* ========== ../mkt-ext-2.0/widgets/BufferView.js ============ */

Ext.ns('Ext.ux.grid');Ext.ux.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){Ext.ux.grid.BufferView.superclass.initTemplates.call(this);var ts=this.templates;ts.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');ts.rowHolder.disableFormats=true;ts.rowHolder.compile();ts.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr>',(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':''),'</tbody></table>');ts.rowBody.disableFormats=true;ts.rowBody.compile();},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight;},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight;},getVisibleRowCount:function(){var rh=this.getCalculatedRowHeight(),visibleHeight=this.scroller.dom.clientHeight;return(visibleHeight<1)?0:Math.ceil(visibleHeight/rh);},getVisibleRows:function(){var count=this.getVisibleRowCount(),sc=this.scroller.dom.scrollTop,start=(sc===0?0:Math.floor(sc/this.getCalculatedRowHeight())-1);return{first:Math.max(start,0),last:Math.min(start+count+2,this.ds.getCount()-1)};},doRender:function(cs,rs,ds,startRow,colCount,stripe,onlyBody){var ts=this.templates,ct=ts.cell,rt=ts.row,rb=ts.rowBody,last=colCount-1,rh=this.getStyleRowHeight(),vr=this.getVisibleRows(),tstyle='width:'+this.getTotalWidth()+';height:'+rh+'px;',buf=[],cb,c,p={},rp={tstyle:tstyle},r;for(var j=0,len=rs.length;j<len;j++){r=rs[j];cb=[];var rowIndex=(j+startRow),visible=rowIndex>=vr.first&&rowIndex<=vr.last;if(visible){for(var i=0;i<colCount;i++){c=cs[i];p.id=c.id;p.css=i===0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');p.attr=p.cellAttr="";p.value=c.renderer(r.data[c.name],p,r,rowIndex,i,ds);p.style=c.style;if(p.value===undefined||p.value===""){p.value="&#160;";}
if(r.dirty&&typeof r.modified[c.name]!=='undefined'){p.css+=' x-grid3-dirty-cell';}
cb[cb.length]=ct.apply(p);}}
var alt=[];if(stripe&&((rowIndex+1)%2===0)){alt[0]="x-grid3-row-alt";}
if(r.dirty){alt[1]=" x-grid3-dirty-row";}
rp.cols=colCount;if(this.getRowClass){alt[2]=this.getRowClass(r,rowIndex,rp,ds);}
rp.alt=alt.join(" ");rp.cells=cb.join("");buf[buf.length]=!visible?ts.rowHolder.apply(rp):(onlyBody?rb.apply(rp):rt.apply(rp));}
return buf.join("");},isRowRendered:function(index){var row=this.getRow(index);return row&&row.childNodes.length>0;},syncScroll:function(){Ext.ux.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update();},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this);}
this.renderTask.delay(this.scrollDelay);}else{this.doUpdate();}},onRemove:function(ds,record,index,isUpdate){Ext.ux.grid.BufferView.superclass.onRemove.apply(this,arguments);if(isUpdate!==true){this.update();}},doUpdate:function(){if(this.getVisibleRowCount()>0){var g=this.grid,cm=g.colModel,ds=g.store,cs=this.getColumnData(),vr=this.getVisibleRows(),row;for(var i=vr.first;i<=vr.last;i++){if(!this.isRowRendered(i)&&(row=this.getRow(i))){var html=this.doRender(cs,[ds.getAt(i)],ds,i,cm.getColumnCount(),g.stripeRows,true);row.innerHTML=html;}}
this.clean();}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this);}
this.cleanTask.delay(this.cleanDelay);},doClean:function(){if(this.getVisibleRowCount()>0){var vr=this.getVisibleRows();vr.first-=this.cacheSize;vr.last+=this.cacheSize;var i=0,rows=this.getRows();if(vr.first<=0){i=vr.last+1;}
for(var len=this.ds.getCount();i<len;i++){if((i<vr.first||i>vr.last)&&rows[i].innerHTML){rows[i].innerHTML='';}}}},removeTask:function(name){var task=this[name];if(task&&task.cancel){task.cancel();this[name]=null;}},destroy:function(){this.removeTask('cleanTask');this.removeTask('renderTask');Ext.ux.grid.BufferView.superclass.destroy.call(this);},layout:function(){Ext.ux.grid.BufferView.superclass.layout.call(this);this.update();}});
/* ========== ../mkt-ext-2.0/widgets/MktGrids.js ============ */

Ext.namespace("MktGrids");MktGrids.RowEditor=Ext.extend(Ext.ux.grid.RowEditor,{forceSave:false,commitChangesText:'<ul><li>Please save or cancel your changes</li></ul>',persistTooltip:false,lazyDismiss:false,getCustomGridValue:function(rowEditor,val,cm,colIndex,record){return null;},formatTooltipErrors:function(errors){var data=['<ul>'];Ext.each(errors,function(message){data.push('<li>',message,'</li>');});data.push('</ul>');return data.join('');},startEditing:function(rowIndex,doFocus){var currentEditingRowDirty=this.record&&this.record.dirty;if(this.editing&&(this.isDirty()||currentEditingRowDirty)){this.showTooltip(this.commitChangesText);this.persistTooltip=true;return;}
if(Ext.isObject(rowIndex)){rowIndex=this.grid.getStore().indexOf(rowIndex);}
if(this.fireEvent('beforeedit',this,rowIndex)!==false){this.editing=true;var g=this.grid,view=g.getView(),row=view.getRow(rowIndex),record=g.store.getAt(rowIndex);this.record=record;this.rowIndex=rowIndex;this.values={};if(!this.rendered){this.render(view.getEditorParent());this.el.setZIndex(8900);}
var w=Ext.fly(row).getWidth();this.setSize(w);var cm=g.getColumnModel(),fields=this.items.items,f,val;if(!this.initialized){this.initFields(rowIndex);}
else{this.addReplaceFields(cm,rowIndex,true);}
for(var i=0,len=cm.getColumnCount();i<len;i++){val=this.preEditValue(record,cm.getDataIndex(i));f=fields[i];customValue=this.getCustomGridValue(this,val,cm,i,record);if(customValue){val=customValue;}
f.setValue(val);this.values[f.id]=Ext.isEmpty(val)?'':val;}
this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(row).getXY());}else{this.el.setXY(Ext.fly(row).getXY(),{duration:0.15});}
if(!this.isVisible()){this.show();}
this.doLayout();if(doFocus!==false){this.doFocus.defer(this.focusDelay,this);}}},initComponent:function(){MktGrids.RowEditor.superclass.initComponent.call(this);this.addEvents('afterchanges');},init:function(grid){this.grid=grid;this.ownerCt=grid;if(this.clicksToEdit===2){grid.on('rowdblclick',this.onRowDblClick,this);}else{grid.on('rowclick',this.onRowClick,this);if(Ext.isIE){grid.on('rowdblclick',this.onRowDblClick,this);}}
grid.getStore().on('remove',function(){this.stopEditing(false);},this);grid.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});grid.getColumnModel().on('hiddenchange',this.verifyLayout,this,{delay:1});},initFields:function(rowIndex){var cm=this.grid.getColumnModel(),pm=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(true);this.addReplaceFields(cm,rowIndex,false);this.initialized=true;},addReplaceFields:function(cm,rowIndex,isUpdate){var pm=Ext.layout.ContainerLayout.prototype.parseMargins;for(var i=0,len=cm.getColumnCount();i<len;i++){var c=cm.getColumnAt(i);var ed=null;var editorObj=cm.getCellEditor(i,rowIndex);if(editorObj){ed=editorObj.field;}
if(!ed){ed=c.displayEditor||new Ext.form.DisplayField({readOnly:true});}
if(i==0){ed.margins=pm('0 1 2 1');}else if(i==len-1){ed.margins=pm('0 0 2 1');}else{if(Ext.isIE){ed.margins=pm('0 0 2 0');}
else{ed.margins=pm('0 1 2 0');}}
ed.setWidth(cm.getColumnWidth(i));ed.column=c;if(ed.ownerCt!==this){ed.on('focus',this.ensureVisible,this);ed.on('specialkey',this.onKey,this);}
if(isUpdate&&!c.editor){this.remove(this.getComponent(i),true);this.insert(i,ed);}
else if(!isUpdate){this.insert(i,ed);}}},stopEditing:function(saveChanges){if(!this.isVisible()){this.editing=false;return;}
if(saveChanges===false){this.editing=false;this.hide();this.persistTooltip=false;this.fireEvent('canceledit',this,saveChanges===false);return;}
if(!this.isValid()){return;}
var changes={},r=this.record,hasChange=false,cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var dindex=cm.getDataIndex(i);var isReadOnly=fields[i].readOnly;if(!isReadOnly&&!Ext.isEmpty(dindex)){var oldValue=r.data[dindex],value=this.postEditValue(fields[i].getValue(),oldValue,r,dindex);if(String(oldValue)!==String(value)){changes[dindex]=value;hasChange=true;}}}}
this.fireEvent('afterchanges',this,changes,r,this.rowIndex);if((hasChange||r.dirty)&&this.fireEvent('validateedit',this,changes,r,this.rowIndex)!==false){r.beginEdit();Ext.iterate(changes,function(name,value){r.set(name,value);});r.endEdit();if(this.forceSave&&r.store){r.store.save();}}
if(!this.lazyDismiss||!r.dirty){this.editing=false;this.hide();this.fireEvent('afteredit',this,changes,r,this.rowIndex);}},showTooltip:function(msg){var t=this.tooltip;if(!t){t=this.tooltip=new Ext.ToolTip({maxWidth:220,cls:'errorTip',width:220,title:this.errorText,autoHide:false,anchor:'left',anchorToTarget:true});t.onTargetOver=Ext.emptyFn;}
var v=this.grid.getView(),top=parseInt(this.el.dom.style.top,10),scroll=v.scroller.dom.scrollTop,h=this.el.getHeight();if(top+h>=scroll){t.initTarget(this.getEl());if(!t.rendered){t.show();t.hide();}
t.body.update(msg);t.doAutoWidth(20);t.show();}else if(t.rendered){t.hide();}},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(['keydown','keyup','keypress']);this.btns=new Ext.Panel({baseCls:'x-plain',cls:'x-btns',elements:'body',layout:'table',width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{xtype:'spacer',width:10},{ref:'saveBtn',iconCls:'mkiOk',itemId:'saveBtn',xtype:'button',text:this.saveText,handler:this.stopEditing.createDelegate(this,[true])},{xtype:'button',iconCls:'mkiCancel',text:this.cancelText,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap);},bindHandler:function(){if(!this.bound){return false;}
var valid=this.isValid();if(!valid&&this.errorSummary){this.showTooltip(this.getErrorText().join(''));}
else if(this.tooltip&&valid&&!this.persistTooltip){this.tooltip.hide();}
this.btns.saveBtn.setDisabled(!valid);this.fireEvent('validation',this,valid);},isDirty:function(){var dirty;this.items.each(function(f){if(!f.readOnly&&String(f.originalValue)!==String(f.getValue())){dirty=true;return false;}},this);return dirty;}});MktGrids.FlexibleColumnModel=Ext.extend(Ext.grid.ColumnModel,{constructor:function(config,store){this.store=store;MktGrids.FlexibleColumnModel.superclass.constructor.call(this,config);},getCellEditor:function(colIndex,rowIndex){var editor=Ext.grid.ColumnModel.prototype.getCellEditor.call(this,colIndex,rowIndex);var column=this.getColumnAt(colIndex);var rec=null;if(this.store&&this.store.getAt(rowIndex)){rec=this.store.getAt(rowIndex);}
var columnStoreMeta={};if(rec&&rec.data[this.metaDataProperty]&&rec.data[this.metaDataProperty][column.dataIndex]){columnStoreMeta=rec.data[this.metaDataProperty][column.dataIndex];}
if(!editor&&column.editable&&columnStoreMeta.editable!==false){var fieldType=columnStoreMeta.dataDesc||'shortText';var fieldConfig=Ext.decode(Ext.encode(this.dataFieldMap[fieldType]));var extraFieldConfig=this.getExtraFieldConfig(column,rec,columnStoreMeta);Ext.apply(fieldConfig,columnStoreMeta.fieldConfig);Ext.apply(fieldConfig,extraFieldConfig);var newField=Ext.ComponentMgr.create(fieldConfig);editor=new Ext.grid.GridEditor(newField);}
return editor;},dataFieldMap:{boolean:{xtype:'checkbox'},shortText:{xtype:'textfield'},longText:{xtype:'textarea'},richText:{xtype:'htmleditor',enableLinks:false,enableSourceEdit:false,enableLists:false},richTextModal:{xtype:'displayfield',readOnly:true},integer:{xtype:'numberfield',allowDecimals:false,allowNegative:false},float:{xtype:'numberfield',allowDecimals:true},date:{xtype:'datefield',format:Ext.util.Format.longDateFormat},monthDate:{xtype:'datefield',format:'M Y',plugins:["monthPickerPlugin"]},display:{xtype:'displayfield',readOnly:true},selector:{xtype:'combo'},suggest:{xtype:'combo',minChars:0},url:{xtype:'textfield',vtype:'mkt_url'},email:{xtype:'textfield',vtype:'email'}},metaDataProperty:'__mkt_col_meta',getExtraFieldConfig:function(column,rec,columnStoreMeta){return null;}});MktGrids.CanvasGridRowSelectionModel=function(config){MktGrids.CanvasGridRowSelectionModel.superclass.constructor.call(this,config);};Ext.extend(MktGrids.CanvasGridRowSelectionModel,Ext.grid.RowSelectionModel,{allSelected:false,init:function(grid){MktGrids.CanvasGridRowSelectionModel.superclass.init.call(this,grid);this.store.on('load',this.handleLoad.createDelegate(this));this.on('rowselect',this.handleRowSelect.createDelegate(this));this.on('rowdeselect',this.handleRowDeSelect.createDelegate(this));},selectAll:function(){MktGrids.CanvasGridRowSelectionModel.superclass.selectAll.call(this);this.allSelected=true;this.fireEvent("selectionchange",this);},getCount:function(){if(this.allSelected){return this.grid.getAsyncTotalCount();}
return MktGrids.CanvasGridRowSelectionModel.superclass.getCount.call(this);},getAllSelected:function(){return this.allSelected;},getSelections:function(){if(this.allSelected){return[{id:'ALL',json:{Id:'ALL'}}];}
return MktGrids.CanvasGridRowSelectionModel.superclass.getSelections.call(this);},getVisibleSelections:function(){return MktGrids.CanvasGridRowSelectionModel.superclass.getSelections.call(this);},handleRowSelect:function(selModel){this.allSelected=false;},handleRowDeSelect:function(selModel){this.allSelected=false;},handleLoad:function(store,records,options){if(this.allSelected){this.selectAll();}}});MktGrids.CanvasGridTypeSelectionModel=function(config){MktGrids.CanvasGridTypeSelectionModel.superclass.constructor.call(this,config);};Ext.extend(MktGrids.CanvasGridTypeSelectionModel,Ext.grid.RowSelectionModel,{contiguousSelection:true,scalarTypes:['int','datetime','date','time','float'],init:function(grid){MktGrids.CanvasGridTypeSelectionModel.superclass.init.apply(this,arguments);},deselectRow:function(index,preventViewNotify){MktGrids.CanvasGridTypeSelectionModel.superclass.deselectRow.apply(this,arguments);},_allowSelectDeselect:function(minMax,rowIndex){var bubble=false;if((rowIndex==(minMax[0]-1))||((minMax[1]+1)==rowIndex)||(minMax[1]==rowIndex)||(minMax[0]==rowIndex)){bubble=true;}
return bubble;},_getSelectionMinMax:function(selections){var ds=this.grid.getStore();var min,max=0,index,rowIndex;var view=this.grid.getView();for(var i=0;i<selections.length;i++){index=ds.indexOf(selections[i]);rowIndex=view.getRow(index).rowIndex;min=min||rowIndex;min=Math.min(rowIndex,min);max=Math.max(rowIndex,max);}
return[min,max];},_getGroupType:function(){var type="";var store=this.grid.getStore();var groupField=store.groupField;if(groupField=='total'){groupField="Group1";}
var item=store.fields.get(groupField);if(item){type=item.type;}
return type;},_isScalar:function(type){return(this.scalarTypes.indexOf(type)!=-1);},handleMouseDown:function(g,rowIndex,e){var bubble=true;if(this.contiguousSelection){var view=this.grid.getView();if(view.enableGrouping&&e.ctrlKey&&this._isScalar(this._getGroupType())){var count=this.getCount();if(count>0){var minMax=this._getSelectionMinMax(this.getSelections());bubble=this._allowSelectDeselect(minMax,rowIndex);}}}
if(bubble){MktGrids.CanvasGridTypeSelectionModel.superclass.handleMouseDown.apply(this,arguments);}else{e.stopEvent();}}});MktGrids.CanvasGridPanel=function(config){MktGrids.CanvasGridPanel.superclass.constructor.call(this,config);if(this.renderIfElExists){var elContainer=Ext.get(this.el);if(elContainer&&elContainer.isVisible()){this.render();}}};Ext.extend(MktGrids.CanvasGridPanel,Ext.grid.EditorGridPanel,{canvas:null,canvasAsyncUnmaskId:null,maskCanvas:true,maskCanvasSubtle:false,enablePurpleCorners:true,showRecordLoadedStatus:true,stateful:false,loadMask:false,maskPurpleCornersDuringLoad:true,beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading {0} items...',maskMsg:'',pagingDisplayMsg:'{0}-{1} of {2} items',totalDisplayMsg:'{0} items',recalculatingMsg:"Calculating...",enableDragDrop:false,ddGroup:'treeDD',isEditor:false,trackMouseOver:true,stripeRows:true,enablePaging:false,pagingEmptyMsg:'0 items',pageSize:30,enableTotal:null,showToolbarIcons:true,enableExport:false,exportText:'Export',exportTooltip:'Export to Excel',exportIcon:'mkiExcel',exportUrl:null,exportTimeout:10000,showRefreshButton:true,refreshText:undefined,refreshParams:{},refreshHandler:null,refreshTooltip:"Refresh",refreshIcon:"mkiNavRefreshGreen",enableSearchPaging:false,searchEmptyText:'Quick Find...',searchQtip:null,searchWidth:200,query:'',selectedSingularText:'row',selectedPluralText:'rows',allowSelectAll:false,showSelectionCount:false,enableTotalCountRefresh:false,enableTotalCountAsyncLoading:false,alwaysUpdateTotalCountAsync:true,totalCountAsyncUrl:'',cancelQuery:false,contiguousSelection:false,enableSticky:false,stickyUrl:"",renderIfElExists:false,disableHdSortOnClick:true,timezone:'',contextOnAnchor:false,enableBackgroundLoad:false,backgroundLoadOptionDelay:10,backgroundLoadMsg:'',beforeLoad:function(store,options){if(this.maskCanvas){this._tempLoadMask=this.loadMask;this.loadMask=false;if(this.maskPurpleCornersDuringLoad){MktViewport.maskPurpleCorners(true);}
MktCanvas.mask(this.canvas,null,'mktCanvasMaskActivity',this.maskCanvasSubtle);}
if(this.cancelQuery&&this.canvas&&MktCanvas){var mktoReqId=MktSession.getRequestId();if(mktoReqId){options.params.mktoReqId=mktoReqId;MktSession.monitorRequest(this.canvas,mktoReqId);}}
var sortOrder=store.getSortState();if(options&&options.params){if(sortOrder){options.params.direction=sortOrder.direction;options.params.field=sortOrder.field;}else{delete options.params.direction;delete options.params.field;}}
if(this.enableTotalCountAsyncLoading&&this.requestTotalCountAsync){this.refreshTotalHandler();this.requestTotalCountAsync=false;}
this.storeLoading=true;this._beforeLoadCallCount++;this.hideMsg();return true;},recordLoaded:function(records,idx){if(this.maskCanvas&&this.showRecordLoadedStatus){MktCanvas.mask(this.canvas,null,'mktCanvasMaskActivity',true);}
return true;},afterLoad:function(proxy,response){this.storeLoading=false;if(this.cancelGridLoad){this.cancelGridLoad=false;return;}
this.gridLoaded=true;var error=null;if(this.canvas){var tab=MktCanvas.getTab(this.canvas);if(tab)tab.selectExplorerNode();}
if(this.maskCanvas){MktCanvas.unmask(this.canvas,this.canvasAsyncUnmaskId);this.loadMask=this._tempLoadMask;this.maskCanvasSubtle=true;}
if(this.enablePurpleCorners){MktViewport.showPurpleCorners(true);}
if(this.maskPurpleCornersDuringLoad){MktViewport.maskPurpleCorners(false);}
try{error=proxy.reader.jsonData.error;}
catch(e){}
if(this.store){if(this.pager&&this.enableTotalCountAsyncLoading){this.pager.updatePaging();}
this.showEmptyMsg(error);}
this.afterLoadHook(proxy,response);},afterLoadHook:function(proxy,response){},showEmptyMsg:function(error){if(this.store.getCount()===0){this.showMsg(error?error:this.getEmptyMsg());}
if(this.enablePurpleCorners){MktViewport.showPurpleCorners(true);}},getEmptyMsg:function(){var msg=this.pagingEmptyMsg;if(this.query){msg+=String.format(' matching &ldquo;{0}&rdquo;',Ext.util.Format.htmlEncode(this.query));if(this.activeFilters!==0){msg+="<br><br>Try changing filter options";}}
else if(this.activeFilters!==0){msg="All activities filtered, try changing filter options";}
return msg;},activeFilters:0,showMsg:function(msg){if(this.maskCanvas&&this.canvas){MktCanvas.unmask(this.canvas,this.canvasAsyncUnmaskId);}
this.hideMsg();var view=this.getView();this.msgMask=view.mainBody.createChild({cls:'mktEmptyGridMask',html:'<span>'+msg+'</span>'},null,true);this.msgMask.style.marginTop=((view.scroller.getHeight()/3)+50)+'px';},hideMsg:function(){if(this.msgMask){this.msgMask.style.display='none';}},onLoadException:function(proxy,reader,response,e){this.storeLoading=false;if(this.cancelGridLoad){this.cancelGridLoad=false;return;}
console.group('MktGrids.CanvasGridPanel caught load exception');console.debug("grid=",this);console.debug("proxy=",proxy);console.debug("reader=",reader);console.debug("response=",response);console.debug("Tip: Try loading this URL in a new window.");console.debug("exception:",e);console.groupEnd();MktSession.unclockCursor();if(this.maskCanvas){MktCanvas.unmask(this.canvas,this.canvasAsyncUnmaskId);this.loadMask=this._tempLoadMask;}
if(MktPage.debug)debugger;var parseResults=MktSession.parseResults(response);parseResults.systemErrorMsg=MktMessage.SYSTEM_ERROR_GRID;if(response.status==-1){parseResults.systemErrorMsg=MktMessage.SYSTEM_ERROR_TIMEOUT;parseResults.errorType='Ajax timeout ('+(Ext.Ajax.timeout/1000)+' sec)';parseResults.errorHTML=MktMessage.SYSTEM_ERROR_TIMEOUT;}
this.showMsg(parseResults.systemErrorMsg);var reqParams=reader.params;MktSession.ajaxShowError(response,parseResults,reqParams);},reload:function(){this.store.reload();if(this.enableTotalCountAsyncLoading){this.refreshTotalHandler();console.debug('Grid reloading and refreshing async total count...');}
else{console.debug('Grid reloading...');}},refreshTotalHandler:function(){if(this.refreshingTotal){return;}
if(this.query&&!this.alwaysUpdateTotalCountAsync){console.debug('Ignoring refresh total handler request, query=',this.query);return;}
this.refreshingTotal=true;var searchField=this.pager.searchField;if(searchField){var query=searchField.getRawValue();this.totalCountAsyncParams=this.totalCountAsyncParams||{};if(query){this.totalCountAsyncParams.query=query;}
else{delete this.totalCountAsyncParams.query;}}
var activeFilters=this.getActiveFiltersAsJson();if(activeFilters){this.totalCountAsyncParams.filter=activeFilters;}
else{delete this.totalCountAsyncParams.filter;}
this.pager.updateTempDisplayMsg(this.recalculatingMsg,true);MktSession.ajaxRequest(this.totalCountAsyncUrl,{serializeParms:this.totalCountAsyncParams,canvas:this.canvas,cancelQuery:this.cancelQuery,onMySuccess:this.refreshTotalHandlerDone.createDelegate(this)});},getActiveFiltersAsJson:function(){if(this.activityFilters){return this.activityFilters.getActiveFiltersAsJson();}},refreshTotalHandlerDone:function(){this.refreshingTotal=false;if(this.query&&!this.alwaysUpdateTotalCountAsync){console.debug('Ignoring total count refresh due to query: ',this.query);return;}
if(!this.store){return;}
var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var totalCount=MktPage.appVars.totalCount;this.store.totalLength=this.store.asyncTotalCount=totalCount;var totalCountPrecision=this.store.totalCountPrecision=MktPage.appVars.totalCountPrecision;this.store.totalCountPrecisionMsg='';console.debug('totalCountPrecision=',totalCountPrecision);if(totalCountPrecision!='exact'&&!this.query){this.store.totalCountPrecisionMsg='about ';}
var loadingMsg=String.format(this.afterLoadMaskMsg,this.store.totalCountPrecisionMsg+totalCount);console.debug(loadingMsg);if(this.maskCanvas&&!this.gridLoaded){if(totalCount>0){if(this.enableBackgroundLoad){this.backgroundLoadMsgPreamble=loadingMsg;this.buildBackgroundLoadMsg();if(this.backgroundTimerVisible){this.showBackgroundLoadOption();loadingMsg=null;}}
if(loadingMsg){this.maskGridCanvas(undefined,loadingMsg,'mktCanvasMaskActivity');}}}}else if(result==MktSession.resultFailed&&MktPage.appVars.errMsg){MktMessage.showError(MktPage.appVars.errMsg);}
if(this.store&&this.pager){this.pager.restoreDisplayMsg();}},currentMaskMsg:null,currentMaskCallback:Ext.emptyFn,currentMaskCls:null,currentMaskSubtle:false,canvasPanelReactivateCallback:function(){if(this.maskCanvas&&!this.cancelGridLoad&&this.storeLoading&&this.currentMaskMsg){this.maskGridCanvas(undefined,this.currentMaskMsg,this.currentMaskCls,this.currentMaskSubtle,false,this.currentMaskCallback);}},maskGridCanvas:function(tab,msg,cls,subtle,animate,animCallback){if(!this.maskCanvas){return;}
var gridTab=tab;if(!gridTab&&MktCanvas&&MktCanvas.getTab){var gridTab=MktCanvas.getTab(this.canvas);}
var forceInitMask=false;if(gridTab&&!gridTab.config.contentValid){this.currentMaskMsg=msg=this.beforeLoadMaskMsg;this.currentMaskAnimCallback=Ext.emptyFn;this.currentMaskCls=cls='mktCanvasMaskActivity';this.currentMaskSubtle=subtle=false;forceInitMask=true;}
if(cls===undefined){cls=this.currentMaskCls;}
else{this.currentMaskCls=cls=cls||'mktCanvasMaskActivity';}
if(msg===undefined){msg=this.currentMaskMsg;}
else{this.currentMaskMsg=msg=msg||this.beforeLoadMaskMsg;}
this.currentMaskAnimCallback=animCallback||Ext.emptyFn;this.currentMaskSubtle=subtle=subtle||false;if(gridTab&&gridTab.getId()==MktCanvas._makeTabId(this.canvas)){if(!MktCanvas.isMasked()||forceInitMask){MktCanvas.mask(this.canvas,'','mktCanvasMaskActivity',subtle,'grid');}
MktCanvas.updateMaskMsg(this.canvas,msg,cls,animate,animCallback);}},initComponent:function(){if(this.loadMask===true){this.loadMask={msg:this.maskMsg};}
if(this.canvas&&isUndefined(this.myPanelId)){this.myPanelId=MktPage.activePanel.cName;}
if(this.maskCanvas&&typeof MktCanvas!='undefined'&&isFunction(MktCanvas.getAsyncUnmaskId)){this.canvasAsyncUnmaskId=MktCanvas.getAsyncUnmaskId(this.myPanelId);}
if(isDefined(this.defaultSort)){this.ds.setDefaultSort(this.defaultSort,isDefined(this.defaultOrder)?this.defaultOrder:'ASC');}
if(isUndefined(this.cm)){this.cm=new Ext.grid.ColumnModel(this.viewCols);}
if(isUndefined(this.sm)){var smConfig={store:this.ds};if(this.disableSelection){smConfig.selectRow=Ext.emptyFn;}
if(this.allowSelectAll){this.sm=new MktGrids.CanvasGridRowSelectionModel(smConfig);}else if(this.contiguousSelection){this.sm=new MktGrids.CanvasGridTypeSelectionModel(smConfig);}else{this.sm=new Ext.grid.RowSelectionModel(smConfig);}}
if(this.ds){this.ds.on('beforeload',this.beforeLoad.createDelegate(this));this.ds.on('add',this.recordLoaded.createDelegate(this));this.ds.on('load',this.afterLoad.createDelegate(this));this.ds.on('loadexception',this.onLoadException.createDelegate(this));}
this.on('headercontextmenu',this.handleHeaderContextMenu.createDelegate(this));this.on('headerclick',this.handleHeaderContextMenu.createDelegate(this));this.on('rowcontextmenu',this.handleRightClick,this);this.on('rowclick',this.handleRowClick,this);if(!this.bbar){var pager=null;var displayMsg=this.totalDisplayMsg;if(this.enableSearchPaging){pager=MktGrids.QuickSearchPagingToolbar;displayMsg=this.pagingDisplayMsg;}
else if(this.enablePaging){pager=Ext.PagingToolbar;displayMsg=this.pagingDisplayMsg;}
else if(this.enableExport){pager=MktGrids.TotalToolbar;this.enableTotal=this.enableTotal===false?false:true;}
else if(this.enableTotal){pager=MktGrids.TotalToolbar;}
if(pager){this.pager=this.bbar=new pager({displayMsg:displayMsg,totalDisplayMsg:this.totalDisplayMsg,pagingDisplayMsg:this.pagingDisplayMsg,emptyMsg:this.enableTotal?this.pagingEmptyMsg:' ',enablePaging:this.enablePaging,pageSize:this.pageSize,displayInfo:true,store:this.ds,searchEmptyText:this.searchEmptyText,searchQtip:this.searchQtip,searchWidth:this.searchWidth,enableTotalCountRefresh:this.enableTotalCountRefresh,enableTotalCountAsyncLoading:this.enableTotalCountAsyncLoading,selectedSingularText:this.selectedSingularText,selectedPluralText:this.selectedPluralText,selectionModel:this.sm,gridOwner:this,disableSelection:this.disableSelection,showSelectionCount:this.showSelectionCount,enableTotal:this.enableTotal,enableExport:this.enableExport,exportText:this.exportText,exportTooltip:this.exportTooltip,exportIcon:this.exportIcon,exportUrl:this.exportUrl,exportHandler:this.exportHandler,exportTimeout:this.exportTimeout,showRefreshButton:this.showRefreshButton,refreshText:this.refreshText,refreshParams:this.refreshParams,refreshTooltip:this.refreshTooltip,refreshHandler:this.refreshHandler,refreshIcon:this.refreshIcon});}}
MktGrids.CanvasGridPanel.superclass.initComponent.call(this);if(this.enableBackgroundLoad){this.store.on('beforeload',function(store,options){if(this.query){return;}
if(this.backgroundLoadTimerHandle||this.backgroundTimerVisible){return;}
this.backgroundTimerVisible=false;this.backgroundLoadTimerHandle=window.setTimeout(function(){this.showBackgroundLoadOption();}.createDelegate(this),this.backgroundLoadOptionDelay*1000);}.createDelegate(this));this.store.on('load',function(){clearTimeout(this.backgroundLoadTimerHandle);this.backgroundLoadTimerHandle=undefined;}.createDelegate(this));}},showBackgroundLoadOption:function(){if(this.enableBackgroundLoad){this.backgroundTimerVisible=true;this.maskGridCanvas(undefined,this.backgroundLoadMsg,'mktCanvasMaskActivity mktCanvasMaskWideTall',false,true);}},cleanup:function(){if(this.canvas){MktPage.eventMgr.removeListener('panelactivate',this.panelActivated,this);}
this.destroy();},setupStickySettings:function(){if(!this.enableSticky)return;this.on("columnmove",this.onColumnMove.createDelegate(this));this.on("columnresize",this.onColumnResize.createDelegate(this));this.getColumnModel().on("hiddenchange",this.onColumnHiddenChange.createDelegate(this));this.on("sortchange",this.onSortChange.createDelegate(this));},onColumnMove:function(oldIndex,newIndex){this.saveStickyState();},onColumnResize:function(colIndex,width){this.saveStickyState();},onColumnHiddenChange:function(cm,colIndex,hidden){var col=cm.config[colIndex];console.debug('onColumnHiddenChange',col,hidden);if(col.fixed){return;}
this.saveStickyState();},onSortChange:function(grid,state){this.saveStickyState(true);},saveStickyState:function(clearCache){var colConfig=this.getColumnModel().config;if(!this.enableSticky||this.stickyUrl.length<=0){return;}
var visColList=Array();for(var i=0;i<colConfig.length;i++){var col=colConfig[i];if(!col.hidden){visColList.push({field:col.dataIndex,width:col.width});}}
var sortOrder=this.defaultSortOrder;var store=this.getStore();if(store){sortOrder=store.getSortState();}
var params={state:Ext.encode({columns:visColList,sortOrder:sortOrder})};if(clearCache){params.clearCache=true;}
Ext.applyIf(params,this.stickyBaseParams);MktSession.ajaxRequest(this.stickyUrl,{serializeParms:params,onMySuccess:this.layoutMetaUpdated.createDelegate(this)});},layoutMetaUpdated:function(){},handleHeaderContextMenu:function(grid,columnIndex,e){if(isUndefined(e)){return;}
e.stopEvent();var view=this.getView();var menu=view.hmenu;if(menu){var ms=menu.items,cm=this.getColumnModel();view.hdCtxIndex=columnIndex;ms.get("asc").setDisabled(!cm.isSortable(columnIndex));ms.get("desc").setDisabled(!cm.isSortable(columnIndex));menu.showAt(e.getXY());}},handleRowClick:function(grid,rowIndex,e){var sm=grid.getSelectionModel();if(sm.getSelections){var sels=sm.getSelections();if(sels.length>0&&!e.ctrlKey&&!e.shiftKey){sm.selectRange(rowIndex,rowIndex);}}},handleRightClick:function(grid,rowIndex,e){if(!this.contextOnAnchor&&e.target.tagName.toUpperCase()=="A"){return false;}
var multiRowsSelected=grid.getSelectionModel().getCount()>1;grid.getSelectionModel().selectRow(rowIndex,multiRowsSelected);return true;},panelActivated:function(panel){if(this.myPanelId==panel.cName){if(this.reRenderOnShow){this.reRenderOnShow=false;}}},loadGrid:function(data){if(data!==null){this.store.loadData(data);}
this.reRenderOnShow=false;},reloadGrid:function(data){this.store.removeAll();if(data!==null){this.store.loadData(data);}},loadPagedGrid:function(){this.store.load({params:{start:0,query:this.query}});},deleteGridRows:function(ids){var store=this.store;if(Ext.isEmpty(store,false)){return;}
if(!Ext.isArray(ids)){ids=[ids];}
for(var i=0;i<ids.length;i++){var rec=store.getById(ids[i]);if(rec){store.remove(rec);if(store.totalLength){store.totalLength--;}}}},addGridRows:function(data){var store=this.store;if(Ext.isEmpty(store,false)){return;}
if(!Ext.isArray(data)){data=[data];}
for(var i=0;i<data.length;i++){var rec=new Ext.data.Record(data[i],data[i].id);store.addSorted(rec);if(store.totalLength){store.totalLength++;}}},updateGridRows:function(datas){var store=this.store;var view=this.view;if(!Ext.isArray(datas,false)){datas=[datas];}
for(var i=0;i<datas.length;i++){var rec=store.getById(datas[i].id);if(rec){rec.data=Ext.apply(rec.data,datas[i]);view.refreshRow(rec);}}},getView:function(){if(!this.view){this.viewConfig=this.viewConfig||{};this.view=new MktGrids.GridView(Ext.apply(this.viewConfig,{'disableHdSortOnClick':this.disableHdSortOnClick}));}
return this.view;},getAsyncTotalCount:function(){var totalCount=this.store.getTotalCount();if(this.enableTotalCountAsyncLoading){if(totalCount==-1&&!isUndefined(this.store.asyncTotalCount)){totalCount=this.store.totalLength=this.store.asyncTotalCount;}}
return totalCount;}});MktGrids._GridViewDefaultConfig={enableColumnPicker:false,renderUI:function(){MktGrids.GridView.superclass.renderUI.call(this);if(this.hmenu){this.addColumnPickerHdMenu();this.customizeHdMenu();}
this.grid.setupStickySettings();},customizeHdMenu:Ext.emptyFn,beforeMenuShow:function(){MktGrids.GroupingView.superclass.beforeMenuShow.call(this);this.customizeBeforeHdMenuShow();},customizeBeforeHdMenuShow:Ext.emptyFn,addColumnPickerHdMenu:function(){if(!this.enableColumnPicker){return;}
this.hmenu.add({id:"columns",text:this.columnPickerText,handler:this.columnPickerHandler,iconCls:'x-cols-icon'});},onHeaderClick:function(g,index){if(this.headersDisabled||!this.cm.isSortable(index)||this.disableHdSortOnClick){return;}
g.stopEditing(true);g.store.sort(this.cm.getDataIndex(index));}};MktGrids.GridView=function(attributes){MktGrids.GridView.superclass.constructor.call(this,attributes);};Ext.extend(MktGrids.GridView,Ext.grid.GridView,MktGrids._GridViewDefaultConfig);MktGrids.BufferGridView=function(attributes){attributes=Ext.apply({rowHeight:19,disableHdSortOnClick:true},attributes);MktGrids.BufferGridView.superclass.constructor.call(this,attributes);};Ext.extend(MktGrids.BufferGridView,Ext.ux.grid.BufferView,MktGrids._GridViewDefaultConfig);MktGrids.GroupingView=Ext.extend(Ext.grid.GroupingView,{disableHdSortOnClick:true,onHeaderClick:function(g,index){if(this.headersDisabled||!this.cm.isSortable(index)||this.disableHdSortOnClick){return;}
g.stopEditing(true);g.store.sort(this.cm.getDataIndex(index));},renderUI:function(){MktGrids.GroupingView.superclass.renderUI.call(this);if(this.hmenu){this.customizeHdMenu();}
this.grid.setupStickySettings();},customizeHdMenu:Ext.emptyFn,beforeMenuShow:function(){MktGrids.GroupingView.superclass.beforeMenuShow.call(this);this.customizeBeforeHdMenuShow();},customizeBeforeHdMenuShow:Ext.emptyFn,handleHdMenuHide:function(menu,grid){if(grid.handleHdMenuHide&&isFunction(grid.handleHdMenuHide)){grid.handleHdMenuHide.apply(grid,[menu]);}}});Ext.Toolbar.WideSpacer=function(width){this.width=width;Ext.Toolbar.WideSpacer.superclass.constructor.call(this,{width:width});};Ext.extend(Ext.Toolbar.WideSpacer,Ext.Toolbar.Spacer,{width:null,render:function(td){if(this.width)td.style.width=this.width;Ext.Toolbar.WideSpacer.superclass.render.call(this,td);}});Ext.reg('tbvariablefill',Ext.Toolbar.WideSpacer);Ext.SlotPagingToolbar=Ext.extend(Ext.PagingToolbar,{initSlotItems:function(){this.add(new Ext.Toolbar.WideSpacer('15%'));this.add(new Ext.Toolbar.TextItem('New buttons'));},onRender:function(ct,position){Ext.SlotPagingToolbar.superclass.onRender.call(this,ct,position);this.initSlotItems();},doRefresh:function(){if(this.gridOwner.rowEditor){this.gridOwner.rowEditor.stopEditing(false);}
Ext.SlotPagingToolbar.superclass.doRefresh.apply(this);},insertAdjacentFill:function(component,insertBefore){var insertIndex=this.items.findIndex('isFill',true);insertIndex=insertIndex>-1&&insertBefore?insertIndex:this.items.getCount();this.insert(insertIndex,component);}});MktGrids.ExportPagingToolbar=Ext.extend(Ext.SlotPagingToolbar,{enableExport:false,rightAlignExport:false,showRefreshButton:true,exportUrl:null,exportText:'Export',exportIcon:'mkiExcel',exportTooltip:"Export to Excel",exportMessage:"Exporting your data, please wait...",exportProgressText:"Exporting...",exportTimeout:10000,getAsyncTotalCount:function(){var totalCount=this.gridOwner.getAsyncTotalCount();return totalCount;},updateInfo:function(){var totalCount=this.getAsyncTotalCount();if(this.gridOwner.refreshingTotal){return;}
if(this.displayItem&&this.store&&this.enableTotal){var totalCountPrecisionMsg=this.store.totalCountPrecisionMsg||'';var count=this.store.getCount();if(!count&&totalCount>0){count=Math.min(this.pageSize,totalCount);}
var msg=' ';if(!count){msg=this.emptyMsg;}
else if(count<totalCount){msg=String.format(this.pagingDisplayMsg,this.cursor+1,this.cursor+count,totalCountPrecisionMsg+totalCount);if(!this.enablePaging){msg+=' '+this.pageLimitReachedMsg;}}
else{msg=String.format(this.totalDisplayMsg,totalCountPrecisionMsg+count);}
this.displayItem.setText(msg);}
else{this.displayItem.setText(' ');}},pageLimitReachedMsg:'(export for full list)',handleExport:function(){var url;if(this.gridOwner&&this.gridOwner.activityFilters){url=this.getUrlActiveFilters();}else{url=this.exportUrl;}
MktMessage.showExport();location=url;},getUrlActiveFilters:function(){var url=this.exportUrl;if(!this.gridOwner||!this.gridOwner.activityFilters){return url;}
var actQueryString=this.gridOwner.activityFilters.getExportQueryString();if(actQueryString&&actQueryString.length>0&&url){url+=(url.indexOf('?')!=-1?'&':'?')+actQueryString;}
return url;},initSlotItems:function(){if(this.enableExport){var handler=isDefined(this.exportHandler)?this.exportHandler:this.handleExport;this.insertAdjacentFill(new Ext.Toolbar.Spacer(),!this.rightAlignExport);this.insertAdjacentFill(new Ext.Button({text:this.exportText,tooltip:this.exportTooltip,iconCls:this.exportIcon,handler:handler.createDelegate(this)}),!this.rightAlignExport);}}});Ext.app.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.SearchField.superclass.initComponent.call(this);this.on('specialkey',function(f,e){if(e.getKey()==e.ENTER){this.onTrigger2Click();}},this);},onRender:function(ct,position){Ext.app.SearchField.superclass.onRender.call(this,ct,position);if(this.tooltip){this.getEl().dom['qtip']=this.tooltip;}
if(this.grid.query){this.el.dom.value=this.grid.query;this.triggers[0].show();this.hasSearch=true;}},validationEvent:false,validateOnBlur:false,trigger1Class:'x-form-clear-trigger',trigger2Class:'x-form-search-trigger',hideTrigger1:true,width:180,hasSearch:false,queryParamName:'query',onTrigger1Click:function(){if(this.hasSearch){var o={start:0};o[this.queryParamName]='';this.el.dom.value=this.grid.query='';console.debug('Clearing search for grid: ',this.grid);if(this.grid.enableTotalCountAsyncLoading){this.grid.refreshTotalHandler(null);this.grid.requestTotalCountAsync=true;}
this.store.reload({params:o});this.triggers[0].hide();this.hasSearch=false;}},onTrigger2Click:function(){var newQuery=this.getRawValue();if(newQuery.length<1){this.onTrigger1Click();return;}
var o={start:0};o[this.queryParamName]=newQuery;if(this.grid.enableTotalCountAsyncLoading){this.grid.requestTotalCountAsync=true;}
this.store.reload({params:o});this.hasSearch=true;this.grid.query=newQuery;this.triggers[0].show();}});MktGrids.SelectedRowsCountField=Ext.extend(Ext.form.Label,{selectionModel:null,store:null,selectedMsg:'{0} {1} selected',selectedSingularText:'row',selectedPluralText:'rows',initComponent:function(){MktGrids.SelectedRowsCountField.superclass.initComponent.call(this);this.selectionModel.on('selectionchange',this.updateText.createDelegate(this));},setText:function(){var count=this.selectionModel.getCount();this.text=String.format(this.selectedMsg,count,count==1?this.selectedSingularText:this.selectedPluralText);},updateText:function(){this.setText();if(this.rendered){this.el.dom.innerHTML=this.text;}},onRender:function(ct,position){this.setText();MktGrids.SelectedRowsCountField.superclass.onRender.call(this,ct,position);}});MktGrids.QuickSearchPagingToolbar=Ext.extend(MktGrids.ExportPagingToolbar,{searchEmptyText:'Quick Search...',searchQtip:null,searchWidth:160,showSelectionCount:false,selectedSingularText:'row',selectedPluralText:'rows',selectedRowsCountWidth:150,enableTotalCountRefresh:false,enableTotalCountAsyncLoading:false,initComponent:function(){if(this.enableTotalCountRefresh){this.totalDisplayMsg='<a href="#" onclick="return false;" ext:qtip="Recalculate" ext:qwidth="70">'+this.totalDisplayMsg+'</a>';this.pagingDisplayMsg='<a href="#" onclick="return false;" ext:qtip="Recalculate" ext:qwidth="70">'+this.pagingDisplayMsg+'</a>';}
this.configTotalDisplayMsg=this.totalDisplayMsg;this.configPagingDisplayMsg=this.pagingDisplayMsg;MktGrids.QuickSearchPagingToolbar.superclass.initComponent.call(this);},initSlotItems:function(){MktGrids.QuickSearchPagingToolbar.superclass.initSlotItems.call(this);this.insertAdjacentFill(new Ext.Toolbar.Separator(),true);this.searchField=new Ext.app.SearchField({width:this.searchWidth,emptyText:this.searchEmptyText,tooltip:this.searchQtip,store:this.store,grid:this.gridOwner});this.insertAdjacentFill(this.searchField,true);if(this.showSelectionCount){this.insertAdjacentFill(new Ext.Toolbar.Separator(),true);this.selectedRowsCountField=new MktGrids.SelectedRowsCountField({selectionModel:this.selectionModel,store:this.store,width:this.selectedRowsCountWidth,selectedSingularText:this.selectedSingularText,selectedPluralText:this.selectedPluralText});this.insertAdjacentFill(this.selectedRowsCountField,true);}},doLoad:function(start){var o={},pn=this.store.paramNames;this.gridOwner.query=this.searchField.getRawValue();o['query']=this.gridOwner.query;o[pn.start]=start;if(this.store.reader&&this.store.reader.jsonData&&this.store.reader.jsonData.token){o['token']=this.store.reader.jsonData.token;}
o[pn.limit]=this.pageSize;o['pageSize']=this.pageSize;this.store.load({params:o});},doRefresh:function(){if(this.refreshHandler&&isFunction(this.refreshHandler)){this.refreshHandler();}
else{MktGrids.QuickSearchPagingToolbar.superclass.doRefresh.apply(this,arguments);}},onRender:function(){MktGrids.QuickSearchPagingToolbar.superclass.onRender.apply(this,arguments);if(this.enableTotalCountRefresh){this.displayItem.on('afterRender',this.addTotalClickAction,this);}
if(this.enableTotalCountAsyncLoading){this.gridOwner.refreshTotalHandler();}},addTotalClickAction:function(){this.displayItem.getEl().on('click',this.gridOwner.refreshTotalHandler.createDelegate(this.gridOwner,['exact']));},updateTempDisplayMsg:function(msg,withAjaxIndicator){if(withAjaxIndicator){var width=Math.max(msg.length*5,90);this.displayItem.setText("<div style='width: "+width+"px; position:relative; right: 0px;'><div class='mkt-disabled-tbar-loading' style='width: 16px; height: 16px; margin-top: 0; float:left; padding-right:2px;'></div><div style='float: left; margin-top: 2px;'>"+msg+"</div></div>");}
else{this.displayItem.setText(msg);}},updatePaging:function(){var totalCount=this.getAsyncTotalCount();var d=this.getPageData(),ap=d.activePage,ps=d.pages;this.afterTextItem.setText(String.format(this.afterPageText,ps));this.inputItem.setValue(ap);this.first.setDisabled(ap==1);this.prev.setDisabled(ap==1);this.next.setDisabled(ap==ps);this.last.setDisabled(ap==ps);this.refresh.enable();this.updateInfo();},getPageData:function(){var totalCount=this.getAsyncTotalCount();var totalPages=Math.ceil(totalCount/this.pageSize);if(totalPages>0&&Math.ceil(this.cursor/this.pageSize)>=totalPages&&this.store&&this.store.reader&&isDefined(this.store.reader.jsonData)){var correctedCursor=this.store.reader.jsonData.start;if(isDefined(correctedCursor)){this.cursor=correctedCursor;}}
return{total:totalCount,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:totalCount<this.pageSize?1:totalPages};},restoreDisplayMsg:function(){this.totalDisplayMsg=this.configTotalDisplayMsg;this.pagingDisplayMsg=this.configPagingDisplayMsg;var origTotalCount=this.getAsyncTotalCount();var origCursor=this.cursor;this.updatePaging();if((origTotalCount>0)&&(origCursor>=origTotalCount||this.cursor<0)&&this.store){console.debug('Cursor out of bounds ... reloading store');this.store.reload();}}});MktGrids.TotalToolbar=Ext.extend(MktGrids.ExportPagingToolbar,{showRefreshButton:false,rightAlignExport:true,initComponent:function(){MktGrids.TotalToolbar.superclass.initComponent.call(this);this.store.on('add',this.updateInfo,this);this.store.on('remove',this.updateInfo,this);},initSlotItems:function(){MktGrids.TotalToolbar.superclass.initSlotItems.call(this);if(this.store&&this.store.getCount()>-1){this.updateInfo();}},onRender:function(ct,position){Ext.PagingToolbar.superclass.onRender.call(this,ct,position);this.items.clear();if(this.showRefreshButton){this.loading=this.addButton({text:this.refreshText,tooltip:this.refreshTooltip,iconCls:this.refreshIcon,handler:this.doRefresh.createDelegate(this)});}
if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded);}
this.initSlotItems();if(this.displayInfo){this.add('->');this.add(this.displayItem=new Ext.Toolbar.TextItem({}));}},doLoad:function(start){var o=Ext.apply({},this.refreshParams);var pn=this.store.paramNames;o[pn.start]=start;o[pn.limit]=this.pageSize;o['pageSize']=this.pageSize;if(this.fireEvent('beforechange',this,o)!==false){this.store.load({params:o});}},onLoad:function(store,r,o){if(!this.rendered){this.dsLoaded=[store,r,o];return;}
this.cursor=o.params?o.params[this.store.paramNames.start]:0;if(this.loading){this.loading.enable();}
if(!this.enablePaging){this.updateInfo();}}});MktGrids.CheckColumn=function(config){Ext.apply(this,config);if(!this.id){this.id=Ext.id();}
this.renderer=this.renderer.createDelegate(this);};MktGrids.CheckColumn.prototype={init:function(grid){this.grid=grid;this.grid.on('render',function(){var view=this.grid.getView();view.mainBody.on('mousedown',this.onMouseDown,this);},this);},onMouseDown:function(e,t){if(t.className&&t.className.indexOf('x-grid3-cc-'+this.id)!=-1){e.stopEvent();var index=this.grid.getView().findRowIndex(t);var record=this.grid.store.getAt(index);record.set(this.dataIndex,!record.data[this.dataIndex]);}},renderer:function(v,p,record){p.css+=' x-grid3-check-col-td';return'<div class="x-grid3-check-col'+(v?'-on':'')+' x-grid3-cc-'+this.id+'">&#160;</div>';}};MktGrids.ButtonColumn=function(config){Ext.apply(this,config);if(!this.id){this.id=Ext.id();}
this.renderer=this.renderer.createDelegate(this);};MktGrids.ButtonColumn.prototype={init:function(grid){this.grid=grid;this.grid.on('render',function(){var view=this.grid.getView();view.mainBody.on('click',this.onMouseDown,this);},this);},onMouseDown:function(e,t){if(t.className&&t.className.indexOf('x-grid3-button-'+this.id)!=-1){e.stopEvent();var index=this.grid.getView().findRowIndex(t);var record=this.grid.store.getAt(index);this.clickHandler(index,record);}},clickHandler:function(rowIndex,record){},renderer:function(v,p,record){return'<div class="'+this.cls+'"><span class="clickable x-grid3-cell-clickable x-grid3-button-'+this.id+'">'+v+'</span></div>';}};MktGrids.JsonGroupingStore=function(c){MktGrids.JsonGroupingStore.superclass.constructor.call(this,Ext.apply(c,{proxy:!c.data?new Ext.data.HttpProxy({url:c.url}):undefined,reader:(!c.reader&&c.fields)?new Ext.data.JsonReader(c,c.fields):c.reader,getGroupSortDirection:function(){var groupSortDir=this.fields.get(this.groupField).sortDir;var colSortDir=this.fields.get(this.sortInfo.field).sortDir;if(groupSortDir==colSortDir){return this.sortInfo.direction;}
else{return groupSortDir;}},applySort:function(){try{Ext.data.GroupingStore.superclass.applySort.call(this);if(!this.groupOnSort&&!this.remoteGroup){var gs=this.getGroupState();if(gs&&gs!=this.sortInfo.field&&!this.sortByField){this.sortData(this.groupField,this.getGroupSortDirection());}else if(this.sortByField){this.sortData(this.sortInfo.field,this.sortInfo.direction);}}}
catch(e){console.debug('MktGrids.applySort could not find sort column',e);}}}));};Ext.extend(MktGrids.JsonGroupingStore,Ext.data.GroupingStore);MktGrids.CheckColumnModel=Ext.extend(Ext.grid.ColumnModel,{revertFailedValidation:true,customEditorKey:"customEditorKey",initComponent:function(){MktGrids.CheckColumnMode.superclass.initComponent.call(this);},revertCheck:function(column,colIndex,rowIndex){var grid=column.grid;var prevChecked=this.findPrevChecked(column,rowIndex);if(prevChecked){var prevColIndex=this.getIndexById(prevChecked.id);if(prevColIndex!=-1){prevChecked.onCellClick(grid,rowIndex,prevColIndex);}}},findPrevChecked:function(column,rowIndex){if(isUndefined(column)||isUndefined(column.grid)){return null;}
var store=column.grid.getStore();var rec=store.getAt(rowIndex);if(rec){var dataIndex=rec.data[column.virtualColumnPrevChecked];var columns=this.getColumnsBy(this.getColumnByDataIndex,{dataIndex:dataIndex});if(isDefined(columns)&&columns.length>=1){return columns[0];}else{console.log("Error: unexpected number of column found");}}
return null;},getColumnByDataIndex:function(columnConfig,index){if(this.dataIndex==columnConfig.dataIndex){return true;}else{return false;}},isCellReadonly:function(column,colIndex,rowIndex){if(isUndefined(column.grid)||isUndefined(column.grid.getStore())){return false;}
var store=column.grid.getStore();if(store){var rec=store.getAt(rowIndex);if(rec){return rec.json.readonly||(!rec.json['__FieldAllowCustom__']&&column.id==='Custom');}}},isCellEditable:function(colIndex,rowIndex){if(this.isCellReadonly(this.config[colIndex],colIndex,rowIndex)){return false;}else{return MktGrids.CheckColumnModel.superclass.isCellEditable.apply(this,arguments);}},getCellEditor:function(colIndex,rowIndex){var editor;var editorConfig={alignment:'tl',completeOnEnter:true,cls:'checkCellEditor',shadow:false};if(isDefined(this.config[colIndex])&&isDefined(this.config[colIndex]['editorCallback'])&&isFunction(this.config[colIndex]['editorCallback'])){var editorField=this.config[colIndex]['editorCallback'](this.config[colIndex],colIndex,rowIndex);if(editorField){if(this.currentEditor){this.currentEditor.completeEdit();}
if(isDefined(this.config[colIndex][this.customEditorKey+rowIndex])){return this.currentEditor=this.config[colIndex][this.customEditorKey+rowIndex];}
editor=new Ext.Editor(editorField,editorConfig);if(this.revertFailedValidation){editor.on("canceledit",this.revertCheck.createDelegate(this,[this.config[colIndex],colIndex,rowIndex]));}
if(editorField.xtype=="datefield"){var tempGetValue=editor.getValue;editor.getValue=function(){if(this.field&&this.field.getRawValue){return this.field.getRawValue();}else{return tempGetValue();}}.createDelegate(editor);}else if(editorField.xtype=="checkbox"){editor.getValue=function(){value=this.field.getValue();return value?"1":"";}.createDelegate(editor);}
this.currentEditor=this.config[colIndex][this.customEditorKey+rowIndex]=editor;}}
if(isUndefined(editor)){editor=new Ext.Editor(new Ext.form.TextField({msgTarget:'qtip'}),editorConfig);}
return editor;}});MktGrids.CheckBColumn=function(config){Ext.apply(this,config);this.id=config.id||Ext.id();};MktGrids.CheckBColumn=Ext.extend(MktGrids.CheckBColumn,Ext.grid.Column,{dataIndex:'',enableHeaderControl:true,keepOneSelected:true,width:200,headerChecked:false,fixed:false,virtualColumnSfx:'Checked',trackPreviouslyChecked:true,virtualColumnPrevChecked:'PreviouslyChecked',exclusiveCheckRow:true,enableCellEdit:true,init:function(grid){grid.on('cellclick',this.onCellClick,this);grid.on('headerclick',this.onHeaderClick,this);this.header=this.checkedHeader?this.getCheckedHeaderHtml():this.getUncheckedHeaderHtml();this.grid=grid;},onHeaderClick:function(grid,columnIndex,event){var cm=grid.getColumnModel();columnId=cm.getColumnId(columnIndex);if(this.id==columnId&&(this.keepOneSelected&&this.headerChecked===false)||!this.keepOneSelected){this.toggleHeaderValue();var store=grid.getStore();var ct=store.getCount();var clearHeaderColCheck=false;if(this.headerChecked&&this.exclusiveCheckRow){var cCount=cm.getColumnCount();for(var x=0;x<cCount;x++){if(x==columnIndex){continue;}
var column=cm.getColumnById(cm.getColumnId(x));if(typeof column.setHeaderValue=="function"){column.setHeaderValue(false);}
for(var y=0;y<ct;y++){var record=store.getAt(y);if(!record.json['__FieldAllowCustom__']&&columnId==='Custom'){clearHeaderColCheck=true;continue;}
if(typeof column.setValue=="function"){column.setValue(y,false);}}}}
for(var i=0;i<ct;i++){this.setValue(i,this.headerChecked);}
if(clearHeaderColCheck){var column=cm.getColumnById(columnId);column.setHeaderValue(false);}}},getUncheckedHeaderHtml:function(){return['<div><div style="float:left;">',this.text,'</div><div class="x-grid3-check-col" style="margin-right: 4px;"></div></div>'].join('');},getCheckedHeaderHtml:function(){return['<div><div style="float:left;">',this.text,'</div><div class="x-grid3-check-col x-grid3-check-col-on" style="margin-right: 4px;"></div></div>'].join('');},setText:function(text){this.text=text;this.header=this.headerChecked?this.getCheckedHeaderHtml():this.getUncheckedHeaderHtml();this.grid.getView().updateHeaders();},toggleHeaderValue:function(){this.setHeaderValue(!this.headerChecked);},setHeaderValue:function(value){var cm=this.grid.getColumnModel();var column=cm.getColumnById(this.id);if(this.headerChecked!=value&&this.enableHeaderControl===true){this.header=value?this.getCheckedHeaderHtml():this.getUncheckedHeaderHtml();this.headerChecked=value;this.grid.getView().updateHeaders();}},onCellClick:function(grid,rowIndex,columnIndex,event){var cm=grid.getColumnModel();var columnId=cm.getColumnId(columnIndex);if(columnId!=this.id)return;var record=this.grid.getStore().getAt(rowIndex);var currValue=record.data[this.dataIndex+this.virtualColumnSfx];if(!((currValue===false&&this.keepOneSelected)||!this.keepOneSelected)){return;}
if(!record.json['__FieldAllowCustom__']&&columnId==='Custom'){return;}
var cCount=cm.getColumnCount();var column;for(var i=0;i<cCount;i++){column=cm.getColumnById(cm.getColumnId(i));if(typeof column.setHeaderValue=="function"){column.setHeaderValue(false);}}
if(this.exclusiveCheckRow&&!currValue){cCount=cm.getColumnCount();for(var j=0;j<cCount;j++){column=cm.getColumnById(cm.getColumnId(j));if(typeof column.setValue=="function"){column.setValue(rowIndex,false);}}}
if(columnId==this.id){this.toggleCheck(rowIndex);}},toggleCheck:function(rowIndex){var record=this.grid.getStore().getAt(rowIndex);var currValue=record.data[this.dataIndex+this.virtualColumnSfx];this.setValue(rowIndex,!currValue);},getPrevChecked:function(rowIndex){if(isUndefined(this.grid)||isUndefined(this.grid.getStore())||isUndefined(rowIndex)){return null;}
var rec=this.grid.getStore().getAt(rowIndex);if(rec){return rec.data[this.virtualColumnPrevChecked];}
return null;},setValue:function(rowIndex,value){var record=this.grid.getStore().getAt(rowIndex);if(!record.json['__FieldAllowCustom__']&&this.dataIndex==='Custom'){return;}
var currValue=record.data[this.dataIndex+this.virtualColumnSfx];if(currValue==value){return;}else{if(value===false&&this.trackPreviouslyChecked){record.data[this.virtualColumnPrevChecked]=this.dataIndex;}
record.data[this.dataIndex+this.virtualColumnSfx]=value;this.grid.getView().refreshRow(record);}},getValue:function(rowIndex){var record=this.grid.getStore().getAt(rowIndex);if(record){return record.data[this.dataIndex+this.virtualColumnSfx];}},getTextValue:function(rowIndex){var record=this.grid.getStore().getAt(rowIndex);if(record){return record.data[this.dataIndex];}},renderer:function(value,meta,record,rowIndex,columnIndex,store){var checked=false;var checkSuffixKey="Checked";var columnName=store.fields.get(columnIndex).name;if(isUndefined(record.data)||isUndefined(record.data[columnName+checkSuffixKey])){var pass;}
else if(typeof record.data[columnName+checkSuffixKey]!="undefined"){checked=record.data[columnName+checkSuffixKey];}
else if(isDefined(record.data[columnName+checkSuffixKey])){record.data[columnName+checkSuffixKey]=false;}
if(record.json['__FieldIsReference__']&&isObject(value)){for(var key in value){value=value[key];break;}}
if(record.json['readonly']){return['<div class="mktCbColumn"><div class="x-grid3-cel-inner">',value,'</div></div>'].join('');}
else if(!record.json['__FieldAllowCustom__']&&columnName==='Custom'){return'<div class="mktCbColumn xyz"><div class="x-grid3-cel-inner abc"></div></div>';}
else{meta.css='x-grid3-check-col-td'+(checked?' x-grid3-checked':'');return['<div class="mktCbColumn"><div class="x-grid3-check-col-left">',value,'</div><div class="x-grid3-check-col-inner',(checked?' x-grid3-check-col-on':' x-grid3-check-col'),'"></div></div>'].join('');}}});MktGrids.CheckColumnGridView=function(config){Ext.apply(this,config);MktGrids.CheckColumnGridView.superclass.constructor.call(this);};Ext.extend(MktGrids.CheckColumnGridView,Ext.grid.GridView,{disableCellHighlight:true,findCell:function(el){if(!el){return false;}
return this.fly(el).findParent(this.cellSelector,4);},onCellSelect:function(row,col){if(this.disableCellHighlight){return;}
var cell=this.getCell(row,col);if(cell){this.fly(cell).addClass("x-grid3-cell-selected");}},onCellDeselect:function(row,col){if(this.disableCellHighlight){return;}
var cell=this.getCell(row,col);if(cell){this.fly(cell).removeClass("x-grid3-cell-selected");}}});MktGrids.CheckGridPanel=function(config){Ext.apply(this,config);MktGrids.CheckGridPanel.superclass.constructor.call(this);};Ext.extend(MktGrids.CheckGridPanel,MktGrids.CanvasGridPanel,{width:400,disableSelection:true,trackMouseOver:false,height:300,view:new MktGrids.CheckColumnGridView(),frame:false,clicksToEdit:1,initComponent:function(){if(isUndefined(this.cm)&&typeof isDefined(this.columnModel)){var colArr=[];var pluginsArr=[];for(var i=0;i<this.columnModel.length;i++){if(isDefined(this.columnModel[i].type)&&this.columnModel[i].type=='CheckBColumn'){var col=new MktGrids.CheckBColumn(this.columnModel[i]);colArr.push(col);pluginsArr.push(col);}else{colArr.push(this.columnModel[i]);}}
this.plugins=pluginsArr;this.cm=new MktGrids.CheckColumnModel(colArr);}
MktGrids.CheckGridPanel.superclass.initComponent.call(this);this.on('afteredit',function(obj){obj.record.commit();});},startEditing:function(row,col){this.stopEditing();if(this.colModel.isCellEditable(col,row)){this.view.ensureVisible(row,col,true);var r=this.store.getAt(row);var field=this.colModel.getDataIndex(col);var e={grid:this,record:r,field:field,value:r.data[field],row:row,column:col,cancel:false};if(this.fireEvent("beforeedit",e)!==false&&!e.cancel){this.editing=true;var ed=this.colModel.getCellEditor(col,row);if(!ed.rendered){ed.render(this.view.getEditorParent(ed));}
(function(){ed.row=row;ed.col=col;ed.record=r;ed.on("complete",this.onEditComplete,this,{single:true});ed.on("specialkey",this.selModel.onEditorKey,this.selModel);this.activeEditor=ed;var v=this.preEditValue(r,field);var eEl=this.view.getCell(row,col).firstChild.firstChild.firstChild;ed.startEdit(eEl,v===undefined?'':v);}).defer(50,this);}}}});
/* ========== ../mkt-ext-2.0/widgets/GroupSummary.js ============ */

Ext.grid.GroupSummary=function(config){Ext.apply(this,config);};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(grid){this.grid=grid;this.cm=grid.getColumnModel();this.view=grid.getView();var v=this.view;v.doGroupEnd=this.doGroupEnd.createDelegate(this);v.afterMethod('onColumnWidthUpdated',this.doWidth,this);v.afterMethod('onAllColumnWidthsUpdated',this.doAllWidths,this);v.afterMethod('onColumnHiddenUpdated',this.doHidden,this);v.afterMethod('onUpdate',this.doUpdate,this);v.afterMethod('onRemove',this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr></tbody>','</table></div>');this.rowTpl.disableFormats=true;}
this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true;}
this.cellTpl.compile();},toggleSummaries:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass('x-grid-hide-summary');}
el[visible?'removeClass':'addClass']('x-grid-hide-summary');}},renderSummary:function(o,cs){cs=cs||this.view.getColumnData();var cfg=this.cm.config;var buf=[],c,p={},cf,last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];p.id=c.id;p.style=c.style;p.css=i===0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o);}else{p.value='';}
if(p.value==undefined||p.value==="")p.value="&#160;";buf[buf.length]=this.cellTpl.apply(p);}
return this.rowTpl.apply({tstyle:'width:'+this.view.getTotalWidth()+';',cells:buf.join('')});},calculate:function(rs,cs){var data={},r,c,cfg=this.cm.config,cf;for(var j=0,jlen=rs.length;j<jlen;j++){r=rs[j];for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];if(cf.summaryType){data[c.name]=Ext.grid.GroupSummary.Calculations[cf.summaryType](data[c.name]||0,r,c.name,data,cf);}}}
for(var k=0,len2=cs.length;k<len2;k++){c=cs[k];cf=cfg[k];if(cf.summaryType){switch(cf.summaryType){case'average':var total=data[c.name+'total']||0;var count=data[c.name+'count']||0;data[c.name]=count===0?0:total/count;break;case'percent':var n=data[cf['summaryNumerator']]||0.0;var d=data[cf['summaryDenominator']]||0.0;data[c.name]=d===0.0?0.0:n/d;break;case'weighted_average':var summaryTotal=data[c.name+'Total']||0.0;var summaryWeight=data[cf['summaryWeight']]||0.0;data[c.name]=summaryTotal===0.0?0.0:summaryTotal/summaryWeight;break;default:break;}}}
return data;},doGroupEnd:function(buf,g,cs,ds,colCount){var data=this.calculate(g.rs,cs);buf.push('</div>',this.renderSummary({data:data},cs),'</div>');},doWidth:function(col,w,tw){var gs=this.view.getGroups(),s;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];if(s){s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w;}}},doAllWidths:function(ws,tw){var gs=this.view.getGroups(),s,cells,wlen=ws.length;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;cells=s.firstChild.rows[0].childNodes;for(var j=0;j<wlen;j++){cells[j].style.width=ws[j];}}},doHidden:function(col,hidden,tw){var gs=this.view.getGroups(),s,display=hidden?'none':'';for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];if(!s)continue;s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display;}},refreshSummary:function(groupValue){return this.refreshSummaryById(this.view.getGroupId(groupValue));},getSummaryNode:function(gid){var g=Ext.fly(gid,'_gsummary');if(g){return g.down('.x-grid3-summary-row',true);}
return null;},refreshSummaryById:function(gid){var g=document.getElementById(gid);if(!g){return false;}
var rs=[];this.grid.store.each(function(r){if(r._groupId==gid){rs[rs.length]=r;}});var cs=this.view.getColumnData();var data=this.calculate(rs,cs);var markup=this.renderSummary({data:data},cs);var existing=this.getSummaryNode(gid);if(existing){g.removeChild(existing);}
Ext.DomHelper.append(g,markup);return true;},doUpdate:function(ds,record){this.refreshSummaryById(record._groupId);},doRemove:function(ds,record,index,isUpdate){if(!isUpdate){this.refreshSummaryById(record._groupId);}},showSummaryMsg:function(groupValue,msg){var gid=this.view.getGroupId(groupValue);var node=this.getSummaryNode(gid);if(node){node.innerHTML='<div class="x-grid3-summary-msg">'+msg+'</div>';}}});Ext.grid.GroupSummary.Calculations={'sum':function(v,record,field,data,colConfig){return v+(record.data[field]||0);},'count':function(v,record,field,data,colConfig){return data[field+'count']?++data[field+'count']:(data[field+'count']=1);},'max':function(v,record,field,data,colConfig){var max=data[field+'max']===undefined?(data[field+'max']=v):data[field+'max'];return v>max?(data[field+'max']=v):max;},'min':function(v,record,field,data,colConfig){var min=data[field+'min']===undefined?(data[field+'min']=v):data[field+'min'];return v<min?(data[field+'min']=v):min;},'average':function(v,record,field,data,colConfig){var c=data[field+'count']?++data[field+'count']:(data[field+'count']=1);var t=(data[field+'total']=((data[field+'total']||0)+(record.data[field]||0)));return t===0?0:t/c;},'weighted_average':function(v,record,field,data,colConfig){var rowTotal=(record.data[field]||0)*(record.data[colConfig['summaryWeight']]||0);var summaryTotal=(data[field+'Total']=(data[field+'Total']||0)+rowTotal);var summaryWeight=data[colConfig['summaryWeight']]||0.0;return summaryWeight===0.0?0.0:summaryTotal/summaryWeight;},'percent':function(v,record,field,data,colConfig){var n=data[colConfig['summaryNumerator']]||0.0;var d=data[colConfig['summaryDenominator']]||0.0;return d===0.0?0.0:n/d;}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(rs,cs){var gcol=this.view.getGroupField();var gvalue=rs[0].data[gcol];var gdata=this.getSummaryData(gvalue);return gdata||Ext.grid.HybridSummary.superclass.calculate.call(this,rs,cs);},updateSummaryData:function(groupValue,data,skipRefresh){var json=this.grid.store.reader.jsonData;if(!json.summaryData){json.summaryData={};}
json.summaryData[groupValue]=data;if(!skipRefresh){this.refreshSummary(groupValue);}},getSummaryData:function(groupValue){var json=this.grid.store.reader.jsonData;if(json&&json.summaryData){return json.summaryData[groupValue];}
return null;}});
/* ========== ../mkt-ext-2.0/widgets/CanvasHeader.js ============ */

Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.CanvasHeader=Ext.extend(Ext.Panel,{titleValue:'Untitled',descValue:'Click to type a description',subtitle:'',editable:false,titleEditable:true,titleReadonlyReason:'',descEditable:true,titleId:'title',descId:'desc',actionUrl:'analytics/editReportMetaSubmit',serializeParms:{atxRenameReportId:5},enableUpdateCanvasConfig:true,cls:'mktCanvasHeader',editCls:'mktClickToEdit',noEditCls:'mktNoEdit',emptyTitleText:"Please enter a title",bodyStyle:'background: #fff; border-color: #fff; height: 65px',width:700,height:65,editWidth:700,editTitleWidth:500,editDescWidth:500,editHeight:105,savedCallback:Ext.emptyFn,initComponent:function(){this.descValue=this.descValue||"";Mkt.widgets.CanvasHeader.superclass.initComponent.call(this);this._initViewPanel();},_initViewPanel:function(){if(!this.viewTemplate){this.viewTitleId=(this.id?this.id:'')+'titleCanvasHeader';this.viewDescId=(this.id?this.id:'')+'descCanvasHeader';var title='<h1 class="text" id="'+this.viewTitleId+'">{titleValue}</h1>';var desc='<h3 class="text descValue" id="'+this.viewDescId+'">{descValue} {subtitle}</h3>';if(this.editable){if(this.titleEditable){title='<div class="{editCls}">'+title+'</div>';}
else{title='<div class="{noEditCls}" id="readonlyTitleCanvasHeader">'+title+'</div>';}
if(this.descEditable){desc='<div class="{editCls}">'+desc+'</div>';}
else{desc='<div class="{noEditCls}">'+desc+'</div>';}}
this.viewTemplate=new Ext.Template(title+desc);}
this.viewPanel=new Ext.Panel({cls:'mktTopPanel',height:this.height,width:this.width,html:this.viewTemplate.apply(this)});this.add(this.viewPanel);this.viewPanel.on('render',this._initEditEvents,this,{defer:500});},_initEditEvents:function(){if(this.editable){this.getEl().on('click',this._onClick,this);MktPage.initQuickTips();}},_onClick:function(e){var tgt=e.getTarget();if(Ext.fly(tgt).hasClass('text')){this.startEdit(e);}},startEdit:function(e){this.viewPanel.hide(true,.2);if(!this.formPanel){this._initFormPanel();}
this.formPanel.show(true,.2);var tgt=e.getTarget();if(Ext.fly(tgt).hasClass('descValue')){}
else{}},cancelEdit:function(){this.formPanel.hide(true,.2);this.viewPanel.show(true,.2);},getTitleField:function(){if(this.formPanel){return this.formPanel.items.items[0];}},getDescField:function(){if(this.formPanel){return this.formPanel.items.items[1];}},setTitle:function(title){if(this.titleValue==title){return;}
var titleField=this.getTitleField();if(titleField){titleField.setValue(Ext.util.Format.htmlDecode(title));}
var el=Ext.get(this.viewTitleId);if(el){el.update(title);}
this.titleValue=title;},setDesc:function(desc){if(this.descValue==desc){return;}
var descField=this.getDescField();if(descField){descField.setValue(Ext.util.Format.htmlDecode(desc));}
var el=Ext.get(this.viewDescId);if(el){el.update(desc);}
this.descValue=desc;},updateCanvasConfig:function(){if(!this.enableUpdateCanvasConfig){return;}
var canvas=MktCanvas.getActiveTab();if(canvas){canvas.config.title=this.newTitleValue;canvas.config.description=this.newDescValue;}},saveEdit:function(){this.serializeParms[this.titleId]=this.getTitleField().getValue();this.serializeParms[this.descId]=this.getDescField().getValue();this.newTitleValue=Ext.util.Format.htmlEncode(this.serializeParms[this.titleId]);this.newDescValue=Ext.util.Format.htmlEncode(this.serializeParms[this.descId]);this.updateCanvasConfig();MktSession.ajaxRequest(this.actionUrl,{serializeParms:this.serializeParms,containerId:this.id,onMySuccess:this.saveReponse.createDelegate(this)});},specialKey:function(formPanel,e){var key=e.getKey();var target=e.getTarget();switch(key){case 13:this.saveEdit();break;case 9:}},saveReponse:function(){if(MktPage.appVars.editCanvasHeaderError){this.formPanel.items.items[0].markInvalid(MktPage.appVars.editCanvasHeaderError);delete MktPage.appVars.editCanvasHeaderError;return;}
this.formPanel.hide(true,.2);this.titleValue=this.newTitleValue;this.descValue=this.newDescValue;this.viewPanel.body.update(this.viewTemplate.apply(this));this.viewPanel.show(true,.2);MktPage.updateFullTitle();if(isFunction(this.savedCallback)){this.savedCallback();}},_initFormPanel:function(){this.formPanel=new Ext.Panel({cls:'x-plain mktCanvasHeaderForm',bodyStyle:'background: transparent; border: transparent; margin-left: 8px;',width:this.editWidth,height:this.editHeight,autoHeight:true,buttonAlign:'right',layout:'form',defaultType:'textfield',items:[{name:this.titleId,value:Ext.util.Format.htmlDecode(this.titleValue),disabled:!this.titleEditable,blankText:this.emptyTitleText,allowBlank:false,cls:'inputH1',width:this.editTitleWidth,height:28,hideLabel:true,msgTarget:'side',tabIndex:1,listeners:{'specialkey':this.specialKey.createDelegate(this)}},{name:this.descId,value:Ext.util.Format.htmlDecode(this.descValue),disabled:!this.descEditable,cls:'inputH3',style:'margin-top: -1px',width:this.editDescWidth,height:22,hideLabel:true,tabIndex:2,listeners:{'specialkey':this.specialKey.createDelegate(this)}}],buttons:[{text:'Save',iconCls:'mkiOk',handler:this.saveEdit.createDelegate(this),tabIndex:4},{text:'Cancel',iconCls:'mkiCancel',handler:this.cancelEdit.createDelegate(this),tabIndex:5}]});this.add(this.formPanel);this.formPanel.on('render',function(){if(!this.titleEditable&&this.titleReadonlyReason.length>0){setTimeout(function(){new Ext.ToolTip({target:this.getTitleField().getEl().dom.parentNode.id,html:this.titleReadonlyReason});}.createDelegate(this),1000);}}.createDelegate(this));this.doLayout();}});
/* ========== ../mkt-ext-2.0/widgets/ImprovedComboBox.js ============ */

Ext.form.ImprovedComboBox=Ext.extend(Ext.form.ComboBox,{disableAutosuggest:false,disableAutoselect:false,autoExpandTrigger:false,contextMenuConfig:false,twinTriggerConfig:false,disableAutosuggestOnEmpty:false,triggerTip:{title:'',text:''},store:new Ext.data.Store({}),initComponent:function(){this.initPreventExpandOnLoad();if(this.disableAutosuggest){this.initDisableTriggerAction();}
Ext.form.ImprovedComboBox.superclass.initComponent.call(this);this.initAutoExpandTrigger();this.initTriggers();if(this.mode=='remote'&&this.disableAutosuggestOnEmpty){this.initQuery=function(){var v=this.getRawValue();if(v==''){this.collapse();}
else{this.doQuery(v);}};}
this.on('beforeQuery',this.onBeforeQuery);this.on('render',this.initContextMenu);},initAutoExpandTrigger:function(){if(!this.autoExpandTrigger)return;this.on("focus",function(e){this.initList();if(this.autoExpandTrigger=='all'||this.value==''){this.doQuery(this.allQuery,true);}
else{this.doQuery(this.getRawValue());}},this);},initPreventExpandOnLoad:function()
{if(!this.preventExpandOnLoad){return;}
this.onLoad=function(store){var hadFocus=this.hasFocus;if(store&&store===this.getStore()){this.hasFocus=null;}
Ext.form.ImprovedComboBox.prototype.onLoad.apply(this,arguments);if(this.hasFocus===null){this.hasFocus=hadFocus;}
this.onLoad=Ext.form.ImprovedComboBox.prototype.onLoad;};},initContextMenu:function(){if(!this.contextMenuConfig)return;var config=this.contextMenuConfig;if(this.el){switch(config.trigger||'contextmenu'){case'hover':this.el.on('mouseover',this.showContextMenu,this,{delay:500});this.el.on('mouseout',this.hideContextMenu,this,{delay:500});break;case'contextmenu':default:this.el.on('contextmenu',this.showContextMenu,this,{stopEvent:true});}}},showContextMenu:function(){if(!this.getValue()){return;}
if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu(this.contextMenuConfig);}
var align=this.contextMenuConfig.align;switch(align||'right'){case'left':this.contextMenu.show(this.getEl(),'tr-tl');break;case'top':this.contextMenu.show(this.getEl(),'bl-tl');break;case'bottom':this.contextMenu.show(this.getEl(),'tl-bl');break;case'right':default:var pos=this.getPosition();var size=this.getSize();pos[0]+=size.width+24;this.contextMenu.showAt(pos);}
return false;},hideContextMenu:function(){if(this.contextMenu){this.contextMenu.hide();}},onBeforeQuery:function(qe){},onLoad:function(){if(!this.hasFocus||!this.store){return;}
if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select();}
if(!this.disableAutoselect&&!this.selectByValue(this.value,true)){this.select(0,true);}}
else{if(!this.disableAutoselect){this.selectNext();}
if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay);}}}
else{this.collapse();}},onViewClick:function(doFocus){var index=this.view.getSelectedIndexes()[0];var r=this.store.getAt(index);if(r){this.onSelect(r,index);}
else{this.collapse();}
if(doFocus!==false){this.el.focus();}},onTypeAhead:function(){try{Ext.form.ImprovedComboBox.superclass.onTypeAhead.call(this);}
catch(e){}},doQuery:function(q,forceAll){try{Ext.form.ImprovedComboBox.superclass.doQuery.call(this,q,forceAll);}
catch(e){}},selectByValue:function(v,scrollIntoView){if(v!==undefined&&v!==null){var r=this.findRecord(this.valueField||this.displayField,v);if(r){this.select(this.store.indexOf(r),scrollIntoView);return true;}}
return false;},initDisableTriggerAction:function(){this.minChars=999;this.onTriggerClick=Ext.emptyFn;},initTriggers:function(){var triggers=[];if(this.twinTriggerConfig){if(this.twinTriggerConfig.icon){triggers.push({tag:"div",cls:this.twinTriggerConfig.cls,style:this.twinTriggerConfig.style||'',cn:[{tag:"img",src:this.twinTriggerConfig.icon,cls:"x-twin-trigger",'ext:qtip':this.twinTriggerConfig.qtip||''}]});}
else if(this.twinTriggerConfig.iconCls){triggers.push({tag:"img",src:Ext.BLANK_IMAGE_URL,tooltip:this.twinTriggerConfig.qtip||'',cls:"x-twin-trigger "+this.twinTriggerConfig.iconCls});}
else{triggers.push({tag:"img",src:Ext.BLANK_IMAGE_URL,tooltip:this.twinTriggerConfig.qtip||'',cls:"x-form-trigger x-twin-trigger "+this.twinTriggerConfig.cls});}}
if(!this.disableAutosuggest){triggers.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass,'ext:qtitle':this.triggerTip.title,'ext:qtip':this.triggerTip.text});}
this.triggerConfig={tag:'span',cls:'x-form-twin-triggers',cn:triggers};},initTrigger:function(){var ts=this.trigger.select('img',true);ts.each(function(t,all,index){var triggerIndex='Trigger'+(index+1);if(t.dom.className.indexOf('x-twin-trigger')!=-1){t.on("click",this.onTwinTriggerClick,this,{preventDefault:true});this.twinTrigger=t;}
else if(t.dom.className.indexOf('x-form-trigger')!=-1){t.on("click",this.onTriggerClick,this,{preventDefault:true});this.autosuggestTrigger=t;}},this);var ft=this.trigger.select('x-form-trigger',true);this.wrap.setStyle('overflow','hidden');var triggerField=this;ft.each(function(t,all,index){t.hide=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='none';triggerField.el.setWidth(w-triggerField.trigger.getWidth());};t.show=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='';triggerField.el.setWidth(w-triggerField.trigger.getWidth());};var triggerIndex='Trigger'+(index+1);if(this['hide'+triggerIndex]){t.dom.style.display='none';}
t.addClassOnOver('x-form-trigger-over');t.addClassOnClick('x-form-trigger-click');},this);},onTwinTriggerClick:function(e){alert('not implemented');}});Mkt.widgets.DateComboField=Ext.extend(Ext.form.ImprovedComboBox,{minChars:0,forceSelection:false,typeAhead:false,triggerAction:'all',selectOnFocus:false,mode:'remote',allowBlank:true,loadingText:'Searching...',initComponent:function(){this.dateField=new Ext.form.DateField(this.dateConfig),Mkt.widgets.DateComboField.superclass.initComponent.call(this);},getErrors:function(){return this.dateField.getErrors();},twinTriggerConfig:{iconCls:'mkiTrigger mkiDateTrigger flush'},onTwinTriggerClick:function(){if(this.disabled){return;}
if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false});}
this.onFocus();var dateToSet=this.getValue()?this.dateField.parseDate(this.getValue()):new Date();this.menu.picker.setValue(dateToSet||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents('on');},menuEvents:function(method){this.menu[method]('select',this.onDateSelect,this);this.menu[method]('hide',this.onMenuHide,this);this.menu[method]('show',this.onFocus,this);},onDateSelect:function(m,d){var formattedDate=this.dateField.formatDate(d);this.setValue(formattedDate);this.fireEvent('change',this,formattedDate);this.menu.hide();},onMenuHide:function(){this.focus(false,60);this.menuEvents('un');}});
/* ========== ../mkt-ext-2.0/widgets/ComboBoxRemoteChain.js ============ */

Ext.ns("Mkt","Mkt.widgets");Mkt.widgets.ComboBoxRemoteChain=function(config){Mkt.widgets.ComboBoxRemoteChain.superclass.constructor.call(this,config);this.on(this.onDo,this.triggerChained.createDelegate(this));this.on('disableRemoteChainCombo',this.disableChained.createDelegate(this));this.on('containerHidden',this.onContainerHidden.createDelegate(this));this.on('containerShown',this.onContainerShown.createDelegate(this));};Ext.extend(Mkt.widgets.ComboBoxRemoteChain,Ext.form.ComboBox,{chainedcombo:null,hideContainerWhenDisabled:false,onDo:'select',onProxy:null,elementToHide:null,disableValue:null,destroying:false,lazyInit:false,setValue:function(value){if(!this.store){return;}
if(this.store.getCount()==0){this.store.on('load',this.setValue.createDelegate(this,[value]),null,{single:true});return;}else{Mkt.widgets.ComboBoxRemoteChain.superclass.setValue.call(this,value);this.triggerChained();}},triggerChained:function(){if(this.isDisabledValue()){this.fireEvent('selectDisabled');}else{this.fireEvent('selectEnabled');}
if(this.chainedcombo){this.disableChained();if(this.isDisabledValue()){this.hideChainedContainer();}else{if(this.chainedcombo.store){this.chainedcombo.clearValue();this.chainedcombo.store.proxy=new Ext.data.HttpProxy({url:this.onProxy+this.getValue()});this.chainedcombo.store.load();this.chainedcombo.enable();this.showChainedContainer();}}}
this.fireEvent('selectDone');},disableChained:function(){if(this.chainedcombo){this.chainedcombo.fireEvent('disableRemoteChainCombo');this.chainedcombo.disable();this.chainedcombo.setValue(this.chainedcombo.disableValue);}},showContainer:function(){this.enable();this.show();var el=this.getEl();if(el){el.up('.x-form-item').setDisplayed(true);this.fireEvent('containerShown');}},showChainedContainer:function(){if(this.chainedcombo){this.chainedcombo.enable();this.chainedcombo.show();var el=this.chainedcombo.getEl();if(el){el.up('.x-form-item').setDisplayed(true);this.fireEvent('containerShown');}}},hideContainer:function(){this.hide();var el=this.getEl();if(el){el.up('.x-form-item').setDisplayed(false);this.fireEvent('containerHidden');if(this.hideChainedContainer){this.hideChainedContainer();}}},hideChainedContainer:function(){if(this.chainedcombo){this.chainedcombo.hide();var el=this.chainedcombo.getEl();if(el){el.up('.x-form-item').setDisplayed(false);this.fireEvent('containerHidden');if(this.chainedcombo.hideChainedContainer){this.chainedcombo.hideChainedContainer();}}}},isDisabledValue:function(){return this.getValue()==this.disableValue;},onContainerHidden:function(){if(this.elementToHide!=null){Ext.get(this.elementToHide).hide();}},onContainerShown:function(){if(this.elementToHide!=null){Ext.get(this.elementToHide).show();}}});
/* ========== ../mkt-ext-2.0/widgets/AsyncMenu.js ============ */

AsyncMenu=Ext.extend(Ext.menu.Menu,{url:null,loadOnShow:true,validOnceLoaded:false,dataLoaderConfig:{text:'Loading...',iconCls:'loading-indicator'},show:function(el,pos,parentMenu){if(this.loadOnShow){this.load();}
AsyncMenu.superclass.show.call(this,el,pos,parentMenu);},load:function(){this.loadOnShow=!this.validOnceLoaded;var dataloader=new Ext.menu.Item(this.dataLoaderConfig);var dataconn=new Ext.data.Connection();this.removeAll();this.addItem(dataloader);dataconn.on('requestcomplete',function(dataconn,response){this.remove(dataloader);response=Ext.decode(response.responseText);Ext.each(response.data,function(item){this.add(item)},this);},this);dataconn.on('requestexception',function(){this.removeAll();this.add({text:'Failed to load menu items'});},this);dataconn.request({url:this.url});}});
/* ========== ../mkt-ext-2.0/widgets/ComboChooser.js ============ */

ComboChooser=Ext.extend(Ext.Window,{entryField:null,fmeta:null,dataIndex:null,animateTarget:undefined,title:'Multiple Value Chooser',chooserIntro:'Add multiple values to the text area on the right. Use the search box above to find appropriate values.',chooserFootnote:'Any of the values on the right will qualify for this condition.',width:550,height:320,minWidth:400,minHeight:300,layout:'fit',plain:true,modal:true,bodyStyle:'padding:5px;',buttonAlign:'right',okButtonText:'Ok',asyncClose:false,showChooser:function(){this.show(this.animateTarget);this.afterShowChooser();},afterShowChooser:function(){},onOkButton:function(){this.clearMessage();var limit=50000;var valStr=this.selectedValues.getValue();console.debug("List Limit Check length=",valStr.length,'limit=',limit);if(valStr.length>limit){var tooManyItems='<h2>List limit exceeded</h2><p>Please remove some items and try again.</p>';console.debug(tooManyItems);MktMessage.showWarning(tooManyItems,Ext.emptyFn);return false;}
MktSession.clockCursor();var vals=this.linesToArray(valStr);this.setValue(vals);this.afterOkButton();if(!this.asyncClose){MktSession.unclockCursor();this.close();}},afterOkButton:function(){},onCancelButton:function(){this.close();this.afterCancelButton();},afterCancelButton:function(){},getValue:function(){return this.fmeta.setting[this.dataIndex]||'';},setValue:function(v){this.fmeta.setting[this.dataIndex]=v;},initComponent:function(){Ext.getBody().addClass('mktWaiting');this.initFormPanel();this.initButtons();ComboChooser.superclass.initComponent.call(this);this.on('show',function(){this.loadSelectedValues();Ext.getBody().removeClass('mktWaiting');});},initButtons:function(){this.buttons=[{text:this.okButtonText,iconCls:'mkiOk',handler:this.onOkButton.createDelegate(this)},{text:'Cancel',iconCls:'mkiCancel',handler:this.onCancelButton.createDelegate(this)}]},initEntryField:function(){if(!this.entryField){this.entryField=new Ext.form.TextField({emptyText:'Find...',xtype:'textfield',name:'entryField'});}
this.entryField.anchor='-5';this.entryField.fieldLabel='Add New Value';this.entryField.on('specialkey',this.onEntryFieldSpecialKey.createDelegate(this));},chooserButtonClicked:function(){var vals=this.linesToArray(this.selectedValues.getValue());var v=this.entryField.getValue();if(v==undefined||v=='')return;this.deleteFromArray(vals,v);vals=[v].concat(vals);this.selectedValues.setValue(this.arrayToLines(vals));this.buttons[0].focus();},onEntryFieldChange:function(field){this.chooserButtonClicked();},onEntryFieldSelect:function(field,record,index){this.chooserButtonClicked();},onEntryFieldSpecialKey:function(field,e){if(e.getKey()==e.ENTER){e.stopEvent();this.chooserButton.focus();}
else if(e.getKey()==e.ESC){field.reset();}
else{this.fireEvent('specialkey',field,e);}},isMultiArray:function(v){return typeof(v)=='object'&&v.length>1;},arrayToLines:function(a){return a.join('\r\n');},linesToArray:function(text){var lines=text.split('\n');this.trimArray(lines);return lines;},trimArray:function(a){for(var i=0;i<a.length;i++){a[i]=a[i].trim();if(a[i]==''){a.splice(i,1);i--;}}},deleteFromArray:function(a,v){var idx=a.indexOf(v);while(idx!=-1){a.splice(idx,1);idx=a.indexOf(v);}},loadSelectedValues:function(){var val=this.getValue();if(this.isMultiArray(val)){val=this.arrayToLines(val);}
this.selectedValues.setValue(val);},selectedValuesConfig:{fieldLabel:'Selected Values',xtype:'textarea',name:'selectedValues',anchor:'100% -10',blankText:'No values selected',autoCreate:{tag:"textarea",wrap:"off",style:"height: 130px; overflow: auto !important",autocomplete:"off"}},initFormPanel:function(){this.initEntryField();this.selectedValues=new Ext.form.TextArea(this.selectedValuesConfig);this.chooserButton=new Ext.Button({text:'Add >',iconCls:'mkiAdd2',handler:this.chooserButtonClicked.createDelegate(this)});this.introText=new Ext.Panel({baseCls:'x-plain',anchor:'95% 95%',html:'<div class="chooserTip">'+this.tipText+'</div>'+'<div class="chooserIntro">'+this.chooserIntro+'<br><br>'+this.chooserFootnote+'</div>'});this.messagePanel=new Ext.Panel({html:'',baseCls:"x-plain",anchor:"99% 20%",columnWidth:1.0});this.items=new Ext.form.FormPanel({labelAlign:'top',baseCls:'x-plain',layout:'column',anchor:'90% 90%',style:'padding: 5px; position: fixed;',items:[this.messagePanel,{columnWidth:0.55,layout:'form',baseCls:'x-plain',items:[{layout:'column',baseCls:'x-plain',items:[{columnWidth:0.7,layout:'form',baseCls:'x-plain',items:this.entryField},{columnWidth:0.3,layout:'form',baseCls:'x-plain',style:'margin-top: 19px',items:this.chooserButton}]},this.introText]},{columnWidth:0.45,layout:'form',baseCls:'x-plain',items:this.selectedValues}]});},setMessage:function(message){this.messagePanel.show();this.messagePanel.update('<h2><div class="mktModalInFormMessage" style="display: block;"><div class="mktModalErrorMessage">'+message+'</div></div></h2>');},clearMessage:function(message){this.messagePanel.update('');this.messagePanel.hide();}});
/* ========== ../mkt-ext-2.0/widgets/DataFormPanel.js ============ */

var DPDEBUG=false;var OPER_NONE='';var OPER_IS='is';var OPER_IS_NOT='is not';var OPER_IS_EMPTY='is empty';var OPER_IS_ANY='is any';var OPER_IS_NOT_EMPTY='is not empty';var OPER_STARTS_WITH='starts with';var OPER_NOT_STARTS_WITH='not starts with';var OPER_CONTAINS='contains';var OPER_NOT_CONTAINS='not contains';var OPER_GREATER_THAN='greater than';var OPER_LESS_THAN='less than';var OPER_AT_LEAST='at least';var OPER_AT_MOST='at most';var OPER_AFTER='after';var OPER_BEFORE='before';var OPER_ON_OR_AFTER='on or after';var OPER_ON_OR_BEFORE='on or before';var OPER_IN_PAST='in past';var OPER_BETWEEN='between';var OPER_THIS_CAMPAIGN='this campaign';var OPER_IN_TIMEFRAME='in time frame';var TIMEFRAME_SUGGEST=[['today','Today'],['yesterday','Yesterday'],['this_week_ss','This Week (S-S)'],['this_week_mf','This Week (M-F)'],['last_week_ss','Last Week (S-S)'],['last_week_mf','Last Week (M-F)'],['this_month','This Month'],['last_month','Last Month'],['this_quarter','This Quarter'],['last_quarter','Last Quarter'],['this_year','This Year'],['last_year','Last Year']];Mkt.widgets.DataPanelConstants={DATATYPES:{'attribute_name':{isAttributeName:true,disableEditOperation:true,editor:'ComboBox',emptyText:'Select Attribute...',operations:'ATTRIBUTE_NAME_OPERATIONS',specialSuggestConfig:{dataIndex:'attribute_name',displayField:'attribute_name'},refreshOnSpecialKey:true,selectMultiple:false,quicktip:null,displayCls:''},'attribute_name_optional':{isAttributeName:true,disableEditOperation:false,editor:'ComboBox',emptyText:'Select Attribute...',operations:'ATTRIBUTE_NAME_OPERATIONS',specialSuggestConfig:{dataIndex:'attribute_name',displayField:'attribute_name'},forceSelection:true,refreshOnSpecialKey:true,selectMultiple:false,quicktip:null,displayCls:''},'boolean':{emptyText:'Select...',invalidText:'true or false',operations:'IDENTITY_OPERATIONS',width:70,listWidth:70,disableSelectMultiple:true,disableEditOperation:true,forceSelection:true,vtype:'bool',dtSuggestConfig:{mode:'local',data:[['true','true'],['false','false']]},displayCls:''},'flow_condition_name':{isConditionName:true,editor:'ComboBox',emptyText:'Select Condition...',disableEditOperation:true,operations:'ATTRIBUTE_NAME_OPERATIONS',specialSuggestConfig:{dataIndex:'condition_name',displayField:'text',name:'Filter Name'},forceSelection:true,selectMultiple:false,quicktip:null,refreshOnSpecialKey:true,tipText:'Select a filter from the list',displayCls:''},'currency':{editor:'NumberField',flow:{editor:'ComboBox',vtype:'mkt_float_tok'},allowDecimals:true,emptyText:'Enter amount...',invalidText:'Please enter a number',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'custom_assoc':{editor:'ComboBox',emptyText:'Select...',operations:'ASSOC_OPERATIONS',forceSelection:true,selectMultiple:true,displayCls:''},'date':{editor:'DateField',flow:{editor:'DateComboField',vtype:'mkt_date_tok'},emptyText:'Enter date...',invalidText:'Please enter date in the format mm/dd/yyyy',operations:'DATE_OPERATIONS',trigger_operations:'TRIGGER_DATE_OPERATIONS',displayCls:'date'},'datetime':{editor:'DateField',flow:{editor:'DateComboField',vtype:'mkt_date_tok'},emptyText:'Enter date...',invalidText:'Please enter date in the format mm/dd/yyyy',operations:'DATE_OPERATIONS',trigger_operations:'TRIGGER_DATE_OPERATIONS',displayCls:'date'},'date_in_past':{format:'date',editor:'ComboBox',emptyText:'1 hour, 2 days, 1 week, etc.',tipText:'Example: 1 hour, 2 days, 1 week, etc.',operations:'DATE_OPERATIONS',trigger_operations:'TRIGGER_DATE_OPERATIONS',disableAutosuggest:true,selectMultiple:false,displayCls:''},'date_in_timeframe':{format:'date',editor:'ComboBox',emptyText:'Select...',operations:'DATE_OPERATIONS',trigger_operations:'TRIGGER_DATE_OPERATIONS',dtSuggestConfig:{mode:'local',data:TIMEFRAME_SUGGEST},forceSelection:true,selectMultiple:false,displayCls:''},'number_days':{editor:'NumberField',allowDecimals:false,emptyText:'Number of days...',invalidText:'Please enter an integer',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'duplicate_field_values':{editor:'ComboBox',emptyText:'Select...',operations:'DUPL_FIELD_OPERATIONS',overrideLabel:'Field Name',forceSelection:true,selectMultiple:true,displayCls:''},'duration':{editor:'TextField',emptyText:'1 hour, 2 days, 1 week, etc.',tipText:'Example: 1 hour, 2 days, 1 week, etc.',disableAutosuggest:true,selectMultiple:false,displayCls:''},'disabled':{editor:'TextField',emptyText:'',disabled:true,disableEditOperation:true,operations:'IDENTITY_OPERATIONS',displayCls:''},'email':{editor:'ComboBox',emptyText:'Enter email...',vtype:'email',flow:{vtype:'mkt_email_tok'},invalidText:'Please enter a valid email address',operations:'TEXT_OPERATIONS',selectMultiple:true,displayCls:''},'email_list':{editor:'ComboBox',emptyText:'Enter email...',invalidText:'Please enter a valid email address. Separate multiple addresses with commas, spaces, or semicolons',operations:'TEXT_OPERATIONS',selectMultiple:true,displayCls:''},'enum':{editor:'ComboBox',emptyText:'Select...',invalidText:'Please select from the list',operations:'ENUM_OPERATIONS',forceSelection:true,displayCls:''},'float':{editor:'NumberField',flow:{editor:'ComboBox',vtype:'mkt_float_tok'},allowDecimals:true,emptyText:'Enter number...',invalidText:'Please enter a number',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'has_opportunity':{editor:'ComboBox',emptyText:'Select...',operations:'OPPORTUNITY_OPERATIONS',forceSelection:true,selectMultiple:true,displayCls:''},'integer':{editor:'NumberField',flow:{editor:'ComboBox',vtype:'mkt_integer_tok'},allowDecimals:false,emptyText:'Enter number...',invalidText:'Please enter an integer',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'integer_at_least':{editor:'NumberField',allowDecimals:false,emptyText:'Enter number...',invalidText:'Please enter an integer',op:OPER_AT_LEAST,disableEditOperation:true,operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'interesting_moment':{editor:'TextArea',emptyText:'(maximum 140 characters)',operations:'TEXT_OPERATIONS',maxLength:140,displayCls:''},'list_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:true,displayCls:''},'event_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:true,displayCls:''},'mailing_object':{editor:'ComboBox',emptyText:'Select email...',invalidText:'Please select an email from the list',operations:'OBJECT_OPERATIONS',selectMultiple:true,showEmailPreview:true,displayCls:''},'mixed':{editor:'ComboBox',emptyText:'Select...',operations:'TEXT_OPERATIONS',selectMultiple:true,displayCls:''},'object':{editor:'ComboBox',emptyText:'Select...',invalidText:'Please select an item from the list',operations:'OBJECT_OPERATIONS',selectMultiple:true,displayCls:''},'percent':{editor:'NumberField',allowDecimals:false,emptyText:'Enter percent...',invalidText:'Please enter a percentage',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'phone':{editor:'ComboBox',emptyText:'Enter phone...',invalidText:'Please enter a phone number',operations:'TEXT_OPERATIONS',selectMultiple:true,displayCls:''},'random_sample':{editor:'NumberField',allowDecimals:false,emptyText:'Enter percent...',invalidText:'Please enter a percentage',operations:'RANDOM_SAMPLE_OPERATIONS',displayCls:'plain'},'reference':{editor:'ComboBox',emptyText:'Select...',invalidText:'Please select an item from the list',operations:'REFERENCE_OPERATIONS',selectMultiple:true,displayCls:''},'sfdc_campaign_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:true,displayCls:''},'score_change_expr':{editor:'ComboBox',emptyText:'+20, -5, =50, etc.',operations:'BINARY_OPERATIONS',selectMultiple:false,displayCls:''},'score_name':{editor:'ComboBox',emptyText:'Select...',operations:'TEXT_OPERATIONS',selectMultiple:false,defaultValue:['Lead Score'],displayCls:''},'score_value':{editor:'NumberField',allowDecimals:false,emptyText:'Enter number...',invalidText:'Please enter an integer',operations:'NUMERIC_OPERATIONS',displayCls:'plain'},'smart_campaign_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:true,displayCls:''},'smart_campaign_run_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:true,displayCls:''},'smart_list_member':{editor:'ComboBox',emptyText:'Select...',operations:'MEMBERSHIP_OPERATIONS',overrideLabel:'Lead',selectMultiple:false,displayCls:''},'string':{editor:'ComboBox',emptyText:'Select...',operations:'TEXT_OPERATIONS',selectMultiple:true,displayCls:''},'remove_from_flow_op':{editor:'ComboBox',emptyText:'Select...',operations:'REMOVE_FROM_FLOW_OPERATIONS',selectMultiple:true,flowOperations:true,displayCls:''},'text':{editor:'TextField',emptyText:'Enter value...',operations:'TEXT_OPERATIONS',displayCls:''},'textarea':{editor:'TextArea',operations:'TEXT_OPERATIONS',displayCls:''},'url':{editor:'ComboBox',emptyText:'Enter URL...',vtype:'mkt_url',flow:{vtype:'mkt_url_tok'},operations:'TEXT_OPERATIONS',selectMultiple:true,disableAutosuggest:true,displayCls:'plain'},'default':{note:'default reached',editor:'TextField',emptyText:'Enter value...',operations:'TEXT_OPERATIONS',displayCls:''}},TEXT:{select_multiple_values:'Select Multiple Values',select_multiple_qtip:'Click here to select multiple values'},OPER_DISPLAY_NAMES:{'':'N/A'},OPER_DISPLAY_NAMES_OVERRIDE:{'date':{'greater than':OPER_AFTER,'less than':OPER_BEFORE,'at least':OPER_ON_OR_AFTER,'at most':OPER_ON_OR_BEFORE},'datetime':{'greater than':OPER_AFTER,'less than':OPER_BEFORE,'at least':OPER_ON_OR_AFTER,'at most':OPER_ON_OR_BEFORE}},OPER_DISPLAY_NAME_CODES:{'after':OPER_GREATER_THAN,'before':OPER_LESS_THAN,'on or after':OPER_AT_LEAST,'on or before':OPER_AT_MOST,'in':OPER_IS,'not in':OPER_IS_NOT,'true':OPER_IS_ANY,'false':OPER_IS_EMPTY},IDENTITY_OPERATIONS:[[OPER_IS,OPER_IS]],BINARY_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT]],MEMBERSHIP_OPERATIONS:[[OPER_IS,'in'],[OPER_IS_NOT,'not in']],ATTRIBUTE_NAME_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_ANY,OPER_IS_ANY]],ENUM_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_IS_ANY,OPER_IS_ANY]],OPPORTUNITY_OPERATIONS:[[OPER_IS_ANY,'true'],[OPER_IS_EMPTY,'false']],ASSOC_OPERATIONS:[[OPER_IS_ANY,'true'],[OPER_IS_EMPTY,'false']],DUPL_FIELD_OPERATIONS:[[OPER_IS,OPER_IS]],RANDOM_SAMPLE_OPERATIONS:[[OPER_IS,OPER_IS]],REMOVE_FROM_FLOW_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_STARTS_WITH,OPER_STARTS_WITH],[OPER_CONTAINS,OPER_CONTAINS],[OPER_THIS_CAMPAIGN,OPER_THIS_CAMPAIGN]],OBJECT_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_STARTS_WITH,OPER_STARTS_WITH],[OPER_NOT_STARTS_WITH,OPER_NOT_STARTS_WITH],[OPER_CONTAINS,OPER_CONTAINS],[OPER_NOT_CONTAINS,OPER_NOT_CONTAINS],[OPER_IS_ANY,OPER_IS_ANY]],REFERENCE_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_IS_ANY,OPER_IS_ANY]],TEXT_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_STARTS_WITH,OPER_STARTS_WITH],[OPER_NOT_STARTS_WITH,OPER_NOT_STARTS_WITH],[OPER_CONTAINS,OPER_CONTAINS],[OPER_NOT_CONTAINS,OPER_NOT_CONTAINS],[OPER_IS_EMPTY,OPER_IS_EMPTY],[OPER_IS_NOT_EMPTY,OPER_IS_NOT_EMPTY]],NUMERIC_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_BETWEEN,OPER_BETWEEN],[OPER_GREATER_THAN,OPER_GREATER_THAN],[OPER_LESS_THAN,OPER_LESS_THAN],[OPER_AT_LEAST,OPER_AT_LEAST],[OPER_AT_MOST,OPER_AT_MOST],[OPER_IS_EMPTY,OPER_IS_EMPTY],[OPER_IS_NOT_EMPTY,OPER_IS_NOT_EMPTY]],DATE_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_BETWEEN,OPER_BETWEEN],[OPER_IN_PAST,OPER_IN_PAST],[OPER_IN_TIMEFRAME,OPER_IN_TIMEFRAME],[OPER_GREATER_THAN,OPER_AFTER],[OPER_LESS_THAN,OPER_BEFORE],[OPER_AT_LEAST,OPER_ON_OR_AFTER],[OPER_AT_MOST,OPER_ON_OR_BEFORE],[OPER_IS_EMPTY,OPER_IS_EMPTY],[OPER_IS_NOT_EMPTY,OPER_IS_NOT_EMPTY]],TRIGGER_DATE_OPERATIONS:[[OPER_IS,OPER_IS],[OPER_IS_NOT,OPER_IS_NOT],[OPER_BETWEEN,OPER_BETWEEN],[OPER_IN_PAST,OPER_IN_PAST],[OPER_IN_TIMEFRAME,OPER_IN_TIMEFRAME],[OPER_GREATER_THAN,OPER_AFTER],[OPER_LESS_THAN,OPER_BEFORE],[OPER_AT_LEAST,OPER_ON_OR_AFTER],[OPER_AT_MOST,OPER_ON_OR_BEFORE]],HIDDEN_FIELD_OPERATIONS:[OPER_IS_ANY,OPER_IS_EMPTY,OPER_IS_NOT_EMPTY,'true','false',OPER_THIS_CAMPAIGN],COMP_OPERATIONS:[['any','any'],['all','all']],TIMEFRAME_UNITS:[['days','days'],['weeks','weeks'],['months','months'],['quarters','quarters'],['years','years'],['ever','ever']],RUN_ACTION:'RunAction',DEP_LIST:'dependant list',VARIABLE_FORMAT_OPERATIONS:{},init:function(){this.VARIABLE_FORMAT_OPERATIONS[OPER_BETWEEN]=OPER_BETWEEN;this.VARIABLE_FORMAT_OPERATIONS[OPER_IN_PAST]='date_in_past';this.VARIABLE_FORMAT_OPERATIONS[OPER_IN_TIMEFRAME]='date_in_timeframe';}};Mkt.widgets.DataPanelConstants.init();DPConst=Mkt.widgets.DataPanelConstants;Mkt.widgets.DataPanel=Ext.extend(Ext.FormPanel,{dpid:0,animateCollapse:true,dpEditable:true,cls:'mktDataPanel panel-masked',baseCls:'mktDataPanelFrame x-panel',draggable:true,enableDragDrop:false,collapsible:true,margins:'0 0 20 0',title:'Untitled',frame:true,autoWidth:true,autoHeight:true,resizable:false,monitorResize:true,collapseDuringRender:false,maskDuringRender:false,loadMaskConfig:{msg:''},initComponent:function(){if(this.collapseDuringRender){this.collapsed=true;}
else{this.collapsed=this.dpCollapsed;}
this.showLoadMask();this._initTools(this);Mkt.widgets.DataPanel.superclass.initComponent.call(this);this._initStore();this.buildForm(false);},_initTools:function(){if(!this.dpEditable)return;this.tbar=this._createTopPanelToolbar();this.bbar=this._createBottomPanelToolbar();if(!this.canvas){this.collapsible=false;this.draggable=false;return;}
this.tools=[{id:'close',handler:function(e,target,panel){panel.clickClose();}}];},showLoadMask:function(){if(this.maskDuringRender&&!this.loadMaskVisible){this.loadMaskVisible=true;this.addClass('panel-masked');}},_initStore:function(){this.store=new Ext.data.Store();var settings=this.dpMeta[this.SETTINGS];for(var i=0;i<settings.length;i++){var st=settings[i];if(st.alwaysHide){st.hidden=true;}
else if(this.isSmartlist&&!st.alwaysShow&&!st.op){st.hidden=true;continue;}
this.store.add(this._createSettingRecord(this.dpMeta.dpid,st,this.dpMeta.tt));}},hideLoadMask:function(){if(this.loadMaskVisible){this.loadMaskVisible=false;this.removeClass('panel-masked');}},afterRender:function(){Mkt.widgets.DataPanel.superclass.afterRender.call(this);this.rebuildFlowChoiceTitles();this._removeLoadEffects();this._addWatermark();if(!this.dpEditable){this.setCollapsed(true);}
if(this.canvas)MktCanvas.unmask(this.canvas);},_removeLoadEffects:function(){if(this.collapseDuringRender){if(this.items){var lastItem=this.items.items[this.items.items.length-1];lastItem.on('render',this._expandForm,this);}
else{this._expandForm();}}},_expandForm:function(){if(!this.dpCollapsed){this.expand();}
else{this.updateHeader();}},_addWatermark:function(){var iconCls=this.dpMgr.getDPIconCls(this.dpMeta);iconCls=iconCls.replace('mki','mki128');this.watermark=this.bwrap.createChild({cls:'mktDataPanelWatermark '+iconCls});},initEvents:function(){Mkt.widgets.DataPanel.superclass.initEvents.call(this);if(this.dd){this.dd.onBeforeDrag=function(data,e){var target=e.getTarget();if(target.className.indexOf('x-tool')!=-1){return false;}};}
this.on('collapse',this.onDataPanelCollapse);this.on('beforeexpand',this.beforeDataPanelExpand);return true;},highlight:function(){},setCollapsed:function(collapsed){if(collapsed&&!this.collapsed){this.collapse();}
else if(!collapsed&&this.collapsed){this.expand();}},refreshHeader:function(showSummary){var title=this.dpMgr.getDPTitleText(this.dpMeta);var summary='';if(showSummary==undefined){showSummary=this.collapsed;}
if(showSummary){summary='<div class="mktHeaderSummaryText">'+this._writeDataPanelSummary()+'</div>';}
var iconCls=this.dpMgr.getDPIconCls(this.dpMeta);if(!this.iconCls)this.setIconClass(iconCls);this.setTitle(title+summary);},onDataPanelCollapse:function(){this.refreshHeader(true);},beforeDataPanelExpand:function(){this.refreshHeader(false);},_writeDataPanelSummary:function(){if(this.store.getCount()===0){return'no settings';}
var text='';var maxSettings=9;for(var i=0;i<maxSettings;i++){if(i==this.store.getCount())break;var setting=this.store.getAt(i).data;if(text)text+=' <i>&nbsp;and&nbsp;</i> ';text+=this._writeSettingSummary(setting);if(setting.options){for(var j=0;j<setting.options.length;j++){text+=' with '+this._writeSettingSummary(setting.options[j]);}}}
if(this.store.getCount()>maxSettings){text+=' <i>and '+(this.store.getCount()-maxSettings)+' more...</i>';}
return text;},_writeSettingSummary:function(setting){var dt=setting.dt;var val=setting.val;var text=(setting.displayName||setting.name);if(this.isSmartlist){var op=setting.op;text+=' '+this._writeOperationSummary(dt,op);if(this.hiddenOperation(op)){return text;}}
if(val){if(op==OPER_BETWEEN){text+=' '+val+' - '+setting.val2;}
else if(isMultiArray(val)){val=this._saniArray(val);text+=' any of ('+val.length+') '+val.join('; ');}
else{text+=' &ldquo;'+Ext.util.Format.htmlEncode(val)+'&rdquo;';}}
else{text+=' ______';}
var maxlength=100;if(text.length<maxlength){return text;}
var words=text.split(' ');var text2='';for(var i=0;i<words.length;i++){if((text2.length+words[i].length)<maxlength){text2+=words[i]+' ';}}
text2+='...';return text2;},_writeOperationSummary:function(dt,op){var overrides=DPConst.OPER_DISPLAY_NAMES_OVERRIDE;if(overrides[dt]&&overrides[dt][op]){return overrides[dt][op];}
return DPConst.OPER_DISPLAY_NAMES[op]||op||'N/A';},updateDataPanelMeta:function(dpMeta){this.dpMeta.iid=dpMeta.iid;this.dpMeta.errorMeta=this.buildErrorMeta(dpMeta);var dpMetaSettings=dpMeta[this.SETTINGS];for(var i=0;i<dpMetaSettings.length;i++){var stMeta=dpMetaSettings[i];var setting=this.store.getAt(i);setting.data.errorMeta=this.buildErrorMeta(stMeta);this.applyValueError(setting.data.fid,setting.data.errorMeta);if(stMeta.options){for(var j=0;j<stMeta.options.length;j++){var optionMeta=stMeta.options[j];setting=this.store.getAt(i);var optionSetting=setting.data.options[j];optionSetting.errorMeta=this.buildErrorMeta(optionMeta);this.applyValueError(setting.data.fid,optionSetting.errorMeta);}}}},applyValueError:function(fid,errorMeta){if(!errorMeta)return;if(errorMeta.level<3)return;var fs=this.getFormSettingById(fid);var result=this._markInvalid(fs,errorMeta.error,function(field){return field.fmeta.setting.aid==errorMeta.aid&&field.dataIndex=='val';});},_markInvalid:function(component,error,match){if(!component)return null;if(component.markInvalid&&match(component)){component.markInvalid(error);return component;}
if(component&&component.items&&component.items.items){var children=component.items.items;for(var i=0;i<children.length;i++){var rtn=this._markInvalid(children[i],error,match);if(rtn)return rtn;}}
return null;},_clearInvalid:function(component){if(component&&component.clearInvalid){component.clearInvalid();}
if(component&&component.items&&component.items.items){var children=component.items.items;for(var i=0;i<children.length;i++){var rtn=this._clearInvalid(children[i]);}}
return null;},buildErrorMeta:function(meta){if(!meta.error)return null;var errorMeta={};errorMeta={level:meta.errorLevel||3,exception:meta.errorException};if(this.dpMeta.hideEmptyFieldWarnings){if(errorMeta.level==3){if(meta.val===undefined||meta.val===''||(isArray(meta.val)&&meta.val.length==1&&meta.val[0]===null)){errorMeta.level=2.5;}}}
switch(errorMeta.level){case 1:errorMeta.levelText='Info';errorMeta.warning=meta.error;break;case 2:errorMeta.levelText='Warning';errorMeta.warning=meta.error;break;case 2.5:errorMeta.levelText='Empty Field Error';errorMeta.warning=meta.error;break;case 3:errorMeta.levelText='Error';errorMeta.error=meta.error;break;default:errorMeta=null;break;}
if(errorMeta&&DPDEBUG){console.debug('Server returned '+errorMeta.levelText+' for ',meta.name,'  --  "',meta.error,'"');if(errorMeta.exception)console.debug('\texception=',errorMeta.exception);console.debug('\terrorMeta=',errorMeta,"    meta=",meta);}
errorMeta.aid=meta.aid;delete meta.error;delete meta.errorLevel;delete meta.errorException;return errorMeta;},DataPanelRecord:new Ext.data.Record.create([{name:'aid',type:'string'},{name:'order',type:'int'},{name:'displayName',type:'string'},{name:'val',type:'string'},{name:'val2',type:'string'},{name:'defaultVal',type:'string'}]),_createSettingRecord:function(dpid,st,tt){if(st.op==OPER_BETWEEN&&isArray(st.val)&&st.val.length==2){st.val2=[st.val[1]];st.val=[st.val[0]];}
st.val=this._parseServerValue(st.val,st.op);if(st.error){st.errorMeta=this.buildErrorMeta(st);}
if(this.isFlow){if(st.options){for(var i=0;i<st.options.length;i++){st.options[i].val=this._parseServerValue(st.options[i].val,st.options[i].op);st.options[i].defaultVal=st.options[i].val;if(st.options[i].error){st.options[i].errorMeta=this.buildErrorMeta(st.options[i]);}}}
if(st.createCondition){st.condition={aid:null,name:null,displayName:'',dt:'string',format:'mixed',op:OPER_IS,val:[]};delete st.createCondition;}
else if(st.condition){st.condition.name=this._parseServerValue(st.condition.name);st.condition.op=st.condition.op||OPER_IS;st.condition.val=this._parseServerValue(st.condition.val,st.condition.op);if(st.condition.op==OPER_BETWEEN&&isArray(st.condition.val)&&st.condition.val.length==2){st.condition.val2=[st.condition.val[1]];st.condition.val=[st.condition.val[0]];}
if(st.condition.error){st.condition.errorMeta=this.buildErrorMeta(st.condition);}}}
if(!st.val&&(st.displayName=='Program'||st.displayName=='Acquisition Program')){var programName=MktPage.appVars['smartCampaignParentProgramName'];if(programName){st.val=programName;}}
st.op=st.op||OPER_IS;st.defaultVal=st.val;return new this.DataPanelRecord(st);},_parseServerValue:function(v,op){if(v===null){return'';}
else if(typeof(v)=='boolean'){return v;}
else if(typeof(v)=='object'){var va=[];for(var i=0;i<v.length;i++){if(v[i]!==null){if(op==OPER_IN_TIMEFRAME){for(var j=0;j<TIMEFRAME_SUGGEST.length;j++){if(v[i]==TIMEFRAME_SUGGEST[j][0]){v[i]=TIMEFRAME_SUGGEST[j][1];}}}
va.push(v[i]);}}
if(va.length===0){v='';}
else{v=va;}}
else if(v===null){v='';}
return v;},updateMetaData:function(){if(DPDEBUG)console.debug("cloneSettingsForSave",this);if(this.dpMeta.errorMeta){delete this.dpMeta.errorMeta;}
var settings=this.store.data.items;var newsettings=[];for(var rx=0;rx<settings.length;rx++){var storeSetting=settings[rx].data;if(storeSetting.errorMeta){delete storeSetting.errorMeta;this._clearInvalid(this.getFormSettingById(storeSetting.fid));}
var st=this.dpMgr.cloneDataRecord(storeSetting);this._formatSettingsForSave(st,this.isSmartlist);if(st.options){for(var opt=0;opt<st.options.length;opt++){this._formatSettingsForSave(st.options[opt],false);}}
if(this.isFlow){if(rx==settings.length-1){delete st.condition;}
else{this._formatSettingsForSave(st.condition,true);}}
newsettings.push(st);}
this.dpMeta[this.SETTINGS]=newsettings;},_formatSettingsForSave:function(setting,sendAsArray){var val=setting.val;if(setting.op==OPER_BETWEEN){if(setting.val===undefined){setting.val=null;}
if(setting.val2===undefined){setting.val2=null;}
val=this.flattenArray([setting.val,setting.val2]);}
else if(setting.op==OPER_IN_TIMEFRAME){for(var i=0;i<TIMEFRAME_SUGGEST.length;i++){if(setting.val==TIMEFRAME_SUGGEST[i][1]){val=TIMEFRAME_SUGGEST[i][0];}}}
if(val==='')val=null;else if(val==='true')val=true;else if(val==='false')val=false;if(sendAsArray){if(!isArray(val)){val=[val];}}
else{if(isArray(val)){val=val[0];}}
setting.val=val;setting.op=DPConst.OPER_DISPLAY_NAME_CODES[setting.op]||setting.op;delete setting.errorMeta;delete setting.hidden;delete setting.constraintPosition;delete setting.error;delete setting.errorLevel;delete setting.fid;},flattenArray:function(a){if(isArray(a)){for(var i=0;i<a.length;i++){if(isArray(a[i])){if(DPDEBUG)console.debug('flattening nested array=',a);a[i]=a[i][0];}}}
if(DPDEBUG)console.debug('flattenArray returning',a);return a;},buildForm:function(rebuild){if(rebuild){while(this.items.getCount()>1){this.remove(this.items.items[1],true);}}
this.showLoadMask();if(this.items.getCount()==1){this.remove(this.items.items[0],true);}
for(var i=0;i<this.store.getCount();i++){this.addFormSetting(i);}
if(rebuild){this.doLayout();}
this.hideLoadMask();},rebuildFormSetting:function(fid){this.body.setStyle('height',this.body.getHeight()+'px');this.showLoadMask();var formSettings=this.items.items;var fs=null;var itemsLength=this.store.data.items.length;for(var i=0;i<itemsLength;++i){var data=this.store.data;fs=this.getFormSettingById(data.items[i].data.fid);if(fs){if(fs.fmeta&&fs.fmeta.fid==fid){this.remove(fs,true);this.addFormSetting(i,true);break;}}}
this.doLayout();this.hideLoadMask();this.body.setStyle('height','auto');},rebuildFormCondition:function(fid){if(DPDEBUG)console.debug('rebuildFormCondition fid=',fid);this.rebuildFormSetting(fid);this.rebuildFlowChoiceTitles();},getFormSettingById:function(fid){var formSettings=this.items.items;for(var i=0;i<formSettings.length;i++){var fs=formSettings[i];if(fs.fmeta&&fs.fmeta.fid==fid){return fs;}}
return null;},removeFormSettingById:function(fid){var fs=this.getFormSettingById(fid);if(fs){this.remove(fs,true);}},addFormSetting:function(idx,doInsert){var fid=this.dpMgr.generateId("fid-");var dataRecord=this.store.getAt(idx);var setting=dataRecord.data;setting.fid=fid;if(setting.alwaysHide){return;}
var fmeta={fid:fid,dp:this,dataRecord:dataRecord,setting:setting,dt:setting.dt,format:setting.format,dtInfo:this.dtInfoFormat(setting),disabled:!this.dpEditable};if(this.isFlow||(this.isSmartlist&&idx===0)){fmeta.primary=true;fmeta.primarySetting=setting;}
else{fmeta.primary=false;fmeta.primarySetting=this.store.getAt(0).data;}
fmeta.tipText=this.writeTipText(fmeta);fmeta.opedit=this.isOperationEditable(fmeta);var settingConfig={};if(this.isSmartlist){settingConfig.layout='column';settingConfig.items=this._smartlistFormFields(idx,fmeta);this.setBottomToolbarTipText(this.bottomToolbarTipText);}
else{settingConfig.style='padding: 0 0 0 0';settingConfig.layout='column';if(this.store.getCount()==1){settingConfig.items=this._flowFormFields(idx,fmeta);this.setBottomToolbarTipText(this.bottomToolbarTipText);}
else{settingConfig.items=this._flowChoiceFormFields(idx,fmeta);this.setBottomToolbarTipText(this.bottomToolbarTipText||'Note: Only the first matching choice applies');}}
var formSetting;if(doInsert){formSetting=this.insert(idx,settingConfig);}
else{formSetting=this.add(settingConfig);}
formSetting.fmeta=fmeta;fmeta.formSetting=formSetting;if(idx==(this.store.getCount()-1)&&this.maskDuringRender){formSetting.on('render',this.hideLoadMask,this);}},writeEmptyText:function(fmeta,dataIndex){if(fmeta.setting.op==OPER_BETWEEN){var betweenEmptyText=fmeta.dtInfo.betweenEmptyText||['From...','To...'];return betweenEmptyText[dataIndex=='val'?0:1];}
return fmeta.emptyText||fmeta.dtInfo.emptyText||'Select...';},writeTipText:function(fmeta){return fmeta.tipText||fmeta.dtInfo.tipText||'';},LABELWIDTH:75,LABELALIGN:'right',FIELDANCHOR:'98%',getLabelWidth:function(label){if(!this._textMetrics)this._textMetrics=Ext.util.TextMetrics.createInstance('textMetrics');var width=this._textMetrics.getWidth(label);return Math.max(width+10,this.LABELWIDTH);},_smartlistFormFields:function(idx,fmeta){var displayName=fmeta.dtInfo.overrideLabel||fmeta.setting.displayName||fmeta.setting.name;if(fmeta.setting.format=='mixed'){fmeta.format='disabled';fmeta.dtInfo=this.dtInfo(fmeta.format);fmeta.disabled=true;}
var fields=[];var labelWidth=this.getLabelWidth(displayName);var opWidth=0;if(fmeta.opedit){opWidth=labelWidth+110;fields.push({layout:'form',columnWidth:0.50,labelWidth:labelWidth,labelAlign:this.LABELALIGN,items:this._opEditorField(fmeta,'op',displayName)});}
var valFields=[this._valEditorField(fmeta,'val',displayName)];if(fmeta.setting.op==OPER_BETWEEN){var fmeta2=Ext.apply({val2:true},fmeta);valFields.push(this._valEditorField(fmeta2,'val2',displayName));this._applyRangeVtypes(fmeta.dt,valFields);}
fields.push({layout:'form',hideLabels:fmeta.opedit,labelWidth:labelWidth,columnWidth:fmeta.opedit?0.40:0.90,labelAlign:this.LABELALIGN,items:valFields});var settingTools=this._buildSettingTools(idx,fmeta,fields);if(settingTools){fields.push({width:20,items:settingTools});}
var redX=null;if(!fmeta.setting.alwaysShow&&this.dpEditable){var redXHandler=function(){this.fmeta.dp._removeSmartlistConstraint(this.fmeta);};redX=this._redXButton(idx,fmeta,'Remove constraint',redXHandler);}
fields.push({width:20,items:redX});return fields;},_applyRangeVtypes:function(dt,valFields){if(dt.indexOf('int')===0){valFields[0].vtype=valFields[1].vtype='numericrange';valFields[0].endRangeField=valFields[1];valFields[1].startRangeField=valFields[0];}
else if(dt.indexOf('date')===0){valFields[0].vtype=valFields[1].vtype='daterange';valFields[0].endDateField=valFields[1];valFields[1].startDateField=valFields[0];}},_buildSettingTools:function(idx,fmeta,fields){if(fmeta.setting.op!=OPER_IS){return false;}
var iconHtml;if(fmeta.dtInfo.showEmailPreview||fmeta.setting.name=='Mailing ID'){iconHtml=this.dpMgr.templates.div_icon_button.apply({iconCls:'mki16 mkiMail2View clickable',style:'margin-top: 4px;',qtip:'Click to preview'});return new Ext.Panel({html:iconHtml,fmeta:fmeta,rowIndex:idx,style:'margin-top: -1px;',initEvents:function(){this.body.on('click',function(){var val=this.fmeta.setting.val;if(val&&!(this.fmeta.setting.errorMeta&&this.fmeta.setting.errorMeta.level>2)){if(isArray(val)){val=val[0];}
mktEmManager.previewEmail(null,val);}},this);}});}
if(fmeta.dtInfo.showWebpagePreview||fmeta.setting.name=='Webpage ID'){iconHtml=this.dpMgr.templates.div_icon_button.apply({iconCls:'mki16 mkiWebpageView clickable',style:'margin-top: 4px;',qtip:'Click to preview'});return new Ext.Panel({html:iconHtml,fmeta:fmeta,rowIndex:idx,style:'margin-top: -1px;',initEvents:function(){this.body.on('click',function(){var val=this.fmeta.setting.val;if(val){if(isArray(val)){val=val[0];}
var url=val;if(!Ext.form.VTypes.url(val)){url=MktPage.savedState.xdEditorBaseUrl+MktSession.getUrlPrefix()+"/lpeditor/editor?";var params={lpview:'preview',deployedLatest:true,pageName:val};url+=Ext.urlEncode(params);}
Mkt.util.Common.xdLogin(function(url){var newWind=window.open(url,"_blank","width=1024, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}.createDelegate(this,[url]));}},this);}});}
return null;},_flowFormFields:function(idx,fmeta){var optCount=0;if(fmeta.setting.options){optCount=fmeta.setting.options.length;}
var primaryFieldset=[];if(fmeta.dtInfo.flowOperations){primaryFieldset.push({columnWidth:0.46,layout:'form',labelWidth:this.getLabelWidth(fmeta.setting.displayName),labelAlign:this.LABELALIGN,items:this._opEditorField(fmeta,'op',fmeta.setting.displayName)});primaryFieldset.push({columnWidth:0.46,layout:'form',hideLabels:true,items:this._valEditorField(fmeta,'val','')});}
else{primaryFieldset.push({columnWidth:0.94,layout:'form',labelWidth:this.getLabelWidth(fmeta.setting.displayName),labelAlign:this.LABELALIGN,items:this._valEditorField(fmeta,'val',fmeta.setting.displayName)});}
var settingTools=this._buildSettingTools(idx,fmeta,primaryFieldset);if(settingTools){primaryFieldset.push({width:20,items:settingTools});}
if(optCount===0){return primaryFieldset;}
var leftColFields;if(primaryFieldset.length>1){leftColFields=[{layout:'column',items:primaryFieldset}];}
else{leftColFields=primaryFieldset;}
var rightColFields=[];var addedFields=0;for(var i=0;i<optCount;i++){var option=fmeta.setting.options[i];var optionMeta=this._flowOptionMeta(fmeta,option);this._flowMasterSettingDependencies(idx,optionMeta);if(!optionMeta.disabled){var optionField={columnWidth:0.95,layout:'form',labelWidth:this.getLabelWidth(option.displayName),labelAlign:optionMeta.dtInfo.labelAlign||this.LABELALIGN,items:this._valEditorField(optionMeta,'val',option.displayName)};addedFields++;if(optionMeta.column&&optionMeta.column=='left'){optionField.style='margin-top: 4px';leftColFields.push(optionField);}
else{rightColFields.push(optionField);}}}
var twoColumns=[{columnWidth:0.475,hideLabels:true,items:leftColFields},{columnWidth:0.475,hideLabels:true,items:rightColFields}];return twoColumns;},_flowConditionFields:function(idx,fmeta){var condMeta=Ext.apply({isCondition:true},fmeta);condMeta.primarySetting=fmeta.setting;condMeta.setting=fmeta.setting.condition;var oldCondMetaFormat=condMeta.format;if(DPDEBUG)console.debug("condMeta setting=",condMeta.setting);condMeta.format=condMeta.setting.format||condMeta.setting.dt;if(DPDEBUG)console.debug("condMeta format changed from",oldCondMetaFormat,'to',condMeta.format,' (setting dt=',condMeta.setting.dt,')');condMeta.dtInfo=this.dtInfoFormat(condMeta);condMeta.displayName=condMeta.setting.displayName||condMeta.setting.name;condMeta.tipText=this.writeTipText(condMeta);if(DPDEBUG)console.debug("condMeta=",condMeta);var condNameMeta=Ext.apply({isConditionName:true},condMeta);condNameMeta.format='flow_condition_name';condNameMeta.dtInfo=this.dtInfo(condNameMeta.format);if(DPDEBUG)console.debug("condNameMeta=",condNameMeta);var condValMeta=Ext.apply({isConditionVal:true},condMeta);condValMeta.op=condMeta.setting.op;condValMeta.format=this.getFormatDt(condValMeta);condValMeta.dtInfo=this.dtInfo(condValMeta.format);condValMeta.opedit=true;this._flowMasterSettingDependencies(idx,condValMeta);if(DPDEBUG)console.debug("condValMeta=",condValMeta);var fields=[{columnWidth:0.4,layout:'form',labelAlign:this.LABELALIGN,labelWidth:this.getLabelWidth('If'),items:this._valEditorField(condNameMeta,'name','If')}];if(!condValMeta.disabled){fields.push({columnWidth:0.2,layout:'form',hideLabels:true,items:this._opEditorField(condValMeta,'op',condMeta.displayName)});var valFields=[this._valEditorField(condValMeta,'val',condMeta.displayName)];if(condValMeta.setting.op==OPER_BETWEEN){var condValMeta2=Ext.apply({val2:true},condValMeta);valFields.push(this._valEditorField(condValMeta2,'val2',condMeta.displayName));this._applyRangeVtypes(condValMeta.setting.dt,valFields);}
fields.push({columnWidth:0.3,layout:'form',hideLabels:true,items:valFields});}
else{fields.push({columnWidth:0.5,html:''});}
return fields;},_flowMasterSettingDependencies:function(idx,fmeta){if(fmeta.format=='mixed'||(fmeta.isCondition&&!fmeta.dtInfo.isConditionName&&!fmeta.setting.dbAid&&!fmeta.setting.aid&&!fmeta.setting.dbAttribId)){fmeta.disabled=true;fmeta.format='disabled';fmeta.dtInfo=this.dtInfo(fmeta.format);}},_flowChoiceFormFields:function(idx,fmeta,lastSetting){var fieldset={columnWidth:1,xtype:'fieldset',autoHeight:true,items:[]};var numChoices=this.store.getCount();fieldset.title='&nbsp;Choice '+(idx+1);if(idx<numChoices-1){fieldset.style='margin-top: 0px; padding: 0 0 0 10px; border-width: 0 0 1px 0; margin-right: 5px';}
else{fieldset.title='&nbsp;Default Choice';fieldset.style='margin-top: 10px; margin-bottom: 0px; padding: 5px 0 0 0; border-width: 0;';}
if(idx<numChoices-1){fieldset.fieldSetToolbar=new Mkt.widgets.DataPanelEditor.FieldsetButton({moveFlowChoice:this.moveFlowChoice.createDelegate(this),idx:idx});fieldset.headerAsText=false;fieldset.onRender=function(ct,position){Ext.form.FieldSet.prototype.onRender.call(this,ct,position);this.titleHolder=this.header.insertFirst({tag:'div'});this.fieldSetToolbar.render(this.titleHolder);};}
if(idx!=numChoices-1){var conditionFields=this._flowConditionFields(idx,fmeta);fieldset.items.push({layout:'column',items:conditionFields});}
fmeta.emptyText='-- Do Nothing --';fieldset.items.push({layout:'column',items:this._flowFormFields(idx,fmeta)});if(idx!=numChoices-1){var redXHandler=function(){this.fmeta.dp.removeFlowChoice(this.fmeta);};fieldset.items.push(new Ext.Panel({width:27,cls:'fieldsetRemovePanel',style:'margin-top: -25px; margin-bottom: 10px;',items:this._redXButton(idx,fmeta,'Remove choice',redXHandler)}));}
return fieldset;},_flowOptionMeta:function(fmeta,option){return{dp:this,primary:false,setting:option,primarySetting:fmeta.setting,dt:option.dt,format:option.format,column:option.column||'right',disabled:fmeta.disabled,opedit:fmeta.opedit,dtInfo:this.dtInfoFormat(option)};},_opEditorField:function(fmeta,dataIndex,fieldLabel){var value=fmeta.setting.op;if(DPDEBUG){console.debug('building op editor field',fmeta);}
if(!fmeta.setting.primary&&fmeta.dt=='object'){fmeta.dtInfo.operations='BINARY_OPERATIONS';}
var field=new Mkt.widgets.DataPanelEditor.op({fieldLabel:fieldLabel,anchor:this.FIELDANCHOR,value:value,disabled:!this.dpEditable||!fmeta.opedit||fmeta.disabled,store:this._opSuggestStore(fmeta)});this._initEditFieldEvents(field,fmeta,dataIndex);return field;},_opSuggestStore:function(fmeta){if(DPDEBUG)console.debug('_opSuggestStore fmeta=',fmeta);if(fmeta.setting.aid<0&&fmeta.dtInfo.trigger_operations){fmeta.dtInfo.operations=fmeta.dtInfo.trigger_operations;}
var storeCache=this.dpMgr.storeCache;var storeName='op '+fmeta.dtInfo.operations;if(DPDEBUG)console.debug('_opSuggestStore storeName=',storeName);if(storeCache[storeName]==undefined){if(DPDEBUG)console.debug('_opSuggestStore building new cache',storeName);storeCache[storeName]=new Ext.data.SimpleStore({fields:['op','label'],data:DPConst[fmeta.dtInfo.operations]});}
else if(this.DPDEBUG)console.debug('_opSuggestStore reused existing cache',storeName);return storeCache[storeName];},_initEditFieldEvents:function(field,fmeta,dataIndex){if(field==undefined||fmeta==undefined||dataIndex==undefined){throw new Exception("Missing parameters");}
field.fmeta=fmeta;field.dataIndex=dataIndex;field.onFieldChange=function(field,newValue,oldValue,select){var fmeta=field.fmeta;var dataIndex=field.dataIndex;var rebuild=false;if(field.needsRebuild){rebuild=field.needsRebuild();}
if(select){field.setValue(newValue);fmeta.setting[dataIndex]=newValue;}
else{if(this.clearOnManualEntry){for(var i=0;i<this.clearOnManualEntry.length;i++){if(fmeta.setting[this.clearOnManualEntry[i]]){console.debug('Clearing value for key:',this.clearOnManualEntry[i],' value:',fmeta.setting.dbAid);delete fmeta.setting.dbAid;}}}}
if(fmeta.dtInfo.editor=='DateField'){try{newValue=this.fmeta.dp.formatDate(newValue);}
catch(e){if(DPDEBUG)console.debug('problem formatting date');}}
var setting=fmeta.setting;if(DPDEBUG){console.group("Field Changed");console.debug("field=",field);console.debug("fmeta=",fmeta);console.debug("dataIndex=",dataIndex);console.debug("rebuild=",rebuild);console.debug("Value: `",oldValue,"` >> `",newValue,"`");console.debug("field.startValue: `",field.startValue,"`");console.debug("field.getRawValue(): `",field.getRawValue(),"`");console.debug("field.getValue(): `",field.getValue(),"`");console.groupEnd();}
field.setValue(newValue);setting[dataIndex]=newValue;fmeta.dp.dpMgr.autosave('edited field',fmeta.dp,true);if(rebuild=='setting'){fmeta.dp.rebuildFormSetting(fmeta.fid);}
else if(rebuild=='condition'){fmeta.dp.rebuildFormCondition(fmeta.fid);}
else if(rebuild=='form'){fmeta.dp.buildForm(true);}
return true;};field.fireFieldChange=function(field,select){var fmeta=field.fmeta;var dataIndex=field.dataIndex;var newValue=field.getRawValue();var oldValue=fmeta.setting[dataIndex];if(newValue==oldValue){if(DPDEBUG)console.debug('no change');if(select){console.debug('user selected existing value');}
return false;}
if(DPDEBUG){console.group("Fire Field Change");console.debug(field,fmeta,dataIndex);console.debug("Value: `",oldValue,"` >> `",newValue,"`");console.debug("select:",select);console.groupEnd();}
return field.onFieldChange(field,newValue,oldValue,select);};field.onFieldSpecialKey=function(field,e){if(e.getKey()!=e.ENTER&&e.getKey()!=e.TAB){return true;}
if(field.getValue()==field.startValue){return true;}
return field.fireFieldChange(field,false);};field.on('change',field.onFieldChange,field);field.on('specialkey',field.onFieldSpecialKey,field);if(field.fieldSelect){field.on('select',field.fieldSelect,field);}},_valEditorField:function(fmeta,dataIndex,fieldLabel){if(DPDEBUG)console.debug('valEditorField fmeta=',fmeta);if(!fmeta.dtInfo.isConditionName&&fmeta.opedit&&this.hiddenOperation(fmeta.setting.op)){return{};}
var value='';if(fmeta.isComboChooser){value='';}
else if(dataIndex=='name'){value=fmeta.setting['displayName']||fmeta.setting[dataIndex]||'';}
else{value=fmeta.setting[dataIndex];}
var editorDefaults={fmeta:fmeta,dataIndex:dataIndex,value:value,emptyText:this.writeEmptyText(fmeta,dataIndex),invalidText:fmeta.dtInfo.invalidText,fieldLabel:fieldLabel,disabled:fmeta.disabled,anchor:(fmeta.dtInfo.width)?undefined:this.FIELDANCHOR,width:fmeta.dtInfo.width};editorDefaults.stripCharsRe=/(^\s+|\s+$)/g;editorDefaults.validationDelay=1000;if(isSingleArray(editorDefaults.value)){editorDefaults.value=editorDefaults.value[0];}
var op=fmeta.setting.op||OPER_IS;if(op==OPER_IS||op==OPER_IS_NOT){editorDefaults.vtype=fmeta.dtInfo.vtype;}
if(isMultiArray(editorDefaults.value)){return this.createComboChooserButton(fmeta,dataIndex,editorDefaults);}
var field=null;switch(fmeta.dtInfo.editor){case"DateField":field=new Ext.form.DateField(editorDefaults);break;case"DateComboField":fmeta.isDateCombo=true;field=this.createDataPanelEditorField(fmeta,dataIndex,editorDefaults);break;case"NumberField":editorDefaults.allowDecimals=fmeta.dtInfo.allowDecimals;field=new Ext.form.NumberField(editorDefaults);break;case"TextField":field=new Ext.form.TextField(editorDefaults);break;case"TextArea":editorDefaults.maxLength=fmeta.dtInfo.maxLength||50000;editorDefaults.height=fmeta.dtInfo.height||70;field=new Ext.form.TextArea(editorDefaults);break;case"ComboBox":default:field=this.createDataPanelEditorField(fmeta,dataIndex,editorDefaults);break;}
if(!fmeta.isComboChooser){this._initEditFieldEvents(field,fmeta,dataIndex);field.qtip=this.writeFieldQtip(fmeta,dataIndex);var error=this._initEditFieldError(field,fmeta,dataIndex);if(!error){this._registerFieldQtip(field);}}
return field;},_initEditFieldError:function(field,fmeta,dataIndex){var error=this.getSettingErrorText(fmeta,dataIndex);if(error){if(DPDEBUG)console.debug('initEditFieldError found error');if(field.markInvalid){field.errorText=error;if(field.qtip&&field.qtip.text){field.errorText+='<br><br>'+field.qtip.text;}
field.on('render',function(){this.markInvalid(this.errorText);},field,{delay:20});return error;}}
return null;},_registerFieldQtip:function(field){field.on('render',function(field){if(this.qtip&&this.qtip.text){this.qtip.target=field.getId();Ext.QuickTips.register(this.qtip);}});},_saniArray:function(arr){var vals=[];for(var i=0;i<arr.length;i++){var val=arr[i];if(isString(val)){val=Ext.util.Format.htmlEncode(val);}
vals.push(val);}
return vals;},writeFieldQtip:function(fmeta,dataIndex){if(fmeta.dtInfo.quicktip!=undefined){return fmeta.dtInfo.quicktip;}
var fieldname=fmeta.setting.displayName||fmeta.setting.name;var value=fmeta.setting[dataIndex];var qtitle='';var qtip='';if(isMultiArray(value)){value=this._saniArray(value);qtitle=fieldname+': any of '+value.length+' values';qtip='<ul><li>&#149; '+value.join(' <li>&#149; ')+'</ul>';}
var tipText=this.writeTipText(fmeta);if(tipText){qtip+='<i>'+tipText+'</i>';}
return{title:qtitle,text:qtip};},_redXButton:function(idx,fmeta,qtip,handler){var iconHtml=this.dpMgr.templates.div_icon_button.apply({iconCls:'mki16 mkiCancel',qtip:qtip});return new Ext.Panel({html:iconHtml,fmeta:fmeta,rowIndex:idx,style:'',initEvents:function(){this.body.on('click',handler,this);}});},dtInfo:function(dt){var dtInfo=Ext.apply({},DPConst.DATATYPES[dt]||DPConst.DATATYPES['default']);if(this.isSmartlist&&dtInfo.smartlist){Ext.apply(dtInfo,dtInfo.smartlist);}
else if(!this.isSmartlist&&dtInfo.flow){Ext.apply(dtInfo,dtInfo.flow);}
return dtInfo;},dtInfoFormat:function(setting){return this.dtInfo(this.getFormatDt(setting));},getFormatDt:function(setting){if(DPDEBUG)console.debug('getFormatDt dt=',setting.dt,'format=',setting.format,'op=',setting.op);var format=setting.format||setting.dt||'string';var dtInfo=this.dtInfo(format);var opFormat=this.variableFormatOperation(setting.op);if(opFormat&&opFormat!=OPER_BETWEEN){return opFormat;}
return dtInfo.format||format;},maySelectMultiple:function(fmeta,dataIndex){if(fmeta.isComboChooser){return false;}
if(this.isFlow&&fmeta.flowSelectMultiple){return true;}
if(this.isFlow&&!fmeta.isConditionVal){return false;}
if(fmeta.setting.disableSelectMultiple){return false;}
return fmeta.dtInfo.selectMultiple||false;},isOperationEditable:function(fmeta){var opedit=true;if(fmeta.dtInfo.disableEditOperation)opedit=false;if(opedit)opedit=!fmeta.setting.disableEditOperation;if(DPDEBUG)console.debug('isOperationEditable opedit=',opedit,'fmeta=',fmeta);return opedit;},hiddenOperation:function(op){if(!op)return false;return DPConst.HIDDEN_FIELD_OPERATIONS.indexOf(op)!=-1;},variableFormatOperation:function(op){if(!op)return false;var opFormat=DPConst.VARIABLE_FORMAT_OPERATIONS[op];if(DPDEBUG)console.debug('variableFormatOperation',op,opFormat);return opFormat;},dateFormat:'Y-m-d',formatDate:function(date){if(isArray(date)){var dateAry=[];for(var i=0;i<date.length;i++){dateAry.push(this.formatDate(new Date(date[i])));return dateAry;}}
var rtn=(!date||!(date instanceof Date))?date:date.dateFormat(this.dateFormat);return rtn;},getSettingErrorText:function(fmeta,dataIndex){if(dataIndex=='val'&&fmeta.setting.errorMeta){var error=fmeta.setting.errorMeta.error;if(error){if(DPDEBUG)console.debug('getSettingErrorText('+dataIndex+','+fmeta.setting+') found error='+error);return error;}}
return'';},toolTemplate:new Ext.Template('<div class="x-tool-wrap">','<div class="x-tool x-tool-{id}">&#160</div>','</div>'),clickClose:function(){var hasChanges=this.hasSettings();var showTriggerWarning=false;if(this.isSmartlist&&this.dpMeta.trigger){var triggerCount=this.dpMgr.getTriggers().length;if(triggerCount==1){showTriggerWarning=true;}}
if(hasChanges||showTriggerWarning){var title='Delete '+this.dpTypeName(true)+'?';var name=this.dpMeta.displayName||this.dpMeta.name;var msg='<p>Are you sure you want to delete the '+this.dpTypeName()+' <b>'+name+'</b>?</p>';if(showTriggerWarning){msg+="<p>Triggered campaigns must contain a trigger to remain active</p>";}
if(this.dpMgr.isSmartlist&&!this.dpMeta.trigger&&this.dpMgr.smartListRuleLogic.customMode()){msg+='<br><br><i>Reminder:</i> '+'Check your advanced filter rules after any insert, delete, or reorder.';}
MktMessage.confirmDelete(title,msg,this._doClose.createDelegate(this),'mb9');}
else{this._doClose();}},dpTypeName:function(title){if(this.dpMgr.isSmartlist){if(this.dpMeta.trigger){return title?"Trigger":"trigger";}
else{return title?"Filter":"filter";}}
return title?"Flow Step":"flow step";},hasSettings:function(){var settings=this.store.data.items;for(var i=0;i<settings.length;i++){var st=settings[i].data;if(st.val)return true;if(st.op!=OPER_IS&&st.op)return true;if(st.condition){if(st.condition.val)return true;if(st.condition.op!=OPER_IS&&st.condition.op)return true;}
if(st.options&&st.options[0]){if(st.options[0].val)return true;if(st.options[0].op!=OPER_IS&&st.options[0].op)return true;}}
return false;},_doClose:function(button){if(button!='no'){this.dpMgr.removeDataPanel(this);}},setTopToolbarTipText:function(text){this.tbarTip.setText(text);},bottomToolbarTipText:null,setBottomToolbarTipText:function(text){bottomToolbarTipText=text;if(this.bbarTip){this.bbarTip.setText(text||' ');}},_createTopPanelToolbar:function(){var tbar=undefined;if(this.isSmartlist){tbar=this.createSmartlistToolbar(this);}
else if(this.isFlow){tbar=this.createFlowToolbar(this);}
if(tbar==undefined){tbar=new Ext.Toolbar({items:[new Ext.Toolbar.Fill(),new Ext.Toolbar.TextItem("&nbsp;")]});}
return tbar;},_createBottomPanelToolbar:function(){this.bbarTip=new Ext.Toolbar.TextItem(this.bottomToolbarTipText||' ');return[new Ext.Toolbar.Fill(),this.bbarTip];},createSmartlistToolbar:function(){var tbar=[];tbar.push(new Ext.Toolbar.Fill());if(this.dpEditable){var constraints=[];var settings=this.dpMeta[this.SETTINGS];for(var i=0;i<settings.length;i++){var st=settings[i];st.constraintPosition=i;if(st.alwaysShow||st.alwaysHide){continue;}
if(st.section&&constraints.length){constraints.push(st.section);}
constraints.push({setting_aid:st.aid||st.dbAttribId,text:st.displayName||st.name,checked:st.op?true:false,dataPanel:this,setting:st,checkHandler:this._toggleSmartlistConstraint.createDelegate(this)});}
if(constraints.length){var button=new Ext.Button({text:'Add Constraint',iconCls:'mkiFunnel',menu:new Ext.menu.Menu({items:constraints,listeners:{'beforeshow':{fn:function(menu){menu.getEl().applyStyles({'maxHeight':"310px",'overflow-y':"auto",'overflow-x':"hidden"});},scope:this}}})});this.constraintsMenu=button.menu;tbar.push(button);}}
return new Ext.Toolbar({items:tbar});},_removeSmartlistConstraint:function(fmeta){if(DPDEBUG)console.debug('remove smartlist constraint',fmeta.setting.displayName);var menuItem=null;var constraints=this.constraintsMenu.items.items;for(var i=0;i<constraints.length;i++){var aid=fmeta.setting.aid||fmeta.setting.dbAttribId;if(constraints[i].setting_aid==aid){menuItem=constraints[i];break;}}
if(menuItem){menuItem.setChecked(false);this._toggleSmartlistConstraint(menuItem,false);}},_toggleSmartlistConstraint:function(item,checked){this.dpMeta.hideEmptyFieldWarnings=true;var st=item.setting;if(DPDEBUG)console.debug('toggling constraint',checked,item,st,st.displayName);var dataIdx=this.findStoreSettingIx(st);if(DPDEBUG)console.debug('dataIdx',dataIdx);var dataRecord;if(checked){if(dataIdx!=-1){if(DPDEBUG)console.debug('constraint already visible');}
if(this.attr_name_selection&&(st.autosuggest==DPConst.DEP_LIST)){st.format=this.getFormatDt(this.attr_name_selection);}
if(st.format=='date_in_past'){st.op=OPER_IN_PAST;st.disableEditOperation=false;}
else if(st.format=='integer_at_least'){st.op=OPER_AT_LEAST;}
else{st.op=OPER_IS;}
if(DPDEBUG)console.debug("showing setting",st.displayName,dataIdx,st.aid,st.dbAttribId,st);st.hidden=false;dataIdx=this.store.data.length;dataRecord=this._createSettingRecord(this.dpid,st,'attribute');this.store.add(dataRecord);this.addFormSetting(dataIdx);this.dpMgr.autosave('showing constraint',this,false);this.doLayout();}
else{if(dataIdx==-1){if(DPDEBUG)console.debug('constraint already hidden');}
if(DPDEBUG)console.debug("hiding setting",st.displayName,dataIdx,st.aid,st.dbAttribId,st);this.removeFormSettingByAttributeId(st.aid||st.dbAttribId);dataRecord=this.store.getAt(dataIdx);if(!dataRecord){if(DPDEBUG)console.debug('constraint not found - already hidden');return;}
dataRecord.op=OPER_NONE;this.store.remove(dataRecord);this.dpMgr.autosave('hiding constraint',this,false);}},findStoreSettingIx:function(st){var dataIdx=this.store.find('displayName',st.displayName);if(DPDEBUG)console.debug('store.find displayName',st.displayName,dataIdx);if(dataIdx==-1){dataIdx=this.store.find('name',st.name);if(DPDEBUG)console.debug('store.find name',st.name,dataIdx);}
if(dataIdx==-1&&st.aid){this.store.find('aid',st.aid);if(DPDEBUG)console.debug('store.find aid',st.aid,dataIdx);}
if(dataIdx==-1&&st.dbAttribId){this.store.find('dbAttribId',st.dbAttribId);if(DPDEBUG)console.debug('store.find dbAttribId',st.dbAttribId,dataIdx);}
return dataIdx;},removeFormSettingByAttributeId:function(aid){var formSettings=this.items.items;var fs=null;for(var i=0;i<formSettings.length;i++){fs=formSettings[i];if(fs.fmeta&&(fs.fmeta.setting.aid==aid||fs.fmeta.setting.dbAttribId==aid)){this.remove(fs,true);return true;}}
return false;},checkLayout:function(){if(this.el.getWidth()!=this.containerWidth){this.containerWidth=this.el.getWidth();this.doLayout();}},createFlowToolbar:function(){var tip='&nbsp;';this.tbarTip=new Ext.Toolbar.TextItem(tip);var items=[this.tbarTip,new Ext.Toolbar.Fill()];if(this._mayHaveFlowChoices()){items.push(new Ext.Button({text:'Add Choice',iconCls:'mkiBranchAdd',handler:this.addFlowChoice.createDelegate(this)}));}
var tbar=new Ext.Toolbar({items:items});return tbar;},_mayHaveFlowChoices:function(){if(!this.dpEditable||this.dpMeta[this.SETTINGS].length===0){return false;}
if(this.dpMeta.name=='Wait'){return false;}
return true;},addFlowChoice:function(button){button.disable();var count=this.store.getCount();this.containerWidth=this.el.getWidth();this.dpMeta.hideEmptyFieldWarnings=true;var setting=this.dpMgr.cloneDataRecord(this.store.getAt(0).data);setting.val=setting.defaultVal;delete setting.errorMeta;if(setting.options){for(var i=0;i<setting.options.length;i++){delete setting.options[i].errorMeta;setting.options[i].val=setting.options[i].defaultVal;if(setting.options[i].autosuggest==DPConst.DEP_LIST&&setting.format=='condition_name'){setting.options[i].format='mixed';}}}
setting.condition=null;setting.createCondition=true;this.store.insert(0,this._createSettingRecord(this.dpid,setting,this.dpMeta.tt));if(count==1){this.buildForm(true);}
else{this.addFormSetting(0,true);this.rebuildFlowChoiceTitles();this.doLayout();this.checkLayout();}
button.enable();this.dpMgr.autosave('add choice',this,false);},moveFlowChoice:function(el){MktSession.clockCursor(true);this.showLoadMask();if(el.parentMenu){el.parentMenu.hide();}
var idx;var cmd=el.cmd;var newPosition=0;var oldPosition=0;var count=this.store.getCount();switch(cmd){case'up':idx=el.parentMenu.idx;newPosition=idx-1;oldPosition=idx;break;case'down':idx=el.parentMenu.idx;newPosition=idx+1;oldPosition=idx;break;case'move':el.fsButton.items.items[0].menu.hide();idx=el.fsButton.items.items[0].menu.idx;newPosition=(el.getValue()*-1)-1;oldPosition=idx;break;case'remove':idx=el.parentMenu.idx;break;default:break;}
var dataRecord=this.store.getAt(idx);this.store.remove(dataRecord);if(count==2&&cmd=='remove'){this.buildForm(true);}
this.removeFormSettingById(dataRecord.data.fid);if(cmd!='remove'){this.store.insert(newPosition,dataRecord);this.addFormSetting(newPosition,true);this.rebuildFormSetting(this.store.getAt(idx).data.fid);}
this.rebuildFlowChoiceTitles();if(count<10){this.doLayout();}
this.hideLoadMask();MktSession.clockCursor(false);this.dpMgr.autosave('reorder flow choices',this,true);},removeFlowChoice:function(fmeta){MktSession.clockCursor(true);this.showLoadMask();this.store.remove(fmeta.dataRecord);if(this.store.getCount()==1){this.buildForm(true);}
else{this.removeFormSettingById(fmeta.fid);this.rebuildFlowChoiceTitles();this.doLayout();}
this.hideLoadMask();MktSession.clockCursor(false);this.dpMgr.autosave('remove flow choice',this,true);},rebuildFlowChoiceTitles:function(){var fieldSettings=this.items.items;var count=fieldSettings.length;var fieldset,fieldsetButton,menuitems,slider;for(var i=0;i<count-1;i++){fieldset=fieldSettings[i].items.items[0];if(fieldset&&fieldset.fieldSetToolbar){if(fieldset.fieldSetToolbar.items.items[0]){fieldsetButton=fieldset.fieldSetToolbar.items.items[0];}else{fieldsetButton=fieldset.fieldSetToolbar.buttons[0];}}
if(fieldsetButton){menuitems=fieldsetButton.menu.items.items;fieldsetButton.setText('&nbsp;Choice '+(i+1));fieldsetButton.menu.idx=i;menuitems[0].setDisabled((i===0)?true:false);menuitems[1].setDisabled((i==count-2)?true:false);slider=menuitems[2].menu.items.items[0];slider.minValue=(count-1)*(-1);if(slider.rendered){slider.setValue((i+1)*(-1));slider.setIndicator((i+1)*(-1));}else{slider.value=(i+1)*(-1);}}}},createComboChooserButton:function(fmeta,dataIndex,editorDefaults){var qtip=this.writeFieldQtip(fmeta,dataIndex);if(!qtip){qtip={title:'',text:''};}
var cls='';var error=this.getSettingErrorText(fmeta,dataIndex);if(error){if(DPDEBUG)console.debug('combo button error');cls='x-form-text x-form-field x-form-invalid combo-chooser-text';}
else if(this.dpEditable){cls='x-form-text x-form-field combo-chooser-text';}
var field=this.dpMgr.templates.form_element.apply({cls:cls,qtitle:qtip.title,qtip:Ext.util.Format.htmlEncode(qtip.text),text:this.formatArrayText(editorDefaults.value,60)});var summary=new Ext.Panel({html:field,anchor:this.FIELDANCHOR,fmeta:fmeta,dataIndex:dataIndex,initEvents:function(){this.body.on('click',function(){this.fmeta.dp.showComboChooser(this);},this);}});return summary;},formatArrayText:function(val,maxlen){var s='('+val.length+') '+val.join('; ');if(maxlen!=undefined&&s.length>maxlen){s=s.substr(0,maxlen)+'... ';}
return Ext.util.Format.htmlEncode(s);},showComboChooser:function(originalField){if(!this.dpEditable){return;}
var originalFieldMeta=originalField.fmeta;var chooserMeta=Ext.apply({isComboChooser:true},originalFieldMeta);var entryField=this._valEditorField(chooserMeta,originalField.dataIndex,chooserMeta.setting.displayName);this.comboChooser=new ComboChooser({title:'Multiple Value Chooser',originalField:originalField,entryField:entryField,fmeta:originalFieldMeta,dataIndex:originalField.dataIndex,tipText:chooserMeta.tipText,animateTarget:this.getEl(),cls:'comboChooser',afterOkButton:function(){var dp=this.fmeta.dp;dp.dpMgr.autosave('combo chooser',dp,true);dp.rebuildFormSetting(this.fmeta.fid);}});this.comboChooser.showChooser();},createDataPanelEditorField:function(fmeta,dataIndex,editorDefaults){if(DPDEBUG){console.debug('createDataPanelEditorField',fmeta);}
var fieldName=fmeta.setting.displayName||fmeta.setting.name;if(!fieldName&&fmeta.isConditionName){fieldName='Condition Name';}
var suggConfig=this._dpeSuggestConfig(fmeta,dataIndex);var suggStore=this._dpeSuggestStore(suggConfig);var forceSelection=this._dpeForceSelection(fmeta,suggConfig.disabled);if(forceSelection&&DPDEBUG){console.debug('Forcing Selection for ',fieldName);}
var selectMultiple=this.maySelectMultiple(fmeta,suggConfig.dataIndex);var chooserConfig=null;if(selectMultiple){chooserConfig=this._dpeChooserConfig(fmeta,dataIndex,suggConfig);}
var dpeConfig={store:suggStore,disableAutosuggest:suggConfig.disabled,disableAutosuggestOnEmpty:true,displayField:suggConfig.displayField,mode:suggConfig.mode,forceSelection:forceSelection,selectMultiple:selectMultiple,twinTriggerConfig:chooserConfig,listWidth:fmeta.dtInfo.listWidth||300,resizable:true,cls:'',shadow:"drop"};if(fmeta.isDateCombo){dpeConfig.selectMultiple=false;delete dpeConfig['twinTriggerConfig'];}
if(suggConfig.disabled&&editorDefaults.emptyText=='Select...'){fmeta.dtInfo.emptyText=editorDefaults.emptyText='Enter value...';}
for(var key in editorDefaults){dpeConfig[key]=editorDefaults[key];}
if(DPDEBUG){console.group('Data Panel Editor for "'+fieldName+'" - '+dataIndex);console.debug('fmeta=',fmeta);console.debug('suggConfig=',suggConfig);console.debug('suggStore=',suggStore);console.debug('chooserConfig=',chooserConfig);console.debug('dpeConfig=',dpeConfig);console.groupEnd();}
var editor;if(fmeta.dtInfo.isAttributeName){editor=new Mkt.widgets.DataPanelEditor.attributeName(dpeConfig);}
else if(fmeta.dtInfo.isConditionName){editor=new Mkt.widgets.DataPanelEditor.conditionName(dpeConfig);}
else if(fmeta.isDateCombo){editor=new Mkt.widgets.DateComboField(dpeConfig);}
else{editor=new Mkt.widgets.DataPanelEditor.val(dpeConfig);}
return editor;},_dpeSuggestConfig:function(fmeta,dataIndex){var formatDt=fmeta.dt;var setting=fmeta.setting;if(DPDEBUG)console.debug('building suggestConfig',fmeta,dataIndex);var suggConfig={mode:'remote',displayField:dataIndex,dataIndex:dataIndex,isSmartlist:this.dpMgr.isSmartlist?1:0,isTrigger:this.dpMeta.trigger?1:0,aid:setting.aid,name:setting.name,atid:this.dpMeta.atid||null,accessZoneId:this.dpMgr.accessZoneId};suggConfig[this.dpMgr.appVarsBase+'Id']=this.dpMgr.dataPanelStorageId;if(suggConfig.aid===null&&setting.dbAttribId){suggConfig.aid=setting.dbAttribId;suggConfig.atid=null;}
if(!fmeta.primary&&fmeta.primarySetting){if(this.DPDEBUG){console.debug('autosuggest dependency found -- name=',fmeta.setting.name,"setting fid=",fmeta.setting.fid,"primarySetting fid=",fmeta.primarySetting.fid,"fmeta.setting=",fmeta.setting,"primarySetting=",fmeta.primarySetting);}
suggConfig.dependent_name=fmeta.primarySetting.name;suggConfig.dependent_aid=fmeta.primarySetting.aid;suggConfig.dependent_op=fmeta.primarySetting.op;suggConfig.dependent_val=fmeta.primarySetting.val;if(DPDEBUG){console.debug('suggConfig=',fmeta.setting.name,suggConfig);}
if(!isArray(suggConfig.dependent_val)){suggConfig.dependent_val=[suggConfig.dependent_val];}
suggConfig.dependent_val=Ext.util.JSON.encode(suggConfig.dependent_val);}
if(fmeta.dtInfo.specialSuggestConfig){suggConfig=Ext.apply(suggConfig,fmeta.dtInfo.specialSuggestConfig);suggConfig.especial=true;}
else if(fmeta.isConditionVal){if(DPDEBUG){console.debug("conditionVal fmeta=",fmeta);}
suggConfig.atid=setting.atid||null;}
if(!suggConfig.especial&&fmeta.dtInfo.dtSuggestConfig){suggConfig.name=fmeta.dt;suggConfig.mode=fmeta.dtInfo.dtSuggestConfig.mode;suggConfig.data=fmeta.dtInfo.dtSuggestConfig.data;}
suggConfig.disabled=(!suggConfig.especial&&suggConfig.mode=='remote'&&(setting.autosuggest=='none'||!suggConfig.name||fmeta.dtInfo.disableAutosuggest));if(DPDEBUG)console.debug('...returning suggestConfig=',suggConfig);return suggConfig;},_dpeSuggestStore:function(suggConfig){if(DPDEBUG)console.debug("_dpeSuggestStore suggConfig=",suggConfig);if(suggConfig.disabled){return new Ext.data.Store();}
suggConfig.appVarsBase=this.dpMgr.appVarsBase;var storeName=Ext.urlEncode(suggConfig);var storeCache=this.dpMgr.storeCache;if(storeCache[storeName]==undefined){if(suggConfig.mode=='local'){storeCache[storeName]=new Ext.data.SimpleStore({fields:['server_val',suggConfig.displayField],data:suggConfig.data});}
if(suggConfig.mode=='remote'){storeCache[storeName]=new Ext.data.JsonStore({url:this.dpMgr.autosuggestAction,root:'suggest',fields:[suggConfig.displayField],id:(suggConfig.aid!=undefined)?suggConfig.aid:suggConfig.displayField,baseParams:suggConfig});}}
return storeCache[storeName];},_dpeForceSelection:function(fmeta,autosuggestDisabled){if(autosuggestDisabled){return false;}
var op=fmeta.setting.op;if(op!=OPER_IS&&op!=OPER_IS_NOT){return false;}
if("forceSelection"in fmeta.setting){return fmeta.setting.forceSelection;}
if("forceSelection"in fmeta.dtInfo){return fmeta.dtInfo.forceSelection;}
return false;},_dpeChooserConfig:function(fmeta,dataIndex,suggConfig){return{iconCls:'mkiTrigger mkiAdd2',qtip:DPConst.TEXT.select_multiple_qtip};}});Mkt.widgets.DataPanelEditor={};Mkt.widgets.DataPanelEditor.base=Ext.extend(Ext.form.ImprovedComboBox,{emptyText:'Select...',lazyRender:true});Mkt.widgets.DataPanelEditor.op=Ext.extend(Mkt.widgets.DataPanelEditor.base,{minChars:0,forceSelection:true,valueField:'op',displayField:'label',typeAhead:true,mode:'local',triggerAction:'all',selectOnFocus:true,allowBlank:false,fieldSelect:function(field,index){return field.fireFieldChange(field,true);},needsRebuild:function(){var dp=this.fmeta.dp;if(DPDEBUG)console.debug(this.fmeta.primary,this.fmeta);if(this.fmeta.primary&&dp.isSmartlist&&dp.store.getCount()>1){var settings=dp.store.data.items;for(var i=0;i<settings.length;i++){if(settings[i].data.autosuggest==DPConst.DEP_LIST){if(DPDEBUG)console.debug('rebuilding smartlist form to pick up new dependant list');return'form';}}}
var oldOp=this.fmeta.setting.op;var newOp=this.getValue();if(DPDEBUG)console.debug('op fieldSelect: `',oldOp,'` >> `',newOp,'`');if(oldOp==newOp){return false;}
if(this.fmeta.dtInfo.vtype){if(DPDEBUG)console.debug('rebuilding setting because it has a validator');return'setting';}
if((oldOp==OPER_IS||newOp==OPER_IS)&&(this.fmeta.dtInfo.showEmailPreview||this.fmeta.dtInfo.showWebpagePreview||this.fmeta.setting.name=='Webpage ID')){if(DPDEBUG)console.debug('rebuilding setting to update the preview icon');return'setting';}
var oldOpHidden=this.fmeta.dp.hiddenOperation(oldOp);var newOpHidden=this.fmeta.dp.hiddenOperation(newOp);if(oldOpHidden!=newOpHidden){if(DPDEBUG)console.debug('rebuilding setting to toggle a hidden field');return'setting';}
var oldOpFormat=this.fmeta.dp.variableFormatOperation(oldOp);var newOpFormat=this.fmeta.dp.variableFormatOperation(newOp);if(oldOpFormat!=newOpFormat){if(DPDEBUG)console.debug('rebuilding setting and clearing values for variable operation; old="',oldOp,'"new="',newOp,'"');if(this.fmeta.setting.val){this.fmeta.setting.val=null;}
if(this.fmeta.setting.val2){this.fmeta.setting.val2=null;}
return'form';}
return false;}});Mkt.widgets.DataPanelEditor.val=Ext.extend(Mkt.widgets.DataPanelEditor.base,{minChars:0,forceSelection:false,typeAhead:false,triggerAction:'all',selectOnFocus:false,mode:'remote',allowBlank:true,loadingText:'Searching...',onTwinTriggerClick:function(){this.collapse();this.fmeta.dp.showComboChooser(this);},fieldSelect:function(field,index){if(!field.fmeta.isComboChooser){return field.fireFieldChange(field,true);}},needsRebuild:function(){var dp=this.fmeta.dp;if(this.DPDEBUG){console.debug('needs rebuild?',this.fmeta.primary,this.fmeta);}
if(this.fmeta.primary&&dp.isSmartlist&&dp.store.getCount()>1){var settings=dp.store.data.items;for(var i=0;i<settings.length;i++){if(settings[i].data.autosuggest==DPConst.DEP_LIST){return'form';}}}
if(this.fmeta.primary&&dp.isFlow&&this.fmeta.setting.options){for(var j=0;j<this.fmeta.setting.options.length;j++){if(this.fmeta.setting.options[j].autosuggest==DPConst.DEP_LIST){return'form';}}}
return false;}});Mkt.widgets.DataPanelEditor.attributeName=Ext.extend(Mkt.widgets.DataPanelEditor.val,{clearOnManualEntry:['dbAid'],fieldSelect:function(field,record,index){var setting=field.fmeta.setting;var dp=field.fmeta.dp;if(record.json.disabled){field.setValue(setting.val);return false;}
dp.attr_name_selection=record.json;setting.dbAid=record.json.aid;var format=dp.getFormatDt(record.json);var defaultValue=dp._parseServerValue(record.json.val);if(dp.dpMgr.isSmartlist){var fieldNames=['New Value','Old Value'];for(var i=0;i<fieldNames.length;i++){var rowIdx=dp.store.find('name',fieldNames[i]);if(rowIdx!=-1){var recordData=dp.store.getAt(rowIdx).data;recordData.format=format;recordData.val=defaultValue;}}}
if(dp.dpMgr.isFlow&&setting.options){for(var j=0;j<setting.options.length;j++){var option=setting.options[j];option.format=format;option.val=defaultValue;}}
return field.fireFieldChange(field,true);},needsRebuild:function(){var dp=this.fmeta.dp;if(dp.isSmartlist&&dp.items.getCount()>1){var settings=dp.store.data.items;for(var i=0;i<settings.length;i++){if(settings[i].data.autosuggest==DPConst.DEP_LIST){if(DPDEBUG)console.debug('rebuilding smartlist form to pick up new dependant list');return'form';}}}
if(dp.isFlow){return'setting';}
return false;}});Mkt.widgets.DataPanelEditor.conditionName=Ext.extend(Mkt.widgets.DataPanelEditor.val,{fieldSelect:function(field,record,index){var filterMeta=record.json.dpMeta;if(DPDEBUG)console.debug("conditionName.fieldSelect filterMeta=",filterMeta);if(filterMeta.conditions&&filterMeta.conditions.length!==0){var condMeta=filterMeta.conditions[0];Ext.apply(field.fmeta.setting,condMeta);var setting=field.fmeta.setting;setting.filterMeta=filterMeta;setting.tt=filterMeta.tt;setting.condOccurs=filterMeta.condOccurs;setting.atid=filterMeta.atid||null;setting.displayName=filterMeta.displayName;setting.format=filterMeta.format;setting.op=setting.op||OPER_IS;setting.val=field.fmeta.dp._parseServerValue(setting.val);if(DPDEBUG)console.debug("selected condition config=",setting);}
return field.fireFieldChange(field,true);},needsRebuild:function(){return'condition';}});Mkt.widgets.DataPanelEditor.FieldsetButton=Ext.extend(Ext.Toolbar,{cls:'fieldsetToolbar',initComponent:function(){var fsButton=this;this.items=[new Ext.Button({text:'&nbsp;Choice '+(this.idx+1),menu:{idx:this.idx,items:[{text:'Move Up',iconCls:'mki16 mkiFlowConditionUp',cmd:'up',disabled:false,handler:this.moveFlowChoice},{text:'Move Down',iconCls:'mki16 mkiFlowConditionDown',cmd:'down',disabled:false,handler:this.moveFlowChoice},{text:'Move To',iconCls:'mki16 mkiFlowConditionTo ',menu:{width:60,height:131,cls:'fieldsetSliderMenu',items:[new Ext.Slider({height:100,cls:'fieldsetSlider',fsButton:fsButton,vertical:true,increment:1,value:-1*(this.idx+1),minValue:-2,maxValue:-1,cmd:'move',listeners:{changecomplete:function(slider,value){this.moveFlowChoice(slider);}.createDelegate(this),drag:function(){this.setIndicator(this.getValue());}},onRender:function(ct,position){Ext.Slider.prototype.onRender.call(this,ct,position);this.setIndicator(this.getValue());},setIndicator:function(positionValue){positionValue=positionValue*(-1);if(this.indicator){this.indicator.update(positionValue);}else{var thumb=this.innerEl.child('.x-slider-thumb');this.indicator=thumb.insertFirst({tag:'div'});this.render(this.indicator);this.indicator.addClass('indicatorContainer');this.indicator.insertHtml('afterBegin',positionValue);}}})]}},'-',{text:'Remove',iconCls:'mki16 mkiFlowConditionDelete',cmd:'remove',handler:this.moveFlowChoice}]}})];Mkt.widgets.DataPanelEditor.FieldsetButton.superclass.initComponent.call(this);}});Mkt.widgets.DataPanelManager=Ext.extend(Ext.Panel,{enableAutosave:true,CONDITIONS:'conditions',ACTIONS:'actions',welcomeTargetMessage:'Drag items from the right',welcomeReadOnlyMessage:'This list cannot be edited.',baseCls:'mktDataPanelManager x-plain',autoWidth:true,region:'center',bodyStyle:'overflow-x: hidden; position: relative;overflow:scroll',dpEditable:true,collapseAll:false,storeCache:{},destroy:function(){Ext.dd.ScrollManager.unregister(this.body);Ext.dd.ScrollManager.unregister(this.bwrap);Mkt.widgets.DataPanelManager.superclass.destroy.call(this);},resizePanels:function(){if(this.countDataPanels()>0){var dataPanels=this.getDataPanels();for(var i=0;i<dataPanels.length;i++){if(dataPanels[i].getTopToolbar().getWidth()===0){dataPanels[i].getTopToolbar().setWidth();}
dataPanels[i].syncSize();}}},initComponent:function(){this.accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;this.saveQueue={blockingSaveInProgress:false,dataPanelMetas:'',dataPanelCount:null,pendingChangesCount:0};this.lastSave={acceptUpdates:null,dataPanelMetas:'',dataPanelMetasUpdated:''};if(!this.dpEditable){this.collapseAll=true;}
this.dataPanelStorageId=MktPage.appVars[this.appVarsBase+'Id'];Mkt.widgets.DataPanelManager.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,dragout:true,beforedrop:true,drop:true});this._initTemplates();this._initMasterPanel();},initEvents:function(){Mkt.widgets.DataPanelManager.superclass.initEvents.call(this);this.on('add',this.toggleWelcomeTarget,this);this.on('remove',this.toggleWelcomeTarget,this);this.on('dragover',this.onDragOver,this);this.on('dragout',this.onDragOut,this);this.on('drop',this.onDrop,this);this.on('resize',this.resizePanels,this);this.dd=new Mkt.widgets.DataPanelManager.DropZone(this,this.dropConfig);},_initTemplates:function(){var ts=this.templates||{};ts.div=ts.div||new Ext.Template('<div class="{cls}" style="{style}" {attr}>','<div>{content}</div></div>');ts.panelHeader=ts.panelHeader||new Ext.Template('<div class="mktDataPanelHeader">','<div class="title-text">'+'<div class="title-icon {iconCls}"><img src="{imgSrc}"></div>','{title}'+'</div>','</div>','{summary}');ts.div_icon_button=ts.div_icon_button||new Ext.Template('<div class="{iconCls}" qa="{qa}" style="cursor:pointer;{style}" {attr}',' ext:qtip="{qtip}" ext:qtitle="{qtitle}">','</div>');ts.div_button=ts.div_button||new Ext.Template('<div class="clickable" style="float: left">{text}</div>','<div class="{iconCls}" qa="{qa}" style="{style}" {attr}>','<div><img src="{imgSrc}"></div>','</div>');ts.clickable_text=ts.clickable_text||new Ext.Template('<a href="#" style="{style}" onclick="return false;" '+' ext:qtip="{qtip}" ext:qtitle="{qtitle}">{text}','</a>');ts.form_element=ts.form_element||new Ext.Template('<div class="x-form-field-wrap">','<div class="{iconCls}" style="float:right;"></div>','<div class="{cls}" ext:qtip="{qtip}" ext:qtitle="{qtitle}">{text}</div>','</div>');ts.welcomeTarget=ts.welcomeTarget||new Ext.Template('<div class="welcomeTarget"><h1>{content}</h1></div>');for(var k in ts){var t=ts[k];if(t&&typeof t.compile=='function'&&!t.compiled){t.disableFormats=true;t.compile();}}
this.templates=ts;},_initMasterPanel:function(){this.ddGroup=this.ddGroupName;this._loadDataPanels();if(this.hasPalette){this.html=this.templates.welcomeTarget.apply({content:this.dpEditable?this.welcomeTargetMessage:this.welcomeReadOnlyMessage});this.toggleWelcomeTarget();}
window.setTimeout(this._afterPanelsLoaded.createDelegate(this),10);},_afterPanelsLoaded:function(){this.setAutoScroll(true);this.body.setStyle('overflow','auto');this.body.setStyle('overflow-x','hidden');if(this.canvas)MktCanvas.unmask(this.canvas);},filterIndex:0,_loadDataPanels:function(){var metas=this.getDataPanelMetas();if(DPDEBUG)console.debug("Loading Data Panel dpMeta=",metas);if(metas){for(var i=0;i<metas.length;i++){var dp=this._addDataPanel(metas[i],-1);dp.dpMeta.order=i+1;dp.refreshHeader();}}
else{if(DPDEBUG){console.debug("Data Panel information is missing.",this.getDataPanelMetas);}}
this.lastSave.dataPanelMetasUpdated=this.dataPanelMetas=this._serializeDataPanels();},_addDataPanel:function(dpMeta,pos){if(!dpMeta.dpid){var dpid=this.generateId("datapanel-");dpMeta.dpid=dpid;}
dpMeta.edited=false;var cls='mktDataPanel';if(this.isSmartlist){cls+=' panel-smartlist';if(dpMeta.tt=='attribute'){cls+=' panel-filter-attribute';}
else if(dpMeta.tt=='activity'&&dpMeta.trigger){cls+=' panel-trigger-activity';}
else if(dpMeta.tt=='activity'){cls+=' panel-filter-activity';}}
else if(this.isFlow){cls+=' panel-flow';cls+=' panel-flow-action';}
if(this.dpEditable){cls+=' grabbable';}
if(!dpMeta.userPrefs){dpMeta.userPrefs={collapsed:false};}
if(this.isSmartlist&&!dpMeta.trigger){this.filterIndex++;dpMeta.filterIndex=this.filterIndex;}
var dpEditable=this.dpEditable;if(dpMeta.isSystem||dpMeta.readOnly){dpEditable=false;}
var dp=new Mkt.widgets.DataPanel({id:dpid,dpid:dpid,dpMgr:this,canvas:this.canvas,dpEditable:dpEditable,isFlow:this.isFlow,isSmartlist:this.isSmartlist,SETTINGS:this.SETTINGS,dpMeta:dpMeta,bottomToolbarTipText:this.writeBottomToolbarTipText(dpMeta),draggable:this.dpEditable,title:this.getDPTitleText(dpMeta),iconCls:this.getDPIconCls(dpMeta),cls:cls,dpCollapsed:dpMeta.userPrefs.collapsed,ddGroup:this.ddGroupName,tbar:[],html:'',items:{}});if(pos==-1){this.add(dp);}
else{this.insert(pos,dp);}
return dp;},writeBottomToolbarTipText:function(dpMeta){if(dpMeta.trigger&&dpMeta.name=='Request Campaign'){return'Note:  Remember to give the campaign a good description';}
if(dpMeta.name=='Delete Lead'||dpMeta.name=='Destroy Lead'){return'This will permanently remove the lead from your Marketo database';}
return null;},generateId:function(prefix){return prefix+Math.floor(Math.random()*1000001);},getDataPanelById:function(dpid){var panels=this.getDataPanels();for(var i=0;i<panels.length;i++){if(panels[i].dpMeta.dpid==dpid)return panels[i];}
return null;},hasDataPanels:function(){return this.items&&this.items.getCount()>0;},countDataPanels:function(){if(this.items){return this.items.getCount();}
return 0;},getDataPanels:function(){if(this.items){return this.items.items;}
return[];},getTriggers:function(){return this.getSmartlistDataPanelsByType(true);},getFilters:function(){return this.getSmartlistDataPanelsByType(false);},countFilters:function(){var filters=this.getSmartlistDataPanelsByType(false);return filters.length;},getSmartlistDataPanelsByType:function(trigger){var f=[];if(this.isSmartlist){var datapanels=this.getDataPanels();for(var i=0;i<datapanels.length;i++){if(trigger&&datapanels[i].dpMeta.trigger){f.push(datapanels[i]);}
else if(!trigger&&!datapanels[i].dpMeta.trigger){f.push(datapanels[i]);}}}
return f;},firstTriggerPosition:function(){return this.getFirstSmartlistDataPanelPositionByType(false);},firstFilterPosition:function(){return this.getFirstSmartlistDataPanelPositionByType(false);},getFirstSmartlistDataPanelPositionByType:function(trigger){var datapanels=this.getDataPanels();for(var i=0;i<datapanels.length;i++){var dp=datapanels[i];if(trigger&&dp.dpMeta.trigger){return i;}
else if(!trigger&&!dp.dpMeta.trigger){return i;}}
return-1;},removeDataPanel:function(dp){this.remindUserToUpdateCustomLogic(dp.dpMeta);dp.ownerCt.remove(dp,true);this.autosave('remove',false,false);},toggleWelcomeTarget:function(){if(this.hasDataPanels()){this.removeClass('x-panel-dd-spacer');this.removeClass('welcomeTargetDragOver');}
else{this.addClass('x-panel-dd-spacer');}},onDragOver:function(){if(!this.hasDataPanels()){this.addClass('welcomeTargetDragOver');}},onDragOut:function(){this.removeClass('welcomeTargetDragOver');},onDrop:function(){this.removeClass('welcomeTargetDragOver');},dropConfig:{},getDPTitleText:function(dpMeta){var title=dpMeta.displayName||dpMeta.name;if(this.dpSubtype!=DPConst.RUN_ACTION){if(this.isFlow){title=dpMeta.order+' - '+title;}
else if(this.isSmartlist){if(!dpMeta.trigger){title=dpMeta.filterIndex+' - '+title;}}}
return title;},getDPIconCls:function(dpMeta){var iconCls;if(this.isFlow){iconCls=dpMeta.iconCls||'mkiCubes';}
else if(this.isSmartlist){if(dpMeta.trigger){iconCls=dpMeta.iconCls||'mkiFlashYellow';}
else{iconCls=dpMeta.iconCls||'mkiFunnel';}}
if(this.isFlow&&iconCls.indexOf('mki')==-1&&this._legacyIcons[iconCls]){iconCls=this._legacyIcons[iconCls];}
return iconCls;},_legacyIcons:{'ico-document ico-add':'mkiIndexAdd','ico-form ico-alert':'mkiFormBlueEdit','ico-favorites ico-alt1':'mkiStar2Yellow','ico-user ico-alt1-disabled':'mkiUserDelete','ico-stop':'mkiSignStop','ico-document ico-add-disabled':'mkiIndexDelete','ico-document ico-new':'mkiDocumentPlainNew','ico-flag ico-alt1':'mkiBell2Gold','ico-next ico-alt1':'mkiArrow2RightBlue','ico-mail':'mkiMail2','ico-clock':'mkiClock','ico-flag':'mkiSignalFlagYellow','ico-currency ico-alt1':'mkiHandThumbUp','ico-cubestack':'mkiCubes','ico-google ico-alt1-disabled':'mkiCustSalesforce','ico-google ico-alt2':'mkiCustSalesforce','ico-google ico-alt2-disabled':'mkiCustSalesforce','ico-user ico-alt2-disabled':'mkiUserInformation','':null},addDataPanelFromTree:function(treeNode,insertPos){if(treeNode.attributes.dpMeta.name===Mkt.apps.jigsawAdmin.JIGSAW_ACTIVITY_TYPE_NAME&&!MktPage.savedState.jigsawActive){Mkt.apps.jigsawAdmin.Actions.showIntro();return null;}
var dpMeta=this._cloneTreeDpMeta(treeNode.attributes.dpMeta);dpMeta.hideEmptyFieldWarnings=true;if(!dpMeta.iconCls)dpMeta.iconCls=treeNode.attributes.iconCls;if(DPDEBUG){console.debug('cloned treeNode dpMeta=',dpMeta);}
if(dpMeta.limitQuantity&&this.countDataPanels()>0){var items=this.items.items;var count=0;for(var i=0;i<items.length;i++){if(items[i].dpMeta.name==dpMeta.name){count++;}}
if(count>=dpMeta.limitQuantity){MktMessage.showWarning('Only one "'+(dpMeta.displayName||dpMeta.name)+'" rule is allowed');return null;}}
this.remindUserToUpdateCustomLogic(dpMeta);var dp=this._addDataPanel(dpMeta,insertPos);this.doLayout();this.scrollToPanel(dp);this.autosave('add',dp,true);dp.highlight();return dp;},scrollToPanel:function(panel){},_cloneTreeDpMeta:function(data){var newObj=Ext.apply({},data);newObj[this.SETTINGS]=this._cloneDataRecordArray(newObj[this.SETTINGS]);return newObj;},_cloneDataRecordArray:function(ary){var newAry=ary.slice();for(var j=0;j<newAry.length;j++){newAry[j]=this.cloneDataRecord(ary[j]);}
return newAry;},cloneDataRecord:function(data){var newObj=Ext.apply({},data);if(newObj.condition){newObj.condition=this.cloneDataRecord(newObj.condition);}
if(newObj.options){newObj.options=this._cloneDataRecordArray(newObj.options);}
return newObj;},autosave:function(cause,dp,acceptUpdates){if(DPDEBUG){console.debug("autosave caused by "+cause);}
if(dp){dp.dpMeta.edited=true;}
if(!this.enableAutosave){return;}
var dataPanelCount=this.countDataPanels();if(dataPanelCount===0&&cause!='remove'){console.debug('aborting save - only a cause of "remove" is valid when trying to save empty data panels');return;}
var errorCount=0;if(dp!=undefined){errorCount=this.validateDataPanel(dp);}
else{errorCount=this.validateAllDataPanels();}
if(errorCount!==0){this.validationErrorMessage();}
else{this.save(cause,dp,acceptUpdates);}},validateDataPanel:function(dp){return 0;},validateAllDataPanels:function(){var errorCount=0;var datapanels=this.getDataPanels();for(var i=0;i<datapanels.length;i++){var dp=datapanels[i];errorCount+=this.validateDataPanel(dp);}
return errorCount;},save:function(cause,dp,acceptUpdates){this._updateDataPanelOrder(true);if(this.saveQueue.blockingSaveInProgress){this.saveQueue.pendingChangesCount++;this.saveQueue.dataPanelMetas=this._serializeDataPanels();this.saveQueue.dataPanelCount=this.countDataPanels();console.debug('Another save is in progress...pending changes count=',this.saveQueue.pendingChangesCount,' panel count=',this.saveQueue.dataPanelCount,' saveQueue=',this.saveQueue);return;}
var dataPanelMetas;if(this.saveQueue.dataPanelMetas){dataPanelMetas=this.saveQueue.dataPanelMetas;}
else{dataPanelMetas=this._serializeDataPanels();}
console.debug('Clearing saveQueue');this.saveQueue.pendingChangesCount=0;this.saveQueue.dataPanelMetas=null;this.saveQueue.dataPanelCount=0;if(dataPanelMetas===null){console.debug('Aborting save - meta data is null',dataPanelMetas);return;}
if(dataPanelMetas.length===0&&this.isFlow){console.debug('This will delete your last flow step.');}
if(this.dpSubtype!=DPConst.RUN_ACTION&&dataPanelMetas){if(this.lastSave.dataPanelMetas&&this.lastSave.dataPanelMetas==dataPanelMetas){console.debug('No changes to save');return;}
else if(this.lastSave.dataPanelMetasUpdated&&this.lastSave.dataPanelMetasUpdated==dataPanelMetas){console.debug('No changes to save -- current settings are the same as last update');return;}}
console.debug('Saving Changes:',dataPanelMetas.length,dataPanelMetas);if(this.lastSave.dataPanelMetas){console.debug('Previous Save:',this.lastSave.dataPanelMetas.length,this.lastSave.dataPanelMetas);}
if(this.lastSave.dataPanelMetasUpdated){console.debug('Previous Update:',this.lastSave.dataPanelMetasUpdated.length,this.lastSave.dataPanelMetasUpdated);}
this.lastSave.acceptUpdates=acceptUpdates;this.lastSave.dataPanelMetas=dataPanelMetas;this.saveQueue.blockingSaveInProgress=true;this.beforeSaveMessage();var params=Ext.apply({dataPanelMetas:dataPanelMetas,accessZoneId:this.accessZoneId},this.baseSaveParams);if(this.isSmartlist&&this.smartListRuleLogic.customMode()){if(this.smartListRuleLogic.isCustomLogicValid()){var smartListLogicParams=this.smartListRuleLogic.getSmartListLogicSaveParams();Ext.apply(params,smartListLogicParams);}
else{console.debug('Data panel save successful. Custom rule logic is not valid');}}
params[this.appVarsBase+'Id']=this.dataPanelStorageId;this.beforeSaveHook();if(DPDEBUG){console.debug("Saving... ",params);}
MktSession.ajaxRequest(this.saveAction,{serializeParms:params,onMySuccess:this.saveSuccess.createDelegate(this),onMyFailure:this.saveFailure.createDelegate(this)});},_updateDataPanelOrder:function(refreshHeaders){var datapanels=this.getDataPanels();var triggerCount=this.getTriggers().length;for(var i=0;i<datapanels.length;i++){var dp=datapanels[i];dp.dpMeta.order=i+1;if(this.isSmartlist&&!dp.dpMeta.trigger){dp.dpMeta.filterIndex=dp.dpMeta.order-triggerCount;}
if(refreshHeaders){dp.refreshHeader();}}},_serializeDataPanels:function(){if(!this.items){return null;}
if(!this.hasDataPanels())return[];var datapanels=this.getDataPanels();var metas=[];for(var i=0;i<datapanels.length;i++){var dp=datapanels[i];dp.updateMetaData();metas.push(dp.dpMeta);}
MktPage.appVars[this.appVarsBase+this.dpType+'SerializedMetas']=metas;if(DPDEBUG)console.debug("Serialized dataPanelMetas=",metas);return MktSession.encodeURIComponent(Ext.util.JSON.encode(metas));},saveSuccess:function(){var updateId=MktPage.appVars[this.appVarsBase+'UpdateId'];if(updateId!=this.dataPanelStorageId){console.debug('Error - out of order Ajax save');console.debug('attempting to update '+this.dataPanelStorageId+' with data from '+updateId);this.saveQueue.blockingSaveInProgress=false;return;}
this.afterSaveMessage();try{this.updateDataPanels();}
catch(e){console.debug("saveSuccess.updateDataPanels failed",e);}
if(this.countDataPanels()){console.debug('Clearing saveQueue dataPanelMetas');this.saveQueue.dataPanelMetas=null;}
this.saveQueue.blockingSaveInProgress=false;if(this.saveQueue.pendingChangesCount>0){console.debug('Need to save again...pending changes count=',this.saveQueue.pendingChangesCount,' panel count=',this.saveQueue.dataPanelCount,' saveQueue=',this.saveQueue);this.autosave('saving pending changes',false,true);}
else{this.afterSaveHook();}},saveFailure:function(){if(DPDEBUG){console.debug('Save Failed!');}
this.saveQueue.blockingSaveInProgress=false;this.saveQueue.pendingChangesCount++;},updateDataPanels:function(){if(this.lastSave.acceptUpdates){this.dataPanelMetas=this.getDataPanelMetas();this.lastSave.dataPanelMetasUpdated=this.dataPanelMetas;var metas=this.dataPanelMetas;for(var i=0;i<metas.length;i++){var dpMeta=metas[i];var dp=this.getDataPanelById(dpMeta.dpid);if(dp){if(dp.dpMeta.edited){if(DPDEBUG){console.debug("Updating data panel dpMeta=",dpMeta);}
dp.updateDataPanelMeta(dpMeta);dp.dpMeta.edited=false;}}
else{if(DPDEBUG){console.debug("Data panel dpid "+dpMeta.dpid+" \""+dpMeta.name+"\" was not found.");}}}}},setAllCollapsed:function(){var datapanels=this.getDataPanels();for(var i=datapanels.length-1;i>=0;i--){datapanels[i].setCollapsed(true,this.animateCollapse);}},setAllExpanded:function(){var datapanels=this.getDataPanels();for(var i=0;i<datapanels.length;i++){datapanels[i].setCollapsed(false,this.animateCollapse);}},cli:function(cmd){if(cmd.indexOf('debug off')===0){DPDEBUG=false;console.debug('Debug mode disabled. Type "debug" to enable.');}
else if(cmd.indexOf('debug')===0){DPDEBUG=true;console.debug('Debug mode enabled. Type "debug off" to disable.');}
else if(cmd.indexOf('dumpqueue')===0){console.debug('saveQueue=',saveQueue);}
else if(cmd.indexOf('dump')===0){this.dump(cmd);}
else if(cmd.indexOf('importdp')===0&&MktPage.xfeatures){this.importDataPanels();}
else if(cmd.indexOf('countdp')===0){console.debug('data panels:',this.countDataPanels());}},dump:function(cmd){console.debug('-- Dumping Data Panels --');var datapanels=this.getDataPanels();for(var i=0;i<datapanels.length;i++){var dp=datapanels[i];console.group('Data Panel '+(i+1)+': '+dp.dpMeta.displayName);console.debug('dpMeta=',dp.dpMeta);if(dp.dpMeta.errorMeta){console.debug('Error Meta=',dp.dpMeta.errorMeta);}
console.debug('Data Store ('+dp.store.data.items.length+' items):');for(var j=0;j<dp.store.data.items.length;j++){if(this.DPDEBUG)console.dir(dp.store.data.items[j].data);}
var settings=dp.dpMeta[this.SETTINGS];console.debug('Meta '+this.SETTINGS+' ('+settings.length+' items):');for(var k=0;k<settings.length;k++){var st=settings[k];console.debug('\t',k,st);}
console.groupEnd();}},importDataPanels:function(){var metas=prompt('Import Data Panels:',this.lastSave.dataPanelMetas);metas=Ext.util.JSON.decode(metas);if(metas){console.debug('Importing data panel JSON:',metas);for(var i=0;i<metas.length;i++){delete metas[i].iid;}
this.saveQueue.pendingChangesCount++;this.saveQueue.dataPanelMetas=MktSession.encodeURIComponent(Ext.util.JSON.encode(metas));this.autosave('import',false,true);}},validationErrorMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.errorText,cfg.errorIconCls);},beforeSaveMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.savingText,cfg.savingIconCls);},afterSaveMessage:function(){var cfg=this.autoSaveConfig;var dt=new Date();this.setSaveMessage(cfg.savedText+dt.format('M j, h:ia'),cfg.savedIconCls);},autoSaveConfig:{nochangeText:'<span class="mktAutoSavedText">Auto-Save: </span> no changes',nochangeIconCls:'mkiFloppyDisk',savingText:'<span class="mktAutoSavedText">Auto-Save: </span> saving...',savingIconCls:'mkiFloppyDisk',savedText:'<span class="mktAutoSavedText">Auto-Save: </span> ',savedIconCls:'mkiFloppyDisk',errorText:'<span class="mktAutoSavedText">Auto-Save: </span> error',errorIconCls:'mkiFloppyDiskError',highlightColor:'#c3daf9'},createAutoSaveBtn:function(){var cfg=this.autoSaveConfig;this.saveBtn=new Ext.Button({text:cfg.nochangeText,iconCls:cfg.nochangeIconCls,disabled:true});return this.saveBtn;},setSaveMessage:function(msg,iconCls){if(this.canvas&&this.saveBtn&&this.saveBtn.btnEl){this.saveBtn.setText(msg);this.saveBtn.setIconClass(iconCls);this.saveBtn.el.highlight(this.autoSaveConfig.highlightColor,{block:true});}},beforeSaveHook:function(){},afterSaveHook:function(){},initSmartListRuleLogic:function(tbar){this.smartListRuleLogic=new Mkt.widgets.SmartListRuleLogic(this);return this.smartListRuleLogic.buildToolbar(tbar);},remindUserToUpdateCustomLogic:function(dpMeta){if(this.isSmartlist&&(!dpMeta||!dpMeta.trigger)){this.smartListRuleLogic.remindUserToUpdateCustomLogic();}},end:true});Ext.reg('dpMgr',Mkt.widgets.DataPanelManager);Mkt.widgets.SmartListRuleLogic=function(dpMgr){this.dpMgr=dpMgr;this.appVarsBase=dpMgr.appVarsBase;this.ruleMatchType=MktPage.appVars[this.appVarsBase+'RuleMatchType']||this.ALL;};Ext.apply(Mkt.widgets.SmartListRuleLogic.prototype,{ALL:'all',ANY:'any',CUSTOM:'custom',log:'SmartListRuleLogic',matchTypes:{all:'Use <b>ALL</b> filters',any:'Use <b>ANY</b> filters',custom:'Use <b>Advanced</b> filters'},buildToolbar:function(tbar){tbar.push(this._initMenu());tbar.push(this._initCustomLogicTextField());tbar.push(this._initHelp());tbar.push('|');},customMode:function(){return this.ruleMatchType==this.CUSTOM;},allowCustomMode:function(){return this.dpMgr.countFilters()>=3;},isCustomLogicValid:function(){if(this.customLogicField){this.customLogicField.saveOnValidate=false;var valid=this.customLogicField.validate();this.customLogicField.saveOnValidate=true;return valid;}},remindUserToUpdateCustomLogic:function(){if(this.customMode()){var color='#FBEC5D';var el=this.customLogicField.getEl();this.customLogicField.showWarning();el.setStyle('background-color','#FFFFFF');this.highlightEl(el,color,2);}},highlightEl:function(el,color,count){var callback;if(count>1){callback=this.highlightEl.createDelegate(this,[el,color,count-1]);}
else{callback=function(){};}
el.highlight(color,{attr:'background-color',endColor:"#FFFFFF",easing:'easein',duration:1,callback:callback});},_initMenu:function(){var menuCfg={items:['<b class="menu-title">Choose Smart List rule logic</b>',{text:this.matchTypes[this.ALL]+' (1 and 2 and 3 ...)',ruleMatchType:this.ALL,checked:this.ruleMatchType===this.ALL,group:'ruleMatchType',checkHandler:this._ruleMatchChanged.createDelegate(this)},{text:this.matchTypes[this.ANY]+' (1 or 2 or 3 ...)',ruleMatchType:this.ANY,checked:this.ruleMatchType===this.ANY,group:'ruleMatchType',checkHandler:this._ruleMatchChanged.createDelegate(this)},{itemId:'mktCustomRuleMatchTypeMenuItem',text:this.matchTypes[this.CUSTOM],ruleMatchType:this.CUSTOM,checked:this.ruleMatchType===this.CUSTOM,disabled:!this.allowCustomMode(),group:'ruleMatchType',checkHandler:this._ruleMatchChanged.createDelegate(this)}]};this.ruleMatchTypeButton=new Ext.Button({text:this.matchTypes[this.ruleMatchType],iconCls:'mkiFunnel',disabled:!this.dpMgr.dpEditable,menu:menuCfg});this.ruleMatchTypeButton.on('click',this._onMenuClick,this);return this.ruleMatchTypeButton;},_onMenuClick:function(){this.ruleMatchTypeButton.menu.get('mktCustomRuleMatchTypeMenuItem').setDisabled(!this.allowCustomMode());},_initCustomLogicTextField:function(){var logicText=MktPage.appVars[this.appVarsBase+'CustomRuleLogic'];var field=this.customLogicField=new Ext.form.TextField({id:'mktSmartListRuleLogicField',value:logicText,prevValue:logicText,cls:'icon-ready',hidden:!this.customMode(),disabled:!this.dpMgr.dpEditable,width:200,maskRe:/^[andorANDOR0-9\s()]+$/,getErrors:this._validateCustomLogicGetErrors,smartlistRuleLogic:this,saveOnValidate:false,onValid:function(e){if(this.saveOnValidate&&this.getRawValue()!=this.prevValue){this.prevValue=this.getRawValue();this.smartlistRuleLogic.save();}},showWarning:function(){this.getEl().addClass('warning-sign');},hideWarning:function(){this.getEl().removeClass('warning-sign');}});field.addListener('focus',field.hideWarning,field);field.addListener('valid',field.onValid,field);field.addListener('render',function(){if(this.smartlistRuleLogic.customMode()){console.debug('Custom logic rendered, starting value=',this.value);}
this.validate();this.saveOnValidate=true;},field);return field;},_validateCustomLogicGetErrors:function(){if(!this.smartlistRuleLogic.customMode()){return[];}
if(this.saveOnValidate){this.hideWarning();}
var errors=[];var logicText=this.getRawValue()||this.value;if(!logicText){logicText=this.smartlistRuleLogic.defaultCustomRuleLogicText();console.debug('custom logic validation building default text and found:',logicText);this.setRawValue(logicText);}
var filters=this.smartlistRuleLogic.dpMgr.getFilters();var entered=logicText.match(/\d+/g)||[];var missing=[];var matched=[];var repeated=[];for(var z=0;z<filters.length;z++){var filter=filters[z];var filterIndex=''+filter.dpMeta.filterIndex;if(entered.indexOf(filterIndex)==-1){missing.push(filterIndex);}
else{matched.push(filterIndex);}}
if(missing.length>0){errors.push('<b>Not Saved. Missing filters:</b> '+missing.join(' '));}
else if(entered.length>matched.length){var known=[];var unknown=[];for(var j=0;j<entered.length;j++){if(matched.indexOf(entered[j])==-1){unknown.push(entered[j]);}
else if(known.indexOf(entered[j])!=-1){repeated.push(entered[j]);}
else{known.push(entered[j]);}}
if(unknown.length>0){errors.push('<b>Not Saved. Unknown filters:</b> '+unknown.join(' '));}
else if(repeated.length>0){errors.push('<b>Not Saved. Repeated Filters:</b> '+repeated.join(' '));}}
if(!this.maskRe.test(logicText)){errors.push('<b>Not Saved. Invalid expression</b><br><br>'+this.smartlistRuleLogic.customLogicExamples);}
try{var evalText=logicText.replace(/and/gi,'&&').replace(/or/gi,'||');var result=eval(evalText);}
catch(e){errors.push('<b>Not Saved. Invalid expression</b><br><br>'+this.smartlistRuleLogic.customLogicExamples);}
var mixedAndOr=logicText.replace(/[^andor()]+/gi,'').toLowerCase();var mixedAndOr2=mixedAndOr.replace(/\(.*\)/gi,'').toLowerCase();if(mixedAndOr.indexOf('()')!=-1){errors.push('<b>Not Saved. Empty parenthesis are not allowed</b><br><br>'+this.smartlistRuleLogic.customLogicExamples);}
if(mixedAndOr.indexOf('andor')!=-1||mixedAndOr.indexOf('orand')!=-1||mixedAndOr2.indexOf('andor')!=-1||mixedAndOr2.indexOf('orand')!=-1){errors.push('<b>Not Saved. AND and OR must be separated by parenthesis</b><br><br>'+this.smartlistRuleLogic.customLogicExamples);}
if(errors.length>0){console.debug('Invalid custom smart list logic:',errors);}
return errors;},_initHelp:function(){return this.customLogicHelp=new Ext.Button({iconCls:'mkiHelp',hidden:!this.customMode(),handler:this.showAdvancedHelp.createDelegate(this)});},_setCustomLogicVisible:function(show){this.customLogicField.setVisible(show);this.customLogicHelp.setVisible(show);},_ruleMatchChanged:function(item,checked){if(!checked){return;}
this.previousRuleMatchType=this.ruleMatchType;this.ruleMatchType=item.ruleMatchType;this._setCustomLogicVisible(this.customMode());if(this.customMode()&&this.previousRuleMatchType!=this.CUSTOM){this._resetCustomRuleLogicText();}
console.debug(this.log+'.save ruleMatchType changing from ',this.previousRuleMatchType,' to ',this.ruleMatchType);this.save();},getSmartListLogicSaveParams:function(){var params=Ext.apply({},this.dpMgr.baseSaveParams);params[this.appVarsBase+'Id']=this.dpMgr.dataPanelStorageId;params[this.appVarsBase+'RuleMatchType']=this.ruleMatchType;var logicText=this._formatLogicTextForSave();params[this.appVarsBase+'CustomRuleLogic']=logicText;params[this.appVarsBase+'CustomRuleLogicIIDs']=this._translateFilterIndexToIID(logicText);return params;},save:function(){this.ruleMatchTypeButton.setText(this.matchTypes[this.ruleMatchType]);this.dpMgr.beforeSaveHook();MktSession.ajaxRequest('/'+this.dpMgr.phpModule+'/edit'+this.dpMgr.dpType+'RuleLogic',{serializeParms:this.getSmartListLogicSaveParams(),onMySuccess:this.saveSuccess.createDelegate(this)});},saveSuccess:function(){var saveStatus=MktPage.appVars[this.appVarsBase+'RuleLogicSaved'];if(saveStatus=='Saved'){var ruleMatchType=MktPage.appVars[this.appVarsBase+'RuleMatchType'];var customRuleLogic=MktPage.appVars[this.appVarsBase+'CustomRuleLogic'];console.debug('Smart List rule logic ',saveStatus,'. Rule Match Type:',ruleMatchType,' Custom Rule Logic:',customRuleLogic);this.dpMgr.afterSaveMessage();if(this.dpMgr.afterSaveHook){this.dpMgr.afterSaveHook();}}
else{this.dpMgr.validationErrorMessage();var error=MktPage.appVars[this.appVarsBase+'RuleLogicError'];console.debug('Smart List rule logic ',saveStatus,' error:',error);}},_resetCustomRuleLogicText:function(){this.customLogicField.setValue(this.defaultCustomRuleLogicText());},defaultCustomRuleLogicText:function(){var logicText='';var andOr=this.previousRuleMatchType==this.ANY?' or ':' and ';var filters=this.dpMgr.getFilters();for(var i=0;i<filters.length;i++){if(i>0)logicText+=andOr;logicText+=filters[i].dpMeta.filterIndex;}
return logicText;},_formatLogicTextForSave:function(){var logicText='';if(this.customMode()){logicText=this.customLogicField.getValue();}
return logicText;},_translateFilterIndexToIID:function(logicText){var logicAry=logicText.split(' ');console.debug('logicAry=',logicAry);var filterMap=this._buildFilterMap();for(var i=0;i<logicAry.length;i++){if(logicAry[i]){var s=logicAry[i];var iid=filterMap[s];if(iid!=undefined){logicAry[i]=iid;}}}
var iidLogicText=logicAry.join(' ');console.debug('logicText=',logicText,'  translated to iidLogicText=',iidLogicText);return iidLogicText;},_buildFilterMap:function(){var map={};var filters=this.dpMgr.getFilters();for(var i=0;i<filters.length;i++){var dpMeta=filters[i].dpMeta;map[''+dpMeta.filterIndex]=dpMeta.iid;}
return map;},customLogicExamples:'<p>Examples:</p>'+'<ul>'+'<li>1 and 2 and 3</li>'+'<li>1 or 2 or 3</li>'+'<li>1 and (2 or 3)</li>'+'<li>(1 and 2) or 3</li>'+'<li>(1 and 2) or (3 and 4)</li>'+'</ul>',getHelpText:function(){return'<p>This option allows you to control how filters are used. '+'Only filters are affected&mdash;any triggers will apply separately.</p>'+'<p>Enter the filter numbers separated by "and" and "or".</p>'+'<ul>'+'<li>1 and 2 and 3</li>'+'<li>1 or 2 or 3</li>'+'</ul>'+'<p>Mixing "and" and "or" requires parenthesis so that your intention is clear. '+'For example, "1 or 2 and 3" must be written as one of the following:</p>'+'<ul>'+'<li>1 and (2 or 3)</li>'+'<li>(1 and 2) or 3</li>'+'</ul>'+'<p>More complicated logic may require nested parenthesis.</p>'+'<ul>'+'<li>(1 and 2) or (3 and 4)</li>'+'<li>1 and (2 or (3 and 4))</li>'+'</ul>'+'<br /><p><img src="/images/icons16/sign_warning.png" class="mki16-p" /> Check your rules after any insert, delete, or reorder.</p>';},showAdvancedHelp:function(){MktMessage.showHelp('Advanced Filters',this.getHelpText(),'mki48Funnel',this.customLogicField,'mkiFunnel');}});Mkt.widgets.DataPanelManager.DropZone=function(dpMgr,cfg){this.dpMgr=dpMgr;this.ddGroup=dpMgr.ddGroupName;Ext.dd.ScrollManager.register(dpMgr.body);Mkt.widgets.DataPanelManager.DropZone.superclass.constructor.call(this,dpMgr.bwrap.dom,cfg);dpMgr.body.ddScrollConfig=this.ddScrollConfig;};Ext.extend(Mkt.widgets.DataPanelManager.DropZone,Ext.dd.DropTarget,{containerScroll:true,ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{dpMgr:this.dpMgr,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed};},getDpMeta:function(dd,data){if(dd.panel){return dd.panel.dpMeta;}
else if(data.node&&data.node.attributes){return data.node.attributes.dpMeta;}
return null;},notifyOver:function(dd,e,data){var px=dd.proxy;var cw=this.dpMgr.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw;}else if(this.lastCW!=cw){this.lastCW=cw;this.dpMgr.doLayout();}
var col=0,panel=0,match=false,pos=0,itemCount=0;var c=this.dpMgr;var panels=null;if(c.items){panels=c.items.items;itemCount=c.items.getCount();for(var len=panels.length;pos<len;pos++){var el=panels[pos].getEl();if(el){var h=el.getHeight();if(h!==0&&(el.getY()+(h/2))>e.getXY()[1]){match=true;panel=panels[pos];break;}}}}
if(this.dpMgr.isSmartlist){var dpMeta=this.getDpMeta(dd,data);if(dpMeta.trigger){var filterPos=this.dpMgr.firstFilterPosition();if(filterPos!=-1&&pos>filterPos){pos=filterPos;if(panels)panel=panels[pos];}}
else{var triggerCount=this.dpMgr.getTriggers().length;if(pos<triggerCount){pos=triggerCount;if(panels)panel=panels[pos];}}}
this.lastPos={c:c,col:col,p:pos};var overEvent=this.createEvent(dd,e,data,col,c,match&&panel?pos:itemCount);if(this.dpMgr.fireEvent('validatedrop',overEvent)!==false&&this.dpMgr.fireEvent('beforedragover',overEvent)!==false){this.scrollPos=this.dpMgr.body.getScroll();if(dd.proxy.getProxy){this.notifyOverReorder(dd,e,data,c,col,panel,pos,match);}
else{var selPanel=panel?panel:panels[pos-1];if(selPanel){var proxyEl=Ext.get('proxy-treeToSmartList');if(proxyEl)
proxyEl=selPanel.el.insertSibling(proxyEl,panel?'before':'after');else{proxyEl=selPanel.el.insertSibling({id:'proxy-treeToSmartList',tag:'div',cls:'x-panel x-panel-dd-spacer',style:'height:120px'},panel?'before':'after');}}}
this.dpMgr.fireEvent('dragover',overEvent);}
return overEvent.status;},notifyOverReorder:function(dd,e,data,c,col,panel,pos,match){var px=dd.proxy;px.getProxy().setWidth('auto');if(panel){px.moveProxy(panel.el.dom.parentNode,match?panel.el.dom:null);}else{px.moveProxy(c.body.dom,null);}},notifyOut:function(e){var proxyEl=Ext.get('proxy-treeToSmartList');if(proxyEl)proxyEl.remove();this.dpMgr.fireEvent('dragout',e);},notifyDrop:function(dd,e,data){var success;if(dd.proxy.getProxy){success=this.notifyDropReorder(dd,e,data);}
else{success=this.notifyDropFromTree(dd,e,data);}
var dM=this.dpMgr;setTimeout(function(){dM.resizePanels();},10);return success;},notifyDropFromTree:function(dd,e,data){var proxyEl=Ext.get('proxy-treeToSmartList');if(proxyEl)proxyEl.remove();if(data.node&&this.lastPos){var pos=this.lastPos.p;var dp=this.dpMgr.addDataPanelFromTree(data.node,pos);e.stopEvent();return true;}},notifyDropReorder:function(dd,e,data){if(!this.lastPos)return;var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p;var dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.dpMgr.fireEvent('validatedrop',dropEvent)!==false&&this.dpMgr.fireEvent('beforedrop',dropEvent)!==false){dd.proxy.getProxy().remove();if(dd.panel.ownerCt==this.lastPos.c){dd.panel.el.dom.parentNode.removeChild(dd.panel.el.dom);}
if(this.lastPos.p!==false){var currentPosition=this.lastPos.c.items.indexOf(dd.panel);var insertIndex=currentPosition<this.lastPos.p?this.lastPos.p-1:this.lastPos.p;this.lastPos.c.insert(insertIndex,dd.panel);}else{this.lastPos.c.add(dd.panel);}
this.dpMgr.autosave('reorder',false,false);this.dpMgr.doLayout();this.dpMgr.fireEvent('drop',dropEvent);this.dpMgr.remindUserToUpdateCustomLogic(dd.panel.dpMeta);var st=this.scrollPos.top;if(st){var d=this.dpMgr.body.dom;setTimeout(function(){d.scrollTop=st;},10);}}}});Ext.apply(Ext.lib.Dom,{getXY:function(el){var fly=Ext.fly;var p,pe,b,scroll,bd=(document.body||document.documentElement);el=Ext.getDom(el);if(el==bd){return[0,0];}
if(el.getBoundingClientRect){try{b=el.getBoundingClientRect();}catch(e){b={left:0,top:0};}
scroll=fly(document).getScroll();return[b.left+scroll.left,b.top+scroll.top];}
var x=0,y=0;p=el;var hasAbsolute=fly(el).getStyle("position")=="absolute";while(p){x+=p.offsetLeft;y+=p.offsetTop;if(!hasAbsolute&&fly(p).getStyle("position")=="absolute"){hasAbsolute=true;}
if(Ext.isGecko){pe=fly(p);var bt=parseInt(pe.getStyle("borderTopWidth"),10)||0;var bl=parseInt(pe.getStyle("borderLeftWidth"),10)||0;x+=bl;y+=bt;if(p!=el&&pe.getStyle('overflow')!='visible'){x+=bl;y+=bt;}}
p=p.offsetParent;}
if(Ext.isSafari&&hasAbsolute){x-=bd.offsetLeft;y-=bd.offsetTop;}
if(Ext.isGecko&&!hasAbsolute){var dbd=fly(bd);x+=parseInt(dbd.getStyle("borderLeftWidth"),10)||0;y+=parseInt(dbd.getStyle("borderTopWidth"),10)||0;}
p=el.parentNode;while(p&&p!=bd){if(!Ext.isOpera||(p.tagName!='TR'&&fly(p).getStyle("display")!="inline")){x-=p.scrollLeft;y-=p.scrollTop;}
p=p.parentNode;}
return[x,y];}});Mkt.widgets.DataPanelLayout=Ext.extend(Ext.Panel,{canvas:null,cls:'mktDataPanelLayout',layout:'border',phpModule:'smartcampaigns',appVarsBase:'smartCampaign',dpType:'Smartlist',dpSubtype:'',dpEditable:true,paletteWidth:150,maxPaletteWidth:300,welcomeTargetMessage:'Drag items from the right',welcomeReadOnlyMessage:'This list cannot be edited.',baseSaveParams:null,manager:null,palette:null,frame:false,initComponent:function(){DPDEBUG=false;if(this.dpSubtype){this.addClass('mktDataPanelLayout-'+this.dpSubtype);}
if(this.canvas)MktCanvas.mask(this.canvas);if(this.dpType=='Smartlist'){this.isSmartlist=true;this.Flow=false;this.SETTINGS='conditions';}
else if(this.dpType=='Flow'){this.isSmartlist=false;this.isFlow=true;this.SETTINGS='actions';}
this.items=[];this.items.push({region:'center',margins:'7 5 10 10',layout:'fit',items:this.createManager()});if(this.dpEditable&&this.canvas&&this.paletteWidth>0){this.canvasWidth=MktCanvas.getWidth();var availableWidth=Math.min(this.canvasWidth-700,this.maxPaletteWidth);this.paletteWidth=Math.max(this.paletteWidth,availableWidth);this.items.push({cls:'mktEastPanel',region:'east',margins:'5 5 5 8',layout:'fit',width:this.paletteWidth,items:this.createPalette()});}
Mkt.widgets.DataPanelLayout.superclass.initComponent.apply(this);if(this.canvas)MktPage.canvasCleanupStack.push(this.canvasCleanup.createDelegate(this));if(this.canvas)this.extendCanvasToolbar();if(this.canvas)this.extendCanvasGutter();},canvasCleanup:function(){},afterRender:function(){Mkt.widgets.DataPanelLayout.superclass.afterRender.call(this);},extendCanvasToolbar:function(){if(this.tbarMessage){var tbar=['->',this.tbarMessage];MktCanvas.extendToolbar(tbar,this.canvas);}},gutterItems:[''],extendCanvasGutter:function(){var tbar=[];tbar.push('<div style="width: 16px"></div>');if(this.isSmartlist&&this.dpEditable){var logicButtons=this.manager.initSmartListRuleLogic(tbar);}
tbar.push(new Ext.Button({text:'Collapse All',iconCls:'mkiNavigateOpen',handler:this.manager.setAllCollapsed.createDelegate(this.manager)}));tbar.push(new Ext.Button({text:'Expand All',iconCls:'mkiNavigateClose',handler:this.manager.setAllExpanded.createDelegate(this.manager)}));tbar.push('->');if(this.dpEditable){var saveBtn=this.manager.createAutoSaveBtn();tbar.push(this.manager.saveBtn);}
tbar.push('<div style="width: 13px"></div>');MktCanvas.extendGutter(tbar,this.canvas,true);},createManager:function(){var props={layout:'fit',canvas:this.canvas,dpType:this.dpType,dpSubtype:this.dpSubtype,appVarsBase:this.appVarsBase,phpModule:this.phpModule,dpEditable:this.dpEditable,isFlow:this.isFlow,isSmartlist:this.isSmartlist,SETTINGS:this.SETTINGS,ddGroupName:'default',dataPanelLayout:this,saveAction:'/'+this.phpModule+'/edit'+this.dpType+'Submit',baseSaveParams:this.baseSaveParams,autosuggestAction:'/'+this.phpModule+'/autosuggest',dataPanelMetas:MktPage.appVars[this.appVarsBase+this.dpType+'Metas'],getDataPanelMetas:function(){return MktPage.appVars[this.appVarsBase+this.dpType+'Metas'];},welcomeTargetMessage:this.welcomeTargetMessage,welcomeReadOnlyMessage:this.welcomeReadOnlyMessage,hasPalette:this.paletteWidth>0,afterWipe:function(){if(this.canvas){MktPage.clearPanelContentValid(this.canvas);MktPage.activatePanel(this.canvas);}}};if(this.afterSaveHook){props.afterSaveHook=this.afterSaveHook;}
if(this.beforeSaveHook){props.beforeSaveHook=this.beforeSaveHook;}
this.manager=new Mkt.widgets.DataPanelManager(props);return this.manager;},createPalette:function(){this.paletteTree=new Mkt.widgets.SmartPaletteTreePanel({dataUrl:this.phpModule+'/smartpalette'+'?type='+this.dpType.toLowerCase(),dpType:this.dpType,cls:'mktTree',frame:false,autoScroll:true});this.palette=new Mkt.widgets.FilterTreePanel({dpMgr:this.manager,enterKeyPressed:function(text){this.dpMgr.cli(text);},layout:'fit',width:this.paletteWidth,filterFieldPadding:0,frame:false,autoScroll:false,items:new Ext.Panel({cls:'mktSmartPaletteTree',frame:true,layout:'fit',autoScroll:false,items:this.paletteTree})});this.palette.bindTree(this.paletteTree);return this.palette;}});
/* ========== ../mkt-ext-2.0/widgets/LayoutDesigner.js ============ */

Ext.namespace('Mkt.widget');Mkt.widget.LayoutDesigner=Ext.extend(Ext.Panel,{layout:'border',margins:'35 0 0 0',style:'padding-right: 5px;',border:false,baseCls:'layoutDesigner',cls:'mktLayoutDesigner',fieldTreeUrl:'leadDatabase/getFieldsAsTree',enableTreeCache:true,fitSizeToCanvas:true,reservedHeight:100,reservedWidth:20,paletteWidth:270,initComponent:function(){this.items=this.items||[];this.items.push({region:'center',margins:'7 5 10 10',layout:'fit'});if(!this.filterFieldTreePanel){this.filterFieldTreePanel=this.createFilterFieldTreePanel({paletteWidth:this.paletteWidth});this.items.push({region:'east',margins:'5 0 5 5',layout:'fit',width:this.paletteWidth,items:this.filterFieldTreePanel});}
Mkt.widget.LayoutDesigner.superclass.initComponent.call(this);this.on('render',function(){if(!this.center){this.center=this.items.items[0];}
if(!this.east){this.east=this.items.items[1];}
if(!this.centerComponents){this.centerComponents=this.buildCenterComponents();this.center.add(this.centerComponents);this.center.doLayout();}}.createDelegate(this));},buildCenterComponents:function(){var col1={id:'layoutColumn1'};if(this.layoutColumn1Items.length>0){col1.items=this.layoutColumn1Items;}
var col2={id:'layoutColumn2'};if(this.layoutColumn2Items.length>0){col2.items=this.layoutColumn2Items;}
this.layoutCanvas=new Mkt.widget.LayoutCanvas({columnCount:2,items:[col1,col2]});return this.layoutCanvas;},cleanup:function(){MktPage.eventMgr.removeListener('canvasresizedone',this.canvasResized,this);MktPage.eventMgr.removeListener('panelactivate',this.panelActivated,this);},updateSaveAt:function(time){var tab=MktCanvas.getTab('fmLeadDisplayLayout');if(tab){var gutter=tab.getGutter();if(gutter){var saveStatus=gutter.items.get('saveStatus');saveStatus.setText('Auto-Save: '+time);saveStatus.getEl().highlight('#c3daf9',{block:true});}}},createFilterFieldTreePanel:function(config){this.fieldTreePanel=new Mkt.widget.FieldTreePanel({dataUrl:this.fieldTreeUrl,enableCache:this.enableTreeCache,frame:false,autoScroll:true});this.palette=new Mkt.widgets.FilterTreePanel({layout:'fit',width:config.paletteWidth,filterFieldPadding:0,frame:false,autoScroll:false,items:new Ext.Panel({cls:'mktSmartPaletteTree',frame:true,layout:'fit',autoScroll:false,items:[this.fieldTreePanel]})});this.palette.bindTree(this.fieldTreePanel);return this.palette;}});Mkt.widget.FieldTreePanel=Ext.extend(Mkt.widgets.SmartPaletteTreePanel,{ddGroup:'layoutDesigner',width:260,height:200,cls:'mktTree mktSmartPalette mktFieldsPalette',border:true,bodyBorder:true,frame:false,layout:'fit',autoScroll:true,animate:true,invalidateAllCache:function(){Mkt.widget.FieldTreePanel.superclass.invalidateAllCache();MktSession.ajaxRequest('/fieldManagement/invalidateAllCache');}});Mkt.widget.LayoutDropZone=function(panel,cfg){this.panel=panel;Ext.dd.ScrollManager.register(panel.body);Mkt.widget.LayoutDropZone.superclass.constructor.call(this,panel.bwrap.dom,cfg);panel.body.ddScrollConfig=this.ddScrollConfig;};Ext.extend(Mkt.widget.LayoutDropZone,Ext.dd.DropTarget,{ddGroup:'layoutDesigner',layout:'fit',dropAllowed:true,ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},notifyOver:function(dd,e,data){return this.dropAllowed;},notifyDrop:function(dd,e,data){if(this.panel&&this.panel.mgr&&this.panel.mgr.itemSelected){this.panel.mgr.itemSelected(data.node);}
return true;}});Mkt.widget.LayoutFormPanel=Ext.extend(Ext.form.FormPanel,{initEvents:function(){Mkt.widget.LayoutFormPanel.superclass.initEvents.call(this);this.dd=new Mkt.widget.LayoutDropZone(this,Ext.apply(this.dropConfig));},destroy:function(){Ext.dd.ScrollManager.unregister(this.body);Ext.dd.ScrollManager.unregister(this.bwrap);Mkt.widget.LayoutFormPanel.superclass.destroy.call(this);}});
/* ========== ../mkt-ext-2.0/widgets/ReportSettings.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.ReportSettings={TIMEFRAME_BTN_KEY:'timeframeSummaryBtn',TIMEFRAME2_BTN_KEY:'timeframe2SummaryBtn',data:{},settings:{},show:function(settings,canvas,animEl){this.settings=settings;this._constructWindow();this._win.show(animEl);this._updateFormFields();},hide:function(){if(this._win){this._win.hide();}},reloadReport:function(){if(this.settings.reactivateActiveTab&&!this.settings.uiSetupDialog){MktCanvas.reactivateActiveTab(true);}
else if(this.settings.reloadActiveGrid){if(MktCanvas){var tab=MktCanvas.getActiveTab();if(tab&&tab.hasGridPanel()){var grid=tab.getGridPanel();grid.store.load();}}}},exportReport:function(settings){var reportId=settings.data.reportId;var exportAction=settings.exportAction;Ext.MessageBox.show({title:'Export',icon:'ext-mb-download',msg:'Export',buttons:Ext.MessageBox.OKCANCEL,fn:function(btn,text){if(btn=='ok'){MktMessage.showExport();location=exportAction+'?';}}});},timeframeField:'timeframe',startDateField:'datefrom',endDateField:'dateto',groupByField:'group',groupUnitsField:'groupUnits',autoRenameField:'autoRename',pageSize:'pageSize',queryLimit:'queryLimit',advancedMode:'advancedMode',_win:null,iconCls:'mkiGear',_constructWindow:function(){var ReportSettings=Mkt.widgets.ReportSettings;var title=this.settings.reportSettingsTitle||'Report Settings';this._win=new Ext.Window({title:title,iconCls:'mkiGear',frame:true,modal:true,iconCls:this.settings.uiIconCls||this.iconCls,layout:'fit',bodyStyle:'padding: 30px 10px 50px 10px; z-index:20000;',width:this.settings.uiWindowWidth||525,height:this._getHeight(),resizable:true,closeAction:'hide',items:this._constructForm(),buttons:[{text:'OK',iconCls:'mkiOk',handler:function(){ReportSettings._save();}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){ReportSettings.hide();}}]});},_getHeight:function(){if(!Ext.isIE7){return'auto';}
var height=100;if(!this.settings.disable_timeframe){height+=86;}
if(this.settings.advancedModeHeader){height+=71;}
if(this.settings.data.group){height+=101;}
return height;},_constructForm:function(){var ReportSettings=Mkt.widgets.ReportSettings;var formItems=[];if(!this.settings.disable_timeframe&&!this.settings.uiHideTimeframe){formItems.push({xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,layout:'column',items:[{columnWidth:0.65,layout:'form',baseCls:'x-plain',labelWidth:120,labelAlign:'left',defaults:{anchor:'100%'},items:this._constructTimeframeCombo()},{columnWidth:0.35,layout:'form',baseCls:'x-plain',labelWidth:60,labelAlign:'right',defaults:{anchor:'100%',xtype:'datefield'},items:this._constructDateFields()}]});}
var st=this.settings;st.originalData=Ext.apply({},st.data);if(st.data.group&&!st.uiHideGroup){var groupFields=this._constructGroupFields();formItems.push({xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,items:[{layout:'column',baseCls:'x-plain',items:[{columnWidth:0.65,layout:'form',baseCls:'x-plain',labelWidth:90,labelAlign:'left',defaults:{anchor:'100%'},items:groupFields[0]},{columnWidth:0.35,layout:'form',baseCls:'x-plain',labelWidth:60,labelAlign:'right',defaults:{anchor:'100%'},items:groupFields[2]}]},{layout:'column',baseCls:'x-plain',items:[{columnWidth:1.0,layout:'form',baseCls:'x-plain',labelWidth:90,defaults:{anchor:'100%'},items:groupFields[1]}]}]});}
var reportSizeItems=[{fieldLabel:'Export rows available',name:this.queryLimit,hiddenname:this.queryLimit,value:this.settings.data.queryLimit,xtype:'combo',mode:'local',triggerAction:'all',forceSelection:true,editable:false,displayField:'label',valueField:'value',width:110,store:new Ext.data.JsonStore({fields:['label','value'],data:[{label:'1,000',value:'1000'},{label:'2,500',value:'2500'},{label:'5,000 (default)',value:'5000'},{label:'7,500',value:'7500'},{label:'10,000',value:'10000'},{label:'12,500',value:'12500'},{label:'15,000',value:'15000'},{label:'17,500',value:'17500'},{label:'20,000',value:'20000'},{label:'22,500',value:'22500'},{label:'25,000',value:'25000'},{label:'27,500',value:'27500'},{label:'30,000',value:'30000'}]})}];if(MktPage.xfeatures){reportSizeItems.push({xtype:'numberfield',name:this.pageSize,width:50,fieldLabel:'Rows per page',minValue:50,maxValue:1000,value:this.settings.data.pageSize});}
if(this.settings.subtype!="analyzer"&&!st.uiHideExportSize){formItems.push({xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,layout:'column',items:[{columnWidth:1.0,layout:'form',baseCls:'x-plain',labelWidth:120,items:reportSizeItems},{columnWidth:1.0,baseCls:'x-plain',items:{xtype:'panel',baseCls:'x-plain',html:'<div class="x-form-item" style="margin-top: 3px;"><b>Note:</b>  Smaller is faster</div>'}}]});}
if(this.settings.advancedModeHeader&&!st.uiHideAdvanced){var advancedOptions=[];advancedOptions.push({columnWidth:1.0,layout:'form',baseCls:'x-plain',labelWidth:140,items:{xtype:'combo',name:this.advancedMode,fieldLabel:this.settings.advancedModeLabel,value:this.settings.data.advancedMode||false,triggerAction:'all',lazyRender:true,editable:false,width:110,mode:'local',store:new Ext.data.JsonStore({id:0,fields:['value','text'],data:[{value:true,text:st.advancedModeValueChoices[0]},{value:false,text:st.advancedModeValueChoices[1]}]}),valueField:'value',displayField:'text'}});formItems.push({xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,layout:'column',items:advancedOptions});}
if(formItems.length===0){console.debug('No report settings!');formItems.push({xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,items:{html:'There are no report settings'}});}
this.formPanel=new Ext.FormPanel({baseCls:'x-plain',labelWidth:70,defaultType:'textfield',items:formItems});return this.formPanel;},_constructTimeframeCombo:function(){var ReportSettings=Mkt.widgets.ReportSettings;this.TimeframeRecord=Ext.data.Record.create([{name:'id'},{name:'label'},{name:'datefrom',type:'date'},{name:'dateto',type:'date'}]);this.timeframeStore=new Ext.data.Store({reader:new Ext.data.JsonReader({root:'root',id:'id'},this.TimeframeRecord),data:{'root':this.settings.timeframeOptions}});var combo=new Ext.form.ImprovedComboBox({fieldLabel:this.settings.timeframeFieldLabel||'Time Frame',name:this.timeframeField,store:this.timeframeStore,mode:'local',valueField:'id',displayField:'label',typeAhead:true,triggerAction:'all',emptyText:'Select...',valueNotFoundText:'not found',selectTimeframe:function(combo,selection){combo.changeTimeframe(combo,combo.startValue,combo.getRawValue(),selection);},changeTimeframe:function(combo,oldValue,newValue,selection){ReportSettings.updateDateRange(selection.data);if(selection.id=='custom'){ReportSettings.dateFields['datefrom'].focus();}}});combo.on('select',combo.selectTimeframe,combo);this.timeframeCombo=combo;return combo;},_constructDateFields:function(){this.dateFields={'datefrom':new Ext.form.DateField({fieldLabel:'From',name:this.startDateField,vtype:'daterange',allowBlank:true,emptyText:'First available'}),'dateto':new Ext.form.DateField({fieldLabel:'To',name:this.endDateField,vtype:'daterange',allowBlank:true,emptyText:'Present'})};this.dateFields.datefrom.endDateField=this.dateFields.dateto;this.dateFields.dateto.startDateField=this.dateFields.datefrom;this.dateFields.datefrom.on('change',this._dateFieldEdited,this);this.dateFields.dateto.on('change',this._dateFieldEdited,this);return[this.dateFields.datefrom,this.dateFields.dateto];},_dateFieldEdited:function(field,oldvalue,newvalue){var datefrom=this.dateFields.datefrom.getRawValue();var dateto=this.dateFields.dateto.getRawValue();var timeframe='custom';if(datefrom===''&&dateto===''){timeframe='ever';}
else{var opts=this.settings.timeframeOptions;for(var i=0;i<opts.length;i++){if(opts[i].datefrom==datefrom&&opts[i].dateto==dateto){timeframe=opts[i].id;break;}}}
this.timeframeCombo.setValue(timeframe);var store=this.timeframeCombo.getStore();this.timeframeCombo.selectTimeframe(this.timeframeCombo,store.getById(timeframe));},updateDateRange:function(tfData){if(tfData!=undefined){this.settings.currentTimeframeData=tfData;}
else{tfData=this.settings.currentTimeframeData;}
this.settings.data.timeframeLabel=tfData.label;if(tfData.id!='custom'&&this.dateFields){var datefrom=this.dateFields.datefrom;var dateto=this.dateFields.dateto;datefrom.setValue(tfData.datefrom);dateto.setValue(tfData.dateto);datefrom.clearInvalid();dateto.clearInvalid();}},_constructGroupFields:function(){var ReportSettings=Mkt.widgets.ReportSettings;var fields=[];var groupStore=new Ext.data.JsonStore({url:this.settings.phpModule+'/autosuggest',root:'suggest',fields:['report_group_name'],id:'aid',baseParams:{aid:37,atid:13,dataIndex:'report_group_name',displayField:'report_group_name',accessZoneId:MktCanvas.getActiveTab().config.accessZoneId}});var groupCombo=new Ext.form.ImprovedComboBox({fieldLabel:this.settings.reportNamePrefix,name:this.groupByField,store:groupStore,mode:'remote',valueField:'report_group_name',displayField:'report_group_name',typeAhead:false,forceSelection:true,triggerAction:'all',emptyText:'Select...',selectGroup:function(field,selection){if(selection.json.disabled){field.setValue(field.startValue);return false;}
var json=selection.json;var settings=ReportSettings.settings.data;settings.group=json.report_group_name;settings.groupAttrType=json.group;settings.groupAttrId=json.aid;settings.groupDatatype=json.dt;ReportSettings.updateUnitOptions(settings.groupDatatype);return true;}});groupCombo.on('select',groupCombo.selectGroup,groupCombo);fields.push(groupCombo);this.autoRenameCheckbox=new Ext.form.Checkbox({xtype:'checkbox',name:this.autoRenameField,labelSeparator:'',boxLabel:'Update report name',checked:false,height:26});fields.push(this.autoRenameCheckbox);this.unitsCombo=new Ext.form.ImprovedComboBox({fieldLabel:'Units',name:this.groupUnitsField,store:this.unitData['--'],mode:'local',displayField:'label',typeAhead:true,forceSelection:true,triggerAction:'all',emptyText:'N/A'});fields.push(this.unitsCombo);return fields;},unitData:{'--':['--'],'date':['Days','Weeks','Months','Quarters','Years'],'datetime':['Days','Weeks','Months','Quarters','Years'],'integer':['--','Tens','Hundreds','Thousands','Millions'],'float':['--','Tens','Hundreds','Thousands','Millions'],'currency':['--','Tens','Hundreds','Thousands','Millions']},updateUnitOptions:function(datatype){if(this.unitsCombo&&datatype){var choices=this.unitData[datatype];var unitsValue;if(choices!=undefined){unitsValue=choices[0];var currentChoice=this.unitsCombo.getValue();if(choices.indexOf(currentChoice)!=-1){unitsValue=currentChoice;}
this.unitsCombo.store.loadData(choices,false);}
else{this.unitsCombo.store.removeAll();unitsValue=null;}
this.unitsCombo.setDisabled(unitsValue===null?true:false);this.unitsCombo.setValue(unitsValue);this.settings.data.groupUnits=unitsValue;}},_updateFormFields:function(){this._initTimeframeData();var formFields=this.formPanel.form.items.items;for(var i=0;i<formFields.length;i++){var field=formFields[i];if(this.settings.data[field.name]!=undefined){var value=this.settings.data[field.name];field.setValue(value);field.clearInvalid();}}
if(!this.settings.disable_timeframe){this.updateDateRange();}
this.updateUnitOptions(this.settings.data.groupDatatype);},_initTimeframeData:function(){var tf=this.settings.data.timeframe;var opts=this.settings.timeframeOptions;var tfData=null;for(var i=0;i<opts.length;i++){if(opts[i].id==tf){tfData=opts[i];break;}}
this.settings.currentTimeframeData=tfData;this.settings.data.timeframeLabel=tfData.label;if(tf!='custom'){this.settings.data.datefrom=tfData.datefrom;this.settings.data.dateto=tfData.dateto;}},_saveFormFields:function(){var formFields=this.formPanel.form.items.items;for(var i=0;i<formFields.length;i++){var field=formFields[i];var value=field.getValue();if(field.xtype=='datefield'&&Ext.isDate(value)){value=value.dateFormat(this.settings.dateFormat);}
this.settings.data[field.name]=value;}},_save:function(){var formFields=this.formPanel.form.items.items;var st=this.settings;console.debug("Saving Report Settings=",st);if(this.beforeSaveCb&&isFunction(this.beforeSaveCb)){this.beforeSaveCb();}
this._saveFormFields();console.debug("Saving Report Settings after saveFormFields=",st);MktSession.clockCursor(true);this.renameOnSave=this.autoRenameCheckbox&&this.autoRenameCheckbox.checked;if(this.renameOnSave){var atxReportName=st.reportNamePrefix+' '+st.data.group;if(st.data.groupUnits&&st.data.groupDatatype.indexOf('date')===0){atxReportName=st.reportNamePrefix+' '+st.data.groupUnits.substring(0,st.data.groupUnits.length-1);}
console.debug("Attempting to rename report to ",atxReportName);MktSession.ajaxRequest(st.renameReportAction,{serializeParms:{atxRenameReportId:st.data.reportId,atxReportName:atxReportName,nodeId:st.data.nodeId},onMySuccess:function(){if(MktPage.appVars.renameReportFailed){MktAnalyticsMenu.renameReport(reportId,text,nodeId,currNode,animEl);}}});}
if(st.clearContentValidPanels){for(var i=0;i<st.clearContentValidPanels.length;i++){MktPage.clearPanelContentValid(st.clearContentValidPanels[i]);}}
MktSession.ajaxRequest(st.saveAction,{serializeParms:st.data,onMySuccess:this._saveSuccess.createDelegate(this),onMyFailure:this._saveFailure.createDelegate(this)});},_saveSuccess:function(conn,response,options){if(MktPage.appVars.timeframeSummary){this.settings=MktPage.appVars.reportSettings;if(MktPage.appVars.timeframeSummary){var btn=MktCanvas.getRegisteredItem(Mkt.widgets.ReportSettings.TIMEFRAME_BTN_KEY);if(btn){btn.setText(MktPage.appVars.timeframeSummary);}
var btn2=MktCanvas.getRegisteredItem(Mkt.widgets.ReportSettings.TIMEFRAME2_BTN_KEY);if(btn2){btn2.setText(MktPage.appVars.timeframeSummary);}}}
MktSession.unclockCursor();this.hide();this.reloadReport();if(this.saveSuccessCb&&isFunction(this.saveSuccessCb)){this.saveSuccessCb();}},_saveFailure:function(conn,response,options){MktSession.unclockCursor();}};
/* ========== ../mkt-ext-2.0/widgets/ActivityFilters.js ============ */

Ext.namespace('Mkt','Mkt.widgets');Mkt.widgets.ActivityFilters=function(grid,persistFilterUrl){this.grid=grid;if(this.grid){this.grid.activityFilters=this;}
this.persistFilterUrl=persistFilterUrl;this.cookiePersist=persistFilterUrl?false:true;this.allFilterset=MktPage.appVars.allFilterset;this.groupedActTypeFilters=MktPage.appVars.groupedActTypeFilters;this.activeFilterset=MktPage.appVars.activeFilterset;this.notifyGrid();};Mkt.widgets.ActivityFilters=Ext.extend(Mkt.widgets.ActivityFilters,{filtersetUiNamePrefix:"Filter: ",customFiltersetCookieKey:"CUSTOM_FILTER_SET",activeFiltersetCookieKey:"ACTIVE_FILTER_SET",customFiltersetName:"Custom",allFiltersetName:"None",groupName:"filterset",buildToolbar:function(){if(this.cookiePersist){this.cookieProvider=new Ext.state.CookieProvider();var filters=this.cookieProvider.get(this.customFiltersetCookieKey);if(filters){this.allFilterset[this.customFiltersetName]["filters"]=Ext.decode(filters);}
if(!this.hasForceFilter()){var activeFilterset=this.cookieProvider.get(this.activeFiltersetCookieKey);if(activeFilterset){this.activeFilterset=activeFilterset;}else{this.activeFilterset=this.allFiltersetName;}}}
console.log("activeFilterset: "+this.activeFilterset);if(this.activeFilterset!=this.allFiltersetName){this.grid.store.baseParams.filter=Ext.encode(this.getActiveFilters());}
var tbar=[];var activityFilterText=this.filtersetUiNamePrefix+this.activeFilterset;this.activityTb=new Ext.Button({text:activityFilterText,iconCls:'mkiFunnel',menu:this.buildFiltersetMenu()});tbar.push(this.activityTb);return tbar;},hasForceFilter:function(){if(/report=/.test(window.location.search)){return true;}
else{return false;}},buildFiltersetMenu:function(){var filtersetMenu=new MktMenu({cls:"MktMenu mktMenuStrictHeight"});this.noneMenuItem=new Ext.menu.CheckItem({text:this.allFiltersetName,checked:this.activeFilterset==this.allFiltersetName,checkHandler:this.changedFilterset.createDelegate(this),group:this.groupName});filtersetMenu.add(this.noneMenuItem);this.customMenuItem=new Ext.menu.CheckItem({text:this.customFiltersetName,checked:this.activeFilterset==this.customFiltersetName,handler:function(menuItem){this.ignoreCheckChange=true;this.showFilterEditor(menuItem.el);menuItem.parentMenu.hide(true);}.createDelegate(this),listeners:{beforecheckchange:function(){if(this.ignoreCheckChange){delete this.ignoreCheckChange;return false;}else{return true;}}.createDelegate(this)},group:this.groupName});filtersetMenu.add(this.customMenuItem);filtersetMenu.add(new Ext.menu.Separator());for(var name in this.allFilterset){if(name==this.customFiltersetName||name==this.allFiltersetName){continue;}
filtersetMenu.add(new Ext.menu.CheckItem({text:name,checked:this.activeFilterset==name,checkHandler:this.changedFilterset.createDelegate(this),group:this.groupName}));}
this.filtersetMenu=filtersetMenu;return filtersetMenu;},showFilterEditor:function(el){if(!this.activityFilerPicker){this.activityFilterPicker=new Mkt.widgets.ActivityFilterPicker({activityFilters:this,groupedActTypeFilters:this.groupedActTypeFilters,allFilterset:this.allFilterset,allFiltersetName:this.allFiltersetName,activeFilterset:this.activeFilterset,selectedFilterset:this.customFiltersetName,customFiltersetName:this.customFiltersetName,persistFilterUrl:this.persistFilterUrl,cookiePersist:this.cookiePersist,cookieProvider:this.cookieProvider,activeFiltersetCookieKey:this.activeFiltersetCookieKey,customFiltersetCookieKey:this.customFiltersetCookieKey});}
this.activityFilterPicker.show(el);},changedFilterset:function(menuItem,value){if(value){if(this.allFilterset&&this.allFilterset[menuItem.text]&&this.allFilterset[menuItem.text]['type']!='temp'){if(this.cookiePersist){this.cookieProvider.set(this.activeFiltersetCookieKey,menuItem.text);}else{MktSession.ajaxRequest(this.persistFilterUrl,{serializeParms:{filtersetName:menuItem.text,setActive:true}});}}
this.changeActiveFilterset(menuItem.text);}},changeActiveFilterset:function(value){this.activeFilterset=value;this.activityTb.setText(this.filtersetUiNamePrefix+value);var selItem=this.activityTb.menu.items.findIndex("text",value,undefined,undefined,true);if(selItem!=-1){this.activityTb.menu.items.items[selItem].setChecked(true);}
var store=this.grid.store;if(this.activeFilterset==this.allFiltersetName){delete store.baseParams.filter;delete store.lastOptions.params.filter;}else{store.baseParams.filter=this.getActiveFiltersAsJson();}
this.grid.requestTotalCountAsync=true;store.reload();this.notifyGrid();},getActiveFilters:function(){if(!this.activeFilterset||!this.allFilterset[this.activeFilterset]){return;}else if(this.activeFilterset==this.allFiltersetName){return;}
var filters=this.allFilterset[this.activeFilterset].filters;if(isUndefined(filters)){return;}
var filterIds=[];for(var i=0;i<filters.length;i++){filterIds.push(filters[i]);}
return filterIds;},getActiveFiltersAsJson:function(){var activeFilters=this.getActiveFilters();return isUndefined(activeFilters)?undefined:Ext.encode(activeFilters);},getExportQueryString:function(){var filters;if(this.activeFilterset==this.allFiltersetName){return;}else{filters=this.getActiveFiltersAsJson();}
if(filters){return"filter="+filters;}},notifyGrid:function(){var activeActivityTypes=this.getActiveFilters();this.grid.activeFilters=(!activeActivityTypes||this.allFilterset[this.allFiltersetName].filters.length==activeActivityTypes.length)?0:activeActivityTypes.length;}});Mkt.widgets.ActivityFilterPicker=Ext.extend(Ext.Window,{title:"Activity Filter Settings",layout:'border',cls:"activityFilterPicker",iconCls:'mkiFilter',height:450,width:573,plain:false,border:false,modal:true,filtersetTypeUser:"user",filtersetTypeSystem:"system",backgroundStyle:"background-color: #E8E8E8",checkboxIdPrefix:'filterCheckbox',buttonAlign:'right',initComponent:function(){this.filterCheckboxes={};this.items=this.items||[];this.items=this.items.concat(this._buildLayout());this.buttons=this.buttons||[];if(!this.cookiePersist){this.buttons.push({text:'Save As',iconCls:'mkiFloppyDiskBlue',handler:this.saveAsFilter.createDelegate(this)});}
this.buttons.push({text:'Apply',iconCls:'mkiOk',handler:this.applyFilterset.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.widgets.ActivityFilterPicker.superclass.initComponent.call(this);},_buildToolbar:function(){var fields=['name','readonly','type','filters'];var data=[];for(var name in this.allFilterset){data.push(this.allFilterset[name]);}
var store=new Ext.data.JsonStore({fields:fields,data:data});this.filtersetCombo=new Ext.form.ImprovedComboBox({store:store,editable:false,fieldLabel:"Saved Filters",value:this.selectedFilterset,displayField:'name',typeAhead:false,mode:'local',triggerAction:'all',allowBlank:true,selectOnFocus:false});this.filtersetCombo.on('select',this.filtersetSelectionChange.createDelegate(this));this.selectPanel=new Ext.Panel({style:"margin-top: 15px;",cls:"x-form-item",html:'<a id="selectAllFilter" href="" onclick="return false;">Check All</a> | <a id="selectNoneFilter" href="" onclick="return false;">Check None</a>'});this.selectPanel.on('render',function(){window.setTimeout(function(){var selAll=Ext.get("selectAllFilter");if(selAll){selAll.on('click',function(){this.setAllCheckboxValue(true);this.onFilterClick();}.createDelegate(this));}
var selNone=Ext.get("selectNoneFilter");if(selNone){selNone.on('click',function(){this.setAllCheckboxValue(false);this.onFilterClick();}.createDelegate(this));}}.createDelegate(this),1000);}.createDelegate(this));var comboWidth=Ext.isGecko3&&Ext.isMac?280:260;var topItems=[{width:comboWidth,layout:"form",labelWidth:80,bodyStyle:this.backgroundStyle,cls:"filtersetPickerCol",items:[this.filtersetCombo,this.selectPanel]}];if(!this.cookiePersist){this.deleteEl=new Ext.Panel({width:20,html:'<img id="deleteFilterEl" src="/images/icons16/cancel.png" style="width:16px; height:16px; margin-top: 5px; cursor: pointer;" alt="Delete"/>',listeners:{render:function(panel){panel.el.on('click',function(){var val=this.filtersetCombo.getValue();if(this.isSystemFilterset(val)){MktMessage.showWarning("<b>"+val+"</b> filter cannot be removed",undefined,panel.el);}else{MktMessage.confirm("Marketo","Are you sure you want to remove <b>"+val+"</b> filter?","Remove",function(){MktSession.ajaxRequest(this.persistFilterUrl,{serializeParms:{filtersetName:val,setActive:false,filterAction:'delete'},onMySuccess:this.deleteFiltersetDone.createDelegate(this)});}.createDelegate(this),undefined,panel.el);}}.createDelegate(this));new Ext.ToolTip({target:panel.el.id,html:'Remove this filter'});}.createDelegate(this)}});topItems.push(this.deleteEl);}
items=[{layout:'column',bodyStyle:this.backgroundStyle,items:topItems}];return items;},_buildFilterContents:function(){var items=[];var col=[[],[]];var gaFilters=this.groupedActTypeFilters;var activityFilterPicker=this;var colIndex=0;for(var key in gaFilters){if(gaFilters[key].length>0){var filters=[];for(var i=0;i<gaFilters[key].length;i++){var filter=new Mkt.widgets.Checkbox({boxLabel:gaFilters[key][i].text,name:this.checkboxIdPrefix+gaFilters[key][i].id,filterId:gaFilters[key][i].id,listeners:{click:this.onFilterClick.createDelegate(this)},handler:this.filterValueChange.createDelegate(this),height:23});this.filterCheckboxes[this.checkboxIdPrefix+gaFilters[key][i].id]=filter;filters.push(filter);}
var fieldsetWidth=Ext.isIE7?245:250;var fieldset={title:key,xtype:'fieldset',width:fieldsetWidth,hideLabels:true,autoHeight:true,cls:'mktFieldsetCheckboxes',style:'margin-top: 10px;',defaultType:'checkbox',hideBorders:true,items:filters};col[colIndex%2].push(fieldset);colIndex++;}}
this.checkFilterCheckboxes(this.allFilterset[this.selectedFilterset]["filters"]);var colWidth=Ext.isIE7?.48:.50;return{xtype:'panel',layout:'column',cls:"mktPanelPlain mktLayoutCol",autoScroll:true,bodyStyle:this.backgroundStyle,items:[{columnWidth:colWidth,cls:"mktPanelPlain",items:col[0]},{columnWidth:colWidth,cls:"mktPanelPlain",items:col[1]}]};},_buildLayout:function(){var items=[];items.push({region:'north',height:65,cls:'mktPanelPlain',margins:'17 5 0 10',layout:'fit',items:this._buildToolbar()});items.push({region:'center',margins:'0 5 10 10',height:300,cls:'mktPanelPlain center',layout:'fit',items:this._buildFilterContents()});return items;},saveAsFilter:function(btn){var saveAs=new Mkt.widgets.MessagePrompt({title:"Save As",iconCls:'mkiFloppyDiskBlue',okText:"Save",height:143,handler:this.saveCustomFilterset.createDelegate(this),beforeOkHandler:this.validateCustomFilterset.createDelegate(this),message:"Please enter your custom filter name"});saveAs.show();},validateCustomFilterset:function(button,value,checked){if(value.length<=0){return"This field is required";}else if(this.isSystemFilterset(value)){return"Choose another name";}
return false;},saveCustomFilterset:function(button,value,checked){if(button=="Ok"){this.saveFilterset.call(this,value,undefined,false);this.applyFilterset.call(this,button);}},applyFilterset:function(button){var filtersetName=this.filtersetCombo.getValue();if(this.activityFilters.customMenuItem.checked){delete this.activityFilters.ignoreCheckChange;}
var el;if(button&&button.el){el=button.el;}
this.saveFilterset(filtersetName,el,true);this.activityFilters.changeActiveFilterset(filtersetName);this.close();},saveFilterset:function(name,el,setActive){var serializeParms={filtersetName:name};var filters=this.getCheckedFilters();var filterIds=this.getCheckedFilterIds(filters);if(isUndefined(this.allFilterset[name])){this.allFilterset[name]={name:name,type:"user",readonly:false,filters:[]};var newFilterObj={name:name,readonly:false,type:'user',filters:filterIds};var rec=new Ext.data.Record(newFilterObj);this.filtersetCombo.store.add(rec);var activityFilters=this.activityFilters;activityFilters.filtersetMenu.add(new Ext.menu.CheckItem({text:newFilterObj.name,checked:setActive,checkHandler:activityFilters.changedFilterset.createDelegate(activityFilters),group:activityFilters.groupName}));}else{var store=this.filtersetCombo.store;if(store){var index=store.find("name",name);if(index!=-1){rec=store.getAt(index);rec.data.filters=filterIds;}}}
this.filtersetCombo.setValue(name);this.allFilterset[name]["filters"]=filterIds;var filterIdsAsJson=Ext.encode(filterIds);if(this.cookiePersist){this.cookieProvider.set(this.customFiltersetCookieKey,filterIdsAsJson);}else{serializeParms.filters=filterIdsAsJson;}
if(setActive){if(this.cookiePersist){this.cookieProvider.set(this.activeFiltersetCookieKey,name);}else{serializeParms.setActive=true;}}
if(!this.cookiePersist){MktSession.ajaxRequest(this.persistFilterUrl,{serializeParms:serializeParms});}},deleteFiltersetDone:function(){var val=this.filtersetCombo.getValue();if(val){var store=this.filtersetCombo.store;var index=store.find("name",val,undefined,undefined,true);if(index!=-1){var rec=store.getAt(index);store.remove(rec);}}
this.filtersetCombo.setValue(this.customFiltersetName);var items=this.activityFilters.filtersetMenu.items;var index=items.findIndex("text",val,undefined,undefined,true);if(index!=-1){this.activityFilters.filtersetMenu.remove(items.itemAt(index));}
if(this.allFilterset[val]){delete this.allFilterset[val];}},isSystemFilterset:function(name){name=name.trim();name=name.charAt(0).toUpperCase()+name.substring(1);if(this.allFilterset[name]&&this.allFilterset[name].type=="system"){return true;}else{return false;}},isReadonlyFilterset:function(name){return this.allFilterset[name]?this.allFilterset[name]["readonly"]:false;},getCheckedFilters:function(){var checkedFilters=[];for(checkbox in this.filterCheckboxes){if(checkbox=="selectAll"){continue;}
if(this.filterCheckboxes[checkbox].getValue()){checkedFilters.push({id:this.filterCheckboxes[checkbox].filterId,text:this.filterCheckboxes[checkbox].boxLabel});}}
return checkedFilters;},getCheckedFilterIds:function(filters){var checkedFilters=filters||this.getCheckedFilters();var filterIds=[];for(var i=0;i<checkedFilters.length;i++){filterIds.push(checkedFilters[i].id);}
return filterIds;},filtersetSelectionChange:function(combo,rec,index){var filters=rec.data.filters;this.checkFilterCheckboxes(filters);},checkFilterCheckboxes:function(filters){if(filters){this.setAllCheckboxValue(false);for(var i=0;i<filters.length;i++){var filter=this.filterCheckboxes[this.checkboxIdPrefix+filters[i]];if(filter){filter.setValue(true);}}}else{this.setAllCheckboxValue(false);}},filterValueChange:function(combo,value){},onFilterClick:function(){this.filtersetCombo.setValue("Custom");},setAllCheckboxValue:function(value){for(checkbox in this.filterCheckboxes){this.filterCheckboxes[checkbox].setValue(value);}}});Mkt.widgets.MessagePrompt=Ext.extend(Ext.Window,{title:"Marketo",layout:'form',plain:false,border:false,modal:true,resizable:false,cls:'mktMessagePrompt',checkEnable:false,checkLabel:'Replace existing',okButtonValue:"Ok",width:260,height:160,beforeOkHandler:Ext.emptyFn,handler:Ext.emptyFn,okClickHandler:function(){var value=this.textField.getValue();var button=this.okButtonValue;var checked;if(this.checkEnable){checked=this.checkbox.getValue();}
var beforeOkResult=this.beforeOkHandler(button,value,checked);if(beforeOkResult){this.textField.markInvalid(beforeOkResult);}else{this.close();this.handler(button,value,checked);}},cancelClickHandler:function(){this.handler("Cancel");this.close();},initComponent:function(){this.items=this.items||[];this.textField=new Ext.form.TextField({msgTarget:'side',hideLabel:true,listeners:{render:function(){this.focus(true,800);}},width:this.textFieldWidth||205});this.items.push({html:this.message,cls:"mktPanelPlain x-form-item",height:this.msgHeight||22});this.items.push(this.textField);if(this.checkEnable){this.items.push({xtype:'checkbox',hideLabel:true,boxLabel:this.checkLabel});}
this.buttons=this.buttons||[];this.buttons.push({text:this.okText||"OK",iconCls:this.okCls||"mkiOk",handler:this.okClickHandler.createDelegate(this)});this.buttons.push({text:this.cancelText||"Cancel",iconCls:this.cancelCls||"mkiCancel",handler:this.cancelClickHandler.createDelegate(this)});Mkt.widgets.MessagePrompt.superclass.initComponent.call(this);this.on('render',function(){this.checkbox=this.items.items[2];}.createDelegate(this));}});
/* ========== ../mkt-ext-2.0/widgets/Field.js ============ */

Ext.ns("Mkt","Mkt.widgets");Mkt.widgets.Field={DataTypes:{Boolean:'boolean',Currency:'currency',Date:'date',DateTime:'datetime',Email:'email',Float:'float',Integer:'integer',Phone:'phone',String:'string',Text:'text',Url:'url'},getField:function(field,width,updateCallback,lazyRender){var updateCallback=updateCallback||Ext.emptyFn;var xtype='textfield';var vtype=null;var maxLength=field.size!=null?field.sizes:Number.MAX_VALUE;var allowDecimals=false;var allowBlank=true;var store=null;var mode='remote';var displayField='val';var valueField=null;var triggerAction='query';var forceSelection=false;var decimalPrecision=2;var format=null;var altFormats=null;var timeConfig=undefined;var listeners={'change':updateCallback};var fieldVal=Ext.util.Format.htmlDecode(field.value);if(!field.isReadOnly){switch(field.type){case this.DataTypes.Boolean:xtype='checkbox';listeners.check=updateCallback;width=undefined;break;case this.DataTypes.Currency:xtype='numberfield';allowDecimals=true;decimalPrecision=4;width=width||200;break;case this.DataTypes.Date:xtype='datefield';format='Y-m-d';altFormats='M d, Y';width=width||200;break;case this.DataTypes.DateTime:xtype='xdatetime';width=width||200;if(fieldVal&&fieldVal.length>0){fieldVal=new Date(fieldVal);}
timeConfig={increment:30,displayField:'field1'};break;case this.DataTypes.Email:vtype='email';width=width||360;break;case this.DataTypes.Float:xtype='numberfield';allowDecimals=true;width=width||200;break;case this.DataTypes.Integer:xtype='numberfield';width=width||200;break;case this.DataTypes.Phone:width=width||200;break;case this.DataTypes.String:width=width||360;switch(field.uiRender){case'comboBox':xtype='combo';var suggConfig={name:field.dataIndex,aid:field.aid,atid:null,dataIndex:displayField,displayField:displayField,mode:'remote',dependent_op:null,dependent_val:null,disabled:false};store=new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/leadDatabase/autosuggest',root:'suggest',fields:[suggConfig.displayField],id:suggConfig.displayField,baseParams:suggConfig});break;case'textArea':xtype='textarea';break;}
break;case this.DataTypes.Text:xtype='textarea';width=width||360;break;case this.DataTypes.Url:width=width||360;break;default:width=width||360;break;}
var fieldSettings={fieldLabel:field.header,name:field.dataIndex,value:fieldVal,checked:fieldVal,listWidth:width,leadId:field.leadId,xtype:xtype,vtype:vtype,maxLength:maxLength,readOnly:field.isReadOnly,allowBlank:!field.isRequired,forceSelection:forceSelection,allowDecimals:allowDecimals,decimalPrecision:decimalPrecision,format:format,altFormats:altFormats,store:store,mode:mode,displayField:displayField,valueField:valueField,typeAhead:true,triggerAction:triggerAction,minChars:0,listeners:listeners};if(isDefined(width)){fieldSettings.width=width;}
if(isDefined(timeConfig)){fieldSettings.timeConfig=timeConfig;}
if(lazyRender){return fieldSettings;}else{return Ext.ComponentMgr.create(fieldSettings);}}
else{return new Ext.form.Field({fieldLabel:field.header,name:field.dataIndex,value:this.formatValue(fieldVal,field.type),readOnly:true,width:360,cls:'x-form-field x-form-text',style:'border: 0; background: none'});}},formatValue:function(value,type){var dataTypes=this.DataTypes||Mkt.widgets.Field.DataTypes;if(!isNull(value)){switch(type){case dataTypes.Boolean:var formatted=value?'true':'false';break;case dataTypes.Currency:var formatted=MktFormat.formatCurrency(value);break;case dataTypes.Float:var formatted=MktFormat.formatFloat(value,false);break;case dataTypes.Integer:var formatted=(typeof value=='string'&&value.length==0)?'':value;break;case dataTypes.String:default:var formatted=(typeof value=='string'&&value.length>0)?value:(value!=null?value:'');break;}}
else{var formatted='';}
return formatted;}};
/* ========== ../mkt-ext-2.0/widgets/ListField.js ============ */

Ext.ns('Mkt.widgets');Mkt.widgets.ListField=Ext.extend(Ext.Panel,{bodyBorder:false,hideLabel:true,width:'auto',layout:'column',style:'margin-top: 11px; margin-left: 6px;',ctCls:'mktListField',hideFieldLabel:false,fieldWidth:138,fieldLabel:'',itemTmpl:'<div style="display:inline;">{text}</div>',itemCount:0,initComponent:function(){this.items=this.items||[];var fieldValueIndex=0;if(!this.hideFieldLabel){this.items.push({width:this.fieldWidth,style:'padding-left: 0;',html:this.fieldLabel,cls:'mktFieldLabel',bodyBorder:false});fieldValueIndex=1;}
this.items.push({columnWidth:.9,cls:'mktFieldLabel mktFieldValue2',bodyBorder:false,html:''});Mkt.widgets.ListField.superclass.initComponent.call(this);this.fieldValue=this.items.items[fieldValueIndex];if(this.value||this.values){this.on('render',function(){window.setTimeout(function(){if(this.value){this.addListItem(this.value);}
if(this.values){for(var i=0;i<this.values.length;i++){this.addListItem(this.values[i]);}}}.createDelegate(this),50);}.createDelegate(this));}},addListItem:function(value,handler,scope){this.itemCount++;var el=this.fieldValue.bwrap;var tc=new Ext.Template(this.itemTmpl).apply(value);var itemEl=Ext.DomHelper.append(el,tc,true);if(itemEl&&handler){itemEl.on('click',handler,scope);}
return itemEl;},addListItems:function(values,handler,scope){if(!values){return;}
var valLen=values.length;for(var i=0;i<valLen;i++){this.addListItem(values[i],handler,scope);}},insertListId:function(text,index,handler,scope){this.itemCount++;},clearList:function(){this.itemCount=0;var el=this.fieldValue.bwrap;var els=Ext.get(el).query('*');for(var i=0;i<els.length;i++){els[i].parentNode.removeChild(els[i]);}}});Mkt.widgets.ListField2=Ext.extend(Ext.Panel,{layout:'form',cls:'mktListField2',unstyled:true,itemTmpl:'{text}',_itemTmpl:null,initComponent:function()
{this.items=this.items||[];this._itemTmpl=new Ext.Template(this.itemTmpl);Mkt.widgets.ListField2.superclass.initComponent.call(this);if(this.value){this.addListItem(this.value);}
if(this.values){this.addListItems(this.values);}},addListItem:function(value,handler,scope)
{var item=new Ext.form.DisplayField({html:this._itemTmpl.apply(value),hideLabel:true,listeners:{render:function(){if(handler){this.getEl().on('click',handler,scope);}}}});this.add(item);if(this.rendered){this.doLayout();}
return item;},addListItems:function(values,handler,scope)
{var items=[];if(values){for(var i=0,il=values.length;i<il;i++){items.push(this.addListItem(values[i],handler,scope));}}
return items;},clearList:function()
{this.removeAll();}});Mkt.widgets.TreeField=Ext.extend(Mkt.widgets.ListField,{baseCls:'mktTreeField',maxRecurseLevel:100,initComponent:function(){this.curRecurseLevel=0;Mkt.widgets.TreeField.superclass.initComponent.call(this);this.on('render',function(){window.setTimeout(function(){this.addTreeItem(this.data);}.createDelegate(this),100);}.createDelegate(this));},addTreeItem:function(value,handler,scope){var el=this.fieldValue.bwrap;var relMarkup=this.getTreeMarkup(value);var itemEl=Ext.DomHelper.append(el,relMarkup,true);if(itemEl&&handler){itemEl.on('click',handler,scope);}
return itemEl;},getTreeMarkup:function(values,level){level=level||0;if(this.curRecurseLevel>this.maxRecurseLevel){return"";}else{this.curRecurseLevel++;}
var treeMarkup="";for(var i=0;i<values.length;i++){if(values[i]['text']&&values[i]['iconCls']){treeMarkup+=this.getNodeMarkup(values[i],level);}
if(values[i]['children']){treeMarkup+=this.getTreeMarkup(values[i]['children'],level+1);}}
return"<ul>"+treeMarkup+"</ul>";},getNodeMarkup:function(values,indents){var emptyIcon=Ext.BLANK_IMAGE_URL;var indent='<span class="x-tree-node-indent"><img src="'+emptyIcon+'" class="x-tree-icon" /></span>';var indentMarkups="";for(var i=0;i<indents;i++){indentMarkups+=indent;}
return['<li class="x-tree-node"><div class="x-tree-node-el x-tree-node-leaf x-unselectable " unselectable="on">',indentMarkups,'<img src="',values.icon||emptyIcon,'" class="x-tree-node-icon',(values.icon?" x-tree-node-inline-icon":""),(values.iconCls?" "+values.iconCls:""),'" />','<span unselectable="on" style="padding-left: 4px;">',values.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');},addListItem:Ext.emptyFn});
/* ========== ../mkt-ext-2.0/widgets/FileUploadField.js ============ */

Ext.ns('Ext.ux.form');Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:'Browse...',buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents('fileselected');},onRender:function(ct,position){Ext.ux.form.FileUploadField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-file-wrap'});this.el.addClass('x-form-file-text');this.el.dom.removeAttribute('name');this.createFileInput();var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:'x-form-file-btn'+(btnCfg.iconCls?' x-btn-icon':'')}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}
this.bindListeners();this.resizeEl=this.positionEl=this.wrap;},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(['x-btn-over','x-btn-focus'])},mouseleave:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},mousedown:function(){this.button.addClass('x-btn-click')},mouseup:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},change:function(){var v=this.fileInput.dom.value;v=v.match(/[^\\]*$/);this.setValue(v);this.fireEvent('fileselected',this,v);}});},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:'x-form-file',tag:'input',type:'file',size:1});},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this);},getFileInputId:function(){return this.id+'-file';},onResize:function(w,h){Ext.ux.form.FileUploadField.superclass.onResize.call(this,w,h);this.wrap.setWidth(w);if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(w);}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap);},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true);},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false);},doDisable:function(disabled){this.fileInput.dom.disabled=disabled;this.button.setDisabled(disabled);},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,'tl-tr',[2,0]);}});Ext.reg('fileuploadfield',Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;
/* ========== ../mkt-ext-2.0/widgets/TreeGridPanel.js ============ */

Ext.ns('MktGrids');MktGrids.TreeGridPanel=function(config)
{config.viewConfig=config.viewConfig||{};var stripeRows=Ext.isDefined(config.stripeRows)?config.stripeRows:true;config.stripeRows=false;var originalGetRowClass=config.viewConfig.getRowClass,isPreviousRowAlt=true;config.viewConfig.getRowClass=function(record,index,rowParams,store){var rowClasses=[];if(index===0){isPreviousRowAlt=true;}
var isCollapsed=(record.treeData&&record.treeData.parent&&(!record.treeData.parent.treeData||!record.treeData.parent.treeData.expanded));if(originalGetRowClass!=null){rowClasses.push(originalGetRowClass.apply(this,arguments));}
if(stripeRows&&!isCollapsed){if(!isPreviousRowAlt){rowClasses.push('x-grid3-row-alt');}
isPreviousRowAlt=!isPreviousRowAlt;}
if(isCollapsed){rowClasses.push('mktTreeGridCollapsedRow');}
return rowClasses.join(' ');};MktGrids.TreeGridPanel.superclass.constructor.call(this,config);};Ext.extend(MktGrids.TreeGridPanel,MktGrids.CanvasGridPanel,{dataInitialized:false,preDataInitCallback:null,treeColumnId:null,childrenFieldId:'children',expandedRowId:null,lastFilterDelegate:null,initComponent:function()
{this.cls=(this.cls||'')+' mktTreeGridPanel';if(this.treeColumnId==null){this.treeColumnId
for(var i=0,l=this.cm.config.length;i<l;i++){if(!this.cm.isHidden(i)){this.treeColumnId=this.cm.getColumnId(i);break;}}}
this.on('beforerender',function(){var cm=this.getColumnModel();if(cm){var column=cm.getColumnById(this.treeColumnId);if(column){var originalRendererFn=column.renderer;column.renderer=function(v,metaData,record,rowIndex,colIndex,store)
{v=originalRendererFn.apply(this,arguments);metaData.css='mktTreeGridTreeColumn';var data=record.treeData;if(data!=null){var levelPadding=new Array(data.levelIndex+1).join('<img class="x-tree-elbow" src="'+Ext.BLANK_IMAGE_URL+'">');if(data.childrenIds.length>0){return'<div class="x-grid3-row-'+(data.expanded?'expanded':'collapsed')+'">'+
levelPadding+'<img class="x-tree-elbow-plus x-grid3-row-expander" src="'+Ext.BLANK_IMAGE_URL+'">'+'<span class="mktTreeGridTreeColumnContent">'+v+'</span>'+'</div>';}
else{return'<div>'+
levelPadding+'<img class="x-tree-elbow" src="'+Ext.BLANK_IMAGE_URL+'">'+'<span class="mktTreeGridTreeColumnContent">'+v+'</span>'+'</div>';}}
else{return v;}};}}});this.on('rowclick',function(grid,rowIndex,e){if(Ext.get(e.target).hasClass('x-grid3-row-expander')){this._expanderClickedHandler.apply(this,arguments);}}.createDelegate(this));this.on('viewready',function(){var headerMenu=this.getView().hmenu,ascMenuItem=headerMenu.getComponent('asc'),descMenuItem=headerMenu.getComponent('desc'),separatorMenuItem=descMenuItem.nextSibling();ascMenuItem.hide();descMenuItem.hide();if(separatorMenuItem&&separatorMenuItem.isXType(Ext.menu.Separator)){separatorMenuItem.hide();}});this.ds.on('datachanged',function(store){this._updateTreeData();}.createDelegate(this));this.ds.on('beforeload',function(store,options){this.dataInitialized=false;}.createDelegate(this));this.ds.on('load',function(store,records,options){if(Ext.isFunction(this.preDataInitCallback)){this.preDataInitCallback.call(this);}
var reader=new Ext.data.JsonReader({root:'data',totalProperty:'total'},store.reader.meta.fields)
for(var i=records.length-1;i>=0;i--){var record=records[i],children=record.json[this.childrenFieldId];if(children!=null){var json={data:[],total:0};for(var j=children.length-1;j>=0;j--){var child=children[j];child._originalId=child.id;child.id=record.id+'.'+child.id;child.parentId=record.id;json.data.push(child);json.total++;}
var childRecords=reader.readRecords(json).records;if(childRecords.length>0){store.insert(i+1,childRecords);}
for(var j=0,l=childRecords.length;j<l;j++){childRecords[j].json.id=childRecords[j].json._originalId;delete childRecords[j].json._originalId;}}}
this.refreshFilter();this.dataInitialized=true;}.createDelegate(this));var originalFilterByFn=this.ds.filterBy;var originalFilterFn=this.ds.filter;var originalClearFilterFn=this.ds.clearFilter;this.ds.filterBy=originalFilterByFn.createInterceptor(function(){this.lastFilterDelegate=originalFilterByFn.createDelegate(this.getStore(),arguments);return this.dataInitialized;},this);this.ds.filter=originalFilterFn.createInterceptor(function(){this.lastFilterDelegate=originalFilterFn.createDelegate(this.getStore(),arguments);return this.dataInitialized;},this);this.ds.clearFilter=originalClearFilterFn.createInterceptor(function(){this.lastFilterDelegate=null;return this.dataInitialized;},this);MktGrids.TreeGridPanel.superclass.initComponent.call(this);},refreshFilter:function()
{if(this.lastFilterDelegate!=null){this.lastFilterDelegate();}},_updateTreeData:function()
{var store=this.getStore();if(store==null)return;var records=store.getRange(),levelParentRecords=[],currentLevelIndex=0;for(var i=0,l=records.length;i<l;i++){var record=records[i],parentRecord=null;if(record.json.parentId!=null){currentLevelIndex++;do{parentRecord=levelParentRecords[currentLevelIndex-1];if(record.json.parentId!=parentRecord.id){levelParentRecords[currentLevelIndex]=null;currentLevelIndex--;}
else{break;}}
while(currentLevelIndex>0);parentRecord.treeData.childrenIds.push(record.id);}
else{currentLevelIndex=0;}
levelParentRecords[currentLevelIndex]=record;record.treeData={levelIndex:currentLevelIndex,parent:parentRecord,childrenIds:[],expanded:record.treeData!=null?record.treeData.expanded:this.expandedRowId==record.id}}},_expandRow:function(expand,record)
{if(record!=null&&record.treeData!=null){record.treeData.expanded=expand;}
this.expandedRowId=(record!=null&&expand)?record.id:null;},_expanderClickedHandler:function(grid,rowIndex,e)
{var store=grid.getStore(),record=store.getAt(rowIndex);if(record.id!=grid.expandedRowId){if(grid.expandedRowId!=null){this._expandRow(false,store.getById(grid.expandedRowId));}
this._expandRow(true,record);}
else{this._expandRow(false,record);}
grid.getView().refresh();}});
/* ========== ../mkt-ext-2.0/widgets/UsedByModal.js ============ */

(function(){Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.UsedByModal=Ext.extend(Mkt.widgets.ModalForm,{title:'Used by',minWidth:350,width:400,minHeiht:300,height:350,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktUsedByModal',iconCls:'mkiGearsRun',layout:'form',plain:true,modal:true,bodyStyle:'padding: 25px 0 0 15px;',buttonAlign:'right',useStandardButtons:false,labelWidth:145,cancelText:'Close',usedPropertyLabel:null,usedPropertyText:null,usedByRequestUrl:null,usedByRequestConfig:null,usedPropertyField:null,usedByField:null,initComponent:function()
{this.items=this.items||[];this.buttons=this.buttons||[];this.usedByRequestConfig=this.usedByRequestConfig||{};if(this.usedPropertyLabel!==null){this.usedPropertyField=new Ext.form.DisplayField({fieldLabel:this.usedPropertyLabel,value:this.usedPropertyText});this.items.push(this.usedPropertyField);}
else{this.usedPropertyField=null;}
this.usedByField=new Mkt.widgets.UsedByListField({requestUrl:this.usedByRequestUrl,requestConfig:this.usedByRequestConfig,navigationCallback:function(){this.close();}.createDelegate(this)});this.items.push(this.usedByField);if(!this.useStandardButtons){this.buttons.push({text:this.cancelText,iconCls:this.cancelCls,handler:this.cancelButtonHandler.createDelegate(this)});}
Mkt.widgets.UsedByModal.superclass.initComponent.call(this);}});})();
/* ========== ../mkt-ext-2.0/widgets/UsedByListField.js ============ */

(function(){Ext.ns('Mkt','Mkt.widgets');Mkt.widgets.UsedByListField=Ext.extend(Mkt.widgets.ListField2,{fieldLabel:'Used By',cls:'mktListField2 mktUsedByListField',itemTmpl:'<div class="usedByFieldContainer {ctCls}">'+'<div class="usedByFieldContent">'+'<div class="usedByFieldIcon">'+'<div class="mki16 {iconCls}"></div>'+'</div>'+'{text}'+'</div>'+'<a href="{externalUrl}" class="usedByFieldExternalLink mkiExternal mki16" target="_blank"></a>'+'</div>',data:null,requestUrl:null,requestConfig:null,navigationCallback:null,initComponent:function()
{this.requestConfig=this.requestConfig||{};this.navigationCallback=this.navigationCallback||Ext.emptyFn;Mkt.widgets.UsedByListField.superclass.initComponent.call(this);if(this.requestUrl&&!this.data){this.requestData();}
else if(this.data){this.loadData();}},requestData:function()
{this.addListItem({ctCls:'usedByFieldLoading',iconCls:'mkiAjaxLoader',text:'Loading...'});var requestParams=Ext.apply({onMySuccess:this.requestDataDone.createDelegate(this)},this.requestConfig);MktSession.ajaxRequest(this.requestUrl,requestParams);},requestDataDone:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){this.data=MktPage.appVars.usedByList;this.loadData();}},loadData:function()
{this.clearList();if(!Ext.isEmpty(this.data)){var list=this.data;for(var i=0,il=list.length;i<il;i++){this.addListItem({iconCls:list[i].iconCls,text:list[i].text,externalUrl:'#'+list[i].id},function(listItem,e){if(Ext.get(e.target).hasClass('usedByFieldExternalLink')){return;}
this.navigationCallback();MktDlManager.loadDl(listItem.xtra);}.createDelegate(this,[list[i]],0));}}
else{this.addListItem({text:'None',ctCls:'usedByFieldNone'});}}});})();
/* ========== ../mkt-ext-2.0/widgets/SuperBoxSelect.js ============ */

Ext.namespace('Ext.ux.form');Ext.ux.form.SuperBoxSelect=function(config){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,config);this.addEvents('beforeadditem','additem','newitem','beforeremoveitem','removeitem','clear');};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:'',clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:'',extraItemStyle:'',expandBtnCls:'',fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:'',queryValuesDelimiter:'|',queryValuesIndicator:'valuesqry',removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:'blur',valueDelimiter:',',initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:''});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe);}}
if(this.transform){this.doTransform();}
if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this});}
Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==='remote'&&this.store){this.store.on('load',this.onStoreLoad,this);}},onRender:function(ct,position){var h=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,ct,position);this.hiddenName=h;this.manageNameAttribute();var extraClass=(this.stackItems===true)?'x-superboxselect-stacked':'';if(this.renderFieldBtns){extraClass+=' x-superboxselect-display-btns';}
this.el.removeClass('x-form-text').addClass('x-superboxselect-input-field');this.wrapEl=this.el.wrap({tag:'ul'});this.outerWrapEl=this.wrapEl.wrap({tag:'div',cls:'x-form-text x-superboxselect '+extraClass});this.inputEl=this.el.wrap({tag:'li',cls:'x-superboxselect-input'});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn();}
this.setupFormInterception();},doTransform:function(){var s=Ext.getDom(this.transform),transformValues=[];if(!this.store){this.mode='local';var d=[],opts=s.options;for(var i=0,len=opts.length;i<len;i++){var o=opts[i],oe=Ext.get(o),value=oe.getAttributeNS(null,'value')||'',cls=oe.getAttributeNS(null,'className')||'',style=oe.getAttributeNS(null,'style')||'';if(o.selected){transformValues.push(value);}
d.push([value,o.text,cls,typeof(style)==="string"?style:style.cssText]);}
this.store=new Ext.data.SimpleStore({'id':0,fields:['value','text','cls','style'],data:d});Ext.apply(this,{valueField:'value',displayField:'text',classField:'cls',styleField:'style'});}
if(transformValues.length){this.value=transformValues.join(',');}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:'x-superboxselect-btns'});this.buttonClear=this.buttonWrap.createChild({tag:'div',cls:'x-superboxselect-btn-clear '+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:'div',cls:'x-superboxselect-btn-expand '+this.expandBtnCls});}
this.initButtonEvents();return this;},initButtonEvents:function(){this.buttonClear.addClassOnOver('x-superboxselect-btn-over').on('click',function(e){e.stopEvent();if(this.disabled){return;}
this.clearValue();this.el.focus();},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver('x-superboxselect-btn-over').on('click',function(e){e.stopEvent();if(this.disabled){return;}
if(this.isExpanded()){this.multiSelectMode=false;}else if(this.pinList){this.multiSelectMode=true;}
this.onTriggerClick();},this);}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners();}
return this;},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null;}
return this;},initEvents:function(){var el=this.el;el.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on('click',this.onWrapClick,this);this.outerWrapEl.on('click',this.onWrapClick,this);this.inputEl.focus=function(){el.focus();};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(e){if(this.fixFocusOnTabSelect&&this.isExpanded()){e.stopEvent();el.blur();this.onViewClick(false);this.focus(false,10);return true;}
this.onViewClick(false);if(el.dom.value!==''){this.setRawValue('');}
return true;},down:function(e){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick();}}else{this.inKeyMode=true;this.selectNext();}},enter:function(){}});},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize();},onTypeAhead:function(){Ext.ux.form.SuperBoxSelect.superclass.onTypeAhead.call(this);this.autoSize();},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var v=this.el.dom.value;if(v!==''){this.fireNewItemEvent(v);}}
Ext.form.ComboBox.superclass.beforeBlur.call(this);},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this);},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==''){this.applyEmptyText();this.autoSize();}
Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this);},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false;},onWrapClick:function(e){e.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus();},markInvalid:function(msg){var elp,t;if(!this.rendered||this.preventMark){return;}
this.outerWrapEl.addClass(this.invalidClass);msg=msg||this.invalidText;switch(this.msgTarget){case'qtip':Ext.apply(this.el.dom,{qtip:msg,qclass:'x-form-invalid-tip'});Ext.apply(this.wrapEl.dom,{qtip:msg,qclass:'x-form-invalid-tip'});Ext.apply(this.outerWrapEl.dom,{qtip:msg,qclass:'x-form-invalid-tip'});if(Ext.QuickTips){Ext.QuickTips.enable();}
break;case'title':this.el.dom.title=msg;this.wrapEl.dom.title=msg;this.outerWrapEl.dom.title=msg;break;case'under':if(!this.errorEl){elp=this.getErrorCt();if(!elp){this.el.dom.title=msg;break;}
this.errorEl=elp.createChild({cls:'x-form-invalid-msg'});this.errorEl.setWidth(elp.getWidth(true)-20);}
this.errorEl.update(msg);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case'side':if(!this.errorIcon){elp=this.getErrorCt();if(!elp){this.el.dom.title=msg;break;}
this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});}
this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:msg,qclass:'x-form-invalid-tip'});this.errorIcon.show();this.on('resize',this.alignErrorIcon,this);break;default:t=Ext.getDom(this.msgTarget);t.innerHTML=msg;t.style.display=this.msgDisplay;break;}
this.fireEvent('invalid',this,msg);},clearInvalid:function(){if(!this.rendered||this.preventMark){return;}
this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case'qtip':this.el.dom.qtip='';this.wrapEl.dom.qtip='';this.outerWrapEl.dom.qtip='';break;case'title':this.el.dom.title='';this.wrapEl.dom.title='';this.outerWrapEl.dom.title='';break;case'under':if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);}
break;case'side':if(this.errorIcon){this.errorIcon.dom.qtip='';this.errorIcon.hide();this.un('resize',this.alignErrorIcon,this);}
break;default:var t=Ext.getDom(this.msgTarget);t.innerHTML='';t.style.display='none';break;}
this.fireEvent('valid',this);},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,'tl-tr',[Ext.isIE?5:2,3]);}},expand:function(){if(this.isExpanded()||!this.hasFocus){return;}
if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}
this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow('auto');this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent('expand',this);},restrictHeight:function(){var inner=this.innerList.dom,st=inner.scrollTop,list=this.list;inner.style.height='';var pad=list.getFrameWidth('tb')+(this.resizable?this.handleHeight:0)+this.assetHeight,h=Math.max(inner.clientHeight,inner.offsetHeight,inner.scrollHeight),ha=this.getPosition()[1]-Ext.getBody().getScroll().top,hb=Ext.lib.Dom.getViewHeight()-ha-this.getSize().height,space=Math.max(ha,hb,this.minHeight||0)-list.shadowOffset-pad-5;h=Math.min(h,space,this.maxHeight);this.innerList.setHeight(h);list.beginUpdate();list.setHeight(h+pad);list.alignTo(this.outerWrapEl,this.listAlign);list.endUpdate();if(this.multiSelectMode){inner.scrollTop=st;}},validateValue:function(val){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}
this.clearInvalid();return true;},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute('name',this.hiddenName||this.name);}else{this.el.dom.removeAttribute('name');}},setupFormInterception:function(){var form;this.findParentBy(function(p){if(p.getForm){form=p.getForm();}});if(form){var formGet=form.getValues;form.getValues=function(asString){this.el.dom.disabled=true;var oldVal=this.el.dom.value;this.setRawValue('');var vals=formGet.call(form);this.el.dom.disabled=false;this.setRawValue(oldVal);if(this.forceFormValue&&this.items.getCount()===0){vals[this.name]='';}
return asString?Ext.urlEncode(vals):vals;}.createDelegate(this);}},onResize:function(w,h,rw,rh){var reduce=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=w;this.outerWrapEl.setWidth(w-reduce);if(this.renderFieldBtns){reduce+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(w-reduce);}}
Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,w,h,rw,rh);this.autoSize();},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(item){item.enable();});if(this.renderFieldBtns){this.initButtonEvents();}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(item){item.disable();});if(this.renderFieldBtns){this.removeButtonEvents();}},clearValue:function(supressRemoveEvent){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=supressRemoveEvent||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent('clear',this);return this;},fireNewItemEvent:function(val){this.view.clearSelections();this.collapse();this.setRawValue('');if(this.queryFilterRe){val=val.replace(this.queryFilterRe,'');if(!val){return;}}
this.fireEvent('newitem',this,val,this.filteredQueryData);},onKeyUp:function(e){if(this.editable!==false&&(!e.isSpecialKey()||e.getKey()===e.BACKSPACE)&&this.itemDelimiterKey.indexOf!==e.getKey()&&(!e.hasModifier()||e.shiftKey)){this.lastKey=e.getKey();this.dqTask.delay(this.queryDelay);}},onKeyDownHandler:function(e,t){var toDestroy,nextFocus,idx;if(e.getKey()===e.ESC){if(!this.isExpanded()){if(this.el.dom.value!=''&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value='';}
if(this.clearLastQueryOnEscape){this.lastQuery='';}
e.stopEvent();}}}
if((e.getKey()===e.DELETE||e.getKey()===e.SPACE)&&this.currentFocus){e.stopEvent();toDestroy=this.currentFocus;this.on('expand',function(){this.collapse();},this,{single:true});idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1);}
toDestroy.preDestroy(true);if(nextFocus){(function(){nextFocus.onLnkFocus();this.currentFocus=nextFocus;}).defer(200,this);}
return true;}
var val=this.el.dom.value,it,ctrl=e.ctrlKey;if(this.itemDelimiterKey===e.getKey()){e.stopEvent();if(val!==""){if(ctrl||!this.isExpanded()){this.fireNewItemEvent(val);}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}}else{if(!this.isExpanded()){return;}
this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}
return true;}
if(val!==''){this.autoSize();return;}
if(e.getKey()===e.HOME){e.stopEvent();if(this.items.getCount()>0){this.collapse();it=this.items.get(0);it.el.focus();}
return true;}
if(e.getKey()===e.BACKSPACE){e.stopEvent();if(this.currentFocus){toDestroy=this.currentFocus;this.on('expand',function(){this.collapse();},this,{single:true});idx=this.items.indexOfKey(toDestroy.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1);}
toDestroy.preDestroy(true);if(nextFocus){(function(){nextFocus.onLnkFocus();this.currentFocus=nextFocus;}).defer(200,this);}
return;}else{it=this.items.get(this.items.getCount()-1);if(it){if(this.backspaceDeletesLastItem){this.on('expand',function(){this.collapse();},this,{single:true});it.preDestroy(true);}else{if(this.navigateItemsWithTab){it.onElClick();}else{this.on('expand',function(){this.collapse();this.currentFocus=it;this.currentFocus.onLnkFocus.defer(20,this.currentFocus);},this,{single:true});}}}
return true;}}
if(!e.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return;}
if(e.getKey()===e.LEFT||(e.getKey()===e.UP&&!this.isExpanded())){e.stopEvent();this.collapse();it=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(it){it.focus();}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx!==0){this.currentFocus=this.items.itemAt(idx-1);this.currentFocus.onLnkFocus();}}else{this.currentFocus=it;if(it){it.onLnkFocus();}}}
return true;}
if(e.getKey()===e.DOWN){if(this.currentFocus){this.collapse();e.stopEvent();idx=this.items.indexOfKey(this.currentFocus.key);if(idx==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this);}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(idx+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}
return true;}}
if(e.getKey()===e.RIGHT){this.collapse();it=this.items.itemAt(0);if(this.navigateItemsWithTab){if(it){it.focus();}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(idx+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}}else{this.currentFocus=it;if(it){it.onLnkFocus();}}}}},onKeyUpBuffered:function(e){if(!e.isNavKeyPress()){this.autoSize();}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue('');},applyEmptyText:function(){this.setRawValue('');if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue('');return this;}
if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}
return this;},removeAllItems:function(){this.items.each(function(item){item.preDestroy(true);},this);this.manageClearBtn();return this;},killItems:function(){this.items.each(function(item){item.kill();},this);this.resetStore();this.items.clear();this.manageClearBtn();return this;},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this;}
this.usedRecords.each(function(rec){this.store.add(rec);},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,'ASC');}
return this;},sortStore:function(){var ss=this.store.getSortState();if(ss&&ss.field){this.store.sort(ss.field,ss.direction);}
return this;},getCaption:function(dataObject){if(typeof this.displayFieldTpl==='string'){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl);}
var caption,recordData=dataObject instanceof Ext.data.Record?dataObject.data:dataObject;if(this.displayFieldTpl){caption=this.displayFieldTpl.apply(recordData);}else if(this.displayField){caption=recordData[this.displayField];}
return caption;},addRecord:function(record){var display=record.data[this.displayField],caption=this.getCaption(record),val=record.data[this.valueField],cls=this.classField?record.data[this.classField]:'',style=this.styleField?record.data[this.styleField]:'';if(this.removeValuesFromStore){this.usedRecords.add(val,record);this.store.remove(record);}
this.addItemBox(val,display,caption,cls,style);this.fireEvent('additem',this,val,record);},createRecord:function(recordData){if(!this.recordConstructor){var recordFields=[{name:this.valueField},{name:this.displayField}];if(this.classField){recordFields.push({name:this.classField});}
if(this.styleField){recordFields.push({name:this.styleField});}
this.recordConstructor=Ext.data.Record.create(recordFields);}
return new this.recordConstructor(recordData);},addItems:function(newItemObjects){if(Ext.isArray(newItemObjects)){Ext.each(newItemObjects,function(item){this.addItem(item);},this);}else{this.addItem(newItemObjects);}},addNewItem:function(newItemObject){this.addItem(newItemObject,true);},addItem:function(newItemObject,forcedAdd){var val=newItemObject[this.valueField];if(this.disabled){return false;}
if(this.preventDuplicates&&this.hasValue(val)){return;}
var record=this.findRecord(this.valueField,val);if(record){this.addRecord(record);return;}else if(!this.allowAddNewData){return;}
if(this.mode==='remote'){this.remoteLookup.push(newItemObject);this.doQuery(val,false,false,forcedAdd);return;}
var rec=this.createRecord(newItemObject);this.store.add(rec);this.addRecord(rec);return true;},addItemBox:function(itemVal,itemDisplay,itemCaption,itemClass,itemStyle){var hConfig,parseStyle=function(s){var ret='';switch(typeof s){case'function':ret=s.call();break;case'object':for(var p in s){ret+=p+':'+s[p]+';';}
break;case'string':ret=s+';';}
return ret;},itemKey=Ext.id(null,'sbx-item'),box=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+' '+itemClass,style:parseStyle(this.extraItemStyle)+' '+itemStyle,caption:itemCaption,display:itemDisplay,value:itemVal,key:itemKey,listeners:{'remove':function(item){if(this.fireEvent('beforeremoveitem',this,item.value)===false){return false;}
this.items.removeKey(item.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(item.value)){this.store.add(this.usedRecords.get(item.value));this.usedRecords.removeKey(item.value);this.sortStore();if(this.view){this.view.render();}}}
if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,['removeitem',this,item.value,this.findInStore(item.value)]);}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue();},scope:this}});box.render();hConfig={tag:'input',type:'hidden',value:itemVal,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(hConfig,{disabled:'disabled'})}
box.hidden=this.el.insertSibling(hConfig,'before');this.items.add(itemKey,box);this.applyEmptyText().autoSize().manageClearBtn().validateValue();},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this;}
var cls='x-superboxselect-btn-hide';if(this.items.getCount()===0){this.buttonClear.addClass(cls);}else{this.buttonClear.removeClass(cls);}
return this;},findInStore:function(val){var index=this.store.find(this.valueField,val);if(index>-1){return this.store.getAt(index);}
return false;},getSelectedRecords:function(){var ret=[];if(this.removeValuesFromStore){ret=this.usedRecords.getRange();}else{var vals=[];this.items.each(function(item){vals.push(item.value);});Ext.each(vals,function(val){ret.push(this.findInStore(val));},this);}
return ret;},findSelectedItem:function(el){var ret;this.items.each(function(item){if(item.el.dom===el){ret=item;return false;}});return ret;},findSelectedRecord:function(el){var ret,item=this.findSelectedItem(el);if(item){ret=this.findSelectedRecordByValue(item.value)}
return ret;},findSelectedRecordByValue:function(val){var ret;if(this.removeValuesFromStore){this.usedRecords.each(function(rec){if(rec.get(this.valueField)==val){ret=rec;return false;}},this);}else{ret=this.findInStore(val);}
return ret;},getValue:function(){var ret=[];this.items.each(function(item){ret.push(item.value);});return ret.join(this.valueDelimiter);},getCount:function(){return this.items.getCount();},getValueEx:function(){var ret=[];this.items.each(function(item){var newItem={};newItem[this.valueField]=item.value;newItem[this.displayField]=item.display;if(this.classField){newItem[this.classField]=item.cls||'';}
if(this.styleField){newItem[this.styleField]=item.style||'';}
ret.push(newItem);},this);return ret;},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue();}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);}
if(this.mode==='remote'){this.setOriginal=true;}},addValue:function(value){if(Ext.isEmpty(value)){return;}
var values=value;if(!Ext.isArray(value)){value=''+value;values=value.split(this.valueDelimiter);}
Ext.each(values,function(val){var record=this.findRecord(this.valueField,val);if(record){this.addRecord(record);}else if(this.mode==='remote'){this.remoteLookup.push(val);}},this);if(this.mode==='remote'){var q=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(q,false,true);}},setValue:function(value){if(!this.rendered){this.value=value;return;}
this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(value);},setValueEx:function(data){if(!this.rendered){this.value=data;return;}
this.removeAllItems().resetStore();if(!Ext.isArray(data)){data=[data];}
this.remoteLookup=[];if(this.allowAddNewData&&this.mode==='remote'){Ext.each(data,function(d){var r=this.findRecord(this.valueField,d[this.valueField])||this.createRecord(d);this.addRecord(r);},this);return;}
Ext.each(data,function(item){this.addItem(item);},this);},hasValue:function(val){var has=false;this.items.each(function(item){if(item.value==val){has=true;return false;}},this);return has;},onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){var val=record.data[this.valueField];if(this.preventDuplicates&&this.hasValue(val)){return;}
this.setRawValue('');this.lastSelectionText='';if(this.fireEvent('beforeadditem',this,val,record,this.filteredQueryData)!==false){this.addRecord(record);}
if(this.store.getCount()===0||!this.multiSelectMode){this.collapse();}else{this.restrictHeight();}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand);}
if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap);}
Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this);},autoSize:function(){if(!this.rendered){return this;}
if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}
var el=this.el,v=el.dom.value,d=document.createElement('div');if(v===""&&this.emptyText&&this.items.getCount()<1){v=this.emptyText;}
d.appendChild(document.createTextNode(v));v=d.innerHTML;d=null;v+="&#160;";var w=Math.max(this.metrics.getWidth(v)+24,24);if(typeof this._width!='undefined'){w=Math.min(this._width,w);}
this.el.setWidth(w);if(Ext.isIE){this.el.dom.style.top='0';}
this.fireEvent('autosize',this,w);return this;},shouldQuery:function(q){if(this.lastQuery){var m=q.match("^"+this.lastQuery);if(!m||this.store.getCount()){return true;}else{return(m[0]!==this.lastQuery);}}
return true;},doQuery:function(q,forceAll,valuesQuery,forcedAdd){q=Ext.isEmpty(q)?'':q;if(this.queryFilterRe){this.filteredQueryData='';var m=q.match(this.queryFilterRe);if(m&&m.length){this.filteredQueryData=m[0];}
q=q.replace(this.queryFilterRe,'');if(!q&&m){return;}}
var qe={query:q,forceAll:forceAll,combo:this,cancel:false};if(this.fireEvent('beforequery',qe)===false||qe.cancel){return false;}
q=qe.query;forceAll=qe.forceAll;if(forceAll===true||(q.length>=this.minChars)||valuesQuery&&!Ext.isEmpty(q)){if(forcedAdd||this.forceSameValueQuery||this.shouldQuery(q)){this.lastQuery=q;if(this.mode=='local'){this.selectedIndex=-1;if(forceAll){this.store.clearFilter();}else{this.store.filter(this.displayField,q);}
this.syncStore();this.onLoad();}else{this.store.baseParams[this.queryParam]=q;this.store.baseParams[this.queryValuesIndicator]=valuesQuery;this.store.load({params:this.getParams(q)});if(!forcedAdd){this.expand();}}}else{this.selectedIndex=-1;this.onLoad();}}},syncStore:function()
{if(this.removeValuesFromStore){this.store.each(function(record){if(this.usedRecords.containsKey(record.get(this.valueField))){this.store.remove(record);}},this);}},onStoreLoad:function(store,records,options){var q=options.params[this.queryParam]||store.baseParams[this.queryParam]||"",isValuesQuery=options.params[this.queryValuesIndicator]||store.baseParams[this.queryValuesIndicator];this.syncStore();if(isValuesQuery){var params=q.split(this.queryValuesDelimiter);Ext.each(params,function(p){this.remoteLookup.remove(p);var rec=this.findRecord(this.valueField,p);if(rec){this.addRecord(rec);}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue();}}
if(q!==''&&this.allowAddNewData){Ext.each(this.remoteLookup,function(r){if(typeof r==="object"&&r[this.valueField]===q){this.remoteLookup.remove(r);if(records.length&&records[0].get(this.valueField)===q){this.addRecord(records[0]);return;}
var rec=this.createRecord(r);this.store.add(rec);this.addRecord(rec);this.addedRecords.push(rec);(function(){if(this.isExpanded()){this.collapse();}}).defer(10,this);return;}},this);}
var toAdd=[];if(q===''){Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return;}
toAdd.push(rec);},this);}else{var re=new RegExp(Ext.escapeRe(q)+'.*','i');Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return;}
if(re.test(rec.get(this.displayField))){toAdd.push(rec);}},this);}
this.store.add(toAdd);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse();}}});Ext.reg('superboxselect',Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(config){Ext.apply(this,config);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this);};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this);},onElClick:function(e){var o=this.owner;o.clearCurrentFocus().collapse();if(o.navigateItemsWithTab){this.focus();}else{o.el.dom.focus();var that=this;(function(){this.onLnkFocus();o.currentFocus=this;}).defer(10,this);}},onLnkClick:function(e){if(e){e.stopEvent();}
this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus();}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus");},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus");},enableElListeners:function(){this.el.on('click',this.onElClick,this,{stopEvent:true});this.el.addClassOnOver('x-superboxselect-item-hover');},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this});},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners();},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un('click',this.onLnkClick,this);this.lnk.un('focus',this.onLnkFocus,this);this.lnk.un('blur',this.onLnkBlur,this);},onRender:function(ct,position){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,ct,position);var el=this.el;if(el){el.remove();}
this.el=el=ct.createChild({tag:'li'},ct.last());el.addClass('x-superboxselect-item');var btnEl=this.owner.navigateItemsWithTab?(Ext.isSafari?'button':'a'):'span';var itemKey=this.key;Ext.apply(el,{focus:function(){var c=this.down(btnEl+'.x-superboxselect-item-close');if(c){c.focus();}},preDestroy:function(){this.preDestroy();}.createDelegate(this)});this.enableElListeners();el.update(Ext.util.Format.htmlEncode(this.caption));var cfg={tag:btnEl,'class':'x-superboxselect-item-close',tabIndex:this.owner.navigateItemsWithTab?'0':'-1'};if(btnEl==='a'){cfg.href='#';}
this.lnk=el.createChild(cfg);if(!this.disabled){this.enableLnkListeners();}else{this.disableAllListeners();}
this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap();},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus('right');},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus('left');},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var l=this.owner.items.get(0).el.focus();if(l){l.el.focus();}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus();},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true;},moveFocus:function(dir){var el=this.el[dir=='left'?'prev':'next']()||this.owner.el;el.focus.defer(100,el);},preDestroy:function(supressEffect){if(this.fireEvent('remove',this)===false){return;}
var actionDestroy=function(){if(this.owner.navigateItemsWithTab){this.moveFocus('right');}
this.hidden.remove();this.hidden=null;this.destroy();};if(supressEffect){actionDestroy.call(this);}else{this.el.hide({duration:0.2,callback:actionDestroy,scope:this});}
return this;},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy();},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute('disabled','disabled');}
this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this);},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute('disabled');}
this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this);},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this);}});
/* ========== ../mkt-ext-2.0/widgets/MktSparkline.js ============ */

Ext.namespace('Ext.ux.Sparkline');if(!Array.prototype.indexOf){Array.prototype.indexOf=function(entry){for(var i=0,vlen=this.length;i<vlen;i++){if(this[i]==entry)
return i;}
return-1;}}
if(Ext.isIE&&!document.namespaces['v']){document.namespaces.add('v','urn:schemas-microsoft-com:vml','#default#VML');}
function quartile(values,q){if(q==2){var vl2=Math.floor(values.length/2);return values.length%2?values[vl2]:(values[vl2]+values[vl2+1])/2;}else{var vl4=Math.floor(values.length/4);return values.length%2?(values[vl4*q]+values[vl4*q+1])/2:values[vl4*q];}};var t=document.createElement('canvas');Ext.hasCanvas=t.getContext!=undefined;var vcanvas_base=function(){};vcanvas_base.prototype={drawShape:function(path,lineColor,fillColor,lineWidth){alert('drawShape not implemented');},drawLine:function(x1,y1,x2,y2,lineColor,lineWidth){return this.drawShape([[x1,y1],[x2,y2]],lineColor,lineWidth);},drawCircle:function(x,y,radius,lineColor,fillColor){alert('drawCircle not implemented');},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){alert('drawPieSlice not implemented');},drawRect:function(x,y,width,height,lineColor,fillColor){alert('drawRect not implemented');},getElement:function(){return this.canvas;},_insert:function(el,target){Ext.fly(target).insertFirst(el);}};vcanvas_vml=Ext.extend(vcanvas_base,{constructor:function(width,height,target){this.width=width;this.height=height;this.target=target;if(target[0])target=target[0];target.vcanvas=this;this.canvas=document.createElement('span');this.canvas.style.display='inline-block';this.canvas.style.position='relative';this.canvas.style.overflow='hidden';this.canvas.style.width=width;this.canvas.style.height=height;this.canvas.style.margin='0px';this.canvas.style.padding='0px';this.canvas.style.verticalAlign='top';this._insert(this.canvas,target);this.pixel_height=Ext.fly(this.canvas).getHeight();this.pixel_width=Ext.fly(this.canvas).getWidth();this.canvas.width=this.pixel_width;this.canvas.height=this.pixel_height;var groupel='<v:group coordorigin="0 0" coordsize="'+this.pixel_width+' '+this.pixel_height+'"'
+' style="position:absolute;top:0;left:0;width:'+this.pixel_width+'px;height='+this.pixel_height+'px;"></v:group>';this.canvas.insertAdjacentHTML('beforeEnd',groupel);this.group=this.canvas.childNodes.item(0);},drawShape:function(path,lineColor,fillColor,lineWidth){var vpath=[];for(var i=0,plen=path.length;i<plen;i++){vpath[i]=''+(path[i][0])+','+(path[i][1]);}
var initial=vpath.splice(0,1);lineWidth=lineWidth==undefined?1:lineWidth;var stroke=lineColor==undefined?' stroked="false" ':' strokeWeight="'+lineWidth+'" strokeColor="'+lineColor+'" ';var fill=fillColor==undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';var closed=vpath[0]==vpath[vpath.length-1]?'x ':'';var vel='<v:shape coordorigin="0 0" coordsize="'+this.pixel_width+' '+this.pixel_height+'" '
+stroke
+fill
+' style="position:absolute;left:0px;top:0px;height:'+this.pixel_height+'px;width:'+this.pixel_width+'px;padding:0px;margin:0px;" '
+' path="m '+initial+' l '+vpath.join(', ')+' '+closed+'e">'
+' </v:shape>';this.group.insertAdjacentHTML('beforeEnd',vel);},drawCircle:function(x,y,radius,lineColor,fillColor){x-=radius+1;y-=radius+1;var stroke=lineColor==undefined?' stroked="false" ':' strokeWeight="1" strokeColor="'+lineColor+'" ';var fill=fillColor==undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';var vel='<v:oval '
+stroke
+fill
+' style="position:absolute;top:'+y+'px; left:'+x+'px; width:'+(radius*2)+'px; height:'+(radius*2)+'px"></v:oval>';this.group.insertAdjacentHTML('beforeEnd',vel);},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){if(startAngle==endAngle){return;}
if((endAngle-startAngle)==(2*Math.PI)){startAngle=0.0;endAngle=(2*Math.PI);}
var startx=x+Math.round(Math.cos(startAngle)*radius);var starty=y+Math.round(Math.sin(startAngle)*radius);var endx=x+Math.round(Math.cos(endAngle)*radius);var endy=y+Math.round(Math.sin(endAngle)*radius);if(startx==endx&&starty==endy&&(endAngle-startAngle)<Math.PI)
return;var vpath=[x-radius,y-radius,x+radius,y+radius,startx,starty,endx,endy];var stroke=lineColor==undefined?' stroked="false" ':' strokeWeight="1" strokeColor="'+lineColor+'" ';var fill=fillColor==undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';var vel='<v:shape coordorigin="0 0" coordsize="'+this.pixel_width+' '+this.pixel_height+'" '
+stroke
+fill
+' style="position:absolute;left:0px;top:0px;height:'+this.pixel_height+'px;width:'+this.pixel_width+'px;padding:0px;margin:0px;" '
+' path="m '+x+','+y+' wa '+vpath.join(', ')+' x e">'
+' </v:shape>';this.group.insertAdjacentHTML('beforeEnd',vel);},drawRect:function(x,y,width,height,lineColor,fillColor){return this.drawShape([[x,y],[x,y+height],[x+width,y+height],[x+width,y],[x,y]],lineColor,fillColor);}});var vcanvas_canvas=Ext.extend(vcanvas_base,{constructor:function(width,height,target){this.width=width;this.height=height;this.target=target;this.canvas=document.createElement('canvas');if(target[0])target=target[0];target.vcanvas=this;this.canvas=document.createElement('canvas');this.canvas.style.display='inline-block';this.canvas.width=width;this.canvas.height=height;this.canvas.style.verticalAlign='top';this._insert(this.canvas,target);this.pixel_height=Ext.fly(this.canvas).getHeight();this.pixel_width=Ext.fly(this.canvas).getWidth();this.canvas.width=this.pixel_width;this.canvas.height=this.pixel_height;Ext.fly(this.canvas).applyStyles({width:this.pixel_width,height:this.pixel_height});},_getContext:function(lineColor,fillColor,lineWidth){var context=this.canvas.getContext('2d');if(lineColor!=undefined)
context.strokeStyle=lineColor;context.lineWidth=lineWidth==undefined?1:lineWidth;if(fillColor!=undefined)
context.fillStyle=fillColor;return context;},drawShape:function(path,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth);context.beginPath();context.moveTo(path[0][0]+0.5,path[0][1]+0.5);for(var i=1,plen=path.length;i<plen;i++){context.lineTo(path[i][0]+0.5,path[i][1]+0.5);}
if(lineColor!=undefined){context.stroke();}
if(fillColor!=undefined){context.fill();}},drawCircle:function(x,y,radius,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);context.beginPath();context.arc(x,y,radius,0,2*Math.PI,false);if(lineColor!=undefined){context.stroke();}
if(fillColor!=undefined){context.fill();}},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,startAngle,endAngle,false);context.lineTo(x,y);context.closePath();if(lineColor!=undefined){context.stroke();}
if(fillColor){context.fill();}},drawRect:function(x,y,width,height,lineColor,fillColor){return this.drawShape([[x,y],[x+width,y],[x+width,y+height],[x,y+height],[x,y]],lineColor,fillColor);}});Ext.ux.Sparkline.pending=[];Ext.ux.Sparkline=Ext.extend(Ext.BoxComponent,{renderTo:null,type:'line',lineColor:'#00f',fillColor:'#cdf',width:'auto',height:16,composite:false,values:[],initComponent:function(){this.defaultPixelsPerValue=3;this.width='auto'==this.width?this.values.length*this.defaultPixelsPerValue:this.width;Ext.ux.Sparkline.superclass.initComponent.call(this);},onRender:function(){this.autoEl={cls:'x-ux-sparkline'};Ext.ux.Sparkline.superclass.onRender.apply(this,arguments);return this[this.type].call(this);},simpledraw:function(width,height,use_existing){if(use_existing&&this.el[0].vcanvas)return this.el[0].vcanvas;if(width==undefined)width=this.el.getWidth(true);if(height==undefined)height=this.el.getHeight(true);if(Ext.hasCanvas){return new vcanvas_canvas(width,height,this.el);}else if(Ext.isIE){return new vcanvas_vml(width,height,this.el);}else{return false;}},sparkline_display_visible:function(){for(var i=pending.length-1;i>=0;i--){var el=pending[i][0];debugger;if(Ext.fly(el).isVisible()){pending[i][1].call(el);pending.splice(i,1);}}},string:function(){this.el.dom.innerHTML='<span>'+this.values+'</span>';return this.el.dom.innerHTML;},line:function(){Ext.applyIf(this,{spotColor:'#f80',spotRadius:1.5,minSpotColor:'#f80',maxSpotColor:'#f80',lineWidth:2,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:'#ccc',chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined});var values=this.values;var xvalues=[],yvalues=[],yminmax=[];for(i=0;i<values.length;i++){var v=values[i];var isstr=typeof(values[i])=='string';var isarray=typeof(values[i])=='object'&&values[i]instanceof Array;var sp=isstr&&values[i].split(':');if(isstr&&sp.length==2){xvalues.push(Number(sp[0]));yvalues.push(Number(sp[1]));yminmax.push(Number(sp[1]));}else if(isarray){xvalues.push(values[i][0]);yvalues.push(values[i][1]);yminmax.push(values[i][1]);}else{xvalues.push(i);if(values[i]===null||values[i]=='null'){yvalues.push(null);}else{yvalues.push(Number(values[i]));yminmax.push(Number(values[i]));}}}
if(this.xvalues){xvalues=this.xvalues;}
var maxy=Math.max.apply(Math,yminmax);var maxyval=maxy;var miny=Math.min.apply(Math,yminmax);var minyval=miny;var maxx=Math.max.apply(Math,xvalues);var maxxval=maxx;var minx=Math.min.apply(Math,xvalues);var minxval=minx;if(this.normalRangeMin!=undefined){if(this.normalRangeMin<miny)
miny=this.normalRangeMin;if(this.normalRangeMax>maxy)
maxy=this.normalRangeMax;}
if(this.chartRangeMin!=undefined&&(this.chartRangeClip||this.chartRangeMin<miny)){miny=this.chartRangeMin;}
if(this.chartRangeMax!=undefined&&(this.chartRangeClip||this.chartRangeMax>maxy)){maxy=this.chartRangeMax;}
if(this.chartRangeMinX!=undefined&&(this.chartRangeClipX||this.chartRangeMinX<minx)){minx=this.chartRangeMinX;}
if(this.chartRangeMaxX!=undefined&&(this.chartRangeClipX||this.chartRangeMaxX>maxx)){maxx=this.chartRangeMaxX;}
var rangex=maxx-minx==0?1:maxx-minx;var rangey=maxy-miny==0?1:maxy-miny;var vl=yvalues.length-1;if(vl<1){this.innerHTML='';return;}
var target=this.simpledraw(this.width,this.height,this.composite);if(target){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;var canvas_top=0;var canvas_left=0;if(this.spotRadius&&(canvas_width<(this.spotRadius*4)||canvas_height<(this.spotRadius*4))){this.spotRadius=0;}
if(this.spotRadius){if(this.minSpotColor||(this.spotColor&&yvalues[vl]==miny))
canvas_height-=Math.ceil(this.spotRadius);if(this.maxSpotColor||(this.spotColor&&yvalues[vl]==maxy)){canvas_height-=Math.ceil(this.spotRadius);canvas_top+=Math.ceil(this.spotRadius);}
if(this.minSpotColor||this.maxSpotColor&&(yvalues[0]==miny||yvalues[0]==maxy)){canvas_left+=Math.ceil(this.spotRadius);canvas_width-=Math.ceil(this.spotRadius);}
if(this.spotColor||(this.minSpotColor||this.maxSpotColor&&(yvalues[vl]==miny||yvalues[vl]==maxy)))
canvas_width-=Math.ceil(this.spotRadius);}
canvas_height--;if(this.normalRangeMin!=undefined){var ytop=canvas_top+Math.round(canvas_height-(canvas_height*((this.normalRangeMax-miny)/rangey)));var height=Math.round((canvas_height*(this.normalRangeMax-this.normalRangeMin))/rangey);target.drawRect(canvas_left,ytop,canvas_width,height,undefined,this.normalRangeColor);}
var path=[];var paths=[path];for(var i=0,vlen=yvalues.length;i<vlen;i++){var x=xvalues[i],y=yvalues[i];if(y===null){if(i){if(yvalues[i-1]!==null){path=[];paths.push(path);}}}else{if(y<miny)y=miny;if(y>maxy)y=maxy;if(!path.length){path.push([canvas_left+Math.round((x-minx)*(canvas_width/rangex)),canvas_top+canvas_height]);}
path.push([canvas_left+Math.round((x-minx)*(canvas_width/rangex)),canvas_top+Math.round(canvas_height-(canvas_height*((y-miny)/rangey)))]);}}
for(var i=0,plen=paths.length;i<plen;i++){path=paths[i];if(!path.length)
continue;if(this.fillColor){path.push([path[path.length-1][0],canvas_top+canvas_height-1]);target.drawShape(path,undefined,this.fillColor);path.pop();}
if(path.length>2){path[0]=[path[0][0],path[1][1]];}
target.drawShape(path,this.lineColor,undefined,this.lineWidth);}
if(this.spotRadius&&this.spotColor){target.drawCircle(canvas_left+Math.round(xvalues[xvalues.length-1]*(canvas_width/rangex)),canvas_top+Math.round(canvas_height-(canvas_height*((yvalues[vl]-miny)/rangey))),this.spotRadius,undefined,this.spotColor);}
if(maxy!=minyval){if(this.spotRadius&&this.minSpotColor){var x=xvalues[yvalues.indexOf(minyval)];target.drawCircle(canvas_left+Math.round((x-minx)*(canvas_width/rangex)),canvas_top+Math.round(canvas_height-(canvas_height*((minyval-miny)/rangey))),this.spotRadius,undefined,this.minSpotColor);}
if(this.spotRadius&&this.maxSpotColor){var x=xvalues[yvalues.indexOf(maxyval)];target.drawCircle(canvas_left+Math.round((x-minx)*(canvas_width/rangex)),canvas_top+Math.round(canvas_height-(canvas_height*((maxyval-miny)/rangey))),this.spotRadius,undefined,this.maxSpotColor);}}}else{this.el.dom.innerHTML='';}
return this.el.dom.innerHTML;},discrete:function(){Ext.applyIf(this,{lineHeight:'auto',thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false});var values=this.values;var width=this.width=='auto'?values.length*2:this.width;var interval=Math.floor(width/values.length);var target=this.simpledraw(width,this.height,this.composite);if(target){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;var line_height=this.lineHeight=='auto'?Math.round(canvas_height*0.3):this.lineHeight;var pheight=canvas_height-line_height;var min=Math.min.apply(Math,values);var max=Math.max.apply(Math,values);if(this.chartRangeMin!=undefined&&(this.chartRangeClip||this.chartRangeMin<min)){min=this.chartRangeMin;}
if(this.chartRangeMax!=undefined&&(this.chartRangeClip||this.chartRangeMax>max)){max=this.chartRangeMax;}
var range=max-min;for(var i=0,vlen=values.length;i<vlen;i++){var val=values[i];if(val<min)val=min;if(val>max)val=max;var x=(i*interval);var ytop=Math.round(pheight-pheight*((val-min)/range));target.drawLine(x,ytop,x,ytop+line_height,(this.thresholdColor&&val<this.thresholdValue)?this.thresholdColor:this.lineColor);}}else{this.innerHTML='';}},bar:function(){Ext.applyIf(this,{type:'bar',barColor:'#00f',negBarColor:'#f44',zeroColor:undefined,nullColor:undefined,zeroAxis:undefined,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,colorMap:undefined});var values=this.values;var width=(values.length*this.barWidth)+((values.length-1)*this.barSpacing);var num_values=[];for(var i=0,vlen=values.length;i<vlen;i++){if(values[i]=='null'||values[i]===null){values[i]=null;}else{values[i]=Number(values[i]);num_values.push(Number(values[i]));}}
var max=Math.max.apply(Math,num_values);var min=Math.min.apply(Math,num_values);if(this.chartRangeMin!=undefined&&(this.chartRangeClip||this.chartRangeMin<min)){min=this.chartRangeMin;}
if(this.chartRangeMax!=undefined&&(this.chartRangeClip||this.chartRangeMax>max)){max=this.chartRangeMax;}
if(this.zeroAxis==undefined)this.zeroAxis=min<0;var range=max-min==0?1:max-min;if(Ext.isArray(this.colorMap)){var colorMapByIndex=this.colorMap;var colorMapByValue=null;}else{var colorMapByIndex=null;var colorMapByValue=this.colorMap;}
var target=this.simpledraw(this.width,this.height,this.composite);if(target){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;var yzero=min<0&&this.zeroAxis?canvas_height-Math.round(canvas_height*(Math.abs(min)/range))-1:canvas_height-1;for(var i=0,vlen=values.length;i<vlen;i++){var x=i*(this.barWidth+this.barSpacing);var val=values[i];if(val===null){if(this.nullColor){color=this.nullColor;val=(this.zeroAxis&&min<0)?0:min;var height=1;var y=(this.zeroAxis&&min<0)?yzero:canvas_height-height;}else{continue;}}else{if(val<min)val=min;if(val>max)val=max;var color=(val<0)?this.negBarColor:this.barColor;if(this.zeroAxis&&min<0){var height=Math.round(canvas_height*((Math.abs(val)/range)))+1;var y=(val<0)?yzero:yzero-height;}else{var height=Math.round(canvas_height*((val-min)/range))+1;var y=canvas_height-height;}
if(val==0&&this.zeroColor!=undefined){color=this.zeroColor;}
if(colorMapByValue&&colorMapByValue[val]){color=colorMapByValue[val];}else if(colorMapByIndex&&colorMapByIndex.length>i){color=colorMapByIndex[i];}
if(color===null){continue;}}
target.drawRect(x,y,this.barWidth-1,height-1,color,color);}}else{this.innerHTML='';}},bullet:function(){Ext.applyIf(this,{targetColor:'red',targetWidth:3,performanceColor:'blue',rangeColors:['#D3DAFE','#A8B6FF','#7F94FF'],base:undefined});var values=this.values;var width=this.width=='auto'?'4.0em':this.width;var height=this.height;var target=this.simpledraw(width,this.height,this.composite);if(target&&values.length>1){var canvas_width=target.pixel_width-Math.ceil(this.targetWidth/2);var canvas_height=target.pixel_height;var min=Math.min.apply(Math,values);var max=Math.max.apply(Math,values);if(this.base==undefined){var min=min<0?min:0;}else{min=this.base;}
var range=max-min;for(i=2,vlen=values.length;i<vlen;i++){var rangeval=parseInt(values[i]);var rangewidth=Math.round(canvas_width*((rangeval-min)/range));target.drawRect(0,0,rangewidth-1,canvas_height-1,this.rangeColors[i-2],this.rangeColors[i-2]);}
var perfval=parseInt(values[1]);var perfwidth=Math.round(canvas_width*((perfval-min)/range));target.drawRect(0,Math.round(canvas_height*0.3),perfwidth-1,Math.round(canvas_height*0.4)-1,this.performanceColor,this.performanceColor);var targetval=parseInt(values[0]);var x=Math.round(canvas_width*((targetval-min)/range)-(this.targetWidth/2));var targettop=Math.round(canvas_height*0.10);var targetheight=canvas_height-(targettop*2);target.drawRect(x,targettop,this.targetWidth-1,targetheight-1,this.targetColor,this.targetColor);}else{this.innerHTML='';}},tristate:function(){Ext.applyIf(this,{barWidth:4,barSpacing:1,posBarColor:'#6f6',negBarColor:'#f44',zeroBarColor:'#999',colorMap:{}});var values=this.values;var width=(values.length*this.barWidth)+((values.length-1)*this.barSpacing);if(Ext.isArray(this.colorMap)){var colorMapByIndex=this.colorMap;var colorMapByValue=null;}else{var colorMapByIndex=null;var colorMapByValue=this.colorMap;}
var target=this.simpledraw(width,this.height,this.composite);if(target){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;var half_height=Math.round(canvas_height/2);for(var i=0,vlen=values.length;i<vlen;i++){var x=i*(this.barWidth+this.barSpacing);if(values[i]<0){var y=half_height;var height=half_height-1;var color=this.negBarColor;}else if(values[i]>0){var y=0;var height=half_height-1;var color=this.posBarColor;}else{var y=half_height-1;var height=2;var color=this.zeroBarColor;}
if(colorMapByValue&&colorMapByValue[values[i]]){color=colorMapByValue[values[i]];}else if(colorMapByIndex&&colorMapByIndex.length>i){color=colorMapByIndex[i];}
if(color===null){continue;}
target.drawRect(x,y,this.barWidth-1,height-1,color,color);}}else{this.innerHTML='';}},pie:function(){Ext.applyIf(this,{sliceColors:['#f00','#0f0','#00f']});var values=this.values;var width=this.width=='auto'?this.height:this.width;var target=this.simpledraw(width,this.height,this.composite);if(target&&values.length>1){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;var radius=Math.floor(Math.min(canvas_width,canvas_height)/2);var total=0;for(var i=0,vlen=values.length;i<vlen;i++)
total+=values[i];var next=0;if(this.offset){next+=(2*Math.PI)*(this.offset/360);}
var circle=2*Math.PI;for(var i=0,vlen=values.length;i<vlen;i++){var start=next;var end=next;if(total>0){end=next+(circle*(values[i]/total));}
target.drawPieSlice(radius,radius,radius,start,end,undefined,this.sliceColors[i%this.sliceColors.length]);next=end;}}},box:function(){Ext.applyIf(this,{raw:false,boxLineColor:'black',boxFillColor:'#cdf',whiskerColor:'black',outlierLineColor:'#333',outlierFillColor:'white',medianColor:'red',showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:'#4a2',chartRangeMax:undefined,chartRangeMin:undefined});var width=this.width=='auto'?'4.0em':this.width;var values=this.values;minvalue=this.chartRangeMin==undefined?Math.min.apply(Math,values):this.chartRangeMin;maxvalue=this.chartRangeMax==undefined?Math.max.apply(Math,values):this.chartRangeMax;var target=this.simpledraw(width,this.height,this.composite);if(target&&values.length>1){var canvas_width=target.pixel_width;var canvas_height=target.pixel_height;if(this.raw){if(this.showOutliers&&values.length>5){var loutlier=values[0],lwhisker=values[1],q1=values[2],q2=values[3],q3=values[4],rwhisker=values[5],routlier=values[6];}else{var lwhisker=values[0],q1=values[1],q2=values[2],q3=values[3],rwhisker=values[4];}}else{values.sort(function(a,b){return a-b;});var q1=quartile(values,1);var q2=quartile(values,2);var q3=quartile(values,3);var iqr=q3-q1;if(this.showOutliers){var lwhisker=undefined,rwhisker=undefined;for(var i=0,vlen=values.length;i<vlen;i++){if(lwhisker==undefined&&values[i]>q1-(iqr*this.outlierIQR))
lwhisker=values[i];if(values[i]<q3+(iqr*this.outlierIQR))
rwhisker=values[i];}
var loutlier=values[0];var routlier=values[values.length-1];}else{var lwhisker=values[0];var rwhisker=values[values.length-1];}}
var unitsize=canvas_width/(maxvalue-minvalue+1);var canvas_left=0;if(this.showOutliers){canvas_left=Math.ceil(this.spotRadius);canvas_width-=2*Math.ceil(this.spotRadius);var unitsize=canvas_width/(maxvalue-minvalue+1);if(loutlier<lwhisker)
target.drawCircle((loutlier-minvalue)*unitsize+canvas_left,canvas_height/2,this.spotRadius,this.outlierLineColor,this.outlierFillColor);if(routlier>rwhisker)
target.drawCircle((routlier-minvalue)*unitsize+canvas_left,canvas_height/2,this.spotRadius,this.outlierLineColor,this.outlierFillColor);}
target.drawRect(Math.round((q1-minvalue)*unitsize+canvas_left),Math.round(canvas_height*0.1),Math.round((q3-q1)*unitsize),Math.round(canvas_height*0.8),this.boxLineColor,this.boxFillColor);target.drawLine(Math.round((lwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height/2),Math.round((q1-minvalue)*unitsize+canvas_left),Math.round(canvas_height/2),this.lineColor);target.drawLine(Math.round((lwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height/4),Math.round((lwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height-canvas_height/4),this.whiskerColor);target.drawLine(Math.round((rwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height/2),Math.round((q3-minvalue)*unitsize+canvas_left),Math.round(canvas_height/2),this.lineColor);target.drawLine(Math.round((rwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height/4),Math.round((rwhisker-minvalue)*unitsize+canvas_left),Math.round(canvas_height-canvas_height/4),this.whiskerColor);target.drawLine(Math.round((q2-minvalue)*unitsize+canvas_left),Math.round(canvas_height*0.1),Math.round((q2-minvalue)*unitsize+canvas_left),Math.round(canvas_height*0.9),this.medianColor);if(this.target){var size=Math.ceil(this.spotRadius);target.drawLine(Math.round((this.target-minvalue)*unitsize+canvas_left),Math.round((canvas_height/2)-size),Math.round((this.target-minvalue)*unitsize+canvas_left),Math.round((canvas_height/2)+size),this.targetColor);target.drawLine(Math.round((this.target-minvalue)*unitsize+canvas_left-size),Math.round(canvas_height/2),Math.round((this.target-minvalue)*unitsize+canvas_left+size),Math.round(canvas_height/2),this.targetColor);}}else{this.innerHTML='';}}});Ext.reg('sparkline',Ext.ux.Sparkline);Ext.ux.Sparkline.GridPlugin=(function(){return{init:function(grid){var sparkRefresh=function(){var cm=this.getColumnModel();var cmlen=cm.getColumnCount();for(i=0;i<cmlen;i++){var col=cm.getColumnAt(i);if(cm.config[i].xtype=='sparklinecolumn'){var celllen=this.getStore().getTotalCount();for(j=0;j<celllen;j++){var cell=this.view.getCell(j,i);cell.innerHTML='';var cfg={};Ext.apply(cfg,this.store.getAt(j).data[col.dataIndex],{renderTo:cell,width:this.view.cm.getColumnWidth(i)});Ext.applyIf(cfg,cm.config[i].sparkline||{});new Ext.ux.Sparkline(cfg);}}}};grid.on('viewready',sparkRefresh,grid);grid.on('columnresize',sparkRefresh,grid);grid.getView().on('refresh',sparkRefresh,grid);}};});Ext.grid.SparklineColumn=Ext.extend(Ext.grid.Column,{constructor:function(cfg){Ext.grid.SparklineColumn.superclass.constructor.call(this,cfg);this.renderer=function(value,metaData,record,rowIndex,colIndex,store){return'&#160;';};}});Ext.grid.Column.types.sparklinecolumn=Ext.grid.SparklineColumn;
/* ========== ../mkt-ext-2.0/widgets/LayoutCanvas.js ============ */

Mkt.widget.LayoutCanvas=Ext.extend(Ext.Panel,{layout:'column',autoScroll:true,cls:'mktLayout x-layout',defaultType:'layoutcolumn',defaultPortletType:'formlayoutitem',margins:'0 20 5 20',height:310,border:false,autoScroll:true,emptyCanvasText:'Drop fields from the right',emptyCls:'emptyLayoutCanvas',baseCls:'layoutCanvas',bodyStyle:'overflow-x: hidden;',storeUrl:'/leadDatabase/saveLayout',baseParams:{},columnCount:0,initComponent:function(){Mkt.widget.LayoutCanvas.superclass.initComponent.call(this);this.addEvents({validatedrop:true,validatedragover:true,beforedragover:true,dragover:true,beforedrop:true,containerover:true,containerdrop:true,drop:true});this.on('render',function(){var itemCount=0;this.items.each(function(item,index,length){var count=(item.items?item.items.getCount():0);if(count>0){this.removeEmptyMask();itemCount+=count;}
if(itemCount<=0){this.addEmptyMask();}},this);},this);var m=Ext.menu.MenuMgr.get('layoutItemMenu');if(m){m.destroy();}},initEvents:function(){Mkt.widget.LayoutCanvas.superclass.initEvents.call(this);this.dd=new Mkt.widget.LayoutCanvas.LayoutDropZone(this,Ext.apply(this.dropConfig));},destroy:function(){Ext.dd.ScrollManager.unregister(this.body);Ext.dd.ScrollManager.unregister(this.bwrap);Mkt.widget.LayoutCanvas.superclass.destroy.call(this);},insertLayoutItem:function(columnIndex,index,portletConfig){var col=this.getComponent(columnIndex);if(col){var item=col.insert(index,Ext.ComponentMgr.create(portletConfig,this.defaultPortletType));var xtra=portletConfig.xtra
this.saveLayout({updateType:'insert',attribMapFieldId:xtra.attribMapFieldId,attribId:xtra.attribId,posX:columnIndex,posY:index},item.id);this.removeEmptyMask();this.doLayout();}},saveLayout:function(params,itemId){if(!this.layoutDesigner){this.layoutDesignder=this.ownerCt.ownerCt;}
this.layoutDesignder.updateSaveAt('Saving...');MktSession.ajaxRequest(this.storeUrl,{serializeParms:Ext.applyIf(params,this.baseParams||{}),onMySuccess:this.saveLayoutDone.createDelegate(this,[itemId])})},saveLayoutDone:function(itemId){if(!this.layoutDesigner){this.layoutDesignder=this.ownerCt.ownerCt;}
this.layoutDesignder.updateSaveAt(MktPage.appVars.updatedAt);var result=MktPage.appVars.result;if(isDefined(result)&&!result){if(MktPage.appVars.errMsg){MktMessage.showError(MktPage.appVars.errMsg);delete MktPage.appVars.errMsg;}else if(MktPage.appVars.warnMsg){MktMessage.showWarning(MktPage.appVars.warnMsg);delete MktPage.appVars.warnMsg;}
delete MktPage.appVars.result;var layoutItem=this.findById(itemId);if(layoutItem){layoutItem.ownerCt.remove(itemId,true);}}},removeLayoutItem:function(layoutItemId){var layoutItem=Ext.getCmp(layoutItemId);var attribMapFieldId=layoutItem.xtra.attribMapFieldId;if(layoutItem){layoutItem.ownerCt.remove(layoutItemId,true);this.saveLayout({updateType:'remove',attribMapFieldId:attribMapFieldId});if(this.isCanvasEmpty()){this.addEmptyMask();}}},isCanvasEmpty:function(){var isCanvasEmpty=true;var items=Ext.getCmp(this.id).items;items.each(function(item,index,length){if(item.items&&item.items.getCount()>0){isCanvasEmpty=false;}},this);return isCanvasEmpty;},addEmptyMask:function(){if(!this.emptyMask){this.addClass(this.emptyCls);this.emptyMask=Ext.DomHelper.append(this.body,{id:'layouCanvasEmptyMask',tag:'div'},true);Ext.DomHelper.append(this.emptyMask,{tag:'div',id:'layoutCanvasEmptyLeft',html:this.emptyCanvasText});Ext.DomHelper.append(this.emptyMask,{tag:'div',id:'layoutCanvasEmptyRight',html:this.emptyCanvasText});this.addClass(this.emptyCls);}},removeEmptyMask:function(){if(this.emptyMask){this.emptyMask.remove();this.removeClass(this.emptyCls);delete this.emptyMask;}},getLayoutItemContextMenu:function(){var m=Ext.menu.MenuMgr.get('layoutItemMenu');return m||new MktMenu({id:'layoutItemMenu',cls:'mktMenu',items:[{text:'Edit',iconCls:'mkiEdit',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}.createDelegate(this)},{text:'Delete',iconCls:'mkiDelete',handler:function(el){el.parentMenu.hide(true);this.removeLayoutItem(el.parentMenu.xtra.layoutItemId);}.createDelegate(this)}]});},setHeight:function(height){Mkt.widget.LayoutCanvas.superclass.setHeight.apply(this,arguments);}});Ext.reg('layoutcanvas',Mkt.widget.LayoutCanvas);
/* ========== ../mkt-ext-2.0/widgets/LayoutItem.js ============ */

Mkt.widget.LayoutItem=Ext.extend(Ext.Panel,{anchor:'100%',frame:true,collapsible:true,draggable:{ddGroup:'layoutDesigner'},cls:'x-layout',header:false});Ext.reg('layoutitem',Mkt.widget.LayoutItem);Mkt.widget.FormLayoutItem=function(config){if(config.xtra){this.xtra=config.xtra;}
Mkt.widget.FormLayoutItem.superclass.constructor.call(this,config);};Ext.extend(Mkt.widget.FormLayoutItem,Ext.form.FormPanel,{anchor:'100%',frame:true,defaultType:'textfield',collapsible:true,draggable:{ddGroup:'layoutDesigner'},style:'border: 1px solid transparent;',cls:'x-layoutitem',labelAlign:'right',labelWidth:70,header:false,style:'padding: 0px 0px 5px 0px;',initComponent:function(){Mkt.widget.FormLayoutItem.superclass.initComponent.call(this);this.on('render',function(){this.getEl().on('contextmenu',function(e){var cm=Ext.getCmp(this.id);var layoutCanvas=cm.ownerCt.ownerCt;var menu=layoutCanvas.getLayoutItemContextMenu();menu.xtra={layoutItemId:cm.id}
if(menu){menu.showAt(e.xy);e.stopEvent();}});});}});Ext.reg('formlayoutitem',Mkt.widget.FormLayoutItem);
/* ========== ../mkt-ext-2.0/widgets/LayoutColumn.js ============ */

Mkt.widget.LayoutColumn=Ext.extend(Ext.Container,{layout:'anchor',autoEl:'div',style:'padding: 0px 0px 0px 10px;',columnWidth:.49,defaultType:'formlayoutitem',cls:'mktLayoutColumn',initComponent:function(){Mkt.widget.LayoutColumn.superclass.initComponent.call(this);},add:function(items){if(items){Mkt.widget.LayoutColumn.superclass.add.apply(this,arguments);}}});Ext.reg('layoutcolumn',Mkt.widget.LayoutColumn);
/* ========== ../mkt-ext-2.0/widgets/LayoutDropZone.js ============ */

Ext.ns('Mkt.widget.LayoutCanvas');Mkt.widget.LayoutCanvas.LayoutDropZone=function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);Mkt.widget.LayoutCanvas.LayoutDropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig;};Ext.extend(Mkt.widget.LayoutCanvas.LayoutDropZone,Ext.dd.DropTarget,{ddGroup:'layoutDesigner',ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed};},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid();}
var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw;}else if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid();}
var col=0,xs=this.grid.columnX,cmatch=false;for(var len=xs.length;col<len;col++){if(xy[0]<(xs[col].x+xs[col].w)){cmatch=true;break;}}
if(!cmatch){col--;}
var p,match=false,pos=0,c=portal.items.itemAt(col),items=c.items.items;for(var len=items.length;pos<len;pos++){p=items[pos];var h=p.el.getHeight();if(h!==0&&(p.el.getY()+(h/2))>xy[1]){match=true;break;}}
var overEvent=this.createEvent(dd,e,data,col,c,match&&p?pos:c.items.getCount());if(portal.fireEvent('validatedrop',overEvent)!==false&&portal.fireEvent('beforedragover',overEvent)!==false){if(px.getProxy&&px.moveProxy){px.getProxy().setWidth('auto');if(p){px.moveProxy(p.el.dom.parentNode,match?p.el.dom:null);}else{px.moveProxy(c.el.dom,null);}}
this.lastPos={c:c,col:col,p:match&&p?pos:false};this.scrollPos=portal.body.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status;}else{return overEvent.status;}},notifyOut:function(){delete this.grid;},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return;}
var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p;var dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&&this.portal.fireEvent('beforedrop',dropEvent)!==false){this.portal.fireEvent('beforedrop',dropEvent);if(data.node){var name=data.node.text;this.portal.insertLayoutItem(dropEvent.columnIndex,dropEvent.position,{labelWidth:120,labelAlign:'right',defaults:{width:80},xtra:{attribMapFieldId:data.node.attributes.id,attribId:data.node.attributes.aid},items:[{fieldLabel:name,name:name,readOnly:true,editable:false}]});}else{if(dd.proxy.getProxy){dd.proxy.getProxy().remove();}
dd.panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(pos!==false){c.insert(pos,dd.panel);}else{c.add(dd.panel);}
c.doLayout();this.portal.saveLayout({updateType:'move',attribId:data.panel.xtra.attribId,attribMapFieldId:data.panel.xtra.attribMapFieldId,id:data.panel.id,posX:dropEvent.columnIndex,posY:dropEvent.position});}
this.portal.fireEvent('drop',dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st;},10);}}
delete this.lastPos;return true;},notifyEnter:function(dd,e,data){},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth()});});return box;}});
/* ========== mktLeadDb.js ============ */

Ext.namespace("MktLeadDb","MktLeadDb.imp","MktLeadDb.ActivityTypes","MktLeadDb.RunAction");MktLeadDb.ActivityTypes.AddToList=24;MktLeadDb.ActivityTypes.ChangeDataValue=13;MktLeadDb.ActivityTypes.ChangeLeadPartition=100;MktLeadDb.ActivityTypes.ChangeRevenueStage=101;MktLeadDb.ActivityTypes.ChangeStatusInProgression=104;MktLeadDb.ActivityTypes.ChangeFieldInProgram=105;MktLeadDb.ActivityTypes.ChangeScore=22;MktLeadDb.ActivityTypes.DeleteLead=37;MktLeadDb.ActivityTypes.EnrichWithJigsaw=106;MktLeadDb.ActivityTypes.InterestingMoment=46;MktLeadDb.ActivityTypes.RemoveFromFlow=18;MktLeadDb.ActivityTypes.RemoveFromList=25;MktLeadDb.ActivityTypes.RequestCampaign=47;MktLeadDb.ActivityTypes.SendAlert=38;MktLeadDb.ActivityTypes.SendEmail=6;MktLeadDb.ActivityTypes.ChangeOwner=23;MktLeadDb.ActivityTypes.ConvertLead=21;MktLeadDb.ActivityTypes.CreateTask=20;MktLeadDb.ActivityTypes.DeleteLeadFromSFDC=29;MktLeadDb.ActivityTypes.SyncLeadToSFDC=19;MktLeadDb.ActivityTypes.AddToSFDCCampaign=42;MktLeadDb.ActivityTypes.RemoveFromSFDCCampaign=43;MktLeadDb.ActivityTypes.ChangeStatusInSFDCCampaign=44;MktLeadDb.RunAction.dialogWidth=800;MktLeadDb.RunAction.dialogHeight=400;MktLeadDb.colModelCacheKey="leadDb.ColumnModel";MktLeadDb.cachedListStatusValidCache='valid cache';MktLeadDb.Messages={runningInBackgroundMembership:'Working on Cached List... <a href="#" onclick="return false;" '+'id="viewAsyncLoadStatus{0}">View status</a>'+'<span><br /><br />To run normally,<br />you can <a href="#" onclick="return false;"'+'id="stopAsyncLoadBackground{0}"> '+'stop working on the Cached List</a></span>'};MktLeadDb.LeadListGridPanel=Ext.extend(MktGrids.CanvasGridPanel,{smListId:0,compType:null,compSubtype:null,beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading... ({0} leads)',autoscroll:false,enablePaging:true,pagingDisplayMsg:'{0}-{1} of {2}',pagingEmptyMsg:"No leads found",enableSearchPaging:true,searchEmptyText:'Quick Find...',searchQtip:'<div style="white-space: nowrap"><b>Search:</b> Name, Email, Job Title<br>'+'<b>Account Search:</b> [company] Acme Inc.</div>',selectedSingularText:'',selectedPluralText:'',recalculatingMsg:"Calculating...",allowSelectAll:true,reloadAfterLayoutSave:false,trackMouseOver:false,showSelectionCount:true,enableExport:true,exportText:undefined,exportTooltip:'Export this list',enableColumnPicker:true,columnPickerUrl:'leadDatabase/fieldsColumnPicker',columnPickerText:'Column Chooser',leadDetailsUrl:'/leadDatabase/loadLeadDetail?leadId=',cancelQuery:true,enableBackgroundLoad:true,backgroundLoadOptionDelay:10,backgroundLoadMsgPreamble:'Still Loading...',totalCountAsyncUrl:'leadDatabase/getSmartListCount',alwaysUpdateTotalCountAsync:false,enableTotalCountRefresh:true,enableTotalCountAsyncLoading:true,colModelCacheKey:MktLeadDb.colModelCacheKey,updateLayoutMetaUrl:'/leadDatabase/updateLayoutMeta',initComponent:function(){this.dataCols=new Array();this.viewCols=new Array();if(this.compType!='Smart List'){this.enableBackgroundLoad=false;}
this.layoutMetaParams={compId:this.smListId,compType:this.compType};this.loadColumnMeta();this.defaultSort=this.layoutMeta.sort.field;this.defaultOrder=this.layoutMeta.sort.order;var layoutCols=this.layoutMeta.cols;var colModel=this.colMeta.columnModel;var orderedCols=new Array();var hiddenCols=new Array();for(var i=0;i<colModel.length;i++){var header=colModel[i].header;var hidden=true;var type=null;var renderer=null;var dateFormat=null;var width=60;var position=null;var configField=null;for(var j=0;j<layoutCols.length;j++){if(layoutCols[j].field=="Id"){var pass;}
else if(colModel[i].dataIndex==layoutCols[j].field){configField=layoutCols[j];break;}}
if(configField){width=configField.width;hidden=false;position=j;}
switch(colModel[i].type){case'currency':renderer=Ext.util.Format.currencyRenderer;break;case'date':type='date';renderer=Ext.util.Format.dateRenderer('M d, Y');dateFormat='M d, Y';break;case'email':renderer=Mkt.util.Format.emailRenderer;break;case'float':renderer=Ext.util.Format.floatRenderer;break;case'url':renderer=Mkt.util.Format.urlRenderer;break;default:break;}
this.dataCols.push({name:colModel[i].dataIndex,type:type,dateFormat:dateFormat});var newColDefn={position:position,header:header,dataIndex:colModel[i].dataIndex,width:width,hidden:hidden,sortable:colModel[i].sortable,renderer:renderer||colModel[i].renderer};function renderLeadId(val,meta,record,rowIndex,colIndex,store){var url=MktSession.getUrlPrefix()+this.leadDetailsUrl+val;return'<a href="'+url+'" target="_blank" class="mktGridLink">'+val+'</a>';}
if(colModel[i].dataIndex=="Id"&&!colModel[i].systemHidden){newColDefn.hidden=false;newColDefn.renderer=renderLeadId.createDelegate(this);orderedCols.push(newColDefn);}
else if(!hidden){orderedCols.push(newColDefn);}
else{hiddenCols.push(newColDefn);}}
orderedCols.sort(function(a,b){if(a.position>b.position){return 1;}
else if(a.position<b.position){return-1;}
else{return 0;}});this.viewCols=orderedCols;if(isUndefined(this.ds)){url='leadDatabase/loadLeads/smListId/'+this.smListId+'/filterView/'+this.filterView;if(isDefined(this.subType)){url+="/subType/"+this.subType;}
if(isDefined(this.compSubtype)){url+="/compSubtype/"+this.compSubtype;}
this.ds=new Ext.data.Store({url:url,baseParams:{limit:this.pageSize},reader:new Ext.data.JsonReader({root:"data",totalProperty:'totalCount',id:"Id"},this.dataCols),remoteSort:true});}
this.on('rowdblclick',this.handleDblClick.createDelegate(this));this.on('columnmove',this.handleColumnMove.createDelegate(this));this.on('columnresize',this.handleColumnResize.createDelegate(this));this.on('sortchange',this.handleSortChange.createDelegate(this));this.cm=new Ext.grid.ColumnModel(this.viewCols);this.cm.on('hiddenchange',this.handleHiddenChange.createDelegate(this));this.viewConfig=Ext.applyIf(this.viewConfig||{},{enableColumnPicker:this.enableColumnPicker,columnPickerUrl:this.columnPickerUrl,columnPickerText:this.columnPickerText,columnPickerHandler:this.columnPickerHandler.createDelegate(this)});if(this.cacheInfoText){this.refreshHandler=MktLeadDb.invalidateAndLoadSmartlist.createDelegate(this,[this.smListId,this.canvas]);}
MktLeadDb.LeadListGridPanel.superclass.initComponent.call(this);if(this.enableBackgroundLoad){this.buildBackgroundLoadMsg();}
this.getStore().on('load',function(){this.highlightCacheText(function(){this.highlightCacheText(function(){var el=Ext.get(this.cacheInfoText.getEl());if(el&&!Ext.isIE8){el.applyStyles('background-color: transparent');}}.createDelegate(this));}.createDelegate(this));}.createDelegate(this));this.totalCountAsyncParams={smListId:this.smListId,compType:this.compType,compSubtype:this.compSubtype,totalCountPrecision:'estimate',filterView:this.filterView};},loadColumnMeta:function(){if(!this.columnMetaLoaded){this.columnMetaLoaded=true;if(this.layoutMeta&&this.colMeta&&this.colMeta.columnModel){Mkt.cache.CacheManager.set(this.colModelCacheKey,{layoutMeta:this.layoutMeta,colMeta:this.colMeta,colLayoutTimeKey:this.colLayoutTimeKey});}
else{var cachedColumnModel=Mkt.cache.CacheManager.getValue(this.colModelCacheKey);this.layoutMeta=cachedColumnModel.layoutMeta;this.colMeta=cachedColumnModel.colMeta;}}},highlightCacheText:function(callback){if(!Ext.isIE7&&this.cacheInfoText){var el=Ext.get(this.cacheInfoText.getEl());el.highlight("#FDF43F",{attr:'background-color',endColor:"#FFFFFF",easing:'easein',duration:1,callback:callback});}},buildBackgroundLoadMsg:function(){var aEx=new Ext.Element(document.createElement('a'));aEx.on('click',function(){MktSession.clockCursor();this.cancelGridLoad=true;MktLeadDb.forceLoadAsync(this.smListId,this.smListName,this.canvas);}.createDelegate(this));aEx.applyStyles("cursor:pointer; text-decoration: underline;");var runBackgroundTxt=document.createTextNode('convert this Smart List into a Cached List');aEx.dom.appendChild(runBackgroundTxt);var dEx=new Ext.Element(document.createElement('span'));var longMsgString1=this.backgroundLoadMsgPreamble+"<br /><br />If it's helpful, you can<br />";var longMsgString2="<br /><br /><a href='/guide/displaySuccessContent?contentTag=ldbCacheList_learnMore' target='_blank'>Learn More</a>";var longMsg1=Ext.DomHelper.createDom({tag:'span',html:longMsgString1});var longMsg2=Ext.DomHelper.createDom({tag:'span',html:longMsgString2});dEx.dom.appendChild(longMsg1);dEx.dom.appendChild(aEx.dom);dEx.dom.appendChild(longMsg2);this.backgroundLoadMsg=dEx.dom;},exportHandler:function(){var grid=this.gridOwner;MktLeadDb.exportList(this.getEl().dom,grid.smListId,grid.compType,grid.compSubtype,grid.smListName,grid.canvas,undefined,undefined,!Ext.isEmpty(grid.cacheInfoText));},refreshTotalHandler:function(){if(this.totalCountAsyncParams){if(this.totalCountAsyncInitiated){this.totalCountAsyncParams.totalCountPrecision='exact';}
else{this.totalCountAsyncInitiated=true;}}
MktLeadDb.LeadListGridPanel.superclass.refreshTotalHandler.apply(this,arguments);},columnPickerHandler:function(el){if(this.enableColumnPicker){var params=this.layoutMetaParams||{};var mp=new MktModalForm({url:this.columnPickerUrl,ajopts:{serializeParms:params},title:'Column Chooser',iconCls:'x-cols-icon',okButtonTitle:'Ok',width:638,height:400});mp.show(el.getEl(),this.columnPickerHandlerSubmit.createDelegate(this));el.parentMenu.hide(true);}},columnPickerHandlerSubmit:function(){var colLayout=[];var cm=this.getColumnModel();var columnPickerEl=Ext.getDom('fieldsColumnPickerContainer');if(!columnPickerEl){return;}
var checkedColumns=Ext.query('input:checked',columnPickerEl);if(!checkedColumns){return;}
var checkedCount=checkedColumns.length;for(var i=0;i<checkedCount;i++){var name=checkedColumns[i].name,width;var idx=cm.findColumnIndex(name);if(idx!=-1){width=cm.getColumnWidth(idx);}
colLayout.push({field:name,width:width});}
colLayout=Ext.encode(colLayout);MktSession.clockCursor();var params={cols:colLayout};if(this.layoutMetaParams){params=Ext.apply(params,this.layoutMetaParams);}
MktSession.ajaxRequest(this.updateLayoutMetaUrl,{serializeParms:params,onMySuccess:this.columnPickerHandlerDone.createDelegate(this)});},columnPickerHandlerDone:function(){MktSession.unclockCursor();MktSession.closeActiveModalForm();MktPage.clearPanelContentValid(MktPage.activePanel.cName);MktPage.activatePanel(MktPage.activePanel.cName);},handleColumnMove:function(oldIndex,newIndex){this.updateLayoutColsMeta();},handleColumnResize:function(columnIndex,newSize){this.updateLayoutColsMeta();},handleSortChange:function(grid,state){if(this.getView().sortState){var params={sort:state.field,dir:state.direction};if(this.layoutMetaParams){params=Ext.apply(params,this.layoutMetaParams);}
MktSession.ajaxRequest(this.updateLayoutMetaUrl,{serializeParms:params,onMySuccess:this.layoutMetaUpdated.createDelegate(this)});}},handleHiddenChange:function(columnModel,columnIndex,hidden){if(!hidden){this.reloadAfterLayoutSave=true;}
this.updateLayoutColsMeta();},layoutMetaUpdated:function(){if(this.reloadAfterLayoutSave){this.reload();this.reloadAfterLayoutSave=false;}},updateLayoutColsMeta:function(columnModel){var colConfig=this.getColumnModel().config;var visColList=Array();for(var i=0;i<colConfig.length;i++){var col=colConfig[i];if(!col.hidden){visColList.push({field:col.dataIndex,width:col.width});}}
var params={cols:Ext.encode(visColList)};if(this.layoutMetaParams){params=Ext.apply(params,this.layoutMetaParams);}
MktSession.ajaxRequest(this.updateLayoutMetaUrl,{serializeParms:params,onMySuccess:this.layoutMetaUpdated.createDelegate(this)});},handleDblClick:function(grid,rowIndex,e){window.open(MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+this.store.getAt(rowIndex).id,'_blank');},selectAllRows:function(el){this.getSelectionModel().selectAll();},selectNone:function(el){this.getSelectionModel().selectRange(-1,-1);},getSelectedMemberIds:function(){var memberIds=[];var items=this.getSelectionModel().getSelections();if(items.length>0){for(var i=0;i<items.length;i++){memberIds.push(items[i].id);}}
return memberIds;},getSelectedCount:function(){return this.getSelectionModel().getCount();},runActionHookMutex:{inAfterSaveHook:false},runActionSubmitSuccess:function(request,reqParams){MktSession.unclockCursor();delete this.runActionFlow;var win=new MktLeadDb.RunActionStatusWindow(Ext.apply({campaignId:MktPage.appVars.leadDbRunActionCampId,triggerId:MktPage.appVars.leadDbRunActionTrigId,actionName:MktPage.appVars.leadDbRunActionName,renderTo:Ext.getBody(),srcListId:reqParams.params.listId,srcSubType:reqParams.params.subType,srcCompSubtype:reqParams.params.compSubtype},MktPage.appVars.leadDbRunActionStatuses));win.show();},runActionSubmitFailure:function(request,reqParams){MktSession.unclockCursor();MktSession.closeActiveModalForm();delete this.runActionFlow;return false;},runActionModalAfterSaveHook:function(){if(this.runActionFlow.manager.saveQueue.blockingSaveInProgress){console.debug('mktLeadDb -> runActionModalAfterSaveHook aborting because save is in progress');return;}
if(!this.runActionHookMutex.inAfterSaveHook){this.runActionHookMutex.inAfterSaveHook=true;var error=null;var meta=MktPage.appVars.leadDbRunActionFlowMetas[0];var settings=meta[this.runActionFlow.SETTINGS];for(var i=0;i<settings.length&&!error;i++){var st=settings[i];if(st.options){for(var j=0;j<st.options.length;j++){if(st.options[j].error){error=st.options[j].error;break;}}}
else if(st.condition){if(st.condition.error){error=st.condition.error;break;}}}
if(error){var errMsg='Please fix error: '+error;var msgEl=Ext.get('runModalErrMsg');if(msgEl&&msgEl.dom.innerHTML.indexOf(errMsg)==-1){MktModalForm.setMessageError(errMsg);}
this.runActionModal.enableButton(0);this.runActionModal.enableButton(1);this.runActionClicked=false;MktSession.unclockCursor();}
else{MktModalForm.clearMessage();if(this.runActionClicked){this.runActionClicked=false;if(!this.sentRunAction){this.sentRunAction=true;MktSession.clockCursor(true);var listLeads=this.getSelectedMemberIds();var params={dataPanelMetas:Ext.util.JSON.encode(MktPage.appVars.leadDbRunActionFlowSerializedMetas),memberIds:Ext.util.JSON.encode(listLeads),query:this.query,subType:this.subType,compSubtype:this.compSubtype,listId:this.smListId,filterView:this.filterView};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;}
MktSession.ajaxRequest('/leadDatabase/runActionSubmit',{serializeParms:params,onMySuccess:this.runActionSubmitSuccess.createDelegate(this),onMyFailure:this.runActionSubmitFailure.createDelegate(this)});}}}
this.runActionHookMutex.inAfterSaveHook=false;}},strongModalConfirmation:function(e){var confirmConfig=MktLeadDb.getImpactConfirmConfig(this.activityType,this.memberCount);if(confirmConfig){this.runActionModal.dlg.hide(null);MktMessage.showStrongConfirm(confirmConfig,this.runActionModalRunClicked.createDelegate(this),this.strongModalCancel.createDelegate(this),e.buttons[0].getEl());}
else{this.runActionModalRunClicked(e);}},strongModalCancel:function(e){if(!this.runActionModal.dlg.isVisible()){this.runActionModal.dlg.show(null);}},runActionModalRunClicked:function(e){if(!this.runActionModal.dlg.isVisible()){this.runActionModal.dlg.show(null);}
this.runActionModal.disableButton(0);this.runActionModal.disableButton(1);MktSession.clockCursor(true);this.runActionClicked=true;this.runActionFlow.manager.save('Run action submit');},runActionModalShow:function(animEl,activityType,extraParams){var listLeads=this.getSelectedMemberIds();var listCount=this.getSelectedCount();if(!listLeads||listLeads.length===0){MktSession.showMessage("Please select at least one lead before running action");return;}
var params={activityType:activityType,memberIds:Ext.util.JSON.encode(listLeads),query:this.query,subType:this.subType,compSubtype:this.compSubtype,listId:this.smListId,filterView:this.filterView};if(extraParams){Ext.apply(params,extraParams);}
delete this.runActionFlow;this.runActionClicked=false;this.sentRunAction=false;this.activityType=activityType;this.memberCount=listCount;var mp=new MktModalForm({url:'/leadDatabase/runActionRequest',ajopts:{serializeParms:params},title:'Run Action',iconCls:'mkiMediaPlayGreen',okButtonTitle:'Run Now',clickRequired:true,cls:'mktModalForm-white',okButtonIconCls:'mkiMediaPlayGreen',width:MktLeadDb.RunAction.dialogWidth,height:MktLeadDb.RunAction.dialogHeight});this.runActionModal=mp;mp.show(animEl,this.strongModalConfirmation.createDelegate(this));},copyMembers:function(memberIds,destListId,successFunc){if(!memberIds||memberIds.length<1){return;}
MktSession.clockCursor(true);var params={memberIds:Ext.util.JSON.encode(memberIds),query:this.query,subType:this.subType,compSubtype:this.compSubtype,listId:this.smListId,filterView:this.filterView,destListId:destListId};var parms={serializeParms:params};if(isFunction(successFunc)){parms.onMySuccess=successFunc;}
MktSession.ajaxRequest('/leadDatabase/copyMembers',parms);},moveMembers:function(memberIds,destListId,successFunc){if(!memberIds||memberIds.length<1){return;}
MktSession.clockCursor(true);var params={memberIds:Ext.util.JSON.encode(memberIds),query:this.query,subType:this.subType,compSubtype:this.compSubtype,listId:this.smListId,filterView:this.filterView,destListId:destListId};var parms={serializeParms:params};if(isFunction(successFunc)){parms.onMySuccess=successFunc;}
MktSession.ajaxRequest('/leadDatabase/moveMembers',parms);},showConflictFieldsRequest:function(animEl){var sm=this.getSelectionModel();var numSelected=sm.getCount();if(numSelected<2){MktMessage.showError('Please choose at least 2 leads to merge.',undefined,animEl);return;}
else if(numSelected>10){MktMessage.showError("Please select 10 or fewer leads to merge.",undefined,animEl);return;}
var items=sm.getSelections();if(items.length==1&&items[0].id=='ALL'){items=sm.getVisibleSelections();}
var memberIds=[];for(var i=0;i<items.length;i++){memberIds.push(items[i].id);}
MktLeadDb.showConflictFields(memberIds,animEl);}});MktLeadDb.LeadFieldsGridPanel=Ext.extend(MktGrids.CanvasGridPanel,{defaultSort:'Name',reservedHeight:82,selectedSingularText:'lead',selectedPluralText:'leads',initComponent:function(){this.dataCols=new Array();this.viewCols=new Array();var columnModel=this.data.columnModel;for(var i=0;i<columnModel.length;i++){this.dataCols.push({name:columnModel[i].dataIndex});this.viewCols.push({dataIndex:columnModel[i].dataIndex,header:columnModel[i].header||columnModel[i].dataIndex,hidden:columnModel[i].hidden,width:columnModel[i].width,sortable:true});}
if(isUndefined(this.ds)){this.ds=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({root:"data",id:"Id"},this.dataCols),groupField:'Category'});}
this.view=new Ext.grid.GroupingView({hideGroupedColumn:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'});this.on('rowdblclick',this.handleDblClick);MktLeadDb.LeadFieldsGridPanel.superclass.initComponent.call(this);},handleDblClick:function(grid,rowIndex,e){}});MktLeadDb.driveCreateCustomFieldModal=function(animEl){var url='/leadDatabase/createCustomFieldRequest';if(isDefined(MktPage.appVars.dbObjectType)){url+='?dbObjectType='+MktPage.appVars.dbObjectType;}
var mf=new MktModalForm({url:url,title:'New Custom '+MktPage.appVars.dbObjectType+' Field',okButtonTitle:'Next >',width:610,height:410,checkRequired:true,requiredChecker:function(){if($('ldbStyleChoice').value.length===0){MktModalForm.clearMessage();MktModalForm.setMessageError('Please choose a field layout');return false;}
return true;}});var pickSmartListBackBtn=mf.addClientButton('< Back',MktLeadDb.createCustomFieldGoBackNameIt);mf.hideButton(pickSmartListBackBtn);var pickEmailBackBtn=mf.addClientButton('< Back',MktLeadDb.createCustomFieldGoBackPickSmartList);mf.hideButton(pickEmailBackBtn);mf.show(animEl,MktLeadDb.createCustomFieldValues.createDelegate(mf));};MktLeadDb.createCustomFieldValues=function(){MktModalForm.clearMessage();$('p.ldbValuesFormStyleChoice').value=$('ldbStyleChoice').value;var detailConfig={staticForm:'p.ldbCustomFieldValuesForm'};this.setButtonText(1,'Next >');this.showButton(2);this.hideButton(3);this.requiredChecker=function(){return true;};this.textAreaFocused=true;var doFn=MktLeadDb.createCustomFieldValidation.createDelegate(this);this.newContent(detailConfig,doFn);};MktLeadDb.createCustomFieldValidation=function(){MktModalForm.clearMessage();$('p.ldbValidFormStyleChoice').value=$('ldbValuesFormStyleChoice').value;$('p.ldbValidFormAllowUserValues').value=$('ldbAllowUserValues').value;$('p.ldbValidFormChoiceText').value=Ext.encode($('ldbChoiceText').value);var valueOptionRadios=$('ldbSubmitCustomFieldValuesForm').ldbValueOption;for(var i=0;i<valueOptionRadios.length;i++){if(valueOptionRadios[i].checked){$('p.ldbValidFormValueOption').value=valueOptionRadios[i].value;break;}}
var detailConfig={staticForm:'p.ldbCustomFieldValidationForm'};this.setButtonText(1,'Next');this.hideButton(2);this.showButton(3);this.requiredChecker=function(){return true;};var doFn=MktLeadDb.createCustomFieldPreview.createDelegate(this);this.newContent(detailConfig,doFn);var shownExtraSettings=Ext.get('ldbTextExtraSettings');Ext.get('ldbDataTypeDate').on({'click':{fn:function(el){if(shownExtraSettings){shownExtraSettings.enableDisplayMode().setVisible(false);}
shownExtraSettings=null;}}});Ext.get('ldbDataTypeNumber').on({'click':{fn:function(el){if(shownExtraSettings){shownExtraSettings.enableDisplayMode().setVisible(false);}
shownExtraSettings=Ext.get('ldbNumberExtraSettings');shownExtraSettings.enableDisplayMode().setVisible(true);}}});Ext.get('ldbDataTypeText').on({'click':{fn:function(el){if(shownExtraSettings){shownExtraSettings.enableDisplayMode().setVisible(false);}
shownExtraSettings=Ext.get('ldbTextExtraSettings');shownExtraSettings.enableDisplayMode().setVisible(true);}}});};MktLeadDb.getImpactConfirmConfig=function(actionType,count){var impactLevel=MktLeadDb.getImpactLevel(actionType);var impactTol=MktLeadDb.getImpactTolerance(impactLevel);if(!impactTol||count<=impactTol){return null;}
var config={count:count,showTextCount:true};switch(actionType){case MktLeadDb.ActivityTypes.DeleteLead:config.msg="Really?<br />This will <b>erase "+count+" leads</b> from the database, <span style='font-weight: bold; color: #C00000'>not just this list</span>.</b><br /><br />Just to make sure, please confirm:<br /><br /><div class='mktMessageIndent'>Number of leads to destroy: <span id='mktLeadCountWrap'></span><br /><span id='mktAgreeCbWrap'></span></div>";config.title="Delete Leads Confirmation";config.cboxLabel="<b>Cannot Undo</b>";config.showCheckbox=true;break;case MktLeadDb.ActivityTypes.ChangeDataValue:config.msg="You are trying to <b>Change Data Value for "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to change data for <span id='mktLeadCountWrap'></span> leads.";config.title="Change Data Value Confirmation";config.iconCls="mkiFormBlueEdit";config.bgCls="mki128FormBlueEdit";break;case MktLeadDb.ActivityTypes.ChangeScore:config.msg="You are trying to <b>Change Score for "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to change the score of <span id='mktLeadCountWrap'></span> leads.";config.title="Change Score Confirmation";config.iconCls="mkiStar2Yellow";config.bgCls="mki128Star2Yellow";break;case MktLeadDb.ActivityTypes.SendEmail:config.msg="You are trying to <b>Send Email to "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to send an email to <span id='mktLeadCountWrap'></span> leads.";config.title="Send Email Confirmation";config.iconCls="mkiMail2";config.bgCls="mki128Mail2";break;case MktLeadDb.ActivityTypes.RequestCampaign:config.msg="You are trying to <b>Request Campaign for "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to request a campaign for <span id='mktLeadCountWrap'></span> leads.";config.title="Request Campaign Confirmation";config.iconCls="mkiLightbulbOnPlay";config.bgCls="mki128LightbulbOnPlay";break;case MktLeadDb.ActivityTypes.SendAlert:config.msg="You are trying to <b>Send Alert to "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to send an alert to <span id='mktLeadCountWrap'></span> leads.";config.title="Send Alert Confirmation";config.iconCls="mkiBell2Gold";config.bgCls="mki128Bell2Gold";break;case MktLeadDb.ActivityTypes.ChangeOwner:config.msg="You are trying to <b>Change Owner for "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to change the owner of <span id='mktLeadCountWrap'></span> leads.";config.title="Change Owner Confirmation";config.iconCls="mkiUserInformation";config.bgCls="mki128UserInformation";break;case MktLeadDb.ActivityTypes.ConvertLead:config.msg="You are trying to <b>Convert Lead for "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to convert <span id='mktLeadCountWrap'></span> leads.";config.title="Convert Lead Confirmation";config.iconCls="mkiHandThumbUp";config.bgCls="mki128HandThumbUp";break;case MktLeadDb.ActivityTypes.SyncLeadToSFDC:config.msg="You are trying to <b>Sync "+count+" leads.</b><br /><br />Just to make sure you didn't select too many, please confirm:<br /><br />I want to sync <span id='mktLeadCountWrap'></span> leads to Salesforce.";config.title="Sync Confirmation";config.iconCls="mkiArrow2RightBlue";config.bgCls="mki128Arrow2RightBlue";break;default:return null;}
switch(impactLevel){case'high':config.iconCls="mkiDynamite";config.bgCls="mki128Dynamite";config.okBtnTxt="No Going Back";config.cancelBtnTxt="Back To Safety";break;case'med':config.okBtnTxt="Go For It";config.cancelBtnTxt="Cancel";break;default:config.iconCls="";config.bgCls="";break;}
return config;};MktLeadDb.getImpactLevel=function(actionType){switch(actionType){case MktLeadDb.ActivityTypes.DeleteLead:return'high';break;case MktLeadDb.ActivityTypes.ChangeDataValue:case MktLeadDb.ActivityTypes.ChangeScore:case MktLeadDb.ActivityTypes.SendEmail:case MktLeadDb.ActivityTypes.RequestCampaign:case MktLeadDb.ActivityTypes.SendAlert:case MktLeadDb.ActivityTypes.ChangeOwner:case MktLeadDb.ActivityTypes.ConvertLead:case MktLeadDb.ActivityTypes.SyncLeadToSFDC:return'med';break;default:return'low';}
return'low';};MktLeadDb.getImpactTolerance=function(impactType){switch(impactType){case'high':return 50;break;case'med':return 500;break;default:return null;}
return null;};MktLeadDb.createCustomFieldPreview=function(){MktModalForm.clearMessage();$('p.ldbPrevFormStyleChoice').value=$('ldbValidFormStyleChoice').value;$('p.ldbPrevFormAllowUserValues').value=$('ldbValidFormAllowUserValues').value;$('p.ldbPrevFormChoiceText').value=$('ldbValidFormChoiceText').value;$('p.ldbPrevFormValueOption').value=$('ldbValidFormValueOption').value;$('p.ldbPrevFormMinValue').value=$('ldbMinValue').value;$('p.ldbPrevFormMaxValue').value=$('ldbMaxValue').value;$('p.ldbPrevFormDecimals').value=$('ldbDecimals').value;$('p.ldbPrevFormMaxLen').value=$('ldbMaxLen').value;$('p.ldbPrevFormRegex').value=$('ldbRegex').value;var dataTypeRadios=$('ldbSubmitCustomFieldValidationForm').ldbDataType;for(var i=0;i<dataTypeRadios.length;i++){if(dataTypeRadios[i].checked){$('p.ldbPrevFormDataType').value=dataTypeRadios[i].value;break;}}
var detailConfig={staticForm:'p.ldbCustomFieldPreviewForm'};this.setButtonText(1,'Create');this.hideButton(2);this.showButton(3);this.requiredChecker=this.rfChecker;var doFn=MktLeadDb.driveCreateCustomField.createDelegate(this);this.newContent(detailConfig,doFn);var cb=new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',transform:'ldbFieldCat',forceSelection:false,blankText:'Optional category',value:''});cb.setValue('');};MktLeadDb.driveCreateCustomField=function(){Ext.MessageBox.show({title:'Please wait...',msg:'Creating custom field <b>'+$('ldbFieldLabel').value+'</b>',progress:true,width:300,closable:false});delete MktPage.appVars.submitError;MktSession.ajaxRequest('/leadDatabase/createCustomFieldSubmit',{serializeForm:'ldbSubmitCustomFieldPreviewForm',serializeParms:{objType:MktPage.appVars.dbObjectType},onMySuccess:MktLeadDb.customFieldCreated.createDelegate(this)});return false;};MktLeadDb.customFieldCreated=function(){if(!MktPage.appVars.submitError){MktSession.ajaxRequest('/leadDatabase/loadCustAdmin',{serializeParms:{panelId:MktPage.appVars.dbObjectType}});return true;}
return false;};MktLeadDb.createCustomFieldGoBackNameIt=function(mf){MktModalForm.clearMessage();var url='smartcampaigns/createEmailCampaignRequest';var addedProgId=false;if(isDefined(MktPage.appVars.programId)){url+='?programId='+MktPage.appVars.programId;addedProgId=true;}
if(isDefined(this.extension.leadDbSlId)){url+=(addedProgId?'&':'?')+'leadDbSlId='+this.extension.leadDbSlId;}
var detailConfig={url:url};this.setButtonText(1,'Next >');this.hideButton(2);this.hideButton(3);var doFn=MktLeadDb.createEmailPickSmartList;this.newContent(detailConfig,doFn);return false;};MktLeadDb.createCustomFieldGoBackPickSmartList=function(mf){MktModalForm.clearMessage();$('p.pslTEProgram').value=$('pemTEProgram').value;$('p.pslTEName').value=$('pemTEName').value;$('p.pslTEDescr').value=$('pemTEDescr').value;if($('pemSLOption').value=='picklater'){$('p.pslSLOptionPickLater').checked=true;$('p.pslSLOptionCopyExisting').checked=false;$('p.pslSLOptionRef').checked=false;}
else if($('pemSLOption').value=='copy'){$('p.pslSLOptionPickLater').checked=false;$('p.pslSLOptionCopyExisting').checked=true;$('p.pslSLOptionRef').checked=false;$('p.pslCopySl').value=$('pemCopySl').value;}
else{$('p.pslSLOptionPickLater').checked=false;$('p.pslSLOptionCopyExisting').checked=false;$('p.pslSLOptionRef').checked=true;$('p.pslRefSl').value=$('pemRefSl').value;}
var detailConfig={staticForm:'p.pslSubmitPickSmartListForm'};this.setButtonText(1,'Next >');this.showButton(2);this.hideButton(3);var doFn=MktLeadDb.createEmailPickEmail;this.newContent(detailConfig,doFn);};MktLeadDb.importList=function(el,accessZoneId,parentId,programId,programName,compType){var iconCls=MktMa.isProgramCompTypeFamily(compType)?'mkiUsers2Down':'mkiImport';var importModal=new Mkt.apps.listImport.Modal({parentId:parentId,iconCls:iconCls,programName:programName,compType:compType,programId:programId});importModal.show(el);};MktLeadDb.exportList=function(el,listId,compType,compSubtype,name,activeTab,programId,programName,hasCachedList){if(MktLeadDb.grid&&MktLeadDb.grid.smListId==listId){var store=MktLeadDb.grid.store;if(store){if(store.getCount()<=0){MktMessage.showWarning("No leads found for export",undefined,el);return;}}}
var iframe=Ext.get('exportListIframe');if(!iframe){var body=Ext.DomQuery.selectNode('body',document);Ext.DomHelper.append(body,'<iframe src="javascript:false" name="exportListIframe" id="exportListIframe" class="exportListIframe" style="display:none;"></iframe>');}
var membershipSelected='';var filterSelected='';if(listId==MktPage.appVars.leadDbSmartListId){if(activeTab=='ldbCanvasLeadList'){membershipSelected='SELECTED';}else{filterSelected='SELECTED';}}
var cachedListMarkup="";if(hasCachedList){cachedListMarkup='      <tr>'+'        <td class="mktForm2Label">Cached List:</td>'+'        <td class="mktForm2Field">'+'          <input name="ldbUseCachedList" id="ldbUseCachedList" '+'                 class="mktRadio" type="checkbox" title="Re-run Smart List"/>'+'          <label for="ldbUseCachedList">Re-run Smart List <span style="color:gray;">(slower, but more up to date)</span></label>'+'        </td>'+'      </tr>';}
var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div>'+'  <form action="/leadDatabase/exportList" method="post" enctype="multipart/form-data" name="exportListForm"  id="exportListForm" class="exportListForm" target="exportListIframe">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <input type="hidden" id="ldbExportListId" name="ldbExportListId" value="" />'+'      <input type="hidden" id="ldbExportCompType" name="ldbExportCompType" value="" />'+'      <input type="hidden" id="ldbExportCompSubtype" name="ldbExportCompSubtype" value="" />'+'      <tr>'+'        <td class="mktForm2Label">Export:</td>'+'        <td class="mktForm2Field">'+'          <input name="ldbExportListColumns" id="ldbExportListVisibleCols" '+'                 class="mktRadio" type="radio" title="Visible columns" checked="true" />'+'          <label for="ldbExportListVisibleCols">Visible columns <span style="color:gray;">(recommended)</span></label>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label"></td>'+'        <td class="mktForm2Field">'+'          <input name="ldbExportListColumns" id="ldbExportListAllCols" '+'                 class="mktRadio" type="radio" title="All columns" />'+'          <label for="ldbExportListAllCols">All columns</label>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Format:</td>'+'        <td class="mktForm2Field">'+'          <select name="ldbExportListFormat" id="ldbExportListFormat">'+'            <option value="TAB">Tab Delimited</option>'+'            <option value="CSV" SELECTED>Comma Separated Values</option>'+'            <option value="CSV_WIN2007" SELECTED>Comma Separated Values (Windows Excel 2007)</option>'+'            <!-- <option value="EXCEL">Excel Format</option> -->'+'          </select>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr id="ldbExportCampaignLeadsRow" style="display: none;">'+'        <td class="mktForm2Label">Leads Choice:</td>'+'        <td class="mktForm2Field">'+'          <select name="ldbExportCampaignLeadsChoice" id="ldbExportCampaignLeadsChoice">'+'            <option value="MEMBERSHIP" '+membershipSelected+'>Campaign Members</option>'+'            <option value="FILTERVIEW" '+filterSelected+'>Qualified Leads</option>'+'          </select>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+cachedListMarkup+'    </table>'+'  </form>'+'</div>'+'<div id="exportListResults" style="display:none;"></div>');},title:'Export List',iconCls:'mkiExport2',okButtonTitle:'Export',extension:{submitted:false},width:450,height:240});dialog.listId=listId;dialog.compType=compType;dialog.compSubtype=compSubtype;dialog.on('okclick',function(){var format=Ext.get('ldbExportListFormat').dom.value;var ldbExportCampaignLeadsChoice=Ext.get('ldbExportCampaignLeadsChoice').dom.value;var colExport='visible';if(Ext.get('ldbExportListAllCols').dom.checked){colExport='all';}
var useCachedList=false
var useCachedListEl=Ext.get('ldbUseCachedList');if(useCachedListEl&&!useCachedListEl.dom.checked){useCachedList=true;}
MktSession.closeActiveModalForm.defer(250);MktSession.ajaxRequest('/leadDatabase/exportListAsync',{serializeParms:{listId:listId,compType:compType,ldbExportCampaignLeadsChoice:ldbExportCampaignLeadsChoice,ldbExportCompSubtype:compSubtype,format:format,programId:programId,useCachedList:useCachedList,colExport:colExport},onMySuccess:function(){var isSmartlistMembership=(compSubtype=="campaign"&&ldbExportCampaignLeadsChoice=="MEMBERSHIP")?true:false;var result=MktPage.appVars.exportResult;if(result=="failed"){MktMessage.showWarning(MktPage.appVars.errMsg);}else if(result=="inprogress"){MktMessage.showQuestion("Export is already in progress for <b>"+(name?(name+"</b>"):(programName+'</b> members')),"View Status",function(){MktLeadDb.requestExportStatus(listId,name,compType,el,isSmartlistMembership,programId,programName);},undefined,"Close");}else if(result=="success"){MktLeadDb.requestExportStatus(listId,name,compType,el,isSmartlistMembership,programId,programName);}}.createDelegate(this)});},dialog,true);dialog.on('load',MktLeadDb.exportRequestLoaded,dialog,true);dialog.show(el,function(){});};MktLeadDb.prepareExportList=function(dialog){Ext.get('ldbExportListId').dom.value=dialog.listId;Ext.get('ldbExportCompType').dom.value=dialog.compType;Ext.get('ldbExportCompSubtype').dom.value=dialog.compSubtype;MktPage.preventNavAway(false);dialog.extension.form.submit();MktPage.preventNavAway(true);Ext.Msg.show({title:'Export List',msg:'Your download should begin momentarily. Please note<br />that it may take a while to export a big list.',buttons:Ext.Msg.OK,fn:function(btn,text){if(btn=='ok'){MktSession.closeActiveModalForm();}},animEl:dialog.buttons[1].getEl().dom,icon:Ext.MessageBox.QUESTION});};MktLeadDb.exportRequestLoaded=function(dialog){dialog.extension.form=$('exportListForm');if(dialog.compType=='Smart List'&&dialog.compSubtype=='campaign'){Ext.get('ldbExportCampaignLeadsRow').enableDisplayMode().setVisible(true);}};MktLeadDb.deleteList=function(listId){var parms={listId:listId};MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/deleteList',{serializeParms:parms,onMySuccess:MktLeadDb.deleteListDone.createDelegate({listId:listId})});};MktLeadDb.deleteListDone=function(){var result=MktPage.appVars.deleteListResult;if(result&&result=='success'){var impStatWin=Ext.WindowMgr.get('importStatusWindow'+this.listId);if(impStatWin){impStatWin.close();}
var expStatWin=Ext.WindowMgr.get('exportStatusWindow'+this.listId);if(expStatWin){expStatWin.close();}
if(this.listId&&this.listId==MktPage.appVars.leadDbSmartListId){var params={};if(MktPage.appVars.marketingProgramId){params.marketingProgramId=MktPage.appVars.marketingProgramId;delete MktPage.appVars.marketingProgramId;}
MktMainNav.loadLeadDb(params);}}else{MktMessage.showWarning(MktPage.appVars.deleteListErrMsg);delete MktPage.appVars.deleteListErrMsg;}
if(MktPage.appVars.deleteListResult){delete MktPage.appVars.deleteListResult;}};MktLeadDb.deleteSmartList=function(smartListId){var parms={smartListId:smartListId};MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/deleteSmartList',{serializeParms:parms,onMySuccess:MktLeadDb.deleteSmartListSuccess.createDelegate({smartListId:smartListId})});};MktLeadDb.deleteSmartListSuccess=function(){var result=MktPage.appVars.deleteSmartListResult;if(result&&result=='success'){var exportStatWin=Ext.WindowMgr.get('exportStatusWindow'+this.smartListId);if(exportStatWin){exportStatWin.close();}
if(this.smartListId&&this.smartListId==MktPage.appVars.leadDbSmartListId){var parms={}
if(MktPage.appVars.marketingProgramId){parms={marketingProgramId:MktPage.appVars.marketingProgramId}}
MktMainNav.loadLeadDb(parms);}}else if(result&&result=='busyLoading'){MktMessage.confirmStop("Cannot Delete Smart List",MktPage.appVars.deleteSmartListErrMsg,function(){MktSession.clockCursor(true);MktSession.ajaxRequest('leadDatabase/stopAsyncLoadLeads',{serializeParms:{listId:this.smartListId}});}.createDelegate(this),'mkiSignStop',undefined,'Stop Cached List','Close');}
else{var errMsg=MktPage.appVars.deleteSmartListErrMsg;MktMessage.showWarning(errMsg);delete MktPage.appVars.deleteSmartListErrMsg;}
if(MktPage.appVars.deleteSmartListResult){delete MktPage.appVars.deleteSmartListResult;}};MktLeadDb.ldbDriveCreateListModal=function(animEl,parentId,accessZoneId,cloneFromId,cloneFromName,marketingProgramId){if(cloneFromId&&marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId,accessZoneId:accessZoneId},onMySuccess:MktLeadDb.showCreateModal.createDelegate(this,[animEl,parentId,accessZoneId,cloneFromId,cloneFromName,marketingProgramId])});}
else{MktLeadDb.showCreateModal(animEl,parentId,accessZoneId,cloneFromId,cloneFromName,marketingProgramId);}};MktLeadDb.showCreateModal=function(animEl,parentId,accessZoneId,cloneFromId,cloneFromName,marketingProgramId){var cloneHtml="";var title='New List';if(cloneFromId){if(MktPage.appVars.marketingProgramName){cloneFromName=MktPage.appVars.marketingProgramName+"."+cloneFromName;}
var tabIndex=1;cloneHtml='      <tr class="mktRequired">'+'        <td class="mktForm2Label">Clone From:</td>'+'        <td class="mktForm2Field">'+cloneFromName+'          <input type="hidden" name="cloneFromId" id="cloneFromId" value= "'+cloneFromId+'"/>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'     <tr id="applicationRow" class="mktRequired">'+'       <td class="mktForm2Label">Clone To:</td>'+'       <td class="mktForm2Field" id="appPicker">'+'         <div class="message"></div>'+'       </td>'+'     </tr>';tabIndex+=2;title='Clone List';}
var canvas=MktCanvas.getActiveTab();var html='<div id="ldbCreateListForm">'+'  <form id="ldbCreateListSubmitForm" onsubmit="return false;">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+
cloneHtml+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">List Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" tabIndex="'+tabIndex+++'" id="ldbListName" name="ldbListName" value="" maxsize="240" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" id="ldbListDescr" name="ldbListDescr" tabIndex="'+tabIndex+++'" title="description" rows="4"></textarea>'+'          <input type="hidden" id="parentId" name="parentId" value="" />'+'          <input type="hidden" id="accessZoneId" name="accessZoneId" value="" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>';if(canvas.id=='cp_maLocalAssets'&&canvas.config&&canvas.config.compId==marketingProgramId){html+='    <tr>'+'      <td>&nbsp;</td>'+'      <td>'+'        <div style="float: left;" class="mktForm2Field">'+'          <input type="checkbox" checked="checked" tabIndex="'+tabIndex+++'" id="navigateToStaticList" name="navigateToStaticList" />'+'        </div>'+'        <div class="mktForm2Label">&nbsp;Go to List</div>'+'      </td>'+'    </tr>';}'    </table>'+'  </form>'+'</div>'
var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,html);},title:title,iconCls:'mkiIndex',okButtonTitle:cloneFromId?'Clone':'Create',width:550,height:cloneFromId?350:300});mp.extension={};if(marketingProgramId){mp.marketingProgramId=marketingProgramId;}
if(cloneFromId){mp.extension.cloneFromId=cloneFromId;}
mp.on('load',MktLeadDb.createFormLoaded,mp,true);mp.show(animEl,function(){var el;if(isDefined(parentId)){el=Ext.query('#parentId','ldbCreateListForm')[0];if(isDefined(el)){el.value=parentId;}}
if(isDefined(accessZoneId)){el=Ext.query('#accessZoneId','ldbCreateListForm')[0];if(isDefined(el)){el.value=accessZoneId;}}
var params={};if(marketingProgramId){params.marketingProgramId=marketingProgramId;}
if(mp.cloneToMarketingProgramId){params.cloneToMarketingProgramId=mp.cloneToMarketingProgramId;}
MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/createList',{serializeForm:'ldbCreateListSubmitForm',serializeParms:params});});};MktLeadDb.showProgramPicker=function(mp){var programPickerBox=Mkt.apps.localasset.ComboManager.cloneProgramPicker({});programPickerBox.on('select',function(combo,object){mp.cloneToMarketingProgramId=object.data.programId;});};MktLeadDb.showFolderPicker=function(mp){var folderPickerBox=Mkt.apps.localasset.ComboManager.cloneFolderPicker({compType:'list'});folderPickerBox.on('select',function(combo,object,index){getEl('parentId').dom.value=object.data.id;mp.extension.parentId=object.data.id;});};MktLeadDb.createFormLoaded=function(mp){var cloneFromId,parentId;if(mp.extension&&mp.extension.cloneFromId){cloneFromId=mp.extension.cloneFromId;}
if(mp.extension&&mp.extension.parentId){parentId=mp.extension.parentId;}
Mkt.apps.localasset.ComboManager.clearForm('all');if(cloneFromId){var dataStore=[[1,'Lead Database...']];if(MktPage.savedState.marketingProgramEnabled||MktPage.savedState.marketingEventEnabled){if(mp.marketingProgramId){dataStore.push([2,'A different Program...']);dataStore.push([3,'Same Program']);}
else{dataStore.push([2,'A Program...']);}}
var appPickerBox=Mkt.apps.localasset.ComboManager.applicationPicker({dataStore:dataStore,renderTo:'appPicker'});appPickerBox.el.dom.setAttribute('tabIndex',1);appPickerBox.focus();appPickerBox.on('select',function(combo,object,index){var wasProgramVisible=false,setProgramVisible=false;var wasFolderVisible=false,setFolderVisible=false;if(Ext.getCmp('cloneToProgramPicker')&&Ext.getCmp('cloneToProgramPicker').isVisible()){wasProgramVisible=true;}
if(Ext.getCmp('cloneToFolderPicker')&&Ext.getCmp('cloneToFolderPicker').isVisible()){wasFolderVisible=true;}
if(object.data&&object.data.value==2){setProgramVisible=true;}
else if(object.data&&object.data.value==1){setFolderVisible=true;}
if(setProgramVisible&&!wasProgramVisible){MktLeadDb.showProgramPicker(mp);parentId="";}
else if(setFolderVisible&&!wasFolderVisible){MktLeadDb.showFolderPicker(mp);parentId=mp.extension.parentId;mp.cloneToMarketingProgramId="";}
if(Ext.getCmp('cloneToProgramPicker')&&!setProgramVisible){Mkt.apps.localasset.ComboManager.clearForm('program');}
if(Ext.getCmp('cloneToFolderPicker')&&!setFolderVisible){Mkt.apps.localasset.ComboManager.clearForm('folder');}
if(object.data&&object.data.value==3){mp.cloneToMarketingProgramId=mp.marketingProgramId;}});var fParentEl=Ext.getDom('parentId');if(isDefined(fParentEl)&&hasValue(parentId)){fParentEl.value=parentId;}}};MktLeadDb.addToSuppressionList=function(){var sm=MktLeadDb.grid.getSelectionModel();var store=MktLeadDb.grid.store;var items=sm.getSelections();if(items.length>0){var memberIds=[];for(var i=0;i<items.length;i++){memberIds.push(items[i].id);}
memberIds.listId=MktPage.appVars.leadDbSmartListId;MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/addToSuppressionList',{serializeParms:memberIds});}else{alert("Select an item from the list first");}};MktLeadDb.ldbCreateLeadModal=function(animEl,compType,listId){var parms={compType:compType,listId:listId,accessZoneId:MktCanvas.getActiveTab().config.accessZoneId};var mp=new MktModalForm({url:'/leadDatabase/createLeadRequest',ajopts:{serializeParms:parms},title:'New Lead',iconCls:'mkiUser',okButtonTitle:'Create',width:460,height:300});mp.show(animEl,function(){MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/createLead',{serializeForm:'ldbCreateLeadSubmitForm'});});};MktLeadDb.MktLeadMergeGrid=function(config){Ext.apply(this,config);MktLeadDb.MktLeadMergeGrid.superclass.constructor.call(this);};Ext.extend(MktLeadDb.MktLeadMergeGrid,MktGrids.CheckGridPanel,{maskCanvas:false,loadMask:false,maskPurpleCornersDuringLoad:false,initComponent:function(){MktLeadDb.MktLeadMergeGrid.superclass.initComponent.call(this);},getCheckedFields:function(){var fields={};var store=this.getStore();var count=store.getCount();var checked={};var missingRows=[];for(var i=0;i<count;i++){var record=store.getAt(i);if(record.json['readonly']){continue;}
var fieldName=record.data['__FieldName__'];for(var data in record.data){if(record.data[data+"Checked"]===true){var value=record.data[data];if(record.data['__FieldIsReference__']&&isObject(value)){for(var key in value){value=key;break;}}
checked[fieldName]=value;}}
if(typeof checked[fieldName]=="undefined"){missingRows.push(i);}}
fields.checked=checked;fields.missingRows=missingRows;return fields;}});MktLeadDb.showConflictFields=function(listLeads,animEl){var result=MktPage.appVars.result;var leadCount=MktPage.appVars.leadCount;var mergeFields=MktPage.appVars.mergeFields;var systemFieldName="__FieldName__";MktLeadDb.merge=MktLeadDb.merge||{};if(result===false){MktMessage.showWarning("Failed getting the data for this conflict fields.",undefined,animEl);return;}
var columnModel=[{id:"FieldName",header:"Field Name",text:"Field Name",sortable:false,menuDisabled:true,dataIndex:'__FieldDispName__',width:180}];var recordFields=[{name:systemFieldName,type:"string"}];for(var i=0;i<listLeads.length;i++){columnModel.push({type:"CheckBColumn",id:"Lead_"+(i+1),text:"Lead "+(i+1),dataIndex:"Lead"+(i+1)});recordFields.push({name:"Lead"+(i+1),type:"auto"});}
recordFields.push({name:"Custom",type:"auto"});recordFields.push({name:'__FieldDispName__',type:"string"});recordFields.push({name:'__FieldIsReference__',type:"boolean"});var conflictFields=Ext.data.Record.create(recordFields);var url="leadMerge/getConflictFields?leadIds="+Ext.util.JSON.encode(listLeads);var store=new Ext.data.Store({url:url,reader:new Ext.data.JsonReader({root:'data'},conflictFields)});function getField(column,colIndex,rowIndex){var store=column.grid.getStore();var rec=store.getAt(rowIndex);var dataType=rec.json["__FieldDataType__"];var uiRenderer=rec.json["__FieldUiRenderer__"];var fieldName=rec.json["__FieldName__"];var aid=rec.json["__AttributeId__"];return Mkt.widgets.Field.getField.call(Mkt.widgets.Field,{uiRender:uiRenderer,type:dataType,name:fieldName,aid:aid,isReadOnly:false},160,Ext.emptyFn);}
columnModel.push({type:"CheckBColumn",id:"Custom",text:"Custom",editable:true,editorCallback:getField,dataIndex:"Custom"});var grid=MktLeadDb.merge.grid=new MktLeadDb.MktLeadMergeGrid({cls:'mktMergeGrid',enableHdMenu:false,store:store,width:700,height:400,minWidth:600,minHeight:300,columnModel:columnModel,anchor:"100% 84%"});store.on('beforeload',function(){MktSession.clockCursor(true);Mkt.widgets.CanvasMask.mask(grid,undefined,'mktCanvasMaskActivity',true);}.createDelegate(grid));store.on("load",function(records,options){var json=MktLeadDb.merge.grid.getStore().reader.jsonData;grid.fireEvent("headerclick",grid,json.latestLeadColumn,undefined);var cm=grid.getColumnModel();for(var key in json.leadMeta){var col=cm.getColumnById(key);if(col){col.setText(json.leadMeta[key]);}}
var numMergeLeadsEl=Ext.get('numMergeLeads');if(numMergeLeadsEl){numMergeLeadsEl.update(json.totalLeadsCountDisp);}
var numMergeConflictFields=Ext.get('numMergeConflictFields');if(numMergeConflictFields){numMergeConflictFields.update(json.totalConflictFieldsCountDisp);}
Mkt.widgets.CanvasMask.unmask(grid);MktSession.clockCursor(false);});store.on('loadexception',function(){MktSession.clockCursor(false);Mkt.widgets.CanvasMask.unmask(grid);});var header='<div class="modalHeader"><span id="numMergeLeads">0</span> Leads selected to merge.</div>';header+='<div class="modalHeader">Conflicts have been found for <span id="numMergeConflictFields">0</span> fields.</div>';header+='<div class="modalHeader"><div style="float: left;">Choose the values to keep.</div>';header+='<div style="float:right; padding-right: 7px; font-weight: normal;"><a href="/guide/displaySuccessContent?contentTag=ldbLeadMerge_learnMore" target="_blank">Learn more</a></div></div>';var window=MktLeadDb.merge.window=new Ext.Window({title:'Merge Leads',iconCls:'mkiRefresh',width:845,height:450,minWidth:400,minHeight:250,layout:'anchor',plain:false,border:false,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',items:[{html:header,baseCls:"mkt-modal-text-body",anchor:"100% 16%"},grid],buttons:[{text:'Merge',iconCls:'mkiRefresh',handler:function(button,event){button.setDisabled(true);MktSession.clockCursor(true);var checkedFields=grid.getCheckedFields();MktSession.ajaxRequest('/leadMerge/mergeLeadsSubmit',{serializeParms:{leadIds:Ext.util.JSON.encode(listLeads),fields:MktSession.encodeURIComponent(Ext.util.JSON.encode(checkedFields.checked)),mergeFields:MktSession.encodeURIComponent(Ext.util.JSON.encode(mergeFields)),listType:MktLeadDb.grid.compType,listId:MktLeadDb.grid.smListId},onMySuccess:MktLeadDb.showConflictFieldsDone.createDelegate(button)});}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){window.close();}}]});grid.on('render',function(){store.load();});window.show(Ext.getDom(animEl));if(isDefined(result)){delete MktPage.appVars.result;}
if(isDefined(MktPage.appVars.leadMergeGridMeta)){delete MktPage.appVars.leadMergeGridMeta;}};MktLeadDb.showConflictFieldsDone=function(){var result=MktPage.appVars.result;if(isDefined(result)){if(result=="success"){if(MktLeadDb.merge&&MktLeadDb.merge.window){MktLeadDb.merge.window.close();delete MktLeadDb.merge;}
MktLeadDb.grid.reload();}else{var errMsg=MktPage.appVars.errMsg;MktMessage.showError("Failed merging fields"+(errMsg?': '+errMsg:'')+'.');delete MktPage.appVars.errMsg;this.setDisabled(false);}
delete MktPage.appVars.result;}};MktLeadDb.requestImportStatus=function(listId,el,compType){var parms={compType:compType};if(MktMa.isProgramCompTypeFamily(compType)){parms.programId=listId;}
else{parms.listId=listId;}
MktSession.ajaxRequest('/leadDatabase/getImportStatus',{serializeParms:parms,onMySuccess:function(){var statuses=MktPage.appVars.importStatuses;if(isDefined(statuses)&&hasValue(statuses.status)){MktLeadDb.showImportStatusWindow(statuses,el,compType);}else{var msg='';if(MktMa.isProgramCompTypeFamily(compType)){var firstTab=MktCanvas.getFirstTab();if(firstTab){msg='<b>'+firstTab.config.title+'</b> does not have any import history';}
else{msg='This '+(compType=='Marketing Event'?'event':'program')+' does not have any import history';}}
else{msg='The list <b>'+statuses.name+'</b> does not have any import history';}
MktMessage.showInfo(msg,undefined,el);}}});};MktLeadDb.showImportStatusWindow=function(statuses,animEl,compType){statuses=statuses||{};if(hasValue(animEl)){statuses.animEl=animEl;}
var impStatWin=Ext.WindowMgr.get('importStatusWindow'+(hasValue(statuses.listId)?statuses.listId:statuses.importedListId));if(impStatWin){impStatWin.renderStatus(statuses);}else{impStatWin=new MktLeadDb.ImportStatusWindow(Ext.apply({compType:compType,renderTo:Ext.getBody()},statuses));}
impStatWin.show();};MktLeadDb.getFailureFile=function(listId){var form=Ext.get('downloadFailedRowsForm'+listId);if(form){if(MktPage.isProd()){MktPage.preventNavAway(false);}
form.dom.submit();if(MktPage.isProd()){MktPage.preventNavAway(true);}}};MktLeadDb.getIgnoredFile=function(listId){var form=Ext.get('downloadIgnoredRowsForm'+listId);if(form){if(MktPage.isProd()){MktPage.preventNavAway(false);}
form.dom.submit();if(MktPage.isProd()){MktPage.preventNavAway(true);}}};MktLeadDb.stopImport=function(listId,el){MktMessage.confirmDelete('Import List','Are you sure you want to stop the import?',function(btn,text){MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/stopImport',{serializeParms:{listId:listId}});},el,'Stop');};MktLeadDb.sendImportAlertRequest=function(listId,emails){return new Mkt.apps.listImport.SendAlert().setupImportSendAlert(listId,emails,Ext.getDom('sendImportAlert'+listId));};MktLeadDb.FloatingStatusWindow=Ext.extend(Ext.Window,{height:77,width:260,minHeight:37,minWidth:260,cls:'floatingStatusWin',title:"Status",collapsible:true,ctype:'MktLeadDb.FloatingStatusWindow',supportEmailAddress:'support@marketo.com',contactSupportMsg:'Contact Marketo customer support',alignTopRight:true,expandOnShow:true,closable:true,pollStatus:true,pollInterval:1000,refreshGrid:false,executingImage:'/images/ajax/spinner-purps-16.gif',completedImage:'/images/icons32/check.png',failedImage:'/images/icons24/data_forbidden.png',afterRender:function(){MktLeadDb.FloatingStatusWindow.superclass.afterRender.call(this);this.renderStatus();if(this.alignTopRight){this.alignTo(document.body,'tr',[(this.width+14)*-1,10]);}
if(this.pollStatus){this.startPollStatus();}
this.updateTitleStatus();},buildTitleStatus:function(){return this.status;},updateTitleStatus:function(){this.setTitle(this.buildTitleStatus());},initComponent:function(){if(this.contentEl){var content=Ext.get(this.contentEl);if(content&&!content.isVisible()){content.setVisible(true);}}
MktLeadDb.FloatingStatusWindow.superclass.initComponent.call(this);},initEvents:function(){MktLeadDb.FloatingStatusWindow.superclass.initEvents.call(this);this.on('show',function(){var el=this.getEl();if(el){el.disableShadow();el.slideIn('t',{duration:2,callback:function(){this.on('beforeclose',function(){this.stopPollingStatus();});el.enableShadow(true);}.createDelegate(this)});}
this.expand(true);});},show:function(){MktLeadDb.FloatingStatusWindow.superclass.show.apply(this,arguments);if(this.expandOnShow){this.expand(true);}},setStatus:function(status){this.status=status;},getStatus:function(){},startPollStatus:function(){if(isUndefined(this.pollId)){this.pollId=setInterval(this.getStatus.createDelegate(this),this.pollInterval);}},stopPollingStatus:function(){clearInterval(this.pollId);delete this.pollId;},bodyStyle:"overflow: hidden; padding-left: 5px; padding-top: 3px;"});MktLeadDb.ImportStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Import Status",ctype:'MktLeadDb.ImportStatusWindow',pollInterval:5000,height:102,width:290,statusFailed:'Failed',statusComplete:'Complete',statusCanceled:'Canceled',pluralLeadText:'leads',singularLeadText:'lead',refreshGrid:true,reloadTabFinish:true,tabId:'ldbCanvasLeadList',initComponent:function(){this.setStatuses(this);this.id='importStatusWindow'+this.listId;MktLeadDb.ImportStatusWindow.superclass.initComponent.call(this);},setListId:function(id){this.listId=id;},setRemainingLeads:function(nLeads){this.remainingLeads=nLeads;},setEstimatedTime:function(sec){this.estimatedTime=sec;},setFailedRowsCount:function(nFailed){this.failedRows=nFailed;},setStatuses:function(statuses){if(hasValue(statuses.estimated_rows)){this.remainingLeads=statuses.estimated_rows;}else{delete this.remainingLeads;}
if(hasValue(statuses.estimated_time)){this.estimatedTime=statuses.estimated_time;}else{delete this.estimatedTime;}
if(hasValue(statuses.rows_failed)){this.failedRows=statuses.rows_failed;}else{delete this.failedRows;}
if(hasValue(statuses.rows_ignored)){this.ignoredRows=statuses.rows_ignored;}else{delete this.ignoredRows;}
if(hasValue(statuses.status)){this.status=this.postProcessStatus(statuses.status);}else{delete this.status;}
if(hasValue(statuses.rows_imported)){this.importedRows=statuses.rows_imported;}else{delete this.importedRows;}
if(hasValue(statuses.ended_at)){this.endedAt=statuses.ended_at;}else{delete this.endedAt;}
if(hasValue(statuses.alert_emails)){this.alertEmails=statuses.alert_emails;}else{delete this.alertEmails;}
if(hasValue(statuses.importedListId)){this.listId=statuses.importedListId;}
if(hasValue(statuses.importedListName)){this.listName=statuses.importedListName;}
if(hasValue(statuses.program_name)){this.programName=statuses.program_name;}
if(hasValue(statuses.program_id)){this.programId=statuses.program_id;}
if(hasValue(statuses.list_subtype)){this.listSubtype=statuses.listSubtype;}},buildTitleStatus:function(){var title="";if(this.isStatusFailed()){title='<span class="mktFailed">'+this.status+' Import</span>';}else{if(hasValue(this.status)){title=this.status+' ';}
if(hasValue(this.programName)){title+=this.programName+" Members";}
else if(hasValue(this.listName)){title+=this.listName;}}
return title;},getPluralizeLeadText:function(leadCount){if(leadCount>1){return this.pluralLeadText;}else{return this.singularLeadText;}},isStatusFailed:function(){return this.status==this.statusFailed;},renderStatus:function(statuses){if(isUndefined(this.listId)){return;}
if(statuses&&statuses.importedListId&&statuses.importedListId!=this.listId){return;}
if(statuses){this.setStatuses(statuses);}
var buff='<div style="float:left; padding-top: 4px;">';var completed=(this.status==this.statusComplete);var canceled=(this.status==this.statusCanceled);var failed=this.isStatusFailed();if(!completed&&!canceled&&!failed){var hasRunningStatus=false;if(hasValue(this.remainingLeads)){buff=buff+'Pending Import: '+Mkt.util.Format.makeBigNumberPretty(this.remainingLeads)+' '+this.getPluralizeLeadText(this.remainingLeads)+'<br />';hasRunningStatus=true;}
if(hasValue(this.estimatedTime)){buff=buff+'Est. Time: '+this.makeMilitaryTimeLeft(this.estimatedTime)+'<br />';hasRunningStatus=true;}
if(!hasRunningStatus){buff+='Processing...<br />';}
if(hasValue(this.status)){buff=buff+'<div style="position:absolute; right:14px; bottom: 10px;">Status: '+this.status+'</div>';}
var sendAlertText;if(this.alertEmails){sendAlertText="Edit Send Notification";}
else{sendAlertText="Send Notification";}
var alertEmails=this.alertEmails||'';buff=buff+'<div style="margin-top: 5px;position: absolute; bottom: 10px;"><div style="float: left;"><img src="/images/icons16/mail2.png" /></div><div style="float: left; margin-left: 4px;"><a href="#" id="sendImportAlert'+
this.listId+'" onclick="MktLeadDb.sendImportAlertRequest('+this.listId+', \''+alertEmails+'\');return false;">'+sendAlertText+'</a></div></div></br>';}
if(failed){var importedRows=this.importedRows||0;var importedRowsMsg="";if(importedRows<1){importedRowsMsg="Critical Error: No leads were imported";}else{importedRowsMsg="Critical Error: Import aborted after "+importedRows+" "+this.getPluralizeLeadText(importedRows);}
buff=buff+importedRowsMsg;}
if(!canceled){var showImage24=completed||failed;var imageSrc=this.executingImage;if(completed){imageSrc=this.completedImage;}else if(failed){imageSrc=this.failedImage;}
buff=buff+'</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px;'+' margin-top: 4px; margin-bottom:2px; width:'+(showImage24?'24':'16')+'px; height:'+(showImage24?'24':'16')+'px;" '+'src=\"'+imageSrc+'\" />';if(!completed&&!failed){buff=buff+'<br /><a href="#" id="stopImportList'+this.listId+'" style="cursor:pointer;" onclick="MktLeadDb.stopImport('+this.listId+', \'stopImportList'+this.listId+'\'); return false;">Stop</a>';}
buff+="</div>";}
if((completed||canceled)&&!failed){buff=buff+'<div style="float:left; width: 210px;">'+(completed?"Import Completed ":"Cancelled ")+
(hasValue(this.endedAt)?this.endedAt:"")+"</div>";}
if(hasValue(this.failedRows)&&(completed||failed)&&this.failedRows>0){buff=buff+'<br /><div style="float:left;">Not Accessible:&nbsp;<a id="aImpFailedRow" href="#" onclick="MktLeadDb.getFailureFile('+
this.listId+'); return false;">'+this.failedRows+' '+this.getPluralizeLeadText(this.failedRows)+'</a></div>';buff=buff+'<form action="/leadDatabase/downloadRows?listId='+this.listId+'&rowType=failed" method="post" enctype="multipart/form-data" name="downloadFailedRowsForm'+
this.listId+'" id="downloadFailedRowsForm'+this.listId+'" class="downloadFailedRowsForm'+this.listId+'" target="downloadFailedRowsIframe'+this.listId+'"><input type="hidden" name="xsrfId" value="'+MktSecurity.getXsrfId()+'"/></form>';buff=buff+'<iframe src="javascript:false" name="downloadFailedRowsIframe'+this.listId+'" id="downloadFailedRowsIframe'+this.listId+'" class="downloadFailedRowsIframe'+
this.listId+'" style="display:none;"></iframe>';}
if(hasValue(this.ignoredRows)&&(completed||failed)&&this.ignoredRows>0){buff=buff+'<br /><div style="float:left;">Skipped:&nbsp;<a id="aImpIgnoredRow" href="#" onclick="MktLeadDb.getIgnoredFile('+
this.listId+'); return false;">'+this.ignoredRows+' '+this.getPluralizeLeadText(this.ignoredRows)+'</a></div>';buff=buff+'<form action="/leadDatabase/downloadRows?listId='+this.listId+'&rowType=ignored" method="post" enctype="multipart/form-data" name="downloadIgnoredRowsForm'+
this.listId+'" id="downloadIgnoredRowsForm'+this.listId+'" class="downloadIgnoredRowsForm'+this.listId+'" target="downloadIgnoredRowsIframe'+this.listId+'"><input type="hidden" name="xsrfId" value="'+MktSecurity.getXsrfId()+'"/></form> ';buff=buff+'<iframe src="javascript:false" name="downloadIgnoredRowsIframe'+this.listId+'" id="downloadIgnoredRowsIframe'+this.listId+'" class="downloadIgnoredRowsIframe'+
this.listId+'" style="display:none;"></iframe>';}
if(failed){buff=buff+'<div style="float:left; width: 190px;"><a href="mailto:'+
this.supportEmailAddress+'">'+this.contactSupportMsg+'</a></div>';}
buff+="</div>";this.body.dom.innerHTML=buff;if(this.reloadTabFinish&&isDefined(statuses)&&(completed||canceled||failed)){var tabId;if(this.isOnList(statuses)){tabId=this.tabId;MktPage.clearPanelContentValid(tabId);MktPage.activatePanel(tabId);}
else if(this.isOnProgram()){tabId='maMembers';var activeTab=MktCanvas.getActiveTab();if(activeTab.config.id==tabId){var grid=this.getProgramGrid();if(grid){grid.reload();}}
else{MktPage.clearPanelContentValid(tabId);}
Mkt.apps.marketingEvent.reloadStore(activeTab.config.compId);}}
this.updateTitleStatus();},isOnList:function(statuses){return MktPage.appVars.leadDbSmartListId==statuses.importedListId&&MktPage.appVars.leadDbCompType=="List";},isOnProgram:function(){var firstTab=MktCanvas.getFirstTab();if(firstTab){if((firstTab.config.compId*1)==(this.programId*1)&&(MktMa.isProgramCompTypeFamily(firstTab.config.compType))){return true;}}
return false;},getProgramGrid:function(){var membersTab=MktCanvas.getTab('maMembers');if(membersTab){return membersTab.getGridPanel();}},getStatus:function(){var parms={compType:this.compType};if(MktMa.isProgramCompTypeFamily(this.compType)){parms.programId=this.programId;}
else{parms.listId=this.listId;}
MktSession.ajaxRequest('/leadDatabase/getImportStatus',{serializeParms:parms,onMySuccess:function(){this.leadDbGrid=MktLeadDb.grid;var importStatuses=MktPage.appVars.importStatuses;this.renderStatus(importStatuses);if(hasValue(importStatuses)&&(this.status=="Complete"||this.status=="Failed"||this.status=="Canceled")){this.stopPollingStatus(this.pollId);}}.createDelegate(this)});},postProcessStatus:function(status){switch(status){case"Out of Memory":case"Requeued":case"Post-Processing":status="Importing";break;default:break;}
return status;},makeMilitaryTimeLeft:function(time){var secs=Math.floor(time%60);var mins=Math.floor((time/60)%60);var hrs=Math.floor((time/60/60)%24);var days=Math.floor(time/60/60/24);var buff="";if(days){buff=buff+(days>9?" ":"0 ")+days;}
if(hrs){buff=buff+(hrs>9?"":"0")+hrs+":";}
if(mins){buff=buff+(mins>9?"":"0")+mins+":";}
if(hasValue(secs)){buff=buff+(secs>9?"":"0")+secs;}
return buff;},makeTimeLeftPretty:function(time){var secs=Math.floor(time%60);var mins=Math.floor((time/60)%60);var hrs=Math.floor((time/60/60)%24);var days=Math.floor(time/60/60/24);var buff="";if(days){buff=buff+days+" day"+(days>1?"s ":" ");}
if(hrs){buff=buff+hrs+" hour"+(hrs>1?"s ":" ");}
if(mins){buff=buff+mins+" minute"+(mins>1?"s ":" ");}
if(secs){buff=buff+secs+" second"+(mins>1?"s ":" ");}
return buff;}});MktLeadDb.RunActionStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Run Action Status",ctype:'MktLeadDb.RunActionStatusWindow',height:100,pollInterval:10000,refreshGrid:true,initComponent:function(){this.setStatuses(this);this.id='runActionStatusWindow'+this.campaignId;MktLeadDb.RunActionStatusWindow.superclass.initComponent.call(this);},setCompletedLeads:function(nLeads){this.completedLeads=nLeads;},setStatuses:function(statuses){if(hasValue(statuses.completed_leads)){this.completedLeads=statuses.completed_leads;}else{delete this.completedLeads;}
if(hasValue(statuses.status)){this.status=statuses.status;}else{delete this.status;}
if(hasValue(statuses.started_at)){this.startedAt=statuses.started_at;}else{delete this.startedAt;}
if(hasValue(statuses.ended_at)){this.endedAt=statuses.ended_at;}else{delete this.endedAt;}},buildTitleStatus:function(){var title="";if(hasValue(this.status)){title=this.status+' ';}
title+="Single Flow Action";return title;},renderStatus:function(statuses){if(statuses){this.setStatuses(statuses);}
var buff='<div style="float:left; width:188px;">';var queued=(this.status=="Queued");var running=(this.status=="Running");var completed=(this.status=="Complete"||this.status=="Failed"||this.status=="Shutdown");if(hasValue(this.status)&&!completed){buff=buff+'Status: '+this.postProcessStatus(this.status)+'<br />';}
if(hasValue(this.completedLeads)&&running){buff=buff+'Leads processed: '+this.completedLeads+'<br />';}
if(!queued){buff=buff+'</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px; margin-top: 4px; margin-bottom:2px; width:'+(completed?'24':'16')+'px; height:'+(completed?'24':'16')+'px;" '+'src=\"'+(!completed?this.executingImage:this.completedImage)+'\" />';buff+="</div>";}
if(completed){buff=buff+"Completed "+(hasValue(this.endedAt)?this.endedAt:"");buff=buff+'<div>Leads processed: '+this.completedLeads+'</div>';buff=buff+'<br /><a href="#" style="cursor:pointer;" onclick="MktDlManager.loadDl({type:\'MA\', compSubtype:\'smartcampaign\', panelId: \'campaignCanvasDetailActivityLog\', smartCampaignId: '+this.campaignId+', nodeId: 0'+'});">View Results</a>';if(this.refreshGrid&&(MktPage.activePanel.cName=="ldbCanvasLeadList"||MktPage.activePanel.cName=="ldbCanvasFilterView")&&MktPage.appVars.leadDbSmartListId==this.srcListId&&MktPage.appVars.leadDbSubType==this.srcSubType&&MktPage.appVars.leadDbCompSubtype==this.srcCompSubtype){MktLeadDb.grid.reload();}}
this.body.dom.innerHTML=buff;this.updateTitleStatus();},getStatus:function(){MktSession.ajaxRequest('/leadDatabase/getRunActionStatus',{serializeParms:{campaignId:this.campaignId,triggerId:this.triggerId},onMySuccess:function(){var runStatuses=MktPage.appVars.leadDbRunActionStatuses;this.renderStatus(runStatuses);if(hasValue(runStatuses)&&(runStatuses.status=="Complete"||runStatuses.status=="Failed"||runStatuses.status=="Shutdown")){this.stopPollingStatus(this.pollId);}}.createDelegate(this)});},postProcessStatus:function(status){switch(status){case"Failed":case"Shutdown":status="Complete";break;case"Queued":case"Running":case"Complete":default:break;}
return status;}});MktLeadDb.requestExportStatus=function(listId,listName,compType,el,isMembershipSmartlist,programId,programName){MktSession.ajaxRequest('/leadDatabase/getExportStatus',{serializeParms:{listId:listId,programId:programId,isMembershipSmartlist:isMembershipSmartlist,compType:compType},onMySuccess:function(){var statuses=MktPage.appVars.exportStatuses;var result=MktPage.appVars.exportResult;var errMsgTmpl=MktPage.appVars.exportErrMsgTmpl;if(hasValue(result)&&result){MktLeadDb.showExportStatusWindow(statuses,compType,listId,el,programId,programName);}else{var tmpl=new Ext.Template(errMsgTmpl);var errMsg=tmpl.apply({name:listName,compType:Ext.util.Format.lowercase(compType)});MktMessage.showInfo(errMsg,undefined,el);}}});};MktLeadDb.showExportStatusWindow=function(statuses,compType,listId,animEl,programId,programName){statuses=statuses||{};if(programId){statuses.programId=programId;}
if(programName){statuses.programName=programName;}
if(hasValue(animEl)){statuses.animEl=animEl;}
listId=(hasValue(listId)?listId:statuses.listId);var exportStatWin=Ext.WindowMgr.get('exportStatusWindow'+listId);if(exportStatWin){exportStatWin.renderStatus(statuses);exportStatWin.startPollStatus();}else{exportStatWin=new MktLeadDb.ExportStatusWindow(Ext.apply({renderTo:Ext.getBody(),listId:listId,programId:programId,compType:compType},statuses));}
exportStatWin.show();};MktLeadDb.stopExport=function(exportId,el){MktMessage.confirmDelete('Export List','Are you sure you want to stop the export?',function(btn,text){MktSession.clockCursor(true);MktSession.ajaxRequest('/leadDatabase/stopExport',{serializeParms:{exportId:exportId}});},el,'Stop');};MktLeadDb.getExportedFile=function(listId){var form=Ext.get('downloadExportedLeadsForm'+listId);if(form){if(MktPage.isProd()){MktPage.preventNavAway(false);}
form.dom.submit();if(MktPage.isProd()){MktPage.preventNavAway(true);}}};MktLeadDb.ExportStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Export Status",pollInterval:10000,width:290,height:80,minWidth:260,initComponent:function(){this.setStatuses(this);this.id='exportStatusWindow'+this.listId;MktLeadDb.ExportStatusWindow.superclass.initComponent.call(this);},setListId:function(id){this.listId=id;},setRemainingLeads:function(nLeads){this.remainingLeads=nLeads;},setEstimatedTime:function(sec){this.estimatedTime=sec;},setFailedRowsCount:function(nFailed){this.failedRows=nFailed;},setStatuses:function(statuses){if(hasValue(statuses.estimated_rows)){this.remainingLeads=statuses.estimated_rows;}else{delete this.remainingLeads;}
if(hasValue(statuses.estimated_time)){this.estimatedTime=statuses.estimated_time;}else{delete this.estimatedTime;}
if(hasValue(statuses.rows_failed)){this.failedRows=statuses.rows_failed;}else{delete this.failedRows;}
if(hasValue(statuses.rows_exported)){this.exportedRows=statuses.rows_exported;}else{delete this.exportedRows;}
if(hasValue(statuses.status)){this.status=this.postProcessStatus(statuses.status);}else{delete this.status;}
if(hasValue(statuses.ended_at)){this.endedAt=statuses.ended_at;}else{delete this.endedAt;}
if(hasValue(statuses.exportedListId)){this.listId=statuses.exportedListId;}
if(hasValue(statuses.name)){this.listName=statuses.name;}
if(hasValue(statuses.exportId)){this.exportId=statuses.exportId;}
if(hasValue(statuses.program_id)){this.programId=statuses.program_id;}
if(hasValue(statuses.program_name)){this.programName=statuses.program_name;}},buildTitleStatus:function(){var title="";if(hasValue(this.status)){title=this.status+' ';}
if(hasValue(this.programName)){title+=this.programName+' Members';}
else if(hasValue(this.listName)){title+=this.listName;}
return title;},renderStatus:function(statuses){if(isUndefined(this.listId)){return;}
if(statuses&&statuses.exportedListId&&statuses.exportedListId!=this.listId){return;}
if(statuses){this.setStatuses(statuses);}
var buff='<div style="float:left;">';var completed=(this.status=="Complete");var canceled=(this.status=="Canceled");var failed=(this.status=="Failed");if(hasValue(this.remainingLeads)&&!completed&&!canceled&&!failed){buff=buff+'Pending Export: '+Mkt.util.Format.makeBigNumberPretty(this.remainingLeads)+' leads<br />';}
if(hasValue(this.estimatedTime)&&!completed&&!canceled&&!failed){buff=buff+'Est. Time: '+this.estimatedTime+'<br />';}
if(hasValue(this.status)&&!completed&&!canceled&&!failed){buff=buff+'Status: '+this.status+'<br />';}
if(!canceled&&!failed){buff=buff+'</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px; margin-top: 4px; margin-bottom:2px; width:'+(completed?'24':'16')+'px; height:'+(completed?'24':'16')+'px;" '+'src=\"'+(!completed?this.executingImage:this.completedImage)+'\" />';if(!completed){buff=buff+'<br /><a href="#" id="stopExportList'+this.listId+'" style="cursor:pointer;" onclick="MktLeadDb.stopExport('+this.exportId+', \'stopExportList'+this.listId+'\');">Stop</a>';}
buff+="</div>";}
if(completed||canceled){buff=buff+'<div style="float: left; width: 190px;">'+(completed?"Export Completed ":"Cancelled ")+(hasValue(this.endedAt)?this.endedAt:"")+'</div>';}
if(failed){buff=buff+'</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px; margin-top: 4px; margin-bottom:2px; width:16px; height:16px;" '+'src=\"'+this.failedImage+'\" />';buff=buff+'<div style="float: left; width: 190px;"> Error: Export Aborted </div>';buff=buff+'<div style="float:left; width: 190px;"><a href="mailto:'+
this.supportEmailAddress+'">'+this.contactSupportMsg+'</a></div>';}
if(completed){if(isDefined(this.exportedRows)&&this.exportedRows>0){buff=buff+'<br /><div style="float: left;"><a id="exportedLeads'+this.listId+'" href="" onclick="MktLeadDb.getExportedFile('+this.listId+'); return false;"><b>Download now</b></a></div>';buff=buff+'<form action="/leadDatabase/downloadExportedFile?exportId='+this.exportId+'" method="post" enctype="multipart/form-data" name="downloadExportedLeadsForm'+this.listId+'" id="downloadExportedLeadsForm'+this.listId+'" class="downloadExportedLeadsForm'+this.listId+'" target="downloadExportedLeadsFormIframe'+this.listId+'"><input type="hidden" name="xsrfId" value="'+MktSecurity.getXsrfId()+'" /></form>';buff=buff+'<iframe src="javascript:false" name="downloadExportedLeadsFormIframe'+this.listId+'" id="downloadExportedLeadsFormIframe'+this.listId+'" class="downloadExportedLeadsFormIframe'+this.listId+'" style="display:none;"></iframe>';}else{buff=buff+'<br /><b>There were no leads exported.</b>';}}
buff+="</div>";this.body.dom.innerHTML=buff;this.updateTitleStatus();},getStatus:function(){MktSession.ajaxRequest('/leadDatabase/getExportStatus',{serializeParms:{listId:this.listId,programId:this.programId,compType:this.compType},onMySuccess:function(){this.leadDbGrid=MktLeadDb.grid;var exportStatuses=MktPage.appVars.exportStatuses;this.renderStatus(exportStatuses);if(hasValue(exportStatuses)&&(this.status=="Complete"||this.status=="Failed"||this.status=="Canceled")){this.stopPollingStatus(this.pollId);}}.createDelegate(this)});},postProcessStatus:function(status){switch(status){case"Queued":case"Out of Memory":case"Requeued":case"In Process":case"Post-Processing":status="Exporting";break;case"Failed":status="Failed";break;default:break;}
return status;}});(function(){var leadDb=Mkt.app.LeadDb=Mkt.app.LeadDb||{};Ext.apply(leadDb,{homePanelId:'ldbCanvasLeadList',appVarsName:'leadDbSmartListName',appVarsId:'leadDbSmartListId',getActionStates:function(action){var states={disableViewLeadDetails:true,disableDeleteLead:true,disableMergeLeads:true};Ext.apply(action,{appVarsName:this.appVarsName,appVarsId:this.appVarsId});var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){switch(sels[0].source){case"grid":if(sels.length==1){states.disableDeleteLead=states.disableViewLeadDetails=false;}
if(sels.length>1){states.disableDeleteLead=states.disableMergeLeads=false;}
break;default:break;}}
return states;},mergeLeads:function(action){var tab=MktCanvas.getTab(this.homePanelId);if(tab){tab.getGridPanel().showConflictFieldsRequest();}},deleteLeads:function(action){var accessZoneId=Mkt.util.Common.getNodeAttrValue(null,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(Ext.getDom(action.el),MktLeadDb.ActivityTypes.DeleteLead,{accessZoneId:accessZoneId});},viewLeadDetails:function(action){if(isUndefined(action)||isUndefined(action.triggeredFrom)){return;}
Ext.apply(action,{appVarsName:this.appVarsName,appVarsId:this.appVarsId});var sels=Mkt.util.Common.getSelections(action);if(sels.length>0){var leadId=sels[0].id;window.open(MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+leadId,'_blank');}}});})();MktLeadDb.requestAsyncLoadStatus=function(listId,animEl){MktSession.clockCursor();MktSession.ajaxRequest('leadDatabase/getAsyncLoadStatus',{serializeParms:{listId:listId},onMySuccess:function(){MktSession.unclockCursor();MktLeadDb.showAsyncLoadStatusWindow(MktPage.appVars.asyncLoadLeadsStatus,this.compType,this.smListId);}.createDelegate(this)});};MktLeadDb.showAsyncLoadStatusWindow=function(statuses,compType,listId,animEl){var asyncLoadStatWin=new MktLeadDb.AsyncLoadStatusWindow(Ext.apply({renderTo:Ext.getBody(),closeAction:'close',id:'asyncLoadStatusWindow'+this.listId,listId:listId,compType:compType},statuses));asyncLoadStatWin.show();};MktLeadDb.stopAsyncLoad=function(listId,listName,el){var title="Stop "+listName;MktMessage.confirmStop(title,'Are you sure you want to stop working on the Cached List?',function(listId,listName){MktSession.clockCursor(true);MktSession.ajaxRequest('leadDatabase/stopAsyncLoadLeads',{serializeParms:{listId:listId},onMySuccess:function(){var smartlistCanvasId='ldbCanvasSmartListDef';var canvasObj=MktCanvas.getTab(smartlistCanvasId);if(canvasObj){if(canvasObj.config.compId==listId){canvasObj.clearContentValid();MktCanvas.setActiveTab(MktCanvas._makeTabId(smartlistCanvasId));}}}.createDelegate(this,[listId,listName])});}.createDelegate(this,[listId,listName]),'mkiSignStop',el,'Stop Cached List','Continue');};MktLeadDb.forceLoadAsync=function(smListId,smListName,canvas){MktSession.clockCursor();var canvasObj=MktCanvas.getTab(canvas);if(canvasObj){canvasObj.clearContentValid();}
var smartlistCanvas='ldbCanvasSmartListDef';canvasObj=MktCanvas.getTab(smartlistCanvas);if(canvasObj){canvasObj.clearContentValid();}
var msg=String.format(MktLeadDb.Messages.runningInBackgroundMembership,smListId);MktCanvas.updateMaskMsg(canvas,msg,'mktCanvasMaskActivity mktCanvasMaskWideTall',true,function(){var asyncLoadStatusEl=Ext.get('viewAsyncLoadStatus'+smListId);if(asyncLoadStatusEl){asyncLoadStatusEl.on('click',function(e,el){MktLeadDb.requestAsyncLoadStatus(smListId,this);e.stopEvent();}.createDelegate(this));}
var stopAsyncLoadBackgroundEl=Ext.get('stopAsyncLoadBackground'+smListId);if(stopAsyncLoadBackgroundEl){stopAsyncLoadBackgroundEl.on('click',function(e,el){MktLeadDb.stopAsyncLoad(smListId,smListName,'stopAsyncLoadBackground'+smListId);e.stopEvent();}.createDelegate(this));}});var mktoReqIds=MktCanvas.getRegisteredItem(MktSession.cancellableRequestKey,canvas);MktSession.ajaxRequest('leadDatabase/loadLeadsAsync',{serializeParms:{mktoReqIds:Ext.encode(mktoReqIds),listId:smListId},onMySuccess:MktLeadDb.forceLoadAsyncDone.createDelegate(this,[smListId,canvas])});};MktLeadDb.forceLoadAsyncDone=function(smListId,canvas){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var asyncLoadStatWin=Ext.WindowMgr.get('asyncLoadStatusWindow'+smListId);if(asyncLoadStatWin){asyncLoadStatWin.close();}
MktLeadDb.showAsyncLoadStatusWindow(MktPage.appVars.asyncLoadLeadsStatus,this.compType,this.smListId);}};MktLeadDb.invalidateAndLoadSmartlist=function(smListId,canvas){MktSession.clockCursor();MktCanvas.mask(null);MktSession.ajaxRequest('leadDatabase/invalidateSmartlist',{serializeParms:{listId:smListId},onMySuccess:function(){var activeTab=MktCanvas.getActiveTab();if(activeTab&&activeTab.getId()==MktCanvas._makeTabId(canvas)){MktCanvas.reloadActiveTab();}}.createDelegate(this)});var canvasObj=MktCanvas.getTab(canvas);if(canvasObj){canvasObj.clearContentValid();}};MktLeadDb.AsyncLoadStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Loading",pollInterval:10000,width:290,height:85,minWidth:260,stateQueued:'queued',stateDispatched:'dispatched',stateRunning:'running',stateCached:'cached',stateFailed:'failed',stateCancelled:'cancelled',stateUnknown:'unknown',initComponent:function(){this.processStatus(this);this.id=this.getBaseId();MktLeadDb.AsyncLoadStatusWindow.superclass.initComponent.call(this);},getBaseId:function(){return'asyncLoadStatusWindow'+this.listId;},buildTitleStatus:function(){var title="Smart List: ";if(hasValue(this.listName)){title+=this.listName;}
return title;},renderStatus:function(statuses){var statusMarkup='';statusMarkup+=this.getStatusesTextEl(statuses);statusMarkup+=this.getStatusIconEl(statuses);this.body.dom.innerHTML=statusMarkup;this.updateTitleStatus();this.refreshUnlessLoading();},getStatusesTextEl:function(statuses){var statusesMarkup='<div style="float: left;">Status: '+this.getStatusText()+'<br>';if(!this.isLoadLeadsDone()){statusesMarkup+=this.getStartedEl(statuses);}
statusesMarkup+=this.getFinishStatusEl(statuses);statusesMarkup+=this.getCancelledStatusEl(statuses);statusesMarkup+='</div>';return statusesMarkup;},getStartedEl:function(statuses){return"<span>Started: "+this.timeQueued+"</span>";},getStatusIconEl:function(statuses){var statusIconMarkup='<div style="float: right; padding-right: 5px;">';var imageSrc;var imageSize;if(!this.isLoadLeadsDone()){imageSrc=this.executingImage;imageSize=16;}
else{if(this.isLoadLeadsCancelled()){imageSrc='/images/spacer.gif';imageSize=16;}
else if(this.isLoadLeadsFailed()){imageSrc=this.failedImage;imageSize=24;}
else{imageSrc=this.completedImage;imageSize=32;}}
statusIconMarkup=statusIconMarkup+'<img src='+imageSrc+' '+'style="margin-left: 2px; margin-top: 4px; margin-bottom: 2px; '+'width:'+imageSize+'px; height:'+imageSize+'px;" /> <br />';if(!this.isLoadLeadsDone()){var stopElId=this.getBaseId()+'Stop';statusIconMarkup=statusIconMarkup+'<a onclick="MktLeadDb.stopAsyncLoad(\''+this.listId+'\', \''+this.listName+'\', \''+stopElId+'\');return false;" style="cursor: pointer;" id="'+
stopElId+'" href="#">Stop</a>';}
statusIconMarkup+='</div>';return statusIconMarkup;},getStatusText:function(){var statusText='';switch(this.state){case this.stateCached:statusText='Finished';break;case this.stateQueued:statusText='Queued';break;case this.stateRunning:case this.stateDispatched:statusText='Working';break;case this.stateCancelled:statusText='Canceled';break;case this.stateFailed:statusText='Failed';break;default:break;}
return statusText;},getFinishStatusEl:function(statuses){var markup="";if(this.isLoadLeadsDone()){if(this.isLoadLeadsCached()){var loadListParam={type:'LeadDb',compId:this.listId,compType:this.compType};if(this.compSubtype=='campaign'){loadListParam.panelIndex=1;}
var handler='MktDlManager.loadDl('+Ext.encode(loadListParam)+');';markup+="<span>Time: "+this.duration+"</span><br />";markup+="<a href='#' onclick='"+handler+"return false;'>Go to Cached List</a>";}
else if(this.isLoadLeadsFailed()){markup='Contact <a href="mailto:support@marketo.com">Marketo support</a>';}}
return markup;},getCancelledStatusEl:function(statuses){var markup="";if(this.isLoadLeadsDone()&&this.isLoadLeadsCancelled()){markup="<span>Time Spent: "+this.timeSpent+"</span>";if(this.cancelledBy){markup+="<br /><span>Canceled by: "+this.cancelledBy+"</span>";}}
return markup;},isLoadLeadsDone:function(){return(this.state==this.stateCached||this.state==this.stateFailed||this.state==this.stateCancelled);},isLoadLeadsCached:function(){return this.state==this.stateCached;},isLoadLeadsCancelled:function(){return this.state==this.stateCancelled;},isLoadLeadsFailed:function(){return this.state==this.stateFailed;},getStatus:function(){MktSession.ajaxRequest('/leadDatabase/getAsyncLoadStatus',{serializeParms:{listId:this.listId,compType:this.compType},onMySuccess:function(){this.leadDbGrid=MktLeadDb.grid;var statuses=MktPage.appVars.asyncLoadLeadsStatus;this.processStatus(statuses);if(hasValue(statuses)&&this.isLoadLeadsDone()){this.stopPollingStatus(this.pollId);}
this.renderStatus(statuses);}.createDelegate(this)});},refreshUnlessLoading:function(){if(this.isLoadLeadsDone()&&MktCanvas.isMasked()){var activeTab=MktCanvas.getActiveTab();if((activeTab.config.compType=="Smart List"||activeTab.getId()==MktCanvas._makeTabId('ldbCanvasSmartListDef'))&&activeTab.config.compId==this.listId){if(this.isLoadLeadsCached()){MktCanvas.reloadActiveTab();}
else if(this.isLoadLeadsFailed()){MktCanvas.setActiveTab(MktCanvas._makeTabId('ldbCanvasSmartListDef'));}}}},processStatus:function(statuses){this.state=statuses.state;this.timeEnded=statuses.time_ended;this.timeQueued=statuses.time_queued;this.timeSpent=statuses.timeSpent;this.requestId=statuses.request_id;this.cancelledBy=statuses.cancelledBy;this.duration=statuses.duration;}});
/* ========== mktEmail.js ============ */

function mktEmManager(){this.treeNodeType=4;this.treePfx='lpe_';this.oPfx='em';this.oTypeText='email';this.instanceName='lpemgr';}
mktEmManager.editEmail=function(emailId,emailName){mktEmManager.openEmailEditor(emailId,emailName);};mktEmManager.getUrlPrefix=function(){var url=MktSession.getUrlPrefix();return url;};mktEmManager.previewEmail=function(emailId,emailName){var url=mktEmManager.getUrlPrefix()+"/email/emailPreview?";if(emailId){url+='emailId='+emailId;}
else if(emailName){url+=Ext.urlEncode({emailName:emailName});}
var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.driveCreateEmailModal=function(animEl,cloneFromId,parentId,accessZoneId,marketingProgramId){var parms={};var url='email/createEmailRequest';var iconCls=null;if(cloneFromId!=null){parms.lpeEmailFrom=cloneFromId;var title="Clone to New Email";iconCls='mkiMail2Add';}else{var title="New Email";iconCls='mkiMail2';}
if(parentId){parms.parentId=parentId;}
if(accessZoneId){parms.accessZoneId=accessZoneId;}
if(isDefined(MktPage.appVars.disableActionBtn)){delete MktPage.appVars.disableActionBtn;}
if(isDefined(marketingProgramId)){parms.marketingProgramId=marketingProgramId;}
var mp=new MktModalForm({url:url,ajopts:{serializeParms:parms},title:title,iconCls:iconCls,okButtonTitle:'Create',width:670,height:415});mp.on('load',function(modal){if(isDefined(MktPage.appVars.disableActionBtn)&&MktPage.appVars.disableActionBtn){modal.disableButton(0);}
Mkt.apps.localasset.ComboManager.clearForm('all');},mp,true);mp.show(animEl,mktEmManager.submitCreateForm);};mktEmManager.submitCreateForm=function(mp){MktSession.clockCursor(true);var parms={};var programPickerField=Ext.getCmp('cloneToProgramPicker');var appPickerField=Ext.getCmp('applicationList');if(programPickerField&&programPickerField.selectedIndex!=-1&&programPickerField.getValue()){parms.cloneToMarketingProgramId=programPickerField.getValue();}
if(isDefined(MktPage.appVars.marketingProgramId)){parms.marketingProgramId=MktPage.appVars.marketingProgramId;delete MktPage.appVars.marketingProgramId;}
if(appPickerField&&appPickerField.selectedIndex!=-1&&appPickerField.getValue()==3){parms.cloneToMarketingProgramId=parms.marketingProgramId;}
MktSession.ajaxRequest('/email/createEmailSubmit',{serializeForm:'lpeEmailSubmitForm',serializeParms:parms,onMySuccess:mktEmManager.createEmailDone.createDelegate(this)});return false;};mktEmManager.createEmailDone=function(){if(isDefined(MktPage.appVars.operror)){delete MktPage.appVars.operror;delete MktPage.appVars.newEmails;return;}
if(mktEmManager.emailGrid){mktEmManager.emailGrid.addEmails(MktPage.appVars.newEmails);mktEmManager.emailGrid.selectEmail(MktPage.appVars.emailId);}
var result=MktPage.appVars.createEmailResult;if(isDefined(result)){delete MktPage.appVars.createEmailResult;}
var params={lpgType:'email',lpgId:MktPage.appVars.emailId};if(MktPage.appVars.marketingProgramId){params.marketingProgramId=MktPage.appVars.marketingProgramId;}
var skipLoadLanding=mktEmManager.skipLoadLanding();if(!skipLoadLanding){MktMainNav.loadLanding(params);}
else{MktSession.clockCursor(false);}
mktEmManager.createEmailActivate(MktPage.appVars.emailId,MktPage.appVars.emailName);delete MktPage.appVars.newEmails;};mktEmManager.moveEmail=function(emailId,emailName,marketingProgramId){if(marketingProgramId){MktSession.ajaxRequest('/marketingEvent/getMarketingProgramName',{serializeParms:{marketingProgramId:marketingProgramId},onMySuccess:mktEmManager.showMoveModal.createDelegate(this,[emailId,emailName,marketingProgramId])});}
else{mktEmManager.showMoveModal(emailId,emailName,marketingProgramId);}};mktEmManager.showMoveModal=function(emailId,emailName,marketingProgramId){if(MktPage.appVars.marketingProgramName){emailName=MktPage.appVars.marketingProgramName+"."+emailName;delete MktPage.appVars.marketingProgramName;}
var title='Move';var moveModal=new Mkt.apps.localasset.moveForm({title:title,compName:emailName,iconCls:'mkiMail2Exit',baseParams:{compId:emailId},type:'email',submitUrl:'/email/moveEmailSubmit',compId:emailId});moveModal.on('destroy',function(){delete moveModal;},this);moveModal.show();moveModal.submitSuccessCallback=mktEmManager.moveFormDone;};mktEmManager.moveFormDone=function(){if(isDefined(MktPage.appVars.opError)){delete MktPage.appVars.opError;return;}
var params={lpgType:'email'};if(MktPage.appVars.moveToMarketingProgramId){params.marketingProgramId=MktPage.appVars.moveToMarketingProgramId;}
if(MktPage.appVars.compId){params.lpgId=MktPage.appVars.compId;}
MktMainNav.loadLanding(params);};mktEmManager.createEmailActivate=function(emailId,emailName){if(MktPage.appVars.openEditor){mktEmManager.openEmailEditor(emailId,emailName);}};mktEmManager.skipLoadLanding=function(){var tabConfig=MktCanvas.getActiveTab().config;var isAssetTab=Mkt.apps.localasset&&Mkt.apps.localasset.Constants.TAB_NAME==tabConfig.id;if(isAssetTab){var isChildOfSameProgram=''+MktPage.appVars.marketingProgramId===''+tabConfig.compId;return isChildOfSameProgram&&!MktPage.appVars.openEditor;}
return false;};mktEmManager.deleteEmails=function(emailIds,animEl){if(emailIds.length==1){var msg='Are you sure you want to delete <b>'+emailIds[0].data.name+'</b>?';}else if(emailIds.length>1){var msg='Are you sure you want to delete multiple emails?';}else{return;}
mktEmManager.toDeleteEmailIds=emailIds;MktMessage.confirmDelete('Delete Email?',msg,mktEmManager.doRealDeleteEmails.createDelegate(this),animEl);};mktEmManager.doRealDeleteEmails=function(btnId){MktSession.clockCursor(true);var parms={};var paramEmailIds=[];var emailIds=mktEmManager.toDeleteEmailIds;for(var i=0;i<emailIds.length;++i){paramEmailIds.push(emailIds[i].data.id);}
parms.emailIds=Ext.util.JSON.encode(paramEmailIds);MktSession.ajaxRequest('/email/deleteEmails',{serializeParms:parms,onMySuccess:mktEmManager.processEmailActionReturn.createDelegate(this)});};mktEmManager.unapproveEmail=function(emailIds){Ext.MessageBox.show({title:'Please wait...',msg:'Unapproving Email',progress:true,wait:true,width:200,closable:false});var parms={emailIds:Ext.util.JSON.encode(emailIds)};MktSession.ajaxRequest('/email/unapproveEmail',{serializeParms:parms,onMySuccess:mktEmManager.processEmailActionReturn.createDelegate(this)});};mktEmManager.downloadEmailHtml=function(emailId){var emailInput=Ext.getDom('downloadEmailHtmlEmailId');if(emailInput){emailInput.value=emailId;var form=Ext.getDom('downloadEmailHtmlForm2');form.submit();}};mktEmManager.viewDetails=function(emailId,emailName){MktMainNav.loadLanding({lpgType:'email',lpgId:emailId});};mktEmManager.openEmailEditor=function(emailId,emailName){var url=mktEmManager.getUrlPrefix()+"/emaileditor/emailEdit?";var params={lpgObjType:'email',lpgObjAction:'edit',lpgObjId:emailId,lpgObjName:emailName};url+=Ext.urlEncode(params);var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.showDetailPanel=function(emailId,isDraftNode,accessZoneId,contextAccessZoneId){var parms={};parms.emailId=emailId;if(isDefined(accessZoneId)){parms.accessZoneId=accessZoneId;}
if(isDefined(isDraftNode)){parms.isDraftNode=isDraftNode;}
if(isDefined(contextAccessZoneId)){parms.contextAccessZoneId=contextAccessZoneId;}
MktSession.ajaxRequest('email/emailDetail',{serializeParms:parms});};mktEmManager.createDraft=function(emailId,emailName){MktSession.clockCursor(true);var parms={};parms.emailId=emailId;MktSession.ajaxRequest('/email/createDraft',{serializeParms:parms,onMySuccess:mktEmManager.processCreateDraftReturn.createDelegate(this,[emailId,emailName])});};mktEmManager.processCreateDraftReturn=function(emailId,emailName){mktEmManager.processEmailActionReturn();mktEmManager.openEmailEditor(emailId,emailName);};mktEmManager.editDraft=function(emailId,emailName,hasDraft){if((isBoolean(hasDraft)&&hasDraft)||hasDraft=="1"){mktEmManager.openEmailEditor(emailId,emailName);}else{mktEmManager.createDraft(emailId,emailName);}};mktEmManager.previewDraft=function(emailId,emailName){var url=mktEmManager.getUrlPrefix()+"/email/emailDraftPreview";url+='?emailId='+emailId;var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.approveDraft=function(emailIds){mktEmManager.toApproveEmailIds=emailIds;if(emailIds.length>1){Ext.MessageBox.confirm('Approve Emails?','Are you sure you want to approve multiple emails?',mktEmManager.doRealApproveEmails);}
else{mktEmManager.doRealApproveEmails('yes');}};mktEmManager.doRealApproveEmails=function(btnId){if(btnId!='yes'){return;}
Ext.MessageBox.show({title:'Please wait...',msg:'Approving Email',progress:true,wait:true,width:200,closable:false});var parms={};parms.emailIds=Ext.util.JSON.encode(mktEmManager.toApproveEmailIds);MktSession.ajaxRequest('/email/approveDraft',{serializeParms:parms,onMySuccess:mktEmManager.processEmailActionReturn.createDelegate(this)});};mktEmManager.discardDraft=function(emailIds){MktSession.clockCursor(true);var parms={emailIds:Ext.util.JSON.encode(emailIds)};MktSession.ajaxRequest('/email/discardDraft',{serializeParms:parms,onMySuccess:mktEmManager.processEmailActionReturn.createDelegate(this)});};mktEmManager.gotoDeliverability=function(emailIds){var loc=window.location;var url=loc.protocol+"//"+loc.host+MktSession.getUrlPrefix()+"/homepage/sso";url+='?sso=pivotal';var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.sendTestEmail=function(emailId,useDraft){var tester=new mktSendTestEmail();tester.sendTestEmail(emailId,useDraft);};mktEmManager.rndApproved=function(val){if(val==='Draft'){return"";}
else if(val==='Approved'){return"<img src='/images/icons16/mail2_ok.png' />";}
else if(val==='Approved with draft'){return"<img src='/images/icons16/mail2_edit.png'  title='Approved' title='Email has changed; you must approve again for changes to take effect'  />";}};mktEmManager.updateDetails=function(details){if(!MktCanvas.isActiveTab('landingEMDetail')){return;}
var statusIc=Ext.get("lpEmStatusIcon");if(statusIc)
statusIc.update(mktEmManager.rndApproved(details.status));var status=Ext.get('lpEmStatus');if(status)
status.update(details.status);var template=Ext.get('lpEmTemplate');if(template){MktAppJS.dashSetUsesItem("lpEmTemplate",details.emailUsesTemplate);}
var usedBy=Ext.get('lpEmUsedBy');if(usedBy){MktAppJS.dashSetUsedByList("lpEmUsedBy",details.emailUsedByList);}};mktEmManager.remapNodeAttr=function(attr){var xtraAttr=attr.xtra;if(!xtraAttr){console.debug('mktEmail mktEmManager could not find xtra',attr,xtraAttr);return attr;}
var data={hasDraft:xtraAttr.hasDraftNode||xtraAttr.compStatus==1||attr.text=='Draft',id:xtraAttr.compId,name:attr.text,status:xtraAttr.compStatus};return data;};mktEmManager.processEmailActionReturn=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.operror)&&MktPage.appVars.operror){delete MktPage.appVars.operror;if(MktPage.appVars.newEmails)
delete MktPage.appVars.newEmails;if(MktPage.appVars.deleteEmails)
delete MktPage.appVars.deleteEmails;if(MktPage.appVars.updateEmails)
delete MktPage.appVars.updateEmails;Ext.MessageBox.hide();return;}
var nodeId=MktPage.appVars.emailNodeId;var iconCls=MktPage.appVars.iconCls;MktExplorer.updateNodeIconCls(nodeId,iconCls,['ico-alert-disabled','ico-alt1']);var xtra=MktPage.appVars.nodeXtra;if(isDefined(xtra)){MktExplorer.updateNodeAttr(nodeId,xtra);delete MktPage.appVars.nodeXtra;}
var deletedNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(deletedNodeIds)){MktExplorer.removeNodes(deletedNodeIds);delete MktPage.appVars.deletedNodeIds;}
if(isDefined(nodeId)){delete MktPage.appVars.nodeId;}
if(isDefined(iconCls)){delete MktPage.appVars.iconCls;}
var repNodeJsons=MktPage.appVars.replaceNodeJsons;if(isDefined(repNodeJsons)){MktExplorer.replaceNodes(repNodeJsons);}
if(mktEmManager.emailGrid){var sm=mktEmManager.emailGrid.getSelectionModel();var items=sm.getSelections();if(items.length==1){var selectedId=items[0].data.id;}
if(MktPage.appVars.newEmails){mktEmManager.emailGrid.addEmails(MktPage.appVars.newEmails);}
if(MktPage.appVars.deleteEmails){sm.clearSelections();mktEmManager.emailGrid.deleteEmails(MktPage.appVars.deleteEmails);}
if(MktPage.appVars.updateEmails){mktEmManager.emailGrid.updateEmails(MktPage.appVars.updateEmails);for(var i=0;i<MktPage.appVars.updateEmails.length;++i){if(isDefined(selectedId)&&selectedId==MktPage.appVars.updateEmails[i].id){}}}}
if(MktPage.appVars.updateEmails){for(var i=0;i<MktPage.appVars.updateEmails.length;++i){if(MktPage.appVars.updateEmails[i].id==MktPage.appVars.detailEmailId){mktEmManager.updateDetails(MktPage.appVars.updateEmails[i]);}}}
if(MktPage.appVars.deleteEmails){for(var i=0;i<MktPage.appVars.deleteEmails.length;++i){if(MktPage.appVars.deleteEmails[i].id==MktPage.appVars.detailEmailId){var tab=MktCanvas.getTab('landingEMDetail');if(tab&&tab.config.compId==MktPage.appVars.deleteEmails[i].id){MktCanvas.remove(tab);}}}}
if(MktPage.appVars.newEmails)
delete MktPage.appVars.newEmails;if(MktPage.appVars.deleteEmails)
delete MktPage.appVars.deleteEmails;if(MktPage.appVars.updateEmails)
delete MktPage.appVars.updateEmails;Ext.MessageBox.hide();};MktEmailGrid=Ext.extend(MktGrids.CanvasGridPanel,{showDedicatedIp:false,stripeRows:true,fitWidthToCanvas:true,showRefreshButton:true,loadMask:true,enablePaging:false,enableSearchPaging:false,reloadAfterLayoutSave:false,enableTotal:true,autoExpandColumn:'name',view:new MktGrids.BufferGridView({}),initComponent:function(){var fields=[{name:'id'},{name:'name',type:'string'},{name:'status'},{name:'dedicatedIp',type:'string'},{name:'template'},{name:'hasDraft'},{name:'lastUpdated',type:'date'}];this.EmailRecord=Ext.data.Record.create(fields);this.ds=new Ext.data.JsonStore({id:'id',root:'data',fields:fields,url:'email/getAllEmails',baseParams:{compId:this.compId},totalProperty:'totalRecordCount',sortInfo:{field:'name',direction:'ASC'}});var canvas=this.canvas;var clickName=new MktGrids.ButtonColumn({id:"name",header:"Email Name",dataIndex:'name',sortable:true,align:'left',width:140,clickHandler:function(rowIndex,record){var action;if(record&&record.json&&record.json.marketingProgramId){action={lpgId:record.id,subType:'email',marketingProgramId:record.json.marketingProgramId};}
else{action=Ext.apply({triggeredFrom:'grid',panelId:canvas,subType:'email',type:'Landing'},record);}
MktMainNav.loadLanding(action);}});this.plugins=clickName;this.cm=new Ext.grid.ColumnModel([clickName,{header:"Approved",align:"center",width:70,sortable:true,dataIndex:'status',renderer:this.rndEmailGridApproved},{header:"Template",width:150,sortable:true,dataIndex:'template'},{header:"Dedicated IP",width:120,sortable:true,dataIndex:'dedicatedIp'},{header:"Last Updated",width:200,sortable:true,align:'right',dataIndex:'lastUpdated',renderer:Ext.util.Format.dateRenderer(Mkt.util.Format.longDateTimeFormat)}]);this.cm.setHidden(3,!this.showDedicatedIp);MktEmailGrid.superclass.initComponent.call(this);},getEmailById:function(id){var testEmailId=function(record,recordId){return(record.data.id==id);};var index=this.store.findBy(testEmailId);if(index!=-1){var email=this.store.getAt(index);return email;}
return null;},addEmails:function(emails){if(!this.store){return;}
for(var i=0;i<emails.length;++i){var email=new this.EmailRecord(emails[i]);this.store.add(email);}},deleteEmails:function(emails){for(var i=0;i<emails.length;++i){var email=this.getEmailById(emails[i].id);if(email)
this.store.remove(email);}},selectEmail:function(emailId){var sm=this.getSelectionModel();var record=this.getEmailById(emailId);if(record){sm.selectRecords([record]);}},updateEmail:function(record,updates){for(var field in updates){record.set(field,updates[field]);}},updateEmails:function(emails){for(var i=0;i<emails.length;++i){var email=this.getEmailById(emails[i].id);this.updateEmail(email,emails[i]);}
this.store.commitChanges();},rndEmailGridApproved:function(val){if(val==='Draft'){var rv="";}else if(val==='Approved'){var rv="<img src='/images/icons16/ok.png' title='Approved' />";}else if(val==='Approved with draft'){var rv="<img src='/images/icons16/sign_warning.png' title='Email has changed; you must approve again for changes to take effect' />";}
return rv;}});mktEmManager.editTemplate=function(templateId,templateName){mktEmManager.openTemplateEditor(templateId,templateName);};mktEmManager.previewTemplate=function(templateId,templateName){var url=mktEmManager.getUrlPrefix()+"/email/templatePreview";url+='?templateId='+templateId;var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.sendTestTemplate=function(templateId,useDraft){var tester=new mktSendTestEmail();tester.sendTestTemplate(templateId,useDraft);};mktEmManager.driveCreateTemplateModal=function(animEl,cloneFromId,parentId,accessZoneId){var parms={};var url='email/createTemplateRequest';var iconCls=null;if(cloneFromId!=null){parms.lpeTemplateFrom=cloneFromId;var title="Clone to New Template";iconCls='mkiWindow';}else{var title="New Template";iconCls='mkiWindow';}
if(isDefined(parentId)){parms.parentId=parentId;}
if(isDefined(accessZoneId)){parms.accessZoneId=accessZoneId;}
var mp=new MktModalForm({url:url,ajopts:{serializeParms:parms},title:title,iconCls:iconCls,okButtonTitle:'Create',width:655,height:370});mp.show(animEl,mktEmManager.submitCreateTemplateForm);};mktEmManager.submitCreateTemplateForm=function(mp){MktSession.clockCursor(true);var parms={};MktSession.ajaxRequest('/email/createTemplateSubmit',{serializeForm:'memTemplateSubmitForm',serializeParms:parms,onMySuccess:mktEmManager.createTemplateDone.createDelegate(this)});return false;};mktEmManager.createTemplateDone=function(){if(isDefined(MktPage.appVars.operror)){delete MktPage.appVars.operror;delete MktPage.appVars.newTemplates;return;}
if(mktEmManager.templateGrid){mktEmManager.templateGrid.addTemplates(MktPage.appVars.newTemplates);mktEmManager.templateGrid.selectTemplate(MktPage.appVars.templateId);}
var result=MktPage.appVars.createTemplateResult;if(isDefined(result)){delete MktPage.appVars.createTemplateResult;}
MktMainNav.loadLanding({lpgType:'emailTemplate',lpgId:MktPage.appVars.templateId});mktEmManager.createTemplateActivate(MktPage.appVars.templateId,MktPage.appVars.templateName);delete MktPage.appVars.newTemplates;};mktEmManager.createTemplateActivate=function(templateId,templateName){if(MktPage.appVars.openEditor){mktEmManager.openTemplateEditor(templateId,templateName);}};mktEmManager.deleteTemplates=function(templateIds,animEl){if(templateIds.length==1){var msg='Are you sure you want to delete <b>'+templateIds[0].data.name+'</b>?';}else if(templateIds.length>1){var msg='Are you sure you want to delete multiple templates?';}else{return;}
mktEmManager.toDeleteTemplateIds=templateIds;MktMessage.confirmDelete('Delete Template?',msg,mktEmManager.doRealDeleteTemplates.createDelegate(this),animEl);};mktEmManager.doRealDeleteTemplates=function(btnId){MktSession.clockCursor(true);var parms={};var paramTemplateIds=[];var templateIds=mktEmManager.toDeleteTemplateIds;for(var i=0;i<templateIds.length;++i){paramTemplateIds.push(templateIds[i].data.id);}
parms.templateIds=Ext.util.JSON.encode(paramTemplateIds);MktSession.ajaxRequest('/email/deleteTemplates',{serializeParms:parms,onMySuccess:mktEmManager.processTemplateActionReturn.createDelegate(this)});};mktEmManager.unapproveTemplate=function(templateIds){Ext.MessageBox.show({title:'Please wait...',msg:'Unapproving Email Template',progress:true,wait:true,width:240,closable:false});var parms={templateIds:Ext.util.JSON.encode(templateIds)};MktSession.ajaxRequest('/email/unapproveTemplate',{serializeParms:parms,onMySuccess:mktEmManager.processTemplateActionReturn.createDelegate(this)});};mktEmManager.viewTemplateDetails=function(templateId,templateName){MktMainNav.loadLanding({lpgType:'emailTemplate',lpgId:templateId});};mktEmManager.openTemplateEditor=function(templateId,templateName){var url=mktEmManager.getUrlPrefix()+"/emaileditor/templateEdit?";var params={lpgObjType:'template',lpgObjAction:'edit',lpgObjId:templateId,lpgObjName:templateName};url+=Ext.urlEncode(params);var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.showTemplateDetailPanel=function(templateId,isDraftNode,accessZoneId,contextAccessZoneId){var parms={};parms.templateId=templateId;parms.lpgId=templateId;if(isDefined(parms.accessZoneId)){parms.accessZoneId=accessZoneId;}
if(isDefined(isDraftNode)){parms.isDraftNode=isDraftNode;}
if(isDefined(contextAccessZoneId)){parms.contextAccessZoneId=contextAccessZoneId;}
MktSession.ajaxRequest('email/emailTemplateDetail',{serializeParms:parms});};mktEmManager.createTemplateDraft=function(templateId,templateName){MktSession.clockCursor(true);var parms={};parms.templateId=templateId;MktSession.ajaxRequest('/email/createTemplateDraft',{serializeParms:parms,onMySuccess:mktEmManager.processCreateTemplateDraftReturn.createDelegate(this,[templateId,templateName])});};mktEmManager.processCreateTemplateDraftReturn=function(templateId,templateName){mktEmManager.processTemplateActionReturn();mktEmManager.openTemplateEditor(templateId,templateName);};mktEmManager.editTemplateDraft=function(templateId,templateName,hasDraft){if((isBoolean(hasDraft)&&hasDraft)||hasDraft=="1"){mktEmManager.openTemplateEditor(templateId,templateName);}else{mktEmManager.createTemplateDraft(templateId,templateName);}};mktEmManager.previewTemplateDraft=function(templateId,templateName){var url=mktEmManager.getUrlPrefix()+"/email/templateDraftPreview";url+='?templateId='+templateId;var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");};mktEmManager.approveTemplateDraft=function(templateIds){Ext.MessageBox.show({title:'Please wait...',msg:'Approving Email Template',progress:true,wait:true,width:240,closable:false});var parms={templateIds:Ext.util.JSON.encode(templateIds)};MktSession.ajaxRequest('/email/approveTemplateDraft',{serializeParms:parms,onMySuccess:mktEmManager.processTemplateActionReturn.createDelegate(this)});};mktEmManager.discardTemplateDraft=function(templateIds){MktSession.clockCursor(true);var parms={templateIds:Ext.util.JSON.encode(templateIds)};MktSession.ajaxRequest('/email/discardTemplateDraft',{serializeParms:parms,onMySuccess:mktEmManager.processTemplateActionReturn.createDelegate(this)});};mktEmManager.updateTemplateDetails=function(details){var canvas='EMTemplateDetail';if(!MktCanvas.isActiveTab(canvas))return;var statusIc=Ext.get("emEMTStatusIcon");if(statusIc)
statusIc.update(mktEmManager.rndApproved(details.status));var status=Ext.get('emEMTStatus');if(status)
status.update(details.status);var usedBy=Ext.get('emEMTUsedBy');if(usedBy)
MktAppJS.dashSetUsedByList("emEMTUsedBy",details.templateUsedByList);};mktEmManager.processTemplateActionReturn=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.operror)&&MktPage.appVars.operror){delete MktPage.appVars.operror;if(MktPage.appVars.newTemplates)
delete MktPage.appVars.newTemplates;if(MktPage.appVars.deleteTemplates)
delete MktPage.appVars.deleteTemplates;if(MktPage.appVars.updateTemplates)
delete MktPage.appVars.updateTemplates;Ext.MessageBox.hide();return;}
var nodeId=MktPage.appVars.nodeId;var iconCls=MktPage.appVars.iconCls;MktExplorer.updateNodeIconCls(nodeId,iconCls,['ico-alert-disabled','ico-alt1']);var xtra=MktPage.appVars.nodeXtra;if(isDefined(xtra)){MktExplorer.updateNodeAttr(nodeId,xtra);delete MktPage.appVars.nodeXtra;}
var deletedNodeIds=MktPage.appVars.deletedNodeIds;if(isDefined(deletedNodeIds)){MktExplorer.removeNodes(deletedNodeIds);delete MktPage.appVars.deletedNodeIds;}
if(isDefined(nodeId)){delete MktPage.appVars.nodeId;}
if(isDefined(iconCls)){delete MktPage.appVars.iconCls;}
var repNodeJsons=MktPage.appVars.replaceNodeJsons;if(isDefined(repNodeJsons)){MktExplorer.replaceNodes(repNodeJsons);}
if(mktEmManager.templateGrid){var sm=mktEmManager.templateGrid.getSelectionModel();var items=sm.getSelections();if(items.length==1){var selectedId=items[0].data.id;}
if(MktPage.appVars.newTemplates){mktEmManager.templateGrid.addTemplates(MktPage.appVars.newTemplates);}
if(MktPage.appVars.deleteTemplates){sm.clearSelections();mktEmManager.templateGrid.deleteTemplates(MktPage.appVars.deleteTemplates);}
if(MktPage.appVars.updateTemplates){mktEmManager.templateGrid.updateTemplates(MktPage.appVars.updateTemplates);for(var i=0;i<MktPage.appVars.updateTemplates.length;++i){if(isDefined(selectedId)&&selectedId==MktPage.appVars.updateTemplates[i].id){}}}}
if(MktPage.appVars.updateTemplates){for(var i=0;i<MktPage.appVars.updateTemplates.length;++i){if(MktPage.appVars.updateTemplates[i].id==MktPage.appVars.detailTemplateId){mktEmManager.updateTemplateDetails(MktPage.appVars.updateTemplates[i]);}}}
if(MktPage.appVars.deleteTemplates){for(var i=0;i<MktPage.appVars.deleteTemplates.length;++i){if(MktPage.appVars.deleteTemplates[i].id==MktPage.appVars.detailTemplateId){var tab=MktCanvas.getTab('EMTemplateDetail');if(tab&&tab.config.compId==MktPage.appVars.deleteTemplates[i].id){MktCanvas.remove(tab);}}}}
if(MktPage.appVars.newTemplates)
delete MktPage.appVars.newTemplates;if(MktPage.appVars.deleteTemplates)
delete MktPage.appVars.deleteTemplates;if(MktPage.appVars.updateTemplates)
delete MktPage.appVars.updateTemplates;if(MktPage.appVars.replaceNodeJsons)
delete MktPage.appVars.replaceNodeJsons;mktEmManager.processEmailActionReturn();Ext.MessageBox.hide();};MktTemplateGrid=Ext.extend(MktGrids.CanvasGridPanel,{stripeRows:true,fitWidthToCanvas:true,showRefreshButton:true,loadMask:true,enablePaging:false,enableSearchPaging:false,reloadAfterLayoutSave:false,enableTotal:true,autoExpandColumn:'name',view:new MktGrids.BufferGridView({}),initComponent:function(){var fields=[{name:'id'},{name:'name',type:'string'},{name:'status'},{name:'usedBy',type:'int'},{name:'hasDraft'},{name:'lastUpdated',type:'date'}];this.TemplateRecord=Ext.data.Record.create(fields);this.ds=new Ext.data.JsonStore({id:'id',root:'data',fields:fields,url:'email/getAllTemplates',baseParams:{compId:this.compId},totalProperty:'totalRecordCount',sortInfo:{field:'name',direction:'ASC'}});var canvas=this.canvas;var clickName=new MktGrids.ButtonColumn({id:"name",header:"Template Name",dataIndex:'name',sortable:true,align:'left',width:140,clickHandler:function(rowIndex,record){var action=Ext.apply({triggeredFrom:'grid',panelId:canvas,subType:'emailTemplate',type:'Landing'},record);MktMainNav.loadLanding(action);}});this.plugins=clickName;this.cm=new Ext.grid.ColumnModel([clickName,{header:"Approved",align:"center",width:70,sortable:true,dataIndex:'status',renderer:this.rndTemplateGridApproved},{header:"Used By Emails",width:120,sortable:true,dataIndex:'usedBy',align:'right'},{header:"Last Updated",width:200,sortable:true,align:'right',dataIndex:'lastUpdated',renderer:Ext.util.Format.dateRenderer(Mkt.util.Format.longDateTimeFormat)}]);MktTemplateGrid.superclass.initComponent.call(this);},getTemplateById:function(id){var testTemplateId=function(record,recordId){return(record.data.id==id);};var index=this.store.findBy(testTemplateId);if(index!=-1){var template=this.store.getAt(index);return template;}
return null;},addTemplates:function(templates){if(!this.store){return;}
for(var i=0;i<templates.length;++i){var template=new this.TemplateRecord(templates[i]);this.store.add(template);}},deleteTemplates:function(templates){for(var i=0;i<templates.length;++i){var template=this.getTemplateById(templates[i].id);if(template)
this.store.remove(template);}},selectTemplate:function(templateId){var sm=this.getSelectionModel();var record=this.getTemplateById(templateId);if(record){sm.selectRecords([record]);}},updateTemplate:function(record,updates){for(var field in updates){record.set(field,updates[field]);}},updateTemplates:function(templates){for(var i=0;i<templates.length;++i){var template=this.getTemplateById(templates[i].id);this.updateTemplate(template,templates[i]);}
this.store.commitChanges();},rndTemplateGridApproved:function(val){if(val==='Draft'){var rv="<img src='/images/icons16/window.png' title='Draft' />";}else if(val==='Approved'){var rv="<img src='/images/icons16/window_ok.png' title='Approved' />";}else if(val==='Approved with draft'){var rv="<img src='/images/icons16/window_edit.png' title='Template has changed; you must approve again for changes to take effect' />";}
return rv;}});
/* ========== mktEmailUtil.js ============ */

mktSendTestEmail=function(){this.modal=null;};mktSendTestEmail.prototype={validateEmails:function(text){var emails=/^\s*(([\w-]+)(\.[\w-]+)*@([\w-]+\.){1,5}([A-Za-z]){2,4}\s*([;,])*\s*)+$/;if(!emails.test(text)){return false;}
return true;},sendTestEmail:function(emailId,useDraft){this.emailId=emailId;this.useDraft=useDraft;this.showSendDialog();},sendTestTemplate:function(templateId,useDraft){this.templateId=templateId;this.useDraft=useDraft;this.showSendDialog();},renderSendDialog:function(el){var modalMsg=new Ext.Panel({html:'<h2><div class="mktModalInFormMessage"></div></h2>',bodyStyle:'background-color: transparent; margin-bottom: 5px'});this.testToField=new Ext.form.TextArea({fieldLabel:'Send To',tabIndex:1,anchor:'95% -30',enableKeyEvents:true,listeners:{'change':function(field,oldVal,newVal){MktModalForm.clearMessage();},'keyup':function(field,e){MktModalForm.clearMessage();}}});var prevAddrField=new Ext.form.ComboBox({fieldLabel:'',labelSeparator:'',tabIndex:2,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/emaileditor/getSendTestAddresses',root:'addresses',fields:['code','val']}),mode:'remote',valueField:'code',displayField:'val',triggerAction:'all',forceSelection:true,editable:false,resizable:true,emptyText:'Choose previous address...',relatedField:this.testToField,listeners:{'select':function(field,record,index){if(record.data.code!=-1){field.relatedField.setValue(record.data.val);MktModalForm.clearMessage();}}},anchor:'95% -30'});var formItems=[modalMsg,prevAddrField,this.testToField];if(this.emailId!=null){this.textOnlyCheck=new Ext.form.Checkbox({boxLabel:'Also send text-only version',labelSeparator:''});formItems.push(this.textOnlyCheck);}
var form=new Ext.form.FormPanel({baseCls:'x-plain',labelWidth:65,items:formItems,renderTo:el.id});},showSendDialog:function(){this.modal=new MktModalForm({rendererscope:this,renderer:this.renderSendDialog,title:'Send Test Email',iconCls:'mkiMail2Forward',okButtonTitle:'Send',width:500,height:325,dialogOpts:{resizable:false}});this.modal.show(null,this.doSendTestEmail.createDelegate(this));},doSendTestEmail:function(){var addresses=this.testToField.getValue();if(addresses.length<1){MktModalForm.setMessageError("Please enter at least one email address");return;}
else if(!this.validateEmails(addresses)){MktModalForm.setMessageError("Invalid email address list (Example: a@b.com; c@d.com)");return;}else{MktModalForm.clearMessage();}
var param={useDraft:this.useDraft==true?1:0,emails:addresses};if(this.emailId!=null){param.emailId=this.emailId;param.textOnlyCheck=this.textOnlyCheck.getValue();var url='emaileditor/testEmailSend';}
else{param.templateId=this.templateId;var url='emaileditor/testTemplateSend';}
MktSession.ajaxRequest(url,{serializeParms:param,onMySuccess:this.sendTestEmailDone.createDelegate(this)});this.waitBox=Ext.MessageBox.show({title:'Please wait...',msg:'Sending test emails...',progress:true,width:220,wait:true,closable:false});},sendTestEmailDone:function(){this.waitBox.hide();if(MktPage.appVars.message){MktModalForm.setMessageError(MktPage.appVars.message);MktPage.appVars.message=null;}else{this.modal.close();this.modal=null;}}};
/* ========== mktLeadDbMenu.js ============ */

Ext.namespace("MktLeadDbMenu");MktLeadDbMenu.menuItemPool={newLead:{text:'New Lead',itemId:'newLead',iconCls:'mkiUser',handler:function(el){MktLeadDb.ldbCreateLeadModal(el.getEl(),MktPage.appVars.leadDbCompType,MktPage.appVars.leadDbSmartListId);el.parentMenu.hide(true);}},viewLeadDetails:{text:'View Lead Details',itemId:'viewLeadDetails',iconCls:'mkiUserInto',handler:function(el){el.parentMenu.hide(true);var sm=MktLeadDb.grid.getSelectionModel();var numSelected=sm.getCount();if(numSelected==1){var items=sm.getSelections();if(items.length==1&&items[0].id=='ALL'){items=sm.getVisibleSelections();}
var leadId=items[0].id;window.open(MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+leadId,'_blank');}}},importList:{text:'Import List',itemId:'importList',iconCls:'mkiImport',handler:function(el){var accessZoneId,parentId,programId,currNode,compType,programName;if(el.parentMenu&&el.parentMenu.currNode){var currNode=el.parentMenu.currNode;if(currNode.attributes.folder){parentId=currNode.attributes.id;}}
accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);compType=Mkt.util.Common.getNodeAttrValue(currNode,'compType',true);if(compType=='Marketing Event'||compType=='Marketing Program'){programId=Mkt.util.Common.getNodeAttrValue(currNode,'compId',true);var firstTab=MktCanvas.getFirstTab();if(firstTab){programName=firstTab.config.title;}}
MktLeadDb.importList(el.getEl(),accessZoneId,parentId,programId,programName,compType);if(el.parentMenu){el.parentMenu.hide(true);}}},showImportStatus:{text:'Show Import Status',itemId:'showImportStatus',iconCls:'mkiClockUp',handler:function(el){var currNode=el.parentMenu.currNode,compId;if(currNode){compId=currNode.attributes.xtra.compId;}else{compId=MktPage.appVars.leadDbSmartListId;}
var compType=Mkt.util.Common.getNodeAttrValue(currNode,'compType',true);if(!compId){compId=Mkt.util.Common.getNodeAttrValue(currNode,'compId',true);}
MktLeadDb.requestImportStatus(compId,el.getEl(),compType);}},showExportStatus:{text:'Show Export Status',itemId:'showExportStatus',iconCls:'mkiClockDown',handler:function(el){var currNode=el.parentMenu.currNode,compId,compType,listName,isMembershipSmartlist=false;if(currNode){var attr=currNode.attributes;var xtraAttr=attr.xtra;compId=xtraAttr.compId;compType=xtraAttr.compType;listName=attr.text;}else{var appVars=MktPage.appVars;compId=appVars.leadDbSmartListId;compType=appVars.leadDbCompType;listName=appVars.leadDbSmartListName;var cName=MktPage.activePanel.cName;if(appVars.leadDbCompSubtype=="campaign"&&isDefined(cName)&&cName=="ldbCanvasLeadList"){isMembershipSmartlist=true;}}
if(!compType){compType=Mkt.util.Common.getNodeAttrValue(currNode,'compType',true);}
if(!compId){compId=Mkt.util.Common.getNodeAttrValue(currNode,'compId',true);}
MktLeadDb.requestExportStatus(compId,listName,compType,el.getEl(),isMembershipSmartlist,compId);}},exportList:{text:'Export List',itemId:'exportList',iconCls:'mkiExport2',handler:function(el){var currNode=el.parentMenu.currNode;var hasCachedList;if(isDefined(currNode)){var compId=currNode.attributes.xtra.compId;var compType=currNode.attributes.xtra.compType;var compSubtype=currNode.attributes.xtra.compSubtype;var name=currNode.attributes.text;hasCachedList=currNode.attributes.statusText==MktLeadDb.cachedListStatusValidCache;}else{var appVars=MktPage.appVars;var compId=appVars.leadDbSmartListId;var compType=appVars.leadDbCompType;var compSubtype=appVars.leadDbCompSubtype;var name=appVars.leadDbSmartListName;var activeTab=MktCanvas.getActiveTab();if(activeTab){hasCachedList=activeTab.config.cachedListStatus==MktLeadDb.cachedListStatusValidCache;}}
MktLeadDb.exportList(el.getEl(),compId,compType,compSubtype,name,MktPage.activePanel.cName,undefined,undefined,hasCachedList);el.parentMenu.hide(true);}},deleteList:{text:'Delete List',itemId:'deleteList',iconCls:'mkiDelete2',handler:function(el){console.debug(currNode);var currNode=el.parentMenu.currNode;if(currNode&&currNode.attributes&&currNode.attributes.marketingProgramId){var compId=currNode.attributes.compId;var compType=currNode.attributes.compType;var listName=currNode.attributes.text;}
else if(currNode){var compId=el.parentMenu.leadDbSmartListId;var nodeId=el.parentMenu.leadDbNodeId;var compType=el.parentMenu.listCompType;var compSubtype=el.parentMenu.listCompSubtype;var listName=el.parentMenu.listName;}else{var appVars=MktPage.appVars;var compId=appVars.leadDbSmartListId;var compType=appVars.leadDbCompType;var compSubtype=appVars.leadDbCompSubtype;var listName=appVars.leadDbSmartListName;}
MktMessage.confirmDelete('Delete List','Are you sure you want to delete the <b>'+listName+'</b> list?',function(btn,text){if(compType=="List"||compType=="list"){MktLeadDb.deleteList(compId);}else if(compType=="Smart List"||compType=='smartlist'||compSubtype=='user'){MktLeadDb.deleteSmartList(compId);}},el.getEl());el.parentMenu.hide(true);delete el.parentMenu.currNode;}},createCampaignList:{text:'Create Campaign from List',itemId:'createCampaignList',iconCls:'mkiCustLightbulbOnAdd',hideOnClick:true,handler:function(el){MktAppJS.chcDriveCreateEmailCampaignModal(el.getEl(),MktPage.appVars.leadDbSmartListId);el.parentMenu.hide(true);}},newSmartList:{text:'New Smart List',itemId:'newSmartList',iconCls:'mkiDocumentPlainNew',hideOnClick:true,handler:function(el){var parentId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'compId');var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktAppJS.ldbDriveCreateSmartListModal(el.getEl(),parentId,undefined,undefined,undefined,accessZoneId);el.parentMenu.hide(true);}},newList:{text:'New List',itemId:'newList',iconCls:'mkiIndex',handler:function(el){var currNode=el.parentMenu.currNode;var parentId;var accessZoneId;if(currNode){parentId=currNode.id;accessZoneId=currNode.attributes.accessZoneId;}
if(isUndefined(accessZoneId)){accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;}
MktLeadDb.ldbDriveCreateListModal(el.getEl(),parentId,accessZoneId);el.parentMenu.hide(true);}},cloneSmartlist:{text:'Clone Smart List',itemId:'cloneSmartlist',iconCls:'mkiDocumentPlainNew',hideOnClick:true,handler:function(el){var currNode=el.parentMenu.currNode;var accessZoneId;var parentId;if(currNode){if(currNode.parentNode&&currNode.parentNode.atributes&&currNode.parentNode.atributes.nodeType=='Smart List'){parentId=currNode.parentNode.id;}
var cloneFromId=currNode.attributes.xtra.compId;var cloneFromName=currNode.text;accessZoneId=currNode.attributes.accessZoneId;var compSubtype=currNode.attributes.xtra.compSubtype;}else{var activeTab=MktCanvas.getActiveTab();if(activeTab){var cloneFromId=activeTab.config.compId;var cloneFromName=activeTab.config.title;accessZoneId=activeTab.config.accessZoneId;}else{return;}}
var marketingProgramId=null;if(currNode){if(currNode.attributes&&currNode.attributes.marketingProgramId){marketingProgramId=currNode.attributes.marketingProgramId;}
else if(currNode.attributes&&currNode.attributes.xtra&&currNode.attributes.xtra.marketingProgramId){marketingProgramId=currNode.attributes.xtra.marketingProgramId;}}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
MktAppJS.ldbDriveCreateSmartListModal(el.getEl(),parentId,cloneFromId,cloneFromName,compSubtype,accessZoneId,marketingProgramId);el.parentMenu.hide(true);}},cloneList:{text:'Clone List',itemId:'cloneList',iconCls:'mkiIndex',hideOnClick:true,handler:function(el){var currNode=el.parentMenu.currNode;var accessZoneId;var parentId;if(currNode){if(currNode.parentNode&&currNode.parentNode.atributes&&currNode.parentNode.atributes.nodeType=='List'){parentId=currNode.parentNode.id;}
var cloneFromId=currNode.attributes.xtra.compId;var cloneFromName=currNode.text;accessZoneId=currNode.attributes.accessZoneId;var compSubtype=currNode.attributes.xtra.compSubtype;}else{var activeTab=MktCanvas.getActiveTab();if(activeTab){var cloneFromId=activeTab.config.compId;var cloneFromName=activeTab.config.title;accessZoneId=activeTab.config.accessZoneId;}else{return;}}
var marketingProgramId=null;var accessZoneId="";if(currNode){if(currNode.attributes&&currNode.attributes.marketingProgramId){marketingProgramId=currNode.attributes.marketingProgramId;}
else if(currNode.attributes&&currNode.attributes.xtra&&currNode.attributes.xtra.marketingProgramId){marketingProgramId=currNode.attributes.xtra.marketingProgramId;}
if(currNode.attributes){accessZoneId=currNode.attributes.accessZoneId;}}
else{marketingProgramId=Mkt.util.Common.getNodeAttrValue(null,'marketingProgramId',true);}
MktLeadDb.ldbDriveCreateListModal(el.getEl(),parentId,accessZoneId,cloneFromId,cloneFromName,marketingProgramId);el.parentMenu.hide(true);}},createCachedList:{text:'Create Cached List',itemId:'createCachedList',iconCls:'mkiDocumentAttachment',visible:false,handler:function(el){var currNode=el.parentMenu.currNode;if(currNode&&currNode.attributes){MktLeadDb.forceLoadAsync(currNode.attributes.compId);}}},undoUnsubscribe:{text:'Undo Unsubscribe',itemId:'undoUnsubscribe',handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},mergeLeads:{text:'Merge Leads',itemId:'mergeLeads',iconCls:'mkiRefresh',handler:function(el){MktLeadDb.grid.showConflictFieldsRequest(el.getEl());el.parentMenu.hide(true);}},viewLeadSalesforce:{text:'View Lead in Salesforce.com',itemId:'viewLeadSalesforce',iconCls:'mkiCustSalesforce',disable:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},gotoCampaign:{text:'Goto Campaign',itemId:'gotoCampaign',iconCls:'mkiCustLightbulbOn',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},createSnapshotList:{text:'Create Snapshot List',itemId:'createSnapshotList',iconCls:'ico-document',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},navigateToMembership:{text:'View Membership',iconCls:'mkiUsers2',itemId:'navigateToMembership',handler:function(el){el.parentMenu.hide(true);MktDlManager.loadDl(el.parentMenu.currNode.attributes.xtra);}},navigateToSmartList:{text:'View Smart List',itemId:'navigateToSmartList',iconCls:'mkiLightbulbOn',handler:function(el){el.parentMenu.hide(true);var xtraAttr=el.parentMenu.currNode.attributes.xtra;xtraAttr.panelId='ldbCanvasSmartListDef';MktDlManager.loadDl(xtraAttr);}},navigateToFilterView:{text:'Filter View',itemId:'navigateToFilterView',iconCls:'mkiFilter',handler:function(el){el.parentMenu.hide(true);var xtraAttr=el.parentMenu.currNode.attributes.xtra;xtraAttr.panelId='ldbCanvasFilterView';MktDlManager.loadDl(xtraAttr);}},custFieldSettings:{text:'Custom Field Settings',itemId:'custFieldSettings',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},addToList:{text:'Add to List...',itemId:'addToList',iconCls:'mkiIndexAdd',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.AddToList,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeDataValue:{text:'Change Data Value...',itemId:'changeDataValue',iconCls:'mkiFormBlueEdit',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeDataValue,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeRevenueStage:{text:'Change Revenue Stage...',id:'changeRevenueStage',iconCls:'mkiPackage',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeRevenueStage,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeOwner:{text:'Change Owner...',itemId:'changeOwner',iconCls:'mkiUserInformation',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeOwner,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeScore:{text:'Change Score...',itemId:'changeScore',iconCls:'mkiStar2Yellow',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeScore,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeStatusInProgression:{text:'Change Status in Progression...',itemId:'changeStatusInProgression',iconCls:'mkiArrow2UpRightGreen',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeStatusInProgression,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeFieldInProgram:{text:'Change Field in Program...',itemId:'changeFieldInProgram',iconCls:'mkiFormYellowEdit',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeFieldInProgram,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},convertLead:{text:'Convert Lead...',itemId:'convertLead',iconCls:'mkiHandThumbUp',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ConvertLead,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},createTask:{text:'Create Task...',itemId:'createTask',iconCls:'mkiSignalFlagYellow',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.CreateTask,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},deleteLead:{text:'Delete Lead...',itemId:'deleteLead',iconCls:'mkiUserDelete',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.DeleteLead,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},deleteLeadFromSFDC:{text:'Delete Lead from SFDC...',itemId:'deleteLeadFromSFDC',iconCls:'mkiUserDelete',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.DeleteLeadFromSFDC,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},pushLeadToSFDC:{text:'Sync Lead to SFDC...',itemId:'pushLeadToSFDC',iconCls:'mkiArrow2RightBlue',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.SyncLeadToSFDC,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},removeFromFlow:{text:'Remove from Flow...',itemId:'removeFromFlow',iconCls:'mkiSignStop',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.RemoveFromFlow,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},removeFromList:{text:'Remove from List...',itemId:'removeFromList',iconCls:'mkiIndexDelete',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.RemoveFromList,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},sendAlert:{text:'Send Alert...',itemId:'sendAlert',iconCls:'mkiBell2Gold',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.SendAlert,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},sendEmail:{text:'Send Email...',itemId:'sendEmail',iconCls:'mkiMail2',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.SendEmail,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},addToSFDCCampaign:{text:'Add to SFDC Campaign...',itemId:'addToSFDCCampaign',iconCls:'mkiSalesforce',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.AddToSFDCCampaign,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},removeFromSFDCCampaign:{text:'Remove from SFDC Campaign...',itemId:'removeFromSFDCCampaign',iconCls:'mkiSalesforce',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.RemoveFromSFDCCampaign,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeStatusInSFDCCampaign:{text:'Change Status in SFDC Campaign...',itemId:'changeStatusInSFDCCampaign',iconCls:'mkiSalesforce',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeStatusInSFDCCampaign,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},interestingMoment:{text:'Interesting Moment...',itemId:'interestingMoment',iconCls:'mkiMessage',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.InterestingMoment,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},requestCampaign:{text:'Request Campaign...',itemId:'requestCampaign',iconCls:'mkiLightbulbOnPlay',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.RequestCampaign,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},changeLeadPartition:{text:'Change Lead Partition...',itemId:'changeLeadPartition',iconCls:'mkiDataInto',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.ChangeLeadPartition,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},enrichWithJigsaw:{text:'Enrich with Data.com',itemId:'enrichWithJigsaw',iconCls:'mkiDataCom',handler:function(el){if(!MktPage.savedState.jigsawActive){Mkt.apps.jigsawAdmin.Actions.showIntro();return;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(el.getEl(),MktLeadDb.ActivityTypes.EnrichWithJigsaw,{accessZoneId:accessZoneId});el.parentMenu.hide(true);}},contextSpacer:{itemId:'contextSpacer'}};MktLeadDbMenu.menuFactory=function(idObj,items){var menuId=isObject(idObj)?idObj.id:idObj;var m=Ext.menu.MenuMgr.get(menuId);if(m){return m;}
var config={id:menuId,itemId:menuId,cls:'mktMenu',shared:true};if(isObject(idObj)){if(idObj.cls){idObj.cls=config.cls+" "+idObj.cls;}
config=Ext.apply(config,idObj);}
var menuItems=items;if(isObject(items)&&isUndefined(items.length)){Array.prototype.splice.call(arguments,0,1);config.items=Ext.toArray(config.items||arguments);}
else if(isObject(items)&&!Ext.isArray(items)){config.items=Ext.toArray(items);}
return new MktMenu(config);};(function(){var ldbMip=MktLeadDbMenu.menuItemPool;var fMip=MktFolder.menuItemPool;MktLeadDbMenu.listMenu=function(){return MktLeadDbMenu.menuFactory("leadDbListMenu",ldbMip.navigateToMembership,ldbMip.navigateToSmartList,ldbMip.navigateToFilterView,ldbMip.showImportStatus,ldbMip.showExportStatus,new Ext.menu.Separator({id:'navigateToSeparator'}),ldbMip.cloneList,ldbMip.cloneSmartlist,ldbMip.importList,ldbMip.exportList,ldbMip.deleteList,ldbMip.createCachedList);};MktLeadDbMenu.leadMenu=function(){return MktLeadDbMenu.menuFactory("leadDbLeadMenu",ldbMip.viewLeadDetails,ldbMip.mergeLeads,{itemId:'leadDbMenuFlowActions',text:'Flow Actions',iconCls:'mkiCubes',menu:{items:[ldbMip.addToList,ldbMip.changeDataValue,MktPage.hasWorkspaces()?ldbMip.changeLeadPartition:'',ldbMip.changeRevenueStage,ldbMip.changeScore,(MktPage.savedState.marketingEventEnabled||MktPage.savedState.marketingProgramEnabled)?ldbMip.changeStatusInProgression:'',ldbMip.deleteLead,MktPage.hasCredential('enrichwithjigsaw')?ldbMip.enrichWithJigsaw:'',MktPage.hasSalesInsight()?ldbMip.interestingMoment:'',ldbMip.removeFromFlow,ldbMip.removeFromList,ldbMip.requestCampaign,ldbMip.sendAlert,ldbMip.sendEmail,'-',ldbMip.addToSFDCCampaign,ldbMip.changeOwner,ldbMip.changeStatusInSFDCCampaign,ldbMip.convertLead,ldbMip.createTask,ldbMip.deleteLeadFromSFDC,ldbMip.pushLeadToSFDC,ldbMip.removeFromSFDCCampaign]}});};MktLeadDbMenu.smartListFolderMenu=function(){return MktLeadDbMenu.menuFactory("smartListFolderMenu",ldbMip.newSmartList,fMip.share,'-',fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);};MktLeadDbMenu.listFolderMenu=function(){return MktLeadDbMenu.menuFactory("listFolderMenu",ldbMip.newList,ldbMip.importList,fMip.share,'-',fMip.createFolder,fMip.renameFolder,fMip.deleteFolder,fMip.convertToArchiveFolder,fMip.convertToFolder);};MktLeadDbMenu.leadDbMenu=function(){return MktLeadDbMenu.menuFactory("leadDbMenu",ldbMip.newSmartList,ldbMip.newList,ldbMip.importList,ldbMip.newLead,MktPage.savedState.MPA?Mkt.menus.dataMgr.menuItemPool.newDataMgr:'');};MktLeadDbMenu.showContextItems=function(menu,show){var s=menu.items.get('contextSpacer');if(s){s.setVisible(show);}
s=menu.items.get('showExportStatus');if(s){s.setDisabled(false);}};MktLeadDbMenu.preShowContextMenu=function(menu,attr){var mItems=menu.items;if(attr&&!attr.folder){mItems.get('exportList').setDisabled(attr.nodeType!='List'&&attr.nodeType!='Smart List');mItems.get('navigateToMembership').setVisible(false);mItems.get('navigateToSmartList').setVisible(false);mItems.get('navigateToFilterView').setVisible(false);mItems.get('cloneList').setVisible(attr.nodeType=='List');mItems.get('navigateToSeparator').setVisible(true);mItems.get('showExportStatus').setDisabled(false);mItems.get('importList').setVisible(!attr.readonly);mItems.get('showImportStatus').setVisible(!attr.readonly);mItems.get('deleteList').setDisabled(attr.readonly);mItems.get('cloneSmartlist').setVisible(true);}};MktLeadDbMenu.preShowOverviewListMenu=function(menu){var mItems=menu.items;mItems.get('exportList').setDisabled(true);mItems.get('deleteList').setDisabled(true);mItems.get('showExportStatus').setDisabled(true);mItems.get('showImportStatus').setDisabled(true);mItems.get('cloneSmartlist').setVisible(false);};MktLeadDbMenu.preShowHideNavigateTo=function(menu){var mItems=menu.items;mItems.get('navigateToMembership').setVisible(isDefined(menu.currNode));mItems.get('navigateToSmartList').setVisible(isDefined(menu.currNode));mItems.get('navigateToFilterView').setVisible(isDefined(menu.currNode));mItems.get('navigateToSeparator').setVisible(isDefined(menu.currNode));};MktLeadDbMenu.preShowALeadsListMenu=MktLeadDbMenu.preShowULeadsListMenu=MktLeadDbMenu.preShowSAddressesListMenu=MktLeadDbMenu.preShowBAddressesListMenu=MktLeadDbMenu.preShowPDuplicatesListMenu=MktLeadDbMenu.preShowMSuspendedListMenu=MktLeadDbMenu.preShowDSalesListMenu=MktLeadDbMenu.preShowNAcqProgListMenu=MktLeadDbMenu.preShowSystemSmartListMenu=function(menu){var mItems=menu.items;mItems.get('navigateToMembership').setVisible(false);mItems.get('navigateToSmartList').setVisible(false);mItems.get('navigateToFilterView').setVisible(false);mItems.get('navigateToSeparator').setVisible(false);mItems.get('showImportStatus').setDisabled(true);mItems.get('showImportStatus').setVisible(false);mItems.get('exportList').setDisabled(false);mItems.get('deleteList').setDisabled(true);mItems.get('cloneSmartlist').setVisible(true);mItems.get('importList').setVisible(false);};MktLeadDbMenu.preShowALeadsLeadMenu=MktLeadDbMenu.preShowULeadsLeadMenu=MktLeadDbMenu.preShowSAddressesLeadMenu=MktLeadDbMenu.preShowBAddressesLeadMenu=MktLeadDbMenu.preShowPDuplicatesLeadMenu=MktLeadDbMenu.preShowMSuspendedLeadMenu=MktLeadDbMenu.preShowDSalesLeadMenu=MktLeadDbMenu.preShowNAcqProgLeadMenu=MktLeadDbMenu.preShowSystemSmartListLeadActionsMenu=function(menu){var mItems=menu.items;var numSelected=MktLeadDb.grid.getSelectionModel().getCount();mItems.get('viewLeadDetails').setDisabled(numSelected!=1);mItems.get('leadDbMenuFlowActions').setDisabled(numSelected<1);var mergeLeads=mItems.get('mergeLeads');if(mergeLeads){mergeLeads.setDisabled(numSelected<2);}};MktLeadDbMenu.preShowListListMenu=function(menu){var mItems=menu.items;mItems.get('exportList').setDisabled(false);mItems.get('deleteList').setDisabled(false);mItems.get('cloneList').setVisible(true);mItems.get('importList').setVisible(true);mItems.get('showImportStatus').setVisible(true);mItems.get('showImportStatus').setDisabled(false);mItems.get('cloneSmartlist').setVisible(false);mItems.get('navigateToMembership').setVisible(false);mItems.get('navigateToSmartList').setVisible(false);mItems.get('navigateToFilterView').setVisible(false);var createCachedList=mItems.get('createCachedList');if(createCachedList){createCachedList.setVisible(false);}};MktLeadDbMenu.preShowListLeadMenu=function(menu){var mItems=menu.items;if(isDefined(MktLeadDb.grid)){var numSelected=MktLeadDb.grid.getSelectionModel().getCount();}else{var numSelected=0;}
mItems.get('viewLeadDetails').setDisabled(numSelected!=1);var mergeLeads=mItems.get('mergeLeads');if(mergeLeads){mergeLeads.setDisabled(numSelected<2);}
mItems.get('leadDbMenuFlowActions').setDisabled(numSelected<1);};MktLeadDbMenu.preShowCampaignListMenu=function(menu){var mItems=menu.items;MktLeadDbMenu.preShowHideNavigateTo(menu);mItems.get('exportList').setDisabled(isDefined(menu.currNode));mItems.get('deleteList').setDisabled(true);mItems.get('importList').setVisible(false);mItems.get('showImportStatus').setVisible(false);mItems.get('cloneSmartlist').setVisible(false);};MktLeadDbMenu.preShowLocalListMenu=function(menu){var mItems=menu.items;mItems.get('navigateToMembership').setVisible(true);mItems.get('navigateToSmartList').setVisible(true);mItems.get('navigateToFilterView').setVisible(true);mItems.get('navigateToSeparator').setVisible(true);mItems.get('navigateToFilterView').setVisible(false);mItems.get('cloneList').setVisible(false);mItems.get('exportList').setDisabled(false);mItems.get('deleteList').setDisabled(false);mItems.get('importList').setVisible(false);mItems.get('showImportStatus').setVisible(false);mItems.get('cloneSmartlist').setVisible(true);mItems.get('createCachedList').setVisible(false);};MktLeadDbMenu.preShowReportListMenu=function(menu){var mItems=menu.items;MktLeadDbMenu.preShowHideNavigateTo(menu);mItems.get('navigateToFilterView').setVisible(false);mItems.get('exportList').setDisabled(false);mItems.get('deleteList').setDisabled(true);mItems.get('importList').setVisible(false);mItems.get('cloneList').setVisible(false);mItems.get('showImportStatus').setVisible(false);mItems.get('cloneSmartlist').setVisible(true);};MktLeadDbMenu.preShowCampaignLeadMenu=function(menu){var mItems=menu.items,items;MktLeadDbMenu.showContextItems(menu,false);if(isDefined(MktLeadDb.grid)){var numSelected=MktLeadDb.grid.getSelectionModel().getCount();}else{var numSelected=0;}
mItems.get('viewLeadDetails').setDisabled(numSelected!=1);var mergeLeads=mItems.get('mergeLeads');if(mergeLeads){mergeLeads.setDisabled(numSelected<2);}
mItems.get('leadDbMenuFlowActions').setDisabled(numSelected<1);};MktLeadDbMenu.preShowUserListMenu=function(menu){var mItems=menu.items;MktLeadDbMenu.preShowHideNavigateTo(menu);mItems.get('navigateToFilterView').setVisible(false);mItems.get('exportList').setDisabled(false);mItems.get('deleteList').setDisabled(false);mItems.get('importList').setVisible(false);mItems.get('showImportStatus').setVisible(false);mItems.get('cloneSmartlist').setVisible(true);var createCachedList=mItems.get('createCachedList');if(createCachedList){createCachedList.setVisible(MktPage.xfeatures);}};MktLeadDbMenu.preShowUserLeadMenu=function(menu){var mItems=menu.items;var numSelected=MktLeadDb.grid.getSelectionModel().getCount();mItems.get('viewLeadDetails').setDisabled(numSelected!=1);var mergeLeads=mItems.get('mergeLeads');if(mergeLeads){mergeLeads.setDisabled(numSelected<2);}
mItems.get('leadDbMenuFlowActions').setDisabled(numSelected<1);};MktLeadDbMenu.showContextMenu=function(node,e){var compType,menu;var attr=node.attributes;var xtraAttr=attr.xtra;var type;if(attr.nodeType=='Marketing Folder'){return;}else if(xtraAttr&&xtraAttr.type){type=xtraAttr.type;}else if((attr&&attr.folder)||attr.nodeType=='List'||attr.nodeType=='Smart List'){type='LeadDb';}else{return;}
menu=MktMenuMgr.getMenu(type,attr);if(menu){menu.currNode=node;MktLeadDbMenu.showContextItems(menu,true);MktLeadDbMenu.preShowContextMenu(menu,attr);var s=menu.items.get('removeBookmark');if(s){s.setVisible(false);}
if(xtraAttr&&!attr.folder){var compType=xtraAttr.compType;var compSubtype=xtraAttr.compSubtype;if(compType=='List'){MktLeadDbMenu.preShowListListMenu(menu);}
else if(compSubtype=='Smart Campaign'){MktLeadDbMenu.preShowCampaignListMenu(menu);}
else if(compSubtype=='Report'){console.debug('showing report menu');MktLeadDbMenu.preShowReportListMenu(menu);}
else if(compType=='Smart List'){MktLeadDbMenu.preShowUserListMenu(menu);}
else{return;}}
menu.showAt(e.xy);if(xtraAttr){menu.listCompType=attr.nodeType;menu.leadDbSmartListId=xtraAttr.compId;menu.leadDbNodeId=xtraAttr.nodeId;menu.listName=attr.text;}
Mkt.main.ExplorerPanel.nodeContextMenuSetup(node,menu);e.stopEvent();}};})();MktMenuMgr.registerMenuProvider('LeadDb',function(attr){var menu,xtraAttr=attr.xtra;if(attr.folder||xtraAttr){if(xtraAttr){var compType=xtraAttr.compSubtype||xtraAttr.compType||attr.nodeType;}
else{var compType=attr.nodeType;}
if(compType=='List'||compType=='Smart List'){if(attr.folder){if(attr.text=='System Smart Lists'||attr.text=='Campaign Smart Lists'||attr.text=='System Campaigns'||attr.text=='System Lists'||attr.nodeType=='Marketing Folder'){return false;}
var isArchive=false;if(attr.xtra&&attr.xtra.isArchive){isArchive=attr.xtra.isArchive;}
if(attr.nodeType=='List'){menu=MktLeadDbMenu.listFolderMenu();}else if(attr.nodeType=='Smart List'){menu=MktLeadDbMenu.smartListFolderMenu();}
var isArchiveAllowed=MktFolder.isArchiveAllowed(attr);menu.items.get('convertToArchiveFolder').setVisible(!isArchive&&isArchiveAllowed);menu.items.get('convertToFolder').setVisible(isArchive&&isArchiveAllowed);if((attr.text=='My Lists'||attr.text=='My Smart Lists')&&attr.system){menu.items.get('renameFolder').disable();menu.items.get('deleteFolder').disable();menu.items.get('share').setVisible(false);}else{menu.items.get('renameFolder').enable();menu.items.get('deleteFolder').enable();var node=MktExplorer.getNodeById(attr.id);var showShare=false;var allowableShareDepth=3;if(MktPage.savedState.multiZone&&node&&node.getDepth()==allowableShareDepth&&!attr.isShared){showShare=true;}
menu.items.get('share').setVisible(showShare);}
attr.menu=menu;}else{attr.menu=MktLeadDbMenu.listMenu();MktLeadDbMenu.preShowContextMenu(attr.menu,attr);}
return true;}else if((compType=='Smart Campaign'||compType=='Report')&&!attr.folder){attr.menu=MktLeadDbMenu.listMenu();MktLeadDbMenu.preShowContextMenu(attr.menu,attr);return true;}}else{return false;}});(function(){var leadDb=Mkt.app.LeadDb=Mkt.app.LeadDb||{};Mkt.app.LeadDb.getSmartlistToolbar=function(attr){var items=[];if(!MktPage.satellite&&!attr.marketingProgramId){items.push({text:'New',sticky:true,iconCls:'mkiData',xtype:'mkttbbutton',menu:MktLeadDbMenu.leadDbMenu()});}
items.push({text:'List Actions',sticky:true,xtype:'mkttbbutton',menuPreShowCb:function(arg1,arg2){if(arg1.currNode){arg1.currNode=undefined;}
MktLeadDbMenu['preShow'+attr.leadDbMenuSelector+'ListMenu'].apply(this,arguments);},menu:MktLeadDbMenu.listMenu()});return items;};leadDb.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(leadDb.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=leadDb.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}else{ret.comp=leadDb.Toolbar.getLeadDb(attr);}}
Mkt.menus.ToolbarMgr.registerComp('LeadDb',toolbarRequestHandler);return{getHome:function(attr){var items=[{text:'New',iconCls:'mkiData',xtype:'mkttbbutton',menu:MktLeadDbMenu.leadDbMenu()}];return new Ext.Toolbar({items:items});},getLeadDb:function(attr){if(attr.getGotoOnly){var items=[];}
else{var items=[{itemId:'leadDbMenuLeadActions'+MktUtil.camelCase(attr.panelId),text:'Lead Actions',iconCls:'mkiUser',xtype:'mkttbbutton',menuPreShowCb:MktLeadDbMenu['preShow'+attr.leadDbMenuSelector+'LeadMenu'].createDelegate(attr),menu:MktLeadDbMenu.leadMenu()},'-',{text:'Delete Lead',itemId:'deleteLead'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUserDelete',disabled:true,handler:function(button,e){Mkt.app.LeadDb.deleteLeads({tiggeredFrom:'button',el:button.getEl()});}}];if(attr.leadDbMenuSelector=='PDuplicates'){items.push({itemId:'mergeLeads'+MktUtil.camelCase(attr.panelId),text:'Merge Leads',disabled:true,iconCls:'mkiRefresh',handler:function(button,e){MktLeadDb.grid.showConflictFieldsRequest(button.el);}});}
if(attr.leadDbMenuSelector=="List"){items.push({text:'Remove from List',itemId:'removeFromList'+MktUtil.camelCase(attr.panelId),iconCls:'mkiIndexDelete',disabled:true,handler:function(button,e){var accessZoneId=Mkt.util.Common.getNodeAttrValue(null,'accessZoneId',true);MktLeadDb.grid.runActionModalShow(button.getEl(),MktLeadDb.ActivityTypes.RemoveFromList,{accessZoneId:accessZoneId});}});}
items.push({text:'Select All',iconCls:'mkiDocumentCheck',handler:function(button,e){MktLeadDb.grid.selectAllRows();}});}
if(attr.itemsOnly){return items;}
return new Ext.Toolbar({items:items});},updateLeadDbToolbarState:function(attr){var states=Mkt.app.LeadDb.getActionStates(attr);var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));if(panel){var tb=panel.getTopToolbar();if(tb&&tb.items){var delLead=tb.items.get('deleteLead'+MktUtil.camelCase(attr.panelId));if(delLead){delLead.setDisabled(states.disableDeleteLead);}
var mergeLeads=tb.items.get('mergeLeads'+MktUtil.camelCase(attr.panelId));if(mergeLeads){mergeLeads.setDisabled(states.disableMergeLeads);}
var removeList=tb.items.get('removeFromList'+MktUtil.camelCase(attr.panelId));if(removeList){removeList.setDisabled(states.disableDeleteLead);}}}}};}();})();
/* ========== ../mkt-ext-2.0/menus/MarketingEventMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.marketingEvent');Mkt.menus.marketingEvent.Toolbar=function(){function toolbarRequestHandler(attr,ret){var getterFunc=attr.subType;if(!getterFunc){getterFunc=attr.type;}
if(isFunction(Mkt.menus.marketingEvent.Toolbar['get'+MktUtil.camelCase(getterFunc)])){ret.comp=Mkt.menus.marketingEvent.Toolbar['get'+MktUtil.camelCase(getterFunc)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('MarketingEvent',toolbarRequestHandler);Mkt.menus.ToolbarMgr.registerComp('MarketingProgram',toolbarRequestHandler);return{preShowMarketingProgramActions:function(menu,attr){},preShowMarketingEventActions:function(menu,attr){},preShowMarketingEventChangeStatus:function(menu,attr){var disabled=!MktCanvas.getActiveTab().getGridPanel().hasSelection();menu.items.each(function(){this.setDisabled(disabled);});},updateMarketingEventToolbarState:function(){},getMarketingEvent:function(attr){var items=[];items.push(this.getMarketingEventNew(attr));items.push(this.getMarketingEventActions(attr));if(attr.panelId=='maMembers'){items.push(this.getMarketingEventChangeStatus(attr));items.push('-');items.push(this.getMarketingEventSelectAll(attr));items.push(this.getImportList(attr));}
else if(attr.panelId=='showTokens'){items=items.concat(this.getTokensToolbarButtons());}
else if(attr.panelId=='maSettings'){items=items.concat(this.getCostToolbarButtons());}
return new Ext.Toolbar({items:items});},getMarketingEventNew:function(attr){return Mkt.app.MarketingActivities.Toolbar.getNewEventMenuButton();},getMarketingEventActions:function(attr){var items=[];var mep=Mkt.menus.marketingEvent.menuItemPool;items.push(mep.eventSchedule);items.push(mep.webinarSettings);if(MktPage.savedState.sfdcCampaignSyncEnabled){items.push(mep.sfdcCampaignSync);}
items.push('-');items.push(mep.cloneMarketingEvent);items.push(mep.deleteMarketingEvent);if(attr.hasWebinar){items.push('-');items.push(this.getMarketingEventUpdate());}
items.push('-');items.push(mep.showImportMemberStatus);items.push(mep.showExportMemberStatus);return{text:'Event Actions',xtype:'mkttbbutton',iconCls:'mkiCal',menuPreShowCb:this.preShowMarketingEventActions,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getMarketingProgram:function(attr){var items=[];items.push(this.getMarketingEventNew(attr));items.push(this.getMarketingProgramActions(attr));if(attr.panelId=='maMembers'){items.push(this.getMarketingEventChangeStatus(attr));items.push('-');items.push(this.getMarketingEventSelectAll(attr));items.push(this.getImportList(attr));}
else if(attr.panelId=='showTokens'){items=items.concat(this.getTokensToolbarButtons());}
else if(attr.panelId=='maSettings'){items=items.concat(this.getCostToolbarButtons());}
return new Ext.Toolbar({items:items});},getTokensToolbarButtons:function(){var items=['-'];var customTokenItems=Mkt.apps.customtoken.menuItems;items.push(customTokenItems.editMenu);return items;},getCostToolbarButtons:function(){var items=['-'];var marketingProgramSettingItems=Mkt.apps.marketingprogramsettings.menuItems;items.push(marketingProgramSettingItems.editMenu);items.push(marketingProgramSettingItems.deleteMenu);return items;},getMarketingProgramActions:function(attr){var items=[];var mep=Mkt.menus.marketingEvent.menuItemPool;if(MktPage.savedState.sfdcCampaignSyncEnabled){items.push(mep.sfdcCampaignSync);items.push('-');}
items.push(mep.cloneMarketingProgram);items.push(mep.deleteMarketingProgram);items.push('-');items.push(mep.showImportMemberStatus);items.push(mep.showExportMemberStatus);return{text:'Program Actions',xtype:'mkttbbutton',iconCls:'mkiWalletClosed',menuPreShowCb:this.preShowMarketingProgramActions,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getMarketingEventSelectAll:function(attr){return{text:'Select All',iconCls:'mkiDocumentCheck',handler:function(button,e){MktCanvas.getActiveTab().getGridPanel().selectAll();}};},getImportList:function(attr){return{text:'Import Members',itemId:'importMembers',iconCls:'mkiUsers2Down',handler:MktLeadDbMenu.menuItemPool.importList.handler}},getMarketingEventChangeStatus:function(attr){var items=[];var statuss=attr.statuss;for(var i=0;i<statuss.length;i++){var aStatus=statuss[i];if(aStatus['IsHidden']){continue;}
var statusItem={text:aStatus['Name'],itemId:aStatus['Name']+'StatusMarketingEvent',iconCls:'mkiArrow2UpRightGreen',handler:function(el,a,b){el.parentMenu.hide(true);var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;var grid=tab.getGridPanel();Mkt.apps.marketingEvent.Actions.changeStatusInProgression(compId,this.text,grid);}};items.push(statusItem);}
return{text:'Change Status',xtype:'mkttbbutton',iconCls:'mkiArrow2UpRightGreen',menuPreShowCb:this.preShowMarketingEventChangeStatus,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getMarketingEventNewField:function(attr){return{text:'New Field',iconCls:'mkiBranchAdd',handler:function(button,e){var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;Mkt.apps.marketingEvent.Actions.createNewField(compId);}};},getMarketingEventUpdate:function(attr){return{text:'Refresh from Webinar Provider',iconCls:'mkiNavRefreshGreen',handler:function(button,e){var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;Mkt.apps.marketingEvent.Actions.updateEvent(compId);}};}};}();Mkt.menus.marketingEvent.menuItemPool={createNewMarketingEvent:{text:'New Event',itemId:'createNewMarketingEvent',iconCls:'mkiCal',handler:function(el){var parentFolderId;var accessZoneId="";var currNode=null;if(el.parentMenu&&el.parentMenu.currNode){currNode=el.parentMenu.currNode}
if(currNode){accessZoneId=currNode.attribtues.accessZoneId;parentFolderId=el.parentMenu.currNode.attributes.id;delete el.parentMenu.currNode;}
else{var activeTab=MktCanvas.getActiveTab();var config=activeTab.config;var accessZoneId=activeTab.config.accessZoneId;if(config.compType&&(config.compType=='Marketing Event'||config.compType=='Marketing Program')){parentFolderId=parseInt(activeTab.config.expParentNodeId);}
else{parentFolderId=parseInt(activeTab.config.expNodeId);}}
Mkt.apps.marketingEvent.Actions.createNewMarketingEvent(parentFolderId,el.getEl());el.parentMenu.hide(true);}},cloneMarketingEvent:{text:'Clone',itemId:'cloneMarketingEvent',iconCls:'mkiCalAdd',handler:function(el){var parentFolderId;var accessZoneId="";var currNode=null;if(el.parentMenu&&el.parentMenu.currNode){currNode=el.parentMenu.currNode}
if(currNode){parentFolderId=currNode.attributes.parentId;delete el.parentMenu.currNode;}
else{var activeTab=MktCanvas.getActiveTab();var config=activeTab.config;var accessZoneId=activeTab.config.accessZoneId;if(config.compType&&config.compType=='Marketing Event'){parentFolderId=activeTab.config.expParentNodeId;}
else{parentFolderId=activeTab.config.expNodeId;}}
var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var meActions=Mkt.apps.marketingEvent.Actions;meActions.cloneMarketingEvent.call(meActions,sels[0].id,sels[0].name,parentFolderId,el.getEl(),accessZoneId);}
if(el.parentMenu.currNode){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}},deleteMarketingEvent:{text:'Delete',itemId:'deleteMarketingEvent',iconCls:'mkiCalDelete',handler:function(el){var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var meActions=Mkt.apps.marketingEvent.Actions;meActions.deleteMarketingProgram.call(meActions,sels[0].id,sels[0].name,el.getEl(),true);}
if(el.parentMenu.currNode){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}},webinarSettings:{text:'Event Settings',itemId:'webinarSettings',iconCls:'mkiMonitor',handler:function(el){var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var activeTab=MktCanvas.getActiveTab();if(activeTab){var meActions=Mkt.apps.marketingEvent.Actions;meActions.editWebinarSettings.call(meActions,activeTab.config.compId);}
el.parentMenu.hide(true);}},sfdcCampaignSync:{text:'Salesforce Campaign Sync',itemId:'sfdcCampaignSync',iconCls:'mkiSalesforce',handler:function(item){var activeTab=MktCanvas.getActiveTab();if(!activeTab)return;Mkt.apps.marketingEvent.Actions.editSfdcCampaignSync.call(Mkt.apps.marketingEvent.Actions,activeTab.config.compId,item.getEl());}},eventSchedule:{text:'Schedule',itemId:'eventSchedule',iconCls:'mkiCalClock',handler:function(el){var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var activeTab=MktCanvas.getActiveTab();if(activeTab){var meActions=Mkt.apps.marketingEvent.Actions;meActions.editEventSchedule.call(meActions,activeTab.config.compId);}
el.parentMenu.hide(true);}},createNewMarketingProgram:{text:'New Program',itemId:'createNewMarketingProgram',iconCls:'mkiWalletClosed',handler:function(el){var parentFolderId;var accessZoneId="";var currNode=null;if(el.parentMenu&&el.parentMenu.currNode){currNode=el.parentMenu.currNode}
if(currNode){parentFolderId=currNode.attributes.id;accessZoneId=currNode.attributes.accessZoneId
delete el.parentMenu.currNode;}
else{var activeTab=MktCanvas.getActiveTab();var config=activeTab.config;if(config.compType&&(config.compType=='Marketing Event'||config.compType=='Marketing Program')){parentFolderId=parseInt(activeTab.config.expParentNodeId);}
else{parentFolderId=parseInt(activeTab.config.expNodeId);}
accessZoneId=activeTab.config.accessZoneId;}
Mkt.apps.marketingEvent.Actions.createNewMarketingProgram(parentFolderId,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},cloneMarketingProgram:{text:'Clone',itemId:'cloneMarketingProgram',iconCls:'mkiWalletClosedAdd',handler:function(el){var parentFolderId;var accessZoneId="";var currNode=null;if(el.parentMenu&&el.parentMenu.currNode){currNode=el.parentMenu.currNode}
if(currNode){parentFolderId=currNode.attributes.id;accessZoneId=currNode.attributes.accessZoneId
delete el.parentMenu.currNode;}
else{var activeTab=MktCanvas.getActiveTab();var config=activeTab.config;accessZoneId=activeTab.config.accessZoneId;if(config.compType&&config.compType=='Marketing Program'){parentFolderId=activeTab.config.expParentNodeId;}
else{parentFolderId=activeTab.config.expNodeId;}}
var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var meActions=Mkt.apps.marketingEvent.Actions;meActions.cloneMarketingProgram.call(meActions,sels[0].id,sels[0].name,parentFolderId,el.getEl(),accessZoneId);}
if(el.parentMenu.currNode){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}},showImportMemberStatus:{text:'Show Import Status',itemId:'showImportMemberStatus',iconCls:'mkiClockUp',handler:MktLeadDbMenu.menuItemPool.showImportStatus.handler},showExportMemberStatus:{text:'Show Export Status',itemId:'showExportMemberStatus',iconCls:'mkiClockDown',handler:MktLeadDbMenu.menuItemPool.showExportStatus.handler},deleteMarketingProgram:{text:'Delete',itemId:'deleteMarketingProgram',iconCls:'mkiWalletClosedDelete',handler:function(el){var action={triggeredFrom:this.parentMenu.triggeredFrom,useCanvasConfig:true,xtra:el.parentMenu.xtra};var sels=Mkt.util.Common.getSelections(action);if(sels&&sels.length>0){var meActions=Mkt.apps.marketingEvent.Actions;meActions.deleteMarketingProgram.call(meActions,sels[0].id,sels[0].name,el.getEl(),false);}
if(el.parentMenu.currNode){delete el.parentMenu.currNode;}
el.parentMenu.hide(true);}}};
/* ========== ../mkt-ext-2.0/menus/LocalAssetMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.localasset');Mkt.menus.localasset.menuItemPool={createLocalAssetEmail:{text:'New Email',itemId:'createLocalAssetEmail',iconCls:'mkiMail2',handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;compId=config.compId;parentFolderId=parseInt(config.expNodeId);accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalAssetEmail(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},createLocalAssetLandingPage:{text:'New Landing Page',itemId:'createLocalAssetLandingPage',iconCls:'mkiWebpage',handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;parentFolderId=parseInt(config.expNodeId);compId=config.compId;accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalAssetLandingPage(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},createLocalAssetForm:{text:'New Form',itemId:'createLocalAssetForm',iconCls:'mkiFormBlue',handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;parentFolderId=parseInt(config.expNodeId);compId=config.compId;accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalAssetForm(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},createLocalAssetList:{text:'New List',itemId:'createLocalAssetList',iconCls:'mkiIndex',handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;compId=config.compId;parentFolderId=parseInt(config.expNodeId);accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalAssetList(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},createLocalAssetSmartList:{text:'New Smart List',itemId:'createLocalAssetSmartList',iconCls:'mkiDocumentPlainNew',hideOnClick:true,handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;compId=config.compId;parentFolderId=parseInt(config.expNodeId);accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalAssetSmartList(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}},createLocalTestGroup:{text:'New Test Group',itemId:'newTestGroup',iconCls:'mkiCustAbtest',handler:function(el){var compName;var parentFolderId;var compId="";var accessZoneId="";var currNode=el.parentMenu.parentMenu.currNode;if(currNode){compName=currNode.text;parentFolderId=currNode.attributes.id;if(currNode.attributes.compType=='Marketing Program'||currNode.attributes.compType=='Marketing Event'){compId=currNode.attributes.compId;}
else{compId=currNode.attributes.xtra.marketingProgramId;}
accessZoneId=currNode.attributes.accessZoneId;}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;compId=config.compId;parentFolderId=parseInt(config.expNodeId);accessZoneId=config.accessZoneId;}
Mkt.apps.localasset.MenuActions.createLocalTestGroup(compId,parentFolderId,compName,el.getEl(),accessZoneId);el.parentMenu.hide(true);}}};Ext.apply(Mkt.menus.localasset.menuItemPool,{newLocalAsset:{text:'New Local Asset',itemId:'newLocalAsset',iconCls:'mkiObjects',menu:{items:[Mkt.menus.localasset.menuItemPool.createLocalAssetEmail,Mkt.menus.localasset.menuItemPool.createLocalAssetLandingPage,Mkt.menus.localasset.menuItemPool.createLocalAssetForm,Mkt.menus.localasset.menuItemPool.createLocalAssetList,Mkt.menus.localasset.menuItemPool.createLocalAssetSmartList,Mkt.menus.localasset.menuItemPool.createLocalTestGroup]}}});
/* ========== mktMaMenu.js ============ */

Ext.namespace('MktMaMenu');MktMaMenu.preShowProgramActionsMenu=function(menu,attr){var mItems=menu.items,nodeType;var isAllPrograms=(attr.depth==1);var attrXtra=attr.xtra;if(attr.nodeType){nodeType=attr.nodeType;}else if(attrXtra&&attrXtra.compType){nodeType=attrXtra.compType;}else{return menu;}
var isFolder=(nodeType=='Marketing Folder'||nodeType=='Zone');var isProgram=(nodeType=='Marketing Program');var isEvent=(nodeType=='Marketing Event');var isCampaign=(nodeType=='Smart Campaign');var isZone=nodeType=='Zone';var isArchive=false;if(isDefined(attrXtra)){isArchive=attrXtra.isArchive;}
if(attrXtra&&attrXtra.marketingProgramId){var marketingProgramId=attrXtra.marketingProgramId;}
var isArchiveAllowed=MktFolder.isArchiveAllowed(attr);mItems.get('createProgramFolder').setVisible(isFolder||isProgram||isEvent);mItems.get('convertToArchiveFolder').setVisible(isFolder&&!isArchive&&isArchiveAllowed);mItems.get('convertToCampaignFolder').setVisible(isFolder&&isArchive&&isArchiveAllowed);var showShare=MktFolder.isShowShare(attr);mItems.get('shareProgramFolder').setVisible(showShare);var rProg=mItems.get('renameProgramFolder');if(rProg){rProg.setVisible(isFolder);rProg.setDisabled(isAllPrograms);}
var dProg=mItems.get('deleteProgramFolder');if(dProg){dProg.setVisible(isFolder);dProg.setDisabled(isAllPrograms);}
mItems.get('newSmartCampaign').setVisible(((isFolder||isEvent||isProgram)&&nodeType!='Zone'));mItems.get('newLocalAsset').setVisible(isEvent||isProgram||(isFolder&&marketingProgramId));mItems.get('cloneMarketingEvent').setVisible(isEvent);mItems.get('cloneMarketingProgram').setVisible(isProgram);mItems.get('scActivate').setVisible(false);mItems.get('scArchive').setVisible(!isFolder&&!isEvent&&!isProgram);mItems.get('scClone').setVisible(!isFolder&&!isEvent&&!isProgram);var navVisible=nodeType=='Smart Campaign'&&!isDefined(attr.disableNavigateTo);var cfNavVisible=nodeType=='Marketing Folder'&&!isDefined(attr.disableNavigateTo);if(marketingProgramId){cfNavVisible=false;}
var createProgramFolderMenuItem=mItems.get('createProgramFolder');if(createProgramFolderMenuItem){createProgramFolderMenuItem.setText(marketingProgramId||isProgram||isEvent?'New Folder':'New Campaign Folder');}
var isCloneable=(nodeType=='Smart Campaign'&&attr.subType!="runonce");mItems.get('scClone').setDisabled(!isCloneable);mItems.get('navigateToSmartCampaign').setVisible(navVisible);mItems.get('navigateToSmartList').setVisible(navVisible);mItems.get('navigateToFlow').setVisible(navVisible);mItems.get('navigateToSchedule').setVisible(navVisible);mItems.get('navigateToResults').setVisible(navVisible);mItems.get('navigateToCampaignMembers').setVisible(navVisible);mItems.get('navigateToCFSmartCamp').setVisible(cfNavVisible);mItems.get('navigateToCFTokens').setVisible((cfNavVisible||isEvent||isProgram));mItems.get('navigateToCFResults').setVisible(cfNavVisible);var showCreateSpacer=false;var showActionSpacer=true;if(isZone||attr.triggeredFrom!='tree'||(marketingProgramId&&!isCampaign)){showActionSpacer=false;}
else if(!isCampaign){showCreateSpacer=true;}
mItems.get('createSpacer').setVisible(showCreateSpacer);mItems.get('actionSpacer').setVisible(showActionSpacer);var showCreateNewMarketingEvent=isFolder&&!isZone&&!marketingProgramId&&MktPage.savedState.marketingEventEnabled;var showRenameMarketingEvent=isEvent;var showDeleteMarketingEvent=isEvent;mItems.get('deleteMarketingEvent').setVisible(showDeleteMarketingEvent);var showCreateNewMarketingProgram=isFolder&&!isZone&&!marketingProgramId&&MktPage.savedState.marketingProgramEnabled;var showRenameMarketingProgram=isProgram;var showDeleteMarketingProgram=isProgram;mItems.get('createNewMarketingProgram').setVisible(showCreateNewMarketingProgram);mItems.get('deleteMarketingProgram').setVisible(showDeleteMarketingProgram);mItems.get('navigateToEventMembers').setVisible(isEvent||isProgram);mItems.get('navigateToLocalAssets').setVisible(isEvent||isProgram);mItems.get('navigateToEventSettings').setVisible(isEvent||isProgram);var isDev=MktPage.isDev()||MktPage.xfeatures;mItems.get('devModeSpacer').setVisible(isDev);mItems.get('scClearSmartList').setVisible(isDev);mItems.get('scClearFlow').setVisible(isDev);mItems.get('scClearPalette').setVisible(isDev);mItems.get('progGenerateRef').setVisible(isDev&&(isEvent||isProgram));return menu;};MktMaMenu.preShowProgressionActionsMenu=function(menu,attr){};MktMaMenu.menuItemPool={newProgram:{text:'New Campaign Folder',itemId:'newProgram',iconCls:'mkiFolder',handler:function(el){var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktAppJS.phcDriveCreateProgramModal(el.getEl(),accessZoneId);el.parentMenu.hide(true);}},newSmartCampaign:{text:'New Smart Campaign',itemId:'newSmartCampaign',iconCls:'mkiLightbulbOn',handler:function(el){var compName;var isEvent=false;var isProgram=false;var compId;var marketingFolderId;var currNode=el.parentMenu.currNode;if(currNode){compName=currNode.text;isEvent=currNode.attributes.compType=='Marketing Event';isProgram=currNode.attributes.compType=='Marketing Program';if(!isProgram){compId=currNode.attributes.marketingProgramId;if(compId){isProgram=true;}}
if(compId&&currNode.attributes.compType=='Marketing Folder'){marketingFolderId=currNode.attributes.compId;}}
else{var config=MktCanvas.getActiveTab().config;compName=config.compName;isEvent=config.compType=='Marketing Event';isProgram=config.compType=='Marketing Program';}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(currNode,'accessZoneId',true);if(!isEvent&&!isProgram){MktAppJS.chcDriveCreateSmartCampaignModal(el.getEl(),compName,undefined,accessZoneId);}
else{if(!compId){compId=Mkt.util.Common.getNodeAttrValue(currNode,'compId',true);}
Mkt.apps.marketingEvent.Actions.createSubCampaign(compId,compName,marketingFolderId,el.getEl(),accessZoneId);}
el.parentMenu.hide(true);}},createProgramFolder:{text:'New Campaign Folder',itemId:'createProgramFolder',iconCls:'mkiFolder',handler:function(el){el.parentMenu.hide(true);if(el.parentMenu.currNode){MktMa.newProgramFolderForm(el.parentMenu.currNode);delete el.parentMenu.currNode;}else{var accessZoneId=Mkt.util.Common.getNodeAttrValue(el.parentMenu.currNode,'accessZoneId',true);MktAppJS.phcDriveCreateProgramModal(el.getEl(),accessZoneId);}}},renameProgramFolder:{text:'Rename Folder',itemId:'renameProgramFolder',iconCls:'mkiFolderEdit',handler:function(el){MktMa.editProgramFolder(el.parentMenu.currNode,"renameProgramFolder");el.parentMenu.hide(true);}},deleteProgramFolder:{text:'Delete Folder',itemId:'deleteProgramFolder',iconCls:'mkiFolderDelete',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode&&currNode.attributes&&currNode.attributes.xtra){compId=currNode.attributes.xtra.compId;text=currNode.text;MktMa.deleteProgramFolder(compId,text,el.getEl());}
el.parentMenu.hide(true);}},shareProgramFolder:{text:'Share Folder',id:'shareProgramFolder',iconCls:'mkiUserEarth',handler:function(el){var currNode=el.parentMenu.currNode;var share=new Mkt.apps.ShareFolderForm({targetNode:currNode,folderId:currNode.id,folderName:currNode.text});el.parentMenu.hide(true);}},navigateToSmartCampaign:{text:'View Campaign',itemId:'navigateToSmartCampaign',iconCls:'mkiLightbulbOn',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;el.parentMenu.hide(true);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('SC',currNode.attributes.xtra.compId,'A',true),'_blank');}else{MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToSmartList:{text:'View Smart List',itemId:'navigateToSmartList',iconCls:'mkiUsers3',enablePopupItem:true,handler:function(el,e){var currNode=el.parentMenu.currNode;el.parentMenu.hide(true);var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('SC',xtra.compId,'B',true),'_blank');}else{if(xtra){xtra.panelId='campaignCanvasDetailSmartlist';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToFlow:{text:'View Flow',itemId:'navigateToFlow',iconCls:'mkiCubes',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('SC',xtra.compId,'C',true),'_blank');}else{if(xtra){xtra.panelId='campaignCanvasDetailFlow';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToSchedule:{text:'View Schedule',itemId:'navigateToSchedule',iconCls:'mkiClock',enablePopupItem:true,overCls:'mktPopup',handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('SC',xtra.compId,'D',true),'_blank');}else{if(xtra){xtra.panelId='campaignCanvasDetailSchedule';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToEventSettings:{text:'View Setup',itemId:'navigateToEventSettings',iconCls:'mkiTag',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=Ext.apply({},currNode.attributes.xtra);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){var isProgram=xtra.compType=='Marketing Program';var type=isProgram?'PG':'ME';window.open(MktDlManager.getDlUrl(type,xtra.compId,'C',true),'_blank');}else{if(xtra){xtra.panelId='maSettings';}
xtra.panelIndex=Mkt.apps.marketingEvent.constants.MARKETING_EVENT_SETTINGS_PANEL_INDEX;MktDlManager.loadDl(xtra);}}},navigateToResults:{text:'View Results',itemId:'navigateToResults',iconCls:'mkiScroll2',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('SC',xtra.compId,'E',true),'_blank');}else{if(xtra){xtra.panelId='campaignCanvasDetailActivityLog';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToCampaignMembers:{text:'View Campaign Members',itemId:'navigateToCampaignMembers',iconCls:'mkiUsersInto',enablePopupItem:true,handler:function(el,e){var compId;var nodeId;var currNode=MktMaMenu.menuItemPool.getCurrNode(el);if(currNode){compId=currNode.attributes.xtra.compId;nodeId=currNode.attributes.xtra.nodeId;}
var elTarget=Ext.get(e.target);window.open(MktDlManager.getDlUrl('SL',compId,'X',true),'_blank');el.parentMenu.hide(true);}},navigateToCFResults:{text:'View Results',itemId:'navigateToCFResults',iconCls:'mkiScroll2',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){var tabIndex='D';window.open(MktDlManager.getDlUrl('MF',xtra.compId,tabIndex,true),'_blank');}else{if(xtra){xtra.panelId='programActivityLog';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},navigateToCFTokens:{text:'View My Tokens',itemId:'navigateToCFTokens',iconCls:'mkiTokens',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var marketingEventTokenPanelIndex=Mkt.apps.marketingEvent.constants.MARKETING_EVENT_TOKENS_PANEL_INDEX;var marketingFolderTokenPanelIndex=2;var currNode=el.parentMenu.currNode;var xtra=Ext.apply({},currNode.attributes.xtra);var elTarget=Ext.get(e.target);var panelShortId;var dlShortCode;var panelIndex;if(xtra.compType=='Marketing Event'||xtra.compType=='Marketing Program'){panelShortId='D';panelIndex=marketingEventTokenPanelIndex;dlShortCode='ME';}
else{panelShortId='C';panelIndex=marketingFolderTokenPanelIndex;dlShortCode='MF';}
if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl(dlShortCode,xtra.compId,panelShortId,true),'_blank');}else{if(xtra){xtra.panelId='showTokens';}
xtra.panelIndex=panelIndex;MktDlManager.loadDl(xtra);}}},navigateToLocalAssets:{text:'View Assets',itemId:'navigateToLocalAssets',iconCls:'mkiObjects',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var marketingEventAssetPanelIndex=Mkt.apps.marketingEvent.constants.MARKETING_EVENT_ASSETS_PANEL_INDEX;var currNode=el.parentMenu.currNode;var xtra=Ext.apply({},currNode.attributes.xtra);var elTarget=Ext.get(e.target);var panelShortId;var dlShortCode;var panelIndex;if(xtra.compType=='Marketing Event'||xtra.compType=='Marketing Program'){panelShortId='B';panelIndex=marketingEventAssetPanelIndex;dlShortCode='ME';}
if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl(dlShortCode,xtra.compId,panelShortId,true),'_blank');}else{if(xtra){xtra.panelId='maLocalAssets';}
xtra.panelIndex=panelIndex;MktDlManager.loadDl(xtra);}}},navigateToEventMembers:{text:'View Members',itemId:'navigateToEventMembers',iconCls:'mkiUsersInto',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=Ext.apply({},currNode.attributes.xtra);var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){var isProgram=xtra.compType=='Marketing Program';var type=isProgram?'PG':'ME';window.open(MktDlManager.getDlUrl(type,xtra.compId,'E',true),'_blank');}else{if(xtra){xtra.panelId='maMembers';}
xtra.panelIndex=Mkt.apps.marketingEvent.constants.MARKETING_EVENT_MEMBERS_PANEL_INDEX;MktDlManager.loadDl(xtra);}}},navigateToCFSmartCamp:{text:'View Smart Campaigns',itemId:'navigateToCFSmartCamp',iconCls:'mkiLightbulbOn',enablePopupItem:true,handler:function(el,e){el.parentMenu.hide(true);var currNode=el.parentMenu.currNode;var xtra=currNode.attributes.xtra;var elTarget=Ext.get(e.target);if((elTarget&&elTarget.hasClass('mktPopupImage'))||(e.hasModifier()&&e.shiftKey)){window.open(MktDlManager.getDlUrl('MF',xtra.compId,'B',true),'_blank');}else{if(xtra){xtra.panelId='programCampaignActivity';}
MktDlManager.loadDl(currNode.attributes.xtra);}}},scClone:{text:'Clone',itemId:'scClone',iconCls:'mkiCustLightbulbOnAdd',handler:function(el){var nodeId;var currNode=MktMaMenu.menuItemPool.getCurrNode(el);if(currNode){nodeId=currNode.attributes.xtra.compId;}
MktAppJS.chcDriveCreateSmartCampaignModal(el.getEl(),null,nodeId);el.parentMenu.hide(true);}},scArchive:{text:'Delete',itemId:'scArchive',iconCls:'mkiLightbulbOnDelete',handler:function(el){var currNode=MktMaMenu.menuItemPool.getCurrNode(el);var attr=currNode.attributes;var xtraAttr=attr.xtra;MktMa.deleteSmartCampaign(xtraAttr.compId,xtraAttr.nodeId,attr.text,el.getEl());el.parentMenu.hide(true);}},scClearSmartList:{text:'Clear Smart List',itemId:'scClearSmartList',iconCls:'mkiUsers3Delete',handler:function(el){el.parentMenu.hide(true);var currNode=MktMaMenu.menuItemPool.getCurrNode(el);var xtra=currNode.attributes.xtra;MktMessage.confirm('Clear Smart List?','Remove all triggers and filters from this campaign?','Clear',function(){MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/clearSmartList',{serializeParms:{smartCampaignId:xtra.compId},onMySuccess:function(){console.debug('Cleared Smart List');MktSession.unclockCursor();MktCanvas.reloadActiveTab();}});});}},scClearFlow:{text:'Clear Flow',itemId:'scClearFlow',iconCls:'mkiFunnelDelete',handler:function(el){el.parentMenu.hide(true);var currNode=MktMaMenu.menuItemPool.getCurrNode(el);var xtra=currNode.attributes.xtra;MktMessage.confirm('Clear Flow?','Remove all flow steps from this campaign?','Clear',function(){MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/clearFlow',{serializeParms:{smartCampaignId:xtra.compId},onMySuccess:function(){console.debug('Cleared Flow');MktSession.unclockCursor();MktCanvas.reloadActiveTab();}});});}},scClearPalette:{text:'Clear Palette Cache',itemId:'scClearPalette',iconCls:'mkiBrush',handler:function(el){el.parentMenu.hide(true);var currNode=MktMaMenu.menuItemPool.getCurrNode(el);var xtra=currNode.attributes.xtra;MktSession.clockCursor(true);MktSession.ajaxRequest('smartcampaigns/clearPalette',{serializeParms:{smartCampaignId:xtra.compId},onMySuccess:function(){console.debug('Cleared Smart Palette Cache');MktSession.unclockCursor();MktCanvas.reloadActiveTab();}});}},progGenerateRef:{text:'Build Campaign References',itemId:'progGenerateRef',iconCls:'mkiObjects',handler:function(el){el.parentMenu.hide(true);var currNode=MktMaMenu.menuItemPool.getCurrNode(el);var xtra=currNode.attributes.xtra;MktSession.clockCursor(true);MktSession.ajaxRequest('marketingEvent/generateSmartCampaignReferences',{serializeParms:{compId:xtra.compId},onMySuccess:function(){console.debug('Generated campaign references');MktSession.unclockCursor();}});}},getCurrNode:function(el){var currNode=el.parentMenu.currNode;if(!currNode){currNode={attributes:{text:MktPage.appVars.topicName,xtra:{compId:MktPage.appVars.smartCampaignId,nodeId:MktPage.appVars.nodeId}}};}
return currNode;},scActivate:{text:'Activate',itemId:'scActivate',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},progressionNew:{text:'New Progression',itemId:'progressionNew',iconCls:'mkiBrush',disabled:false,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},progressionEdit:{text:'Edit Progression',itemId:'progressionEdit',iconCls:'mkiBrush',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}},progressionDelete:{text:'Delete Progression',itemId:'progressionDelete',iconCls:'mkiBrush',disabled:true,handler:function(el){el.parentMenu.hide(true);MktMessage.comingSoon();}}};MktMaMenu.programsFolderMenu=function(){var fMip=MktFolder.menuItemPool;var maMip=MktMaMenu.menuItemPool;var mItems=menu.items;var m=Ext.menu.get('programsFolderMenu');return m?m:MktLeadDbMenu.menuFactory('programsFolderMenu',maMip.createProgramFolder,maMip.renameProgramFolder,maMip.deleteProgramFolder,maMip.shareProgramFolder,maMip.newSmartCampaign,fMip.convertToArchiveFolder,fMip.convertToCampaignFolder);};MktMaMenu.programActionsMenu=function(attr){var fMip=MktFolder.menuItemPool;var maMip=MktMaMenu.menuItemPool;attr=attr||{};var m=Ext.menu.MenuMgr.get(attr.menuId||'programActionsMenu');var config={id:attr.menuId||"programActionsMenu",extraMenuAction:true,width:185,cls:'mktPopup'};var meMip=Mkt.menus.marketingEvent.menuItemPool;var laMip=Mkt.menus.localasset.menuItemPool;return m?m:MktLeadDbMenu.menuFactory(config,maMip.navigateToCFSmartCamp,maMip.navigateToLocalAssets,maMip.navigateToEventSettings,maMip.navigateToCFTokens,maMip.navigateToEventMembers,maMip.navigateToCFResults,maMip.navigateToSmartCampaign,maMip.navigateToSmartList,maMip.navigateToFlow,maMip.navigateToSchedule,maMip.navigateToResults,maMip.navigateToCampaignMembers,new Ext.menu.Separator({itemId:'createSpacer'}),maMip.newSmartCampaign,meMip.createNewMarketingProgram,laMip.newLocalAsset,new Ext.menu.Separator({itemId:'actionSpacer'}),maMip.createProgramFolder,maMip.renameProgramFolder,maMip.deleteProgramFolder,fMip.convertToArchiveFolder,fMip.convertToCampaignFolder,maMip.scClone,maMip.scArchive,meMip.cloneMarketingProgram,meMip.deleteMarketingProgram,meMip.cloneMarketingEvent,meMip.deleteMarketingEvent,maMip.shareProgramFolder,maMip.scActivate,new Ext.menu.Separator({itemId:'devModeSpacer'}),maMip.scClearPalette,maMip.scClearSmartList,maMip.scClearFlow,maMip.progGenerateRef);};MktMaMenu.maMenu=function(){var maMip=MktMaMenu.menuItemPool;var m=Ext.menu.MenuMgr.get('maMenu');return m?m:MktLeadDbMenu.menuFactory("maMenu",maMip.createProgramFolder,maMip.newSmartCampaign,MktPage.savedState.marketingProgramEnabled?Mkt.menus.marketingEvent.menuItemPool.createNewMarketingProgram:'');};MktMaMenu.maEventMenu=function(){var maMip=MktMaMenu.menuItemPool;var laMip=Mkt.menus.localasset.menuItemPool;var m=Ext.menu.MenuMgr.get('maEventMenu');return m?m:MktLeadDbMenu.menuFactory("maEventMenu",maMip.createProgramFolder,maMip.newSmartCampaign,laMip.newLocalAsset,MktPage.savedState.marketingProgramEnabled?Mkt.menus.marketingEvent.menuItemPool.createNewMarketingProgram:'');};MktMaMenu.showContextMenu=function(node,e){node.attributes.depth=node.getDepth();if(node.attributes&&node.attributes.compType==Mkt.apps.localasset.Constants.COMP_TYPE_LANDING_PAGE){MktDsMenu.compSubtypeFixup(node);}
var menu=MktMenuMgr.getMenu('MA',Ext.apply({triggeredFrom:"tree"},node.attributes));if(menu){menu.xtra=Ext.apply({text:node.text},node.attributes.xtra);menu.showAt(e.xy);menu.currNode=node;e.stopEvent();}
Mkt.main.ExplorerPanel.nodeContextMenuSetup(node,menu);return false;};MktMaMenu.CampaignActionsMenu=function(attr){var menu;menu=MktMaMenu.programActionsMenu(attr);menu.triggeredFrom=attr.triggeredFrom;return MktMaMenu.preShowProgramActionsMenu(menu,attr);};MktMenuMgr.registerMenuProvider('MA',function(attr){var nodeType='';var attrXtra=attr.xtra;if(attr.nodeType){nodeType=attr.nodeType;}else if(attrXtra&&attrXtra.compType){nodeType=attrXtra.compType;}
if(nodeType=='Landing Page'){var menu;menu=MktDsMenu.getPageMenu(attr);menu.triggeredFrom=attr.triggeredFrom;attr.menu=MktDsMenu.preShowPageMenu(menu,attr);}
else if(nodeType=='Email'){var menu;menu=MktDsMenu.getEmailMenu(attr);menu.triggeredFrom=attr.triggeredFrom;attr.menu=MktDsMenu.preShowEmailMenu(menu,attr);}
else if(nodeType=='Landing Page Form'){var menu;menu=MktDsMenu.getFormMenu(attr);menu.triggeredFrom=attr.triggeredFrom;attr.menu=MktDsMenu.preShowFormMenu(menu,attr);}
else if(nodeType=='List'){attr.menu=MktLeadDbMenu.listMenu();MktLeadDbMenu.preShowListListMenu(attr.menu,attr);}
else if(nodeType=='Smart List'){attr.menu=MktLeadDbMenu.listMenu();MktLeadDbMenu.preShowLocalListMenu(attr.menu,attr);}
else if(nodeType=='Landing Page Test Group'){var menu;menu=MktDsMenu.getTestpageMenu(attr);menu.triggeredFrom=attr.triggeredFrom;attr.menu=MktDsMenu.preShowTestpageMenu(menu,attr);}
else{attr.menu=MktMaMenu.CampaignActionsMenu(attr);}});(function(){Mkt.app.MarketingActivities={};var ma=Mkt.app.MarketingActivities;ma.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(ma.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=ma.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('MA',toolbarRequestHandler);return{getNewMenuButton:function(){return{text:'New',iconCls:'mkiBooksBlue',xtype:'mkttbbutton',menu:MktMaMenu.maMenu()};},getNewEventMenuButton:function(){return{text:'New',iconCls:'mkiBooksBlue',xtype:'mkttbbutton',menu:MktMaMenu.maEventMenu()};},getHome:function(attr){var items=[this.getNewMenuButton()];if(attr.panelId=='showTokens'){items=items.concat(Mkt.menus.marketingEvent.Toolbar.getTokensToolbarButtons());}
return new Ext.Toolbar({items:items});},getProgression:function(attr){return new Ext.Toolbar({items:[this.getNewMenuButton(),this.getProgressionActions(),MktMaMenu.menuItemPool.progressionEdit]});},getProgressionMenuButton:function(){return{text:'Progression Actions',iconCls:'mkiBooksBlue',xtype:'mkttbbutton',menu:MktMaMenu.progressionMenu()};},getProgressionActions:function(attr){var items=[];items.push(MktMaMenu.menuItemPool.progressionNew);items.push(MktMaMenu.menuItemPool.progressionEdit);items.push(MktMaMenu.menuItemPool.progressionDelete);return{text:'Progression Actions',xtype:'mkttbbutton',iconCls:'mkiCal',menuPreShowCb:MktMaMenu.preShowProgressionActionsMenu,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getSmartCampaignToolbar:function(campaignId,subType){var items=[];if(!MktPage.satellite){items.push(Mkt.app.MarketingActivities.Toolbar.getNewMenuButton());items.push(' ');}
items.push({text:'Campaign Actions',iconCls:'mkiLightbulbOn',xtype:'mkttbbutton',disabled:subType=='rcmtrans'?true:false,menuPreShowCb:function(){MktMaMenu.preShowProgramActionsMenu(this.menu,{disableNavigateTo:true,nodeType:"Smart Campaign",subType:subType});},menu:MktMenuMgr.getMenu('MA',{nodeType:'Smart Campaign',smartCampaignId:campaignId,subType:subType,width:135,menuId:'programActionsMenuToolbar',disableNavigateTo:true})});items.push('-');items.push({text:'View Campaign Members',iconCls:'mkiUsersInto',handler:function(btn,e){window.open(MktDlManager.getDlUrl('SL',MktPage.appVars.campaignSmartListId,'A',true),'_blank');}});return items;},insertToolbar:function(tbar,insertItems,position){var count=insertItems.length;for(i=0;i<count;i++){tbar.insertButton((position+i),insertItems[i]);tbar._insertedItems++;}
tbar.doLayout();}};}();})();
/* ========== ../mkt-ext-2.0/apps/ListImport.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.listImport');Mkt.apps.listImport.Modal=Ext.extend(Mkt.widgets.ModalForm,{title:'Import List',minWidth:350,width:550,height:405,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktImportList',layout:'form',plain:true,iconCls:'mkiImport',modal:true,bodyStyle:'padding: 5px;',buttonAlign:'right',useStandardButtons:false,labelWidth:130,closable:false,initComponent:function(){this.compType=this.compType?this.compType:'List';this.items=this.items||[];var tabManager=this.tabManager=new Mkt.apps.listImport.WizardTabPanel({windowContainer:this,programId:this.programId,programName:this.programName,compType:this.compType,parentId:this.parentId});this.items.push(this.tabManager);var firstTab=tabManager.items.get(0);this.cancelButton=new Ext.Button({text:firstTab.cancelButtonText,iconCls:firstTab.cancelButtonIconCls,hidden:firstTab.cancelButtonHidden,disabled:firstTab.cancelButtonDisabled,handler:function(){this.close();}.createDelegate(this)});this.backButton=new Ext.Button({text:firstTab.backButtonText,iconCls:firstTab.backButtonIconCls,hidden:firstTab.backButtonHidden,disabled:firstTab.backButtonDisabled,handler:this.tabManager._backButtonCallback.createDelegate(this.tabManager)});this.nextButton=new Ext.Button({text:firstTab.nextButtonText,iconCls:firstTab.nextButtonIconCls,iconAlign:'right',hidden:firstTab.nextButtonHidden,disabled:firstTab.nextButtonDisabled,handler:this.tabManager._nextButtonCallback.createDelegate(this.tabManager)});this.buttons=[this.backButton,this.nextButton,this.cancelButton];Mkt.apps.listImport.Modal.superclass.initComponent.call(this);this.on('show',function(){this.maskModal();MktSession.ajaxRequest('leadDatabase/hasBlockUpdateFromImport',{serializeParms:{},onMySuccess:firstTab.successHasBlockUpdateFromImport.createDelegate(firstTab)});this.on('resize',function(){this.tabManager.syncSize();this.tabManager.setHeight(this.getHeight()-90);}.createDelegate(this));Mkt.util.DragDropFileUpload.setupDragAndDrop(this.getEl().dom,"/leadDatabase/importListPrepare",{listImportMode:'normal',source:'trusted',xsrfId:MktSecurity.getXsrfId()},{startCallback:firstTab.startCallback,progressCallback:firstTab.progressCallback,doneCallback:firstTab.doneCallback,scope:firstTab});}.createDelegate(this));},setBackButtonText:function(text){this.backButton.setText(text);},setBackButtonIconCls:function(iconCls){this.backButton.setIconClass(iconCls);},setBackButtonVisible:function(visible){this.backButton.setVisible(visible);},setBackButtonDisabled:function(disable){this.backButton.setDisabled(disable);},setNextButtonText:function(text){this.nextButton.setText(text);},setNextButtonIconCls:function(iconCls){this.nextButton.setIconClass(iconCls);},setNextButtonVisible:function(visible){this.nextButton.setVisible(visible);},setNextButtonDisabled:function(disable){this.nextButton.setDisabled(disable);},getPanels:function(){}});Mkt.apps.listImport.WizardTabPanel=Ext.extend(Ext.TabPanel,{activeTab:0,autoWidth:true,height:315,plain:true,resizeTabs:true,tabWidth:400,border:false,bodyBorder:false,hideBorders:true,cls:'mktWizardTabPanel',defaults:{autoScroll:true},initComponent:function(){this.items=this.items||[];this.selectFilePanel=new Mkt.apps.listImport.SelectFilePanel({wizardTabPanel:this,programId:this.programId});this.items.push(this.selectFilePanel);this.importPreviewPanel=new Mkt.apps.listImport.ImportPreviewPanel({wizardTabPanel:this});this.items.push(this.importPreviewPanel);this.importOptionsPanel=new Mkt.apps.listImport.ImportOptionsPanel({wizardTabPanel:this,programId:this.programId});this.items.push(this.importOptionsPanel);Mkt.apps.listImport.WizardTabPanel.superclass.initComponent.call(this);var importState={parentId:this.parentId,programName:this.programName,programId:this.programId,compType:this.compType,context:this.programId?'Program':'LeadDb'};this.setImportState(importState);},onStripMouseDown:Ext.emptyFn,getNextTab:function(){var foundTab;var activeTab=this.getActiveTab();var foundIndex=this.items.findIndex('id',activeTab.id);if(foundIndex!=-1){foundTab=this.items.get(foundIndex*1+1);}
return foundTab;},getBackTab:function(){var foundTab;var activeTab=this.getActiveTab();var foundIndex=this.items.findIndex('id',activeTab.id);if(foundIndex!=-1){foundTab=this.items.get(foundIndex*1-1);}
return foundTab;},_nextButtonCallback:function(){var activeTab=this.getActiveTab();if(activeTab&&activeTab.nextButtonCallback){if(activeTab.nextButtonCallback()===false){return;}}
this.gotoNextTab();},gotoNextTab:function(){var nextTab=this.getNextTab();if(nextTab){this.setActiveTab(nextTab.id);this.updateButtons(nextTab);}},updateButtons:function(tab){this.ownerCt.setNextButtonText(tab.nextButtonText);this.ownerCt.setNextButtonIconCls(tab.nextButtonIconCls);this.ownerCt.setNextButtonVisible(!tab.nextButtonHidden);this.ownerCt.setNextButtonDisabled(tab.nextButtonDisabled);this.ownerCt.setBackButtonText(tab.backButtonText);this.ownerCt.setBackButtonIconCls(tab.backButtonIconCls);this.ownerCt.setBackButtonVisible(!tab.backButtonHidden);this.ownerCt.setBackButtonDisabled(tab.backButtonDisabled);},_backButtonCallback:function(){var activeTab=this.getActiveTab();if(activeTab&&activeTab.backButtonCallback){if(activeTab.backButtonCallback()===false){return;}}
this.gotoPreviousTab();},gotoPreviousTab:function(){var backTab=this.getBackTab();if(backTab){this.setActiveTab(backTab.id);this.updateButtons(backTab);}},setImportState:function(importState){this.importState=Ext.apply(this.importState||{},importState);},getImportState:function(){return this.importState;},closeWizard:function(){this.ownerCt.close();}});Mkt.apps.listImport.WizardPanelInitalConfig={cls:'mktWizardPanel',cancelButtonText:'Cancel',cancelButtonIconCls:'mkiCancel',cancelButtonHidden:false,cancelButtonDisabled:false,backButtonText:'Back',backButtonIconCls:'mkiNavLeftGray',backButtonHidden:false,backButtonDisabled:false,nextButtonText:'Next',nextButtonIconCls:'mkiNavRightGreen',nextButtonHidden:false,nextButtonDisabled:false,showMessageError:function(message){if(!this.isVisible()){this.animateTarget=undefined;this.show();}
if(this.showProgressModal){this.progressModal.hide();}
this.messagePanel.update({message:message});this.messagePanel.show();this.messagePanel.addClass('visibleMessage');},hideMessage:function(){this.messagePanel.hide();this.messagePanel.removeClass('visibleMessage');},addMessagePanel:function(){this.items=this.items||[];this.messagePanel=new Ext.Panel({tpl:'<h2><div class="mktModalInFormMessage" style="display: block;"><div class="mktModalErrorMessage">{message}</div></div></h2>',baseCls:"mkt-modal-message-body",hidden:true,height:30,anchor:"99% 20%"});this.items.unshift(this.messagePanel);}};Mkt.apps.listImport.WizardPanel=Ext.extend(Ext.Panel,{initComponent:function(){Ext.applyIf(this,Mkt.apps.listImport.WizardPanelInitalConfig);this.addMessagePanel.call(this);Mkt.apps.listImport.WizardPanel.superclass.initComponent.call(this);}});Mkt.apps.listImport.WizardFormPanel=Ext.extend(Ext.form.FormPanel,{initComponent:function(){Ext.applyIf(this,Mkt.apps.listImport.WizardPanelInitalConfig);this.addMessagePanel.call(this);Mkt.apps.listImport.WizardFormPanel.superclass.initComponent.call(this);}});Mkt.apps.listImport.SelectFilePanel=Ext.extend(Mkt.apps.listImport.WizardFormPanel,{title:'Step 1: Select File',bodyStyle:'padding: 25px 0 0 10px;',labelWidth:130,fileUpload:true,layout:'form',url:'/leadDatabase/importListPrepare',backButtonDisabled:true,initComponent:function(){Mkt.apps.listImport.SelectFilePanel.superclass.initComponent.call(this);this.on('render',function(){var firstTab=this.wizardTabPanel.getTabEl(0);if(firstTab){Ext.get(firstTab).addClass('mktWizardFirstTab');}}.createDelegate(this));},getFields:function(){var items=[];this.fileUploadFile=new Ext.ux.form.FileUploadField({fieldLabel:'File',validateOnBlur:false,itemCls:'mktRequired',allowBlank:false,width:300});items=[this.fileUploadFile];this.fileUploadFile.on('fileselected',function(){this.wizardTabPanel.setImportState({fileId:undefined});}.createDelegate(this));this.fileFormatField=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"File Format",hiddenName:'listImportFormat',value:'autodetect',width:200,resizable:true,mode:'local',triggerAction:'all',editable:false,store:new Ext.data.ArrayStore({fields:['valueField','displayText'],data:[['autodetect','Auto Detect'],['CSV','Comma Separated Values'],['TAB','Tab Delimited'],['SEMICO','Semicolon Separated Values']]}),valueField:'valueField',displayField:'displayText'});items.push(this.fileFormatField);if(this.showSourceField){this.sourceField=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Trusted Source",hiddenName:'source',value:'trusted',width:200,resizable:true,mode:'local',triggerAction:'all',editable:false,store:new Ext.data.ArrayStore({fields:['valueField','displayText'],data:[['trusted','Trusted'],['untrusted','Untrusted']]}),valueField:'valueField',displayField:'displayText'});items.push(this.sourceField);}
if(MktSession.hasCredential('ac_advancedListImport')){var listImportModes=[['Normal','normal']];if(!this.programId){listImportModes.push(['Skip new leads and updates','createListFromFile']);}
listImportModes.push(['Optimized for new leads','bulkNewLeadImport']);this.listImportModeField=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"List Import Mode",hiddenName:'listImportMode',value:'normal',width:200,resizable:true,mode:'local',triggerAction:'all',editable:false,store:new Ext.data.ArrayStore({fields:['displayText','valueField'],data:listImportModes}),valueField:'valueField',displayField:'displayText'});this.listImportModeField.on('select',function(){this.listImportDetails.clearList();var mode=this.listImportModeField.getValue();this.listImportDetails.addListItems(this.getListImportModeDetailOptions(mode));if(this.sourceField){this.sourceField.setDisabled(mode=='createListFromFile');}}.createDelegate(this));items.push(this.listImportModeField);var mode='normal';items.push(this.buildListImportModeDetails(mode));}
return items;},startCallback:function(name){this.hideMessage();this.remove(this.fileUploadFile,true);delete this.fileUploadFile;this.fileUploadFile=undefined;if(this.uploadedFileText){this.remove(this.uploadedFileText);delete this.uploadedFileText;this.uploadedFileText=undefined;}
this.progressBar=new Ext.ProgressBar({text:'Uploading '+name+'...',cls:'mktFileUploadFieldProgressBar'});this.insert(1,this.progressBar);this.doLayout();},progressCallback:function(type,percentage){if(type=='fileupload'){this.progressBar.updateProgress(percentage);}},doneCallback:function(filename,response){if(response){this.remove(this.progressBar);delete this.progressBar;this.progressBar=undefined;var responseObj=Ext.decode(response);if(responseObj&&responseObj.success){console.debug('fileId: '+responseObj.appvars.fileId);this.wizardTabPanel.setImportState({fileId:responseObj.appvars.fileId,origFile:responseObj.appvars.origFile,fileFormat:responseObj.appvars.fileFormat});if(!this.uploadedFileText){this.uploadedFileText=new Ext.form.DisplayField({fieldLabel:'File',value:filename});this.insert(1,this.uploadedFileText);}
else{this.uploadedFileText.setValue(filename);}}
else{this.wizardTabPanel.setImportState({fileId:undefined});this.fileUploadFile=new Ext.ux.form.FileUploadField({fieldLabel:'File',validateOnBlur:false,itemCls:'mktRequired',allowBlank:false,width:300});this.insert(1,this.fileUploadFile);var errMsg;if(responseObj&&responseObj.importListErrMsg){errMsg=responseObj.importListErrMsg;}
else{errMsg="Unexpected error. Please try again.";}
this.showMessageError(errMsg);}
this.doLayout();}},successHasBlockUpdateFromImport:function(){this.showSourceField=MktPage.appVars.hasBlockUpdates;this.add(this.getFields());this.doLayout();this.wizardTabPanel.windowContainer.unmaskModal();},buildListImportModeDetails:function(mode){this.listImportDetails=new Mkt.widgets.ListField({cls:'formItem mktHiddenLabel',labelWidth:this.labelWidth,fieldLabel:'List Import Details',values:this.getListImportModeDetailOptions(mode),itemTmpl:'<div style="margin-left: 20px;" class="{itemCls}"> <div style="line-height:20px; width:auto; display:inline;">'+'<div style="position:relative; display:block; margin-left: -20px;">'+'<div class="mki16 {iconCls}">'+'</div>'+'</div>'+'{text}</div></div>'});return this.listImportDetails;},getListImportModeDetailOptions:function(mode){var items=[];if(mode=='normal'){items.push({text:'De-Duplicate leads',iconCls:'mkiOk'});items.push({text:'Log <b>change data value</b> and <b>add to list</b> activities',iconCls:'mkiOk'});items.push({text:'Update lead fields',iconCls:'mkiOk'});}
else if(mode=='skipActivityLogging'){items.push({text:'Update leads and de-duplicate',iconCls:'mkiOk'});items.push({text:'Skip <b>change data value</b> and <b>add to list</b> activity logging',iconCls:'mkiOk'});}
else if(mode=='createListFromFile'){items.push({text:'Skip new leads',iconCls:'mkiOk'});items.push({text:'Skip lead field updates',iconCls:'mkiOk'});items.push({text:'Skip activity logging',iconCls:'mkiOk'});}
else if(mode=='bulkNewLeadImport'){items.push({text:'De-duplicate leads',iconCls:'mkiOk'});items.push({text:'Log <b>change data value</b> and <b>add to list</b> activities',iconCls:'mkiOk'});items.push({text:'Update lead fields',iconCls:'mkiOk'});}
return items;},nextButtonCallback:function(){this.hideMessage();this.wizardTabPanel.windowContainer.maskModal('Generating Preview...',undefined,true);var importState=this.wizardTabPanel.getImportState();if(importState&&importState.fileId){MktSession.ajaxRequest('leadDatabase/importListPrepare',{serializeParms:{fileId:importState.fileId,listImportMode:this.getListImportModeValue(),source:this.showSourceField?this.sourceField.getValue():'trusted',listImportFormat:this.fileFormatField.getValue(),fileFormat:importState.fileFormat},onMySuccess:this.successSubmitCallback.createDelegate(this)});}
else{this.getForm().doAction('submit',{url:this.url,method:'post',success:this.successSubmitCallback.createDelegate(this),failure:this.failureSubmitCallback.createDelegate(this)});}
return false;},getListImportModeValue:function(){return MktSession.hasCredential('ac_advancedListImport')?this.listImportModeField.getValue():'normal';},successSubmitCallback:function(form,action){var fileFormat=this.fileFormatField.getValue();var appvars;if(!action.result){appvars=MktPage.appVars;}
else{appvars=action.result.appvars;}
this.wizardTabPanel.setImportState(Ext.apply({fileFormat:fileFormat,source:this.showSourceField?this.sourceField.getValue():'trusted',listImportMode:this.getListImportModeValue()},appvars));this.wizardTabPanel.gotoNextTab();this.wizardTabPanel.windowContainer.unmaskModal();},failureSubmitCallback:function(form,action){this.wizardTabPanel.windowContainer.unmaskModal();this.showMessageError(action.result.importListErrMsg);}});Mkt.apps.listImport.ImportPreviewPanel=Ext.extend(Mkt.apps.listImport.WizardPanel,{title:'Step 2: Import Preview',bodyStyle:'padding-top: 18px;',layout:'anchor',initComponent:function(){this.items=[this.buildPreviewGrid()];this.ignoredField=new Ext.Panel({html:"",baseCls:"mkt-modal-text-body",anchor:"100%"});this.items.push(this.ignoredField);Mkt.apps.listImport.ImportPreviewPanel.superclass.initComponent.call(this);this.on('activate',function(){this.updateGridData();this.updateIgnoredField();}.createDelegate(this));},buildPreviewGrid:function(){var data={data:[]};var store=new Ext.data.Store({data:data,reader:new Ext.data.JsonReader({root:'data'},Ext.data.Record.create([{name:"FieldName",type:"auto"},{name:"FriendlyName",type:"auto"},{name:"Value",type:"auto"},{name:"IgnoreCls",type:"string"},{name:"Ignored",type:"boolean"}]))});function renderer(value,attr,record,rowIndex,colIndex,ds){if(record.data.IgnoreCls){attr.css+=' '+record.data.IgnoreCls;}
return value;}
var cm=new Ext.grid.ColumnModel([{id:'FieldName',header:'Field Name',text:'Field Name',renderer:renderer,dataIndex:'FieldName',sortable:false,width:140},{text:'Friendly Name',header:'Friendly Name',renderer:renderer,dataIndex:'FriendlyName',sortable:false,width:150},{text:'Value',header:'Sample Value',renderer:renderer,dataIndex:'Value',sortable:false,width:410}]);this.grid=new Ext.grid.GridPanel({cls:'mktImportGrid',store:store,enableHdMenu:false,disableSelection:true,trackMouseOver:false,width:700,height:400,minWidth:600,minHeight:300,cm:cm,anchor:"100% 90%"});return this.grid;},updateGridData:function(){var importState=this.wizardTabPanel.getImportState();this.grid.getStore().loadData(importState.sampleRow);},updateIgnoredField:function(){var importState=this.wizardTabPanel.getImportState();var ignoredFields=0;if(importState){ignoredFields=importState.ignoredField;}
var html='';if(ignoredFields>0){html='<div class="mki16 mkiSignWarning"></div><span style="font-size: 12px; line-height:18px;"><span style="font-weight: bold;">'+
ignoredFields+'</span> field'+(ignoredFields>1?'s':'')+' ignored. <a href="http://community.marketo.com/MarketoArticle?id=kA050000000KzVr" target="_blank">Learn More.</a></span>';}
this.ignoredField.getEl().update(html);}});Mkt.apps.listImport.ImportOptionsPanel=Ext.extend(Mkt.apps.listImport.WizardPanel,{title:'Step 3: Import Options',bodyStyle:'padding: 25px 0 0 10px;',nextButtonText:'Import',nextButtonIconCls:'mkiImport',layout:'form',labelWidth:130,initComponent:function(){this.items=[this.getFields()];Mkt.apps.listImport.ImportOptionsPanel.superclass.initComponent.call(this);this.on('activate',function(){if(this.listNameField){this.listNameField.clearInvalid();}
if(this.acquisitionProgramField){this.acquisitionProgramField.clearInvalid();}
if(this.memberStatusField){this.memberStatusField.clearInvalid();}
var importState=this.wizardTabPanel.getImportState();var autoAssignmentEnabled=true;var autoAssignmentText='Auto-Assignment';if(!importState.hasApprovedModel){autoAssignmentText='<span style="color:gray;">Auto-Assignment</span>';autoAssignmentEnabled=false;}
var data=[['None','none',false],[autoAssignmentText,'default',!autoAssignmentEnabled]];if(this.revenueStageField){var revStageFieldStyle,revStageFieldVisible;if(importState.listImportMode!='normal'){revStageFieldStyle={display:'none'};revStageFieldVisible=false;this.revenueStageField.setValue('none');}
else{revStageFieldStyle={display:'block'};revStageFieldVisible=true;this.revenueStageField.getStore().loadData(data,false);if(autoAssignmentEnabled){this.revenueStageField.setValue('default');}}
this.revenueStageField.itemCt.applyStyles(revStageFieldStyle);this.revenueStageField.setVisible(revStageFieldVisible);}
if(this.acquisitionProgramField){if(importState.listImportMode=='createListFromFile'){this.acquisitionProgramField.itemCt.applyStyles({visibility:'hidden'});this.acquisitionProgramFieldDetails.setVisible(false);}
else{this.acquisitionProgramField.itemCt.applyStyles({visibility:'visible'});this.acquisitionProgramFieldDetails.setVisible(true);}}}.createDelegate(this));},getFields:function(){var items=[];var fieldsetItems=[];if(this.programId){var memberStatusJsonStore=new Ext.data.JsonStore({url:'marketingEvent/getStatuses',root:'suggest',baseParams:{compId:this.programId},fields:['Id','Name','IsHidden']});memberStatusJsonStore.on('load',function(records,options){var len=records.getCount();var removals=[];for(var i=0;i<len;i++){var rec=records.getAt(i);if(rec.data.IsHidden||rec.data.Name==='Not in Program'){removals.push(i);}}
for(var j=removals.length-1;j>=0;j--){this.removeAt(removals[j]);}});this.memberStatusField=new Ext.form.ImprovedComboBox({forceSelection:true,fieldLabel:"Member Status",value:'',width:200,itemCls:'mktRequired',resizable:true,mode:'remote',minChars:2,triggerAction:'all',allowBlank:false,editable:true,store:memberStatusJsonStore,displayField:'Name',valueField:'Name'});this.labelWidth=140;items.push(this.memberStatusField);return items;}
var jsonStore=new Ext.data.JsonStore({url:'leadDatabase/getListNames',root:'suggest',baseParams:{},fields:['val','id']});this.listNameField=new Ext.form.ImprovedComboBox({forceSelection:false,fieldLabel:"List Name",value:'',width:200,itemCls:'mktRequired',resizable:true,mode:'remote',minChars:2,triggerAction:'all',allowBlank:false,editable:true,store:jsonStore,displayField:'val',valueField:'id'});items.push(this.listNameField);this.revenueStageField=new Ext.form.ImprovedComboBox({forceSelection:false,fieldLabel:"Revenue Stage",value:'none',width:200,itemCls:'mktImportRevenueStage',resizable:true,emptyText:'Select a List',mode:'local',triggerAction:'all',editable:false,store:new Ext.data.ArrayStore({fields:['displayText','valueField','disabled'],data:[['None','none',false],['Auto-Assignment','default',false]]}),displayField:'displayText',valueField:'valueField'});items.push(this.revenueStageField);this.revenueStageField.on('beforeselect',function(comboBox,record,index){return!record.data.disabled;}.createDelegate(this));var acquisitionJsonStore=new Ext.data.JsonStore({url:'leadDatabase/getProgramNames',root:'suggest',baseParams:{},fields:['val','programId']});if(MktPage.savedState.marketingProgramEnabled){this.acquisitionProgramField=new Ext.form.ImprovedComboBox({forceSelection:true,fieldLabel:"Acquisition Program",emptyText:'Select a Program',value:'',width:200,itemCls:'mktRequired',resizable:true,mode:'remote',triggerAction:'all',allowBlank:false,editable:true,minChars:2,store:acquisitionJsonStore,displayField:'val',valueField:'programId'});items.push(this.acquisitionProgramField);this.acquisitionProgramFieldDetails=new Mkt.widgets.ListField({cls:'formItem mktHiddenLabel',labelWidth:300,fieldLabel:'List Import Details',values:[{text:'Note: Acquisition program for new leads only'}],itemTmpl:'<div style="margin-top: -5px;" >'+'<div style="line-height:20px; width:auto; display:inline; font-style:italic; font-size:11px;">'+'{text}</div></div>'});items.push(this.acquisitionProgramFieldDetails);}
return items;},nextButtonCallback:function(){var importState=this.wizardTabPanel.getImportState();var availableAcquisitionProgram=importState.listImportMode!='createListFromFile';if(this.listNameField&&!this.listNameField.validate()||(this.acquisitionProgramField&&availableAcquisitionProgram&&!this.acquisitionProgramField.validate())){return false;}
if(this.memberStatusField&&!this.memberStatusField.validate()){return false;}
var programId;if(!importState.programId&&this.acquisitionProgramField&&availableAcquisitionProgram){programId=this.acquisitionProgramField.getValue();}
else{programId=-1;}
var parms={fileFormat:importState.fileFormat,origFile:importState.origFile,fileId:importState.fileId,source:importState.source,programId:programId,compType:importState.compType,listImportMode:importState.listImportMode,listDesc:''};if(this.listNameField){parms.listName=this.listNameField.getRawValue();}
if(this.revenueStageField){parms.revStage=this.revenueStageField.getValue();}
if(importState.parentId){parms.parentId=importState.parentId;}
if(importState.programId){parms.programId=importState.programId;}
if(this.memberStatusField){parms.programMemberStatus=this.memberStatusField.getValue();}
MktSession.ajaxRequest('leadDatabase/importListSubmit',{serializeParms:parms,onMySuccess:this.successImportCallback.createDelegate(this)});return false;},successImportCallback:function(){MktSession.clockCursor(false);if(MktPage.appVars.result&&MktPage.appVars.result===true){var importState=this.wizardTabPanel.getImportState();if(this.ownerCt.closeWizard){this.ownerCt.closeWizard();}
var addNodeJsons=MktPage.appVars.addedNodeJsons;if(addNodeJsons){MktExplorer.addNodes(addNodeJsons);delete MktPage.appVars.addedNodeJsons;}
var statuses=MktPage.appVars.staticListStatuses;if(statuses){var isProgramImport=importState.context=='Program';MktLeadDb.showImportStatusWindow({listId:MktPage.appVars.importedListId,remainingLeads:statuses.rows_imported,estimatedTime:statuses.estimated_time,remaingLeads:statuses.estimated_rows,listSubtype:isProgramImport?'background':'user',programId:importState.programId,compType:importState.compType,programName:importState.programName,failedRows:statuses.rows_failed,status:statuses.status,listName:MktPage.appVars.importedListName});if(importState.context=='LeadDb'){MktDlManager.loadDl({type:'LeadDb',compType:'List',subType:'list',compId:MktPage.appVars.importedListId,nodeId:MktPage.appVars.importedListNodeId});}}}
else{this.showMessageError(MktPage.appVars.errMsg);}}});Mkt.util.DragDropFileUpload={$drop:null,queue:[],processing:null,uploading:false,binaryReader:null,dataReader:null,xhr:null,dropEl:null,url:null,callbacks:null,setupDragAndDrop:function(el,url,params,callbacks){if(Ext.isIE||(Ext.isSafari&&!Ext.isMac)){return;}
var up=Mkt.util.DragDropFileUpload;up.$drop=el;up.url=url;up.params=params;up.callbacks=callbacks;el.addEventListener('drop',up.drop,false);document.documentElement.addEventListener('drop',up.swallow,false);document.documentElement.addEventListener('dragover',up.swallow,false);document.documentElement.addEventListener('dragleave',up.swallow,false);document.documentElement.addEventListener('dragEnter',up.swallow,false);up.xhr=new XMLHttpRequest();up.xhr.upload.addEventListener('progress',function(e){up.uploadProgress(e);},false);up.xhr.upload.addEventListener('load',up.uploadLoaded,false);up.xhr.onreadystatechange=function(e){var up=Mkt.util.DragDropFileUpload;if(up.xhr.readyState==4&&up.xhr.status==200){if(up.callbacks&&up.callbacks.doneCallback){up.callbacks.doneCallback.call(up.callbacks.scope,up.processing.name,up.xhr.responseText);}}};},swallow:function(e){e.stopPropagation();e.preventDefault();},enter:function(e){return false;},leave:function(e){return false;},over:function(e){return false;},drop:function(e){var up=Mkt.util.DragDropFileUpload;var files=e.dataTransfer.files;for(var i=0;i<files.length;i++){var file=files[i];up.queue.push(file);}
if(up.uploading==false){up.uploading=true;up.process();if(up.callbacks&&up.callbacks.startCallback){up.callbacks.startCallback.call(up.callbacks.scope,up.processing.name);}}
return false;},process:function(){var up=Mkt.util.DragDropFileUpload;up.processing=up.queue.shift();if(window.FileReader){if(up.processing.type.match(/image/gi)!=null){up.dataReader=new FileReader();if(up.dataReader.addEventListener){up.dataReader.addEventListener('loadend',up.binaryLoad,false);up.dataReader.addEventListener('error',up.loadError,false);up.dataReader.addEventListener('progress',up.loadProgress,false);}else{up.dataReader.onloadend=up.binaryLoad;up.dataReader.onerror=up.loadError;up.dataReader.onprogress=up.loadProgress;}
up.dataReader.readAsDataURL(up.processing);}
up.binaryReader=new FileReader();if(up.binaryReader.addEventListener){up.binaryReader.addEventListener('loadend',up.binaryLoad,false);up.binaryReader.addEventListener('error',up.loadError,false);up.binaryReader.addEventListener('progress',up.loadProgress,false);}else{up.binaryReader.onloadend=up.binaryLoad;up.binaryReader.onerror=up.loadError;up.binaryReader.onprogress=up.loadProgress;}
up.binaryReader.readAsBinaryString(up.processing);}else{up.xhr.abort();up.xhr.open('POST',up.url,true);up.xhr.setRequestHeader('UP-FILENAME',up.processing.name);up.xhr.setRequestHeader('UP-SIZE',up.processing.size);up.xhr.setRequestHeader('UP-TYPE',up.processing.type);up.xhr.send(up.processing);up.xhr.onload=up.onload;}},loadError:function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:console.debug('File Not Found!');break;case e.target.error.NOT_READABLE_ERR:console.debug('File is not readable');break;case e.target.error.ABORT_ERR:break;default:console.debug('An error occurred reading this file.');break;};},loadProgress:function(e){if(e.lengthComputable){var percentage=Math.round((e.loaded*100)/e.total);console.debug('Loaded Percentage (loadProgress): '+percentage+'%');var up=Mkt.util.DragDropFileUpload;if(up.callbacks&&up.callbacks.progressCallback){up.callbacks.progressCallback.call(up.callbacks.scope,'fileload',percentage/100);}}},binaryLoad:function(e){var up=Mkt.util.DragDropFileUpload;if(up.binaryReader.readyState==2){up.xhr.abort();var binary=e.target.result;if(up.xhr.sendAsBinary!=null){up.xhr.open('POST',up.url,true);var boundary='multipartformboundary'+(new Date).getTime();var body='--'+boundary+"\r\n";body+="Content-Disposition: form-data; name='upload'; filename='"+up.processing.name+"'\r\n";body+="Content-Type: "+up.processing.type+"\r\n\r\n";body+=binary+"\r\n";for(key in up.params){body+='--'+boundary+"\r\n";body+=('Content-Disposition: form-data; name="'+key+'"\r\n\r\n');body+=up.params[key];body+='\r\n';}
body+='--'+boundary+"--\r\n";up.xhr.setRequestHeader('content-type','multipart/form-data; boundary='+boundary);up.xhr.sendAsBinary(body);}else{console.debug('sending content');up.xhr.open('POST',up.url,true);var formData=new FormData();formData.append(up.processing.name,up.processing);for(key in up.params){formData.append(key,up.params[key]);}
up.xhr.send(formData);}
up.xhr.onload=up.onload;}},uploadProgress:function(e){if(e.lengthComputable){var percentage=Math.round((e.loaded*100)/e.total);console.debug('status: '+'uploaded: '+percentage+'%');var up=Mkt.util.DragDropFileUpload;if(up.callbacks&&up.callbacks.progressCallback){up.callbacks.progressCallback.call(up.callbacks.scope,'fileupload',percentage/100);}}},uploadLoaded:function(e){console.debug('Uploaded: 100%');var up=Mkt.util.DragDropFileUpload;if(up.callbacks&&up.callbacks.doneCallback){up.callbacks.doneCallback.call(up.callbacks.scope,up.processing.name);}},onload:function(e){var up=Mkt.util.DragDropFileUpload;if(up.queue.length>0){up.process();}else{up.uploading=false;console.debug('Queue Uploaded');}},cancel:function(e){var up=Mkt.util.DragDropFileUpload;if(up.dataReader){up.dataReader.abort();}
if(up.dataReader){up.binaryReader.abort();}
if(up.xhr){up.xhr.abort();}
up.uploading=false;up.queue=[];up.processing=null;return false;}};Mkt.apps.listImport.SendAlert=function(){this.modal=null;};Mkt.apps.listImport.SendAlert.prototype={validateEmails:function(text){var emails=/^\s*(([\w-]+)(\.[\w-]+)*@([\w-]+\.){1,5}([A-Za-z]){2,4}\s*([;,])*\s*)+$/;if(!emails.test(text)){return false;}
return true;},setupImportSendAlert:function(listId,emails,animEl){this.listId=listId;this.emails=emails;this.showSendDialog(animEl);},renderSendDialog:function(el){var modalMsg=new Ext.Panel({html:'<h2><div class="mktModalInFormMessage"></div></h2>',bodyStyle:'background-color: transparent; margin-bottom: 5px'});this.testToField=new Ext.form.TextArea({fieldLabel:'Send To',tabIndex:1,anchor:'95% 70%',enableKeyEvents:true,height:150,value:this.emails||'',listeners:{'change':function(field,oldVal,newVal){MktModalForm.clearMessage();},'keyup':function(field,e){MktModalForm.clearMessage();}}});var prevAddrField=new Ext.form.ComboBox({fieldLabel:'',labelSeparator:'',tabIndex:2,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/leadDatabase/getImportSendAlertAddresses',root:'addresses',fields:['code','val']}),mode:'remote',valueField:'code',displayField:'val',triggerAction:'all',forceSelection:true,editable:false,resizable:true,emptyText:'Choose previous address...',relatedField:this.testToField,listeners:{'select':function(field,record,index){if(record.data.code!=-1){field.relatedField.setValue(record.data.val);MktModalForm.clearMessage();}}},anchor:'95% 30%'});var formItems=[modalMsg,prevAddrField,this.testToField];var form=new Ext.form.FormPanel({baseCls:'x-plain',labelWidth:65,items:formItems,renderTo:el.id});},showSendDialog:function(animEl){this.modal=new MktModalForm({rendererscope:this,renderer:this.renderSendDialog,title:'Send Alert',iconCls:'mkiMail2',okButtonTitle:'Save',width:500,resizable:true,height:300,dialogOpts:{resizable:false}});this.modal.show(animEl,this.doSendTestEmail.createDelegate(this));},doSendTestEmail:function(){var addresses=this.testToField.getValue();if(addresses.length<1){MktModalForm.setMessageError("Please enter at least one email address");return;}
else if(!this.validateEmails(addresses)){MktModalForm.setMessageError("Invalid email address list (Example: a@b.com; c@d.com)");return;}else{MktModalForm.clearMessage();}
var param={listId:this.listId,emails:addresses};var url='leadDatabase/importSendAlertEmail';MktSession.ajaxRequest(url,{serializeParms:param,onMySuccess:this.sendTestEmailDone.createDelegate(this,[addresses])});},sendTestEmailDone:function(addresses){if(MktPage.appVars.message){MktModalForm.setMessageError(MktPage.appVars.message);MktPage.appVars.message=null;}else{this.modal.close();this.modal=null;var win=Ext.WindowMgr.get('importStatusWindow'+this.listId);if(win){var els=Ext.query("#sendImportAlert"+this.listId,win.getEl().dom);for(var i=0;i<els.length;i++){els[0].onclick=function(e){MktLeadDb.sendImportAlertRequest(this.listId,addresses);return false;}.createDelegate(this);}
win.alertEmails=addresses;}}}};
/* ========== ../mkt-ext-2.0/apps/CustAdmin.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.custadmin','Mkt.apps.Salesforce');Mkt.apps.Salesforce={syncFieldsDone:function(response){var result=MktPage.appVars.result;Ext.MessageBox.hide();if(result=="success"){var tabId='cadSfdcSettings';MktPage.clearPanelContentValid(tabId);MktPage.activatePanel(tabId);}else{if(response.JSONResults.tokenRequired){MktMessage.showWarning(MktPage.appVars.errMsg);Ext.getCmp('scsToken').markInvalid(MktPage.appVars.errMsg);}
else{MktMessage.showError(MktPage.appVars.errMsg);}}},syncFields:function(){var isValid=true;isValid=Ext.getCmp('scsUsername').validate()&&isValid;isValid=Ext.getCmp('scsPassword').validate()&&isValid;if(!isValid){return;}
var confirmMsg='<b><span style="color:red">Warning:</span></b> Once you sync a Marketo subscription to a Salesforce account, there is no switching.<br/><br/>'+'Your Munchkin ID and anything created in this subscription will forever be tied to this Salesforce account.';var config={};config.count=0;config.showTextCount=false;config.title="Sync is Forever";config.msg="<p>"+confirmMsg+"</p>";config.cboxLabel="<b>Cannot Undo</b>";config.showCheckbox=false;config.iconCls="mkiHandcuffs";config.bgCls="mki128Handcuffs";config.okBtnTxt="Confirm Credentials";config.cancelBtnTxt="Cold Feet";MktMessage.showStrongConfirm(config,Mkt.apps.Salesforce.syncFieldsConfirmed.createDelegate(this));},syncFieldsConfirmed:function(){var username=Ext.get("scsUsername");var password=Ext.get("scsPassword");Ext.MessageBox.show({title:'Marketo',msg:'Syncing fields, please wait...',progressText:'Synching...',width:300,modal:true,wait:true,waitConfig:{interval:200}});MktSession.ajaxRequest('salesforce/syncFields',{serializeForm:'sfdcCredentialPanelForm',onMySuccess:this.syncFieldsDone});},syncData:function(){Ext.Msg.show({title:"Marketo",width:455,msg:'<div style="float:left; width: 370px;">This will open your Salesforce.com account and copy all of the data over to Marketo.'
+" This may take several hours to complete.<br /><br />"
+"<b>Note:</b> No Salesforce information will be changed during this process.<br /><br />"
+"You can continue to use Marketo while the first sync is working.</div>",fn:function(btn,text){if(btn=="ok"){MktSession.ajaxRequest('salesforce/syncData',{serializeParms:{enableSynch:true},onMySuccess:this.syncDataDone.createDelegate(this)});}}.createDelegate(this),buttons:{ok:'Start Sync',cancel:'Cancel'},icon:Ext.MessageBox.INFO});},syncDataDone:function(){if(MktPage.appVars.result==MktSession.resultSuccess){var tabId='cadSfdcSettings';MktPage.clearPanelContentValid(tabId);MktPage.activatePanel(tabId);}else if(MktPage.appVars.errMsg){MktMessage.showError(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}},finishMapping:function(){MktSession.clockCursor(true);MktSession.ajaxRequest('fieldManagement/finishMapping',{serializeParms:{},onMySuccess:Mkt.apps.Salesforce.finishMappingDone});},finishMappingDone:function(){var results=MktPage.appVars.result;if(results=="success"){MktDlManager.loadDl({type:'CustAdmin',compSubtype:'integration',nodeId:MktPage.constants.adminTreeMeta.SALESFORCE.nodeId,panelId:'cadSfdcSettings'});}else{MktMessage.showError(MktPage.appVars.errMsg);}},editSyncOptions:function(animEl){Mkt.apps.Salesforce.syncOptionsForm.show(animEl);Mkt.apps.Salesforce.updateSyncOptionsForm();},editCredentials:function(username,password,token,animEl){username=username||'';password=password||'';token=token||'';var mp=new MktModalForm({renderer:function(el,unused){var hiddenInputs='';Ext.DomHelper.append(el,'<div id="cadSalesforceCredential">'+'  <form id="cadSalesforceCredentialForm">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Username:</td>'+'        <td class="mktForm2Field">'+'          <input id="scsUsername" type="text" name="scsUsername" class="mktMedium" tabindex="1" value="'+username+'" size="50" maxlength="140"></input>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Password:</td>'+'        <td class="mktForm2Field">'+'          <input id="scsPassword" type="password" name="scsPassword" class="mktMedium" tabindex="2" value="'+password+'" size="50" maxlength="140"></input>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Token:</td>'+'        <td class="mktForm2Field">'+'          <input id="scsToken" type="text" name="scsToken" class="mktMedium" tabindex="3" value="'+token+'" size="50" maxlength="140"></input>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr id="warningRow">'+'       <td class="mktForm2Label">&nbsp;</td>'+'       <td>'+'         <div class="mktForm2Warning">'+'           <span class="warningTitle">Warning:</span>'+'             Changing the user credentials to connect to a different Salesforce account will cause the Marketo sync to become unstable.  Check with support if you are unsure. '+'           </div>'+'       </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Edit Credentials',iconCls:'mkiKeyEdit',okButtonTitle:'Save',width:500,height:340});mp.show(animEl,this.submitCredentials.createDelegate(this));},submitCredentials:function(){username=Ext.get('scsUsername').getValue();password=Ext.get('scsPassword').getValue();token=Ext.get('scsToken').getValue();MktSession.clockCursor(true);MktSession.ajaxRequest('salesforce/editCredentialsSubmit',{serializeForm:'cadSalesforceCredentialForm',onMySuccess:this.submitCredentialsDone.createDelegate(this,[username,password,token])});return false;},submitCredentialsDone:function(username,password,token){console.log("submitCredentialsDone");if(MktPage.appVars.sfdcCredentialUpdateResult){var el=Ext.get('sfdcUsername');if(el){el.update(username);}
el=Ext.get('sfdcPassword');if(el){el.update(password?'set':'');}
el=Ext.get('sfdcToken');if(el){el.update(token);}
tab=MktCanvas.getTab('cadSfdcSettings');if(tab){var metaInfo=tab.config.metaInfo;metaInfo.sfdcUsername=username;metaInfo.sfdcPassword=password;metaInfo.sfdcToken=token;var tb=tab.getTopToolbar();if(tb){tb.items.get('enableSync').setDisabled(!(MktPage.appVars.sfdcCredentialStatus=='valid'));}}}}};Mkt.apps.custadmin.LisAdminGrid=Ext.extend(MktGrids.CanvasGridPanel,{defaultSort:'email',autoExpandColumn:'email',autoExpandMin:150,totalDisplayMsg:'{0} licensees',enableTotal:true,enableDragDrop:false,emailRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){return'<a href="mailto:'+val+'" class="mktGridLink">'+val+'</a>';}
else{return'';}},initComponent:function(){this.dataCols=[{name:'id'},{name:'email'},{name:'firstName'},{name:'lastName'},{name:'status'},{name:'authToken'},{name:'updated'},{name:'created'}];this.viewCols=[{header:"First Name",width:120,sortable:true,dataIndex:'firstName'},{header:"Last Name",width:120,sortable:true,dataIndex:'lastName'},{header:"Email",id:'email',width:150,sortable:true,renderer:this.emailRenderer,dataIndex:'email'},{header:"Status",width:80,fixed:true,sortable:true,dataIndex:'status'},{header:"Updated",width:130,hidden:true,sortable:true,dataIndex:'updated'},{header:"Created",width:130,hidden:true,sortable:true,dataIndex:'created'}];this.ds=new Ext.data.Store({url:'/custAdmin/getLisUsers',baseParams:{},reader:new Ext.data.JsonReader({root:"data",totalProperty:'totalCount',id:"id"},this.dataCols)});Mkt.apps.custadmin.LisAdminGrid.superclass.initComponent.call(this);this.getSelectionModel().on('selectionchange',function(){var attr={panelId:'cadLisAdmin'};var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('issueLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(MktPage.appVars.remainSeats<1);tb.items.get('revokeLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);tb.items.get('resendLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);var cfgItm=tb.items.get('configAddin'+MktUtil.camelCase(attr.panelId));if(MktPage.appVars.isTestUser){cfgItm.setVisible(true);cfgItm.setDisabled(count<1);}else{cfgItm.setVisible(false);}}});this.getStore().on('load',function(records,options){Ext.get('cadTotalSeats').update(MktPage.appVars.totalSeats);Ext.get('cadRemainSeats').update(MktPage.appVars.remainSeats);var attr={panelId:'cadLisAdmin'};var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('issueLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(MktPage.appVars.remainSeats<1);tb.items.get('revokeLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);tb.items.get('resendLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);var cfgItm=tb.items.get('configAddin'+MktUtil.camelCase(attr.panelId));if(MktPage.appVars.isTestUser){cfgItm.setVisible(true);cfgItm.setDisabled(count<1);}else{cfgItm.setVisible(false);}}});},issueSeatsModal:function(animEl){var mp=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div id="cadIssueSeatsForm">'+'  <form id="cadIssueSeatsSubmitForm">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr>'+'        <td colspan="2">'+'          <span>Enter a comma separated list of email addresses for each person you want to invite.</span><br/><br/>'+'          <span>Each will receive an email with instructions for downloading and installing the Outlook Add-in.</span>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label" style="width: 130px;">Email Addresses:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" rows="4" id="cadEmails" name="cadEmails" tabindex="1" title="Comma separated list of email addresses"></textarea>'+'          <div class="message"></div>'+'          <br/>'+'          <span>You have '+MktPage.appVars.remainSeats+' seats remaining.</span>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Issue License',iconCls:'mkiDocumentCertificate',okButtonTitle:'Issue License',width:600,height:300});mp.show(animEl,this.submitIssueSeatsModal.createDelegate(this));},submitIssueSeatsModal:function(){if(isDefined(MktPage.appVars.cadIssuedSeats)){delete MktPage.appVars.cadIssuedSeats;}
Ext.MessageBox.show({title:'Please wait...',msg:'Issuing license(s)',progress:true,width:220,closable:false});MktSession.ajaxRequest('/custAdmin/issueSeatsSubmit',{serializeForm:'cadIssueSeatsSubmitForm',onMySuccess:this.issueSeatsDone.createDelegate(this)});return false;},issueSeatsDone:function(){if(isDefined(MktPage.appVars.cadIssuedSeats)&&MktPage.appVars.cadIssuedSeats>0){this.getStore().load();}},clearSeatsModal:function(userIds,userNames,animEl){var mp=new MktModalForm({renderer:function(el,unused){var hiddenInputs='';for(var i=0;i<userIds.length;i++){hiddenInputs+='<input type="hidden" name="cadUserIds[]" value="'+userIds[i]+'" />';}
Ext.DomHelper.append(el,'<div id="cadClearSeatsForm">'+'  <form id="cadClearSeatsSubmitForm">'+
hiddenInputs+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr>'+'        <td colspan="2">'+'          <span>Please confirm that you want to revoke the license'+(userIds.length>1?'s':'')+' for '+userNames+'.</span><br/><br/>'+'          <span>These users will not have access to Marketo functions in the Outlook Add-in.</span>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Revoke License',iconCls:'mkiDocumentForbidden',okButtonTitle:'Revoke License',width:550,height:300});mp.show(animEl,this.submitClearSeatsModal.createDelegate(this,[userIds]));},submitClearSeatsModal:function(userIds){if(isDefined(MktPage.appVars.cadClearedSeats)){delete MktPage.appVars.cadClearedSeats;}
Ext.MessageBox.show({title:'Please wait...',msg:'Revoking license'+(userIds.length>1?'s':''),progress:true,width:220,closable:false});MktSession.ajaxRequest('/custAdmin/clearSeatsSubmit',{serializeForm:'cadClearSeatsSubmitForm',onMySuccess:this.clearSeatsDone.createDelegate(this)});return false;},clearSeatsDone:function(){if(isDefined(MktPage.appVars.cadClearedSeats)&&MktPage.appVars.cadClearedSeats>0){this.getStore().load();}},resendLicenseModal:function(userIds,userNames,animEl){var mp=new MktModalForm({renderer:function(el,unused){var hiddenInputs='';for(var i=0;i<userIds.length;i++){hiddenInputs+='<input type="hidden" name="cadUserIds[]" value="'+userIds[i]+'" />';}
Ext.DomHelper.append(el,'<div id="cadResendLicenseForm">'+'  <form id="cadResendLicenseSubmitForm">'+
hiddenInputs+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr>'+'        <td colspan="2">'+'          <span>Please confirm that you want to resend the invitation'+(userIds.length>1?'s':'')+' for '+userNames+'.</span><br/><br/>'+'          <span>These users will receive a copy of their original registration code with instructions to download and install the Outlook Add-in.</span>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Resend Invitation',iconCls:'mkiMail2',okButtonTitle:'Resend Invitation',width:550,height:300});mp.show(animEl,this.submitResendLicenseModal.createDelegate(this,[userIds]));},submitResendLicenseModal:function(userIds){if(isDefined(MktPage.appVars.cadResentLicenses)){delete MktPage.appVars.cadResentLicenses;}
Ext.MessageBox.show({title:'Please wait...',msg:'Resending license'+(userIds.length>1?'s':''),progress:true,width:220,closable:false});MktSession.ajaxRequest('/custAdmin/resendLicenseSubmit',{serializeForm:'cadResendLicenseSubmitForm',onMySuccess:this.resendLicenseDone.createDelegate(this)});return false;},resendLicenseDone:function(){if(isDefined(MktPage.appVars.cadResentLicenses)&&MktPage.appVars.cadResentLicenses>0){this.getStore().load();}},configAddinModal:function(userIds,userNames,animEl){var mp=new MktModalForm({renderer:function(el,unused){var hiddenInputs='';for(var i=0;i<userIds.length;i++){hiddenInputs+='<input type="hidden" name="cadUserIds[]" value="'+userIds[i]+'" />';}
Ext.DomHelper.append(el,'<div id="cadConfigAddinForm">'+'  <form id="cadConfigAddinSubmitForm">'+
hiddenInputs+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr>'+'        <td colspan="2">'+'          <span>Enter the configuration values for Outlook Add-in user'+(userIds.length>1?'s':'')+' '+userNames+'.</span><br/><br/>'+'          <span>These values will be sent to the Add-in the next time the user restarts Outlook.</span>'+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label" style="width: 130px;">Logging Level:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktForm2Field" type="text" id="cadLoggingLevel" name="cadLoggingLevel" tabindex="1" title="Logging level"></input>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Config Add-in',iconCls:'mkiGearEdit',okButtonTitle:'Save Config',width:550,height:300});mp.show(animEl,this.submitConfigAddinModal.createDelegate(this,[userIds]));},submitConfigAddinModal:function(userIds){if(isDefined(MktPage.appVars.cadConfiguredAddins)){delete MktPage.appVars.cadConfiguredAddins;}
Ext.MessageBox.show({title:'Please wait...',msg:'Updating configuration'+(userIds.length>1?'s':''),progress:true,width:220,closable:false});MktSession.ajaxRequest('/custAdmin/configAddinSubmit',{serializeForm:'cadConfigAddinSubmitForm',onMySuccess:this.configAddinDone.createDelegate(this)});return false;},configAddinDone:function(){if(isDefined(MktPage.appVars.cadConfiguredAddins)&&MktPage.appVars.cadConfiguredAddins>0){this.getStore().load();}}});(function(){Ext.ns('Mkt','Mkt.apps','Mkt.apps.custadmin','Mkt.apps.Salesforce');var _app=Mkt.apps.Salesforce,_data={};_app.setData=function(data)
{_data=data||{};};_app.Actions={editApiConfig:function(animEl)
{var form=new Mkt.apps.Salesforce.ApiConfigForm({host:_data.host,apiUrl:_data.apiUrl,apiAccessKey:_data.apiAccessKey,apiSecretKey:_data.apiSecretKey});form.show(animEl);},editSettings:function(animEl)
{var form=new Mkt.apps.Salesforce.SettingsForm({scoreScoringFieldId:_data.scoreScoringFieldId,urgencyScoringFieldId:_data.urgencyScoringFieldId,emailFromFieldId:_data.emailFromFieldId,rssFeedEnabled:_data.rssFeedEnabled});form.show(animEl);}};_app.SettingsForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Edit Settings',minWidth:450,width:450,autoHeight:true,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktSiSettingsForm',iconCls:'mkiGear',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:145,okText:'Save',submitUrl:'custAdmin/siAdminSettingsSubmit',scoreScoringField:null,urgencyScoringField:null,emailFromField:null,rssFeedField:null,scoringWarningMessage:null,scoringDisabledMessage:null,scoreScoringFieldId:null,urgencyScoringFieldId:null,originalScoreScoringFieldId:null,originalUrgencyScoringFieldId:null,emailFromFieldId:null,rssFeedEnabled:false,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());_app.SettingsForm.superclass.initComponent.call(this);this.originalScoreScoringFieldId=this.scoreScoringFieldId;this.originalUrgencyScoringFieldId=this.urgencyScoringFieldId;},getFields:function()
{var items=[];var scoringFieldSetItems=[];scoringFieldSetItems.push({html:'<div>Choose fields for calculating Best Bets:&nbsp;&nbsp;&nbsp;'+'<a href="/guide/displaySuccessContent?contentTag=cadSIAdmin_link2" target="_blank">Learn More</a></div>',style:'padding-bottom: 20px;',unstyled:true});var scoringFieldsStore=new Ext.data.JsonStore({idProperty:'id',messageProperty:'message',url:'custAdmin/getScoringFieldsList',root:'data.fields',fields:['id','displayName','recommended'],listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}});this.scoreScoringField=new Ext.form.ComboBox({fieldLabel:'Stars',anchor:'-10',editable:true,autoSelect:false,forceSelection:true,allowBlank:false,valueField:'id',displayField:'displayName',triggerAction:'all',mode:'local',tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">{displayName}<tpl if="recommended"> (default)</tpl></div></tpl>'),store:scoringFieldsStore,listeners:{select:this.scoringFieldSelected.createDelegate(this)}});scoringFieldSetItems.push(this.scoreScoringField);this.urgencyScoringField=new Ext.form.ComboBox({fieldLabel:'Flames',anchor:'-10',editable:true,autoSelect:false,forceSelection:true,allowBlank:false,valueField:'id',displayField:'displayName',triggerAction:'all',mode:'local',tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">{displayName}<tpl if="recommended"> (default)</tpl></div></tpl>'),store:scoringFieldsStore,listeners:{select:this.scoringFieldSelected.createDelegate(this)}});scoringFieldSetItems.push(this.urgencyScoringField);this.scoringWarningMessage=new Ext.Panel({cls:'mktForm2Warning mktSiSettingsFormScoringWarning',unstyled:true,hidden:true,html:'<span class="warningTitle">Warning: </span>'+'This change will cause a sync that may take days to complete. Consider letting it run it over a weekend.'});scoringFieldSetItems.push(this.scoringWarningMessage);this.scoringDisabledMessage=new Ext.Panel({cls:'mktForm2Warning mktSiSettingsFormScoringWarning',unstyled:true,hidden:true,html:'<span class="warningTitle">Not Allowed: </span>'+'This feature is temporarily disabled. Please contact support.'});scoringFieldSetItems.push(this.scoringDisabledMessage);items.push({xtype:'fieldset',title:'Scoring Fields',labelWidth:this.labelWidth-10,style:'margin-bottom: 25px;',items:scoringFieldSetItems});this.emailFromField=new Ext.form.ImprovedComboBox({fieldLabel:'From Address Field',anchor:'-20',editable:true,autoSelect:false,forceSelection:true,allowBlank:false,valueField:'id',displayField:'displayName',triggerAction:'all',mode:'local',tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">{displayName}<tpl if="recommended"> (default)</tpl></div></tpl>'),preventExpandOnLoad:true,store:new Ext.data.JsonStore({url:'custAdmin/getEmailFromFieldsList',autoLoad:true,idProperty:'id',messageProperty:'message',root:'data.fields',fields:['id','displayName','recommended'],listeners:{load:function(store){if(!Ext.isEmpty(this.emailFromFieldId)){this.emailFromField.setValue(this.emailFromFieldId);}
else{var record=store.getAt(0);this.emailFromField.setValue(record.get('id'));}}.createDelegate(this)}})});items.push(this.emailFromField);items.push({xtype:'displayfield',cls:'mktModalNote',html:'Note: This setting will apply to all MSI users.'});this.rssFeedField=new Ext.form.Checkbox({fieldLabel:'Enable RSS Feed',checked:this.rssFeedEnabled});items.push(this.rssFeedField);scoringFieldsStore.on('load',function(){this.scoreScoringField.setValue(this.scoreScoringFieldId);this.urgencyScoringField.setValue(this.urgencyScoringFieldId);},this);scoringFieldsStore.load();return items;},scoringFieldSelected:function()
{if(this.originalScoreScoringFieldId!=this.scoreScoringField.getValue()||this.originalUrgencyScoringFieldId!=this.urgencyScoringField.getValue()){if(MktPage.xfeatures){this.scoringWarningMessage.show();this.scoringWarningMessage.getEl().show();}
else{this.scoringDisabledMessage.show();this.scoringDisabledMessage.getEl().show();this.scoreScoringField.setValue(this.originalScoreScoringFieldId);this.urgencyScoringField.setValue(this.originalUrgencyScoringFieldId);}}
else{this.scoringWarningMessage.hide();this.scoringDisabledMessage.hide();this.scoringWarningMessage.getEl().show();this.scoringDisabledMessage.getEl().show();}},beforeSubmitCallback:function()
{var isValid=true;isValid=this.scoreScoringField.validate()&&isValid;isValid=this.urgencyScoringField.validate()&&isValid;isValid=this.emailFromField.validate()&&isValid;return isValid;},okCallback:function()
{this.scoreScoringFieldId=this.scoreScoringField.getValue();this.urgencyScoringFieldId=this.urgencyScoringField.getValue();this.emailFromFieldId=this.emailFromField.getValue();this.rssFeedEnabled=this.rssFeedField.getValue();this.serializeJSON={scoreScoringFieldAttrId:this.scoreScoringFieldId,urgencyScoringFieldAttrId:this.urgencyScoringFieldId,emailFromFieldId:this.emailFromFieldId,rssFeedEnabled:this.rssFeedEnabled};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){_data.scoreScoringFieldId=this.scoreScoringFieldId;_data.urgencyScoringFieldId=this.urgencyScoringFieldId;_data.emailFromFieldId=this.emailFromFieldId;_data.rssFeedEnabled=this.rssFeedEnabled;MktCanvas.reloadActiveTab();this.close();}}});_app.ApiConfigForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Edit API Configuration',minWidth:450,width:450,autoHeight:true,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktSiApiConfigForm',iconCls:'mkiPlug',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:130,okText:'Save',submitUrl:'custAdmin/siAdminApiConfigSubmit',apiSecretKeyField:null,host:null,apiUrl:null,apiAccessKey:null,apiSecretKey:null,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());_app.ApiConfigForm.superclass.initComponent.call(this);},getFields:function()
{var items=[];items.push({xtype:'displayfield',fieldLabel:'Marketo Host',value:this.host,anchor:'-20'});items.push({xtype:'displayfield',fieldLabel:'API URL',value:this.apiUrl,anchor:'-20'});items.push({xtype:'displayfield',fieldLabel:'API User Id',value:this.apiAccessKey,anchor:'-20'});this.apiSecretKeyField=new Ext.form.TextField({fieldLabel:'API Secret Key',value:!Ext.isEmpty(this.apiSecretKey)?this.apiSecretKey:undefined,itemCls:'mktRequired',allowBlank:false,anchor:'-20'});items.push(this.apiSecretKeyField);items.push({unstyled:true,cls:'mktModalNote',html:'Note: Key must be at least 10 characters with at least one number and letter. '+'Changing this setting will immediately impact Sales Insight.&nbsp;&nbsp;'+'<a href="/guide/displaySuccessContent?contentTag=cadLisAdmin_link2" target="_blank">Learn More</a>'});return items;},beforeSubmitCallback:function()
{var secretKey=this.apiSecretKeyField.getValue();if(secretKey.length<10){this.apiSecretKeyField.markInvalid('Key must be at least 10 characters');return false;}
else if(secretKey.search(/\D/i)==-1){this.apiSecretKeyField.markInvalid('Key must contain at least 1 letter');return false;}
else if(secretKey.search(/\d/i)==-1){this.apiSecretKeyField.markInvalid('Key must contain at least 1 number');return false;}
return true;},okCallback:function()
{this.apiSecretKey=this.apiSecretKeyField.getValue();this.serializeJSON={apiSecretKey:this.apiSecretKey};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){_data.apiSecretKey=this.apiSecretKey;MktCanvas.reloadActiveTab();this.close();}}});})();Mkt.apps.custadmin.rcaHomePage=function(canvas,metaData){var nameRenderer=function(val,meta,record,rowIndex,colIndex,store){return val+':';};var linkRenderer=function(val,meta,record,rowIndex,colIndex,store){var link=val;switch(record.json.group){case metaData.rcaAnalysisModelPerformanceLead:link='<a href="#">'+val+'</a>'
break;default:if(record.json.name==='Custom Fields'){link='<a href="#">'+val+'</a>';}
break;}
return link;};var openCustomFieldTab=function(analysisArea){var canvasCustomField='cadCustomFieldSyncCanvas';if(analysisArea===undefined||analysisArea===''){analysisArea=metaData.rcaAnalysisLead;}
var tab=MktCanvas.getTab(canvasCustomField);var customFieldGrid=tab.getGridPanel();if(customFieldGrid){customFieldGrid.store.baseParams.filter=analysisArea;customFieldGrid.getStore().reload();MktCanvas.setActiveTab(tab);var filtersetMenuItems=customFieldGrid.filterMenu.items;for(var i=0;i<filtersetMenuItems.length;i++){if(analysisArea===filtersetMenuItems.item(i).text){filtersetMenuItems.item(i).setChecked(true);}}}
else{tab.config.url+="?filter="+encodeURIComponent(analysisArea);MktCanvas.setActiveTab(tab);}};var editAnalysisAreaField=function(grid,record){var group=record.get('group');var aid=record.get('aid');var idx=record.get('name');var attribName=record.get('value');if(attribName==='None'){attribName='';}
this.rcaMpaFieldPickerFormModal=new Mkt.apps.fm.rcaMpaFieldPickerForm({title:metaData.rcaAnalysisModelPerformanceLead,attribName:attribName,fieldPanel:this,aid:aid,grid:grid,urlLearnMore:metaData.urlLearnMore});this.rcaMpaFieldPickerFormModal.show(grid);};Ext.get('cdhBoxRCACustomFieldSettings').on('click',openCustomFieldTab.createDelegate(this,[metaData.rcaAnalysisLead]));this.grid=new MktGrids.CanvasGridPanel({id:'rcaSummaryGrid',title:'Sync Summary',cls:'no-grid-header no-grid-back ',loadMask:true,maskCanvas:false,enableTotal:false,enablePurpleCorners:false,refreshText:'Refresh',refreshTooltip:undefined,refreshIcon:undefined,exportIcon:undefined,cm:new Ext.grid.ColumnModel([{header:'Order',id:'order',hidden:true,dataIndex:'order',width:1},{header:'Group',id:'group',dataIndex:'group',width:1},{header:'Name',id:'name',dataIndex:'name',width:140,renderer:nameRenderer},{header:'Value',id:'value',dataIndex:'value',width:100,renderer:linkRenderer}]),ds:new MktGrids.JsonGroupingStore({url:'/custAdmin/queryRcaSummaryData',baseParams:{},root:'data',fields:[{name:'order',type:'int',sortDir:'ASC'},{name:'group'},{name:'aid'},{name:'name'},{name:'value'}],sortInfo:{field:'order',sortDir:'ASC'},hasMultiSort:false,sortByField:true,groupField:'group',groupOnSort:false,remoteGroup:true,remoteSort:false,listeners:{'load':function(store){var lastIndex=store.getTotalCount()-1;this.grid.totalCountBinnedFields=store.getAt(lastIndex).get('value');store.removeAt(lastIndex);}.createDelegate(this)}}),view:new Ext.grid.GroupingView({groupTextTpl:'{text}',showGroupName:false,hideGroupedColumn:true}),autoExpandColumn:'value',autoExpandMin:100,disableSelection:true,trackMouseOver:false,stripeRows:false});this.grid.on('cellclick',function(grid,rowIndex,columnIndex,e){var record=grid.getStore().getAt(rowIndex);var fieldName=grid.getColumnModel().getDataIndex(columnIndex);if(fieldName==='value'){var group=record.get('group');var value=record.get(fieldName);switch(record.json.group){case metaData.rcaAnalysisModelPerformanceLead:if(grid.totalCountBinnedFields){editAnalysisAreaField(grid,record);}
else{MktSession.showMessage('No grouped fields are available for sync<div style="position: absolute; left: 20px; bottom: 50px;">'
+'<a href="'+metaData.urlLearnMore+'" target= "_blank">Learn More</a></div>','info');}
break;default:var name=record.get('name');if(name==='Custom Fields'){openCustomFieldTab(group);}
break;}}
e.stopEvent();});var tabItems=[];tabItems.push(this.grid);this.detailPanel=new MktPanel.CanvasResizableTabPanel({renderTo:'cadDetailPanel',canvas:canvas,reservedHeight:130,reservedWidth:330,fitToCanvas:true,activeTab:0,plain:true,defaults:{autoScroll:true},items:tabItems});this.grid.store.load();MktSession.unclockCursor();return this;};Mkt.apps.custadmin.customFieldsGridPanel=Ext.extend(MktGrids.CanvasGridPanel,{view:new MktGrids.BufferGridView({forceFit:true}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),reloadAfterLayoutSave:false,enableTotal:true,enablePaging:true,enableSearchPaging:true,pagingDisplayMsg:'{0}-{1} of {2}',pagingEmptyMsg:"No fields found",searchEmptyText:'Quick Find...',searchQtip:'Searches Field Name',loadMask:true,beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading {0} fields...',totalDisplayMsg:'Displaying {0} fields',showRefreshButton:true,stripeRows:true,autoExpandColumn:'analysisArea',initComponent:function(){this.cm=new Ext.grid.ColumnModel([{id:'name',header:'Field Name',dataIndex:'name',sortable:true,width:60,editable:false},{id:'sync',header:'Sync Status',dataIndex:'status',sortable:true,width:30,renderer:this.syncStatusRenderer.createDelegate(this),editor:this.syncStatusEditor(this)},{id:'sourceObject',header:'Field Category',dataIndex:'category',sortable:true,width:30,editable:false},{id:'type',header:'RCA Type',dataIndex:'olapType',sortable:false,width:30,renderer:this.rcaOlapTypeRenderer.createDelegate(this),editor:this.rcaOlapTypeEditor(this)},{id:'analysisArea',header:'Analysis Areas',dataIndex:'analysisArea',sortable:false,renderer:this.analysisAreaRenderer.createDelegate(this)}]);this.ds=new MktGrids.JsonGroupingStore({url:'custAdmin/getCustomFields',baseParams:{limit:this.pageSize,filter:this.colMeta.activeFilter},root:this.colMeta.root,totalProperty:this.colMeta.totalProperty,idProperty:this.colMeta.idProperty,successProperty:this.colMeta.successProperty,fields:this.colMeta.fields,remoteSort:true,remoteGroup:false,sortInfo:this.colMeta.sortInfo,sortByField:true});delete this.filter;Mkt.apps.custadmin.customFieldsGridPanel.superclass.initComponent.call(this);},getOlapTypeStore:function(record){var rcaOlapTypeText=['Dimension','Dimension','mkiBulletBallYellow'];var rcaOlapTypeNumber=['Metric','Metric','mkiBulletBallBlue'];var rcaOlapTypes=[rcaOlapTypeText];var dbObjectName=record.data['dbObjectName'];var otherAnalysisAreas=this.getOtherAnalysisArea(record);var currentFilter=this.store.baseParams.filter;if(otherAnalysisAreas.length===0&&currentFilter==='Lead Analysis'&&(dbObjectName=='Person'||dbObjectName=='Lead Interest')){rcaOlapTypes.push(rcaOlapTypeNumber);}
var rcaOlapTypeStore=new Ext.data.ArrayStore({fields:['valueField','displayField','iconCls'],data:rcaOlapTypes});return rcaOlapTypeStore;},setOlapTypeStore:function(rowEditor){var rcaOlapTypeStore=this.getOlapTypeStore(rowEditor.record);rowEditor.items.items[3].bindStore(rcaOlapTypeStore);},syncStatusRenderer:function(val,meta,record,rowIndex,colIndex,store){return(val==='enabled')?'<img class="mki16 mkiOk customFieldCellIcon" src="'+Ext.BLANK_IMAGE_URL+'">':'';},rcaOlapTypeRenderer:function(val,meta,record,rowIndex,colIndex,store){if(val==='Dimension'){cls='mkiBulletBallYellow';}
else{cls='mkiBulletBallBlue';}
return(record.json.status==='enabled')?'<img class="mki16 '+cls+' customFieldCellIcon" src="'+Ext.BLANK_IMAGE_URL+'">'+val:'';},analysisAreaRenderer:function(val,meta,record,rowIndex,colIndex,store,ignoreStatus){var analysisAreas='';if(ignoreStatus===undefined){ignoreStatus=false;}
if(record.data['status']==='enabled'||ignoreStatus){if(val!=null&&val!=''){var jsonData=Ext.decode(val);analysisAreas=jsonData.analysisArea.join(', ');}}
else if(record.data['status']==='enabled'){analysisAreas=this.getOtherAnalysisArea(record).join(', ');}
analysisAreas=analysisAreas?analysisAreas.replace(/[\s]*Analysis/gi,''):'&nbsp;';analysisAreas=analysisAreas?analysisAreas.replace(/\(Lead\)/gi,'(Leads)'):'&nbsp;';return analysisAreas;},syncStatusEditor:function(grid,val,record){var syncStatus=[['disabled','Disabled'],['enabled','Enabled']];var syncStatusStore=new Ext.data.ArrayStore({fields:['valueField','displayField'],data:syncStatus});return new Ext.form.ComboBox({value:val,grid:grid,record:record,store:syncStatusStore,valueField:'valueField',displayField:'displayField',mode:'local',typeAhead:true,triggerAction:'all',selectOnFocus:true,allowBlank:false,lazyRender:true,editable:false,emptyText:false,forceSelection:true,listeners:{'select':function(e,selected,old_val){var rowEditor=e.grid.rowEditor;var record=rowEditor.record;record.set('status',selected.data['valueField']);if(selected.data['valueField']==='enabled'){if(record.data['olapType']===null||record.data['olapType']===''){record.set('olapType','Dimension');}
this.grid.setOlapTypeStore(e.grid.rowEditor);rowEditor.items.items[3].enable();}
else{rowEditor.items.items[3].disable();}
var analysisAreas=e.grid.getAnalysisAreas(record);record.set('analysisArea',analysisAreas);e.grid.analysisAreaDisplayField(rowEditor,analysisAreas);}}});},analysisAreaDisplayField:function(rowEditor,val){var rowIndex=rowEditor.rowIndex;var record=rowEditor.record;var analysisAreaColIndex=4;var displayVal=rowEditor.grid.analysisAreaRenderer(val,null,record,rowIndex,analysisAreaColIndex,null);var fields=rowEditor.items.items;fields[analysisAreaColIndex].setValue(displayVal);},rcaOlapTypeEditor:function(grid,val){var rcaOlapTypes=[['Dimension','Dimension','mkiBulletBallYellow']];var rcaOlapTypeStore=new Ext.data.ArrayStore({fields:['valueField','displayField','iconCls'],data:rcaOlapTypes});return new Ext.form.ComboBox({grid:grid,store:rcaOlapTypeStore,valueField:'valueField',displayField:'displayField',mode:'local',typeAhead:true,triggerAction:'all',selectOnFocus:true,allowBlank:false,lazyRender:true,editable:false,emptyText:'- Choose -',tpl:'<tpl for="."><div class="x-combo-list-item"><img class="mki16 {iconCls} customFieldCellIcon" src="'+Ext.BLANK_IMAGE_URL+'">{displayField}</div></tpl>',tplWriteMode:'overwrite',forceSelection:true,listeners:{scope:this,'render':function(e){var record=e.grid.rowEditor.record;var defaultOlapType=record.data['olapType'];var exist=false;var len=rcaOlapTypeStore.data.items.length;for(var i=0;i<len;i++){if(defaultOlapType==rcaOlapTypeStore.data.items[i].data['valueField']){exist=true;break;}}
if(!exist){record.set('olapType',rcaOlapTypeStore.data.items[0].data['valueField']);}
var disableCombo=(e.grid.rowEditor.record.data['status']==='disabled')?true:false;if(disableCombo){e.disable();}},'show':function(e){e.grid.setOlapTypeStore(e.grid.rowEditor);var disableCombo=(e.grid.rowEditor.record.data['status']==='disabled')?true:false;if(disableCombo){e.disable();}
else{e.enable();}},'select':function(e,selected,old_val){var record=e.grid.rowEditor.record;record.set('olapType',selected.data['valueField']);if(record.data['status']==='enabled'){if(record.data['olapType']===null||record.data['olapType']===''){record.set('olapType','Dimension');}}
var analysisAreas=e.grid.getAnalysisAreas(record);record.set('analysisArea',analysisAreas);e.grid.analysisAreaDisplayField(e.grid.rowEditor,analysisAreas);}}});},getAnalysisAreas:function(record){var rcaSyncEnabled=record.get('status');var olapType=record.get('olapType');var dbObjectName=record.get('dbObjectName');var analysisAreas=[];if(rcaSyncEnabled==='enabled'){switch(dbObjectName){case'Opportunity':if(olapType==='Dimension'){analysisAreas=["Opportunity Analysis"];}
break;default:if(olapType==='Metric'){analysisAreas=["Lead Analysis"];}
else{analysisAreas=["Lead Analysis","Campaign Analysis","Opportunity Analysis"];}
break;}}
var otherAreas=this.getOtherAnalysisArea(record);return Ext.encode({'analysisArea':analysisAreas.concat(otherAreas)});},getOtherAnalysisArea:function(record){var arrArea=[];if(record.json.analysisArea){var objArea=Ext.decode(record.json.analysisArea);arrArea=objArea.analysisArea;if(arrArea.length>0){var mainAreas=["Lead Analysis","Campaign Analysis","Opportunity Analysis"];for(var i=0;i<mainAreas.length;i++){arrArea.remove(mainAreas[i]);}}}
return arrArea;},applyFilter:function(filter){if(!filter.length)return;var store=this.getStore();newFilter=filter.join(',');if(store.baseParams.filter!=newFilter){store.setBaseParam('filter',newFilter);lastOptions=store.lastOptions;Ext.apply(lastOptions.params,{start:0});store.reload(lastOptions);}}});Mkt.apps.custadmin.customFieldsGrid=function(canvas,metaData,filters,activeFilter){this.grid=new Mkt.apps.custadmin.customFieldsGridPanel({id:'custCustomFieldSyncGrid',canvas:canvas,pageSize:metaData.pageSize,colMeta:{fields:metaData.fields,idProperty:metaData.idProperty,root:metaData.root,activeFilter:activeFilter,sortInfo:metaData.sortInfo,successProperty:metaData.successProperty,totalProperty:metaData.totalProperty}});var panel=MktCanvas.getItem(MktCanvas.getTab(canvas));if(panel){panel.setGridPanel(this.grid);}
MktCanvas.fillCanvasGrid(this.grid,canvas);this.grid.filterMenu=new Mkt.apps.custadmin.customFieldsGrid.filterMenu(canvas,this.grid,filters);MktCanvas.extendToolbar([new Ext.Button({id:'cadChangeButton',iconCls:'mkiPencil',text:'Edit Sync Option',disabled:true,handler:function(btn){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var selectedIndex=grid.getSelectionModel().getSelectedIndex();grid.rowEditor.stopEditing(false);grid.rowEditor.startEditing(selectedIndex);}}.createDelegate(this)})]);var rowChangeHandler=function(selectionModel){var activeTab=MktCanvas.getActiveTab();if(!activeTab)return;var tb=activeTab.getTopToolbar();if(!tb||!tb.items)return;if(selectionModel.getCount()===1){tb.items.get('cadChangeButton').setDisabled(false);}
else{tb.items.get('cadChangeButton').setDisabled(true);}};this.grid.getSelectionModel().on('selectionchange',rowChangeHandler);this.grid.rowEditor=Mkt.apps.custadmin.createCustomFieldRowEditor();this.grid.rowEditor.grid=this.grid;this.grid.plugins=this.grid.rowEditor;this.grid.store.on('beforeload',function(){this.grid.rowEditor.stopEditing(false);}.createDelegate(this));this.grid.on('rowDblclick',function(grid,rowIndex,e){e.stopEvent();var selectedIndex=grid.getSelectionModel().getSelectedIndex();grid.rowEditor.stopEditing(false);grid.rowEditor.startEditing(selectedIndex);});this.grid.loadPagedGrid();return this;};Mkt.apps.custadmin.customFieldsGrid.filterMenu=function(canvas,grid,filters){this.buildFilterTextAndFilter=function(){var filter=[];var summaryText='Filter: ';var numChecked=0;this.filtersetMenu.items.each(function(item,index,length){if(item.isXType('menucheckitem')){if(item.checked){summaryText+=item.text;if(isDefined(item.statusId)){filter.push(item.statusId);}}}});return{text:summaryText,filter:filter}};this.changedFilterset=function(menuItem,value){var filterInfo=this.buildFilterTextAndFilter();this.filterInfo=filterInfo;this.filtersetMenu.hide();this.filterBtn.setText(this.filterInfo.text);if(grid.store.baseParams.filter!==this.filterInfo.filter){grid.applyFilter(this.filterInfo.filter);}},this.checkMenuItem=function(val){for(var i=0;i<this.filtersetMenu.items.length;i++){var selectedItem=false;if(val===this.filtersetMenu.items[i]['code']){this.filtersetMenu.item[i].setChecked(true);}}};var tbar=[];this.filtersetMenu=new MktMenu({cls:"MktMenu mktMenuStrictHeight"});var defaultFilter=filters.selFilter;for(var i=0;i<filters.items.length;i++){var selectedItem=false;if(defaultFilter===filters.items[i]['code']){selectedItem=true;}
var item=new Ext.menu.CheckItem({xtype:'vx-radio',statusId:filters.items[i]['code'],text:filters.items[i]['code'],group:'filterArea',hideOnClick:false,checked:selectedItem,checkHandler:this.changedFilterset.createDelegate(this)});this.filtersetMenu.add(item);}
var filterInfo=this.buildFilterTextAndFilter();this.filterBtn=new Ext.Button({id:'cadCustomFieldFilter',text:filterInfo.text,iconCls:'mkiFunnel',menu:this.filtersetMenu});tbar.push(this.filterBtn);MktCanvas.extendGutter(tbar,canvas);return this.filtersetMenu;}
Mkt.apps.custadmin.createCustomFieldRowEditor=function(){var cancelEdit=function(rowEditor){if(rowEditor.record.data.aid==null){rowEditor.grid.store.remove(rowEditor.record);}
else{rowEditor.grid.getStore().rejectChanges();}
rowEditor.grid.getView().refresh();rowEditor.grid.showEmptyMsg();};var rcaSyncOptionEditDone=function(rowEditor){if(MktPage.appVars.result&&MktPage.appVars.result=="Success"){this.editing=false;this.hide();var summaryTab=MktCanvas.getTab('cadRevenueCycleAnalyticsCanvas');if(summaryTab){summaryTab.clearContentValid();}
rowEditor.grid.getStore().reload();}else{MktMessage.showInfo(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}};var beforeEdit=function(rowEditor){if(rowEditor.editing&&rowEditor.record){rowEditor.showTooltip(rowEditor.commitChangesText);rowEditor.persistTooltip=true;return false;}};var afterChanges=function(rowEditor,changes,record){MktSession.clockCursor(true);var aid=[record.get('aid')];var rcaSyncEnabled=(record.get('status')==='enabled')?true:false;var olapType=record.get('olapType');if(changes.status){rcaSyncEnabled=(changes.status==='enabled')?true:false;}
if(changes.olapType){olapType=changes.olapType;}
var analysisArea=rowEditor.grid.getAnalysisAreas(record);record.set('analysisArea',analysisArea);MktSession.ajaxRequest('fieldManagement/analyticsOptionsSubmit',{serializeParms:{aids:Ext.encode(aid),rcaSyncEnabled:rcaSyncEnabled,olapType:olapType,analysisAreas:analysisArea},onMySuccess:rcaSyncOptionEditDone.createDelegate(this,[rowEditor])});};var rowEditor=new MktGrids.RowEditor({id:'rcaFieldRowEditor',clicksToEdit:2,forceSave:false,lazyDismiss:true,listeners:{'canceledit':cancelEdit,'beforeedit':beforeEdit,'afteredit':Ext.emptyFn,'afterchanges':afterChanges},getCustomGridValue:function(rowEditor,val,cm,colIndex,record){var columnId=cm.getColumnId(colIndex);var column=cm.getColumnById(columnId);if(columnId=='analysisArea'){val=column.renderer.call(column,val,{},record,rowEditor.rowIndex,colIndex,null,true);}
return val;}});return rowEditor;};(function(){Ext.ns('Mkt','Mkt.apps','Mkt.apps.LoginSettings');var _app=Mkt.apps.LoginSettings,_data={};_app.setData=function(data)
{_data=data||{};};_app.Actions={editRestrictedLogin:function(animEl)
{var form=new _app.RestrictedLoginForm({type:_data.type,ips:_data.ips,ignoreRestrictions:_data.ignoreRestrictions});form.show(animEl);}};_app.RestrictedLoginForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Edit IP Restrictions',height:400,minHeight:340,minWidth:400,width:450,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktRestrictedLoginForm',iconCls:'mkiLockInformation',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:130,okText:'Save',submitUrl:'custAdmin/restrictedLoginSubmit',ipFields:[],typeField:null,ignoreField:null,ipFieldsPanel:null,type:null,ips:[],ignoreRestrictions:null,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());_app.RestrictedLoginForm.superclass.initComponent.call(this);},getFields:function()
{var items=[];this.ipFields=[];this.typeField=new Ext.form.RadioGroup({hideLabel:true,columns:1,items:[{boxLabel:'Allowed IP addresses',inputValue:'allow',name:'type',checked:this.type=='allow'||!this.type},{boxLabel:'Blocked IP addresses',inputValue:'block',name:'type',checked:this.type=='block'}]});items.push(this.typeField);this.ipFieldsPanel=new Ext.Panel({layout:'form',columnWidth:1,autoHeight:true,unstyled:true,items:this.ipFields});if(this.ips&&this.ips.length){for(var i=0,il=this.ips.length;i<il;i++){this._addIpField(this.ips[i]);}}
this._addIpField();var ipPanel=new Ext.Panel({title:'Enter IP addresses:',layout:'column',autoHeight:true,anchor:'-20',unstyled:true,cls:'mktRestrictedLoginIpFieldsPanel',html:{cls:'mktRestrictedLoginExamples',tag:'div',cn:[{tag:'span',cls:'mktRestrictedLoginExamplesLabel',html:'Examples:'},{tag:'div',cls:'mktRestrictedLoginExamplesContent',cn:[{tag:'span',html:'192.168.1.1'},{tag:'span',html:'192.168.1.1-192.168.1.100'},{tag:'span',html:'192.168.*.*'}]}]},items:[this.ipFieldsPanel,{xtype:'button',text:'Add',cls:'mktRestrictedLoginAddIpButton',iconCls:'mkiAdd2',itemId:'addIpButton',onClick:function(){this._addIpField()}.createDelegate(this)}]});items.push(ipPanel);this.ignoreField=new Ext.form.Checkbox({boxLabel:'Disable IP Restrictions',hideLabel:true,checked:this.ignoreRestrictions});items.push(this.ignoreField);return items;},_addIpField:function(value)
{var field=new Ext.form.TextField({hideLabel:true,value:value,vtype:'ipWithRange',flex:1});this.ipFields.push(field);var removeLink=new Ext.Element(Ext.DomHelper.createDom({html:'<a href="#"><img class="mkiCancel" height="16" width="16" src="'+Ext.BLANK_IMAGE_URL+'" /></a>'}));removeLink.setVisible(!Ext.isEmpty(value));var compositeField=new Ext.form.CompositeField({hideLabel:true,anchor:'-10',combineErrors:false,items:[field,{contentEl:removeLink,style:'padding: 2px 0 0 5px;',unstyled:true,width:30}]});removeLink.on('click',function(e){e.stopEvent();this.ipFieldsPanel.remove(compositeField);this.ipFields.remove(field);},this);this.ipFieldsPanel.add(compositeField);if(this.ipFieldsPanel.rendered){this.ipFieldsPanel.doLayout();}
field.focus();},beforeSubmitCallback:function()
{var isValid=true;isValid=this.typeField.validate()&&isValid;for(var i=0,il=this.ipFields.length;i<il;i++){isValid=this.ipFields[i].validate()&&isValid;}
return isValid;},okCallback:function()
{var ips=[];for(var i=0,il=this.ipFields.length;i<il;i++){var ip=this.ipFields[i].getValue();if(ip){ips.push(ip);}}
this.type=this.typeField.getValue().getGroupValue();this.ips=ips;this.ignoreRestrictions=this.ignoreField.getValue();this.serializeJSON={type:this.type,ips:this.ips,ignoreRestrictions:this.ignoreRestrictions};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){this.close();_data.type=this.type;_data.ips=this.ips;_data.ignoreRestrictions=this.ignoreRestrictions;MktCanvas.reloadActiveTab();}}});})();(function(){var _app=Mkt.apps.custadmin;_app.ContentPanel=Ext.extend(Ext.Panel,{cls:'cadContentPanel',layout:'form',labelWidth:140,description:null,watermarkCls:null,unstyled:true,initComponent:function()
{this.defaults=Ext.apply({labelWidth:140},this.defaults||{});if(!Ext.isEmpty(this.description)){this.title='<h1>'+this.title+'</h1><h3>'+this.description+'</h3>';}
if(!Ext.isEmpty(this.watermarkCls)){this.on('render',function(){this.el.insertFirst(Ext.DomHelper.createDom({tag:'div',cls:'cadContentPanelWatermark '+this.watermarkCls}));});}
_app.ContentPanel.superclass.initComponent.call(this);}});Ext.reg('admincontent',_app.ContentPanel);_app.ContentPanelBlock=Ext.extend(Ext.form.FieldSet,{cls:'cadContentPanelBlock',editable:false,width:430,initComponent:function()
{this.defaults=Ext.apply({xtype:'displayfield'},this.defaults||{});if(this.editable){this.on('render',function(){var editLink=new Ext.Element(Ext.DomHelper.createDom({tag:'div',cls:'cadContentPanelBlockEditLink mkiPencil',html:'Edit'}));editLink.on('click',function(){this.fireEvent('edit');},this);this.bwrap.appendChild(editLink);this.addClass('cadContentPanelBlockEditable');});}
_app.ContentPanelBlock.superclass.initComponent.call(this);}});Ext.reg('admincontentblock',_app.ContentPanelBlock);_app.CodeSnippet=Ext.extend(Ext.form.TextArea,{cls:'mktCodeSnippetText',style:'overflow: hidden',labelStyle:'padding-top: 13px;',readOnly:true,selectOnFocus:true,initComponent:function()
{this.on('render',function(){this.getEl().insertHtml('beforeBegin','<div class="mktCodeSnippetIcon"></div>');})
_app.CodeSnippet.superclass.initComponent.call(this);}});Ext.reg('codesnippet',_app.CodeSnippet);})();
/* ========== ../mkt-ext-2.0/menus/CustAdminMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.CustAdmin');Mkt.menus.CustAdmin.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(Mkt.menus.CustAdmin.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=Mkt.menus.CustAdmin.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('CustAdmin',toolbarRequestHandler);return{getUser:function(attr){return new Ext.Toolbar({items:[{text:'Invite New User',iconCls:'mkiUserAdd',handler:function(button,e){mktCADUserGrid.createUser({target:button.getEl().dom});}},{itemId:'editUser',text:'Edit User',iconCls:'mkiUserEdit',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){mktCADUserGrid.editUser(button.getEl().dom,rec);}}}},{itemId:'deleteUser',text:'Delete User',iconCls:'mkiUserDelete',disabled:true,handler:function(button){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var obj=grid.getSelectionModel().getSelected().data;if(obj){mktCADUserGrid.deleteUser(button.getEl().dom);}}}},{itemId:'resetPassword',text:'Reset Password',iconCls:'mkiUserRefresh',disabled:true,handler:function(button){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var obj=grid.getSelectionModel().getSelected().data;if(obj){mktCADUserGrid.resetPassword(button.getEl().dom);}}}}]});},updateUserTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab('cadCanvasUsers'));var sm=panel.getGridPanel().getSelectionModel();var count=sm.getCount();var tb=panel.getTopToolbar();if(tb){var isUser=false;if(count==1){var rec=sm.getSelected();isUser=rec.data['isUser'];}
tb.items.get('editUser').setDisabled(count!=1||!isUser);tb.items.get('resetPassword').setDisabled(count!=1||!isUser);tb.items.get('deleteUser').setDisabled(count!=1);}},getUserAccounts:function(attr){return new Ext.Toolbar({items:[{text:'Edit User',itemId:'editUser'+MktUtil.camelCase(attr.panelId),iconCls:'mkiEdit',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){mktSADUserGrid.prototype.editUserModal(button.getEl().dom,rec);}}}},{text:'New User',itemId:'newUser'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUser',handler:function(button,e){mktSADUserGrid.prototype.newUserModal(button.getEl().dom);}}]});},updateUserAccountTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab('admCanvas5'));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('editUserAdmCanvas5').setDisabled(count!=1);}},getRole:function(attr){return new Ext.Toolbar({items:[{itemId:'newRole',text:'New Role',iconCls:'mkiIdCardAdd',handler:function(button,e){mktCADRoleGrid.createRole({target:button.getEl().dom});}},{itemId:'editRole',text:'Edit Role',iconCls:'mkiIdCardEdit',disabled:true,handler:function(button,e){MktSession.clockCursor(true);mktCADRoleGrid.editRole({target:button.getEl().dom});}},{itemId:'deleteRole',text:'Delete Role',iconCls:'mkiIdCardDelete',disabled:true,handler:function(button){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var obj=grid.getSelectionModel().getSelected().data;if(obj){mktCADRoleGrid.deleteRole(button.getEl().dom);}}}}]});},updateRoleTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab('cadCanvasRoles'));var sm=panel.getGridPanel().getSelectionModel();var count=sm.getCount();var tb=panel.getTopToolbar();if(tb){if(count==1){var rec=sm.getSelected();}
tb.items.get('editRole').setDisabled(count!=1);tb.items.get('deleteRole').setDisabled(count!=1);}},getZone:function(attr){return new Ext.Toolbar({items:[{itemId:'newZone',text:'New Workspace',iconCls:'mkiEnvironmentAdd',handler:function(button,e){mktCADZoneGrid.createZone({target:button.getEl().dom});}},{itemId:'editZone',text:'Edit Workspace',iconCls:'mkiEnvironmentEdit',disabled:true,handler:function(button,e){MktSession.clockCursor(true);mktCADZoneGrid.editZone({target:button.getEl().dom});}},{itemId:'deleteZone',text:'Delete Workspace',iconCls:'mkiEnvironmentDelete',disabled:true,handler:function(button){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var obj=grid.getSelectionModel().getSelected().data;if(obj){mktCADZoneGrid.deleteZone(button.getEl().dom);}}}}]});},updateZoneTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab('cadCanvasZones'));var sm=panel.getGridPanel().getSelectionModel();var count=sm.getCount();var tb=panel.getTopToolbar();if(tb){if(count==1){var rec=sm.getSelected();}
tb.items.get('editZone').setDisabled(count!=1);tb.items.get('deleteZone').setDisabled(count!=1);}},getPartition:function(attr){return new Ext.Toolbar({items:[{itemId:'newPartition',text:'New Lead Partition',iconCls:'mkiDataAdd',handler:function(button,e){mktCADPartitionGrid.createPartition({target:button.getEl().dom});}},{itemId:'editPartition',text:'Edit Lead Partition',iconCls:'mkiDataEdit',disabled:true,handler:function(button,e){MktSession.clockCursor(true);mktCADPartitionGrid.editPartition({target:button.getEl().dom});}},{itemId:'deletePartition',text:'Delete Lead Partition',iconCls:'mkiDataDelete',disabled:true,handler:function(button){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var obj=grid.getSelectionModel().getSelected().data;if(obj){mktCADPartitionGrid.deletePartition(button.getEl().dom);}}}},"-",{id:'assignmentRules',text:'Assignment Rules',iconCls:'mkiDataInto',disabled:false,handler:function(button){var leadAction=new Mkt.apps.leadAction();leadAction.editLeadAction(button,100);}}]});},updatePartitionTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab('cadCanvasPartitions'));var sm=panel.getGridPanel().getSelectionModel();var count=sm.getCount();var tb=panel.getTopToolbar();if(tb){if(count==1){var rec=sm.getSelected();}
tb.items.get('editPartition').setDisabled(count!=1);tb.items.get('deletePartition').setDisabled(count!=1);}},getSalesforce:function(attr){var tb=[];if(attr.showSyncDataButtons){tb.push({text:'Start Salesforce Sync',itemId:'start'+MktUtil.camelCase(attr.panelId),iconCls:'mkiNavRefreshBlue',disabled:false,handler:Mkt.apps.Salesforce.syncData.createDelegate(Mkt.apps.Salesforce)});tb.push('-');tb.push({text:'Edit Mappings',itemId:'editMappings'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataEdit',disabled:false,handler:function(){MktDlManager.loadDl({type:'SchemaHome',panelId:'fmFieldMapping',populateMapping:true,nodeId:MktPage.constants.adminTreeMeta.FIELD_MANAGEMENT.nodeId});}});}
if(attr.showSyncFields){tb.push({text:'Sync Fields',itemId:'syncFields'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataRefresh',disabled:false,handler:Mkt.apps.Salesforce.syncFields.createDelegate(Mkt.apps.Salesforce)});}
return new Ext.Toolbar({items:tb});},getLisAdmin:function(attr){return new Ext.Toolbar({items:[{text:'Issue License',itemId:'issueLicense'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDocumentCertificate',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.issueSeatsModal(button.getEl());}}},{text:'Revoke License',itemId:'revokeLicense'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDocumentForbidden',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var sm=grid.getSelectionModel();var userIds=[];var userNames='';var selected=sm.getSelections();for(var i=0;i<selected.length;i++){var record=selected[i];var fname=record.get('firstName');var lname=record.get('lastName');var nameToUse=record.get('email');if(userNames.length>0){userNames+=', ';if(i==selected.length-1){userNames+=' and ';}}
userNames+='<b>'+nameToUse+'</b>';userIds.push(record.get('id'));}
grid.clearSeatsModal(userIds,userNames,button.getEl());}}},{text:'Resend Invitation',itemId:'resendLicense'+MktUtil.camelCase(attr.panelId),iconCls:'mkiMail2',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var sm=grid.getSelectionModel();var userIds=[];var userNames='';var selected=sm.getSelections();for(var i=0;i<selected.length;i++){var record=selected[i];var fname=record.get('firstName');var lname=record.get('lastName');var nameToUse=record.get('email');if(userNames.length>0){userNames+=', ';if(i==selected.length-1){userNames+=' and ';}}
userNames+='<b>'+nameToUse+'</b>';userIds.push(record.get('id'));}
grid.resendLicenseModal(userIds,userNames,button.getEl());}}},{text:'Purchase More Seats',itemId:'addSeats'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUserAdd',handler:function(button,e){MktMessage.showInfo('If you would like to add additional seats to your subscription,<br/>'+'contact the Marketo sales team at <a href="mailto:sales@marketo.com">sales@marketo.com</a><br/>',undefined,button.getEl().dom);}},{text:'Config Add-in',itemId:'configAddin'+MktUtil.camelCase(attr.panelId),iconCls:'mkiGearEdit',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var sm=grid.getSelectionModel();var userIds=[];var userNames='';var selected=sm.getSelections();for(var i=0;i<selected.length;i++){var record=selected[i];if('Active'==record.get('status')){var fullName=record.get('firstName')+' '+record.get('lastName');if(userNames.length>0){userNames+=', ';if(i==selected.length-1){userNames+=' and ';}}
userNames+='<b>'+fullName+'</b>';userIds.push(record.get('id'));}}
grid.configAddinModal(userIds,userNames,button.getEl());}}}]});},updateLisAdminTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('issueLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(MktPage.appVars.remainSeats<1);tb.items.get('revokeLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);tb.items.get('resendLicense'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);var cfgItm=tb.items.get('configAddin'+MktUtil.camelCase(attr.panelId));if(MktPage.appVars.isTestUser){cfgItm.setVisible(true);cfgItm.setDisabled(count<1);}else{cfgItm.setVisible(false);}}},getFieldMapping:function(attr){var tb=[];var panelId='fmFieldMapping';tb.push({text:'Finish Mappings',itemId:'finishMappings'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataOk',disabled:false,handler:Mkt.apps.Salesforce.finishMapping});tb.push('-');tb.push({text:'Reset Schema',itemId:'resetSchema'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataError',disabled:false,handler:function(btn){Ext.Msg.show({title:"Marketo",width:410,msg:'<div style="float:left; width: 325px;"><b>Warning:</b> This will discard all of your mapping choices and start again'
+" from scratch.<br /><br />"
+"Are you sure you want to reset to the initial mappings?</div>",fn:function(btn,text){if(btn=="ok"){var fieldMapping=MktCanvas.getRegisteredItem('fieldMapping',panelId);if(fieldMapping){fieldMapping.resetMapping.call(fieldMapping);}}},buttons:{ok:'Reset Schema',cancel:'Cancel'},animEl:btn.el,icon:Ext.MessageBox.WARNING});}});tb.push('-');tb.push({text:'Break Mapping',itemId:'breakMapping'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataError',disabled:false,handler:function(){var fieldMapping=MktCanvas.getRegisteredItem('fieldMapping',panelId);if(fieldMapping){fieldMapping.unmapFields.call(fieldMapping);}}});return new Ext.Toolbar({items:tb});},getSyncOptionAdmin:function(){return new Ext.Toolbar({items:[{xtype:'button',text:'Edit Sync Options Setting',iconCls:'mkiGearEdit',handler:function(){Mkt.apps.Salesforce.syncObjOptAdminForm.show();Mkt.apps.Salesforce.updateSyncObjOptAdminForm();}}]});},getObjectSync:function(attr){var tb=[];var canvas="cadSfdcObjectSync";var os=Mkt.apps.ObjectSync;tb.push({text:"Refresh Schema",itemId:"refresh"+MktUtil.camelCase(attr.panelId),iconCls:"mkiNavRefreshBlue",disabled:false,handler:function(button){var os=Mkt.apps.ObjectSync;os.refreshObjectsRequest.call(os,button.el);}});var syncObjectBtn=new Ext.Button({text:"Enable Sync",itemId:"syncOjbect"+MktUtil.camelCase(attr.panelId),iconCls:"mkiDataOk",disabled:true,handler:function(button){var osm=MktCanvas.getRegisteredItem(os.objectSyncManagerKey,canvas);if(osm){osm.objectSyncRequest.call(osm,button.el);}}});tb.push(syncObjectBtn);os.Buttons[os.syncObjectBtnKey]=syncObjectBtn;var editVisibleFieldsBtn=new Ext.Button({text:"Edit Visible Fields",itemId:"editVisibleFields"+MktUtil.camelCase(attr.panelId),iconCls:"mkiMagnifyingGlass",tooltip:"Objects must be synced to edit",disabled:true,handler:function(button){var osm=MktCanvas.getRegisteredItem(os.objectSyncManagerKey,canvas);if(osm){osm.editVisibleFieldsRequest.call(osm,button.el);}}});tb.push(editVisibleFieldsBtn);os.Buttons[os.editVisibleFieldsBtnKey]=editVisibleFieldsBtn;tb.push(new Ext.Toolbar.Fill());var lastUpdatedAtBtn=new Ext.Button({itemId:'lastSchemaUpdatedAt',disabled:true,text:"Last Updated: "+attr.lastUpdated});os.Buttons[os.lastUpdatedAtBtnKey]=lastUpdatedAtBtn;tb.push(lastUpdatedAtBtn);return new Ext.Toolbar({items:tb});},getSiAdmin:function(attr)
{var tb=[];tb.push({text:'Edit API Configuration',iconCls:'mkiPlug',handler:function(btn){Mkt.apps.Salesforce.Actions.editApiConfig.call(Mkt.apps.Salesforce.Actions,btn.getEl());}});tb.push({text:'Edit Settings',iconCls:'mkiGear',handler:function(btn){Mkt.apps.Salesforce.Actions.editSettings.call(Mkt.apps.Salesforce.Actions,btn.getEl());}});return new Ext.Toolbar({items:tb});}};}();
/* ========== ../mkt-ext-2.0/apps/SysAdmin.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.sysadmin');Mkt.apps.sysadmin.Modal=Ext.extend(Mkt.widgets.ModalForm,{title:'',minWidth:350,width:670,height:490,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktImportList',layout:'form',plain:true,iconCls:'mkiDataAdd',modal:true,bodyStyle:'padding-top: 25px;',buttonAlign:'right',useStandardButtons:false,labelWidth:140,closable:true,createAction:true,initComponent:function(){this.items=this.items||[];this.setTitle(this.createAction?'Add Subscription':'Edit Subscription');var tabManager=this.tabManager=new Mkt.apps.sysadmin.WizardTabPanel({windowContainer:this});this.items.push(this.tabManager);this.iconCls=this.createAction?'mkiDataAdd':'mkiDataEdit';var firstTab=tabManager.items.get(0);this.cancelButton=new Ext.Button({text:firstTab.cancelButtonText,iconCls:firstTab.cancelButtonIconCls,hidden:firstTab.cancelButtonHidden,disabled:firstTab.cancelButtonDisabled,handler:function(){this.close();}.createDelegate(this)});this.backButton=new Ext.Button({text:firstTab.backButtonText,iconCls:firstTab.backButtonIconCls,hidden:firstTab.backButtonHidden,disabled:firstTab.backButtonDisabled,handler:this.tabManager._backButtonCallback.createDelegate(this.tabManager)});this.nextButton=new Ext.Button({text:firstTab.nextButtonText,iconCls:firstTab.nextButtonIconCls,iconAlign:'right',hidden:firstTab.nextButtonHidden,disabled:firstTab.nextButtonDisabled,handler:this.tabManager._nextButtonCallback.createDelegate(this.tabManager)});this.buttons=[this.backButton,this.nextButton,this.cancelButton];Mkt.apps.sysadmin.Modal.superclass.initComponent.call(this);this.on('show',function(){this.maskModal();if(this.createAction){MktSession.ajaxRequest('administrator/createSubRequest',{serializeParms:{},onMySuccess:firstTab.successCreateSubRequest.createDelegate(firstTab)});}
else{MktSession.ajaxRequest('administrator/editSubRequest',{serializeParms:{id:this.subscriptionId},onMySuccess:firstTab.successEditSubRequest.createDelegate(firstTab)});}
this.on('resize',function(){this.tabManager.syncSize();this.tabManager.setHeight(this.getHeight()-90);}.createDelegate(this));}.createDelegate(this));},setBackButtonText:function(text){this.backButton.setText(text);},setBackButtonIconCls:function(iconCls){this.backButton.setIconClass(iconCls);},setBackButtonVisible:function(visible){this.backButton.setVisible(visible);},setBackButtonDisabled:function(disable){this.backButton.setDisabled(disable);},setNextButtonText:function(text){this.nextButton.setText(text);},setNextButtonIconCls:function(iconCls){this.nextButton.setIconClass(iconCls);},setNextButtonVisible:function(visible){this.nextButton.setVisible(visible);},setNextButtonDisabled:function(disable){this.nextButton.setDisabled(disable);},getPanels:function(){}});Mkt.apps.sysadmin.WizardTabPanel=Ext.extend(Ext.TabPanel,{activeTab:0,autoWidth:true,height:380,plain:true,resizeTabs:true,tabWidth:400,border:false,bodyBorder:false,hideBorders:true,cls:'mktWizardTabPanel',defaults:{autoScroll:true},initComponent:function(){this.items=this.items||[];this.subscriptionDetails=new Mkt.apps.sysadmin.selectSubscriptionDetails({wizardTabPanel:this});this.items.push(this.subscriptionDetails);this.overrideOptionsPanel=new Mkt.apps.sysadmin.OverrideOptionsPanel({wizardTabPanel:this});this.items.push(this.overrideOptionsPanel);if(this.windowContainer.createAction){this.userInformationPanel=new Mkt.apps.sysadmin.userInformationPanel({wizardTabPanel:this});this.items.push(this.userInformationPanel);}
Mkt.apps.sysadmin.WizardTabPanel.superclass.initComponent.call(this);var createState={stage:0};this.setCreateState(createState);},onStripMouseDown:Ext.emptyFn,getNextTab:function(){var foundTab;var activeTab=this.getActiveTab();var foundIndex=this.items.findIndex('id',activeTab.id);if(foundIndex!=-1){foundTab=this.items.get(foundIndex*1+1);}
return foundTab;},getBackTab:function(){var foundTab;var activeTab=this.getActiveTab();var foundIndex=this.items.findIndex('id',activeTab.id);if(foundIndex!=-1){foundTab=this.items.get(foundIndex*1-1);}
return foundTab;},_nextButtonCallback:function(){var activeTab=this.getActiveTab();if(activeTab&&activeTab.nextButtonCallback){if(activeTab.nextButtonCallback()===false){return;}}
this.gotoNextTab();},gotoNextTab:function(){var nextTab=this.getNextTab();if(nextTab){this.setActiveTab(nextTab.id);this.updateButtons(nextTab);}},updateButtons:function(tab){this.ownerCt.setNextButtonText(tab.nextButtonText);this.ownerCt.setNextButtonIconCls(tab.nextButtonIconCls);this.ownerCt.setNextButtonVisible(!tab.nextButtonHidden);this.ownerCt.setNextButtonDisabled(tab.nextButtonDisabled);this.ownerCt.setBackButtonText(tab.backButtonText);this.ownerCt.setBackButtonIconCls(tab.backButtonIconCls);this.ownerCt.setBackButtonVisible(!tab.backButtonHidden);this.ownerCt.setBackButtonDisabled(tab.backButtonDisabled);},_backButtonCallback:function(){var activeTab=this.getActiveTab();if(activeTab&&activeTab.backButtonCallback){if(activeTab.backButtonCallback()===false){return;}}
this.gotoPreviousTab();},gotoPreviousTab:function(){var backTab=this.getBackTab();if(backTab){this.setActiveTab(backTab.id);this.updateButtons(backTab);}},setCreateState:function(createState){this.createState=Ext.apply(this.createState||{},createState);},getCreateState:function(){return this.createState;},closeWizard:function(){this.ownerCt.close();}});Mkt.apps.sysadmin.WizardPanelInitalConfig={cls:'mktWizardPanel',cancelButtonText:'Cancel',cancelButtonIconCls:'mkiCancel',cancelButtonHidden:false,cancelButtonDisabled:false,backButtonText:'Back',backButtonIconCls:'mkiNavLeftGray',backButtonHidden:false,backButtonDisabled:false,nextButtonText:'Next',nextButtonIconCls:'mkiNavRightGreen',nextButtonHidden:false,nextButtonDisabled:false,showMessageError:function(message){if(!this.isVisible()){this.animateTarget=undefined;this.show();}
if(this.showProgressModal){this.progressModal.hide();}
this.messagePanel.update({message:message});this.messagePanel.show();this.messagePanel.addClass('visibleMessage');},hideMessage:function(){this.messagePanel.hide();this.messagePanel.removeClass('visibleMessage');},addMessagePanel:function(){this.items=this.items||[];this.messagePanel=new Ext.Panel({tpl:'<h2><div class="mktModalInFormMessage" style="display: block;"><div class="mktModalErrorMessage">{message}</div></div></h2>',baseCls:"mkt-modal-message-body",hidden:true,height:30,anchor:"99% 20%"});this.items.unshift(this.messagePanel);}};Mkt.apps.sysadmin.WizardPanel=Ext.extend(Ext.Panel,{initComponent:function(){Ext.applyIf(this,Mkt.apps.sysadmin.WizardPanelInitalConfig);this.addMessagePanel.call(this);Mkt.apps.sysadmin.WizardPanel.superclass.initComponent.call(this);}});Mkt.apps.sysadmin.WizardFormPanel=Ext.extend(Ext.form.FormPanel,{initComponent:function(){Ext.applyIf(this,Mkt.apps.sysadmin.WizardPanelInitalConfig);this.addMessagePanel.call(this);Mkt.apps.sysadmin.WizardFormPanel.superclass.initComponent.call(this);}});Mkt.apps.sysadmin.selectSubscriptionDetails=Ext.extend(Mkt.apps.sysadmin.WizardFormPanel,{title:'Step 1:Subscription Information',bodyStyle:'padding: 25px 0 0 10px;',labelWidth:140,fileUpload:true,layout:'form',backButtonDisabled:true,initComponent:function(){Mkt.apps.sysadmin.selectSubscriptionDetails.superclass.initComponent.call(this);this.on('render',function(){var firstTab=this.wizardTabPanel.getTabEl(0);if(firstTab){Ext.get(firstTab).addClass('mktWizardFirstTab');}
var createState={stage:0};this.wizardTabPanel.setCreateState(createState);}.createDelegate(this));},getFields:function(){var items=[];var subscriptionFieldsetItems=[];this.subscriptionName=new Ext.form.TextField({fieldLabel:'Name',itemCls:'mktRequired',width:300,allowBlank:false});subscriptionFieldsetItems=[this.subscriptionName];if(this.createAction){this.subscriptionPrefix=new Ext.form.TextField({fieldLabel:'Subscriber Prefix',itemCls:'mktRequired',width:300,allowBlank:false});subscriptionFieldsetItems.push(this.subscriptionPrefix);}
this.subscriptionType=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Level",hiddenName:'subscriptionType',itemCls:'mktRequired',width:300,resizable:true,mode:'local',triggerAction:'all',editable:false,allowBlank:false,store:new Ext.data.ArrayStore({fields:['subscriptionTypeId','subscriptionTypeName'],data:MktPage.appVars.subTypeList}),valueField:'subscriptionTypeId',displayField:'subscriptionTypeName'});subscriptionFieldsetItems.push(this.subscriptionType);this.subscriptionPurpose=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Purpose",hiddenName:'subscriptionPurpose',itemCls:'mktRequired',width:300,resizable:true,mode:'local',triggerAction:'all',editable:false,allowBlank:false,value:undefined,store:new Ext.data.ArrayStore({fields:['subscriptionPurposeId','subscriptionPurposeName'],data:MktPage.appVars.subPurposeList}),valueField:'subscriptionPurposeId',displayField:'subscriptionPurposeName'});subscriptionFieldsetItems.push(this.subscriptionPurpose);this.subscriptionStatus=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Status",hiddenName:'subscriptionStatus',itemCls:'mktRequired',required:true,width:300,resizable:true,mode:'local',triggerAction:'all',editable:false,allowBlank:false,store:new Ext.data.ArrayStore({fields:['subscriptionStatusId','subscriptionStatusName'],data:MktPage.appVars.subStatuses}),valueField:'subscriptionStatusId',displayField:'subscriptionStatusName'});subscriptionFieldsetItems.push(this.subscriptionStatus);this.subscriptionFieldset=[{xtype:'fieldset',title:'Subscription',items:subscriptionFieldsetItems}];items.push(this.subscriptionFieldset);this.channelPartner=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Channel Partner",hiddenName:'channelPartner',width:300,labelStyle:'width:150px',resizable:true,mode:'local',triggerAction:'all',editable:false,itemCls:'mktRequired',allowBlank:false,store:new Ext.data.ArrayStore({fields:['channelPartnerId','channelPartnerName'],data:MktPage.appVars.channelPartnerList}),valueField:'channelPartnerId',displayField:'channelPartnerName'});items.push(this.channelPartner);this.companyHomePage=new Ext.form.TextField({fieldLabel:'Home Page',itemCls:'mktRequired',labelStyle:'width:150px',width:300,allowBlank:false});items.push(this.companyHomePage);if(this.createAction){this.ignoreSFDCAccount=new Ext.form.Checkbox({fieldLabel:"Ignore SFDC Account",labelStyle:'width:150px',hiddenName:"ignoreSFDCAccount"});items.push(this.ignoreSFDCAccount);}
return items;},successCreateSubRequest:function(){this.createAction=true;this.wizardTabPanel.setCreateState({createAction:this.createAction});this.add(this.getFields());this.doLayout();this.channelPartner.setValue(-1);this.wizardTabPanel.windowContainer.unmaskModal();},successEditSubRequest:function(){this.createAction=false;this.wizardTabPanel.setCreateState({createAction:this.createAction});this.add(this.getFields());this.doLayout();this.wizardTabPanel.windowContainer.unmaskModal();this.subscriptionName.setValue(Ext.util.Format.htmlDecode(MktPage.appVars.subName));this.subscriptionType.setValue(MktPage.appVars.subTypeId);this.channelPartner.setValue(MktPage.appVars.channelPartnerId?MktPage.appVars.channelPartnerId:-1);MktPage.appVars.subPurposeId?this.subscriptionPurpose.setValue(MktPage.appVars.subPurposeId):'';this.companyHomePage.setValue(Ext.util.Format.htmlDecode(MktPage.appVars.homePage));this.subscriptionStatus.setValue(MktPage.appVars.subStatus);var states={subId:MktPage.appVars.subId,lisSeats:MktPage.appVars.lisSeats,siSeats:MktPage.appVars.siSeats,deliverabilityPartner:MktPage.appVars.deliverabilityPartnerEnabled,deliverabilityPartnerUser:MktPage.appVars.deliverabilityPartnerUser,deliverabilityPartnerGroup:MktPage.appVars.deliverabilityPartnerGroup,trackingUrl:MktPage.appVars.trackingUrl,mtaChoice:MktPage.appVars.admMTAChoice,fieldManagement:MktPage.appVars.fmAdmin,dedicatedSendingIpList:MktPage.appVars.dedicatedSendingIpList,dedicatedSendingIp:MktPage.appVars.dedicatedSendingIps,origLisSeats:MktPage.appVars.origLisSeats,mkDenialEnabled:MktPage.appVars.mkDenialEnabled,accessZonesEnabled:MktPage.appVars.accessZonesEnabled};delete MktPage.appVars.subId;delete MktPage.appVars.lisSeats;delete MktPage.appVars.siSeats;delete MktPage.appVars.deliverabilityPartnerEnabled;delete MktPage.appVars.deliverabilityPartnerUser;delete MktPage.appVars.deliverabilityPartnerGroup;delete MktPage.appVars.trackingUrl;delete MktPage.appVars.admMTAChoice;delete MktPage.appVars.fmAdmin;delete MktPage.appVars.dedicatedSendingIpList;delete MktPage.appVars.dedicatedSendingIps;delete MktPage.appVars.origLisSeats;delete MktPage.appVars.mkDenialEnabled;delete MktPage.appVars.accessZonesEnabled;this.wizardTabPanel.setCreateState(states);},validate:function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;},nextButtonCallback:function(){if(!this.validate())
return false;this.hideMessage();this.wizardTabPanel.windowContainer.maskModal('Loading...',undefined,true);this.wizardTabPanel.setCreateState({subscriptionTypeId:this.subscriptionType?this.subscriptionType.getValue():"",admUserCompany:this.subscriptionName?this.subscriptionName.getValue():"",admSubscriptionPurpose:this.subscriptionPurpose?this.subscriptionPurpose.getValue():"",admSubscriptionPartner:this.channelPartner?this.channelPartner.getValue():"",admCustomerPrefix:this.subscriptionPrefix?this.subscriptionPrefix.getValue():"",admSubStatus:this.subscriptionStatus?this.subscriptionStatus.getValue():"",admIgnoreSfdcAccount:this.ignoreSFDCAccount?this.ignoreSFDCAccount.getValue():"",admCompanyHomePage:this.companyHomePage?this.companyHomePage.getValue():""});MktSession.ajaxRequest('administrator/showSubTypeOverrides',{serializeParms:{admSubscriptionType:this.subscriptionType.value,isCreate:this.createAction?1:0},onMySuccess:this.successSubmitCallback.createDelegate(this)});return false;},successSubmitCallback:function(){this.wizardTabPanel.setCreateState(Ext.apply({},MktPage.appVars));this.wizardTabPanel.gotoNextTab();this.wizardTabPanel.windowContainer.unmaskModal();},failureSubmitCallback:function(form,action){this.wizardTabPanel.windowContainer.unmaskModal();this.showMessageError(action.result.importListErrMsg);}});Mkt.apps.sysadmin.OverrideOptionsPanel=Ext.extend(Mkt.apps.sysadmin.WizardPanel,{title:'Step 2:Options',bodyStyle:'padding: 10px 0 0 5px;',defaults:{labelWidth:140},initComponent:function(){this.items=[this.getFields()];Mkt.apps.sysadmin.OverrideOptionsPanel.superclass.initComponent.call(this);this.on('activate',function(){var createState={stage:1};var states=this.wizardTabPanel.getCreateState();this.items.items[2].setTitle("Features: ("+states.subscriptionTypeName+")");if(states.subscriptionTypeName=='Enterprise Customer'){this.workspaces.enable();}
else if(states.subscriptionTypeName=='Professional Customer'){if(states.createAction){this.workspaces.setValue(false);}
this.workspaces.disable();}
else{if(states.createAction){this.workspaces.setValue(false);}
this.workspaces.disable();}
if(!states.createAction){this.nextButtonText='Save';this.nextButtonIconCls='mkiOk';}
this.mkDenial.enable();this.doLayout();this.wizardTabPanel.setCreateState(createState);this.setFieldValues();}.createDelegate(this));},setFieldValues:function(){var states=this.wizardTabPanel.getCreateState();this.marketingProgram.setValue(states.marketingProgramEnabled?true:false);this.jigsaw.setValue(states.jigsawEnabled?true:false);this.sfdcCustomObjectSync.setValue(states.sfdcCustomObjectEnabled?true:false);this.rcm.setValue(states.rcmEnabled?true:false);this.mkDenial.setValue(states.mkDenialEnabled?true:false);if(!states.createAction){this.workspaces.setValue(states.accessZonesEnabled?true:false);}
this.deliverabilityPartner.setValue(states.deliverabilityPartner?true:false);this.deliverabilityPartnerUser.setValue(states.deliverabilityPartnerUser?states.deliverabilityPartnerUser:"");this.deliverabilityPartnerGroup.setValue(states.deliverabilityPartnerGroup?states.deliverabilityPartnerGroup:"");this.fieldManagement.setValue(states.fieldManagement?true:false);this.salesforceSeats.setValue(states.siSeats?states.siSeats:"");this.outlookSeats.setValue(states.lisSeats?states.lisSeats:"");this.dedicatedIps.store.removeAll();this.serviceMix.store.removeAll();for(var i=0;i<states.mtaOptions.length;i++){this.serviceMix.store.add(new this.serviceMix.store.recordType({text:states.mtaOptions[i][1],value:states.mtaOptions[i][0]}));}
this.serviceMix.setValue(states.mtaChoice);for(var i=0;i<states.dedicatedSendingIpList.length;i++){this.dedicatedIps.store.add(new this.dedicatedIps.store.recordType({value:states.dedicatedSendingIpList[i]}));}
this.dedicatedIps.setValue(states.dedicatedSendingIp);},getFields:function(){var items=[];var defaultFieldsetItems=[];var defaultFieldsetItemsColumnOne=[];var defaultFieldsetItemsColumnTwo=[];var optionalFieldsetItems=[];var optionalFieldsetItemsColumnOne=[];var optionalFieldsetItemsColumnTwo=[];var salesInsightFieldsetItems=[];this.marketingProgram=new Ext.form.Checkbox({fieldLabel:"Programs & Events",hiddenName:"marketingProgram"});defaultFieldsetItemsColumnOne.push(this.marketingProgram);this.workspaces=new Ext.form.Checkbox({fieldLabel:"Workspaces",hiddenName:"workspaces",disabled:true});defaultFieldsetItemsColumnTwo.push(this.workspaces);this.mkDenial=new Ext.form.Checkbox({fieldLabel:"Mk Denial",hiddenName:"mkDenial"});defaultFieldsetItemsColumnOne.push(this.mkDenial);this.jigsaw=new Ext.form.Checkbox({fieldLabel:"Jigsaw",hiddenName:"jigsaw",disabled:true});defaultFieldsetItemsColumnTwo.push(this.jigsaw);this.rcm=new Ext.form.Checkbox({fieldLabel:"Revenue Cycle Modeler",hiddenName:"rcm",disabled:true});defaultFieldsetItemsColumnOne.push(this.rcm);this.sfdcCustomObjectSync=new Ext.form.Checkbox({fieldLabel:"SFDC Custom Object Sync",hiddenName:"sfdcCustomObjectSync",disabled:true});defaultFieldsetItemsColumnTwo.push(this.sfdcCustomObjectSync);defaultFieldsetItems=[{layout:'column',defaults:{columnWidth:0.5,border:false,labelWidth:140},items:[{xtype:'fieldset',items:defaultFieldsetItemsColumnOne,defaults:{disabled:true}},{xtype:'fieldset',items:defaultFieldsetItemsColumnTwo,defaults:{disabled:true}}]}];this.fieldManagement=new Ext.form.Checkbox({fieldLabel:"Field Mgt Admin",labelWidth:140,hiddenName:"fieldMgtAdmin"});optionalFieldsetItemsColumnOne.push(this.fieldManagement);this.dedicatedIps=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"Dedicated Email Ips",hiddenName:'dedicatedEmailIps',width:130,resizable:true,mode:'local',triggerAction:'all',editable:false,allowBlank:true,store:new Ext.data.ArrayStore({fields:['value'],data:{}}),displayField:'value',valueField:'value'});optionalFieldsetItemsColumnTwo.push(this.dedicatedIps);this.deliverabilityPartner=new Ext.form.Checkbox({fieldLabel:"Deliverability Partner",hiddenName:"deliverabilityPartnerEnabled"});optionalFieldsetItemsColumnOne.push(this.deliverabilityPartner);this.deliverabilityPartnerUser=new Ext.form.TextField({fieldLabel:"Deliverability User",hiddenName:"deliverabilityPartnerUser"});optionalFieldsetItemsColumnTwo.push(this.deliverabilityPartnerUser);this.deliverabilityPartnerGroup=new Ext.form.TextField({fieldLabel:"Deliverability Group",hiddenName:"deliverabilityPartnerGroup"});optionalFieldsetItemsColumnOne.push(this.deliverabilityPartnerGroup);this.outlookSeats=new Ext.form.TextField({fieldLabel:"Outlook Seats",hiddenName:"outlookSeats"});optionalFieldsetItemsColumnTwo.push(this.outlookSeats);this.salesforceSeats=new Ext.form.TextField({fieldLabel:"Salesforce Seats",hiddenName:"salesforceSeats"});optionalFieldsetItemsColumnOne.push(this.salesforceSeats);this.serviceMix=new Ext.form.ComboBox({forceSelection:true,fieldLabel:"MTA",hiddenName:'serviceMix',width:130,resizable:true,mode:'local',triggerAction:'all',editable:false,allowBlank:true,store:new Ext.data.ArrayStore({fields:['text','value'],data:{}}),displayField:'text',valueField:'value'});optionalFieldsetItemsColumnTwo.push(this.serviceMix);optionalFieldsetItems=[{layout:'column',maskDisabled:false,defaults:{columnWidth:0.5,border:false,labelWidth:140},items:[{xtype:'fieldset',items:optionalFieldsetItemsColumnOne},{xtype:'fieldset',items:optionalFieldsetItemsColumnTwo}]}];items=[{xtype:'fieldset',title:'Options: ',layout:'form',items:optionalFieldsetItems},{xtype:'fieldset',title:'Features: ',layout:'form',items:defaultFieldsetItems}];return items;},validateForm:function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;},nextButtonCallback:function(){var states=this.wizardTabPanel.getCreateState();if(!this.validateForm())
return false;var parms={};parms.admSubscriptionPurpose=states.admSubscriptionPurpose;parms.admSubscriptionPartner=states.admSubscriptionPartner;parms.admSubscriptionType=states.subscriptionTypeId;parms.admSubStatus=states.admSubStatus;if(states.marketingProgramEnabled){parms.admMarketingProgramEnabled=1;}
if(states.jigsawEnabled){parms.admJigsawEnabled=1;}
if(states.sfdcCustomObjectEnabled){parms.admSFDCCustomObjectEnabled=1;}
if(states.rcmEnabled){parms.admRCMEnabled=1;}
if(this.workspaces.getValue()){parms.admAccessZonesEnabled=1;}
if(this.serviceMix.getValue()){parms.admServicemixEnabled=this.serviceMix.getValue();}
if(this.fieldManagement.getValue()){parms.admFmAdminEnabled=1;}
if(this.deliverabilityPartner.getValue()){parms.admEditSubDeliverabilityPartnerEnabled=1;}
if(this.serviceMix.getValue()){parms.admMTAChoice=this.serviceMix.getValue();}
if(this.mkDenial.getValue()){parms.admMKDenialEnabled=1;}
parms.admEditSubDeliverabilityPartnerUser=this.deliverabilityPartnerUser.getValue()?this.deliverabilityPartnerUser.getValue():"";parms.admEditSubDeliverabilityPartnerGroup=this.deliverabilityPartnerGroup.getValue()?this.deliverabilityPartnerGroup.getValue():"";parms.admEditSubLISSeats=this.outlookSeats.getValue()?this.outlookSeats.getValue():0;parms.admEditSubSISeats=this.salesforceSeats.getValue()?this.salesforceSeats.getValue():0;parms.admDedicatedSendingIps=this.dedicatedIps.getValue()?this.dedicatedIps.getValue():0;if(states.createAction){parms.admUserCompany=states.admUserCompany;parms.admCustomerPrefix=states.admCustomerPrefix;parms.admCompanyHomePage=states.admCompanyHomePage;if(states.admIgnoreSfdcAccount){parms.admIgnoreSfdcAccount=1;}}
else{parms.id=states.subId;parms.admEditSubName=states.admUserCompany;parms.admEditSubHomePage=states.admCompanyHomePage;}
if(states.createAction){this.wizardTabPanel.setCreateState({parms:parms});this.wizardTabPanel.gotoNextTab();}
else{this.wizardTabPanel.windowContainer.maskModal('Editing Subscription...');var lisSeats=this.outlookSeats.getValue();if(states.origLisSeats>0&&lisSeats<states.origLisSeats){if(lisSeats==0){var msg='<br/>Are you sure you want to remove all Outlook Add-in seats?<br/><br/>'+'All current licensees will no longer have access to the Add-in.<br/>';}
else{var msg='<br/>Are you sure you want to remove '+
(MktPage.appVars.origLisSeats-lisSeats)+' Outlook Add-in seats?<br/><br/>'+'Some current licensees may no longer have access to the Add-in.<br/>';}
Ext.MessageBox.show({title:'Removing Outlook Add-in Seats',fn:function(buttonId,text){if(buttonId=='ok'){this.doSubmitEditSubModal(parms);}},scope:this,msg:msg,buttons:Ext.MessageBox.OKCANCEL});}
else{this.doSubmitEditSubModal(parms);}}
return false;},doSubmitEditSubModal:function(parms){MktSession.ajaxRequest('administrator/editSubSubmit',{serializeParms:parms,onMySuccess:this.successEditCallback.createDelegate(this),onMyFailure:this.failureCreateCallback.createDelegate(this)});},failureCreateCallback:function(){this.wizardTabPanel.windowContainer.unmaskModal();},successEditCallback:function(){this.wizardTabPanel.windowContainer.unmaskModal();if(MktPage.appVars.sadSubSaved&&MktPage.appVars.sadSubSaved===true){delete MktPage.appVars.sadSubSaved;Ext.getCmp('admCanvasAccountsUserGrid').getStore().load({params:{start:0}});}},successCreateCallback:function(){this.wizardTabPanel.windowContainer.unmaskModal();if(MktPage.appVars.sadSubCreated&&MktPage.appVars.sadSubCreated===true){delete MktPage.appVars.sadSubCreated;Ext.getCmp('admCanvasAccountsUserGrid').getStore().load({params:{start:0}});}}});Mkt.apps.sysadmin.userInformationPanel=Ext.extend(Mkt.apps.sysadmin.WizardPanel,{title:'Step 3:New User',bodyStyle:'padding: 10px 0 0 5px;',nextButtonText:'Add Subscription',nextButtonIconCls:'mkiOk',defaults:{labelWidth:140,width:300},initComponent:function(){this.items=[this.getFields()];Mkt.apps.sysadmin.userInformationPanel.superclass.initComponent.call(this);this.on('activate',function(){var createState={stage:2};var states=this.wizardTabPanel.getCreateState();this.doLayout();this.wizardTabPanel.setCreateState(createState);}.createDelegate(this));},getFields:function(){var items=[];var userFieldsetItems=[];this.userId=new Ext.form.TextField({fieldLabel:"User Id",hiddenName:"userid",itemCls:'mktRequired',allowBlank:false});userFieldsetItems.push(this.userId);this.password=new Ext.form.TextField({inputType:'password',fieldLabel:"Password",hiddenName:"password",itemCls:'mktRequired',allowBlank:false});userFieldsetItems.push(this.password);this.emailAddress=new Ext.form.TextField({fieldLabel:"Email Address",hiddenName:"emailAddress"});userFieldsetItems.push(this.emailAddress);this.firstName=new Ext.form.TextField({fieldLabel:"First Name",hiddenName:"fName"});userFieldsetItems.push(this.firstName);this.lastName=new Ext.form.TextField({fieldLabel:"Last Name",hiddenName:"lName"});userFieldsetItems.push(this.lastName);items=[{layout:'form',items:userFieldsetItems}];return items;},validateForm:function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;},nextButtonCallback:function(){var states=this.wizardTabPanel.getCreateState();if(!this.validateForm())
return false;var parms={};parms=states.parms;parms.admUserID=this.userId.getValue();parms.admUserEmailAddress=this.emailAddress.getValue();parms.admUserPassword=this.password.getValue();parms.admUserFirst=this.firstName.getValue()?this.firstName.getValue():"";parms.admUserLast=this.lastName.getValue()?this.lastName.getValue():"";if(states.createAction){this.wizardTabPanel.windowContainer.maskModal('Creating Subscription...');MktSession.ajaxRequest('administrator/createSubSubmit',{serializeParms:parms,onMySuccess:this.successCreateCallback.createDelegate(this),onMyFailure:this.failureCreateCallback.createDelegate(this)});}
return false;},failureCreateCallback:function(){this.wizardTabPanel.windowContainer.unmaskModal();},successCreateCallback:function(){this.wizardTabPanel.windowContainer.unmaskModal();if(MktPage.appVars.sadSubCreated&&MktPage.appVars.sadSubCreated===true){delete MktPage.appVars.sadSubCreated;Ext.getCmp('admCanvasAccountsUserGrid').getStore().load({params:{start:0}});}}});Mkt.apps.sysadmin.UserGrid=Ext.extend(MktGrids.CanvasGridPanel,{defaultSort:'userName',autoExpandColumn:'userName',totalDisplayMsg:'{0} users',stripeRows:false,enablePaging:true,pageSize:100,pagingDisplayMsg:'{0}-{1} of {2}',pagingEmptyMsg:"No users found",enableSearchPaging:true,searchEmptyText:'Quick Find...',searchQtip:'Searches user name, company, and email address.',selectedSingularText:'',selectedPluralText:'',showSelectionCount:true,enableDragDrop:false,enableExport:true,exportUrl:'/administrator/exportUsersData',emailRenderer:function(val,meta,record,rowIndex,colIndex,store){if(!isNull(val)){return'<a href="mailto:'+val+'" class="mktGridLink">'+val+'</a>';}
else{return'';}},rndUserStatus:function(val,meta,record,rowIndex,colIndex,store){var rv='';var didStatus=false;if(val&0x100){didStatus=true;rv+='<span class="mkiLockedUser">&nbsp;</span>';}
if(val&0x1){didStatus=true;rv+='<span class="mkiRoleAdmin">&nbsp;</span>';}
if(val&0x2){didStatus=true;rv+='<span class="mkiRoleStdUser">&nbsp;</span>';}
if(val&0x4){didStatus=true;rv+='<span class="mkiRoleGuest">&nbsp;</span>';}
if(val&0x8){didStatus=true;rv+='<span class="mkiRoleSalesUser">&nbsp;</span>';}
if(val&0x10){didStatus=true;rv+='<span class="mkiRoleTest">&nbsp;</span>';}
if(val&0x200){didStatus=true;rv+='<span class="mkiRoleMarketoAdmin">&nbsp;</span>';}
if(val&0x400){didStatus=true;rv+='<span class="mkiRoleMarketoSuperAdmin">&nbsp;</span>';}
if(val&0x20){didStatus=true;rv+='<span class="mkiRoleCustom">&nbsp;</span>';}
if(val&0x40){didStatus=true;rv+='<span class="mkiRoleCustom">&nbsp;</span>';}
if(val&0x80){didStatus=true;rv+='<span class="mkiRoleCustom">&nbsp;</span>';}
if(!didStatus){rv+='<span class="mkiRoleEmpty">&nbsp;</span>';}
return rv;},companyGroupRenderer:function(v,unused,r,rowIndex,colIndex,ds){var str=v+'<span style="font-weight: normal; position: absolute; left: 250px;">'+
r.data.numUsers+' user'+(r.data.numUsers>1?'s':'');if(r.data.siSeats>0){str+=', '+r.data.siSeats+' Sales Insight seats ('+r.data.siUsed+' used)';}
if(r.data.lisSeats>0){str+=', '+r.data.lisSeats+' Add-in seats ('+r.data.lisUsed+' used)';}
if(r.data.subTrkUrl!=null&&r.data.subTrkUrl.length>0){str+=', tracking URL: '+r.data.subTrkUrl;}
str+='</span>';return str;},initComponent:function(){this.dataCols=[{name:'id'},{name:'company'},{name:'userName'},{name:'userId'},{name:'userStatus'},{name:'officePhone'},{name:'mobilePhone'},{name:'created'},{name:'updated'},{name:'failedLogins'},{name:'isLocked'},{name:'lockedReason'},{name:'changePw'},{name:'dfltFromEmail'},{name:'dfltFromLabel'},{name:'subId'},{name:'numUsers'},{name:'lisSeats'},{name:'lisUsed'},{name:'siSeats'},{name:'siUsed'},{name:'subStatus'},{name:'subTrkUrl'}];this.viewCols=[{header:"Subscriber",width:120,sortable:true,dataIndex:'company',groupRenderer:this.companyGroupRenderer.createDelegate(this)},{header:"User Name",id:'userName',width:120,sortable:true,dataIndex:'userName'},{header:"User Id",width:200,sortable:true,renderer:this.emailRenderer.createDelegate(this),dataIndex:'userId'},{header:"Status",id:'status',width:106,sortable:true,renderer:this.rndUserStatus.createDelegate(this),dataIndex:'userStatus'},{header:"Office Phone",width:100,sortable:true,dataIndex:'officePhone'},{header:"Mobile Phone",width:100,sortable:true,hidden:true,dataIndex:'mobilePhone'},{header:"Updated",width:126,sortable:true,renderer:MktFormat.formatDatetime,dataIndex:'updated'},{header:"Created",width:126,sortable:true,hidden:true,renderer:MktFormat.formatDatetime,dataIndex:'created'},{header:"Failed Logins",width:80,sortable:true,hidden:true,dataIndex:'failedLogins'},{header:"Locked",width:50,sortable:true,hidden:true,dataIndex:'isLocked'},{header:"Locked Reason",width:140,sortable:true,hidden:true,dataIndex:'lockedReason'},{header:"Change Password",width:140,sortable:true,hidden:true,dataIndex:'changePw'},{header:"Dflt From Email",width:140,sortable:true,hidden:true,dataIndex:'dfltFromEmail'},{header:"Dflt From Label",width:140,sortable:true,hidden:true,dataIndex:'dfltFromLabel'}];this.ds=new MktGrids.JsonGroupingStore({url:'/administrator/loadUsers',baseParams:{limit:this.pageSize,filter:(this.subStatusFilterActive?this.selSubStatusFilters.join(','):null),groupBy:'company'},sortInfo:{field:'userName',direction:"ASC"},groupField:'company',remoteSort:true,remoteGroup:true,reader:new Ext.data.JsonReader({root:"data",totalProperty:'totalCount',id:"id"},this.dataCols)});this.view=new MktGrids.GroupingView({disableHdSortOnClick:true,hideGroupedColumn:true,groupTextTpl:'{group}'});Mkt.apps.sysadmin.UserGrid.superclass.initComponent.call(this);this.on('rowdblclick',this.editUser.createDelegate(this));this.getSelectionModel().on('selectionchange',function(){var attr={panelId:'admCanvasAccounts'};var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('editSub'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);tb.items.get('editUser'+MktUtil.camelCase(attr.panelId)).setDisabled(count!=1);tb.items.get('deleteUser'+MktUtil.camelCase(attr.panelId)).setDisabled(count!=1);tb.items.get('enableMPA'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);}});},initSubFilter:function(){var tbar=[];var filterToggle=new Ext.Button({text:'Filter Subscriptions',enableToggle:true,pressed:this.subStatusFilterActive,iconCls:this.subStatusFilterActive?'mkiCheckbox':'mkiCustCheckboxUnchecked'});filterToggle.on('toggle',function(button,pressed){button.setIconClass(pressed?'mkiCheckbox':'mkiCustCheckboxUnchecked');this.updateSubStatusFilter(pressed);},this);tbar.push(filterToggle);tbar.push('');var filterMenu=new Ext.menu.Menu();for(var i=0,len=this.subStatusFilters.length;i<len;i++){var item=new Ext.menu.CheckItem({text:this.subStatusFilters[i].text,checked:this.selSubStatusFilters.indexOf(this.subStatusFilters[i].code)>-1,hideOnClick:false});item.itemId=this.subStatusFilters[i].code;filterMenu.add(item);}
filterMenu.on('hide',function(menu){var filterChanged=false;var newFilter=[];menu.items.each(function(item){if(item.checked){newFilter.push(item.itemId);if(!filterChanged&&this.selSubStatusFilters.length>=newFilter.length&&this.selSubStatusFilters[newFilter.length-1]!=newFilter[newFilter.length-1]){filterChanged=true;}}},this);if(!filterChanged&&this.selSubStatusFilters.length!=newFilter.length){filterChanged=true;}
if(filterChanged){this.selSubStatusFilters=newFilter;if(!filterToggle.pressed){filterToggle.toggle(true);}
else{this.updateSubStatusFilter(true);}}},this);tbar.push(new Ext.Button({text:'Filter Options',iconCls:'mkiFunnel',menu:filterMenu}));return tbar;},updateSubStatusFilter:function(active){this.subStatusFilterActive=active;MktSession.ajaxRequest('/administrator/saveSubStatusFilter',{serializeParms:{filter:Ext.util.JSON.encode(this.selSubStatusFilters),active:this.subStatusFilterActive?1:0}});this.store.baseParams.filter=this.subStatusFilterActive?this.selSubStatusFilters.join(','):null;this.store.reload();},reloadAdminGrid:function(){this.getStore().load({params:{start:0,query:this.query}});},editSub:function(e){var rec=this.getSelectionModel().getSelected();var sysAdminModal=new Mkt.apps.sysadmin.Modal({createAction:false});sysAdminModal.subscriptionId=rec.get('subId');sysAdminModal.show(this);},newSub:function(e){var sysAdminModal=new Mkt.apps.sysadmin.Modal;sysAdminModal.show();},editUser:function(e){var rec=this.getSelectionModel().getSelected();var mp=new MktModalForm({url:'/administrator/editUserRequest?id='+rec.get('id'),title:'Edit User',iconCls:'mkiUserEdit',okButtonTitle:'Save',width:530,height:474});mp.show(getEl(e.target),this.submitEditUserModal.createDelegate(this));},submitEditUserModal:function(){delete MktPage.appVars.sadUserData;MktSession.ajaxRequest('/administrator/editUserSubmit',{serializeForm:'admEditSubmitForm',onMySuccess:this.editUserDone.createDelegate(this)});return false;},editUserDone:function(){if(isDefined(MktPage.appVars.sadUserData)){var store=this.getStore();var newRec=MktPage.appVars.sadUserData;var oldRec=store.getById(newRec.id);if(oldRec!=null){oldRec.set('userId',newRec.userId);oldRec.set('email',newRec.email);oldRec.set('userName',newRec.userName);oldRec.set('userStatus',newRec.userStatus);oldRec.set('officePhone',newRec.officePhone);oldRec.set('mobilePhone',newRec.mobilePhone);oldRec.set('created',newRec.created);oldRec.set('updated',newRec.updated);oldRec.set('failedLogins',newRec.failedLogins);oldRec.set('isLocked',newRec.isLocked);oldRec.set('lockedReason',newRec.lockedReason);oldRec.set('changePw',newRec.changePw);oldRec.set('dfltFromEmail',newRec.dfltFromEmail);oldRec.set('dfltFromLabel',newRec.dfltFromLabel);store.commitChanges();}}},newUser:function(e){var mp=new MktModalForm({url:'/administrator/createUserRequest',title:'Add New User',iconCls:'mkiUserAdd',okButtonTitle:'Add',width:530,height:450});mp.show(getEl(e.target),this.submitNewUserModal.createDelegate(this));},submitNewUserModal:function(){delete MktPage.appVars.sadUserData;Ext.MessageBox.show({title:'Please wait...',msg:'Adding New User',progress:true,width:230,closable:false});MktSession.clockCursor(true);MktSession.ajaxRequest('/administrator/createUserSubmit',{serializeForm:'admSubmitForm',onMySuccess:this.newUserDone.createDelegate(this)});return false;},newUserDone:function(){MktSession.unclockCursor();if(isDefined(MktPage.appVars.sadUserData)){this.reloadAdminGrid();}},deleteUser:function(e){var selected=this.getSelectionModel().getSelections();if(selected==null||selected.length==0){Ext.MessageBox.show({title:'Delete Users',msg:'<br/>Please select a user and try delete again.<br/>',buttons:Ext.MessageBox.OK});return;}
var names='';var userIds=[];for(var i=0;i<selected.length;i++){if(names.length>0){if(i==selected.length-1){names+=' and ';}
else{names+=', ';}}
var aName=selected[i].get('userName');names+=(aName!=null&&aName.length>0)?aName:selected[i].get('userId');userIds.push(selected[i].get('id'));}
names='<b>'+names+'</b>';var mp=new MktModalForm({renderer:function(el,unused){var hiddenInputs='';for(var i=0;i<userIds.length;i++){hiddenInputs+='<input type="hidden" name="sadUserIds[]" value="'+userIds[i]+'" />';}
Ext.DomHelper.append(el,'<div id="sadDeleteUserForm">'+'  <form id="sadDeleteUserSubmitForm">'+
hiddenInputs+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr>'+'        <td colspan="2">'+'          <span>Are you sure you want to delete '+names+' from Marketo?</span>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Delete User'+(userIds.length>1?'s':''),iconCls:'mkiUserDelete',okButtonTitle:'Delete',width:550,height:300});mp.show(getEl(e.target),this.submitDeleteUserModal.createDelegate(this,[userIds]));},submitDeleteUserModal:function(userIds){if(isDefined(MktPage.appVars.sadDeletedUsers)){delete MktPage.appVars.sadDeletedUsers;}
Ext.MessageBox.show({title:'Please wait...',msg:'Deleting user'+(userIds.length>1?'s':''),progress:true,width:220,closable:false});MktSession.ajaxRequest('/administrator/deleteUserSubmit',{serializeForm:'sadDeleteUserSubmitForm',onMySuccess:this.deleteUserDone.createDelegate(this)});return false;},deleteUserDone:function(){if(isDefined(MktPage.appVars.sadDeletedUsers)&&MktPage.appVars.sadDeletedUsers>0){this.reloadAdminGrid();}},enableMPA:function(e){var rec=this.getSelectionModel().getSelected();var mp=new MktModalForm({url:'/administrator/enableMPARequest?id='+rec.get('subId'),title:'Configure Revenue Cycle Analytics',iconCls:'mkiDataCopy',okButtonTitle:'Save',width:500,height:220});mp.show(getEl(e.target),this.submitEnableMPAModal.createDelegate(this));},submitEnableMPAModal:function(){delete MktPage.appVars.sadMPAEnabled;Ext.MessageBox.show({title:'Please wait...',msg:'Enabling Pipeline Analytics for Subscription',progress:true,width:230,closable:false});MktSession.clockCursor(true);MktSession.ajaxRequest('/administrator/enableMPASubmit',{serializeForm:'admEnableMPASubmitForm',onMySuccess:this.enableMPADone.createDelegate(this)});return false;},enableMPADone:function(){MktSession.unclockCursor();if(isDefined(MktPage.appVars.sadMPAEnabled)){this.reloadAdminGrid();}}});
/* ========== ../mkt-ext-2.0/menus/SysAdminMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.SysAdmin');Mkt.menus.SysAdmin.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(Mkt.menus.SysAdmin.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=Mkt.menus.SysAdmin.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('SysAdmin',toolbarRequestHandler);return{getAccountMgmt:function(attr){var tb=[];tb.push({text:'New Subscription',itemId:'newSub'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataAdd',handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.newSub(e);}}});tb.push({text:'New User',itemId:'newUser'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUserAdd',handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.newUser(e);}}});tb.push('-');tb.push({text:'Edit Subscription',itemId:'editSub'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataEdit',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.editSub(e);}}});tb.push({text:'Edit User',itemId:'editUser'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUserEdit',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.editUser(e);}}});tb.push({text:'Delete User',itemId:'deleteUser'+MktUtil.camelCase(attr.panelId),iconCls:'mkiUserDelete',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.deleteUser(e);}}});tb.push('->');tb.push({text:'Revenue Cycle Analytics',itemId:'enableMPA'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataCopy',disabled:true,handler:function(button,e){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.enableMPA(e);}}});return new Ext.Toolbar({items:tb});},updateAccountMgmtTbState:function(){var panel=MktCanvas.getItem(MktCanvas.getTab(attr.panelId));var count=panel.getGridPanel().getSelectionModel().getCount();var tb=panel.getTopToolbar();if(tb){tb.items.get('editSub'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);tb.items.get('editUser'+MktUtil.camelCase(attr.panelId)).setDisabled(count!=1);tb.items.get('deleteUser'+MktUtil.camelCase(attr.panelId)).setDisabled(count!=1);tb.items.get('enableMPA'+MktUtil.camelCase(attr.panelId)).setDisabled(count<1);}}};}();
/* ========== ../mkt-ext-2.0/menus/HomeMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.Home');Mkt.menus.Home.Toolbar=function(){function toolbarRequestHandler(attr,ret){var subType="home";if(isFunction(Mkt.menus.Home.Toolbar['get'+MktUtil.camelCase(subType)])){ret.comp=Mkt.menus.Home.Toolbar['get'+MktUtil.camelCase(subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('Home',toolbarRequestHandler);return{getHome:function(attr){var accessNavAreas=attr.accessNavAreas;console.debug('home menu accessNavAreas=',accessNavAreas);var items=[];if(accessNavAreas.indexOf("MA")!=-1){items.push(MktMaMenu.menuItemPool.newProgram);items.push(MktMaMenu.menuItemPool.newSmartCampaign);if(MktPage.savedState.marketingProgramEnabled){items.push(Mkt.menus.marketingEvent.menuItemPool.createNewMarketingProgram);}}
if(accessNavAreas.indexOf("DS")!=-1){if(items.length>0){items.push('-');}
items.push(MktDsMenu.menuItemPool.newLandingPage);items.push(MktDsMenu.menuItemPool.newForm);items.push(MktDsMenu.menuItemPool.newEmail);items.push(MktDsMenu.menuItemPool.uploadImage);}
if(accessNavAreas.indexOf("LD")!=-1){if(items.length>0){items.push('-');}
items.push(MktLeadDbMenu.menuItemPool.newSmartList);items.push(MktLeadDbMenu.menuItemPool.newList);items.push(MktLeadDbMenu.menuItemPool.importList);}
if(accessNavAreas.indexOf("AN")!=-1){if(items.length>0){items.push('-');}
items.push(MktAnalyticsMenu.menuItemPool.newReport);}
return[{text:'New',iconCls:'mkiAdd2',menu:{cls:'mktMenu',currNode:{attributes:{}},items:items}}];}};}();
/* ========== ../mkt-ext-2.0/menus/LpSettingsMenu.js ============ */

Ext.ns('Mkt','Mkt.menus','Mkt.menus.LpSettings');Mkt.menus.LpSettings.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(Mkt.menus.LpSettings.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=Mkt.menus.LpSettings.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('LpSettings',toolbarRequestHandler);function getLandingPageStates(){var sels=Mkt.apps.lpSettings.Actions.getSelectedItems();var editRuleDisabled=true;var deleteRuleDisabled=true;var selCount=0;if(sels){selCount=sels.length;}
if(selCount==1){editRuleDisabled=false;deleteRuleDisabled=false;}
else if(selCount>1){editRuleDisabled=true;deleteRuleDisabled=false;}
return{editRuleDisabled:editRuleDisabled,deleteRuleDisabled:deleteRuleDisabled};}
return{preShowLandingPageActions:function(menu,attr){var mItems=menu.items;var states=getLandingPageStates();var editRule=mItems.get('editRule');if(editRule){editRule.setDisabled(states.editRuleDisabled);}
var deleteRule=mItems.get('deleteRule');if(deleteRule){deleteRule.setDisabled(states.deleteRuleDisabled);}},updateLandingPageToolbarState:function(){var states=getLandingPageStates();var panelId='cadLpRules';var panel=MktCanvas.getItem(MktCanvas.getTab(panelId));if(panel){var tb=panel.getTopToolbar();if(tb){tb.items.get('editRule').setDisabled(states.editRuleDisabled);tb.items.get('deleteRule').setDisabled(states.deleteRuleDisabled);}}},getLpSettings:function(attr){var items=[];var mip=Mkt.menus.LpSettings.menuItemPool;items.push(this.getLandingPageNew());items.push(mip.editDomainSettings);return new Ext.Toolbar({items:items});},getLpRules:function(attr){var items=[];items.push(this.getLandingPageNew());items.push(this.getLandingPageActionsMenu());var mip=Mkt.menus.LpSettings.menuItemPool;items.push(mip.editRule);items.push(mip.deleteRule);return new Ext.Toolbar({items:items});},getLandingPageHomeActionsMenu:function(attr){var mip=Mkt.menus.LpSettings.menuItemPool;var items=[];items.push(mip.editDomainSettings);items.push(mip.newAlias);items.push(mip.newRule);return{text:'Landing Page Actions',iconCls:'mkiWebpage',menu:new Ext.menu.Menu({minWidth:200,items:items})};},getLandingPageNew:function(){var mip=Mkt.menus.LpSettings.menuItemPool;var items=[];items.push(mip.newAlias);items.push(mip.newRule);return{text:'New',iconCls:'mkiTextRichColored',menu:new Ext.menu.Menu({minWidth:200,items:items})};},getLandingPageActionsMenu:function(attr){var mip=Mkt.menus.LpSettings.menuItemPool;var items=[];items.push(mip.editRule);items.push(mip.deleteRule);return{text:'Rules Actions',xtype:'mkttbbutton',menuPreShowCb:this.preShowLandingPageActions,menu:new Ext.menu.Menu({minWidth:200,items:items})};}};}();Mkt.menus.LpSettings.menuItemPool={newAlias:{text:'New Domain Alias',itemId:'newAlias',iconCls:'mkiTextRichColoredAdd',handler:function(item){Mkt.apps.lpSettings.Actions.newAlias.call(Mkt.apps.lpSettings.Actions,item.getEl());}},newRule:{text:'New Redirect Rule',itemId:'newRule',iconCls:'mkiTextRichColoredForward',handler:function(item){Mkt.apps.lpSettings.Actions.newRule.call(Mkt.apps.lpSettings.Actions,item.getEl());}},editRule:{text:'Edit Rule',itemId:'editRule',disabled:true,iconCls:'mkiTextRichColoredEdit',handler:function(item){Mkt.apps.lpSettings.Actions.editRule.call(Mkt.apps.lpSettings.Actions,item.getEl());}},deleteRule:{text:'Delete Rule',itemId:'deleteRule',disabled:true,iconCls:'mkiTextRichColoredDelete',handler:function(item){Mkt.apps.lpSettings.Actions.deleteRule.call(Mkt.apps.lpSettings.Actions,item.getEl());}},editDomainSettings:{itemId:'editDomainSettings',text:'Edit Domain Settings',iconCls:'mkiWebpageEdit',handler:function(item){Mkt.apps.lpSettings.Actions.editLandingPageSettings.call(Mkt.apps.lpSettings.Actions,item.getEl());}}};
/* ========== ../mkt-ext-2.0/apps/FieldManager.js ============ */

Ext.ns('Mkt.apps');Mkt.apps.FieldManager=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager',baseCls:'',layout:'border',fieldTreeUrl:'leadDatabase/getFieldsAsTree?withSalesMapping=1&showHiddenFields=1&showOpportunityFields=1',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,lastNodeClicked:null,categories:{companyInfo:"Company Info",leadInfo:"Lead Info",opportunityInfo:"Opportunity Info"},fieldActions:{hide:"Hide field",blockUpdates:"Block field updates",copyValues:"Copy values to another field",merge:"Merge fields",changeType:"Change type",exportFields:"Export field names"},exportFormProcessingId:'exportProcessingForm',initComponent:function(){this.items=this.items||[];Mkt.apps.FieldManager.superclass.initComponent.call(this);this.fieldTreePanel.on('click',this.fieldSelected,this);new Ext.tree.TreeSorter(this.fieldTreePanel,{folderSort:false,dir:"asc"});this.createExportFormProcessing();},buildCenterComponents:function(){this.fieldPanel=new Mkt.apps.BlankDbFieldPanel({mgr:this});return this.fieldPanel;},hideWelcomeMsg:function(){if(this.fieldPanel){this.fieldPanel.setHeight(0);this.fieldPanel.removeClass('x-panel-dd-spacer');this.fieldPanel.addClass('x-panel-dd-filler');}},showWelcomeMsg:function(){this.destroyDbFieldPanel();if(this.fieldPanel){this.fieldPanel.addClass('x-panel-dd-spacer');this.fieldPanel.removeClass('x-panel-dd-filler');}},destroyDbFieldPanel:function(){if(this.dbFieldPanel){this.center.remove(this.dbFieldPanel,true);this.dbFieldPanel.destroy();delete this.dbFieldPanel;}
if(this.fieldPanel){this.center.remove(this.fieldPanel,true);this.fieldPanel.destroy();delete this.fieldPanel;}},itemSelected:function(){this.fieldSelected.apply(this,arguments);},fieldSelected:function(node,e){if(node&&node.attributes.folder){return;}
this.lastNodeClicked=node;this.hideWelcomeMsg();this.destroyDbFieldPanel();var attr=node.attributes;this.dbFieldPanel=new Mkt.apps.DbFieldPanel({aid:attr.aid,isCustom:attr.isCustom,isScore:attr.isScore,nodeId:node.id,enableRevenueExplorerSync:this.enableRevenueExplorerSync,mgr:this,treeNode:node,fieldCategory:attr.category,fieldTitle:attr.text,hideFieldTB:this.hideFieldTB,isHidden:attr.isHidden,fieldDescription:attr.description||'',fieldType:attr.type,fieldManager:this});this.center.add(this.dbFieldPanel);this.center.doLayout();},isFieldInUse:function(){return this.dbFieldPanel.isFieldInUse();},isActionAllowed:function(action){var allowed=true;var fieldActions=this.fieldActions;var fieldCategory=this.dbFieldPanel.fieldCategory;switch(action){case fieldActions.hide:case fieldActions.blockUpdates:case fieldActions.copyValues:case fieldActions.merge:case fieldActions.changeType:if(fieldCategory==this.categories.opportunityInfo){allowed=false;}
break;default:break;}
return allowed;},showActionNotAllowed:function(action,fieldCategory,animEl)
{MktMessage.showWarning(action+" is not allowed on <b>"+fieldCategory+"</b> fields",undefined,animEl);},hideField:function(hide){if(MktPage.appVars.result){delete MktPage.appVars.result;}
MktSession.clockCursor(true);MktSession.ajaxRequest('fieldManagement/hideField',{serializeParms:{aid:this.dbFieldPanel.aid,hide:hide},onMySuccess:this.hideFieldDone.createDelegate(this,[hide])});},hideFieldDone:function(hidden){var result=MktPage.appVars.result;if(result=="success"){var hiddenFieldsCat='Hidden Fields';var nodeConfigs={leaf:false,folder:true,readonly:true,allowDrag:false,iconCls:'icon16 ico-folder',icon:'/images/mkt2/icons16Matrix.gif',uiProvider:MktTreeNodeUI};var rootNode=this.fieldTreePanel.getRootNode();var node=this.fieldTreePanel.getNodeById(this.dbFieldPanel.nodeId);var nodeAttr=node.attributes;if(hidden){var hiddenFieldFolder=this.fieldTreePanel.getNodeById(hiddenFieldsCat);if(!hiddenFieldFolder){hiddenFieldFolder=rootNode.appendChild(new Ext.tree.TreeNode(Ext.apply({text:hiddenFieldsCat,id:hiddenFieldsCat},nodeConfigs)));}
hiddenFieldFolder.childrenRendered=true;nodeAttr.origCategory=nodeAttr.category;nodeAttr.category=hiddenFieldsCat;node=hiddenFieldFolder.appendChild(node);}else{if(nodeAttr.origCategory){var originalCatFolder=this.fieldTreePanel.getNodeById(nodeAttr.origCategory);if(originalCatFolder){originalCatFolder.childrenRendered=true;nodeAttr.category=nodeAttr.origCategory;originalCatFolder.appendChild(node);}}}
node.select();node.ensureVisible();nodeAttr.isHidden=hidden;this.dbFieldPanel.isHidden=hidden;this.dbFieldPanel.refreshTitle.call(this.dbFieldPanel);this.dbFieldPanel.updateHideTBText.call(this.dbFieldPanel);this.fieldTreePanel.invalidateAllCache();}else if(result=="customFieldOnly"){MktMessage.showInfo("The field you are trying to hide is a standard field. Hiding a standard field is prohibited.");}else if(result=="inuse"){MktMessage.showInfo("This field is in use. Remove the reference of this field and try again.");}else{MktMessage.showError(MktPage.appVars.msg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}},changeType:function(animEl){if(this.dbFieldPanel){this.dbFieldPanel.changeType(animEl);}},refreshAnalyticsOptionsForm:function(aids,rcaSyncEnabled,olapType){if(this.dbFieldPanel){for(var i=0;i<aids.length;i++){if(aids[i]==this.dbFieldPanel.aid||aids[i]==this.dbFieldPanel.fieldTitle){this.dbFieldPanel.refreshAnalyticsOptionsForm(rcaSyncEnabled,olapType);}}}},requestTaskStatus:function(animEl,taskId,targetFieldName){var url='fieldManagement/getFieldTaskStatus';MktSession.clockCursor(true);var parms={};if(isDefined(taskId)){parms.taskId=taskId;}
MktSession.ajaxRequest(url,{serializeParms:parms,onMySuccess:function(taskId){var status=MktPage.appVars.status;if(status&&isDefined(taskId)){status.taskId=taskId;}
if(isDefined(status)){this.showTaskStatusWindow(status,targetFieldName);}else{MktMessage.showInfo('No field task history found.');}}.createDelegate(this,[taskId])});},showTaskStatusWindow:function(status,targetFieldName){status=status||{};var taskStatWin=Ext.WindowMgr.get('fieldTaskStatusWindow');if(taskStatWin){taskStatWin.renderStatus(status);}else{taskStatWin=new Mkt.apps.fm.FieldTaskStatusWindow(Ext.apply({renderTo:Ext.getBody(),sourceAttribName:this.dbFieldPanel.fieldTitle,targetAttribName:targetFieldName,fieldManager:this},status));}
taskStatWin.show();},disableLongRunningActions:function(disable,statusMsg){var panelId='fmFields';var tab=MktCanvas.getTab(panelId);if(tab){var tb=tab.getTopToolbar();if(tb){var copyValuesButton=tb.items.get('copyValues'+MktUtil.camelCase(panelId));if(copyValuesButton){copyValuesButton.setDisabled(disable);}
var mergeFieldButton=tb.items.get('mergeFields'+MktUtil.camelCase(panelId));if(mergeFieldButton){mergeFieldButton.setDisabled(disable);}
var busyStatusButton=tb.items.get('busyStatusButton');if(busyStatusButton){busyStatusButton.setVisible(true);busyStatusButton.setText(statusMsg);}}}},createExportFormProcessing:function(){var exportMappingForm=Ext.get(this.exportFormId);if(!exportMappingForm){this.exportMappingForm=Ext.DomHelper.append(Ext.getBody(),{tag:'div',style:'display:none;',html:'<form id="'+this.exportFormProcessingId+'" name="'+this.exportFormProcessingId+'" action="fieldManagement/exportFormProcessingFields" method="post" target="exportProcessingFormIFrame">'
+'</form><iframe name="exportProcessingFormIFrame" id="exportProcessingFormIFrame" />'});}},exportFormProcess:function(){var exportMappingForm=Ext.get(this.exportFormProcessingId);if(!exportMappingForm){this.createExportFormProcessing();}
MktPage.preventNavAway(false);var exportFormProcessing=Ext.getDom(this.exportFormProcessingId);if(exportFormProcessing){exportFormProcessing.submit();}
MktPage.preventNavAway(true);},analyticsOptionsForm:function(animEl){animEl=Ext.get(animEl);var attribName,attribType,rcaSyncEnabled=false,olapType="Number (Sum, Count, etc)",aid;if(this.dbFieldPanel){attribName=this.dbFieldPanel.fieldTitle;attribType=this.dbFieldPanel.fieldType;rcaSyncEnabled=this.dbFieldPanel.rcaSyncEnabled;olapType=this.dbFieldPanel.olapType;aid=this.dbFieldPanel.aid;}
this.analyticsOptionsFormModal=new Mkt.apps.fm.AnalyticsOptionsForm({animateTarget:animEl,attribName:attribName,attribType:attribType,rcaSyncEnabled:rcaSyncEnabled,olapType:olapType,fieldPanel:this,aid:aid});this.analyticsOptionsFormModal.show(animEl);},cleanup:function(){},editFormulaField:function(fieldTitle){var title=fieldTitle+" Rules";var key='Person:'+fieldTitle;var leadAction=new Mkt.apps.leadAction();leadAction.addListener("modified",this.formulaModifiedHandler,this,{delay:10});leadAction.editLeadAction(null,103,key,title);},formulaModifiedHandler:function(){if(this.lastNodeClicked){this.fieldSelected(this.lastNodeClicked,null);}}});Mkt.apps.FieldManager.clearFieldTreeCache=function(){Mkt.widget.FieldTreePanel.prototype.invalidateAllCache();};Mkt.apps.DbFieldPanel=function(config){Mkt.apps.DbFieldPanel.superclass.constructor.apply(this,arguments);};Ext.extend(Mkt.apps.DbFieldPanel,Mkt.widget.LayoutFormPanel,{cls:'dbFieldPanel',droppable:true,autoDestroy:true,fieldTitle:'Default title',fieldDescription:'Default description',fieldHistory:[],fieldType:'text',showIsSortable:false,isSortable:false,salesMapping:[],loadFieldProperties:true,usedIn:[],validation:'',fieldPropertyUrl:'fieldManagement/getFieldProperties',loadingPropertyText:'',header:false,border:false,bodyBorder:false,frame:false,bodyStyle:'margin: 0; overflow: auto;',topPanelTmpl:'',bottomPanelTmpl:'',fieldWidth:100,initComponent:function(){this.items=this.items||[];this.titlePanel=new Ext.Panel({bodyBorder:false,html:''});this.items.push(this.titlePanel);if(this.loadFieldProperties){this.on('render',this.showLoadingMask);}
this.on('beforedestroy',function(){this.cancelLoad=true;});Mkt.apps.DbFieldPanel.superclass.initComponent.call(this);if(this.loadFieldProperties){MktSession.ajaxRequest(this.fieldPropertyUrl,{serializeParms:{aid:this.aid},onMySuccess:this.loadFieldProperties.createDelegate(this)});}},refreshTitle:function(){this.titleDescription.setTitle(this.getFormattedFieldTitle(),false);},getFormattedFieldTitle:function(){return this.fieldTitle+(this.isHidden?' (Hidden)':'');},showLoadingMask:function(){window.setTimeout(function(){if(!this.mask){this.mask=new Ext.LoadMask(this.body,{msg:this.loadingPropertyText});}
this.mask.show();}.createDelegate(this),0);},hideLoadingMask:function(){if(this.mask){this.mask.hide();this.mask.destroy();delete this.mask;}},getType:function(){if(this.isScore){return Mkt.apps.fm.FieldTypeMapping['score'];}else{return Mkt.apps.fm.FieldTypeMapping[this.fieldType]||this.fieldType;}},setType:function(type){this.isScore=(type.toUpperCase()=='SCORE');this.fieldType=type;if(this.typePanel&&this.typePanel.bwrap){var el=Ext.get('typeValue');if(el){el.update(this.getType());}}
if(this.treeNode){this.treeNode.attributes.type=type;this.treeNode.attributes.isScore=this.isScore;}},buildComponents:function(){var items=[];if(this.titlePanel){this.titlePanel.destroy();delete this.titlePanel;}
var usedIn=MktPage.appVars.usedIn;var titleEditable=true;var titleReadonlyReason='';var type=this.getType();var isFormula=(type=="Formula");if(!this.isCustom){titleEditable=false;titleReadonlyReason='Standard fields are read-only.';}
else if(this.fieldCategory==this.fieldManager.categories.opportunityInfo){titleEditable=false;titleReadonlyReason='Opportunity info fields are read-only';}
else if(usedIn.length>0){titleEditable=false;titleReadonlyReason='Field in used is read-only.';}
else if(isFormula){titleEditable=false;titleReadonlyReason='Formula field title is read-only.';}
this.titleDescription=new Mkt.widgets.CanvasHeader({titleValue:this.getFormattedFieldTitle(this.fieldTitle),descValue:this.fieldDescription,aid:this.aid,width:550,editWidth:550,editTitleWidth:350,editDescWidth:350,titleEditable:titleEditable,titleReadonlyReason:titleReadonlyReason,savedCallback:this.fieldRenamedCallback.createDelegate(this),editable:true,titleId:'newFieldName',descId:'newFieldDesc',actionUrl:'fieldManagement/editMetaInfo',serializeParms:{aid:this.aid,titleEditable:titleEditable}});this.add(this.titleDescription);this.typePanel=new Ext.Panel({bodyBorder:false,style:'margin: 20px 0 10px 0',cls:'form',html:'<div class="mktFieldLabel">Type: </div><div class="mktFieldLabel mktFieldValue" id="typeValue">'
+type+'</div>'});this.add(this.typePanel);if(isFormula){var attr={value:'<a href="#" onclick="Mkt.apps.DbFieldPanel.prototype.handleEditEventClick(\''+this.fieldTitle+'\')">Edit Rules</a>',fieldLabel:'Rules'};var editFormula=new Ext.form.DisplayField(Ext.apply({},attr,this.fieldDisplayConfiguration));this.add(editFormula);this.add({html:MktPage.appVars.rules,padding:"0px 0px 10px 150px"});}
this.sfdcMapping=new Mkt.widgets.ListField({cls:'formItem',fieldLabel:"SFDC Field Map:",itemTmpl:'<div style="height: 18px;">{text}</div>'});this.add(this.sfdcMapping);this.sfdcMappingValue=this.sfdcMapping.items.items[1];this.blockUpdatesField=new Mkt.widgets.ListField({cls:'formItem',fieldLabel:'Block Updates From:',itemTmpl:'<div style="height: 18px;">{text}</div>'});this.add(this.blockUpdatesField);if(this.enableRevenueExplorerSync){this.rcaSyncEnabledPanel=new Ext.Panel({bodyBorder:false,style:'margin: 13px 0 10px 0',cls:'form',html:'<div class="mktFieldLabel" style="margin-right: 5px;">Revenue Explorer Sync: </div>'+'<div class="mktFieldLabel" id="rcaSyncEnabledValue"></div>'});this.add(this.rcaSyncEnabledPanel);}
this.usedByField=new Mkt.widgets.ListField({cls:'formItem',fieldLabel:'Field Used By:',itemTmpl:'<div style="margin-left: 20px;" > <div style="line-height:20px; width:auto; cursor:pointer; display:inline;">'+'<div style="position:relative; display:block; margin-left: -20px;">'+'<div class="mki16 {iconCls}">'+'</div>'+'</div>'+'{text}</div></div>'});this.add(this.usedByField);this.usedByFieldValue=this.usedByField.items.items[1];},getOlapType:function(){return this.olapType||"";},getRcaSyncEnabled:function(){return this.rcaSyncEnabled||"";},handleEditEventClick:function(name){var fieldManager=MktCanvas.getRegisteredItem('fieldManager','fmFields');if(fieldManager){fieldManager.editFormulaField(name);}},fieldRenamedCallback:function(){var fieldName=MktPage.appVars.fieldName;if(fieldName){this.treeNode.setText(MktPage.appVars.fieldName);}
this.fieldManager.fieldTreePanel.invalidateAllCache();this.treeNode.attributes.description=MktPage.appVars.fieldDesc;},loadFieldProperties:function(){if(this.cancelLoad){return;}
if(MktPage.appVars.result=="success"){this.buildComponents();window.setTimeout(this.populateFieldValues.createDelegate(this),10);this.doLayout();}else{MktMessage.showError(MktPage.appVars.errMsg);}
this.hideLoadingMask();},updateHideTBText:function(){var panelId='fmFields';var tab=MktCanvas.getTab(panelId);if(tab){var tb=tab.getTopToolbar();if(tb){var btn=tb.items.get('fieldManagement_'+panelId);if(btn&&btn.menu&&btn.menu.items){btn.menu.items.get('hideField'+MktUtil.camelCase(panelId)).setText((this.isHidden?'Unhide':'Hide')+" Field");}}}},populateFieldValues:function(){var usedIn=MktPage.appVars.usedIn;if(usedIn.length>0){for(var i=0;i<usedIn.length;i++){this.usedByField.addListItem({iconCls:usedIn[i].iconCls,text:usedIn[i].text},function(){MktDlManager.loadDl(this.xtra);}.createDelegate(usedIn[i]));}}else{Ext.DomHelper.append(this.usedByFieldValue.bwrap,{tag:'div',html:'None'});}
var sfdcMapping=MktPage.appVars.sfdcMapping;if(sfdcMapping.length>0){for(var i=0;i<sfdcMapping.length;i++){this.sfdcMapping.addListItem({text:sfdcMapping[i]},function(){});}}
this.updateRcaSyncEnabled(MktPage.appVars.rcaSyncEnabled);this.updateOlapType(MktPage.appVars.olapType);this.refreshBlockUpdatesFrom();this.updateHideTBText();},updateRcaSyncEnabled:function(enabled){this.rcaSyncEnabled=enabled;var rcaSyncEnabledEl=Ext.get('rcaSyncEnabledValue');if(rcaSyncEnabledEl){rcaSyncEnabledEl.update(enabled?"Enabled":"Disabled");}},updateOlapType:function(olapType){this.olapType=olapType;var olapTypeEl=Ext.get('olapTypeValue');if(olapTypeEl){olapTypeEl.update(this.getOlapType());}},blockUpdatesForm:function(animEl){var blockUpdateValue=this.blockUpdateValue=MktPage.appVars.blockUpdates||{};var trustedSource=new Ext.form.Checkbox({boxLabel:'List Import trusted source',name:'importList',checked:isDefined(blockUpdateValue.importList)});var untrustedSource=new Ext.form.Checkbox({boxLabel:'List Import untrusted source',name:'untrustedImportList',disabled:isDefined(blockUpdateValue.importList),checked:isDefined(blockUpdateValue.untrustedImportList)});trustedSource.on('check',function(checkbox,checked){untrustedSource.setDisabled(checked);if(checked){untrustedSource.setValue(checked);}}.createDelegate(this));var sources=[{boxLabel:'Munchkin API',name:'munchkinAPI',checked:isDefined(blockUpdateValue.munchkinAPI)},trustedSource,untrustedSource,{boxLabel:'Form fillout',name:'formFillout',checked:isDefined(blockUpdateValue.formFillout)},{boxLabel:'Flow change data value',name:'flowChangeDataValue',checked:isDefined(blockUpdateValue.flowChangeDataValue)},{boxLabel:'Salesforce sync',name:'salesforceSync',checked:isDefined(blockUpdateValue.salesforceSync)},{boxLabel:'Lead detail update',name:'leadDetailUpdate',checked:isDefined(blockUpdateValue.leadDetailUpdate)},{boxLabel:'SOAP API',name:'webServiceApi',checked:isDefined(blockUpdateValue.webServiceApi)}];if(MktPage.hasCredential('enrichwithjigsaw')){sources.push({boxLabel:'Jigsaw',name:'jigsawApi',checked:isDefined(blockUpdateValue.jigsawApi)});}
this.blockUpdatesFormModal=new Mkt.apps.fm.BlockUpdatesForm({animateTarget:Ext.get(animEl),fieldPanel:this,aid:this.aid,sources:sources});this.blockUpdatesFormModal.show();},analyticsOptionsSelectedForm:function(animEl){if(!this.isCustom){MktMessage.showWarning("This field cannot sync with Revenue Cycle Analytics",undefined,animEl);}
else{this.fieldManager.analyticsOptionsForm(animEl);}},refreshBlockUpdatesFrom:function(){var blockUpdates=MktPage.appVars.blockUpdates;this.blockUpdatesField.clearList();var i=0;for(key in blockUpdates){this.blockUpdatesField.addListItem({text:blockUpdates[key]});i++;}
if(!i){this.blockUpdatesField.addListItem({text:'None'});}},refreshAnalyticsOptionsForm:function(rcaSyncEnabled,olapType){this.updateRcaSyncEnabled(rcaSyncEnabled);this.updateOlapType(olapType);},changeType:function(animEl){var type=this.getType().toUpperCase();if(!this.isCustom){MktMessage.showWarning("Only custom fields can change type",undefined,animEl);}else if(this.isFieldInUse()){MktMessage.showWarning("This field is in use so we can not change the type",undefined,animEl);}else if(this.isHidden){MktMessage.showWarning("This field is hidden so we can not change the type",undefined,animEl);}else{this.changeTypeForm=new Mkt.apps.fm.ChangeTypeForm({aid:this.aid,fieldName:this.fieldTitle,fieldType:this.getType(),dataType:this.getType(),successCallback:this.changeTypeSuccessCallback.createDelegate(this)});this.changeTypeForm.show(animEl);}},changeTypeSuccessCallback:function(type){this.setType(type);this.setPreview(type);this.fieldManager.fieldTreePanel.invalidateCache();},onRender:function(){Mkt.apps.DbFieldPanel.superclass.onRender.apply(this,arguments);},reinitProperties:function(prop){this.fieldTitle=prop.fieldTitle||'';this.fieldDescription=prop.fieldDescription||'';this.fieldHistory=prop.fieldHistory||[];this.validation=prop.validation||[];this.fieldType=prop.fieldType||'';this.salesMapping=prop.salesMapping||[];this.usedIn=prop.usedIn||[];this.updateDisplay();},updateDisplay:function(){},buildPreview:function(type){var widget=Ext.form.TextField;var attr={};switch(type){case'text':case'string':case'integer':case'email':case'phone':case'url':case'currency':widget=Ext.form.TextField;break;case'date':case'datetime':widget=Ext.form.DateField;break;case'boolean':widget=Ext.form.Checkbox;break;case'lead_action':case'formula':widget=Ext.form.DisplayField;attr.value='Not Applicable';break;default:widget=Ext.form.TextField;break;}
return new widget(Ext.apply({},attr,this.fieldDisplayConfiguration));},fieldDisplayConfiguration:{name:'preview',labelStyle:'margin-left: 6px; width: 139px;',fieldLabel:'Preview in Form',readOnly:true,labelWidth:250,width:166,value:''},setPreview:function(type){if(this.previewTextField){if(this.previewTextField){this.remove(this.previewTextField,true);this.previewTextField.destroy();delete this.previewTextField;}
this.previewTextField=this.buildPreview(type);var comp=this.insert(2,this.previewTextField);this.doLayout();}},isFieldInUse:function(){if(this.usedByField.itemCount){return true;}else{return false;}}});Mkt.apps.BlankDbFieldPanel=Ext.extend(Mkt.widget.LayoutFormPanel,{layout:'fit',droppable:true,cls:'x-panel-dd-spacer',border:false,welcomeMsg:'Select a field from the right',initComponent:function(){this.items=[{border:false,cls:'welcomeTarget',style:'margin: 0;',html:'<h1>'+this.welcomeMsg+'</h1>'}];Mkt.apps.BlankDbFieldPanel.superclass.initComponent.call(this);}});
/* ========== ../mkt-ext-2.0/apps/FieldManagement.js ============ */

Ext.ns('Mkt','Mkt.apps','Mkt.apps.fm');Mkt.apps.fm.FieldTypeMapping={'integer':'Integer','score':'Score','boolean':'Boolean','float':'Float','currency':'Currency','percent':'Percent','string':'String','text':'Text','date':'Date','datetime':'Datetime','phone':'Phone','email':'Email','enum':'Enum','url':'Url','reference':'Reference','lead_action':'Formula'};Mkt.apps.fm.rcaMpaFieldPickerForm=Ext.extend(Mkt.widgets.ModalForm,{id:'rcaMpaFieldPicker',iconCls:'mkiDataTable',title:'Model Performance Analysis (Leads)',cls:'mktModalForm mktModalForm2 mktModalForm3 ',width:540,height:265,resizable:true,layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',okText:'Save',buttonAlign:'right',labelWidth:130,newAttrId:0,prevAttrId:0,submitUrl:'fieldManagement/setCurrentModelPerfAnalysisArea',initComponent:function(){this.newAttrId=this.aid;this.prevAttrId=this.aid;this.fieldInfo={};this.fieldInfo.groupName='';this.fieldInfo.groupNum=0;this.fieldInfo.dataType='';this.items=(this.items||[]).concat(this.getFields());Mkt.apps.fm.rcaMpaFieldPickerForm.superclass.initComponent.call(this);},getFields:function(){var items=[];this.attributeLabelBox=this.getAttributeField(this.aid);items.push(this.attributeLabelBox);this.fieldGroupNum=new Ext.form.DisplayField({id:'fieldGroupNum',fieldLabel:'',value:''});items.push(this.fieldGroupNum);this.mpaListField=new Mkt.widgets.ListField({cls:'formItem',itemCls:'mpaListField',hideLabel:true,hidden:false,fieldLabel:'&nbsp;',values:[],itemTmpl:'<div class="mpaListFieldItem"> '+'<div class="mki16 {iconCls}"></div>'+'{text}</div>',showList:function(rcaStandardField){var items=[];items.push({text:'Sync to Model Performance (Leads) Analysis Area',iconCls:'mkiOk'});if(rcaStandardField===false){items.push({text:'Sync to Lead, Campaign, Opportunity Analysis areas',iconCls:'mkiOk'});}
this.clearList();this.addListItems(items);this.show();}});items.push(this.mpaListField);this.learnMoreLink=new Ext.Element(Ext.DomHelper.createDom({tag:'a',href:this.urlLearnMore,html:'Learn More',target:'_blank'}));this.learnMoreLink.on('click',this.learnMoreClicked,this);items.push({width:64,unstyled:true,plain:true,style:'position:absolute; left:20px; bottom: 50px; ',contentEl:this.learnMoreLink});return items;},getAttributeField:function(aid)
{var jsonStore=new Ext.data.JsonStore({autoLoad:true,autoDestroy:true,url:'fieldManagement/getBinnedFieldsAsCombo',root:'suggest',idProperty:'aid',fields:['attribute_name','tt','aid','name','group','dt','groupCount','disabled','isRcmEnabled'],listeners:{load:function(store,records,options){if(!store)return;var noneRecord=new store.recordType({aid:0,attribute_name:'None',dt:''});noneRecord.commit();store.insert(0,noneRecord);var value=undefined;if(aid===0){value='None';this.attributeCombobox.setValue(aid);this.mpaListField.hide();}
else{var idx=store.findExact('aid',aid);if(idx!=-1&&aid>0){value=records[idx-1].data.attribute_name;this.attributeCombobox.setValue(value);this.showFieldGroupInfo();this.mpaListField.showList(this.isRcaStandardField(records[idx-1]));}}}.createDelegate(this)}});this.attributeCombobox=new Ext.form.ImprovedComboBox({fieldLabel:"Field",itemCls:"mktRequired",triggerAction:'all',selectMultiple:false,forceSelection:false,disableAutoselect:false,autoExpandTrigger:false,preventExpandOnLoad:true,autoSelect:false,allowBlank:true,editable:true,typeAhead:false,minChars:1,emptyText:'None',enableKeyEvents:false,anchor:"90%",store:jsonStore,mode:'local',loadingText:'Searching...',displayField:'attribute_name',valueField:'aid'});this.attributeCombobox.on('beforeshow',function(){this.collapse();});this.attributeCombobox.on('beforequery',function(){this.newAttrId=0;this.hideMessage();}.createDelegate(this));this.attributeCombobox.on('select',function(combobox,record,index){this.newAttrId=record.get('aid');if(this.newAttrId>0&&this.newAttrId!==this.prevAttrId){this.prevAttrId=this.newAttrid;this.showFieldGroupInfo();this.mpaListField.showList(this.isRcaStandardField(record));}
else{if(this.newAttrId===0){this.newAttrId=0;this.fieldInfo.groupName='';this.fieldInfo.groupNum=0;this.fieldInfo.dataType='';this.fieldGroupNum.itemCt.addClass("mktHidden");this.mpaListField.hide();}}}.createDelegate(this));this.attributeCombobox.on('beforeselect',function(combobox,record,index){if(record.get('disabled')===true){return false;}});this.attributeCombobox.on('keydown',function(){this.hideMessage();}.createDelegate(this));return this.attributeCombobox;},beforeSubmitCallback:function(){var newAttrId=this.getSelectedAttribId();if(newAttrId===this.prevAttrId){this.close();return false;}
else{if(this.fieldGroupNum.getValue()>10){this.showMessageError("Selected fields cannot have more than 10 groups.");return false;}}
return true;},okCallback:function()
{var newAttrId=this.getSelectedAttribId();this.serializeParms={aid:newAttrId,old_aid:this.aid}},submitSuccessCallback:function(){var result=MktPage.appVars.result;if(result&&result===MktSession.resultSuccess){this.close();if(this.grid){this.grid.loadPagedGrid();var tab=MktCanvas.getTab('cadCustomFieldSyncCanvas');if(tab){tab.config.contentValid=false;}}}
else{this.showMessageError(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}},getSelectedAttribId:function(){return this.newAttrId;},isRcaStandardField:function(record){return record.get('isRcmEnabled');},showFieldGroupInfo:function(){var aid=this.newAttrId;if(aid>0){var fieldGroup='';var fieldGroupCount=0;var fieldDataTypeText='NA';var fieldBin=false;if(this.attributeCombobox.store){var idx=this.attributeCombobox.store.find('aid',aid);try{fieldGroup=this.attributeCombobox.store.getAt(idx).data.attribute_name;var fieldDataType=this.attributeCombobox.store.getAt(idx).data.dt;fieldDataTypeText=Mkt.apps.fm.FieldTypeMapping[fieldDataType]||fieldDataType;fieldGroup=this.attributeCombobox.store.getAt(idx).data.group;fieldGroupCount=this.attributeCombobox.store.getAt(idx).data.groupCount;}
catch(e){console.log('Cannot find corresponding field (id:'+aid+')');}}
this.fieldGroupNum.setValue(fieldGroupCount);this.fieldInfo.groupName=fieldGroup;this.fieldInfo.groupNum=fieldGroupCount;this.fieldInfo.dataType=fieldDataTypeText;var fieldLabel='Number of Groups';this.fieldGroupNum.label.update(fieldLabel+': ');this.fieldGroupNum.itemCt.removeClass("mktHidden");}
else{this.fieldInfo.groupName='';this.fieldInfo.groupNum=0;this.fieldInfo.dataType='';this.fieldGroupNum.itemCt.addClass("mktHidden");}}});Mkt.apps.fm.BlockUpdatesForm=Ext.extend(Ext.Window,{title:'Block Updates From',iconCls:'mkiSignStop',width:400,height:422,resizable:false,layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',initComponent:function(){this.items=this.items||[];this.items.push({html:'Updates from the checked item(s) is not allowed.',baseCls:"mkt-modal-text-body",anchor:"100% 13%"});this.items.push({xtype:'fieldset',title:'Input Sources',anchor:'100% 87%',cls:'mktFieldsetCheckboxes',defaults:{height:23,hideLabel:true},defaultType:'checkbox',items:this.sources});this.height=179+(this.sources.length*27);this.buttons=this.buttons||[];this.buttons.push({text:'Ok',iconCls:'mkiOk',handler:function(button,event){button.setDisabled(true);MktSession.clockCursor(true);var blockUpdatesFrom=[];this.items.items[1].items.each(function(item,index,length){if(item.name&&item.checked){blockUpdatesFrom.push(item.name);}});if(MktPage.appVars.result){delete MktPage.appVars.result;}
MktSession.ajaxRequest('fieldManagement/blockUpdatesFrom',{serializeParms:{blockUpdatesFrom:Ext.util.JSON.encode(blockUpdatesFrom),aid:this.aid},onMySuccess:this.blockUpdatesFromDone.createDelegate(this,[button])});}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.fm.BlockUpdatesForm.superclass.initComponent.call(this);},blockUpdatesFromDone:function(button){if(MktPage.appVars.result&&MktPage.appVars.result=="success"){this.close();if(this.fieldPanel){this.fieldPanel.refreshBlockUpdatesFrom();}}else{button.setDisabled(false);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});Mkt.apps.fm.MergeFieldForm=Ext.extend(Ext.Window,{title:'Merge Fields',iconCls:'mkiData',width:430,height:235,resizable:false,layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',incompatibleDatatypeError:"<b>{0}: {1}</b><br /><b>{2}: {3}</b><br /><br />Fields are not the same type and therefore can not be merged.",initComponent:function(){this.items=this.items||[];this.items.push({html:'Merge <b>'+this.sourceFieldName+'</b> with:',baseCls:"mkt-modal-text-body",anchor:"100% 15%"});var fields=['attribute_name','dt','aid','disabled'];var jsonStore=new Ext.data.JsonStore({url:'fieldManagement/getFieldsAsCombo',root:'suggest',baseParams:{},fields:fields});var store=new Ext.data.SimpleStore({fields:fields,data:[[this.sourceFieldName,this.sourceDataType,this.aid,false]]});this.items.push({xtype:"form",anchor:"100% 60%",baseCls:"mkt-modal-text-body",autoHeight:true,width:380,labelWidth:150,items:[new Ext.form.ImprovedComboBox({fieldLabel:"Target Field",lazyRender:true,store:jsonStore,displayField:'attribute_name',forceSelection:true,typeAhead:false,validator:this.validateTargetValue.createDelegate(this),triggerAction:'all',selectOnFocus:false,mode:'remote',loadingText:'Searching...',minChars:0,allowBlank:false,name:"targetField"}),new Ext.form.ImprovedComboBox({fieldLabel:"If conflict, winner is",lazyRender:true,forceSelection:true,store:store,displayField:'attribute_name',typeAhead:false,mode:'local',triggerAction:'all',allowBlank:false,selectOnFocus:false,name:"winningField"})]});this.items.push({html:'<div style="float:left;"><img src="/images/icons32/sign_warning.png" style="height:32px; width:32px; padding-right:5px;" /></div>'
+'<div style="float:left;"><b>Note:</b> Merging fields may take a while.<br />It can not be canceled once started.</div>',baseCls:"mkt-modal-text-body",style:'margin-top: 20px;',anchor:"100% 20%"});this.targetField=this.items[1].items[0];this.winningField=this.items[1].items[1];this.winningField.on('beforequery',this.populateFieldSelection.createDelegate(this));this.targetField.on('beforeselect',this.beforeTargetFieldSelected.createDelegate(this));this.buttons=this.buttons||[];this.buttons.push(new Ext.Button({text:'Merge',iconCls:'mkiData',minWidth:75,handler:function(button){this.mergeFieldsSubmit.call(this);}.createDelegate(this)}));this.buttons.push({text:'Cancel',iconCls:'mkiCancel',minWidth:75,handler:function(){this.close();}.createDelegate(this)});this.mergeButton=this.buttons[0];Mkt.apps.fm.MergeFieldForm.superclass.initComponent.call(this);},beforeTargetFieldSelected:function(comboBox,record,index){if(record&&record.data.disabled){return false;}else{if(this.targetField==comboBox){this.winningField.clearValue();}
return true;}},validateTargetValue:function(){var defaultMsg="Please select a target field and try again.";var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);if(targetFieldRecord){if(targetFieldRecord.data.aid==this.aid){return"The target field should not be the same with the source field";}else if(targetFieldRecord.data.dt==this.sourceDataType){return true;}else{return String.format(this.incompatibleDatatypeError,this.sourceFieldName,this.sourceDataType,targetFieldRecord.data.attribute_name,targetFieldRecord.data.dt);}}else{return defaultMsg;}}else{return defaultMsg;}
return true;},populateFieldSelection:function(queryEvent){var comboStore=queryEvent.combo.store;comboStore.removeAll();var rec=new Ext.data.Record({attribute_name:this.sourceFieldName,dt:this.sourceDataType,aid:this.aid});comboStore.add(rec);var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);}else{this.targetField.validate();return false;}
var targetFieldData=targetFieldRecord.data;var rec=new Ext.data.Record({attribute_name:targetFieldData.attribute_name,dt:targetFieldData.dt,aid:targetFieldData.aid});comboStore.add(rec);return true;},showValidationError:function(msg){MktMessage.showError(msg);return false;},mergeFieldsSubmit:function(animEl,taskId){var targetFieldValid=this.targetField.validate();var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);if(isUndefined(targetFieldRecord)){return;}}else{return;}
var winningFieldValid=this.winningField.validate();var winningFieldIndex=this.winningField.selectedIndex;if(winningFieldIndex>=0){var winningFieldRecord=this.winningField.store.getAt(winningFieldIndex);if(isUndefined(winningFieldRecord)){return;}}else{return;}
if(!targetFieldValid||!winningFieldValid){return;}
var parms={};parms.fromAid=this.aid;parms.toAid=targetFieldRecord.data.aid;parms.winningAid=winningFieldRecord.data.aid;MktSession.clockCursor(true);this.mergeButton.disable();if(MktPage.appVars.result){delete MktPage.appVars.result;}
MktSession.ajaxRequest('fieldManagement/mergeFields',{serializeParms:parms,onMySuccess:this.mergeFieldsSubmitDone.createDelegate(this,[taskId,targetFieldRecord.data.attribute_name])});},mergeFieldsSubmitDone:function(taskId,targetFieldName){var result=MktPage.appVars.result;MktSession.unclockCursor();if(result=="success"){this.close();this.fieldManager.requestTaskStatus(undefined,taskId||MktPage.appVars.taskId,targetFieldName);this.fieldManager.disableLongRunningActions(true,"Merging in progress");}else{this.mergeButton.enable();MktMessage.showError(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});Mkt.apps.fm.CopyFieldValueFormModal=Ext.extend(Ext.Window,{title:'Copy Values to Another Field',iconCls:'mkiAdd2',width:420,height:240,resizable:false,layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',customFieldError:"You cannot copy values to a standard field",incompatibleDatatypeError:"<b>{0}: {1}</b><br /><b>{2}: {3}</b><br /><br />Fields are not the same type and therefore can not be copied.",initComponent:function(){this.items=this.items||[];this.items.push({html:'Copy <b>'+this.sourceFieldName+'</b> values to:',baseCls:"mkt-modal-text-body",anchor:"100% 20%"});var fields=['attribute_name','dt','aid','disabled'];var jsonStore=new Ext.data.JsonStore({url:'fieldManagement/getFieldsAsCombo',root:'suggest',baseParams:{},fields:fields});var store=new Ext.data.SimpleStore({fields:fields,data:[[this.sourceFieldName,this.sourceDataType,this.aid,false]]});this.items.push({xtype:"form",anchor:"100% 60%",autoHeight:true,width:360,baseCls:"mkt-modal-text-body",labelWidth:170,items:[new Ext.form.ImprovedComboBox({fieldLabel:"Target Field",lazyRender:true,store:jsonStore,displayField:'attribute_name',forceSelection:true,typeAhead:false,validator:this.validateTargetValue.createDelegate(this),triggerAction:'all',selectOnFocus:false,mode:'remote',loadingText:'Searching...',minChars:0,allowBlank:false,name:"targetField"}),new Ext.form.ImprovedComboBox({fieldLabel:"If conflict, winner is",lazyRender:true,forceSelection:true,store:store,displayField:'attribute_name',typeAhead:false,mode:'local',triggerAction:'all',allowBlank:false,selectOnFocus:false,name:"winningField"})]});this.targetField=this.items[1].items[0];this.targetField.on('beforeselect',this.beforeFieldSelected.createDelegate(this));this.winningField=this.items[1].items[1];this.winningField.on('beforequery',this.populateFieldSelection.createDelegate(this));this.items.push({html:'<div style="float:left;"><img src="/images/icons32/sign_warning.png" style="height:32px; width:32px; padding-right:5px;" /></div>'
+'<div style="float:left;"><b>Note:</b> Copying fields may take a while.<br />It can not be canceled once started.</div>',baseCls:"mkt-modal-text-body",style:'margin-top: 20px;',anchor:"100% 20%"});this.buttons=this.buttons||[];this.buttons.push(new Ext.Button({text:'Copy',iconCls:'mkiData',minWidth:75,handler:function(button){this.copyValuesSubmit.call(this);}.createDelegate(this)}));this.buttons.push({text:'Cancel',iconCls:'mkiCancel',minWidth:75,handler:function(){this.close();}.createDelegate(this)});this.copyButton=this.buttons[0];Mkt.apps.fm.MergeFieldForm.superclass.initComponent.call(this);},beforeFieldSelected:function(comboBox,record,index){if(record&&record.data.disabled){return false;}else{if(this.targetField==comboBox){this.winningField.clearValue();}
return true;}},populateFieldSelection:function(queryEvent){var comboStore=queryEvent.combo.store;comboStore.removeAll();var rec=new Ext.data.Record({attribute_name:this.sourceFieldName,dt:this.sourceDataType,aid:this.aid});comboStore.add(rec);var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);}else{this.targetField.validate();return false;}
var targetFieldData=targetFieldRecord.data;var rec=new Ext.data.Record({attribute_name:targetFieldData.attribute_name,dt:targetFieldData.dt,aid:targetFieldData.aid});comboStore.add(rec);return true;},validateTargetValue:function(){var defaultMsg="Please select a target field and try again.";var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);if(targetFieldRecord){if(targetFieldRecord.data.aid==this.aid){return"The target field should not be the same with the source field";}else if(targetFieldRecord.data.dt==this.sourceDataType){return true;}else{return String.format(this.incompatibleDatatypeError,this.sourceFieldName,this.sourceDataType,targetFieldRecord.data.attribute_name,targetFieldRecord.data.dt);}}else{return defaultMsg;}}else{return defaultMsg;}
return true;},showValidationError:function(msg){MktMessage.showError(msg);return false;},copyValuesSubmit:function(){var targetFieldValid=this.targetField.validate();var targetFieldIndex=this.targetField.selectedIndex;if(targetFieldIndex>=0){var targetFieldRecord=this.targetField.store.getAt(targetFieldIndex);}else{return;}
var winningFieldValid=this.winningField.validate();var winningFieldIndex=this.winningField.selectedIndex;if(winningFieldIndex>=0){var winningFieldRecord=this.winningField.store.getAt(winningFieldIndex);}else{return;}
if(!targetFieldValid||!winningFieldValid){return;}
MktSession.clockCursor(true);this.copyButton.disable();if(MktPage.appVars.result){delete MktPage.appVars.result;}
MktSession.ajaxRequest('fieldManagement/copyFieldValues',{serializeParms:{sourceAid:this.aid,targetAid:targetFieldRecord.data.aid,winningAid:winningFieldRecord.data.aid},onMySuccess:this.copyValuesSubmitDone.createDelegate(this,[targetFieldRecord.data.attribute_name])});},copyValuesSubmitDone:function(){var result=MktPage.appVars.result;MktSession.unclockCursor();if(result=="success"){this.close();this.fieldManager.requestTaskStatus(undefined,MktPage.appVars.taskId);this.fieldManager.disableLongRunningActions(true,"Copying in progress");}else{this.copyButton.enable();MktMessage.showError(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});Mkt.apps.fm.FieldTaskStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Field Task Status",ctype:'Mkt.apps.fmFieldTaskStatusWindow',pollInterval:5000,height:90,pollStatus:false,url:'fieldManagement/getFieldTaskStatus',tabId:'fmFields',taskInProcess:"Active",taskQueued:"Queued",taskComplete:"Complete",taskFailed:"Failed",taskCanceled:"Canceled",taskTypeMerge:"Merge Attributes",taskTypeCopy:"Copy Values",reloadTabFinish:false,initComponent:function(){this.setStatuses(this);this.id='fieldTaskStatusWindow';Mkt.apps.fm.FieldTaskStatusWindow.superclass.initComponent.call(this);},setTaskId:function(id){this.taskId=taskId;},buildTitleStatus:function(){var title=this.title;if(isDefined(this.taskType)&&isDefined(this.sourceAttribName)&&(false)&&isDefined(this.targetAttribName)){if(this.taskType==this.taskTypeMerge){title="Merging ";}else{title="Copying ";}
title=title+this.sourceAttribName+" to "+this.targetAttribName;}
return title;},setStatuses:function(statuses){if(isUndefined(statuses)){return;}
if(hasValue(statuses.name)){this.attribName=statuses.name;}else{delete this.attribName;}
if(hasValue(statuses.id)){this.aid=statuses.id;}else{delete this.aid;}
if(hasValue(statuses.description)){this.attribDescription=statuses.description;}else{delete this.attribDescription;}
if(hasValue(statuses.task_type)){this.taskType=statuses.task_type;}else{delete this.taskType;}
if(hasValue(statuses.task_status)){this.taskStatus=statuses.task_status;}else{delete this.taskStatus;}
if(hasValue(statuses.cancel_pending)){this.cancelPending=statuses.cancel_pending;}else{delete this.cancelPending;}
if(hasValue(statuses.task_summary)){this.taskSummary=statuses.task_summary;}else{delete this.taskSummary;}
if(hasValue(statuses.rows_processed)){this.rowsProcessed=statuses.rows_processed;}else{delete this.rowsProcessed;}
if(hasValue(statuses.rows_succeeded)){this.rowsSucceeded=statuses.rows_succeeded;}else{delete this.rowsSucceeded;}
if(hasValue(statuses.rows_failed)){this.rowsFailed=statuses.rows_failed;}else{delete this.rowsFailed;}
if(hasValue(statuses.elapsed_time)){this.elapsedTime=statuses.elapsed_time;}else{delete this.elapsedTime;}
if(hasValue(statuses.estimated_rows)){this.estimatedRows=statuses.estimated_rows;}else{delete this.estimatedRows;}
if(hasValue(statuses.started_at)){this.startedAt=statuses.started_at;}else{delete this.startedAt;}
if(hasValue(statuses.ended_at)){this.endedAt=statuses.ended_at;}else{delete this.endedAt;}
if(hasValue(statuses.task_id)){this.taskId=statuses.task_id;}else{delete this.taskId;}},renderStatus:function(statuses){if(isUndefined(this.taskId)){return;}
if(statuses){this.setStatuses(statuses);}
var buff='<div style="float:left; width:188px;">';var completed=this.isFinish();var canceled=(this.taskStatus==this.taskCanceled);if(completed||canceled){buff=buff+(completed?"Completed ":"Cancelled ")+(hasValue(this.endedAt)?this.endedAt:"");}
if(hasValue(this.taskStatus)&&!completed&&!canceled){buff=buff+'Status: '+this.taskStatus+'<br />';}
if(!completed&&!canceled){if(hasValue(this.rowsProcessed)){buff=buff+'Rows Processed: '+this.rowsProcessed+'<br />';}
if(hasValue(this.estimatedRows)){buff=buff+'Estimated Rows: '+this.estimatedRows+'<br />';}}
if(!canceled){buff=buff+'</div>'
+'<div style="float:right; padding-right: 5px; padding-top:">'
+'<img style="margin-left:2px; margin-top: 4px; margin-bottom:2px; width:'
+(completed?'24':'16')+'px; height:'+(completed?'24':'16')+'px;" '
+'src=\"'+(!completed?this.executingImage:this.completedImage)+'\" />'
+'</div>'
+'</div>';}
buff+="</div>";this.body.dom.innerHTML=buff;if(this.taskType==this.taskTypeMerge){this.fieldManager.fieldTreePanel.invalidateAllCache();MktPage.clearPanelContentValid(this.tabId);MktPage.activatePanel(this.tabId);}
this.updateTitleStatus();if(this.isStopPolling()){this.stopPolling();}else if(isUndefined(this.pollId)){this.startPollStatus();}},getStatus:function(){var parms={};if(this.taskId){parms.taskId=this.taskId;}
MktSession.ajaxRequest(this.url,{serializeParms:parms,onMySuccess:function(){var status=MktPage.appVars.status;this.renderStatus(status);}.createDelegate(this)});},stopPolling:function(){this.stopPollingStatus(this.pollId);this.enableToolbarButtons();},enableToolbarButtons:function(){if(this.fieldManager){this.fieldManager.disableLongRunningActions(false,"Merging in progres");}},isFinish:function(){if(this.taskStatus==this.taskInProcess||this.taskStatus==this.taskQueued){return false;}else{return true;}},isStopPolling:function(){if(this.isFinish()){return true;}else{return false;}}});Mkt.apps.fm.FieldMappingTree=Ext.extend(Ext.tree.ColumnTree,{cls:'x-column-tree mktFilterTree',enableSalesforceFieldTotalCount:false,salesforceFieldTotalFormat:'{0} Salesforce fields',filterFieldWidth:150,filterFieldPosition:'bbar',width:700,rootVisible:false,height:200,enableEditableColumn:true,enableDD:true,containerScroll:true,slowExpandAllNodes:false,filterBranches:true,filterBranchNames:true,autoHeight:false,autoScroll:true,exportFormId:'exportMappingForm',root:new Ext.tree.AsyncTreeNode({text:'Fields'}),fieldUrl:'fieldManagement/getFieldMapping',initComponent:function(){this.loader=new Ext.tree.TreeLoader({dataUrl:this.fieldUrl,uiProviders:{'col':Ext.tree.ColumnNodeUI}});this.on('beforenodedrop',function(dropEvent){var nodeId=dropEvent.source.dragData.node.attributes.id;var destNodeId=dropEvent.target.attributes.id;this.saveMapping(dropEvent.target,dropEvent.source.dragData.node);}.createDelegate(this));this.bbar=this.initBToolbar();Mkt.apps.fm.FieldMappingTree.superclass.initComponent.call(this);if(this.enableEditableColumn){this.initEditor();}
this.createExportMappingForm();this.loader.on('load',function(){MktViewport.showPurpleCorners(true);setTimeout(function(){this.slowlyExpandAllNodes();}.createDelegate(this),1000);}.createDelegate(this));},slowlyExpandAllNodes:function(){if(this.slowExpandAllNodes){var node=this.getFirstCollapsedNode(this.getRootNode());if(node){window.setTimeout(function(){node.expand(false,false,this.slowlyExpandAllNodes.createDelegate(this));}.createDelegate(this),100);}}},getFirstCollapsedNode:function(node){var cs=node.childNodes;for(var i=0,len=cs.length;i<len;i++){if(!cs[i].isExpanded()){return cs[i];}}},initBToolbar:function(){var exportTb=new Ext.Button({text:'Export',tooltip:'Export the fields to excel',iconCls:'buttonIcon mkiExcel',handler:this.exportMapping.createDelegate(this)});var spacer=new Ext.Toolbar.WideSpacer('100%');var sfTotalString=String.format(this.salesforceFieldTotalFormat,this.salesforceFieldTotalCount);var textItem=new Ext.Toolbar.TextItem(sfTotalString);var filter=new Mkt.widgets.FilterTreePanel({layout:'fit',frame:false,baseCls:'x-plain',autoScroll:false,width:270,filterFieldPadding:10});filter.bindTree(this);var tbArr=[exportTb,filter,spacer,textItem];return tbArr;},initEditor:function(){if(isDefined(this.editor)){return;}
var fm=new Ext.form.TextField({allowBlank:true});this.editor=new Ext.Editor(fm,{completeOnEnter:true,hideMode:"display",cls:'x-tree-col-edit',cancelOnEsc:true,autoSize:true,updateEl:true});this.editor.on('complete',this.saveEdit,this);},startEdit:function(e,dom,node){this.editor.nodeId=node.attributes.id;this.editor.startEdit(dom);},saveEdit:function(editor,value,startValue){if(value==startValue){return;}
console.log("Saving new value: "+value+" old value: "+startValue+" for nodeId: "+this.editor.nodeId);MktSession.ajaxRequest('fieldManagement/editDescription',{serializeParms:{id:this.editor.nodeId,newDesc:value}});},resetMapping:function(){MktSession.clockCursor(true);window.setTimeout(function(){Ext.MessageBox.show({title:'Marketo',msg:'Re-syncing fields, please wait...',progressText:'Re-synching...',width:300,modal:true,wait:true,waitConfig:{interval:200}});},0);MktSession.ajaxRequest('fieldManagement/resetMapping',{onMySuccess:this.resetMappingDone.createDelegate(this)});},resetMappingDone:function(){Ext.MessageBox.hide();if(MktPage.appVars.result=="success"){this.getRootNode().reload();}else{MktMessage.showError(MktPage.appVars.errMsg);}},isStandardField:function(node){if(node&&node.attributes.type&&node.attributes.type=="standard"){return true;}else{return false;}},canUnmapFields:function(node,err){var nodeAttr=node.attributes;err.msg="Standard field mapping cannot be broken.";var noMappingToBreak="No mapping to break.";if(nodeAttr.fieldType=="map field"){var parentNode=node.parentNode;if(this.isStandardField(parentNode)){return false;}
if(parentNode.childNodes.length<=1){err.msg=noMappingToBreak;return false;}
for(var i=0;i<parentNode.childNodes.length;i++){if(this.isStandardField(parentNode.childNodes[i])){return false;}}
return true;}else if(nodeAttr.fieldType=="attribute"){if(this.isStandardField(node)){return false;}
if(node.childNodes.length<=1){err.msg=noMappingToBreak;return false;}
for(var i=0;i<node.childNodes.length;i++){if(this.isStandardField(node.childNodes[i])){return false;}}
return true;}
return false;},unmapFields:function(){MktSession.clockCursor(true);var node=this.getSelectionModel().getSelectedNode();var err={};if(this.canUnmapFields(node,err)){if(node){MktSession.ajaxRequest('fieldManagement/unmapFields',{serializeParms:{id:node.id},onMySuccess:this.unmapFieldsDone.createDelegate(this,[node])});}}else{MktMessage.showWarning(err.msg);}},unmapFieldsDone:function(node){var result=MktPage.appVars.result;var newMarketoId=MktPage.appVars.newMarketoId;if(result&&result=="success"){var attr=node.attributes;if(attr.fieldType=="map field"){this.createNewMapping(node,node.parentNode.parentNode,newMarketoId);}else{var childCount=node.childNodes.length;var mapBroken=false;for(var i=0;i<childCount;i++){if(node.childNodes[i].fieldName!=node.attributes.fieldName){this.createNewMapping(node.childNodes[i],node.parentNode,newMarketoId);var mapBroken=true;break;}}
if(!mapBroken&&childCount>1){this.createNewMapping(node.childNodes[0],node.parentNode,newMarketoId);}}}else{MktMessage.showError("Failed umapping the field");}},createNewMapping:function(node,targetParentNode,newMarketoId){var parentNode=node.parentNode;var attr=node.attributes;var newParentNodeAttr={};Ext.apply(newParentNodeAttr,parentNode.attributes);delete newParentNodeAttr.aid;delete newParentNodeAttr.children;newParentNodeAttr.id=newMarketoId;newParentNodeAttr.fieldName=attr.fieldName;newParentNodeAttr.text=attr.fieldName;var newParentNode=new MktTreeNode(newParentNodeAttr);targetParentNode.insertBefore(newParentNode,parentNode.nextSibling);newParentNode.childrenRendered=false;newParentNode.appendChild(node);newParentNode.expand();return newParentNode;},createExportMappingForm:function(){var exportMappingForm=Ext.get(this.exportFormId);if(!exportMappingForm){this.exportMappingForm=Ext.DomHelper.append(Ext.getBody(),{tag:'div',style:'display:none;',html:'<form id="'+this.exportFormId+'" name="'+this.exportFormId+'" action="fieldManagement/exportFieldMapping" method="post" target="exportFieldMappingIFrame">'
+'</form><iframe name="exportFieldMappingIFrame" id="exportFieldMappingIFrame" />'});}},exportMapping:function(){var exportForm=Ext.get(this.exportFormId);if(!exportForm){this.createExportMappingForm();}
MktPage.preventNavAway(false);var exportForm=Ext.getDom(this.exportFormId);if(exportForm){exportForm.submit();}
MktPage.preventNavAway(true);},saveMapping:function(destNode,sourceNode){var sourceOldParent=sourceNode.parentNode;var nodeId=sourceNode.attributes.id;var destNodeId=destNode.attributes.id;MktSession.ajaxRequest('fieldManagement/changeMapping',{serializeParms:{aid:nodeId,newAttribMapId:destNodeId},onMySuccess:this.saveMappingDone.createDelegate(this,[destNode,sourceNode,sourceOldParent])});},saveMappingDone:function(destNode,sourceNode,sourceOldParent){if(MktPage.appVars.result=='success'){if(sourceOldParent.childNodes.length<=0){sourceOldParent.remove();}}else{MktMessage.showWarning(MktPage.appVars.errMsg);sourceOldParent.childrenRendered=false;sourceOldParent.appendChild(sourceNode);sourceOldParent.expand();}},initEvents:function(){if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new Mkt.apps.fm.FieldMappingTreeDropZone(this,this.dropConfig||{appendOnly:this.ddAppendOnly===true});}
Mkt.apps.fm.FieldMappingTree.superclass.initEvents.call(this);}});Mkt.apps.fm.FieldMappingTreeDropZone=Ext.extend(Ext.tree.TreeDropZone,{getDropPoint:function(e,n,dd){var targetNode=n.node;var draggedNode=dd.dragData.node;var dNodeType=draggedNode.attributes.nodeType;var targetAttr=targetNode.attributes;if(targetAttr&&targetAttr.folder===true&&targetNode.childNodes.length<2){if(targetNode.isExpanded()&&targetNode!=draggedNode.parentNode){return'append';}else{targetNode.expand(false);}}}});Mkt.apps.fm.ChangeTypeForm=Ext.extend(Ext.Window,{title:'Change Type',iconCls:'mkiDataEdit',width:350,height:200,resizable:false,layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',defaultValidationErrMsg:"Please select a type and try again.",compatLevelNone:"None",compatLevelPartial:"Partial",compatLevelFull:"Full",compatLevelNoneMsg:"This will <b>destroy</b> values in this field",compatLevelPartialMsg:"This may <b>truncate</b> values in this field",compatLevelMsgTmpl:'<div><div style="float:left;"><img src="/images/icons32/sign_warning.png" style="height:32px; width:32px; padding-right:5px;" /></div><div style="float:left; margin-top: 0;"><span class="mktFailed"><b>Warning:</b> {0}.</span><br />Contact <a href="mailto:support@marketo.com">Marketo support</a> to learn more.</div></div>',initComponent:function(){this.items=this.items||[];this.items.push({html:'Change the type of <b>'+this.fieldName+'</b> from <b>'+this.fieldType+'</b> to:',baseCls:"mkt-modal-text-body",anchor:"100% 30%"});var fields=['datatype','displayName','compatLevel'];var store=new Ext.data.JsonStore({url:'fieldManagement/getCompatibleTypes',root:'data.compatibleDatatypes',baseParams:{aid:this.aid},sortInfo:{field:'displayName',direction:'ASC'},fields:fields});this.fieldTypeText=Mkt.apps.fm.FieldTypeMapping[this.fieldType]||this.fieldType;this.fieldTypeCombo=new Ext.form.ImprovedComboBox({fieldLabel:"Field Type",lazyRender:true,store:store,displayField:'displayName',forceSelection:true,typeAhead:false,validator:this.validateFieldTypeValue.createDelegate(this),triggerAction:'all',selectOnFocus:false,mode:'remote',loadingText:'Loading...',minChars:0,allowBlank:false,name:"fieldType"});this.fieldTypeCombo.on('select',this.onTypeChange.createDelegate(this));this.fieldTypeCombo.on('collapse',function(){this.syncRawValueStore(true);}.createDelegate(this));this.items.push({xtype:"form",anchor:"100% 60%",baseCls:"mkt-modal-text-body",autoHeight:true,width:380,labelWidth:100,items:[this.fieldTypeCombo]});this.msgPanel=new Ext.Panel({html:"",bodyBorder:false,baseCls:"mkt-modal-text-body",style:'margin-top: 15px;'});this.items.push(this.msgPanel);this.buttons=this.buttons||[];this.buttons.push({text:'Change',iconCls:'mkiOk',handler:this.changeTypeSubmit.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.fm.ChangeTypeForm.superclass.initComponent.call(this);},syncRawValueStore:function(markInvalid){if(this.fieldTypeCombo.forceSelection){var selIndex=this.fieldTypeCombo.selectedIndex;var rawValue=this.fieldTypeCombo.getRawValue();if(isDefined(selIndex)){var rec=this.fieldTypeCombo.store.getAt(selIndex);if(rec&&rec.data.displayName==rawValue){return true;}}else{if(this.fieldTypeComboBox.selectByValue(rawValue)){return true;}}
if(markInvalid){return this.fieldTypeCombo.markInvalid('Please select a value from the drop down list');}else{return false;}}
return false;},onTypeChange:function(){if(this.syncRawValueStore(false)===true){var rec=this.fieldTypeCombo.store.getAt(this.fieldTypeCombo.selectedIndex);if(rec&&rec.data&&rec.data.compatLevel){this.setWarningMsg(rec.data.compatLevel);}}},setWarningMsg:function(compatLevel){var msg="";switch(compatLevel){case this.compatLevelNone:msg=this.compatLevelNoneMsg;break;case this.compatLevelPartial:msg=this.compatLevelPartialMsg;break;}
if(this.msgPanel&&this.msgPanel.bwrap){if(msg.length>0){msg=String.format(this.compatLevelMsgTmpl,msg);}
this.msgPanel.bwrap.update(msg);}},changeTypeSubmit:function(){var fieldTypeValid=this.fieldTypeCombo.validate();if(!fieldTypeValid){return;}
var fieldTypeRec=this.fieldTypeCombo.store.getAt(this.fieldTypeCombo.selectedIndex);if(MktPage.appVars.result){delete MktPage.appVars.result;}
var data=fieldTypeRec.data;if(data&&data.datatype){MktSession.ajaxRequest("fieldManagement/changeType",{serializeParms:{aid:this.aid,toType:Ext.encode(data)},onMySuccess:this.changeTypeDone.createDelegate(this,[data.datatype])});}},changeTypeDone:function(type){var errMsg=MktPage.appVars.errMsg;if(MktPage.appVars.result==MktSession.resultSuccess){if(isDefined(this.successCallback)&&isFunction(this.successCallback)){this.successCallback(type);}
this.close();}else if(MktPage.appVars.result==MktSession.resultFailed&&errMsg&&errMsg.length>0){MktMessage.showError(MktPage.appVars.errMsg);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}
if(errMsg){delete MktPage.appVars.errMsg;}},validateFieldTypeValue:function(){if(this.fieldTypeText==this.fieldTypeCombo.getRawValue()&&this.fieldTypeCombo.selectedIndex==-1){return true;}
var defaultMsg="Please select a field type and try again.";var fieldTypeIndex=this.fieldTypeCombo.selectedIndex;if(fieldTypeIndex>=0){var fieldTypeRecord=this.fieldTypeCombo.store.getAt(fieldTypeIndex);if(fieldTypeRecord){if(fieldTypeRecord.data.displayName==this.displayName){return"The new type should not be the same with the current type";}else{return true;}}else{return defaultMsg;}}else{return defaultMsg;}
return true;}});Mkt.apps.fm.CustomFieldForm=Ext.extend(Mkt.widgets.ModalForm,{title:'New Custom Field',minHeight:190,height:220,minWidth:450,width:450,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktCustomFieldForm',iconCls:'mkiDataTable',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:100,fieldRequiredMsg:'This field is required',submitUrl:'leadDatabase/basicCreateCustomFieldSubmit',okText:'Create',okCls:'mkiAdd2',typeField:null,labelField:null,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());Mkt.apps.fm.CustomFieldForm.superclass.initComponent.call(this);},getFields:function()
{var items=[];this.typeField=new Ext.form.ComboBox({fieldLabel:'Type',itemCls:'mktRequired',autoSelect:false,editable:false,allowBlank:false,valueField:'datatype',displayField:'displayName',emptyText:'- Choose -',triggerAction:'all',mode:'remote',store:new Ext.data.JsonStore({idProperty:'datatype',messageProperty:'message',url:'fieldManagement/getDatatypesForCustomField',root:'data.datatypes',fields:['datatype','displayName'],autoDestroy:true,sortInfo:{field:'displayName',direction:'ASC'},listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}})});items.push(this.typeField);this.labelField=new Ext.form.TextField({fieldLabel:'Label',itemCls:'mktRequired',anchor:'-10',allowBlank:false});items.push(this.labelField);return items;},beforeSubmitCallback:function()
{this.typeField.clearInvalid();this.labelField.clearInvalid();var isValid=true;isValid=this.typeField.validate()&&isValid;isValid=this.labelField.validate()&&isValid;return isValid;},okCallback:function()
{this.serializeParms={ldbFieldType:this.typeField.getValue(),ldbFieldLabel:this.labelField.getValue()};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){Mkt.apps.FieldManager.clearFieldTreeCache();MktCanvas.reactivateActiveTab(true);this.close();}}});
/* ========== ../mkt-ext-2.0/menus/FieldManagementMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.fm');Mkt.menus.fm.Toolbar=function(){function toolbarRequestHandler(attr,ret){if(isFunction(Mkt.menus.fm.Toolbar['get'+MktUtil.camelCase(attr.subType)])){ret.comp=Mkt.menus.fm.Toolbar['get'+MktUtil.camelCase(attr.subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('CustAdmin',toolbarRequestHandler);function selectFieldMessage(animEl){MktMessage.showInfo("Please select a field from the right and try again.",undefined,animEl);return false;}
return{fieldManagerKey:'fieldManager',fieldManagerPanelId:'fmFields',getFieldManagement:function(attr){var mItems=[];var buttons=[];var items=[];if(attr.enableFmAdminFeatures){buttons.push(this.newCustomFieldButton(attr));mItems.push(this.newCustomFieldButton(attr));}
mItems.push(this.hideFieldButton(attr));mItems.push(this.blockFieldUpdatesButton(attr));if(attr.enableFmAdminFeatures){if(MktPage.isMarketo()){mItems.push(this.mergeFieldsButton(attr));}
mItems.push(this.changeTypeButton(attr));}
mItems.push(this.exportFieldNameButton(attr));buttons.push(this.exportFieldNameButton(attr));items.push({itemId:'fieldManagement_'+attr.panelId,text:'Field Actions',iconCls:'mkiDataTable',xtype:'mkttbbutton',menuPreShowCb:Ext.emptyFn,menu:mItems});items=items.concat(buttons);return new Ext.Toolbar({items:items});},newCustomFieldButton:function(attr){return{text:'New Custom Field',iconCls:'mkiDataTable',handler:function(btn){var form=new Mkt.apps.fm.CustomFieldForm();form.show(btn.getEl());if(btn.parentMenu){btn.parentMenu.hide();}}};},hideFieldButton:function(attr){return{text:'Hide Field',itemId:'hideField'+MktUtil.camelCase(attr.panelId),iconCls:'mkiGhost',disabled:false,handler:function(btn){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);if(fieldManager){var dbFieldPanel=fieldManager.dbFieldPanel;if(isUndefined(dbFieldPanel)){selectFieldMessage(btn.el);}else{if(!fieldManager.isActionAllowed(fieldManager.fieldActions.hide)){fieldManager.showActionNotAllowed(fieldManager.fieldActions.hide,dbFieldPanel.fieldCategory,btn.el);}
else if(!dbFieldPanel.isCustom){MktMessage.showInfo("The field you are trying to hide is a standard field. Hiding a standard field is prohibited.",undefined,btn.el);}
else if(fieldManager.isFieldInUse()){MktMessage.showInfo("This field is in use. Remove the reference of this field and try again.",undefined,btn.el);}
else if(dbFieldPanel.isHidden){fieldManager.hideField.call(fieldManager,false);}
else{console.debug(arguments,'arguments');MktMessage.confirm('Hide Field','Are you sure you would like to hide <b>'+dbFieldPanel.fieldTitle+"</b> from the user interface?",'Hide',function(){fieldManager.hideField.call(this,true);}.createDelegate(fieldManager),'mkiGhost',btn.getEl());}}}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};},blockFieldUpdatesButton:function(attr){return{text:'Block Field Updates',itemId:'blockFieldUpdates'+MktUtil.camelCase(attr.panelId),iconCls:'mkiSignStop',disabled:false,handler:function(btn){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);if(fieldManager&&fieldManager.dbFieldPanel){if(!fieldManager.isActionAllowed(fieldManager.fieldActions.blockUpdates)){fieldManager.showActionNotAllowed(fieldManager.fieldActions.blockUpdates,fieldManager.dbFieldPanel.fieldCategory,btn.el);}
else{fieldManager.dbFieldPanel.blockUpdatesForm.call(fieldManager.dbFieldPanel,btn.el);}}
else{selectFieldMessage(btn.el);}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};},copyValuesButton:function(attr){return{text:'Copy Values to Another Field',itemId:'copyValues'+MktUtil.camelCase(attr.panelId),iconCls:'mkiAdd2',disabled:false,handler:function(btn,e){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);if(fieldManager){var dbFieldPanel=fieldManager.dbFieldPanel;if(isUndefined(dbFieldPanel)){selectFieldMessage(btn.el);}else{if(!fieldManager.isActionAllowed(fieldManager.fieldActions.copyValues)){fieldManager.showActionNotAllowed(fieldManager.fieldActions.copyValues,fieldManager.dbFieldPanel.fieldCategory,btn.el);}
else{copyFieldValueFormModal=new Mkt.apps.fm.CopyFieldValueFormModal({animateTarget:btn.getEl(),sourceFieldName:dbFieldPanel.fieldTitle,sourceDataType:dbFieldPanel.fieldType,fieldManager:fieldManager,aid:dbFieldPanel.aid});copyFieldValueFormModal.show();}}}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};},mergeFieldsButton:function(attr){return{text:'Merge Fields',itemId:'mergeFields'+MktUtil.camelCase(attr.panelId),iconCls:'mkiData',disabled:false,handler:function(btn,e){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);var dbFieldPanel=fieldManager.dbFieldPanel;if(isUndefined(dbFieldPanel)){selectFieldMessage(btn.el);}
else{if(!fieldManager.isActionAllowed(fieldManager.fieldActions.copyValues)){fieldManager.showActionNotAllowed(fieldManager.fieldActions.copyValues,fieldManager.dbFieldPanel.fieldCategory,btn.el);}
else if(!dbFieldPanel.isCustom){MktMessage.showInfo("The field you are trying to merge is a standard field. Merging a standard field is prohibited",undefined,btn.el);}
else if(fieldManager.isFieldInUse()){MktMessage.showInfo("This field is in use. Remove the reference of this field and try again",undefined,btn.el);}
else if(dbFieldPanel.isHidden){MktMessage.showInfo("The field you are trying to merge is hidden. Merging a hidden field is prohibited",undefined,btn.el);}
else{var mergeFieldFormModal=new Mkt.apps.fm.MergeFieldForm({animateTarget:btn.getEl(),sourceFieldName:fieldManager.dbFieldPanel.fieldTitle,sourceDataType:fieldManager.dbFieldPanel.fieldType,aid:fieldManager.dbFieldPanel.aid,fieldManager:fieldManager});mergeFieldFormModal.show(btn.el);}}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};},changeTypeButton:function(attr){return{text:'Change Type',itemId:'changeType'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataEdit',disabled:false,handler:function(btn){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);var dbFieldPanel=fieldManager.dbFieldPanel;if(isUndefined(dbFieldPanel)){selectFieldMessage(btn.el);}else{if(!fieldManager.isActionAllowed(fieldManager.fieldActions.changeType)){fieldManager.showActionNotAllowed(fieldManager.fieldActions.changeType,fieldManager.dbFieldPanel.fieldCategory,btn.el);}
else{fieldManager.changeType.apply(fieldManager,[btn.el]);}}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};},exportFieldNameButton:function(attr){return{text:'Export Field Names',itemId:'exportFields'+MktUtil.camelCase(attr.panelId),iconCls:'mkiFormYellow',disabled:false,handler:function(){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);if(fieldManager){fieldManager.exportFormProcess();}}.createDelegate(this)};},analyticsOptionsButton:function(attr){return{text:'RCA Field Sync',itemId:'analyticsOptions'+MktUtil.camelCase(attr.panelId),iconCls:'mkiDataNext',disabled:false,handler:function(btn){var fieldManager=MktCanvas.getRegisteredItem(this.fieldManagerKey,this.fieldManagerPanelId);if(fieldManager&&fieldManager.dbFieldPanel){fieldManager.dbFieldPanel.analyticsOptionsSelectedForm.call(fieldManager.dbFieldPanel,btn.el);}else{fieldManager.analyticsOptionsForm.call(fieldManager,btn.el);}
if(btn.parentMenu){btn.parentMenu.hide();}}.createDelegate(this)};}};}();
/* ========== ../mkt-ext-2.0/apps/CampaignSchedule.js ============ */

Ext.ns('Mkt','Mkt.apps','Mkt.apps.campScheduleCons');Mkt.apps.campScheduleCons={STARTDATEPICKER:'startDatePicker',RECURRENCE_TYPE:'recurrence_type',DAILY_EVERY_N_DAYS:'daily_every_n_days',DAILY_TOGGLE:'daily_toggle',SUN:'recurWeeklySun',MON:'recurWeeklyMon',TUE:'recurWeeklyTue',WED:'recurWeeklyWed',THU:'recurWeeklyThu',FRI:'recurWeeklyFri',SAT:'recurWeeklySat',EVERY_N_WEEKS:'weekly_every_n_weeks',MONTHLY_DAY:'day_of_month',EVERY_N_MONTH:'every_n_months',EVERY_N_MONTH_2:'every_n_months_2',MONTHLY_WEEK:'month_week_type',MONTHLY_WEEK_DAY:'month_day_type',MONTHLY_TOGGLE:'mothly_toggle',ENDDATE_TOGGLE:'endDate_toggle',ENDDATEPICKER:'endDatePicker',RUNNOW_TOGGLE:'runNow_toggle',RUNNOWDATEPICKER:'runNowDatePicker',MAX_FUTURE_MSEC:63072000000,TIME_PICKER_MIN_WARNING:'Pick a time at least 5 minutes from the current time',TIME_PICKER_MAX_WARNING:'Pick a date no further then 2 years from today',TIME_PICKER_ENDDATE_WARNING:'End date must be after start date'};Ext.ns('Mkt','Mkt.apps','Mkt.apps.campSchedule');Mkt.apps.campSchedule={win:null,formPanel:null,noneOrRepeat:null,scheduleData:null,scheduleAppVars:null,newScheduleData:null,repeatType:null,formValidationPanel:null,waterMarkMsg:null,clientInitTime:null,custInitTime:null,show:function(scheduleData,scheduleAppVars,animEl){this.scheduleData=scheduleData;this.scheduleAppVars=scheduleAppVars;this.custInitTime=new Date(this.scheduleAppVars.custTime);this.waterMarkMsg=(this.scheduleData.recurrence_type=='')?'Pick a recurrence schedule to run your campaign.':'Any changes made will replace the current recurrence schedule.';var el=Ext.getCmp('weekWarningEl');if(el){el.destroy();delete el;}
this.constructWindow();this.win.show(animEl);MktViewport.unBlackMask();this.updateFormFields(scheduleData);},hide:function(){if(this.win){this.win.hide();}},constructWindow:function(){var winItems=[];winItems.push(this.constructForm());this.win=new Ext.Window({title:'Schedule Recurrence',cls:'mktCampaignSchedule',iconCls:'mkiCalendar31Time',frame:true,modal:true,layout:'form',bodyStyle:'padding: 10px; z-index:20000;',width:550,height:450,resizable:true,items:winItems,buttons:[{text:'Save',iconCls:'mkiOk',handler:function(){Mkt.apps.campSchedule.handleApply();}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){var el=Ext.getCmp('weekWarningEl');if(el){el.destroy();delete el;}
Mkt.apps.campSchedule.hide();}}]});this.win.on('render',function(){window.setTimeout(function(){var el=Ext.get('weekWarningEl');if(el){new Ext.ToolTip({target:el,html:'<div class="weekWarningIcon" style="width: 125px; padding:3px 0 2px 22px; background-position:0 2px;">You must choose at least one week day</div>'});}},2000);});},constructForm:function(){var formItems=[];formItems.push(new Ext.Panel({bodyStyle:Ext.isIE?'margin-bottom: 15px':'margin-top: 7px',html:'<div class="x-form-item">'+this.waterMarkMsg+'</div>'}));formItems.push(this.createRepeat());this.formPanel=new Ext.FormPanel({baseCls:'x-plain',hideBorders:true,labelWidth:85,defaultType:'textfield',items:formItems});MktSession.activeModalForm=this.formPanel;return this.formPanel;},createRepeat:function(){fieldSetType=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,autoScroll:false,hideBorders:true,bodyStyle:'border: 2px',width:550,items:[{baseCls:'x-plain',hideBorders:true,items:this.creatNoneOrRepeatOptions()}]});return fieldSetType;},creatNoneOrRepeatOptions:function(){this.noneOrRepeat=[];var scheduleType=this.createScheduleType();var startDate=this.createStartDate();var dailyPattern=this.createDailyPattern();var weeklyPattern=this.createWeeklyPattern();var monthlyPattern=this.createMonthlyPattern();var endDate=this.createEndDate();this.noneOrRepeat.push(scheduleType);this.noneOrRepeat.push(startDate);this.noneOrRepeat.push(dailyPattern);this.noneOrRepeat.push(weeklyPattern);this.noneOrRepeat.push(monthlyPattern);this.noneOrRepeat.push(endDate);return this.noneOrRepeat;},createScheduleType:function(){var typeComBox=new Ext.form.ComboBox({name:Mkt.apps.campScheduleCons.RECURRENCE_TYPE,store:this.unitData['type'],mode:'local',displayField:'label',fieldLabel:'Schedule',typeAhead:true,width:85,forceSelection:true,triggerAction:'all',selectType:function(field,sel){Mkt.apps.campSchedule.showHideRepeatType(this.getValue());}});typeComBox.on('select',typeComBox.selectType,typeComBox);var scheduleTypeField=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,hidden:false,layout:'form',items:[typeComBox]});this.repeatType=typeComBox;return scheduleTypeField;},createStartDate:function(){var minValue=this.custInitTime.clone();minValue=minValue.clearTime();var startDatePicker=this.createTimePicker('First run',Mkt.apps.campScheduleCons.STARTDATEPICKER,60,minValue,Mkt.apps.campScheduleCons.TIME_PICKER_MIN_WARNING);var startDate=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,layout:'column',hidden:false,items:[{layout:'form',baseCls:'x-plain',width:271,items:startDatePicker},{xtype:'panel',width:40,baseCls:'x-plain',html:'<div class="x-form-item" style="margin-top: 3px;">'+this.scheduleAppVars.timeZone+'</div>'}]});startDate.startDatePicker=startDatePicker;return startDate;},createDailyPattern:function(){var every_n_days=new Ext.form.NumberField({xtype:'numberfield',allowBlank:false,name:Mkt.apps.campScheduleCons.DAILY_EVERY_N_DAYS,width:25});var every_n_days_radio=new Ext.form.Radio({xtype:'radio',labelStyle:'width:77px',fieldLabel:'Repeat every',name:Mkt.apps.campScheduleCons.DAILY_TOGGLE,inputValue:'daily_every_n_days',handler:this.dailyToggle});var every_weekdays_radio=new Ext.form.Radio({xtype:'radio',name:Mkt.apps.campScheduleCons.DAILY_TOGGLE,inputValue:'daily_every_week_days',handler:this.dailyToggle,labelStyle:'width:80px',boxLabel:'Weekday&nbsp;(M-F)'});var dailyPattern=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,hidden:true,layout:'form',items:[{layout:'column',baseCls:'x-plain',items:[{layout:'form',baseCls:'x-plain',items:[every_n_days_radio]},{width:30,items:[every_n_days]},{xtype:'panel',width:40,baseCls:'x-plain',html:'<div class="x-form-item" style="margin-top: 3px;">day(s) </div>'}]},{layout:'column',baseCls:'x-plain',items:[{xtype:'panel',width:90,baseCls:'x-plain',html:'<div >&nbsp;</div>'},{baseCls:'x-plain',items:[every_weekdays_radio]}]}]});dailyPattern.every_n_days_numField=every_n_days;dailyPattern.every_n_days_radio=every_n_days_radio;dailyPattern.every_weekday_radio=every_weekdays_radio;return dailyPattern;},createWeeklyPattern:function(){var every_n_weeks=new Ext.form.NumberField({xtype:'numberfield',fieldLabel:'Repeat every',allowBlank:false,width:25,name:Mkt.apps.campScheduleCons.EVERY_N_WEEKS});var checkBoxes=[];checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Sunday',name:Mkt.apps.campScheduleCons.SUN,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Monday',name:Mkt.apps.campScheduleCons.MON,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Tuesday',name:Mkt.apps.campScheduleCons.TUE,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Wednesday',name:Mkt.apps.campScheduleCons.WED,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Thursday',name:Mkt.apps.campScheduleCons.THU,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Friday',name:Mkt.apps.campScheduleCons.FRI,handler:this.handleWeekDayCheckBox}));checkBoxes.push(new Ext.form.Checkbox({boxLabel:'Saturday',name:Mkt.apps.campScheduleCons.SAT,handler:this.handleWeekDayCheckBox}));var weekdayCheckBoxGroup=new Ext.form.CheckboxGroup({invalidClass:'checkBoxGroupInvalid',width:350,columns:4,clickCheckbox:function(){alert('checkbox clicked');},items:checkBoxes});weekdayCheckBoxGroup.on('click',weekdayCheckBoxGroup.clickCheckbox,weekdayCheckBoxGroup);var weeklyPattern=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,layout:'form',hidden:true,items:[{layout:'column',baseCls:'x-plain',items:[{baseCls:'x-plain',layout:'form',width:124,items:[every_n_weeks]},{xtype:'label',baseCls:'x-plain',html:'<div class="x-form-item" style="margin-top: 3px;">week(s) on: </div>'}]},{layout:'table',baseCls:'x-plain',items:[{xtype:'panel',baseCls:'x-plain',width:89,styles:'align: right;',items:[{id:'weekWarningEl',hidden:true,html:'<div class="weekWarningIcon" style="height: 16px; width: 16px; margin-left: 65px;">&nbsp</div>'}]},{baseCls:'x-plain',width:350,items:weekdayCheckBoxGroup}]}]});weeklyPattern.every_n_weeks_numField=every_n_weeks;weeklyPattern.weekdayCheckBoxGroup=weekdayCheckBoxGroup;weeklyPattern.weekdayCheckBoxes=checkBoxes;return weeklyPattern;},createMonthlyPattern:function(){var dayCombo=new Ext.form.ComboBox({name:Mkt.apps.campScheduleCons.MONTHLY_DAY,store:this.unitData['day'],mode:'local',displayField:'label',allowBlank:false,typeAhead:true,forceSelection:true,width:85,triggerAction:'all'});var numWeekCombo=new Ext.form.ComboBox({name:Mkt.apps.campScheduleCons.MONTHLY_WEEK,store:this.unitData['month_week'],mode:'local',displayField:'label',allowBlank:false,typeAhead:true,forceSelection:true,width:85,triggerAction:'all'});var dayWeekCombo=new Ext.form.ComboBox({name:Mkt.apps.campScheduleCons.MONTHLY_WEEK_DAY,store:this.unitData['day_week'],mode:'local',displayField:'label',allowBlank:false,typeAhead:true,forceSelection:true,width:85,triggerAction:'all'});var every_n_month_numField=new Ext.form.NumberField({xtype:'numberfield',allowBlank:false,width:25,fieldLabel:'Repeat every',name:Mkt.apps.campScheduleCons.EVERY_N_MONTH});var day_month_radio=new Ext.form.Radio({xtype:'radio',labelStyle:'width:77px',fieldLabel:'Repeat on',boxLabel:'Day of month',name:Mkt.apps.campScheduleCons.MONTHLY_TOGGLE,inputValue:'monthly_every_n_months',handler:this.monthToggle});var week_month_radio=new Ext.form.Radio({xtype:'radio',hideLabel:true,boxLabel:'Day of week',name:Mkt.apps.campScheduleCons.MONTHLY_TOGGLE,inputValue:'monthly_week_day',handler:this.monthToggle});var monthlyPattern=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,layout:'form',hidden:false,items:[{layout:'column',baseCls:'x-plain',items:[{layout:'form',width:123,items:every_n_month_numField},{xtype:'label',baseCls:'x-plain',width:80,html:'<div class="x-form-item" style="margin-top: 3px;">month(s)</div>'}]},{layout:'column',baseCls:'x-plain',items:[{baseCls:'x-plain',layout:'form',width:199,items:[day_month_radio]},{width:85,items:dayCombo}]},{layout:'column',baseCls:'x-plain',items:[{xtype:'panel',baseCls:'x-plain',width:89,html:'<div >&nbsp;</div>'},{width:110,xtype:'panel',baseCls:'x-plain',items:[week_month_radio]},{width:89,items:numWeekCombo},{width:85,items:dayWeekCombo}]}]});monthlyPattern.day_month_radio=day_month_radio;monthlyPattern.dayCombo=dayCombo;monthlyPattern.every_n_month_numField=every_n_month_numField;monthlyPattern.week_month_radio=week_month_radio;monthlyPattern.numWeekCombo=numWeekCombo;monthlyPattern.dayWeekCombo=dayWeekCombo;return monthlyPattern;},createEndDate:function(){var minValue=this.custInitTime.clone();var endDatePicker=this.createTimePicker('',Mkt.apps.campScheduleCons.ENDDATEPICKER,24*60,minValue,Mkt.apps.campScheduleCons.TIME_PICKER_ENDDATE_WARNING,true);var endDate_continuous_radio=new Ext.form.Radio({xtype:'radio',name:Mkt.apps.campScheduleCons.ENDDATE_TOGGLE,fieldLabel:'End on',boxLabel:'No end date',inputValue:'onGoing',handler:this.handleEndDateToggle});var endDate_date_radio=new Ext.form.Radio({xtype:'radio',name:Mkt.apps.campScheduleCons.ENDDATE_TOGGLE,inputValue:'endDatePicker',handler:this.handleEndDateToggle});var endDateFieldSet=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,hidden:false,items:[endDate_continuous_radio,{layout:'column',baseCls:'x-plain',items:[{xtype:'panel',width:90,html:'<div >&nbsp;</div>'},endDate_date_radio,{width:91,items:endDatePicker}]}]});endDateFieldSet.endDatePicker=endDatePicker;endDateFieldSet.endDate_continuous_radio=endDate_continuous_radio;endDateFieldSet.endDate_date_radio=endDate_date_radio;return endDateFieldSet;},createTimePicker:function(fl,pName,advanceTime,minValue,minText,hideTime){var time=this.custInitTime;var timeInMil=time.getTime()+(advanceTime*60*1000);var showTime=false;if(hideTime){showTime=true;var endDateTime=time.clone();endDateTime=endDateTime.clearTime();endDateTime=endDateTime.add(Date.DAY,1).add(Date.HOUR,24).add(Date.MINUTE,-1);timeInMil=endDateTime.getTime();}
time=new Date(timeInMil);var options=[];if(!(fl=='')){options['fieldLabel']=fl;}else{options['fieldLabel']=null;}
options['dateValue']=time;options['name']=pName;options['timeWidth']=85;options['disabled']=false;options['timeConfig']={altFormats:'H:i:s',value:time,increment:60,name:pName+'timeField',id:pName+'timeField',hidden:showTime,displayField:'field1',allowBlank:true};options['dateConfig']={altFormats:'Y-m-d|Y-n-d',value:time,vtype:'daterange',minValue:minValue,minText:minText,name:pName+'_dateField',id:pName+'_dateField',allowBlank:true};var dateTime=new Ext.ux.form.DateTime(options);dateTime.on('focus',function(){dateTime.clearInvalid();},dateTime);return dateTime;},getDateTimeFormatedValue:function(dateTimePicker){return dateTimePicker.getValue().format('M d, Y h:i a');},getCurTimeInCustTZInMil:function(){var l_time=new Date();var elapseTime=l_time.getElapsed(this.clientInitTime);return this.custInitTime.getTime()+elapseTime;},handleEndDateToggle:function(item,status){if(item.getGroupValue()=='onGoing'){Mkt.apps.campSchedule.noneOrRepeat[5].endDatePicker.disable();}else{Mkt.apps.campSchedule.noneOrRepeat[5].endDatePicker.enable();}},dailyToggle:function(item,status){if(item.getGroupValue()=='daily_every_n_days'){Mkt.apps.campSchedule.noneOrRepeat[2].every_n_days_numField.enable();}else{Mkt.apps.campSchedule.noneOrRepeat[2].every_n_days_numField.disable();Mkt.apps.campSchedule.noneOrRepeat[2].every_n_days_numField.clearInvalid();}},handleWeekDayCheckBox:function(item,status){if(status){var el=Ext.getCmp('weekWarningEl');if(el){el.setVisible(false);}}},monthToggle:function(item,status){if(item.getGroupValue()=='monthly_every_n_months'){Mkt.apps.campSchedule.noneOrRepeat[4].dayCombo.enable();Mkt.apps.campSchedule.noneOrRepeat[4].numWeekCombo.disable();Mkt.apps.campSchedule.noneOrRepeat[4].numWeekCombo.clearInvalid();Mkt.apps.campSchedule.noneOrRepeat[4].dayWeekCombo.disable();Mkt.apps.campSchedule.noneOrRepeat[4].dayWeekCombo.clearInvalid();}else{Mkt.apps.campSchedule.noneOrRepeat[4].dayCombo.disable();Mkt.apps.campSchedule.noneOrRepeat[4].dayCombo.clearInvalid();Mkt.apps.campSchedule.noneOrRepeat[4].numWeekCombo.enable();Mkt.apps.campSchedule.noneOrRepeat[4].dayWeekCombo.enable();}},unitData:{'type':['None','Daily','Weekly','Monthly'],'day':['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','last day'],'month_week':['first','second','third','fourth'],'day_week':['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']},updateFormFields:function(){this.updateDailyFields();this.updateWeeklyFields();this.updateMonthlyFields();this.updateEndDateFields();this.updateStartFields();this.updateRepeatType();this.showHideRepeatType(this.scheduleData.recurrence_type);this.noneOrRepeat[1].startDatePicker.df.endDateField=this.noneOrRepeat[5].endDatePicker.df;this.noneOrRepeat[1].startDatePicker.clearInvalid();this.noneOrRepeat[5].endDatePicker.clearInvalid();},updateRepeatType:function(){var repeatType=(this.scheduleData.recurrence_type=='')?'None':this.scheduleData.recurrence_type;this.repeatType.setValue(repeatType);},updateDailyFields:function(){if(this.scheduleData.recurrence_type=='Daily'){var isEveryWeekDays=this.scheduleData.every_weekday==''?false:true;if(isEveryWeekDays){this.noneOrRepeat[2].every_n_days_numField.disable();this.noneOrRepeat[2].every_weekday_radio.setValue(true);}else{this.noneOrRepeat[2].every_n_days_numField.enable();this.noneOrRepeat[2].every_n_days_numField.setValue(this.scheduleData.every_n_unit);this.noneOrRepeat[2].every_n_days_radio.setValue(true);}}else{this.noneOrRepeat[2].every_n_days_numField.setValue('1');this.noneOrRepeat[2].every_n_days_radio.setValue(true);}},updateWeeklyFields:function(){if(this.scheduleData.recurrence_type=='Weekly'){this.noneOrRepeat[3].every_n_weeks_numField.setValue(this.scheduleData.every_n_unit);var weekMask=this.scheduleData.week_mask;this.noneOrRepeat[3].weekdayCheckBoxes[0].setValue((weekMask[0]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[1].setValue((weekMask[1]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[2].setValue((weekMask[2]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[3].setValue((weekMask[3]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[4].setValue((weekMask[4]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[5].setValue((weekMask[5]=='1')?true:false);this.noneOrRepeat[3].weekdayCheckBoxes[6].setValue((weekMask[6]=='1')?true:false);}else{this.noneOrRepeat[3].every_n_weeks_numField.setValue('1');this.noneOrRepeat[3].weekdayCheckBoxes[0].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[1].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[2].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[3].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[4].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[5].setValue(false);this.noneOrRepeat[3].weekdayCheckBoxes[6].setValue(false);}},updateMonthlyFields:function(){if(this.scheduleData.recurrence_type=='Monthly'){this.noneOrRepeat[4].every_n_month_numField.setValue(this.scheduleData.every_n_unit);var isDayOfMonthSet=(this.scheduleData.recurDay_of_month=='')?false:true;if(isDayOfMonthSet){this.noneOrRepeat[4].day_month_radio.setValue(true);this.noneOrRepeat[4].dayCombo.setValue((this.scheduleData.recurDay_of_month=='0')?'last day':this.scheduleData.recurDay_of_month);this.noneOrRepeat[4].numWeekCombo.disable();this.noneOrRepeat[4].dayWeekCombo.disable();}else{this.noneOrRepeat[4].dayCombo.disable();this.noneOrRepeat[4].week_month_radio.setValue(true);this.noneOrRepeat[4].numWeekCombo.setValue(this.scheduleData.recurMonth_week_type);this.noneOrRepeat[4].dayWeekCombo.setValue(this.scheduleData.recurMonth_day_type);}}else{this.noneOrRepeat[4].day_month_radio.setValue(true);this.noneOrRepeat[4].dayCombo.setValue('1');this.noneOrRepeat[4].every_n_month_numField.setValue('1');this.noneOrRepeat[4].numWeekCombo.disable();this.noneOrRepeat[4].dayWeekCombo.disable();}},updateEndDateFields:function(){if(this.scheduleData.end_at!=''){var time=new Date(this.scheduleData.end_at);this.noneOrRepeat[5].endDatePicker.enable();this.noneOrRepeat[5].endDatePicker.setValue(time);this.noneOrRepeat[5].endDate_date_radio.setValue(true);}else{this.noneOrRepeat[5].endDatePicker.disable();this.noneOrRepeat[5].endDate_continuous_radio.setValue(true);}},updateStartFields:function(){if(this.scheduleData.start_at!=''){var time=new Date(this.scheduleData.start_at);this.noneOrRepeat[1].startDatePicker.setValue(time);}},showHideRepeatType:function(type){switch(type){case'Daily':this.noneOrRepeat[1].show();this.noneOrRepeat[2].show();this.noneOrRepeat[3].hide();this.noneOrRepeat[4].hide();this.noneOrRepeat[1].startDatePicker.enable();this.enableEndDateFieldset(true);break;case'Weekly':this.noneOrRepeat[1].show();this.noneOrRepeat[2].hide();this.noneOrRepeat[3].show();this.noneOrRepeat[4].hide();this.noneOrRepeat[1].startDatePicker.enable();this.enableEndDateFieldset(true);break;case'Monthly':this.noneOrRepeat[1].show();this.noneOrRepeat[2].hide();this.noneOrRepeat[3].hide();this.noneOrRepeat[4].show();this.noneOrRepeat[1].startDatePicker.enable();this.enableEndDateFieldset(true);break;default:this.noneOrRepeat[1].show();this.noneOrRepeat[2].hide();this.noneOrRepeat[3].hide();this.noneOrRepeat[4].hide();this.noneOrRepeat[1].startDatePicker.disable();this.enableEndDateFieldset(false);break;}
this.formPanel.doLayout();},enableEndDateFieldset:function(isEnable){if(!isEnable){this.noneOrRepeat[5].endDatePicker.disable();this.noneOrRepeat[5].endDate_continuous_radio.disable();this.noneOrRepeat[5].endDate_date_radio.disable();}else{this.noneOrRepeat[5].endDate_date_radio.enable();this.noneOrRepeat[5].endDate_continuous_radio.enable();var isOnGoing=this.noneOrRepeat[5].endDate_continuous_radio.getValue();if(isOnGoing){this.noneOrRepeat[5].endDatePicker.disable();}else{this.noneOrRepeat[5].endDatePicker.enable();}}},handleApply:function(){var nameValue=this.formPanel.getForm().getValues();this.newScheduleData=this.getUpdatedSchedule(nameValue);var isScheduleChanged=this.isScheduleChanged(this.scheduleData,this.newScheduleData);var isValid=true;if(isScheduleChanged){isValid=this.validateForm(nameValue);}else{this.hide();return;}
if(!isValid){return;}
this.newScheduleData.callback=MktMa.applyRecurSchduleDone;MktMa.applyRecurSchedule(undefined,this.newScheduleData);},validateForm:function(){var ret={valid:true,msg:'',invalidItems:[]};var nameValue=this.formPanel.getForm().getValues();var type=nameValue['recurrence_type'];switch(type){case'Daily':ret=this.validateStartAndEndDateField(nameValue);if(!ret.valid){this.validateDailyField(nameValue);}else{ret=this.validateDailyField(nameValue);}
break;case'Weekly':ret=this.validateStartAndEndDateField(nameValue);if(!ret.valid){this.validateWeeklyField(nameValue);}else{ret=this.validateWeeklyField(nameValue);}
break;case'Monthly':ret=this.validateStartAndEndDateField(nameValue);if(!ret.valid){this.validateMonthlyField(nameValue);}else{ret=this.validateMonthlyField(nameValue);}
break;default:break;}
if(!ret.valid){MktSession.setExtWindowFormError('Please correct indicated fields');}
return ret.valid;},validateEndDateField:function(nameValue){var ret={valid:true,msg:''};var isOnGoing=(nameValue[Mkt.apps.campScheduleCons.ENDDATE_TOGGLE]=='onGoing')?true:false;if(!isOnGoing){var selDate=this.noneOrRepeat[5].endDatePicker.getValue().getTime();var startTime=this.noneOrRepeat[1].startDatePicker.getValue().getTime();this.noneOrRepeat[5].endDatePicker.updateValue();ret.valid=this.noneOrRepeat[5].endDatePicker.validate();if(ret.valid){ret.valid=selDate>startTime;}
if(!ret.valid){this.noneOrRepeat[5].endDatePicker.markInvalid(Mkt.apps.campScheduleCons.TIME_PICKER_ENDDATE_WARNING);}else{this.noneOrRepeat[5].endDatePicker.clearInvalid();}}
return ret;},validateStartDateField:function(nameValue){var ret={valid:true,msg:''};var isFarFuture=false;this.noneOrRepeat[1].startDatePicker.updateValue();var selDate=this.noneOrRepeat[1].startDatePicker.getValue().getTime();var curCustTime=this.getCurTimeInCustTZInMil();var furtureTime=curCustTime+(5*60*1000);ret.valid=this.noneOrRepeat[1].startDatePicker.validate();if(ret.valid){ret.valid=selDate>furtureTime;if(selDate>(curCustTime+Mkt.apps.campScheduleCons.MAX_FUTURE_MSEC)){ret.valid=false;isFarFuture=true;}}
if(!ret.valid){if(isFarFuture){this.noneOrRepeat[1].startDatePicker.markInvalid(Mkt.apps.campScheduleCons.TIME_PICKER_MAX_WARNING);}else{this.noneOrRepeat[1].startDatePicker.markInvalid(Mkt.apps.campScheduleCons.TIME_PICKER_MIN_WARNING);}}else{this.noneOrRepeat[1].startDatePicker.clearInvalid();}
return ret;},validateStartAndEndDateField:function(nameValue){var ret=this.validateStartDateField(nameValue);if(!ret.valid){return ret;}
ret=this.validateEndDateField(nameValue);return ret;},validateDailyField:function(nameValue){var ret={valid:true,msg:''};if(nameValue[Mkt.apps.campScheduleCons.DAILY_TOGGLE]=='daily_every_n_days'){ret.valid=this.noneOrRepeat[2].every_n_days_numField.validate();if(!ret.valid){}}
return ret;},validateWeeklyField:function(nameValue){var ret={valid:true,msg:''};var week_mask=this.getWeekMask(nameValue);if(week_mask=='0000000'){ret.valid=false;var el=Ext.getCmp('weekWarningEl');if(el){el.setVisible(true);}}else{ret.valid=this.noneOrRepeat[3].every_n_weeks_numField.validate();}
return ret;},getWeekMask:function(nameValue){var ret='';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.SUN]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.MON]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.TUE]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.WED]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.THU]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.FRI]=='undefined')?'0':'1';ret+=(typeof nameValue[Mkt.apps.campScheduleCons.SAT]=='undefined')?'0':'1';return ret;},validateMonthlyField:function(nameValue){var ret={valid:true,msg:''};ret.valid=this.noneOrRepeat[4].every_n_month_numField.validate();if(nameValue[Mkt.apps.campScheduleCons.MONTHLY_TOGGLE]=='monthly_every_n_months'){if(!ret.valid){this.noneOrRepeat[4].dayCombo.validate();}else{ret.valid=this.noneOrRepeat[4].dayCombo.validate();}}else{if(!ret.valid){this.noneOrRepeat[4].numWeekCombo.validate();}else{ret.valid=this.noneOrRepeat[4].numWeekCombo.validate();}
if(!ret.valid){this.noneOrRepeat[4].dayWeekCombo.validate();}else{ret.valid=this.noneOrRepeat[4].dayWeekCombo.validate();}}
return ret;},getUpdatedSchedule:function(nameValue){var recurrence_type=nameValue[Mkt.apps.campScheduleCons.RECURRENCE_TYPE]=='none'?'':nameValue[Mkt.apps.campScheduleCons.RECURRENCE_TYPE];var every_n_unit='';var isEvery_weekday='';var start_at='';var end_at='';var recurDay_of_month='';var recurMonth_day_type='';var recurMonth_week_type='';if(recurrence_type=='Daily'){every_n_unit=nameValue[Mkt.apps.campScheduleCons.DAILY_EVERY_N_DAYS]||'';isEvery_weekday=(nameValue[Mkt.apps.campScheduleCons.DAILY_TOGGLE]=='daily_every_week_days')?true:'';}else if(recurrence_type=='Weekly'){every_n_unit=nameValue[Mkt.apps.campScheduleCons.EVERY_N_WEEKS]||'';}else if(recurrence_type=='Monthly'){every_n_unit=nameValue[Mkt.apps.campScheduleCons.EVERY_N_MONTH]||'';recurDay_of_month=nameValue[Mkt.apps.campScheduleCons.MONTHLY_DAY]||'';if(recurDay_of_month=='last day'){recurDay_of_month='0'}
recurMonth_day_type=nameValue[Mkt.apps.campScheduleCons.MONTHLY_WEEK_DAY]||'';recurMonth_week_type=nameValue[Mkt.apps.campScheduleCons.MONTHLY_WEEK]||'';}else{every_n_unit='';recurrence_type='';}
if(recurrence_type=='Daily'||recurrence_type=='Weekly'||recurrence_type=='Monthly'){end_at=(nameValue[Mkt.apps.campScheduleCons.ENDDATE_TOGGLE]!='onGoing')?this.getDateTimeFormatedValue(this.noneOrRepeat[5].endDatePicker):'';start_at=this.getDateTimeFormatedValue(this.noneOrRepeat[1].startDatePicker);}
var ret={recurrence_type:recurrence_type,every_n_unit:every_n_unit,start_at:start_at,end_at:end_at,every_weekday:isEvery_weekday,week_mask:this.getWeekMask(nameValue),recurDay_of_month:recurDay_of_month,recurMonth_day_type:recurMonth_day_type,recurMonth_week_type:recurMonth_week_type};return ret;},isScheduleChanged:function(orig,newSche){var ret=false;orig=Ext.apply({},orig);newSche=Ext.apply({},newSche);for(var pName in orig){if(!(orig[pName]==newSche[pName])){ret=true;break;}}
return ret;}};
/* ========== ../mkt-ext-2.0/apps/CampaignScheduleRun.js ============ */

Ext.ns('Mkt','Mkt.apps','Mkt.apps.campScheduleRun');Mkt.apps.campScheduleRun={win:null,formPanel:null,scheduleAppVars:null,runNowDatePicker:null,runNowRadio:null,runNowDatePickerRadio:null,okButton:null,show:function(scheduleAppVars,animEl){Mkt.apps.campSchedule.custInitTime=new Date(MktMa.scheduleAppvars.custTime);this.scheduleAppVars=scheduleAppVars;this.constructWindow();this.win.show(animEl);MktViewport.unBlackMask();this.updateForm();},constructWindow:function(){this.okButton=new Ext.Button({text:'Run',iconCls:'mkiOk',handler:function(){Mkt.apps.campScheduleRun.handleApply();}});this.win=new Ext.Window({title:'Run Once',cls:'mktCampaignSchedule',iconCls:'mkiClockRun',frame:true,modal:true,layout:'fit',bodyStyle:'padding: 10px; z-index:20000;',width:525,height:180,resizable:true,closeAction:'hide',items:this.constructForm(),buttons:[this.okButton,{text:'Cancel',iconCls:'mkiCancel',handler:function(){Mkt.apps.campScheduleRun.hide();}}]});},hide:function(){if(this.win){this.win.hide();}},constructForm:function(){this.runNowRadio=new Ext.form.Radio({xtype:'radio',name:Mkt.apps.campScheduleCons.RUNNOW_TOGGLE,checked:true,inputValue:'run_now',boxLabel:'Run now',handler:this.runNowToggle});this.runNowDatePickerRadio=new Ext.form.Radio({xtype:'radio',name:Mkt.apps.campScheduleCons.RUNNOW_TOGGLE,inputValue:'run_now_date',boxLabel:'Run later',handler:this.runNowToggle});var minValue=Mkt.apps.campSchedule.custInitTime.clone();minValue=minValue.clearTime();this.runNowDatePicker=Mkt.apps.campSchedule.createTimePicker('',Mkt.apps.campScheduleCons.RUNNOWDATEPICKER,20,minValue,Mkt.apps.campScheduleCons.TIME_PICKER_MIN_WARNING);var runTime=new Ext.form.FieldSet({xtype:'fieldset',autoHeight:true,hidden:false,items:[{layout:'column',baseCls:'x-plain',bodyStyle:Ext.isIE?'margin-top: 17px':'margin-top: 5px',items:[{xtype:'panel',baseCls:'x-plain',width:77,html:'&nbsp;'},this.runNowRadio]},{layout:'column',baseCls:'x-plain',items:[{xtype:'panel',width:77,baseCls:'x-plain',html:'<div >&nbsp;</div>'},{baseCls:'x-plain',width:75,items:this.runNowDatePickerRadio},{baseCls:'x-plain',width:179,items:this.runNowDatePicker},{baseCls:'x-plain',html:'<div class="x-form-item" style="margin-top: 3px;">'+this.scheduleAppVars.timeZone+'</div>'}]}]});this.formPanel=new Ext.FormPanel({baseCls:'x-plain',labelWidth:70,hideBorders:true,items:runTime});MktSession.activeModalForm=this.formPanel;return this.formPanel;},runNowToggle:function(item,status){if(Mkt.apps.campScheduleRun.scheduleAppVars.prepareToRun){return;}
if(item.getGroupValue()=='run_now'){Mkt.apps.campScheduleRun.runNowDatePicker.disable();Mkt.apps.campScheduleRun.updateOkButton('Run');}else{Mkt.apps.campScheduleRun.runNowDatePicker.enable();Mkt.apps.campScheduleRun.updateOkButton('Save');}},updateForm:function(){if(this.scheduleAppVars.prepareToRun){this.runNowRadio.setValue(false);this.runNowRadio.disable();this.runNowDatePickerRadio.setValue(true);this.runNowDatePicker.enable();}else{this.runNowDatePicker.disable();}
this.runNowDatePicker.clearInvalid();},updateOkButton:function(dis_label){this.okButton.setText(dis_label);},handleApply:function(){var nameValue=this.formPanel.getForm().getValues();var runNowToggle=nameValue[Mkt.apps.campScheduleCons.RUNNOW_TOGGLE];var parms={callback:function(e){MktSession.clockCursor(false);MktMa.runOnceDone(e);}};if(!(runNowToggle=='run_now')){this.runNowDatePicker.updateValue();if(!this.runNowDatePicker.getValue()||(!this.runNowDatePicker.isValid())){this.runNowDatePicker.isValid(false);MktMessage.showWarning("Invalid date and time.",undefined);return;}
var curCustTime=Mkt.apps.campSchedule.getCurTimeInCustTZInMil();var furtureTime=curCustTime+(5*60*1000);var selDate=this.runNowDatePicker.getValue().getTime();if(selDate<furtureTime){MktSession.setExtWindowFormError(Mkt.apps.campScheduleCons.TIME_PICKER_MIN_WARNING);this.runNowDatePicker.markInvalid(Mkt.apps.campScheduleCons.TIME_PICKER_MIN_WARNING);return;}
parms.selDateTime=Mkt.apps.campSchedule.getDateTimeFormatedValue(this.runNowDatePicker);}
MktMa.runImmediately(undefined,parms);}};
/* ========== ../mkt-ext-2.0/widgets/Portlet.js ============ */

Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:'100%',frame:true,collapsible:true,draggable:true,cls:'x-portlet'});Ext.reg('portlet',Ext.ux.Portlet);
/* ========== ../mkt-ext-2.0/widgets/Portal.js ============ */

Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:'column',autoScroll:true,cls:'x-portal',defaultType:'portalcolumn',initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true});},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig);},beforeDestroy:function(){if(this.dd){this.dd.unreg();}
Ext.ux.Portal.superclass.beforeDestroy.call(this);}});Ext.reg('portal',Ext.ux.Portal);Ext.ux.Portal.DropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig;},ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed};},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid();}
var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw;}else if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid();}
var col=0,xs=this.grid.columnX,cmatch=false;for(var len=xs.length;col<len;col++){if(xy[0]<(xs[col].x+xs[col].w)){cmatch=true;break;}}
if(!cmatch){col--;}
var p,match=false,pos=0,c=portal.items.itemAt(col),items=c.items.items,overSelf=false;for(var len=items.length;pos<len;pos++){p=items[pos];var h=p.el.getHeight();if(h===0){overSelf=true;}
else if((p.el.getY()+(h/2))>xy[1]){match=true;break;}}
pos=(match&&p?pos:c.items.getCount())+(overSelf?-1:0);var overEvent=this.createEvent(dd,e,data,col,c,pos);if(portal.fireEvent('validatedrop',overEvent)!==false&&portal.fireEvent('beforedragover',overEvent)!==false){px.getProxy().setWidth('auto');if(p){px.moveProxy(p.el.dom.parentNode,match?p.el.dom:null);}else{px.moveProxy(c.el.dom,null);}
this.lastPos={c:c,col:col,p:overSelf||(match&&p)?pos:false};this.scrollPos=portal.body.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status;}else{return overEvent.status;}},notifyOut:function(){delete this.grid;},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return;}
var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p,panel=dd.panel,dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&&this.portal.fireEvent('beforedrop',dropEvent)!==false){dd.proxy.getProxy().remove();panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(pos!==false){c.insert(pos,panel);}else{c.add(panel);}
c.doLayout();this.portal.fireEvent('drop',dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st;},10);}}
delete this.lastPos;},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth()});});return box;},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);Ext.ux.Portal.DropZone.superclass.unreg.call(this);}});
/* ========== ../mkt-ext-2.0/widgets/ListPortal.js ============ */

Ext.ux.ListPortal=Ext.extend(Ext.Panel,{layout:'hbox',autoScroll:true,defaultType:'portlet',defaults:{},scrollIncrement:200,scrollThresh:50,portletWidth:200,portletTitleLength:0,initComponent:function(){this.cls='x-portal x-list-portal';var portal=this;Ext.apply(this.defaults,{width:this.portletWidth,titleLength:this.portletTitleLength,draggable:{onInvalidDrop:function(){portal.doLayout();},startDrag:function(){var portletMargins=portal.layoutConfig.defaultMargins?portal.layout.parseMargins(portal.layoutConfig.defaultMargins):portal.layout.parseMargins('0');this.proxy.getProxy().setX(this.proxy.getGhost().getX());this.proxy.getProxy().setTop(portletMargins.top);}}});Ext.ux.ListPortal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true});},listeners:{afterlayout:function(portal){portal.dd=new Ext.ux.ListPortal.DropZone(portal,portal.dropConfig);if(!portal.scrollLengthDiv){portal.scrollLengthDiv=Ext.DomHelper.append(portal.layout.innerCt,{tag:'div',html:'&nbsp;'});}
var portletMargins=portal.layoutConfig.defaultMargins?portal.layout.parseMargins(portal.layoutConfig.defaultMargins):portal.layout.parseMargins('0');var scrollLength=portal.items.length*(portal.portletWidth+portletMargins.left)+portletMargins.left;Ext.DomHelper.applyStyles(portal.scrollLengthDiv,{position:'absolute',top:'0px',width:'1px',height:'1px',left:scrollLength+'px'});}},beforeDestroy:function(){if(this.dd){this.dd.unreg();}
Ext.ux.ListPortal.superclass.beforeDestroy.call(this);}});Ext.reg('listportal',Ext.ux.ListPortal);Ext.ux.ListPortal.DropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.layout.innerCt);Ext.ux.ListPortal.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);this.ddScrollConfig.hthresh=portal.scrollThresh;this.ddScrollConfig.increment=portal.scrollIncrement;portal.layout.innerCt.ddScrollConfig=this.ddScrollConfig;},ddScrollConfig:{vthresh:-1,hthresh:50,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed};},notifyOver:function(dd,e,data){var absoluteMouseXY=e.getXY(),portal=this.portal,px=dd.proxy;var absolutePortalXY=portal.getPosition(false);var relativeMousePosition=absoluteMouseXY[0]-absolutePortalXY[0];var portletMargins=portal.layoutConfig.defaultMargins?portal.layout.parseMargins(portal.layoutConfig.defaultMargins):portal.layout.parseMargins('0');var scrollOffset=portal.layout.innerCt.getScroll().left;var portlets=portal.items
var originalPortletIndex,currentPortletIndex;for(var columnIndex=0;columnIndex<portlets.length;columnIndex++){if(currentPortletIndex==undefined&&relativeMousePosition<(portal.portletWidth+portletMargins.left)*columnIndex+(portal.portletWidth+portletMargins.left)-scrollOffset+portletMargins.left/2){currentPortletIndex=columnIndex;}
if(originalPortletIndex==undefined&&portlets.itemAt(columnIndex).id==data.panel.id){originalPortletIndex=columnIndex;}}
if(currentPortletIndex==undefined){currentPortletIndex=portlets.length-1;}
if(originalPortletIndex==undefined){originalPortletIndex=portlets.length-1;}
var mousedOverPortlet=portal.items.itemAt(currentPortletIndex);var overEvent=this.createEvent(dd,e,data,currentPortletIndex,mousedOverPortlet,pos);if(portal.fireEvent('validatedrop',overEvent)!==false&&portal.fireEvent('beforedragover',overEvent)!==false){px.moveProxy(mousedOverPortlet.el.dom.parentNode,mousedOverPortlet.el.dom);var topMargin=portletMargins.top;var leftMargin=portletMargins.left;var portletX=leftMargin;if(!this.lastPos||this.lastPos.currentPortletIndex!=currentPortletIndex){for(var pos=0;pos<portlets.length;pos++){var portlet=portal.items.itemAt(pos);if(currentPortletIndex>originalPortletIndex){if(pos>originalPortletIndex&&pos<=currentPortletIndex){portlet.setPosition(portletX-(portal.portletWidth+leftMargin),topMargin);}
else{portlet.setPosition(portletX,topMargin);}}
else if(currentPortletIndex<originalPortletIndex){if(pos<originalPortletIndex&&pos>=currentPortletIndex){portlet.setPosition(portletX+(portal.portletWidth+leftMargin),topMargin);}
else{portlet.setPosition(portletX,topMargin);}}
else{portlet.setPosition(portletX,topMargin);}
if(currentPortletIndex==pos&&(!this.lastPos||this.lastPos.currentPortletIndex!=currentPortletIndex)){px.getProxy().setX(portletX+absolutePortalXY[0]-scrollOffset);px.getProxy().setTop(topMargin);}
portletX+=portal.portletWidth+leftMargin;}}
this.lastPos={portal:portal,currentPortletIndex:currentPortletIndex};this.scrollPos=portal.layout.innerCt.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status;}else{return overEvent.status;}},notifyOut:function(){},notifyDrop:function(dd,e,data){if(!this.lastPos){return;}
var portal=this.lastPos.portal,currentPortletIndex=this.lastPos.currentPortletIndex,panel=dd.panel,dropEvent=this.createEvent(dd,e,data,currentPortletIndex,portal,currentPortletIndex!==false?currentPortletIndex:portal.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&&this.portal.fireEvent('beforedrop',dropEvent)!==false){dd.proxy.getProxy().remove();panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(currentPortletIndex!==false){portal.insert(currentPortletIndex,panel);}else{portal.add(panel);}
portal.doLayout();this.portal.fireEvent('drop',dropEvent);var scrollOffset=this.scrollPos.left;if(scrollOffset){var d=this.portal.layout.innerCt.dom;setTimeout(function(){d.scrollLeft=scrollOffset;},10);}}
delete this.lastPos;},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.layout.innerCt);Ext.ux.ListPortal.DropZone.superclass.unreg.call(this);}});
/* ========== ../mkt-ext-2.0/widgets/MktPortal.js ============ */

Ext.namespace('Mkt','Mkt.widgets','Mkt.widgets.portal');Mkt.widgets.portal.MktPortlet=function(config){Mkt.widgets.portal.MktPortlet.superclass.constructor.call(this,config);};Ext.extend(Mkt.widgets.portal.MktPortlet,Ext.ux.Portlet,{cls:'portlet_mkt'});Mkt.widgets.portal.SmartCampaignTreePanel=Ext.extend(Ext.tree.TreePanel,{cls:'mktTree mktTreeBox',loadMask:true,maskDisabled:false,selModel:new MktExplorerSelectionModel(),rootVisible:false,loader:new MktTreeLoader({uiProvider:MktTreeNodeUI,dataUrl:"/folder/getTreeNodes"}),listeners:{contextmenu:function(node,e){if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.type){var nodeType=node.attributes.xtra.type;if(nodeType=='Landing'){MktDsMenu.showContextMenu(node,e);}
else if(nodeType=='MA'){MktMaMenu.showContextMenu(node,e);}
else if(nodeType=='LeadDb'){MktLeadDbMenu.showContextMenu(node,e);}}},click:function(node,e){if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.type){var xtraAttr=node.attributes.xtra;MktDlManager.loadDl(xtraAttr);}}}});Mkt.widgets.portal.SmartCampaignPortlet=function(config){Mkt.widgets.portal.SmartCampaignPortlet.superclass.constructor.call(this,config);};Mkt.widgets.portal.SmartCampaignPortlet.constants={};(function(){Mkt.widgets.portal.SmartCampaignPortlet.constants['STATUS']={'DEFAULT':0,'BAT':1,'BAT_RAN':2,'BAT_SCHEDULED':3,'BAT_SCHEDULED_WARN':4,'BAT_REPEAT':5,'TRG_INACTIVE':6,'TRG_ACTIVE':7,'TRG_ACTIVE_WARN':8,'UI_STATUS_TRG_ACTIVE_REQUESTED':9};var status=Mkt.widgets.portal.SmartCampaignPortlet.constants.STATUS;Mkt.widgets.portal.SmartCampaignPortlet.constants['STATUS_MAPPING']=[];var statusMapping=Mkt.widgets.portal.SmartCampaignPortlet.constants.STATUS_MAPPING;statusMapping[status.DEFAULT]='default';statusMapping[status.BAT]='batch';statusMapping[status.BAT_RAN]='batch_ran';statusMapping[status.BAT_SCHEDULED]='batch_scheduled';statusMapping[status.BAT_SCHEDULED_WARN]='batch_warning';statusMapping[status.BAT_REPEAT]='batch_repeat';statusMapping[status.TRG_INACTIVE]='trigger_inactive';statusMapping[status.TRG_ACTIVE]='trigger_active';statusMapping[status.TRG_ACTIVE_WARN]='trigger_warning';statusMapping[status.UI_STATUS_TRG_ACTIVE_REQUESTED]='trigger_requested';})();Ext.extend(Mkt.widgets.portal.SmartCampaignPortlet,Mkt.widgets.portal.MktPortlet,{detailsTemplate:new Ext.XTemplate('<b>Name:</b> {name}<br/><b>Description:</b> {description}'),iconCls:'placeholder',tools:[{id:'refreshProgress'}],titleLength:0,updating:false,bodyCssClass:'mktPortletWatermark',dataRoot:'smartCampaignMeta',dataId:null,dataUrl:null,dataFields:[{name:'compId',type:'int'},'name','description','compType',{name:'compTypeId',type:'int'},{name:'status',type:'int'},'tree'],initComponent:function(){this.cls=(this.cls||'')+' portlet_smartcampaign';var smartCampaignMeta=this.smartCampaignMetaData;this.id='sc_portlet_'+smartCampaignMeta.compId;this.treePanel=new Mkt.widgets.portal.SmartCampaignTreePanel();this.treePanel.setRootNode(new Ext.tree.TreeNode({hidden:true}));this.items=[this.treePanel];this.dataStore=this.createDataStore();var initialData={};initialData[this.dataRoot]=[smartCampaignMeta];this.updatePortlet(initialData);Mkt.widgets.portal.SmartCampaignPortlet.superclass.initComponent.call(this);},createDataStore:function(){var portlet=this;var loadHandler=function(store,records){portlet.refreshPortlet();};var dataStore=new Ext.data.JsonStore({autoLoad:false,autoSave:false,fields:this.dataFields,idProperty:this.dataId,root:this.dataRoot,url:this.dataUrl});dataStore.addListener('load',loadHandler);return dataStore;},listeners:{afterlayout:function(panel){Ext.QuickTips.register({target:panel.header,text:panel.getDetailsText()});panel.setProgress(panel.updating);},render:function(panel){var header=panel.header;header.addListener('contextmenu',function(e){if(panel.treePanel&&panel.treePanel.getRootNode()){var treeRoot=panel.treePanel.getRootNode();if(treeRoot.firstChild){MktMaMenu.showContextMenu(treeRoot.firstChild,e);}}});}},getDetailsText:function(){var dataRecord=this.dataStore.getAt(0);var parameters={name:Ext.util.Format.htmlEncode(dataRecord.get('name')),description:Ext.util.Format.htmlEncode(dataRecord.get('description'))};return this.detailsTemplate.apply(parameters);},setProgress:function(inProgress){this.updating=inProgress;var refreshButton=this.getTool('refreshProgress');if(refreshButton){if(inProgress){refreshButton.addClass('inProgress');}
else{refreshButton.removeClass('inProgress');}}},updatePortlet:function(newMetaData){if(newMetaData){this.dataStore.loadData(newMetaData,false);}
else{this.dataStore.reload();}},refreshPortlet:function(){var smartCampaignPortlet=Mkt.widgets.portal.SmartCampaignPortlet;var dataRecord=this.dataStore.getAt(0);var allStatusClasses=smartCampaignPortlet.constants.STATUS_MAPPING.join(' ');this.removeClass(allStatusClasses);this.addClass('mkt_sc_'+smartCampaignPortlet.constants.STATUS_MAPPING[dataRecord.get('status')]);var portletTitle=dataRecord.get('name');if(this.titleLength>0){portletTitle=Ext.util.Format.ellipsis(portletTitle,this.titleLength,true);}
this.setTitle(Ext.util.Format.htmlEncode(portletTitle));var treeData=dataRecord.get('tree');if(treeData&&this.treePanel){var root=new Ext.tree.AsyncTreeNode({text:'root',id:'root',cls:'folder',leaf:false,expanded:true,expandable:false,children:treeData});this.treePanel.setRootNode(root);}},replaceNodes:function(nodeJsons){if(this.treePanel){var laConstant=Mkt.apps.localasset.Constants;Mkt.apps.localasset.TreeActions.replaceNodes(nodeJsons,this.treePanel,{trimLength:33,idSuffix:laConstant.SUFFIX_SMARTLIST});Mkt.apps.localasset.TreeActions.replaceNodes(nodeJsons,this.treePanel,{trimLength:33,idSuffix:laConstant.SUFFIX_FLOW});}},removeNodes:function(nodeIds){if(this.treePanel){var laConstant=Mkt.apps.localasset.Constants;Mkt.apps.localasset.TreeActions.removeNodes(nodeIds,this.treePanel,{idSuffix:laConstant.SUFFIX_SMARTLIST});Mkt.apps.localasset.TreeActions.removeNodes(nodeIds,this.treePanel,{idSuffix:laConstant.SUFFIX_FLOW});}}});Ext.reg('portlet_smartcampaign',Mkt.widgets.portal.SmartCampaignPortlet);
/* ========== ../mkt-ext-2.0/apps/CustomTokens.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.customtoken');Mkt.apps.customtoken.SOURCE_LOCAL=1;Mkt.apps.customtoken.SOURCE_OVERRIDDEN=2;Mkt.apps.customtoken.SOURCE_INHERITED=3;Mkt.apps.customtoken.menuItems={deleteMenu:{text:'Delete Token',itemId:'deleteCustomToken',iconCls:'mkiDelete2',disabled:true,handler:function(el){var grid=Mkt.apps.customtoken.globalGrid;var record=grid.getSelectionModel().getSelected();grid.rowEditor.stopEditing(false);Mkt.apps.customtoken.Actions.deleteToken(record.data.id,record.data.token,grid,el);}},editMenu:{text:'Edit Token',itemId:'editCustomToken',iconCls:'mkiPencil',disabled:true,handler:function(el){var grid=Mkt.apps.customtoken.globalGrid;var selectedIndex=grid.getSelectionModel().getSelectedIndex();grid.rowEditor.startEditing(selectedIndex);}}};Mkt.apps.customtoken.setEnabledMenuItems=function(items,record){if(!items||!record.data.source){return;}
items.get('editCustomToken').setDisabled(record.phantom);switch(record.data.source){case Mkt.apps.customtoken.SOURCE_LOCAL:break;case Mkt.apps.customtoken.SOURCE_OVERRIDDEN:break;case Mkt.apps.customtoken.SOURCE_INHERITED:break;}};Mkt.apps.customtoken.Actions={deleteToken:function(tokenId,name,grid,animEl){MktMessage.confirmDelete('Delete Token','Are you sure you want to delete <b>'+name+'</b>?',function(){var params={tokenId:tokenId,nodeId:grid.nodeId};MktSession.clockCursor();MktSession.ajaxRequest('folder/deleteTokenData',{serializeParms:params,onMySuccess:this.deleteTokenDone.createDelegate(this,[grid])});}.createDelegate(this),animEl);},deleteTokenDone:function(grid){grid.loadPagedGrid();}};Mkt.apps.customtoken.createRowEditor=function(){var cancelEdit=function(rowEditor){if(rowEditor.record.data.id==null&&rowEditor.record.data.source==Mkt.apps.customtoken.SOURCE_LOCAL){rowEditor.grid.store.remove(rowEditor.record);}
else{rowEditor.grid.getStore().rejectChanges();}
rowEditor.grid.getView().refresh();rowEditor.grid.showEmptyMsg();rowEditor.grid.getView().toggleGroup=MktGrids.GroupingView.prototype.toggleGroup;};var beforeEdit=function(rowEditor){if(rowEditor.editing&&rowEditor.record&&(rowEditor.record.get('isNew')==true)){rowEditor.showTooltip(rowEditor.commitChangesText);rowEditor.persistTooltip=true;return false;}
rowEditor.grid.getView().toggleGroup=Ext.emptyFn;};var afterEdit=function(rowEditor){rowEditor.grid.getView().toggleGroup=MktGrids.GroupingView.prototype.toggleGroup;};var afterChanges=function(rowEditor,changes,record){if(record.data[rowEditor.grid.metaDataProperty].value.dataDesc=='richTextModal'){if(!record.dirty){record.markDirty();}}};var rowEditor=new MktGrids.RowEditor({clicksToEdit:2,forceSave:true,lazyDismiss:true,listeners:{'canceledit':cancelEdit,'beforeedit':beforeEdit,'afteredit':afterEdit,'afterchanges':afterChanges},getCustomGridValue:function(rowEditor,val,cm,colIndex,record){var columnId=cm.getColumnId(colIndex);var column=cm.getColumnById(columnId);if(columnId=='value'&&record.data[rowEditor.grid.metaDataProperty].value.dataDesc=='richTextModal'){val="<div class='clickable'> Click to Edit</div>";}
if(columnId=='type'||columnId=='source'){val=column.renderer.call(column,val,{},record);}
return val;}});return rowEditor;};Mkt.apps.customtoken.TokenGridPanel=function(config){this.rowEditor=Mkt.apps.customtoken.createRowEditor();this.plugins=this.rowEditor;this.Json2StoreConverter_value=function(v,record){if(record.dataType=='date'){return new Date.parseDate(record.value,"Y-m-d");}
else{return v;}};Mkt.apps.customtoken.TokenGridPanel.superclass.constructor.call(this,config);};Ext.extend(Mkt.apps.customtoken.TokenGridPanel,MktGrids.CanvasGridPanel,{isEditor:true,editable:false,layout:'fit',enableTotal:true,searchEmptyText:'Quick Find...',searchQtip:'Search for tokens.',listeners:{'beforeedit':function(editObj){editObj.cancel=true},'headerclick':function(grid){grid.rowEditor.stopEditing.defer(1,grid.rowEditor,[false]);},'headercontextmenu':function(grid){grid.rowEditor.stopEditing.defer(1,grid.rowEditor,[false]);}},recordLoaded:function(){return true},beforeLoadMaskMsg:'Loading tokens...',afterLoadMaskMsg:'Loading {0} tokens...',pagingEmptyMsg:'Drag new tokens from the right',autoExpandColumn:'value',defaultSort:'token',defaultOrder:'ASC',metaDataProperty:'__mkt_col_meta',sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tokenFields:[{name:'id'},{name:'dataType'},{name:'token'},{name:'source'},{name:'updatedAt'}],initComponent:function(){this.id='tokenGrid_'+this.nodeId;this.tokenFields.push({name:this.metaDataProperty});this.tokenFields.push({name:'value',convert:this.Json2StoreConverter_value});this.TokenRecord=Ext.data.Record.create(this.tokenFields);this.ds=this.createDataStore(this.rowEditor);this.cm=this.createColumnModel(this.ds);this.view=this.createGroupView();Mkt.apps.customtoken.TokenGridPanel.superclass.initComponent.call(this);},showRichTextEditor:function(record){if(!tinymce.dom.Event.domLoaded){tinymce.dom.Event._pageInit(window);}
MktSession.unclockCursor();new Mkt.apps.emaileditor.RichTextEditor({saveCallback:function(ed,content){record.set('value',content);}}).show(record.data.value);},_onClickShowModal:function(event,el){var scripts=['/mkt-ext-2.0/apps/EmailEditor.js','/js/tinymce_3_3_9/jscripts/tiny_mce/tiny_mce_src.js'];var isLoadedFn=function(){return Mkt.apps.emaileditor&&typeof tinymce!="undefined";};MktSession.clockCursor();MktUtil.loadScripts(scripts,isLoadedFn,this.showRichTextEditor.createDelegate(this,[this.rowEditor.record]));},createGroupView:function(){var groupView=new MktGrids.GroupingView({groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Tokens" : "Tokens"]})',showGroupName:false,hideGroupedColumn:true,grid:this,enableNoGroups:false,enableGroupingMenu:false,listeners:{beforerefresh:function(view){var numRows=view.grid.getStore().getCount();var gridHead=view.grid.getGridEl().child('div[class=x-grid3-header]');var gridScroller=view.grid.getView().scroller;var bottomToolbar=view.grid.getBottomToolbar();if(numRows==0){if(view.grid.ownerCt){view.grid.ownerCt.addClass("emptyGridOutline");}
gridScroller.removeClass("nestedGridSidewall");bottomToolbar.hide();gridHead.hide();}
else if(!gridScroller.hasClass("nestedGridSidewall")){if(view.grid.ownerCt){view.grid.ownerCt.removeClass("emptyGridOutline");}
gridScroller.addClass("nestedGridSidewall");bottomToolbar.show();gridHead.show();}}}});return groupView;},createColumnModel:function(dataStore){var extraConfig=function(column,rec,columnStoreMeta){var extraFieldConfig={allowBlank:false,msgTarget:'customTokenNoExist'};if(column.id=='value'&&columnStoreMeta.dataDesc=='integer'){Ext.apply(extraFieldConfig,{minValue:0,maxLength:8});}
if(column.id=='value'&&columnStoreMeta.dataDesc=='date'){Ext.apply(extraFieldConfig,{editable:false});}
if(column.id=='value'&&rec.data.dataType=='duration'){Ext.apply(extraFieldConfig,{emptyText:Mkt.widgets.DataPanelConstants.DATATYPES.duration.emptyText});}
if(column.id=='value'&&columnStoreMeta.dataDesc=='richTextModal'){Ext.apply(extraFieldConfig,{cls:'offset-right',listeners:{render:function(field){field.el.on('click',this._onClickShowModal,this);}.createDelegate(this)}});}
if(column.id=='value'&&rec.data.dataType=='sfdc campaign'){var sfdcAutoConfig=this.autosuggestConfig.sfdcCampaign;var sfdcStore=new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/explorer/autosuggest',root:'suggest',fields:['val'],id:'val',baseParams:{accessZoneId:MktCanvas.getActiveTab().config.accessZoneId,aid:sfdcAutoConfig.aid,atid:sfdcAutoConfig.atid,dataIndex:'val',displayField:'val'}});Ext.apply(extraFieldConfig,{store:sfdcStore,displayField:'val',valueField:'val',typeAhead:true,triggerAction:'all',forceSelection:true});}
return extraFieldConfig;}.createDelegate(this);var cm=new MktGrids.FlexibleColumnModel({getExtraFieldConfig:extraConfig,metaDataProperty:this.metaDataProperty,columns:[{header:'Type',id:'type',width:40,dataIndex:'dataType',editable:false,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){var cssClass='';switch(value){case"text":cssClass="mkiWindowFont";break;case"number":cssClass="mkiCalculator";break;case"sfdc campaign":cssClass="mkiCustSalesforce";break;case"date":cssClass="mkiCalendar";break;case"rich text":cssClass="mkiCodeC";break;case"duration":cssClass="mkiClock";break;}
return'<div class="'+cssClass+' mki16" style="float: none; margin: 0px auto;">&nbsp;</div>';}},{header:'Source',id:'source',hidden:true,hideable:false,dataIndex:'source',renderer:function(value,metaData,record,rowIndex,colIndex,store){switch(value){case Mkt.apps.customtoken.SOURCE_LOCAL:value='Local';break;case Mkt.apps.customtoken.SOURCE_OVERRIDDEN:value='Overridden';break;case Mkt.apps.customtoken.SOURCE_INHERITED:value='Inherited';break;}
return value;}},{id:'token',header:'Token Name',dataIndex:'token',width:250,sortable:true,editable:true,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){metaData.attr="onClick='MktUtil.selectTextByElement(this);'";metaData.css="mktSelectable";return Ext.util.Format.htmlEncode("{{my."+value+"}}");}},{id:'value',header:'Value',dataIndex:'value',editable:true,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){switch(record.get("dataType")){case"date":value=value.format(Ext.util.Format.longDateFormat);break;case"rich text":value="Double Click for Details";break;}
return Ext.util.Format.htmlEncode(value);}},{id:'updatedAt',header:'Updated',dataIndex:'updatedAt',width:150,sortable:true,editable:true,editor:{xtype:'displayfield',readOnly:true,cls:'offset-right'},groupable:false}]},dataStore);return cm;},createDataStore:function(rowEditor){var writer=new Ext.data.JsonWriter({encode:true,writeAllFields:true});var reader=new Ext.data.JsonReader({root:'data',idProperty:'id',successProperty:'success',messageProperty:'errors',fields:this.tokenFields});var httpProxyWriteAndErrorHandler=function(proxy,response,record){MktSession.unclockCursor();if(!rowEditor.rendered){rowEditor.grid.getView().toggleGroup=MktGrids.GroupingView.prototype.toggleGroup;return;}
if(response.success){rowEditor.editing=false;rowEditor.hide();rowEditor.grid.getView().toggleGroup=MktGrids.GroupingView.prototype.toggleGroup;if(record.data.source!=response.data[0].source){rowEditor.grid.store.reload();}
else{var sortee=rowEditor.grid.store.getSortState();rowEditor.grid.store.sort(sortee.field,sortee.direction);}}
else{rowEditor.grid.getStore().rejectChanges();rowEditor.showTooltip(rowEditor.formatTooltipErrors(response.message));}
rowEditor.persistTooltip=!response.success;};var writeCallback=function(proxy,action,data,response,rs,options){httpProxyWriteAndErrorHandler(proxy,response,rs);};var writeCallbackException=function(proxy,type,action,options,response){if(type==='response'){response.success=false;this.fireEvent('loadexception',proxy,reader,response);}
httpProxyWriteAndErrorHandler(proxy,response);};var beforeWriteCallback=function(proxy,action,rs){MktSession.clockCursor();};var proxy=new Ext.data.HttpProxy({api:{read:'/folder/getTokenData',create:'/folder/createTokenData',update:'/folder/updateTokenData',destroy:'/folder/deleteTokenData'},listeners:{exception:writeCallbackException,write:writeCallback,beforeWrite:beforeWriteCallback}});var ds=new Ext.data.GroupingStore({proxy:proxy,writer:writer,reader:reader,sortInfo:{field:'token',direction:"ASC"},groupField:'source',baseParams:{nodeId:this.nodeId},remoteSort:false,autoSave:false});return ds;}});Mkt.apps.customtoken.TokenPaletteManager=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager mktTokenPaletteManager mktFullCanvasGrid',baseCls:'',layout:'border',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,paletteWidth:200,fieldTreeUrl:'explorer/getTokenTypes',lastNodeClicked:null,initComponent:function(){this.items=this.items||[];Mkt.apps.customtoken.TokenPaletteManager.superclass.initComponent.call(this);new Ext.tree.TreeSorter(this.fieldTreePanel,{dir:"asc"});this.fieldPanel.on('render',function(grid){grid.dropZone=new Ext.dd.DropZone(grid.getView().scroller,{ddGroup:'layoutDesigner',onNodeDrop:function(target,dd,e,data){if(grid.rowEditor.editing){return;}
var xtraConfig=data.node.attributes.xtra;var newDataType=xtraConfig.dataType;var newDataDesc=xtraConfig.dataDesc;var value=null;switch(xtraConfig.dataType){case"date":value=new Date();break;}
var e=new grid.TokenRecord({isNew:true,id:null,dataType:newDataType,token:MktUtil.uniqueName('My Token',grid.store,'token',true,' '),value:value,source:Mkt.apps.customtoken.SOURCE_LOCAL,__mkt_col_meta:{token:{editable:true},value:{editable:true,dataDesc:newDataDesc}}});grid.rowEditor.stopEditing(false);grid.store.insert(0,e);grid.getView().refresh();grid.getSelectionModel().selectRow(0);grid.rowEditor.startEditing(0);grid.getView().scrollToTop();},onNodeOver:function(target,dd,e,data){if(data.node.attributes.xtra.dataType&&!grid.rowEditor.editing){return Ext.dd.DropZone.prototype.dropAllowed;}},getTargetFromEvent:function(e){return e.getTarget();}});});this.fieldPanel.on('beforedestroy',function(comp){this.dropZone.unreg();});},buildCenterComponents:function(){return this.fieldPanel;}});
/* ========== ../mkt-ext-2.0/apps/MarketingProgramSettings.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.marketingprogramsettings');Mkt.apps.marketingprogramsettings.TYPE_COST_PERIOD='period';Mkt.apps.marketingprogramsettings.TYPE_DESCRIPTOR_CHANNEL='channel';Mkt.apps.marketingprogramsettings.TYPE_DESCRIPTOR='descriptor';Mkt.apps.marketingprogramsettings.TYPE_CALENDAR='calendar';Mkt.apps.marketingprogramsettings.GROUP_COST='cost';Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS='descriptors';Mkt.apps.marketingprogramsettings.GROUP_CALENDAR='calendar';Mkt.apps.marketingprogramsettings.currencyFormat="";Mkt.apps.marketingprogramsettings.currencySymbol="";Mkt.apps.marketingprogramsettings.currencyIso="";Mkt.apps.marketingprogramsettings.menuItems={deleteMenu:{text:'Delete',itemId:'deleteItem',iconCls:'mkiDelete2',disabled:true,handler:function(el){var grid=Mkt.apps.marketingprogramsettings.globalGrid;var records=grid.getSelectionModel().getSelections();var costsToDelete=[],descriptorsToDelete=[],calendarsToDelete=[];for(var i=0,l=records.length;i<l;i++){var record=records[i];switch(record.data.itemGroup){case Mkt.apps.marketingprogramsettings.GROUP_COST:costsToDelete.push(record.id);break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:descriptorsToDelete.push(parseInt(record.id.replace(/[^0-9]+/gi,'')));break;case Mkt.apps.marketingprogramsettings.GROUP_CALENDAR:calendarsToDelete.push(parseInt(record.id.replace(/[^0-9]+/gi,'')));break;}}
if(costsToDelete.length>0){Mkt.apps.marketingprogramsettings.Actions.deleteCost(grid.compId,costsToDelete,grid,el);}
if(descriptorsToDelete.length>0){Mkt.apps.marketingprogramsettings.Actions.deleteDescriptor(grid.compId,descriptorsToDelete,grid,el);}
if(calendarsToDelete.length>0){Mkt.apps.marketingprogramsettings.Actions.deleteCalendar(grid.compId,calendarsToDelete,grid,el);}}},editMenu:{text:'Edit',itemId:'editItem',iconCls:'mkiPencil',disabled:true,handler:function(el){var grid=Mkt.apps.marketingprogramsettings.globalGrid;var record=grid.getSelectionModel().getSelected();switch(record.data.itemGroup){case Mkt.apps.marketingprogramsettings.GROUP_COST:Mkt.apps.marketingprogramsettings.Actions.editCost(grid.compId,record.data,grid,el);break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:Mkt.apps.marketingprogramsettings.Actions.editDescriptor(grid.compId,record.json,grid,el);break;}}}};Mkt.apps.marketingprogramsettings.setEnabledMenuItems=function(items,records)
{if(!items){return;}
var selectedCount=records?records.length:0,selectedCostsCount=0,selectedDescriptorsCount=0,selectedRequiredDescriptorsCount=0,selectedCalendarsCount=0;for(var i=0;i<selectedCount;i++){var record=records[i];switch(record.get('itemGroup')){case Mkt.apps.marketingprogramsettings.GROUP_COSTS:selectedCostsCount++;break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:selectedDescriptorsCount++;if(record.json.required){selectedRequiredDescriptorsCount++;}
break;case Mkt.apps.marketingprogramsettings.GROUP_CALENDAR:selectedCalendarsCount++;break;}}
var disableEdit=selectedCount!=1||selectedCalendarsCount>0;var disableDelete=selectedCount==0||selectedRequiredDescriptorsCount>0;items.get('editItem').setDisabled(disableEdit);items.get('deleteItem').setDisabled(disableDelete);};Mkt.apps.marketingprogramsettings.Actions={deleteCost:function(compId,costIds,grid,animEl){var deleteMessage='Are you sure you want to delete the selected '+(costIds.length>1?'items?':'item?');MktMessage.confirmDelete('Delete Cost',deleteMessage,function(){var params={compId:compId,costIds:Ext.encode(costIds)};MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/deleteCostSubmit',{serializeParms:params,onMySuccess:this.deleteCostDone.createDelegate(this,[grid])});}.createDelegate(this),animEl);},deleteCostDone:function(grid){grid.loadPagedGrid();},editCost:function(compId,data,grid,animEl){var formData={compId:compId,costId:data.id,itemType:data.itemType,description:data.description};Ext.apply(formData,data.summaryData||{});var marketingEventForm=new Mkt.apps.marketingprogramsettings.CostModal({formData:formData,submitSuccessCallback:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){this.close();grid.loadPagedGrid();}}});marketingEventForm.show(animEl);},editChannel:function(compId,animEl)
{var params={compId:compId};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;};MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/getMarketingEvent',{serializeParms:params,onMySuccess:function(results,requestParams){MktSession.unclockCursor();var event=results.JSONResults.event;if(event.hasMembers){MktMessage.showNotAllowed('Channel cannot be edited once program or event has members');}
else{var channelDescriptor=event.descriptors[0];var form=new Mkt.apps.marketingprogramsettings.DescriptorModal({formData:{programId:event.id,programDescriptorId:channelDescriptor.id,descriptorId:channelDescriptor.descriptorId,descriptorName:channelDescriptor.name,descriptorValue:channelDescriptor.value,isChannel:true},submitSuccessCallback:function(){if(MktPage.appVars.result==MktSession.resultSuccess){MktCanvas.reloadActiveTab();this.close();}}});form.show(animEl);}}.createDelegate(this)});},editDescriptor:function(compId,data,grid,animEl)
{var isChannel=data.itemType==Mkt.apps.marketingprogramsettings.TYPE_DESCRIPTOR_CHANNEL;if(isChannel){var program=Mkt.apps.marketingEvent.getStore().getById(compId);if(program.get('hasMembers')){MktMessage.showNotAllowed('Channel cannot be edited once program or event has members');return;}}
var form=new Mkt.apps.marketingprogramsettings.DescriptorModal({formData:{programId:compId,programDescriptorId:data.id!=null?parseInt(data.id.replace(/[^0-9]+/gi,'')):null,descriptorId:data.descriptorId,descriptorName:data.summaryData!=null?data.summaryData.name:data.descriptorName,descriptorValue:data.summaryData!=null?data.summaryData.value:null,isChannel:isChannel},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){grid.getStore().reload();this.close();}}});form.show(animEl);},deleteDescriptor:function(compId,descriptorIds,grid,animEl)
{var message='Are you sure you want to delete the selected tag'+(descriptorIds.length>1?'s':'')+'?',title='Delete Tag'+(descriptorIds.length>1?'s':'');MktMessage.confirmDelete(title,message,function(){MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/deleteProgramDescriptorsSubmit',{serializeJSON:{componentId:compId,programDescriptorIds:descriptorIds},onMySuccess:function(grid){grid.getStore().reload();}.createDelegate(this,[grid])});}.createDelegate(this),animEl);},calendarDropped:function(compId,data,grid,animEl)
{var message='';if(grid.compType=="Marketing Event"){var message='Publish this event and its child campaigns to your ExactTarget calendar?';}
else{var message='Publish this program\'s child campaigns to your ExactTarget calendar?';}
var config={title:'ExactTarget Calendar',msg:message,buttons:[{text:"Publish",iconCls:'mkiOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],width:500,icon:'mki48About',iconCls:'mkiExactTarget',okCallback:function(){Mkt.apps.marketingprogramsettings.Actions.enableCalendar(compId,data,grid,this);},animateTarget:animEl};MktMessage.show(config);},enableCalendar:function(compId,data,grid,dialog)
{MktSession.clockCursor();var tab=MktCanvas.getActiveTab();var compType=tab.config.compType;MktSession.ajaxRequest('marketingEvent/enableCalendar',{serializeJSON:{componentId:compId,componentTypeName:compType,integrationPartnerId:data.itemId},onMySuccess:function(grid,dialog){dialog.close();grid.getStore().reload();}.createDelegate(this,[grid,dialog])});},deleteCalendar:function(compId,calendarIds,grid,animEl)
{var message='Are you sure you want to delete the selected calendar'+(calendarIds.length>1?'s':'')+'?',title='Delete Calendar'+(calendarIds.length>1?'s':'');MktMessage.confirmDelete(title,message,function(){MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/deleteCalendar',{serializeJSON:{componentId:compId,calendarIds:calendarIds},onMySuccess:function(grid){grid.getStore().reload();}.createDelegate(this,[grid])});}.createDelegate(this),animEl);}};Mkt.apps.marketingprogramsettings.summaryFormatter=function(v,recordData){var ProgramSettings=Mkt.apps.marketingprogramsettings;var template='Empty';var parameters={};if(recordData.itemGroup==ProgramSettings.GROUP_DESCRIPTORS){template='<b>{name}:</b> {value}';Ext.apply(parameters,{name:recordData.summaryData.name,value:recordData.summaryData.value});}
else if(recordData.itemGroup==ProgramSettings.GROUP_COST){var startDate=Date.parseDate(recordData.summaryData.startDate+"-01","Y-m-d");template='<b>Month:</b> {startDate} &nbsp; <b>Cost:</b> {amount} '+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666">{description}</span>';var formattedCost=Mkt.util.locale.Format.formatCurrency(recordData.summaryData.amount,ProgramSettings.currencyFormat,ProgramSettings.currencySymbol,{includeFractional:false});Ext.apply(parameters,{startDate:startDate.dateFormat('M, Y'),amount:formattedCost,description:Ext.util.Format.htmlEncode(recordData.description)});}
else if(recordData.itemGroup==ProgramSettings.GROUP_CALENDAR){template='{summary} {calendarName}';var calendarName=recordData.calendarName;if(calendarName!=''){calendarName='('+calendarName+')';}
Ext.apply(parameters,{summary:recordData.summaryData,calendarName:calendarName});}
var renderTemplate=new Ext.XTemplate(template);return renderTemplate.apply(parameters);}
Mkt.apps.marketingprogramsettings.groupHeaderFormatter=function(group,text,records){var ProgramSettings=Mkt.apps.marketingprogramsettings;var template='Empty';var parameters={text:text,count:records.length};if(group==ProgramSettings.GROUP_DESCRIPTORS){template='{text}';}
else if(group==ProgramSettings.GROUP_COST){var totalCost=0;for(i=0;i<records.length;i++){var record=records[i];totalCost+=record.data.summaryData.amount;}
template='{text} (Total: {totalCost})';var formattedTotalCost=Mkt.util.locale.Format.formatCurrency(totalCost,ProgramSettings.currencyFormat,ProgramSettings.currencySymbol,{includeFractional:false});Ext.apply(parameters,{totalCost:formattedTotalCost});}
else if(group==ProgramSettings.GROUP_CALENDAR){template='{text}';}
var renderTemplate=new Ext.XTemplate(template);return renderTemplate.apply(parameters);};Mkt.apps.marketingprogramsettings.SettingsGridPanel=function(config){Mkt.apps.marketingprogramsettings.SettingsGridPanel.superclass.constructor.call(this,config);};Ext.extend(Mkt.apps.marketingprogramsettings.SettingsGridPanel,MktGrids.CanvasGridPanel,{isEditor:true,editable:false,layout:'fit',enableTotal:true,searchEmptyText:'Quick Find...',searchQtip:'Search for setting.',beforeLoadMaskMsg:'Loading settings...',afterLoadMaskMsg:'Loading {0} settings...',pagingEmptyMsg:'Drag new setting from the right',autoExpandColumn:'summary',compId:null,listeners:{rowdblclick:function(grid,rowIndex,e){var record=grid.getSelectionModel().getSelected();if(record){switch(record.data.itemGroup){case Mkt.apps.marketingprogramsettings.GROUP_COST:Mkt.apps.marketingprogramsettings.Actions.editCost(grid.compId,record.data,grid,e.target);break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:Mkt.apps.marketingprogramsettings.Actions.editDescriptor(grid.compId,record.json,grid,e.target);break;}}}},sm:new Ext.grid.RowSelectionModel({singleSelect:false}),settingFields:[{name:'id'},{name:'itemType'},{name:'itemGroup'},{name:'summary',convert:Mkt.apps.marketingprogramsettings.summaryFormatter},{name:'description'},{name:'summaryData'}],initComponent:function(){this.id='settingGrid_'+this.compId;this.ds=this.createDataStore();this.cm=this.createColumnModel(this.ds);this.view=this.createGroupView();Mkt.apps.marketingprogramsettings.SettingsGridPanel.superclass.initComponent.call(this);var program=Mkt.apps.marketingEvent.getStore().getById(this.compId);if(!program){Mkt.apps.marketingEvent.reloadStore(this.compId);}},createGroupView:function(){var groupView=new MktGrids.GroupingView({groupTextTpl:'{[Mkt.apps.marketingprogramsettings.groupHeaderFormatter(values.gvalue, values.text, values.rs)]}',showGroupName:false,hideGroupedColumn:true,grid:this,enableNoGroups:false,enableGroupingMenu:false,listeners:{beforerefresh:function(view){var numRows=view.grid.getStore().getCount();var gridHead=view.grid.getGridEl().child('div[class=x-grid3-header]');var gridScroller=view.grid.getView().scroller;var bottomToolbar=view.grid.getBottomToolbar();if(numRows==0){if(view.grid.ownerCt){view.grid.ownerCt.addClass("emptyGridOutline");}
gridScroller.removeClass("nestedGridSidewall");bottomToolbar.hide();gridHead.hide();}
else if(!gridScroller.hasClass("nestedGridSidewall")){if(view.grid.ownerCt){view.grid.ownerCt.removeClass("emptyGridOutline");}
gridScroller.addClass("nestedGridSidewall");bottomToolbar.show();gridHead.show();}}}});return groupView;},createColumnModel:function(dataStore){var cm=new Ext.grid.ColumnModel({columns:[{header:'Group',id:'group',hidden:true,hideable:false,dataIndex:'itemGroup',renderer:function(value,metaData,record,rowIndex,colIndex,store){switch(value){case Mkt.apps.marketingprogramsettings.GROUP_COST:value='Costs';break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:value='Tags';break;case Mkt.apps.marketingprogramsettings.GROUP_CALENDAR:value='Calendars';break;}
return value;}},{header:'Type',id:'type',width:40,dataIndex:'itemType',editable:false,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){var cssClass='';switch(value){case Mkt.apps.marketingprogramsettings.TYPE_COST_PERIOD:cssClass="mkiCalMoney";break;case Mkt.apps.marketingprogramsettings.TYPE_DESCRIPTOR:cssClass=record.json.required?'mkiTagRequired':'mkiTag';break;case Mkt.apps.marketingprogramsettings.TYPE_DESCRIPTOR_CHANNEL:cssClass="mkiTagRight";break;case Mkt.apps.marketingprogramsettings.TYPE_CALENDAR:cssClass="mkiExactTarget";break;}
return'<div class="'+cssClass+' mki16" style="float: none; margin: 0px auto;">&nbsp;</div>';}},{id:'summary',header:'Summary',dataIndex:'summary',width:400,editable:false,groupable:false}]},dataStore);return cm;},createDataStore:function(){var reader=new Ext.data.JsonReader({root:'data',idProperty:'id',fields:this.settingFields});var writeCallbackException=function(proxy,type,action,options,response){if(type==='response'){response.success=false;this.fireEvent('loadexception',proxy,reader,response);}};var proxy=new Ext.data.HttpProxy({api:{read:'/marketingEvent/getProgramSettingsData'},listeners:{exception:writeCallbackException}});var tab=MktCanvas.getActiveTab();var compType=tab.config.compType;var ds=new Ext.data.GroupingStore({proxy:proxy,reader:reader,groupField:'itemGroup',groupDir:'DESC',baseParams:{compId:this.compId,compType:compType},remoteSort:false,autoSave:false});return ds;}});Mkt.apps.marketingprogramsettings.SettingsPaletteManager=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager mktTokenPaletteManager mktFullCanvasGrid',baseCls:'',layout:'border',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,paletteWidth:200,fieldTreeUrl:'explorer/getMarketingProgramSettingTypes',enableTreeCache:false,lastNodeClicked:null,initComponent:function(){this.items=this.items||[];Mkt.apps.marketingprogramsettings.SettingsPaletteManager.superclass.initComponent.call(this);this.fieldPanel.on('render',function(grid){var addedDescriptorIds={};var addedCalendarIds={};grid.getStore().on('load',function(store,records,options){addedDescriptorIds={};addedCalendarIds={};for(var i=0,l=records.length;i<l;i++){if(records[i].data.itemGroup==Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS){addedDescriptorIds[records[i].json.descriptorId]=true;}
if(records[i].data.itemGroup==Mkt.apps.marketingprogramsettings.GROUP_CALENDAR){addedCalendarIds[records[i].json.calendarId]=true;}}});grid.dropZone=new Ext.dd.DropZone(grid.getView().scroller,{ddGroup:'layoutDesigner',onNodeDrop:function(target,dd,e,data){var extraData=data.node.attributes.xtra;if(!extraData||addedDescriptorIds[extraData.descriptorId]||addedCalendarIds[extraData.itemId]){return false;}
switch(extraData.itemGroup){case Mkt.apps.marketingprogramsettings.GROUP_COST:Mkt.apps.marketingprogramsettings.Actions.editCost(grid.compId,extraData,grid);break;case Mkt.apps.marketingprogramsettings.GROUP_DESCRIPTORS:Mkt.apps.marketingprogramsettings.Actions.editDescriptor(grid.compId,extraData,grid);break;case Mkt.apps.marketingprogramsettings.GROUP_CALENDAR:Mkt.apps.marketingprogramsettings.Actions.calendarDropped(grid.compId,extraData,grid);break;}
return true;},onNodeOver:function(target,dd,e,data){var extraData=data.node.attributes.xtra;if(extraData&&!addedDescriptorIds[extraData.descriptorId]&&!addedCalendarIds[extraData.itemId]){return Ext.dd.DropZone.prototype.dropAllowed;}},getTargetFromEvent:function(e){return e.getTarget();}});});this.fieldPanel.on('beforedestroy',function(comp){this.dropZone.unreg();});},buildCenterComponents:function(){return this.fieldPanel;}});Mkt.apps.marketingprogramsettings.FormFields={amount:{xtype:'numberfield',itemId:'amount',itemCls:'mktRequired',fieldLabel:'Period Cost',allowDecimals:false,allowNegative:false,allowBlank:false,width:90,maxLength:8},startDate:{xtype:'datefield',itemId:'startDate',itemCls:'mktRequired',fieldLabel:'Program Month',plugins:['monthPickerPlugin'],format:'M, Y',allowBlank:false,editable:false,width:90},description:{xtype:'textfield',itemId:'description',fieldLabel:'Note',width:300},description:{xtype:'textfield',itemId:'description',fieldLabel:'Note',width:300}};Mkt.apps.marketingprogramsettings.CostModal=Ext.extend(Mkt.widgets.ModalForm,{minWidth:500,width:500,height:290,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',iconCls:'mkiCalMoney',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',labelWidth:130,okText:'Save',submitUrl:'marketingEvent/setCostSubmit',initComponent:function(){this.baseParams={compId:this.formData.compId,costId:this.formData.costId,type:this.formData.itemType};this.title=this.formData.costId>0?'Edit Cost':'New Cost';var defaultAmount=this.formData.amount>=0?this.formData.amount:undefined;var defaultDate=Ext.isString(this.formData.startDate)?Date.parseDate(this.formData.startDate+"-01","Y-m-d"):new Date().add(Date.MONTH,1);var defaultDescription=this.formData.description||'';var FormFields=Mkt.apps.marketingprogramsettings.FormFields;if(this.formData.itemType==Mkt.apps.marketingprogramsettings.TYPE_COST_PERIOD){var amountLabel='Period Cost ('+Mkt.apps.marketingprogramsettings.currencyIso+')';this.items=[Ext.apply({value:defaultDate},FormFields.startDate),Ext.applyIf({value:defaultAmount,fieldLabel:amountLabel},FormFields.amount),Ext.apply({value:defaultDescription},FormFields.description)];}
this.beforeSubmitCallback=function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;};this.okCallback=function(){this.serializeParms={};var formData=[];var getFormData=function(item){if(Ext.isFunction(item.getValue)){var value=item.getValue();if(Ext.isDate(value)){value=value.dateFormat('Y-m');}
formData[item.itemId]=value;}
else if(item.items){item.items.each(getFormData,this);}};this.items.each(getFormData,this);this.serializeParms=formData;};Mkt.apps.marketingprogramsettings.CostModal.superclass.initComponent.call(this);}});Mkt.apps.marketingprogramsettings.DescriptorModal=Ext.extend(Mkt.widgets.ModalForm,{minWidth:500,width:500,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEventDescriptorForm',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:130,okText:'Save',submitUrl:'marketingEvent/setProgramDescriptorSubmit',formData:{},descriptorValueField:null,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());this.title=(this.formData.programDescriptorId!=null?'Edit':'New')+' '+this.formData.descriptorName;this.iconCls=this.formData.isChannel?'mkiTagRight':'mkiTag';this.baseParams={compId:this.formData.programId};Mkt.apps.marketingprogramsettings.DescriptorModal.superclass.initComponent.call(this);},getFields:function()
{var items=[];this.descriptorValueField=new Ext.form.ComboBox({fieldLabel:this.formData.descriptorName,itemCls:'mktRequired',anchor:'94%',autoSelect:false,allowBlank:false,valueField:'id',displayField:'value',emptyText:'- Choose -',triggerAction:'all',mode:'remote',value:!Ext.isEmpty(this.formData.descriptorValue,true)?this.formData.descriptorValue:undefined,store:new Ext.data.JsonStore({idProperty:'id',messageProperty:'message',url:'/marketingEvent/getVisibleDescriptorValues',baseParams:{compId:this.formData.programId,descriptorId:this.formData.descriptorId},root:'data.values',fields:['id','value'],listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}})});items.push(this.descriptorValueField);return items;},beforeSubmitCallback:function()
{return this.descriptorValueField.validate();},okCallback:function()
{this.serializeJSON={programId:this.formData.programId,programDescriptorId:this.formData.programDescriptorId||null,descriptorId:this.formData.descriptorId,descriptorValue:this.descriptorValueField.getRawValue()};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){this.close();}}});
/* ========== ../mkt-ext-2.0/apps/AnalyticsReportSetup.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.analyticsreportsetup');Mkt.apps.analyticsreportsetup.constants={currencyFormat:"",currencySymbol:"",currencyIso:"",subtype_timeframe:'timeframe',subtype_group:'group',subtype_exportsize:'exportsize',subtype_advanced:'advanced',subtype_customcolumn:'customcolumn',subtype_tag_channel:'channel',subtype_tag_generic:'generic',subtype_tree_program:'program',subtype_tree_email:'email',subtype_tree_ma_email:'maEmail',subtype_tree_campaign:'campaign',subtype_tree_landing_page:'landing',subtype_form_costmonth:'costMonth'}
Mkt.apps.analyticsreportsetup.constants.settings_icons={};Mkt.apps.analyticsreportsetup.constants.tags_icons={};Mkt.apps.analyticsreportsetup.constants.tree_icons={};(function(){var constants=Mkt.apps.analyticsreportsetup.constants;constants.settings_icons[constants.subtype_timeframe]='mkiClock';constants.settings_icons[constants.subtype_group]='mkiUsers2';constants.settings_icons[constants.subtype_exportsize]='mkiExcel';constants.settings_icons[constants.subtype_advanced]='mkiGear';constants.settings_icons[constants.subtype_customcolumn]='mkiTableColumnAdd';constants.tags_icons[constants.subtype_tag_channel]='mkiTagRight';constants.tags_icons[constants.subtype_tag_generic]='mkiTag';constants.tree_icons[constants.subtype_tree_program]='mkiWalletClosed';constants.tree_icons[constants.subtype_tree_email]='mkiMail2';constants.tree_icons[constants.subtype_tree_ma_email]='mkiMail2';constants.tree_icons[constants.subtype_tree_campaign]='mkiLightbulb';constants.tree_icons[constants.subtype_tree_landing_page]='mkiWebpage';})();Mkt.apps.analyticsreportsetup.menuItems={deleteMenu:{text:'Delete',itemId:'deleteItem',iconCls:'mkiDelete2',disabled:true,handler:function(el){var grid=Mkt.apps.analyticsreportsetup.globalGrid;var records=grid.getSelectionModel().getSelections();var itemsToDelete={};for(var i=0;i<records.length;i++){var record=records[i];var uiBaseClass=record.get('uiBaseClass');var classRecordsToDelete=itemsToDelete[uiBaseClass];if(!classRecordsToDelete){classRecordsToDelete=[];itemsToDelete[uiBaseClass]=classRecordsToDelete;}
classRecordsToDelete.push(record);}
for(var uiBaseClassName in itemsToDelete){if(uiBaseClassName){var classRecordsToDelete=itemsToDelete[uiBaseClassName];var classObj=MktUtil.getClassByName(uiBaseClassName,grid);if(classObj){classObj.deleteItems(classRecordsToDelete);}}}}},editMenu:{text:'Edit',itemId:'editItem',iconCls:'mkiPencil',disabled:true,handler:function(el){var grid=Mkt.apps.analyticsreportsetup.globalGrid;var record=grid.getSelectionModel().getSelected();var uiBaseClass=record.get('uiBaseClass');var classObj=MktUtil.getClassByName(uiBaseClass,grid);if(classObj){classObj.editItem(record.get('subType'),record,el.getEl());}}}};Mkt.apps.analyticsreportsetup.setEnabledMenuItems=function(items,records)
{if(!items){return;}
var selectedCount=records?records.length:0;var editableCount=0;var deletableCount=0;for(var i=0;i<selectedCount;i++){var record=records[i];var uiBaseClass=record.get('uiBaseClass');var classObj=MktUtil.getClassByName(uiBaseClass);if(classObj){if(classObj.canEdit(record)){editableCount++;}
if(classObj.canDelete(record)){deletableCount++;}}}
var disableEdit=selectedCount!=1||editableCount!=1;var disableDelete=deletableCount==0||selectedCount!=deletableCount;items.get('editItem').setDisabled(disableEdit);items.get('deleteItem').setDisabled(disableDelete);};Mkt.apps.analyticsreportsetup.SettingsGridPanel=function(config){Mkt.apps.analyticsreportsetup.SettingsGridPanel.superclass.constructor.call(this,config);};Ext.extend(Mkt.apps.analyticsreportsetup.SettingsGridPanel,MktGrids.CanvasGridPanel,{isEditor:true,editable:false,layout:'fit',enableTotal:true,searchEmptyText:'Quick Find...',searchQtip:'Search for setting.',beforeLoadMaskMsg:'Loading settings...',afterLoadMaskMsg:'Loading {0} settings...',pagingEmptyMsg:'Drag new setting from the right',autoExpandColumn:'value',compId:null,listeners:{rowdblclick:function(grid,rowIndex,e){var record=grid.getSelectionModel().getSelected();if(record){var classObj=MktUtil.getClassByName(record.get('uiBaseClass'),grid);if(classObj){return classObj.editItem(record.get('subType'),record,e.getTarget());}}}},sm:new Ext.grid.RowSelectionModel({singleSelect:false}),settingFields:[{name:'id'},{name:'icon'},{name:'name'},{name:'value'},{name:'metadata'},{name:'uiBaseClass'},{name:'subType'},{name:'groupName'},{name:'groupId'},{name:'sortIndex'}],initComponent:function(){this.id='reportSetupGrid_'+this.compId;this.ds=this.createDataStore();this.cm=this.createColumnModel(this.ds);this.view=this.createGroupView();Mkt.apps.analyticsreportsetup.SettingsGridPanel.superclass.initComponent.call(this);},createGroupView:function(){var groupView=new MktGrids.GroupingView({showGroupName:false,hideGroupedColumn:true,grid:this,enableNoGroups:false,enableGroupingMenu:false,listeners:{beforerefresh:function(view){var numRows=view.grid.getStore().getCount();var gridHead=view.grid.getGridEl().child('div[class=x-grid3-header]');var gridScroller=view.grid.getView().scroller;var bottomToolbar=view.grid.getBottomToolbar();if(numRows==0){if(view.grid.ownerCt){view.grid.ownerCt.addClass("emptyGridOutline");}
gridScroller.removeClass("nestedGridSidewall");bottomToolbar.hide();gridHead.hide();}
else if(!gridScroller.hasClass("nestedGridSidewall")){if(view.grid.ownerCt){view.grid.ownerCt.removeClass("emptyGridOutline");}
gridScroller.addClass("nestedGridSidewall");bottomToolbar.show();gridHead.show();}}}});return groupView;},createColumnModel:function(dataStore){var cm=new Ext.grid.ColumnModel({columns:[{header:'Group',id:'groupId',hidden:true,hideable:false,dataIndex:'groupId',renderer:function(value,metaData,record,rowIndex,colIndex,store){var classObj=MktUtil.getClassByName(record.get('uiBaseClass'));if(classObj){return classObj.groupColumnRenderer(value,metaData,record,rowIndex,colIndex,store);}}},{header:'Type',id:'icon',width:40,dataIndex:'icon',editable:false,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){var classObj=MktUtil.getClassByName(record.get('uiBaseClass'));if(classObj){return classObj.iconColumnRenderer(value,metaData,record,rowIndex,colIndex,store);}}},{header:'Name',id:'name',dataIndex:'name',width:200,editable:false,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){var classObj=MktUtil.getClassByName(record.get('uiBaseClass'));if(classObj){return classObj.nameColumnRenderer(value,metaData,record,rowIndex,colIndex,store);}}},{header:'Value',id:'value',dataIndex:'value',editable:false,groupable:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){var classObj=MktUtil.getClassByName(record.get('uiBaseClass'));if(classObj){return classObj.valueColumnRenderer(value,metaData,record,rowIndex,colIndex,store);}}}]},dataStore);return cm;},createDataStore:function(){var reader=new Ext.data.JsonReader({root:'data',fields:this.settingFields});var writeCallbackException=function(proxy,type,action,options,response){if(type==='response'){response.success=false;this.fireEvent('loadexception',proxy,reader,response);}};var proxy=new Ext.data.HttpProxy({api:{read:'/analytics/getReportSetupData'},listeners:{exception:writeCallbackException}});var ds=new Ext.data.GroupingStore({proxy:proxy,reader:reader,groupField:'groupId',groupDir:'ASC',baseParams:{compId:this.compId},remoteSort:false,sortInfo:{field:'sortIndex',direction:'ASC'},autoSave:false});return ds;}});Mkt.apps.analyticsreportsetup.SettingsPaletteManager=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager mktTokenPaletteManager mktFullCanvasGrid',baseCls:'',layout:'border',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,paletteWidth:200,enableTreeCache:false,lastNodeClicked:null,initComponent:function(){this.fieldTreeUrl='explorer/getAnalyticsReportSettingTypes?compId='+this.fieldPanel.compId;this.items=this.items||[];Mkt.apps.analyticsreportsetup.SettingsPaletteManager.superclass.initComponent.call(this);this.fieldPanel.on('render',function(grid){var alreadyAddedIds={};grid.getStore().on('load',function(store,records,options){alreadyAddedIds={};for(var i=0,l=records.length;i<l;i++){var record=records[i];var baseClass=record.get('uiBaseClass');var id=record.get('id');var classObj=MktUtil.getClassByName(baseClass);if(classObj){alreadyAddedIds[baseClass+':'+id]=classObj.allowOnce(record);}}});grid.dropZone=new Ext.dd.DropZone(grid.getView().scroller,{ddGroup:'layoutDesigner',onNodeDrop:function(target,dd,e,data){var extraData=data.node.attributes.xtra;if(!extraData||!extraData.uiBaseClass||alreadyAddedIds[extraData.uiBaseClass+':'+extraData.id]){return false;}
var classObj=MktUtil.getClassByName(extraData.uiBaseClass,grid);if(classObj){classObj.addItem(extraData.subtype,extraData);}
return true;},onNodeOver:function(target,dd,e,data){var extraData=data.node.attributes.xtra;if(extraData&&extraData.uiBaseClass&&!alreadyAddedIds[extraData.uiBaseClass+':'+extraData.id]){return Ext.dd.DropZone.prototype.dropAllowed;}},getTargetFromEvent:function(e){return e.getTarget();}});});this.fieldPanel.on('beforedestroy',function(comp){this.dropZone.unreg();});},buildCenterComponents:function(){return this.fieldPanel;}});Mkt.apps.analyticsreportsetup.RowItemAdapter=function(grid){this.grid=grid;Mkt.apps.analyticsreportsetup.RowItemAdapter.superclass.constructor.call(this);};Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,Ext.util.Observable,{grid:null,addItem:function(subType,metaData){console.debug('Mkt.apps.analyticsreportsetup.RowItemAdapter:addItem not implimented');},deleteItems:function(records,animEl){console.debug('Mkt.apps.analyticsreportsetup.RowItemAdapter:deleteItems not implimented');},editItem:function(subType,record,animEl){console.debug('Mkt.apps.analyticsreportsetup.RowItemAdapter:editItem not implimented');},iconColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){return'<div class="'+value+' mki16" style="float: none; margin: 0px auto;">&nbsp;</div>';},nameColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){return Ext.util.Format.htmlEncode(value);},valueColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){return Ext.util.Format.htmlEncode(value);},groupColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var value=record.get('groupName');return Ext.util.Format.htmlEncode(value);},allowOnce:function(record){return true;},canEdit:function(record){return true;},canDelete:function(record){return true;},reloadGrid:function(){var panelsToClear=[Mkt.menus.Analytics.Toolbar.overviewCanvasId,Mkt.menus.Analytics.Toolbar.detailCanvasId];for(var i=0;i<panelsToClear.length;i++){MktPage.clearPanelContentValid(panelsToClear[i]);}
this.grid.reload();}});Mkt.apps.analyticsreportsetup.SettingsRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,{canDelete:function(record){if(record.get('subType')==Mkt.apps.analyticsreportsetup.constants.subtype_customcolumn){return true;}
else{return false;}},valueColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var constants=Mkt.apps.analyticsreportsetup.constants;var extraData=record.get('metadata');var columnValue=value;switch(record.get('subType')){case constants.subtype_group:columnValue=extraData.data.group;var groupUnits=extraData.data.groupUnits;if(groupUnits&&groupUnits!=''){columnValue+=' ('+groupUnits+')';}
break;case constants.subtype_timeframe:columnValue=extraData.data.timeframeLabel;if(extraData.data.datefrom&&extraData.data.dateto){columnValue+=' ('+extraData.data.datefrom+' - '+extraData.data.dateto+')';}
break;case constants.subtype_customcolumn:var columnNames=[];var smartlistColumns=extraData.data.smartlistColumns;if(smartlistColumns){for(var index in smartlistColumns){if(smartlistColumns[index]){columnNames.push(smartlistColumns[index].name);}}}
var maxLength=3;columnValue=Mkt.util.Format.listToSentenceEllipsis(columnNames,', ',maxLength);break;}
return Ext.util.Format.htmlEncode(columnValue);},addItem:function(subType,metaData){var reportSetup=Mkt.apps.analyticsreportsetup;if(subType==reportSetup.constants.subtype_customcolumn){var formData={compId:this.grid.compId,values:[]};var customColumnModal=new reportSetup.CustomColumnModal({formData:formData,successCallback:this.reloadGrid.createDelegate(this)});customColumnModal.show();}},deleteItems:function(records,animEl){for(var i=0;i<records.length;i++){var record=records[i];var subType=record.get('subType');if(subType==Mkt.apps.analyticsreportsetup.constants.subtype_customcolumn){var params={reportId:this.grid.compId,smartlistNames:Ext.encode([])};MktSession.ajaxRequest('analytics/setReportColumns',{serializeParms:params,onMySuccess:this.reloadGrid.createDelegate(this)});}}},editItem:function(subType,record,animEl){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var windowSize=subType==constants.subtype_exportsize?400:subType==constants.subtype_advanced?400:subType==constants.subtype_timeframe?484:525;var uiConfig={uiSetupDialog:true,uiHideGroup:subType!=constants.subtype_group,uiHideTimeframe:subType!=constants.subtype_timeframe,uiHideAdvanced:subType!=constants.subtype_advanced,uiHideExportSize:subType!=constants.subtype_exportsize,uiIconCls:constants.settings_icons[subType],uiWindowWidth:windowSize,reportSettingsTitle:record.get('name')}
var metaData=Ext.applyIf(uiConfig,record.get('metadata'));if(subType==constants.subtype_customcolumn){var existingValues=[];var smartlistColumns=metaData.data.smartlistColumns;if(smartlistColumns){for(var index in smartlistColumns){if(smartlistColumns[index]){existingValues.push({smartlistName:smartlistColumns[index].name});}}}
var formData={compId:this.grid.compId,values:existingValues};var customColumnModal=new reportSetup.CustomColumnModal({formData:formData,successCallback:this.reloadGrid.createDelegate(this)});customColumnModal.show();}
else{Mkt.apps.analytics.ReportSettings.saveSuccessCb=this.reloadGrid.createDelegate(this);Mkt.widgets.ReportSettings.show(metaData,undefined,animEl);}}});Mkt.apps.analyticsreportsetup.TagsRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,{addItem:function(subType,metaData){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var formData={compId:this.grid.compId,values:[],tagId:metaData.descriptorId};var tagModal=new Mkt.apps.analyticsreportsetup.TagModal({formData:formData,iconCls:constants.tags_icons[subType],title:'Filter by '+metaData.descriptorName,successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();},editItem:function(subType,record,animEl){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var metaData=record.get('metadata');var textValueList=[];var tagValues=metaData.valueList;for(var i=0;i<tagValues.length;i++){textValueList.push(tagValues[i]);}
var formData={compId:this.grid.compId,values:textValueList,tagId:metaData.details.id};var tagModal=new Mkt.apps.analyticsreportsetup.TagModal({formData:formData,iconCls:constants.tags_icons[subType],title:'Filter by '+metaData.details.name,successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();},deleteItems:function(records,animEl){var tagsToDelete=[];for(var i=0;i<records.length;i++){var record=records[i];var metaData=record.get('metadata');tagsToDelete.push(metaData.details.id);}
var params={reportId:this.grid.compId,tags:Ext.encode(tagsToDelete)};MktSession.ajaxRequest('analytics/deleteTagFilter',{serializeParms:params,onMySuccess:this.reloadGrid.createDelegate(this)});},valueColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var columnValue='';var extraData=record.get('metadata');var tagValues=extraData.valueList;var maxLength=3;columnValue=Mkt.util.Format.listToSentenceEllipsis(tagValues,', ',maxLength,'value');return Ext.util.Format.htmlEncode(columnValue);},iconColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var subType=record.get('subType');var iconCls=Mkt.apps.analyticsreportsetup.constants.tags_icons[subType];return Mkt.apps.analyticsreportsetup.TagsRowItemAdapter.superclass.iconColumnRenderer.call(this,iconCls,metaData,record,rowIndex,colIndex,store);}});Mkt.apps.analyticsreportsetup.TreeRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,{addItem:function(subType,metaData){var config=this.getSubtypeConfig(subType);var filterWindow=Mkt.menus.Analytics.Toolbar.filterWindow({filterType:config.filterType,selectedNodes:[],windowConfig:{title:config.title,iconCls:config.iconCls,filterType:config.filterType,modal:true,resizable:false,successCallback:this.reloadGrid.createDelegate(this)}});filterWindow.show();},editItem:function(subType,record,animEl){var config=this.getSubtypeConfig(subType);var metaData=record.get('metadata');var filterWindow=Mkt.menus.Analytics.Toolbar.filterWindow({filterType:config.filterType,selectedNodes:metaData.selectedNodes,windowConfig:{title:config.title,iconCls:config.iconCls,filterType:config.filterType,modal:true,successCallback:this.reloadGrid.createDelegate(this)}});filterWindow.show();},deleteItems:function(records,animEl){var filtersToDelete=[];for(var i=0;i<records.length;i++){var record=records[i];var subType=record.get('subType');var config=this.getSubtypeConfig(subType);if(config.filterType){filtersToDelete.push(config.filterType);}}
var params={reportId:this.grid.compId,filterTypes:Ext.encode(filtersToDelete)};MktSession.ajaxRequest('analytics/deleteComponentFilter',{serializeParms:params,onMySuccess:this.reloadGrid.createDelegate(this)});},getSubtypeConfig:function(subType){var constants=Mkt.apps.analyticsreportsetup.constants;var config={};switch(subType){case constants.subtype_tree_email:config.filterType='email';config.title='Email Filter';config.iconCls=constants.tree_icons[subType];break;case constants.subtype_tree_ma_email:config.filterType='maEmail';config.title='Email Filter';config.iconCls=constants.tree_icons[subType];break;case constants.subtype_tree_campaign:config.filterType='campaign';config.title='Campaign Filter';config.iconCls=constants.tree_icons[subType];break;case constants.subtype_tree_landing_page:config.filterType='landing';config.title='Landing Page';config.iconCls=constants.tree_icons[subType];break;case constants.subtype_tree_program:config.filterType='program';config.title='Program Filter';config.iconCls=constants.tree_icons[subType];break;default:config.filterType=null;config.title=null;config.iconCls=null;break;}
return config;}});Mkt.apps.analyticsreportsetup.FormRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,{addItem:function(subType,metaData){var formData={compId:this.grid.compId,toDate:null,fromDate:null};var reloadGridAction=this.reloadGrid.createDelegate(this);var successCallback=function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){reloadGridAction();this.close();}}
var form=new Mkt.apps.analyticsreportsetup.CostMonthModal({formData:formData,submitSuccessCallback:successCallback});form.show();},editItem:function(subType,record,animEl){var fromDate=record.get('metadata').from;var toDate=record.get('metadata').to;var formData={compId:this.grid.compId,fromDate:fromDate,toDate:toDate};var reloadGridAction=this.reloadGrid.createDelegate(this);var successCallback=function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){reloadGridAction();this.close();}}
var form=new Mkt.apps.analyticsreportsetup.CostMonthModal({formData:formData,submitSuccessCallback:successCallback});form.show();},deleteItems:function(records,animEl){var filtersToDelete=[];for(var i=0;i<records.length;i++){var record=records[i];filtersToDelete.push(record.get('subType'));}
var params={reportId:this.grid.compId,filterTypes:Ext.encode(filtersToDelete)};MktSession.ajaxRequest('analytics/deleteFormFilter',{serializeParms:params,onMySuccess:this.reloadGrid.createDelegate(this)});},valueColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var columnValue=value;var constants=Mkt.apps.analyticsreportsetup.constants;var subType=record.get('subType');switch(subType){case constants.subtype_form_costmonth:var fromDate=record.get('metadata').from;var toDate=record.get('metadata').to;var defaultFromDate=Ext.isString(fromDate)?Date.parseDate(fromDate+"-01","Y-m-d"):undefined;var defaultToDate=Ext.isString(toDate)?Date.parseDate(toDate+"-01","Y-m-d"):undefined;if(defaultFromDate&&defaultToDate){columnValue=defaultFromDate.format('M, Y')+' - '+defaultToDate.format('M, Y');}
break;}
return Ext.util.Format.htmlEncode(columnValue);}});Mkt.apps.analyticsreportsetup.FormFields={monthDate:{xtype:'datefield',itemCls:'mktRequired',plugins:['monthPickerPlugin'],format:'M, Y',allowBlank:false,editable:false,width:90}};Mkt.apps.analyticsreportsetup.AnalyzerTagsRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.TagsRowItemAdapter,{addItem:function(subType,metaData){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var formData={compId:this.grid.compId,values:[],tagId:metaData.descriptorId};var tagModal=new Mkt.apps.analyticsreportsetup.AnalyzerTagModal({formData:formData,iconCls:constants.tags_icons[subType],title:'Filter by '+metaData.descriptorName,successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();},editItem:function(subType,record,animEl){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var metaData=record.get('metadata');var textValueList=[];var tagValues=metaData.valueList;for(var i=0;i<tagValues.length;i++){var tagValue=tagValues[i];textValueList.push({value:tagValue.value});}
var formData={compId:this.grid.compId,values:textValueList,tagId:metaData.details.id};var tagModal=new Mkt.apps.analyticsreportsetup.AnalyzerTagModal({formData:formData,iconCls:constants.tags_icons[subType],title:'Filter by '+metaData.details.name,successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();}});Mkt.apps.analyticsreportsetup.OptyAnalyzerTagsRowItemAdapter=Ext.extend(Mkt.apps.analyticsreportsetup.RowItemAdapter,{addItem:function(subType,metaData){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var formData={compId:this.grid.compId,values:[],interactionFilterId:metaData.interactionFilterId};var tagModal=new Mkt.apps.analyticsreportsetup.OptyAnalyzerTagModal({formData:formData,iconCls:constants.tags_icons[subType],title:'Filter by '+metaData.interactionFilterName,successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();},editItem:function(subType,record,animEl){var reportSetup=Mkt.apps.analyticsreportsetup;var constants=reportSetup.constants;var metaData=record.get('metadata');var textValueList=[];var interactionFilterValues=metaData.valueList;for(var i=0;i<interactionFilterValues.length;i++){var interactionFilterValue=interactionFilterValues[i];textValueList.push({value:interactionFilterValue});}
var formData={compId:this.grid.compId,values:textValueList,interactionFilterId:'interestingmoments'};var tagModal=new Mkt.apps.analyticsreportsetup.OptyAnalyzerTagModal({formData:formData,iconCls:'mkiMessage',title:'Filter by Interesting Moments',successCallback:this.reloadGrid.createDelegate(this)});tagModal.show();},deleteItems:function(records,animEl){var params={reportId:this.grid.compId};MktSession.ajaxRequest('analytics/deleteInteractionFilter',{serializeParms:params,onMySuccess:this.reloadGrid.createDelegate(this)});},valueColumnRenderer:function(value,metaData,record,rowIndex,colIndex,store){var extraData=record.get('metadata');var interactionFilterValues=extraData.valueList;var maxLength=3;var columnValue=Mkt.util.Format.listToSentenceEllipsis(interactionFilterValues,', ',maxLength);return Ext.util.Format.htmlEncode(columnValue);}});Mkt.apps.analyticsreportsetup.CostMonthModal=Ext.extend(Mkt.widgets.ModalForm,{title:'Filter by Cost Period',minWidth:520,width:520,height:170,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',iconCls:'mkiCalMoney',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',okText:'Apply',submitUrl:'analytics/updateCostMonthFilter',initComponent:function(){this.baseParams={compId:this.formData.compId};var defaultFromDate=Ext.isString(this.formData.fromDate)?Date.parseDate(this.formData.fromDate+"-01","Y-m-d"):undefined;var defaultToDate=Ext.isString(this.formData.toDate)?Date.parseDate(this.formData.toDate+"-01","Y-m-d"):undefined;var FormFields=Mkt.apps.analyticsreportsetup.FormFields;this.items=[{xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,layout:'column',items:[{columnWidth:0.33,baseCls:'x-plain',bodyStyle:'padding: 3px 0px',html:'Date of incurred costs:'},{columnWidth:0.33,layout:'form',baseCls:'x-plain',labelWidth:50,labelAlign:'right',items:new Ext.form.DateField(Ext.applyIf({value:defaultFromDate,itemId:'fromDate',fieldLabel:'From',width:90,plugins:['monthPickerPlugin2']},FormFields.monthDate))},{columnWidth:0.33,layout:'form',baseCls:'x-plain',labelWidth:40,labelAlign:'right',items:new Ext.form.DateField(Ext.applyIf({value:defaultToDate,itemId:'toDate',fieldLabel:'To',width:90},FormFields.monthDate))}]}];this.beforeSubmitCallback=function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;};this.okCallback=function(){this.serializeParms={};var formData=[];var getFormData=function(item){if(Ext.isFunction(item.getValue)){var value=item.getValue();if(Ext.isDate(value)){value=value.dateFormat('Y-m');}
formData[item.itemId]=value;}
else if(item.items){item.items.each(getFormData,this);}};this.items.each(getFormData,this);this.serializeParms=formData;};Mkt.apps.analyticsreportsetup.CostMonthModal.superclass.initComponent.call(this);}});Mkt.apps.analyticsreportsetup.SuperBoxSelectModal=Ext.extend(Mkt.widgets.ModalForm,{minWidth:520,width:520,height:300,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',okText:'Apply',descriptionMessage:'',getSuperBox:function(){return{xtype:'selectsuperbox'}},initComponent:function(){this.baseParams={reportId:this.formData.compId};this.superBox=this.getSuperBox();this.items=[{xtype:'panel',bodyStyle:'background: transparent;',autoHeight:true,items:[{baseCls:'x-plain',bodyStyle:'padding-bottom: 7px',html:this.descriptionMessage},this.superBox]}];this.beforeSubmitCallback=function(){return this.superBox.validate();};this.submitSuccessCallback=function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){if(this.successCallback){this.successCallback();}
this.close();}};Mkt.apps.analyticsreportsetup.SuperBoxSelectModal.superclass.initComponent.call(this);}});Mkt.apps.analyticsreportsetup.CustomColumnModal=Ext.extend(Mkt.apps.analyticsreportsetup.SuperBoxSelectModal,{iconCls:Mkt.apps.analyticsreportsetup.constants.settings_icons[Mkt.apps.analyticsreportsetup.constants.subtype_customcolumn],title:'Manage Custom Smart LIst Columns',submitUrl:'analytics/setReportColumns',descriptionMessage:'Select up to four Smart List columns to add:',getSuperBox:function(){var smartlistStore=new Ext.data.JsonStore({url:'analytics/autosuggest',root:'suggest',fields:['smartlistName'],id:'aid',baseParams:{name:'Member of Smart List',dataIndex:'smartlistName',displayField:'smartlistName'}});var superBox=new Ext.ux.form.SuperBoxSelect({name:'smartlistName',store:smartlistStore,mode:'remote',minChars:0,width:460,valueField:'smartlistName',displayField:'smartlistName',typeAhead:true,triggerAction:'all',clearBtnCls:'superBoxClearHidden',allowAddNewData:true,emptyText:'Select Custom Smart List Columns...',listeners:{render:function(superBox){if(this.formData.values){superBox.setValueEx(this.formData.values);}}.createDelegate(this)},validate:function(){if(this.items.length>4){this.markInvalid('A maximum of 4 columns can be chosen');return false;}}});return superBox;},okCallback:function(){var formData=[];var selectedValues=this.superBox.getValueEx();for(var i=0;i<selectedValues.length;i++){var selectedValue=selectedValues[i];formData.push(selectedValue[this.superBox.valueField]);}
this.serializeParms={smartlistNames:Ext.encode(formData)};}});Mkt.apps.analyticsreportsetup.TagModal=Ext.extend(Mkt.apps.analyticsreportsetup.SuperBoxSelectModal,{submitUrl:'analytics/applyTagFilter',queryUrl:'marketingEvent/getVisibleDescriptorValues',descriptionMessage:'Type in the tag values to use as filters:',getSuperBox:function(){var tagStore=new Ext.data.JsonStore({url:this.queryUrl,root:'data.values',fields:['id','value'],idProperty:'id',messageProperty:'message',autoLoad:true,baseParams:{descriptorId:this.formData.tagId},listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}});var superBox=new Ext.ux.form.SuperBoxSelect({name:'tagSelector',store:tagStore,mode:'local',minChars:0,width:460,valueField:'value',displayField:'value',typeAhead:true,triggerAction:'all',allowAddNewData:true,clearBtnCls:'superBoxClearHidden',emptyText:'Select Tag Values...',listeners:{render:function(superBox){if(this.formData.values){var store=superBox.getStore();if(store.getCount()===0){store.on('load',function(){superBox.setValueEx(this.formData.values);},this,{single:true});}
else{superBox.setValueEx(this.formData.values);}}}.createDelegate(this)}});return superBox;},okCallback:function(){var formData=[];var selectedValues=this.superBox.getValueEx();for(var i=0;i<selectedValues.length;i++){var selectedValue=selectedValues[i];formData.push(selectedValue[this.superBox.valueField]);}
this.serializeParms={tagValueNames:Ext.encode(formData),tagId:this.formData.tagId};}});Mkt.apps.analyticsreportsetup.AnalyzerTagModal=Ext.extend(Mkt.apps.analyticsreportsetup.TagModal,{submitUrl:'analytics/applyRcaTagFilter',queryUrl:'analytics/getRcaProgramTagData'});Mkt.apps.analyticsreportsetup.OptyAnalyzerTagModal=Ext.extend(Mkt.apps.analyticsreportsetup.SuperBoxSelectModal,{submitUrl:'analytics/applyOptyInteractionFilter',queryUrl:'analytics/getOptyInterestingMoments',descriptionMessage:'Type in the Interesting Moment values to use as filters:',getSuperBox:function(){var tagStore=new Ext.data.JsonStore({url:this.queryUrl,root:'data.values',fields:['value'],idProperty:'value',messageProperty:'message',autoLoad:true,baseParams:{descriptorId:this.formData.tagId},listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}});var superBox=new Ext.ux.form.SuperBoxSelect({name:'tagSelector',store:tagStore,mode:'local',minChars:0,width:460,valueField:'value',displayField:'value',typeAhead:true,triggerAction:'all',allowAddNewData:true,clearBtnCls:'superBoxClearHidden',emptyText:'Select Interesting Moment Values...',listeners:{render:function(superBox){if(this.formData.values){var store=superBox.getStore();if(store.getCount()===0){store.on('load',function(){superBox.setValueEx(this.formData.values);},this,{single:true});}
else{superBox.setValueEx(this.formData.values);}}}.createDelegate(this)}});return superBox;},okCallback:function(){var formData=[];var selectedValues=this.superBox.getValueEx();for(var i=0;i<selectedValues.length;i++){var selectedValue=selectedValues[i];formData.push(selectedValue[this.superBox.valueField]);}
this.serializeParms={interactionFilterNames:Ext.encode(formData),interactionFilterId:this.formData.interactionFilterId};}});
/* ========== ../mkt-ext-2.0/apps/ObjectSyncManager.js ============ */

Ext.ns('Mkt.apps');Mkt.apps.ObjectSync={panelId:'cadSfdcObjectSync',salesforcePanelId:'cadSfdcSettings',syncObjectText:'Enable Sync',stopSyncText:'Disable Sync',salesforceSyncEnabledWarning:'Salesforce sync should be disabled before you can {0}',objectNotSyncWarning:'<b>{0}</b> object sync should be enabled before you can {1}',selectObjectWarning:'Please select an object from the right and try again',objectNeedsToBeSyncWarning:'<b>{0}</b> object should be synced before you can change the field visibility',filterTriggerNotSupportedWarning:'Editing the field visibility for <b>{0}</b> object is not supported',objectNotSyncTitle:'Object not Synced',salesforceEnabledTitle:'Salesforce Sync Enabled',objectInUseTitle:'Object in Use',objectInUseWarning:'This object is in use so we cannot start/stop sync',objectInUseFieldVisibilityWarning:'This object is in use so we cannot edit it\'s field visibility',salesforceInProgressTitle:'Salesforce Sync in Progress',salesforceTryAgain:'An active Salesforce sync is in progress. Try again in a few minutes.',onlySalesforceCustomWarning:"Only Salesforce custom objects can be synced",onlySalesforceCustomTitle:"Standard Object",notSyncedIconCls:'mkiTable2',impliedIconCls:'mkiOkDisabled',pickedIconCls:'mkiOk',syncObjectIconCls:'mkiDataOk',stopSyncIconCls:'mkiSignStop',notSyncedStatusIconCls:'mkiSignForbidden',notSyncedStatus:'notSynced',impliedStatus:'implied',pickedStatus:'picked',objectSyncManagerKey:'objectSyncManager',syncObjectBtnKey:'syncObjectBtn',editVisibleFieldsBtnKey:'editVisibleFieldsBtn',statusBtnKey:'statusBtn',lastUpdatedAtBtnKey:'lastUpdatedBtn',salesforceSyncStatusKey:'salesforceSyncStatus',Buttons:{},getRelationship:function(node,context){var relationship;var depth;var iconCls;var objectSync=Mkt.apps.ObjectSync;var maxDepth=node.getDepth();var originatingChildNode;while(node){if(node.text=='root'){break;}
iconCls=node.attributes.iconCls;depth=node.getDepth();if(context=="syncObject"){if(depth==maxDepth){iconCls=objectSync.pickedIconCls;}else{if(iconCls==objectSync.notSyncedIconCls&&depth>1){if(originatingChildNode&&originatingChildNode.attributes.isRelNodeLeaf){iconCls=objectSync.pickedIconCls;}else{iconCls=objectSync.impliedIconCls;}}}}else if(context=="stopSync"){if(depth>1){if((node.attributes.implied&&!node.attributes.picked)||depth==maxDepth){iconCls=objectSync.stopSyncIconCls;}}}
if(relationship){relationship=[{text:node.text,iconCls:iconCls,children:relationship}];}else{relationship=[{text:node.text,iconCls:iconCls}];}
originatingChildNode=node;node=node.parentNode;}
return relationship;},refreshObjectsRequest:function(animEl,actionText,confirm,addtnlText,icon){actionText=actionText||"refresh schema";if(!Mkt.apps.ObjectSync.salesforceEnableProcess(actionText,animEl,this.refreshObjectsRequest.createDelegate(this),confirm,addtnlText,icon)){return;}
if(confirm!==false){MktMessage.show({title:"Refresh Schema",msg:"Refreshing the schema from Salesforce may take several minutes",buttons:[{text:"Refresh Schema",iconCls:'mkiDataOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:'mki48DataReplace',iconCls:'mkiDataReplace',okCallback:function(){this.refreshObjectsSubmit();}.createDelegate(this),animateTarget:animEl});}else{this.refreshObjectsSubmit();}},showRefreshSchemaProgress:function(){Ext.MessageBox.show({title:'Sync Schema',msg:'Syncing Salesforce Schema',progressText:'Syncing...',width:300,modal:true,wait:true,waitConfig:{interval:200}});},refreshObjectsSubmit:function(){MktSession.clockCursor(true);this.showRefreshSchemaProgress();MktSession.ajaxRequest("salesforce/refreshObjects",{onMySuccess:this.refreshObjectsDone.createDelegate(this),onMyFailure:this.refreshObjectsFailure.createDelegate(this)});},refreshObjectsDone:function(){MktSession.unclockCursor();Ext.MessageBox.hide();var os=Mkt.apps.ObjectSync;var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){MktCanvas.reactivateActiveTab(true);}else if(result==MktSession.resultBusy){MktMessage.show({title:os.salesforceInProgressTitle,msg:os.salesforceTryAgain,buttons:[{text:"Try again",iconCls:'mkiOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:'mki48Help2',okCallback:function(){this.refreshObjectsSubmit();}.createDelegate(this),animateTarget:undefined});}else{MktMessage.showWarning(MktPage.appVars.errMsg);}},refreshObjectsFailure:function(){Ext.MessageBox.hide();MktSession.unclockCursor();},isSalesforceSyncEnabled:function(){var os=Mkt.apps.ObjectSync;return MktCanvas.getRegisteredItem(os.salesforceSyncStatusKey,os.panelId);},salesforceEnableProcess:function(actionText,animEl,cb,confirm,addtnlText,icon){var ret=false;if(this.isSalesforceSyncEnabled()){MktMessage.show({title:Mkt.apps.ObjectSync.salesforceEnabledTitle,msg:"The global Salesforce sync must be disabled to "+actionText+(addtnlText?("."+addtnlText):""),buttons:[{text:"Disable Global Sync",iconCls:'mkiOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:icon||'mki48SignWarning',okCallback:function(animEl,cb,confirm){this.salesforceEnable(animEl,cb,confirm);}.createDelegate(this,[animEl,cb,confirm]),animateTarget:animEl});}else{ret=true;}
return ret;},salesforceEnable:function(animEl,cb,confirm){MktSession.clockCursor(true);MktSession.ajaxRequest('salesforce/enableSynch',{serializeParms:{enableSynch:false},onMySuccess:this.salesforceEnableDone.createDelegate(this,[animEl,cb,confirm])});},salesforceEnableDone:function(animEl,cb,confirm){MktSession.unclockCursor();var os=Mkt.apps.ObjectSync;var sfdcSyncStatusWindow;if(MktPage.appVars.result==MktSession.resultSuccess){this.sfdcSyncStatusWindow=sfdcSyncStatusWindow=Mkt.apps.SfdcSyncStatusWindow.showWindow();MktCanvas.getTab(os.salesforcePanelId).clearContentValid();MktCanvas.registerItem(os.salesforceSyncStatusKey,MktPage.appVars.sync,os.panelId);}
if(cb){cb(animEl,undefined,confirm);}}};Mkt.apps.ObjectSyncManager=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager mktObjectSyncManager',layout:'border',fieldTreeUrl:'salesforce/getObjectsTree',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,droppable:true,welcomeMsg:"Select an object from the right",initComponent:function(){Mkt.apps.ObjectSyncManager.superclass.initComponent.call(this);this.fieldTreePanel.on('click',this.objectSelected,this);},buildCenterComponents:function(){this.objectPanel=new Mkt.apps.BlankDbFieldPanel({welcomeMsg:this.welcomeMsg,mgr:this});return this.objectPanel;},itemSelected:function(){this.objectSelected.apply(this,arguments);},objectSelected:function(node,e){this.hideWelcomeMsg();var nodeAttr=node.attributes;this.replaceObjectPanel({nodeId:node.id,active:nodeAttr.active,picked:nodeAttr.picked,implied:nodeAttr.implied,relationshipData:Mkt.apps.ObjectSync.getRelationship(node),objectName:node.text});this.currentNode=node;},replaceObjectPanel:function(prop){this.removeObjectPanel();this.objectPanel=new Mkt.apps.ObjectPanel(Ext.applyIf({objectRenameCb:this.objectRenameCb.createDelegate(this),mgr:this},prop));this.center.add(this.objectPanel);this.center.doLayout();},objectRenameCb:function(name){if(this.currentNode){this.currentNode.setText(name);}},removeObjectPanel:function(){if(this.objectPanel){this.center.remove(this.objectPanel,true);this.objectPanel.destroy();delete this.objectPanel;}},hideWelcomeMsg:function(){if(this.objectPanel){this.objectPanel.setHeight(0);this.objectPanel.removeClass('x-panel-dd-spacer');this.objectPanel.addClass('x-panel-dd-filler');}},showWelcomeMsg:function(){this.removeObjectPanel();if(this.objectPanel){this.objectPanel.addClass('x-panel-dd-spacer');this.objectPanel.removeClass('x-panel-dd-filler');}},isSalesforceSyncEnabled:function(){return Mkt.apps.ObjectSync.isSalesforceSyncEnabled();},objectSyncRequest:function(animEl){var objectPanel=this.objectPanel;var os=Mkt.apps.ObjectSync;if(!objectPanel.nodeId){MktMessage.showWarning(os.selectObjectWarning,undefined,animEl);return;}else if(!os.salesforceEnableProcess("sync a new object",animEl,this.objectSyncRequest.createDelegate(this))){return;}else if(objectPanel.isCore){MktMessage.showWarningExt(os.onlySalesforceCustomTitle,os.onlySalesforceCustomWarning,undefined,animEl);return;}else if(objectPanel.isInUse()){MktMessage.showWarningExt(os.objectInUseTitle,os.objectInUseWarning,undefined,animEl);return;}
this.showSyncForm(animEl);},showSyncForm:function(animEl){if(this.objectPanel.picked){MktSession.clockCursor(true);MktSession.ajaxRequest('salesforce/stopSyncObjectRequest',{serializeParms:{nodeId:this.objectPanel.nodeId},onMySuccess:this.showSyncFormRequest.createDelegate(this,[animEl])});}else{this.showSyncFormRequest(animEl);}},showSyncFormRequest:function(animEl){var relationshipData;if(this.objectPanel.picked){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){relationshipData=this.decorateSelectedNode(this.currentNode.attributes.id,MktPage.appVars.stopStatus);}else{MktMessage.showWarning(MktPage.appVars.errMsg);return;}}else{relationshipData=Mkt.apps.ObjectSync.getRelationship(this.currentNode,(this.objectPanel.picked?"stopSync":"syncObject"));}
this.objectSyncForm=new Mkt.apps.ObjectSyncForm({animEl:animEl,active:this.objectPanel.active,picked:this.objectPanel.picked,implied:this.objectPanel.implied,objectName:this.objectPanel.objectName,updateObjectStatusCb:this.updateObjectStatus.createDelegate(this),relationshipData:relationshipData,nodeId:this.objectPanel.nodeId});this.objectSyncForm.show(animEl);},decorateSelectedNode:function(nodeId,treeObj){var origTreeObj=treeObj;while(treeObj){if(treeObj[0].id==nodeId){treeObj[0].text="<span class='stopSelectedObj'>"+treeObj[0].text+"</span>";break;}
if(treeObj&&treeObj[0]&&treeObj[0].children){treeObj=treeObj[0].children;}else{break;}}
return origTreeObj;},updateObjectStatus:function(nodeId,sync){if(MktPage.appVars.updatedStoppedNode){this.replaceNodes(nodeId,MktPage.appVars.updatedStoppedNode);}
this.updateTreeNodeStatus(nodeId,sync);Ext.apply(this.objectPanel,{picked:sync});this.objectPanel.updateSyncObjectButton();this.objectPanel.refreshCanvasHeader();var relationshipData=Mkt.apps.ObjectSync.getRelationship(this.currentNode);this.objectPanel.updateRelationship(relationshipData);var triggers=MktPage.appVars.triggers;var filters=MktPage.appVars.filters;this.objectPanel.updateFilterTrigger(filters,triggers);},replaceNodes:function(parentNodeId,nodes){var node=this.fieldTreePanel.getNodeById(parentNodeId);if(node){var expanded=node.isExpanded();var nodeAttr=Ext.apply({},node.attributes);nodeAttr.children=nodes;var newNode=new Ext.tree.AsyncTreeNode(nodeAttr);node.parentNode.replaceChild(newNode,node);if(expanded){newNode.expand(true);}}},updateTreeNodeStatus:function(nodeId,sync){var os=Mkt.apps.ObjectSync;var status;var childStatus;var prnNode;var originatingChildNode;var node=this.fieldTreePanel.getNodeById(nodeId);if(node){if(sync){status=os.pickedStatus;childStatus=os.impliedStatus;}else{status=(this.objectPanel.implied&&this.hasSyncedChild(node))?os.impliedStatus:os.notSyncedStatus;childStatus=this.objectPanel.implied?os.impliedStatus:os.notSyncedStatus;}
originatingChildNode=node;prnNode=node.parentNode;this.updateTreeNodeUIStatus(node,status);while(prnNode){if(prnNode.getDepth()<=1){break;}
var attr=prnNode.attributes;if(!attr.picked){var corrChildStatus;if(attr.implied&&this.hasSyncedChild(prnNode)&&!originatingChildNode.attributes.isRelNodeLeaf){corrChildStatus=os.impliedStatus;}else if(sync&&originatingChildNode.attributes.isRelNodeLeaf){corrChildStatus=os.pickedStatus;}else{corrChildStatus=childStatus;}
this.updateTreeNodeUIStatus(prnNode,corrChildStatus);}
originatingChildNode=prnNode;prnNode=prnNode.parentNode;}}},updateTreeNodeUIStatus:function(node,status){var os=Mkt.apps.ObjectSync;var removedClasses;var addClass;var implied;var picked;if(status==os.pickedStatus){removedClasses=[os.impliedIconCls,os.notSyncedIconCls];addClass=os.pickedIconCls;picked=true;implied=false;}else if(status==os.impliedStatus){removedClasses=[os.pickedIconCls,os.notSyncedIconCls];addClass=os.impliedIconCls;picked=false;implied=true;}else if(status==os.notSyncedStatus){removedClasses=[os.pickedIconCls,os.impliedIconCls];addClass=os.notSyncedIconCls;implied=picked=false;}
if(node){Ext.apply(node.attributes,{implied:implied,picked:picked,iconCls:addClass});var nodeUI=node.getUI();if(nodeUI){var iconEl=Ext.get(nodeUI.getIconEl());iconEl.removeClass(removedClasses);iconEl.addClass(addClass);}}},hasSyncedChild:function(node){if(!node.childNodes){return false;}
var childrenCount=node.childNodes.length;var attr;for(var i=0;i<childrenCount;i++){attr=node.childNodes[i]['attributes'];if(attr.implied||attr.picked){return true;}}
return false;},editVisibleFieldsRequest:function(animEl){var os=Mkt.apps.ObjectSync;if(!this.objectPanel.nodeId){MktMessage.showWarning(os.selectObjectWarning,undefined,animEl);return;}else if(!os.salesforceEnableProcess("edit field visibility",animEl,this.editVisibleFieldsRequest.createDelegate(this))){return;}else if(this.objectPanel.isCore){MktMessage.showWarningExt(os.onlySalesforceCustomTitle,os.onlySalesforceCustomWarning,undefined,animEl);return;}else if(!this.objectPanel.showTriggers&&!this.objectPanel.showConstraints){MktMessage.showWarning(String.format(os.filterTriggerNotSupportedWarning,this.objectPanel.objectName),undefined,animEl);return;}else if(!this.objectPanel.isSynced()){MktMessage.showWarningExt(os.objectNotSyncTitle,String.format(os.objectNeedsToBeSyncWarning,this.objectPanel.objectName),undefined,animEl);return;}else if(this.objectPanel.isInUse()){MktMessage.showWarningExt(os.objectInUseTitle,os.objectInUseFieldVisibilityWarning,undefined,animEl);return;}
this.editVisibleFieldsForm=new Mkt.apps.EditVisibleFieldsForm({animEl:animEl,nodeId:this.objectPanel.nodeId,showTriggers:this.objectPanel.showTriggers,showConstraints:this.objectPanel.showConstraints,editFieldVisibilityCb:this.editVisibleFieldsDone.createDelegate(this)});this.editVisibleFieldsForm.show(animEl);},editVisibleFieldsDone:function(nodeId){this.objectPanel.refreshFieldsGrid();},createFilterFieldTreePanel:function(config){this.fieldTreePanel=new Mkt.widget.FieldTreePanel({dataUrl:this.fieldTreeUrl,selModel:new MktExplorerSelectionModel(),enableCache:false,frame:false,autoScroll:true});this.palette=new Mkt.widgets.AsyncFilterTreePanel({layout:'fit',width:config.paletteWidth,filterFieldPadding:10,frame:false,autoScroll:false,items:new Ext.Panel({cls:'mktSmartPaletteTree mktAsyncSmartPaletteTree',frame:true,layout:'fit',autoScroll:false,items:[this.fieldTreePanel]})});this.palette.bindTree(this.fieldTreePanel);return this.palette;}});Mkt.apps.ObjectPanel=Ext.extend(Mkt.widget.LayoutFormPanel,{cls:'mktObjectPanel',objectName:"Object Name",objectDescription:"Object Description",bodyStyle:'margin: 0; overflow: auto;',loadingPropertyText:'',stopSyncText:Mkt.apps.ObjectSync.stopSyncText,syncObjectText:Mkt.apps.ObjectSync.syncObjectText,objectFieldsId:'objectFields',objectRenameCb:Ext.emptyFn,initComponent:function(){this.items=this.items||[];Mkt.apps.ObjectPanel.superclass.initComponent.call(this);this.on('beforedestroy',function(){this.cancelLoad=true;});this.getObjectProperties();},getObjectProperties:function(){this.showLoadingMask();MktSession.ajaxRequest('salesforce/getObjectProperties',{serializeParms:{nodeId:this.nodeId},onMySuccess:this.getObjectPropertiesDone.createDelegate(this)});},getObjectPropertiesDone:function(){if(this.cancelLoad){return;}
this.buildObjectComponents();this.doLayout();this.updateSyncObjectButton();this.hideLoadingMask();},showLoadingMask:function(){var objectSync=Mkt.apps.ObjectSync;var statusBtn=MktCanvas.getRegisteredItem(objectSync.statusBtnKey,objectSync.panelId);if(statusBtn&&statusBtn.isVisible()){statusBtn.setVisible(false);}
window.setTimeout(function(){if(!this.mask){this.mask=new Ext.LoadMask(this.body,{msg:this.loadingPropertyText});}
this.mask.show();}.createDelegate(this),0);},hideLoadingMask:function(){if(this.mask){this.mask.hide();this.mask.destroy();delete this.mask;}},updateSyncObjectButton:function(){var objectSync=Mkt.apps.ObjectSync;var syncObjectBtn=Mkt.apps.ObjectSync.Buttons[Mkt.apps.ObjectSync.syncObjectBtnKey];var editFieldVisBtn=Mkt.apps.ObjectSync.Buttons[Mkt.apps.ObjectSync.editVisibleFieldsBtnKey];var text="";var iconCls="";var statusBtnText="";if(this.picked){text=objectSync.stopSyncText;statusBtnText="Status: Sync Enabled";iconCls=objectSync.stopSyncIconCls;statusBtnIconCls="mkiOk";}else if(this.implied){text=objectSync.syncObjectText;statusBtnText="Status: Sync Implied";iconCls=objectSync.syncObjectIconCls;statusBtnIconCls=objectSync.impliedIconCls;}else{text=objectSync.syncObjectText;iconCls=objectSync.syncObjectIconCls;statusBtnText="Status: Sync Disabled";statusBtnIconCls=objectSync.notSyncedStatusIconCls;}
if(syncObjectBtn){syncObjectBtn.setText(text);syncObjectBtn.setIconClass(iconCls);syncObjectBtn.setDisabled(this.picked&&this.isInUse());}
if(editFieldVisBtn){editFieldVisBtn.setDisabled((!this.picked||this.isInUse()));}
var statusBtn=MktCanvas.getRegisteredItem(objectSync.statusBtnKey,objectSync.panelId);if(statusBtn){statusBtn.setText(statusBtnText);statusBtn.setIconClass(statusBtnIconCls);if(!statusBtn.isVisible()){statusBtn.setVisible(true);}}
this.statusField.clearList();this.statusField.addListItem({text:this.getStatusText(),iconCls:this.getStatusIconCls()});},buildCanvasHeader:function(){var titleEditable=true;var titleReadonlyReason="";var objDesc=MktPage.appVars.desc;this.isCore=MktPage.appVars.isCore;var usedIn=MktPage.appVars.usedIn;var inUse=false;if(usedIn&&usedIn.length&&usedIn.length>0){inUse=true;titleEditable=false;titleReadonlyReason="Object in use is read-only";}else if(this.isCore){titleEditable=false;titleReadonlyReason="Standard objects are read-only";}else if(this.isSynced()){titleEditable=false;titleReadonlyReason="Synced objects are read-only";}
var objectHeader=new Mkt.widgets.CanvasHeader({titleValue:this.objectName,descValue:objDesc,width:550,editWidth:550,editTitleWidth:350,editDescWidth:350,titleEditable:titleEditable,titleReadonlyReason:titleReadonlyReason,savedCallback:this.objectRenameDone.createDelegate(this),editable:true,titleId:'newObjectName',descId:'newObjectDesc',actionUrl:'salesforce/editObjectMetaInfo',serializeParms:{nodeId:this.nodeId}});return objectHeader;},refreshCanvasHeader:function(){this.objectHeaderCnt.removeAll();this.objectHeader=this.buildCanvasHeader();this.objectHeaderCnt.add(this.objectHeader);this.objectHeaderCnt.doLayout();},buildObjectComponents:function(){var property=[];this.objectHeader=this.buildCanvasHeader();this.objectHeaderCnt=new Ext.Panel({plain:true,style:'padding: 0; margin: 0',cls:'x-plain',items:[this.objectHeader]});this.add(this.objectHeaderCnt);this.properties=this.buildProperties();this.fields=this.buildFields();var reservedHeight=127;this.objectComponents=new Mkt.apps.ObjectSyncTabPanel({reservedHeight:reservedHeight,items:[{title:"Object Properties",baseCls:'objectPropertyBase',style:'padding: 10px',id:"objectProperties",items:this.properties},{title:"Fields",style:'padding: 10px;',id:this.objectFieldsId,items:this.fields}],resizeHandler:this.resizeHandler.createDelegate(this),listeners:{tabchange:function(tp,p){if(!p.initialized){this.doLayout();p.initialized=true;}
if(p.id==this.objectFieldsId){if(!p.gridLoaded){this.gridFields.getStore().reload();p.gridLoaded=true;}
this.resizeHandler();}}.createDelegate(this)}});this.add(this.objectComponents);return property;},objectRenameDone:function(){var title=this.objectHeader.getTitleField().getValue();var desc=this.objectHeader.getDescField().getValue();this.objectName=title;this.objectDesc=desc;this.objectRenameCb(title);},resizeHandler:function(){if(this.gridFields&&this.gridFields.container){this.gridFields.setHeight(this.gridFields.container.getHeight());this.gridFields.setWidth(this.gridFields.container.getWidth());}},refreshFieldsGrid:function(){var activeTab=this.objectComponents.getActiveTab();if(activeTab.id==this.objectFieldsId){this.gridFields.getStore().reload();activeTab.gridLoaded=true;}else{var tab=this.objectComponents.getItem(this.objectFieldsId);if(tab){tab.gridLoaded=false;}}},isInUse:function(){if(this.usedByObject.itemCount){return true;}else{if(MktPage.appVars.usedIn&&MktPage.appVars.usedIn.length>0){return true;}}
return false;},isSynced:function(){return(this.implied||this.picked);},getStatusText:function(){var text="Sync Disabled";if(!this.active||this.picked){text="Sync Enabled";}else if(this.implied){text="Sync Implied";}
return text;},getStatusIconCls:function(){var os=Mkt.apps.ObjectSync;var iconCls=os.notSyncedStatusIconCls;if(!this.active){iconCls="mkiSignWarning";}else if(this.picked){iconCls=os.pickedIconCls;}else if(this.implied){iconCls=os.impliedIconCls;}
return iconCls;},updateRelationship:function(relationshipData){this.relationship.clearList();this.relationshipData=relationshipData;this.relationship.addTreeItem(relationshipData);},buildProperties:function(){this.properties=[];var synced=this.isSynced();this.statusField=new Mkt.widgets.ListField({cls:'formItem',style:'height: 21px;',fieldLabel:"Status:",itemTmpl:'<div style="margin-left: 20px;" > <div style="line-height:20px; width:auto; display:inline;">'+'<div style="position:relative; display:block; margin-left: -20px;">'+'<div class="mki16 {iconCls}">'+'</div>'+'</div>'+'{text}</div></div>',value:{}});this.properties.push(this.statusField);this.relationship=new Mkt.widgets.TreeField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:"Relationship:",data:this.relationshipData});this.properties.push(this.relationship);var relationshipField=MktPage.appVars.relationshipField;this.relationshipField=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:"Relationship Field:",itemTmpl:'<div style="height: 18px;">{text}</div>',value:{text:relationshipField.toString()}});this.properties.push(this.relationshipField);var filters=MktPage.appVars.filters;this.filtersField=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:'Filters:',itemTmpl:'<div style="height: 18px;">{text}</div>',values:filters});this.properties.push(this.filtersField);var triggers=MktPage.appVars.triggers;this.triggersField=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:'Triggers:',itemTmpl:'<div style="height: 18px;">{text}</div>',values:triggers});this.properties.push(this.triggersField);var sfdcRows=MktPage.appVars.sfdcRows||0;this.numRows=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:"Salesforce Rows:",itemTmpl:'<div style="height: 18px;">{text}</div>',value:{text:sfdcRows.toString()}});this.properties.push(this.numRows);var marketoRows=MktPage.appVars.marketoRows;this.rowsSynced=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:"Marketo Rows:",itemTmpl:'<div style="height: 18px;">{text}</div>',value:{text:marketoRows.toString()}});this.properties.push(this.rowsSynced);this.usedByObject=new Mkt.widgets.ListField({cls:'formItem',style:'margin-top: 11px; margin-left: 12px;',fieldLabel:'Object Used By:',itemTmpl:'<div style="margin-left: 20px;" > <div style="line-height:20px; width:auto; cursor:pointer; display:inline;">'+'<div style="position:relative; display:block; margin-left: -20px;">'+'<div class="mki16 {iconCls}">'+'</div>'+'</div>'+'{text}</div></div>'});this.properties.push(this.usedByObject);this.usedByObjectValue=this.usedByObject.items.items[1];this.usedByObject.on('render',function(){window.setTimeout(function(){var usedIn=MktPage.appVars.usedIn;if(usedIn.length>0){for(var i=0;i<usedIn.length;i++){this.usedByObject.addListItem({iconCls:usedIn[i].iconCls,text:usedIn[i].text},function(){MktDlManager.loadDl(this.xtra);}.createDelegate(usedIn[i]));}}else{Ext.DomHelper.append(this.usedByObjectValue.bwrap,{tag:'div',html:'None'});}}.createDelegate(this),150);}.createDelegate(this));return this.properties;},buildFields:function(){var fields=[{name:'id',type:'auto'},{name:'name',type:'string'},{name:'type',type:'string'},{name:'constraintEnabled',type:'auto'},{name:'triggerEnabled',type:'auto'}];this.showTriggers=MktPage.appVars.showTriggers;this.showConstraints=MktPage.appVars.showConstraints;var cmObj=[{id:'name',header:'Name',dataIndex:'name',sortable:true,width:100},{id:'type',header:'Type',dataIndex:'type',sortable:true,width:150}];if(this.showConstraints){cmObj.push({id:'constraintsEnabled',header:'Constraint',dataIndex:'constraintEnabled',renderer:Mkt.util.Format.documentStatusRenderer,sortable:true,width:100});}
if(this.showTriggers){cmObj.push({id:'triggerEnabled',header:'Trigger',dataIndex:'triggerEnabled',renderer:Mkt.util.Format.documentStatusRenderer,sortable:true,width:100});}
var cm=new Ext.grid.ColumnModel(cmObj);this.gridFields=new MktGrids.CanvasGridPanel({cm:cm,disableSelection:true,enablePurpleCorners:false,maskCanvas:false,loadMask:true,stateful:false,cls:'mktChartsGrid no-grid-back chartToolbar gridChartToolbar',bodystyle:'padding: 10px 10px 0 10px',height:100,reservedHeight:82,stripeRows:true,loadMask:true,ds:new Ext.data.JsonStore({url:'salesforce/getAllObjectFields',totalProperty:'totalFieldCount',fields:fields,remoteSort:false,baseParams:{nodeId:this.nodeId},root:'data',sortInfo:{field:'name',direction:'ASC'}}),trackMouseOver:false,autoExpandColumn:'name'});return[this.gridFields];},updateFilterTrigger:function(filters,triggers){this.filtersField.clearList();this.filtersField.addListItems(filters);this.triggersField.clearList();this.triggersField.addListItems(triggers);},buildPreview:function(){this.preview=[];return this.preview;}});Mkt.apps.ObjectSyncTabPanel=Ext.extend(MktPanel.CanvasResizableTabPanel,{reservedWidth:300,fitToCanvas:true,plain:true,style:"margin-top: 10px;",activeTab:0,autoScroll:true,cls:'objectPanelTab',resizeHandler:Ext.emptyFn,initComponent:function(){Mkt.apps.ObjectSyncTabPanel.superclass.initComponent.call(this);},canvasResized:function(){Mkt.apps.ObjectSyncTabPanel.superclass.canvasResized.apply(this,arguments);this.resizeHandler();},syncHeightToCanvas:function(){Mkt.apps.ObjectSyncTabPanel.superclass.syncHeightToCanvas.apply(this,arguments);}});Mkt.apps.ObjectSyncForm=Ext.extend(Ext.Window,{width:400,height:225,title:"Sync Object",resizable:true,cls:'objectSyncForm',iconCls:'mkiDataOk',layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px; overflow-y: auto;',buttonAlign:'right',syncText:'The checked objects will be synced with your Marketo account',stopSyncTextRemove:'<span class="mktFailed">Warning:</span> Stopping sync will remove all data for the objects listed below in Marketo only',stopSyncTextDisable:'<span class="mktFailed">Warning:</span> This will stop syncing data for the objects listed below',updateObjectStatusCb:Ext.emptyFn,initComponent:function(){this.title=this.getTitle();this.items=this.items||[];this.errorPanel=new Ext.Panel({baseCls:'x-plain',plain:true,cls:'mktModalErrorMessage',hidden:true,anchor:"100%",html:this.errMessage});this.items.push(this.errorPanel);var warn="";if(this.implied&&this.picked){warn=this.stopSyncTextDisable;}else if(this.picked){warn=this.stopSyncTextRemove;}else{warn=this.syncText;}
this.items.push({baseCls:'x-plain',style:'padding-top: 10px; padding-bottom: 15px;',anchor:"100%",html:warn});var relData=this.relationshipData||[];this.items.push(new Mkt.widgets.TreeField({width:300,anchor:"100%",style:'padding-bottom: 15px;',hideLabel:true,hideFieldLabel:true,data:relData}));this.buttons=this.button||[];var objectSync=Mkt.apps.ObjectSync;this.buttons.push({text:this.picked?objectSync.stopSyncText:objectSync.syncObjectText,iconCls:this.picked?objectSync.stopSyncIconCls:objectSync.syncObjectIconCls,handler:this.objectSyncSubmit.createDelegate(this)});this.buttons.push({text:"Cancel",iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.ObjectSyncForm.superclass.initComponent.call(this);},showModalError:function(errMsg){if(!this.errorPanel.isVisible()){this.errorPanel.setVisible(true);}
this.errorPanel.body.update(errMsg);},isSynced:function(){return(this.implied||this.picked);},getTitle:function(){var action="";if(this.picked){action=Mkt.apps.ObjectSync.stopSyncText;}else{action=Mkt.apps.ObjectSync.syncObjectText;}
return action+" - "+this.objectName;},buildRelationship:function(){this.objectRel=new Mkt.widgets.TreeField({hideLabel:true,data:this.data});},objectSyncSubmit:function(){MktSession.clockCursor();var sync=!this.picked;MktSession.ajaxRequest('salesforce/syncObject',{serializeParms:{nodeId:this.nodeId,sync:sync},onMySuccess:this.objectSyncDone.createDelegate(this,[this.nodeId,sync])});},syncObjectProcess:function(){MktMessage.show({title:Mkt.apps.ObjectSync.salesforceInProgressTitle,msg:Mkt.apps.ObjectSync.salesforceTryAgain,buttons:[{text:"Try again",iconCls:'mkiOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:'mki48Help2',okCallback:function(){this.objectSyncSubmit();}.createDelegate(this),animateTarget:undefined});},objectSyncDone:function(nodeId,sync){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){Mkt.apps.FieldManager.clearFieldTreeCache();this.close();this.updateObjectStatusCb(nodeId,sync);}else if(result==MktSession.resultBusy){this.close();this.syncObjectProcess();}else{if(this.isVisible()){this.showModalError(MktPage.appVars.errMsg);}else{MktMessage.showWarning(MktPage.appVars.errMsg,undefined,this.animEl);}}},updateObjectProperties:function(){Ext.apply(this,{picked:sync,implied:false});}});Mkt.apps.EditVisibleFieldsForm=Ext.extend(Ext.Window,{width:500,height:350,title:"Edit Visible Fields",resizable:true,cls:'editVisibleFieldsForm',iconCls:'mkiMagnifyingGlass',layout:'anchor',plain:true,modal:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',editFieldVisibilityCb:Ext.emptyFn,initComponent:function(){this.items=[{baseCls:'x-plain',anchor:'100% 7%'},this.buildGridFieldsForm()];this.buttons=this.buttons||[];this.buttons.push({text:'Save',iconCls:'mkiOk',handler:function(){this.saveFieldVisibility();this.close();}.createDelegate(this)});this.buttons.push({text:"Cancel",iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.EditVisibleFieldsForm.superclass.initComponent.call(this);},saveFieldVisibility:function(){var modRecs=this.gridFieldsForm.getStore().getModifiedRecords();var buff={};var data;var sent=false;if(modRecs&&modRecs.length>0){var recCount=modRecs.length;for(var i=0;i<recCount;i++){data=modRecs[i]['data'];buff[data['id']]=[data['constraintEnabled'],data['triggerEnabled']];}
this.saveFieldVisibilitySubmit(buff);}},saveFieldVisibilitySubmit:function(fieldJson){MktSession.ajaxRequest('salesforce/setFieldVisibility',{serializeParms:{fieldJson:Ext.encode(fieldJson),nodeId:this.nodeId},onMySuccess:this.saveFieldVisibilityDone.createDelegate(this)});},saveFieldVisibilityDone:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){Mkt.apps.FieldManager.clearFieldTreeCache();this.editFieldVisibilityCb(this.nodeId);}else if(result==MktSession.resultBusy){this.saveFieldVisibilityProcess();}else if(MktPage.appVars.errMsg.length>0){MktMessage.showWarning(MktPage.appVars.errMsg);}},saveFieldVisibilityProcess:function(){var os=Mkt.apps.ObjectSync;MktMessage.show({title:os.salesforceEnabledTitle,msg:os.salesforceTryAgain,buttons:[{text:"Try again",iconCls:'mkiOk',handler:MktMessage.okClicked},{text:'Cancel',iconCls:'mkiCancel',handler:MktMessage.cancelClicked}],icon:'mki48Help2',okCallback:function(){this.saveFieldVisibilitySubmit();}.createDelegate(this),animateTarget:undefined});},buildGridFieldsForm:function(){var fields=[{name:'id',type:'auto'},{name:'name',type:'string'},{name:'type',type:'string'},{name:'constraintEnabled',type:'bool'},{name:'triggerEnabled',type:'bool'}];var cmConfig=[{id:'name',header:'Name',dataIndex:'name',sortable:true,width:100},{id:'type',header:'Type',dataIndex:'type',sortable:true,width:100}];var plugins=[];var constraintCheckColumn;if(this.showConstraints){constraintCheckColumn=new MktGrids.CheckColumn({header:'Constraint',dataIndex:'constraintEnabled',sortable:true,width:100});cmConfig.push(constraintCheckColumn);plugins.push(constraintCheckColumn);}
var triggerCheckColumn;if(this.showTriggers){triggerCheckColumn=new MktGrids.CheckColumn({header:'Trigger',dataIndex:'triggerEnabled',sortable:true,width:100});cmConfig.push(triggerCheckColumn);plugins.push(triggerCheckColumn);}
var cm=new Ext.grid.ColumnModel(cmConfig);var gridConfig={cm:cm,disableSelection:true,cls:'editFieldVisibleGrid',enablePurpleCorners:false,maskCanvas:false,loadMask:true,stateful:false,bodystyle:'padding: 10px 10px 0 10px',isEditor:true,clicksToEdit:true,width:400,height:300,anchor:"100% 93%",stripeRows:true,loadMask:true,ds:new Ext.data.JsonStore({url:'salesforce/getAllObjectFields',totalProperty:'totalFieldCount',fields:fields,remoteSort:false,baseParams:{nodeId:this.nodeId,includeInactive:false},root:'data',sortInfo:{field:'name',direction:'ASC'}}),trackMouseOver:false,autoExpandColumn:'name'};if(plugins.length>0){gridConfig.plugins=plugins;}
this.gridFieldsForm=new MktGrids.CanvasGridPanel(gridConfig);gridFieldsForm=this.gridFieldsForm;this.gridFieldsForm.getStore().reload();return this.gridFieldsForm;}});Mkt.apps.SfdcSyncStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:'Salesforce Sync Status',id:'sfdcSyncStatusWindow',cls:'SfdcSyncStatusWindow',initComponent:function(){Mkt.apps.SfdcSyncStatusWindow.superclass.initComponent.call(this);},updateTitleStatus:function(){this.setTitle(this.title);},renderStatus:function(){var container=Ext.DomHelper.append(this.body.dom,{tag:'div',style:'float: left;'});var iconContainer=Ext.DomHelper.append(container,{tag:'div',style:'float: left;'});var textContainer=Ext.DomHelper.append(container,{tag:'div',style:'float: left; padding-top:8px; padding-left: 10px; font-size:12px;'});var el=Ext.DomHelper.append(textContainer,{tag:'a',href:'#',html:'Salesforce sync is disabled'},true);el.on('click',this.navigateSalesforce.createDelegate(this));el.dom.onclick=function(){return false;};var imgEl=Ext.DomHelper.append(iconContainer,{tag:'img',style:'padding-top: 9px;',src:'/images/icons16/data_forbidden.png'});},navigateSalesforce:function(){MktDlManager.loadDl({type:"CustAdmin",compSubtype:"integration",panelId:"cadSfdcSettings",nodeId:304});this.close();}});Mkt.apps.SfdcSyncStatusWindow.showWindow=function(){var stat=Mkt.apps.SfdcSyncStatusWindow.win;if(!stat){stat=new Mkt.apps.SfdcSyncStatusWindow({renderTo:Ext.getBody()});Mkt.apps.SfdcSyncStatusWindow.win=stat;}
stat.show();return stat;};Mkt.apps.SfdcSyncStatusWindow.hideWindow=function(){var win=Mkt.apps.SfdcSyncStatusWindow.win;if(win){win.close();delete Mkt.apps.SfdcSyncStatusWindow.win;}};
/* ========== ../mkt-ext-2.0/apps/programs.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.programs');Mkt.apps.programs.renderActivityLog=function(canvas,programId,timezone){this.canvas=canvas;this.programId=programId;this.timezone=timezone;leadNameTemplate=new Ext.Template('<a href="{leadHref}" target="_blank" title="{leadName} (Lead ID: {leadId})">{leadName}</a>');leadNameTemplate.compile();displayLeadName=function(v,p,record,rx,cx,ds){var leadHref=MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+record.data.leadId+'&panel=activity';return leadNameTemplate.apply({leadHref:leadHref,leadId:record.data.leadId,leadName:record.data.leadName});};displayActivityDetail=function(v,p,record,rx,cx,ds){if(record.data.resultCode=='Failure'){v='<span style="font-weight: bold; color: red;">'+v+'</span>';}
return v;};var cm=new Ext.grid.ColumnModel([{header:'ID',id:'historyLogId',dataIndex:'historyLogId',sortable:true,width:80},{header:'Date/Time ('+timezone+')',id:'dateAndTime',dataIndex:'dateAndTime',sortable:true,width:140},{header:'Campaign',id:'campaignName',dataIndex:'campaignName',sortable:true,width:140},{header:'Activity Type',id:'actionName',dataIndex:'actionName',sortable:true,width:140},{header:'Detail',id:'detail',dataIndex:'detail',renderer:displayActivityDetail,sortable:true,width:140},{header:'Lead Name',id:'leadName',dataIndex:'leadName',renderer:displayLeadName,sortable:true,width:140},{header:'Company',id:'company',dataIndex:'company',sortable:true,width:140}]);var fields=[{name:'campaignName'},{name:'leadName'},{name:'company'},{name:'resultCode'},{name:'actionName'},{name:'detail'},{name:'dateAndTime'},{name:'historyLogId'},{name:'assetId'},{name:'detailJson'},{name:'actionTypeId'},{name:'actionAssetType'},{name:'leadId'}];var pageSize=200;var ds=new Ext.data.JsonStore({url:'/explorer/queryActivityLogData',baseParams:{programId:programId,limit:pageSize},root:'data',totalProperty:'totalCount',fields:fields,remoteSort:true});this.grid=new MktGrids.CanvasGridPanel({id:'programActivityLog_'+programId,programId:programId,canvas:canvas,enableTotalCountAsyncLoading:true,totalCountAsyncUrl:'explorer/getActivityLogCount',totalCountAsyncParams:{id:programId,countFor:'program results'},cm:cm,ds:ds,editable:false,pageSize:pageSize,enablePaging:true,enableSearchPaging:true,searchEmptyText:'Quick Find...',searchQtip:'Search for activity and leads.',pagingEmptyMsg:'No activities found',autoSizeColumns:true,autoExpandColumn:'detail',timezone:timezone,enableExport:true,enableTotal:true,exportUrl:'/explorer/exportActivityLogData?programId='+programId+'&dir=DESC&limit=20000',defaultSort:'historyLogId',defaultOrder:'DESC',beforeLoadMaskMsg:'Loading combined results...',afterLoadMaskMsg:'Loading {0} log events...'});this.activityFilters=new Mkt.widgets.ActivityFilters(this.grid,'/leadDatabase/saveActLogFilter');MktCanvas.fillCanvasGrid(this.grid,canvas);MktCanvas.extendToolbar(this.activityFilters.buildToolbar(),canvas);this.grid.loadPagedGrid();return this;};
/* ========== ../mkt-ext-2.0/apps/Progressions.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.progressions');Mkt.apps.progressions.renderProgressionsList=function(canvas){var columnModel=new Ext.grid.ColumnModel([{header:'Progression Name',id:'name',dataIndex:'name',sortable:false,width:380},{header:'Number of Steps',id:'steps',dataIndex:'statuses',sortable:false,width:140},{header:'Used By',id:'usedBy',dataIndex:'events',sortable:false,width:140}]);var fields=[{name:'name'},{name:'statuses'},{name:'events'}];var pageSize=200;var store=new Ext.data.JsonStore({url:'/marketingEvent/getProgressions',baseParams:{},root:'data',totalProperty:'totalCount',fields:fields,remoteSort:true});this.grid=new MktGrids.CanvasGridPanel({id:'progressionsGrid',cm:columnModel,ds:store,editable:false,enablePaging:false,searchEmptyText:'Quick Find...',searchQtip:'Search for progressions.',pagingEmptyMsg:'No progressions found',autoSizeColumns:true,autoExpandColumn:'name',enableExport:false,enableTotal:true,defaultSort:'name',defaultOrder:'ASC',beforeLoadMaskMsg:'Loading progressions...',afterLoadMaskMsg:'Loading {0} progressions...'});MktCanvas.fillCanvasGrid(this.grid,canvas);this.grid.loadPagedGrid();return this;};
/* ========== ../mkt-ext-2.0/apps/campaigns.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.campaigns');Mkt.apps.campaigns.ActivityGridPanel=function(config){Mkt.apps.campaigns.ActivityGridPanel.superclass.constructor.call(this,config);};Ext.extend(Mkt.apps.campaigns.ActivityGridPanel,MktGrids.CanvasGridPanel,{editable:false,layout:'fit',enablePaging:true,enableSearchPaging:true,searchEmptyText:'Quick Find...',searchQtip:'Search for activity and leads.',autoSizeColumns:true,pagingEmptyMsg:'No activities found',autoExpandColumn:'detail',enableExport:true,defaultSort:'historyLogId',defaultOrder:'DESC',beforeLoadMaskMsg:'Loading campaign results...',afterLoadMaskMsg:'Loading {0} log events...',enableTotalCountAsyncLoading:true,totalCountAsyncUrl:'smartcampaigns/getActivityLogCount',initComponent:function(){this.id='activityLog_'+this.smartCampaignId;this.totalCountAsyncParams={id:this.smartCampaignId,countFor:'campaign results'};this.leadNameTemplate=new Ext.Template('<a href="{leadHref}" target="_blank" title="{leadName} (Lead ID: {leadId})">{leadName}</a>');this.leadNameTemplate.compile();this.exportUrl='/smartcampaigns/exportActivityLogData?smartCampaignId='+this.smartCampaignId+'&dir=DESC&limit=20000';var clickId=new MktGrids.ButtonColumn({id:"historyLogId",header:"ID",dataIndex:'historyLogId',sortable:true,align:'left',width:80,clickHandler:function(rowIndex,record){Mkt.apps.campaigns.showActLogDetailModal(record);}});this.plugins=clickId;this.cm=new Ext.grid.ColumnModel([clickId,{header:'Date/Time ('+this.timezone+')',id:'dateAndTime',dataIndex:'dateAndTime',sortable:true,width:140},{header:'Activity Type',id:'actionName',dataIndex:'actionName',sortable:true,width:140},{header:'Detail',id:'detail',dataIndex:'detail',renderer:this.displayActivityDetail,sortable:true,width:140},{header:'Lead Name',id:'leadName',dataIndex:'leadName',renderer:this.displayLeadName.createDelegate(this),sortable:true,width:140},{header:'Email',id:'email',dataIndex:'email',sortable:true,width:140},{header:'Company',id:'company',dataIndex:'company',sortable:true,width:140}]);var fields=[{name:'leadName'},{name:'email'},{name:'company'},{name:'resultCode'},{name:'actionName'},{name:'detail'},{name:'dateAndTime'},{name:'historyLogId'},{name:'assetId'},{name:'detailJson'},{name:'actionTypeId'},{name:'actionAssetType'},{name:'leadId'}];this.ds=new Ext.data.JsonStore({url:'/smartcampaigns/queryActivityLogData',baseParams:{smartCampaignId:this.smartCampaignId,limit:this.pageSize},root:'data',totalProperty:'totalCount',fields:fields,remoteSort:true});this.on('rowdblclick',this.handleDblClick);Mkt.apps.campaigns.ActivityGridPanel.superclass.initComponent.call(this);},displayLeadName:function(v,p,record,rx,cx,ds){var leadHref=MktSession.getUrlPrefix()+'/leadDatabase/loadLeadDetail?leadId='+record.data.leadId+'&panel=activity';return this.leadNameTemplate.apply({leadHref:leadHref,leadId:record.data.leadId,leadName:record.data.leadName});},displayActivityDetail:function(v,p,record,rx,cx,ds){if(record.data.resultCode=='Failure'){v='<span style="font-weight: bold; color: red;">'+v+'</span>';}
return v;},handleDblClick:function(grid,rowIndex,e){Mkt.apps.campaigns.showActLogDetailModal(this.store.getAt(rowIndex));}});Mkt.apps.campaigns.valueObjectToActLogDetailStr=function(objToConvert){if(objToConvert==null){return'';}
var str='';for(var name in objToConvert){if(isFunction(objToConvert[name])){continue;}
if(str.length>0){str+='<br/>';}
if(!isFinite(name)){str+=Ext.util.Format.htmlEncode(name)+': ';}
if(objToConvert[name]!=null&&isObject(objToConvert[name])){str+=Mkt.apps.campaigns.valueObjectToActLogDetailStr(objToConvert[name]);str+='<br/>';}else if(objToConvert[name]!=null){str+=objToConvert[name];}}
return str;};Mkt.apps.campaigns.showActLogDetailModal=function(record){var attrVals=[];var dj=record.data.detailJson;if(dj!=null){for(var attr in dj){attrVals.push({width:200,html:'<span style="font-size: 12px; font-weight: bold;">'+Ext.util.Format.htmlEncode(attr)+':</span>',cellCls:'mktActDetailModalAttrLabel'});var val=dj[attr];if(val==null){val='';}
else if(isObject(val)){val=Mkt.apps.campaigns.valueObjectToActLogDetailStr(val);}
attrVals.push({html:'<span style="font-size: 12px">'+val+'</span>'});}}
else{attrVals.push({html:'<span style="font-size: 12px">No attributes to display</span>'});}
var table=new Ext.Panel({baseCls:'plain',layout:'table',hideBorders:true,defaults:{baseCls:'plain',bodyStyle:'padding: 10px 5px'},layoutConfig:{columns:2},items:attrVals});var win=new Ext.Window({cls:'mktModalForm',iconCls:'mkiAbout',width:550,height:400,autoScroll:true,resizable:true,modal:true,buttonAlign:'right',title:'Activity Details &ndash; ID '+record.data.historyLogId,items:table,buttons:[{text:'Close',iconCls:Mkt.widgets.Forms.okButtonIconCls,handler:function(){win.hide();}}]});win.show();};Mkt.apps.campaigns.ActivityLog=function(canvas,smartCampaignId,timezone){this.grid=new Mkt.apps.campaigns.ActivityGridPanel({canvas:canvas,smartCampaignId:smartCampaignId,enableTotal:true,timezone:timezone,pageSize:200});this.activityFilters=new Mkt.widgets.ActivityFilters(this.grid,'/smartcampaigns/saveActLogFilter');MktCanvas.fillCanvasGrid(this.grid,canvas);MktCanvas.extendGutter(this.activityFilters.buildToolbar(),canvas);this.grid.loadPagedGrid();return this;};
/* ========== ../mkt-ext-2.0/apps/analytics.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.analytics','Mkt.apps.charts');MktCharts=Mkt.apps.charts;Mkt.apps.analytics.ReportSettings=Mkt.widgets.ReportSettings;Ext.apply(Mkt.apps.analytics,{getActiveReportId:function(){var tab=this.getActiveReportTab();if(tab){return tab.config.compId;}},getActiveReportName:function(){var tab=this.getActiveReportTab();if(tab){return tab.title;}},getActiveReportTab:function(){var tab=MktCanvas.getFirstTab();if(tab&&tab.config.compType=='report'&&tab.config.compId){return tab;}},addReportColumnDialog:function(button,e){var reportSettings=Mkt.apps.analytics.ReportSettings.data;var config={settings:reportSettings,reportId:reportSettings.data.reportId};var dialog=new Mkt.apps.analytics.AddReportColumnForm(config);dialog.show();},removeReportColumnSubmit:function(columnId){MktSession.ajaxRequest('analytics/removeReportColumn',{serializeParms:{reportId:Mkt.apps.analytics.getActiveReportId(),columnId:columnId},onMySuccess:this.removeReportColumnDone.createDelegate(this)});},removeReportColumnDone:function(results){this.clearReportCache(function(results){console.debug('Removed report column for reportId='+Mkt.apps.analytics.getActiveReportId(),'results=',results['JSONResults']);});},clearReportCache:function(onMySuccess){MktSession.ajaxRequest('/analytics/clearCache',{serializeParms:{'reportId':Mkt.apps.analytics.getActiveReportId()},onMySuccess:onMySuccess});},getChartObject:function(chartId){if(window.document[chartId])
{return window.document[chartId];}
if(navigator.appName.indexOf("Microsoft Internet")==-1)
{if(document.embeds&&document.embeds[chartId]){return document.embeds[chartId];}}
else
{return document.getElementById(chartId);}},saveDrilldown:function(button,e){var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div id="atxSaveDrilldownReportForm">'+'  <form id="atxSaveDrilldownReportSubmitForm" onsubmit="return false;">'+'    <input type="hidden" name="reportId" value="'+Mkt.apps.analytics.getActiveReportId()+'">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">New Report Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" tabindex="1" id="atxReportName" name="atxReportName" value="" maxsize="240" style="width: 90%" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" id="atxReportDesc" name="atxReportDesc" tabindex="2" title="description" rows="4"></textarea>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:'Save As...',iconCls:'mkiFloppyDisk',okButtonTitle:'Save',width:538,height:280});dialog.on('okclick',this.saveDrilldownSubmit.createDelegate(this));dialog.show(button.getEl());},saveDrilldownSubmit:function(){MktSession.clockCursor();MktSession.ajaxRequest('analytics/drilldownSave',{serializeForm:'atxSaveDrilldownReportSubmitForm',onMySuccess:this.saveDrilldownDone.createDelegate(this)});return false;},saveDrilldownDone:function(){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess&&window.opener&&window.opener.MktExplorer){window.opener.MktExplorer.addNodes([MktPage.appVars.addedNode]);MktPage.preventNavAway(false);window.location.reload(true);}}});Mkt.apps.analytics.DrilldownForm=Ext.extend(Ext.Window,{width:525,height:250,title:"Drill-Down",iconCls:'mkiPowerDrill',resizable:true,layout:'anchor',plain:true,modal:true,frame:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',groupUnitsField:'groupUnits',unitData:Mkt.widgets.ReportSettings.unitData,initComponent:function(){this.items=this.items||[];this.items.push({baseCls:'x-plain',cls:'x-form',anchor:'100%, 30%',layout:'form',style:"font-size: 12px; padding-top: 20px; padding-bottom: 10px;",items:[{baseCls:'x-plain',cls:'x-form',html:this.buildSmartlistDesc()}]});this.groupFieldset=this.buildGroupFieldset();this.items.push(this.groupFieldset);this.buttons=this.buttons||[];this.buttons.push({text:'Drill-Down',iconCls:'mkiPowerDrill',handler:this.createDrilldownSubmit.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.analytics.DrilldownForm.superclass.initComponent.call(this);},createDrilldownSubmit:function(){if(!this.groupCombo.validate()||!this.unitsCombo.validate()){return;}
var reportSettingsData=Mkt.apps.analytics.ReportSettings.data.data;var parms={reportId:this.reportId,group:this.selGroupJson.group,groupAttrId:this.selGroupJson.groupAttrId,groupAttrType:this.selGroupJson.groupAttrType,groupDatatype:this.selGroupJson.groupDatatype,groupUnits:this.selGroupJson.groupUnits,groupData:Ext.encode(this.selGroupJson),sourceGroupData:Ext.encode(reportSettingsData),operator:(this.operator=="in"?"is":this.operator),values:Ext.encode(this.values)};if(this.selGroupJson){MktSession.ajaxRequest('analytics/createDrilldownSubmit',{serializeParms:parms,onMySuccess:this.createDrilldownDone.createDelegate(this,[this.reportId])});MktSession.clockCursor();}},createDrilldownDone:function(reportId){MktSession.unclockCursor();if(MktPage.appVars.result==MktSession.resultSuccess){this.openDrillDown(MktPage.appVars.createdDrilldownId);}else if(MktPage.appVars.errMsg&&MktPage.appVars.errMsg.length>0){MktMessage.showWarning(MktPage.appVars.errMsg);}
this.close();},openDrillDown:function(reportId){if(isUndefined(reportId)){return;}
window.open(MktSession.getUrlPrefix()+"#AR"+reportId+"B!","_blank");},buildGroupFieldset:function(){var ReportSettings=Mkt.widgets.ReportSettings;var groupStore=new Ext.data.JsonStore({url:this.settings.phpModule+'/autosuggest',root:'suggest',fields:['report_group_name'],id:'aid',baseParams:{aid:37,atid:13,dataIndex:'report_group_name',displayField:'report_group_name'}});this.groupCombo=new Ext.form.ImprovedComboBox({fieldLabel:this.settings.reportNamePrefix,name:this.groupByField,store:groupStore,mode:'remote',valueField:'report_group_name',displayField:'report_group_name',typeAhead:false,forceSelection:true,allowBlank:false,triggerAction:'all',emptyText:'Select...',selectGroup:function(field,selection){if(selection.json.disabled){field.setValue(field.startValue);return;}
var json=selection.json;this.selGroupJson={group:json.report_group_name,groupAttrType:json.group,groupAttrId:json.aid,groupDatatype:json.dt};this.updateUnitOptions(this.selGroupJson.groupDatatype);}.createDelegate(this)});this.groupCombo.on('select',this.groupCombo.selectGroup,this.groupCombo);this.unitsCombo=new Ext.form.ImprovedComboBox({fieldLabel:'Units',name:this.groupUnitsField,store:this.unitData['--'],mode:'local',displayField:'label',typeAhead:true,forceSelection:true,triggerAction:'all',emptyText:'N/A'});this.unitsCombo.on('select',this.unitsSelected,this);this.groupFields=new Ext.FormPanel({layout:'anchor',anchor:'100%, 70%',style:'padding-top: 10px',baseCls:'x-plain',items:[{xtype:'fieldset',title:'Grouping',autoHeight:true,layout:'column',items:[{plain:true,header:false,layout:'form',baseCls:'x-plain',defaults:{anchor:'90%'},columnWidth:0.65,labelWidth:70,items:[this.groupCombo]},{plain:true,header:false,layout:'form',baseCls:'x-plain',defaults:{anchor:'90%'},columnWidth:0.35,labelWidth:40,items:[this.unitsCombo]}]}]});return this.groupFields;},unitsSelected:function(field,selection){if(selection&&selection.data&&selection.data.text){this.selGroupJson.groupUnits=selection.data.text;}},updateUnitOptions:function(datatype){if(this.unitsCombo&&datatype){var choices=this.unitData[datatype];var unitsValue=null;if(choices!==undefined){unitsValue=choices[0];var currentChoice=this.unitsCombo.getValue();if(choices.indexOf(currentChoice)!=-1){unitsValue=currentChoice;}
this.unitsCombo.store.loadData(choices,false);}
else{this.unitsCombo.store.removeAll();}
this.unitsCombo.setDisabled(unitsValue===null?true:false);this.unitsCombo.setValue(unitsValue);this.selGroupJson.groupUnits=unitsValue;}},buildSmartlistDesc:function(){var slDescription="";var smartlistText="";var operator="";switch(this.groupDatatype){case'integer':case'date':case'datetime':operator="between";var range=this.buildSmartlistRange(this.values,this.isDateType(this.groupDatatype));if(this.values.length==1&&!this.isUnitGrouped(this.groupDatatype,this.groupUnits)){operator="is";this.values=[range.rangeValuesArr[0]];}else{this.values=range.rangeValuesArr;}
smartlistText=range.rangeString;break;default:operator="is";smartlistText=this.buildSmartlistText(this.values);break;}
var group=this.group||"Unknown group";if(this.isRangeType(this.groupDatatype)){slDescription="Creating a drill-down on <b>"+group+"</b> "+operator+" "+smartlistText;}else{if(this.values.length<=1){slDescription="Creating drill-down on <b>"+group+"</b>: "+this.values[0];}else{slDescription="Creating drill-down on <b>"+group+"</b>: "+this.values.length+" values";}}
this.operator=operator;return slDescription;},isUnitGrouped:function(groupDatatype,groupUnit){var unitData=Mkt.widgets.ReportSettings.unitData;if(unitData[groupDatatype]&&unitData[groupDatatype][0]==groupUnit){return false;}else{return true;}},isDateType:function(type){return type=='date'||type=='datetime';},isRangeType:function(type){if(this.isDateType(type)){return true;}
return type=='integer';},buildSmartlistRange:function(values,isDate){var rangeString;var max=0;var min;var groupVal=0;var groupValEnd=0;var rangeArr=[];for(var i=0;i<values.length;i++){if(isDate){groupVal=(new Date(values[i].Group1)).getTime();groupValEnd=(new Date(values[i].Group1End)).getTime();}else{groupVal=values[i].Group1*1;groupValEnd=values[i].Group1End*1;}
max=Math.max(groupValEnd,max);if(isUndefined(min)){min=groupVal;}
min=Math.min(groupVal,min);}
if(isDate){max=(new Date(max)).format(Mkt.util.Format.longDateFormat);min=(new Date(min)).format(Mkt.util.Format.longDateFormat);rangeArr.push((new Date(min)).format(Mkt.util.Format.shortDateFormat));rangeArr.push((new Date(max)).format(Mkt.util.Format.shortDateFormat));}else{rangeArr.push(min);rangeArr.push(max);min=Mkt.util.Format.makeBigNumberPretty(min);max=Mkt.util.Format.makeBigNumberPretty(max);}
if(max==min){rangeString=max;}else{rangeString=min+" and "+max;}
return{rangeString:rangeString,rangeValuesArr:rangeArr};},buildSmartlistText:function(values){var buff=[];var vals=[];for(var i=0;i<values.length;i++){vals.push(values[i].Group1);}
this.values=vals;if(vals.length>2){vals=vals.slice(0,2);return vals.join(', ')+" and "+(values.length-2)+" more...";}else{return Mkt.util.Format.listToSentence(vals);}}});Mkt.apps.analytics.AddReportColumnForm=Ext.extend(Ext.Window,{width:525,autoHeight:true,title:"Add Custom Column",iconCls:'mkiTableColumnAdd',resizable:true,layout:'fit',plain:true,modal:true,frame:true,bodyStyle:'padding: 8px 15px 15px 15px;',buttonAlign:'right',reportId:null,initComponent:function(){this.items=this.items||[];this.smartlistFieldset=this.buildSmartlistFieldset();this.items.push(this.smartlistFieldset);this.buttons=this.buttons||[];this.buttons.push({text:'Add Custom Column',iconCls:'mkiTableColumnAdd',handler:this.addReportColumnSubmit.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.analytics.AddReportColumnForm.superclass.initComponent.call(this);},addReportColumnSubmit:function(){var smartlistName=this.smartlistCombo.getValue()||this.smartlistCombo.getRawValue();if(!this.reportId||smartlistName===''){return;}
MktSession.clockCursor();MktSession.ajaxRequest('analytics/addReportColumn',{serializeParms:{reportId:this.reportId,smartlistName:smartlistName},onMySuccess:this.addReportColumnDone.createDelegate(this)});},addReportColumnDone:function(results){MktSession.unclockCursor();if(results.JSONResults.invalidSmartlistName){this.smartlistCombo.markInvalid(results.JSONResults.invalidSmartlistName);return;}
this.close();MktCanvas.activateReactivateTab(Mkt.menus.Analytics.Toolbar.detailCanvasId);},resetSmartlistName:function(){},submitOnEnterPressed:function(field,e){if(e.getKey()==e.ENTER){this.addReportColumnSubmit();}},buildSmartlistFieldset:function(){var ReportSettings=Mkt.widgets.ReportSettings;var smartlistStore=new Ext.data.JsonStore({url:this.settings.phpModule+'/autosuggest',root:'suggest',fields:['smartlistName'],id:'aid',baseParams:{name:'Member of Smart List',dataIndex:'smartlistName',displayField:'smartlistName'}});this.smartlistCombo=new Ext.form.ImprovedComboBox({fieldLabel:'Smart List',name:'smartlistName',store:smartlistStore,mode:'remote',valueField:'smartlistName',displayField:'smartlistName',typeAhead:true,triggerAction:'all',emptyText:'Select...'});this.smartlistCombo.on('specialkey',this.submitOnEnterPressed,this);this.smartlistFields=new Ext.FormPanel({layout:'anchor',baseCls:'x-plain',items:[{xtype:'fieldset',title:'Count of Leads in Smart List',autoHeight:true,layout:'column',items:[{plain:true,header:false,layout:'form',baseCls:'x-plain',defaults:{anchor:'95%'},columnWidth:1.0,labelWidth:70,items:[this.smartlistCombo]}]}]});return this.smartlistFields;}});Mkt.apps.analytics.subscriptionFrequencies={getFrequencies:function(){return[['daily','Daily'],['monday','Every Monday'],['tuesday','Every Tuesday'],['wednesday','Every Wednesday'],['thursday','Every Thursday'],['friday','Every Friday'],['saturday','Every Saturday'],['sunday','Every Sunday'],['monthly','First of the month']];},getStore:function(){return new Ext.data.SimpleStore({fields:['value','description'],data:this.getFrequencies()});},getRenderer:function(){freqs=this.getFrequencies();dict={};len=freqs.length;for(var i=0;i<len;i++){var freq=freqs[i];dict[freq[0]]=freq[1];}
return function(value,p,record){p.css+='clickable x-grid3-cell-clickable';return dict[value]||value;};}};Mkt.apps.analytics.insertChart=function(chart){Mkt.apps.charts[chart.cc.chartId]=chart;chart.bbar=[];if(chart.cc.reportId){chart.customizeChart=function(options){MktSession.clockCursor(true);MktSession.ajaxRequest('/analytics/updateSummaryRowsJson',{serializeParms:Ext.apply({reportId:this.cc.reportId},options),onMySuccess:function(){MktCanvas.reactivateActiveTab(true);},onMyFailure:function(){MktSession.showMessage('Could not update chart','warn');}});};}
if(MktPage.isDev()){chart.bbar.push({text:'Debug',cls:'stealth',chartParams:chart,handler:function(button,e){console.group('Chart Debug Info');console.debug('Mkt.apps.analytics.insertChart params=',this.chartParams);console.debug('chart obj=',this);var chartEmbed=document.embeds[0];console.debug('chartEmbed=',chartEmbed);console.groupEnd();}});}
if(chart.cc.reportId&&chart.cc.chart_options){if(chart.cc.chart_options.indexOf('layout')!=-1){var layoutMenuItems=[{text:'Area',layout:'area',iconCls:'mkiChartArea'},{text:'Bar',layout:'bar',iconCls:'mkiChartBar'},{text:'Column',layout:'column',iconCls:'mkiChartColumn'},{text:'Line',layout:'line',iconCls:'mkiChartLine'},{text:'Pie',layout:'pie',iconCls:'mkiChartPie'}];for(var i=0;i<layoutMenuItems.length;i++){var layoutItem=layoutMenuItems[i];if(chart.cc.layout==layoutItem.layout){layoutItem.text='<b>'+layoutItem.text+'</b>';layoutItem.disabled=true;}
layoutItem.handler=function(item,e){chart.customizeChart({layout:item.layout});};}
chart.bbar.push({text:'Style',menu:{items:layoutMenuItems}});}}
if(!chart.cc.license&&MktPage.xfeatures){chart.bbar.push({text:'Refresh',cc:chart.cc,handler:function(button,e){console.debug('Refresh chart',this.cc);}});}
chart.bbar.push({text:'Full Screen',handler:function(button,e){window.open(chart.fullscreenUrl);}});chart.bbar.push({text:'Export',handler:function(button,e){MktMessage.showExport();location=chart.exportUrl;}});chart.renderBottomToolbar=function(){var elId='tbar_'+this.cc.chartId;var el=Ext.get(elId);if(el&&this.bbar){this.bottomToolbar=new Ext.Toolbar({renderTo:elId,cls:'chartToolbar',items:this.bbar});}};if(!chart.cc.hidden&&chart.cc.hidden!='true'){chart.renderBottomToolbar();}};
/* ========== ../mkt-ext-2.0/menus/AnalyticsMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.Analytics');Mkt.menus.Analytics.Toolbar=function(){function toolbarRequestHandler(attr,ret){var subType="home";switch(attr.subType){case'report':case'smartlist':case'setup':case'subscription':subType='analytics';break;default:break;}
if(isFunction(Mkt.menus.Analytics.Toolbar['get'+MktUtil.camelCase(subType)])){ret.comp=Mkt.menus.Analytics.Toolbar['get'+MktUtil.camelCase(subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('Analytics',toolbarRequestHandler);function preshowReportActionsMenu(attr){var newDrilldown=attr.items.get('newDrillDown_'+this.panelId);var data=Mkt.apps.analytics.ReportSettings.data;var isDetailView=this.panelId==Mkt.menus.Analytics.Toolbar.detailCanvasId;var showNewDrilldown=false;var disableDrilldown=true;if(data&&data.subtype=='lead'){if(isDetailView){var sels=Mkt.util.Common.getSelections(attr);if(sels.length>0){disableDrilldown=false;}}
showNewDrilldown=true;}
if(newDrilldown){newDrilldown.setVisible(showNewDrilldown);newDrilldown.setDisabled(disableDrilldown);}}
return{overviewCanvasId:'atxCanvasOverview',detailCanvasId:'atxCanvasDetailView',smartlistCanvasId:'atxCanvasSmartlist',setupCanvasId:'atxCanvasSetup',subscriptionsCanvasId:'atxCanvasSubscriptions',REPORT_SUBTYPE_DRILLDOWN:'drilldown',REPORT_SUBTYPE_LEAD:'lead',REPORT_SUBTYPE_EMAIL:'email',REPORT_SUBTYPE_OTHER:'other',REPORT_SUBTYPE_ADMIN:'admin',getHome:function(attr){var buttonArgs={panelId:attr.panelId};var menuItems=[this.newMenuButton({panelId:attr.panelId})];if(attr.isRevenueExplorerEnabled){menuItems.push(this.revenueExplorerButton(attr));}
if(attr.panelId==this.subscriptionsCanvasId){menuItems.push(this.deleteSubscriptionButton(buttonArgs));}
if(MktPage.xfeatures){menuItems.push(' ');menuItems.push(this.reportRunnerMenuButton({panelId:attr.panelId}));}
return new Ext.Toolbar({items:menuItems});},getAnalytics:function(attr){var menuItems=[];if(attr.reportSubtype!=this.REPORT_SUBTYPE_DRILLDOWN&&!MktPage.satellite){menuItems.push(this.newMenuButton(attr));}
menuItems.push(this.reportActionsMenuButton(attr));if(attr.panelId==this.smartlistCanvasId){menuItems.push(this.viewQualifiedLeads(attr));}
else if(attr.panelId==this.subscriptionsCanvasId){menuItems.push('-');menuItems.push(this.newSubscriptionButton(attr));menuItems.push(this.deleteSubscriptionButton(attr));}
else if(attr.panelId==this.setupCanvasId){var analyticsSetupItems=Mkt.apps.analyticsreportsetup.menuItems;menuItems.push('-');menuItems.push(analyticsSetupItems.editMenu);menuItems.push(analyticsSetupItems.deleteMenu);}
else if(attr.showDrilldown){menuItems.push(this.newDrillDownReportButton(attr));}
return menuItems;},newMenuButton:function(attr){var dsMip=MktDsMenu.menuItemPool;var menuItems=[];menuItems.push(this.newReportButton(attr));if(MktPage.savedState.MPA){menuItems.push(this.newAnalyzerButton(attr));}
menuItems.push(this.newSubscriptionButton(attr));if(MktPage.savedState.rcmEnabled){menuItems.push(this.newRcmButton(attr));}
return{text:'New',itemId:'new_'+attr.panelId,iconCls:'mkiChartArea',menu:new Ext.menu.Menu({minWidth:200,items:menuItems})};},reportActionsMenuButton:function(attr){var dsMip=MktDsMenu.menuItemPool;var menuItems=[];menuItems.push(this.refreshReportButton(attr));if(MktPage.xfeatures){menuItems.push(this.clearCacheButton(attr));menuItems.push(this.resetReportSettings(attr));}
if(!MktPage.satellite){menuItems.push('-');menuItems.push(this.cloneReportButton(attr));menuItems.push(this.deleteReportButton(attr));if(attr.showDrilldown){menuItems.push(this.newDrillDownReportButton(attr));}}
return{text:(attr.reportSubtype=='analyzer')?'Analyzer Actions':'Report Actions',itemId:'reportactions_'+attr.panelId,iconCls:'mkiChartPie',xtype:'mkttbbutton',menuPreShowCb:preshowReportActionsMenu.createDelegate(attr),menu:new Ext.menu.Menu({minWidth:200,items:menuItems})};},reportOptionalMenuButton:function(attr){var domain=attr.domain;if(domain&&Mkt.apps[domain].optionalMenu){var optionalMenu=Mkt.apps[domain].optionalMenu();if(optionalMenu){return optionalMenu;}}
return{};},reportChannelMenuButton:function(attr){var domain=attr.domain;if(domain&&Mkt.apps[domain].channelMenu){var channelMenu=Mkt.apps[domain].channelMenu();if(channelMenu){return channelMenu;}}
return{};},newReportButton:function(attr){return{text:'New Report',itemId:'newReport_'+attr.panelId,iconCls:'mkiChartArea',handler:function(button,e){var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);MktAppJS.atxDriveCreateReportModal(button.el,undefined,accessZoneId);}};},newAnalyzerButton:function(attr){return{text:'New Analyzer',itemId:'newAnalyzer_'+attr.panelId,iconCls:'mkiChartArea',handler:function(button,e){var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);var isAnalyzer=true;MktAppJS.atxDriveCreateReportModal(button.el,undefined,accessZoneId,isAnalyzer);}};},cloneReportButton:function(attr){var isAnalyzer=(attr.reportSubtype=='analyzer');return{text:(isAnalyzer)?'Clone Analyzer':'Clone Report',id:'cloneReport_'+attr.panelId,iconCls:'mkiChartArea',handler:function(button,e){var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);MktAppJS.atxDriveCloneReportModal(button.el,Mkt.apps.analytics.getActiveReportId(),accessZoneId,isAnalyzer);}};},newRcmButton:function(attr){return{text:'New Revenue Cycle Model',id:'newRcm_'+attr.panelId,iconCls:'mkiPackage',handler:function(button,e){var currNode=button.parentMenu.currNode;if(currNode){var parentId=currNode.attributes.parentId;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);Mkt.apps.Rcm.createModel(parentId,accessZoneId);}};},newDrillDownReportButton:function(attr){return{text:'Drill-Down',itemId:'newDrillDown_'+attr.panelId,iconCls:'mkiPowerDrill',disabled:true,handler:function(button,e){var reportData=Mkt.apps.analytics.ReportSettings.data;var sels=Mkt.util.Common.getSelections({triggeredFrom:'button'});var values=[];if(sels&&sels.length>0){for(var i=0;i<sels.length;i++){values.push(sels[i].json);}}
var drillDown=new Mkt.apps.analytics.DrilldownForm({settings:reportData,reportId:reportData.data.reportId,group:reportData.data.group,groupAttrId:reportData.data.groupAttrId,groupAttrType:reportData.data.groupAttrType,groupDatatype:reportData.data.groupDatatype,groupUnits:reportData.data.groupUnits,values:values});drillDown.show(button.getEl());}};},exportAllButton:function(attr){return{text:'Custom Export',itemId:'newReport_'+attr.panelId,iconCls:'mkiExcel',handler:function(button,e){Ext.Msg.prompt('Custom Export',"Enter the number of rows to export (max 50000):",function(btn,limit){console.debug('limit=',limit);if(btn=='ok'&&limit){MktMessage.showExport();var url='/analytics/excelExport?reportId='+Mkt.apps.analytics.getActiveReportId()+'&limit='+limit+'&refresh_cache=disable';console.debug('Export "All"',url);location=url;}},this,false,'50000');}};},newSubscriptionButton:function(attr){return{text:'New Report Subscription',itemId:"newSubscription_"+attr.panelId,iconCls:'mkiMail2Clock',handler:function(button,e){var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);MktAppJS.atxDriveCreateSubscriptionModal(button.el,Mkt.apps.analytics.getActiveReportId(),accessZoneId);}};},deleteSubscriptionButton:function(attr){return{text:'Delete Subscription',itemId:"deleteSubscription_"+attr.panelId,disabled:true,iconCls:'mkiMail2Delete',handler:function(button,e){var sels=Mkt.util.Common.getSelections({triggeredFrom:'button'});var count=sels.length;var txt;var sub_ids=[];if(count>0){for(var i=0;i<count;i++){sub_ids.push(sels[i].ssid);}
txt=count==1?sub_ids[0]:sub_ids.join(',');MktAnalyticsMenu.deleteSubscriptions(count,txt,button.getEl());}}};},deleteReportButton:function(attr){return{text:(attr.reportSubtype=='analyzer')?'Delete Analyzer':'Delete Report',itemId:'deleteReport',iconCls:'mkiDelete2',handler:function(el){var tab=Mkt.apps.analytics.getActiveReportTab();if(tab){MktAnalyticsMenu.deleteReport(tab.config.compId,tab.title,tab.config.expNodeId,null,el.getEl());}}};},reportSettingsButton:function(attr){return{text:(attr.reportSubtype=='analyzer')?'Analyzer Settings':'Report Settings',iconCls:'mkiGear',handler:function(button,e){if(attr.reportSubtype=='analyzer'){Mkt.widgets.ReportSettings.data.reportSettingsTitle=Mkt.widgets.ReportSettings.data.reportSettingsTitle.replace("Report Settings","Analyzer Settings");}
Mkt.widgets.ReportSettings.show(Mkt.widgets.ReportSettings.data,undefined,button.el);}};},viewQualifiedLeads:function(attr){return{text:'View Qualified Leads',iconCls:'mkiUserInto',handler:function(button,e){window.open(MktDlManager.getDlUrl('SL',MktPage.appVars.atxSmartlistId,'A',true),'_blank');}};},refreshReportButton:function(attr){return{text:(attr.reportSubtype=='analyzer')?'Refresh Analyzer':'Refresh Report',iconCls:'mkiNavRefreshGreen',handler:function(button,e){MktSession.ajaxRequest('/analytics/clearCache',{serializeParms:{'reportId':Mkt.apps.analytics.getActiveReportId()},onMySuccess:function(){if(attr.panelId==Mkt.menus.Analytics.Toolbar.detailCanvasId||attr.panelId==Mkt.menus.Analytics.Toolbar.overviewCanvasId){MktCanvas.reactivateActiveTab(true);}
else{MktCanvas.setActiveTab(Mkt.menus.Analytics.Toolbar.overviewCanvasId);}}});}};},clearCacheButton:function(attr){return{text:'Clear Cache',iconCls:'mkiBrush',handler:function(button,e){MktSession.ajaxRequest('/analytics/clearCache',{serializeParms:{'reportId':Mkt.apps.analytics.getActiveReportId()},onMySuccess:function(){console.debug('Cleared cache for reportId='+Mkt.apps.analytics.getActiveReportId());}});}};},resetReportSettings:function(attr){return{text:'Reset Report Settings',iconCls:'mkiBrush',handler:function(button,e){MktSession.ajaxRequest('/analytics/resetReportSettings',{serializeParms:{'reportId':Mkt.apps.analytics.getActiveReportId()},onMySuccess:function(){console.debug('Reset report settings for reportId='+Mkt.apps.analytics.getActiveReportId());}});}};},addCustomColumnButton:function(attr){return{text:'Add Custom Column',iconCls:'mkiTableColumnAdd',handler:Mkt.apps.analytics.addReportColumnDialog};},revenueExplorerButton:function(attr){return{text:'Revenue Explorer',itemId:'revenueExplorer',iconCls:'mkiApplication',handler:function(el){window.open(attr.revenueExplorerUrl,'_blank');}};},invalidateTreeCache:function(tree){tree.invalidateCache();},filterMenu:function(attr){if(!attr.filterType){return null;}
var treeDataUrl='analytics/getFilter?filterType='+attr.filterType+'&reportId='+Mkt.apps.analytics.getActiveReportId();var filterMenuId='filterTreeMenu'+Mkt.apps.analytics.getActiveReportId();this.filterTreeMenu=new Mkt.widgets.FilterTreeMenu({itemId:filterMenuId,treeConfig:{enableCache:true,useCleanCache:true,selectedNodes:attr.selectedNodes},cancelUnsaved:true,filterConfig:{buttons:[{text:'Apply Filter',iconCls:'mkiOk',handler:function(btn,e){this.filterTreeMenu.cancelUnsaved=false;this.filterTreeMenu.hide(true);this.saveFilter.call(this.filterTreeMenu);}.createDelegate(this)},{text:'Cancel',iconCls:'mkiCancel',handler:function(btn,e){this.filterTreeMenu.hide(true);}.createDelegate(this)}]},treeDataUrl:treeDataUrl});this.filterTreeMenu.on('beforehide',function(){var tree=this.getFilterTree();if(tree&&this.cancelUnsaved){tree.reInitCheckedNodes();}
var palette=this.getPalette();if(palette){palette.clearFilterField(false);}
this.cancelUnsaved=true;}.createDelegate(this.filterTreeMenu));MktCanvas.clearCanvasHook=this.invalidateTreeCache.createDelegate(this,[this.filterTreeMenu.getFilterTree()]);return this.filterTreeMenu;},filterWindow:function(attr){if(!attr.filterType){return null;}
var treeDataUrl='analytics/getFilter?filterType='+attr.filterType+'&reportId='+Mkt.apps.analytics.getActiveReportId();var filterMenuId='filterTreeWindow'+Mkt.apps.analytics.getActiveReportId();var windowConfig=Ext.apply({itemId:filterMenuId,treeConfig:{enableCache:true,useCleanCache:true,selectedNodes:attr.selectedNodes},cancelUnsaved:true,buttons:[{text:'Apply',iconCls:'mkiOk',handler:function(btn,e){this.filterTreeMenu.cancelUnsaved=false;this.saveFilterWindow.call(this.filterTreeMenu);}.createDelegate(this)},{text:'Cancel',iconCls:'mkiCancel',handler:function(btn,e){this.filterTreeMenu.hide(true);}.createDelegate(this)}],treeDataUrl:treeDataUrl},attr.windowConfig);this.filterTreeMenu=new Mkt.widgets.FilterTreeWindow(windowConfig);this.filterTreeMenu.on('beforehide',function(){var tree=this.getFilterTree();if(tree&&this.cancelUnsaved){tree.reInitCheckedNodes();}
var palette=this.getPalette();if(palette){palette.clearFilterField(false);}
this.cancelUnsaved=true;}.createDelegate(this.filterTreeMenu));MktCanvas.clearCanvasHook=this.invalidateTreeCache.createDelegate(this,[this.filterTreeMenu.getFilterTree()]);return this.filterTreeMenu;},saveFilter:function(){var nodeIds=this.getSelectedItems();if(Mkt.util.Common.arrayEqual(this.getFilterTree().savedNodeIds,nodeIds)){return;}
MktSession.clockCursor(true);MktSession.ajaxRequest('analytics/applyComponentFilter',{serializeParms:{nodeIds:Ext.encode(nodeIds),reportId:Mkt.apps.analytics.getActiveReportId()},onMySuccess:function(){this.getFilterTree().savedNodeIds=nodeIds;var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){MktCanvas.reactivateActiveTab(true);}
if(MktPage.appVars.filterText){var filterCanvases=[this.overviewCanvasId,this.detailCanvasId];var btn;for(var i=0;i<filterCanvases.length;i++){btn=MktCanvas.getRegisteredItem('filterButton',filterCanvases[i]);if(btn){var filterText=MktPage.appVars.filterText;btn.setText(filterText);}}}}.createDelegate(this)});},saveFilterWindow:function(){var nodeIds=this.getSelectedItems();if(Mkt.util.Common.arrayEqual(this.getFilterTree().savedNodeIds,nodeIds)){return;}
MktSession.clockCursor(true);MktSession.ajaxRequest('analytics/applyComponentFilter',{serializeParms:{nodeIds:Ext.encode(nodeIds),filterType:this.filterType,reportId:Mkt.apps.analytics.getActiveReportId()},onMySuccess:function(){this.getFilterTree().savedNodeIds=nodeIds;if(this.successCallback){this.successCallback();}
this.close();}.createDelegate(this)});},getDrilldownBtnDisableState:function(sm){var item;var disable=false;var count=sm.getCount();if(count<=0){disable=true;}else{for(var i=0;i<count;i++){item=sm.selections.itemAt(i);if(item&&item.data&&isString(item.data.Group1)&&isEmptyString(item.data.Group1)){disable=true;break;}}}
return disable;},updateAnalyticsToolbarState:function(attr){var activeTab=MktCanvas.getActiveTab();if(!activeTab)return;var tb=activeTab.getTopToolbar();if(!tb||!tb.items)return;if(activeTab.config.id==Mkt.menus.Analytics.Toolbar.detailCanvasId){var reportActionsBtn=tb.items.get('newDrillDown_'+attr.panelId);if(reportActionsBtn&&attr&&attr.sm){reportActionsBtn.setDisabled(Mkt.menus.Analytics.Toolbar.getDrilldownBtnDisableState(attr.sm));}}
else if(activeTab.config.id==Mkt.menus.Analytics.Toolbar.subscriptionsCanvasId){var delSubBtn=tb.items.get('deleteSubscription_'+attr.panelId);if(delSubBtn&&attr){if(this.hasSelection()){var s=this.getCount()>1?'s':'';delSubBtn.setText('Delete Subscription'+s);delSubBtn.setDisabled(false);}
else{delSubBtn.setDisabled(true);}}}},reportRunnerMenuButton:function(attr){var dsMip=MktDsMenu.menuItemPool;var menuItems=[this.reportRunnerStatusButton(attr),this.reportRunnerStartButton(attr),this.reportRunnerStopButton(attr),this.reportRunnerResetButton(attr),'-',this.reportSubscriptionRunnerButton(attr),this.reportCacheRunnerButton(attr),this.reportCacheRunnerForceRefreshButton(attr)];return{text:'Report Runner',itemId:'reportrunner'+attr.panelId,iconCls:'mkiTable2Information',xtype:'tbsplit',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportRunnerStatus');},menuPreShowCb:preshowReportActionsMenu.createDelegate(attr),menu:new Ext.menu.Menu({minWidth:200,items:menuItems})};},reportRunnerStatusButton:function(attr){return{text:'Status',iconCls:'mkiTable2Information',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportRunnerStatus');}};},reportRunnerStartButton:function(attr){return{text:'Start',iconCls:'mkiTable2Run',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportRunnerStart');}};},reportRunnerStopButton:function(attr){return{text:'Stop',iconCls:'mkiTable2Stop',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportRunnerStop');}};},reportRunnerResetButton:function(attr){return{text:'Reset',iconCls:'mkiTable2New',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportRunnerReset');}};},reportSubscriptionRunnerButton:function(attr){return{text:'Run All Subscriptions',iconCls:'mkiMail2Forward',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportSubscriptionRunner');}};},reportCacheRunnerButton:function(attr){return{text:'Auto-refresh All Caches',iconCls:'mkiDataRefresh',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportCacheRunner');}};},reportCacheRunnerForceRefreshButton:function(attr){return{text:'Force-refresh All Caches',iconCls:'mkiDataReplace',handler:function(button,e){MktSession.ajaxRequest('/analytics/reportCacheRunner?refresh_cache=force');}};},ender:true};}();
/* ========== ../mkt-ext-2.0/apps/analyzers.js ============ */

Mkt.apps.Analyzer={debug:false,analyzerData:null,settings:null,saveBtn:null,saveAction:null,getAction:null,canvas:null,enableAutoSave:true,lazyLoadScripts:true,init:function(config){this.initialConfig=config;if(this.lazyLoadScripts){this.loadScripts();}else{this._init();}},_init:function(){var config=this.initialConfig;if(!console){this.debug=false;}
this.analyzerDomain=config.analyzerDomain;this.settings={dateFrom:config.dateFrom,dateTo:config.dateTo,reportJsonSettings:config.jsonsettings,currencysettings:config.currencysettings,tagList:config.tagList}
this.saveAction="analytics/saveAnalyzerSettings";this.getAction=config.getAction;if(config.canvas){this.canvas=config.canvas;var tab=MktCanvas.getTab(this.canvas);if(tab){this.compId=tab.config.compId;}}
this.enableAutosave=true;this.initData();this.getData();if(this.chartObjName&&Mkt.charts[this.chartObjName]){Mkt.charts[this.chartObjName].loaded();}
MktCanvas.clearCanvasHook=this.chartUnload.createDelegate(this);},isExt4Loaded:function(){return typeof Ext4!='undefined';},chartUnload:function(){if(Mkt.charts[this.chartObjName]){var chartObj=Mkt.charts[this.chartObjName];if(chartObj.resizeChart){MktCanvas.un('resize',chartObj.resizeChart,chartObj);}
if(chartObj.chart){chartObj.chart.destroy();delete chartObj.chart;}
if(chartObj.chartPanel){chartObj.chartPanel.destroy();delete chartObj.chartPanel;}}},loadScripts:function(){var ext4Script;if(this.debug){ext4Script='/ext-4.0.1/ext-all-chart-sandbox-debug.js';}
else{ext4Script='/ext-4.0.1/ext-all-chart-sandbox.js';}
MktUtil.loadScripts([ext4Script],this.isExt4Loaded,this.loadAnalyzerScript.createDelegate(this));},loadAnalyzerScript:function(){if(!Mkt.apps.Analyzer.ext4SupportInitialized){Mkt.apps.Analyzer.ext4SupportInitialized=true;Ext4.supports.init();}
if(!this.analyzerScript){this._init();}
else{MktUtil.loadScripts([this.analyzerScript],this.isAnalyzerScriptLoaded.createDelegate(this),this._init.createDelegate(this));}},isAnalyzerScriptLoaded:function(){return Mkt.charts&&Mkt.charts[this.chartObjName];},getData:function(metric,range){},initData:function(){},dataRequest:function(params){},autoSaveConfig:{nochangeText:'<span class="mktAutoSavedText">Auto-Save: </span> no changes',nochangeIconCls:'mkiFloppyDisk',savingText:'<span class="mktAutoSavedText">Auto-Save: </span> saving...',savingIconCls:'mkiFloppyDisk',savedText:'<span class="mktAutoSavedText">Auto-Save: </span> ',savedIconCls:'mkiFloppyDisk',errorText:'<span class="mktAutoSavedText">Auto-Save: </span> error',errorIconCls:'mkiFloppyDiskError',highlightColor:'#c3daf9'},getSaveBtn:function(){},validationErrorMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.errorText,cfg.errorIconCls);},beforeSaveMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.savingText,cfg.savingIconCls);},afterSaveMessage:function(){var cfg=this.autoSaveConfig;var dt=new Date();this.setSaveMessage(cfg.savedText+dt.format('M j, h:ia'),cfg.savedIconCls);},autosave:function(){if(!this.enableAutosave){return;}
this.save();},getAnalyzerDomain:function(){return this.analyzerDomain;},save:function(){var compId=MktCanvas.activeTab.config.compId;var saveData=this.saveData();var analyzerJson=Ext.util.JSON.encode(saveData);var parms={compId:compId,analyzerSettings:analyzerJson};if(this.compareData()){this.beforeSaveMessage();MktSession.ajaxRequest(this.saveAction,{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this),onMyFailure:this.saveFailure.createDelegate(this)});}},saveData:function(){},compareData:function(){return true;},saveSuccess:function(type,oldId){MktSession.clockCursor(false);this.afterSaveMessage();},saveFailure:function(){this.validationErrorMessage();},setSaveMessage:function(msg,iconCls){{this.saveBtn.setText(msg);this.saveBtn.setIconClass(iconCls);}}};Mkt.apps.ProgramAnalyzer={SLIDER_CHANGE_BUFFER:300,analyzerScript:'/mkt-ext-2.0/apps/ProgramAnalyzerChart.js',chartObjName:'bubbleChart',channelTag:'channelId',debug:false,view:'by_channel',logscale:false,bubbleJSONData:null,enableDataFilter:false,analyzerPanelSettings:{},channelExcludeList:[],currentwrange:[],defaultxcombo:'costs',defaultycombo:'pipelinedollars',defaultzcombo:'members',defaultwcombo:'rois',percentageFormatLabels:[],currencyFormatLabels:[],invertColorList:[],rcaendpoint:null,rcacustprefix:null,currentzrange:[],currentyrange:[],channelRangeSettings:[],programRangeSettings:[],indexColorWithNone:[],xsliderrange:null,ysliderrange:null,zsliderrange:null,wsliderrange:null,xcombovalue:null,ycombovalue:null,zcombovalue:null,wcombovalue:null,wstore:null,channelViewSettings:null,programViewSettings:null,byChannel:true,byProgram:false,channelIds:[],xtitle:null,ytitle:null,optionalMenu:function(){var menu=Ext.getCmp('program_analyzer_menu');if(!menu){menu={xtype:'menu',plain:true,id:'program_analyzer_menu',items:[{text:'By Channel',id:'by_channel',checked:this.byChannel,group:'view',checkHandler:Mkt.apps.ProgramAnalyzer.viewHandler},{text:'By Program',id:'by_program',checked:this.byProgram,group:'view',checkHandler:Mkt.apps.ProgramAnalyzer.viewHandler}]};}
var menuButton=new Ext.Button({text:'View',iconCls:'mkiWindowView',menu:menu,id:'viewmenu'});return menuButton;},scaleMenu:function(){var menu=Ext.getCmp('pa_scale_menu');if(!menu){menu={xtype:'menu',plain:true,id:'pa_scale_menu',items:[{text:'Linear',id:'linear',checked:(this.logscale)?false:true,group:'view',checkHandler:Mkt.apps.ProgramAnalyzer.scaleHandler},{text:'Log',id:'log',checked:(this.logscale)?true:false,group:'view',checkHandler:Mkt.apps.ProgramAnalyzer.scaleHandler}]};}
var menuButton=new Ext.Button({text:'Scale',iconCls:'mkiWindowView',menu:menu,id:'scalemenu'});return menuButton;},channelMenu:function(){var menuitems=[];if(this.bubbleJSONData!=null){var data=this.bubbleJSONData;menuitems=this.createChannelMenuItems(data);}
var menu=Ext.getCmp('menu_channel_items');if(!menu){menu={xtype:'menu',id:'menu_channel_items',items:[menuitems]};}else{menu.removeAll();menu.add(menuitems);menu.doLayout();}
var menuButton=new Ext.Button({text:'Channel Filter',iconCls:'mkiWindowView',id:'channel_menu_button',menu:menu});if(this.view=="by_channel"){menuButton.setDisabled(true);}
return menuButton;},createChannelMenuItems:function(data){var programNames=data["programs"];var menuitems=[];var itemCheck=true;var index=0;for(var i=0;i<programNames.length;i++){if(this.channelIds.indexOf(programNames[i][0])==-1){if(this.channelExcludeList&&this.channelExcludeList.length>0){var itemidx=this.channelExcludeList.indexOf(programNames[i][0]);if(itemidx!=-1){itemCheck=false;}}
menuitems.push({text:programNames[i][0],id:this.channelTag+""+index,itemId:this.channelTag+""+index,hideOnClick:false,checked:itemCheck,checkHandler:Mkt.apps.ProgramAnalyzer.selectHandler});this.channelIds.push(programNames[i][0]);itemCheck=true;index++;}}
return menuitems;},viewHandler:function(item,checked){if(checked){Mkt.apps.ProgramAnalyzer.view=item.id;Mkt.apps.ProgramAnalyzer.switchView('view');}},scaleHandler:function(item,checked){if(checked){if(item.id=="log"){Mkt.apps.ProgramAnalyzer.logscale=true;}
else{Mkt.apps.ProgramAnalyzer.logscale=false;}
Mkt.apps.ProgramAnalyzer.switchView('scale');}},selectHandler:function(item,checked){if(!Mkt.apps.ProgramAnalyzer.channelExcludeList){Mkt.apps.ProgramAnalyzer.channelExcludeList=Array();}
var tagLength=Mkt.apps.ProgramAnalyzer.channelTag.length;var itemId=item.itemId.substring(tagLength);var programName;if(Mkt.apps.ProgramAnalyzer.channelIds.length>0){programName=Mkt.apps.ProgramAnalyzer.channelIds[parseInt(itemId)];}else{return;}
if(!checked){Mkt.apps.ProgramAnalyzer.channelExcludeList.push(programName);Mkt.apps.ProgramAnalyzer.enableDataFilter=true;}else{var index=Mkt.apps.ProgramAnalyzer.channelExcludeList.indexOf(programName);if(index!=-1){Mkt.apps.ProgramAnalyzer.channelExcludeList.splice(index,1);}
if(Mkt.apps.ProgramAnalyzer.channelExcludeList.length>0){Mkt.apps.ProgramAnalyzer.enableDataFilter=true;}}
Mkt.apps.ProgramAnalyzer.checkMenuItems();Mkt.apps.ProgramAnalyzer.reloadChart();Mkt.apps.ProgramAnalyzer.autosave();},channelSelectAction:function(channelName){var programNames=this.bubbleJSONData["programs"];this.channelExcludeList=[];for(var i=0;i<programNames.length;i++){if(programNames[i][0]!=channelName){this.channelExcludeList.push(programNames[i][0]);}}
this.view="by_program";this.analyzerPanelSettings['view']=this.view;this.analyzerPanelSettings['channelexcludelist']=this.channelExcludeList;this.resetSettingsMenu();this.resetSliderSize('xSlider');this.resetSliderSize('ySlider');this.resetSliderSize('zSlider');this.resetSliderSize('wSlider');this.resetPanel();this.enableDataFilter=true;this.reloadChart();this.autosave();},getSaveBtn:function(){var cfg=Mkt.apps.Analyzer.autoSaveConfig;var saveActionBtn=new Ext.Toolbar.Button({id:'analyzerSaveSettingsButton',text:cfg.nochangeText,iconCls:cfg.nochangeIconCls,disabled:true});this.saveBtn=saveActionBtn;return saveActionBtn;},checkMenuItems:function(){var currentCheckedLength=((this.channelIds.length)-(this.channelExcludeList.length));if(currentCheckedLength==1){for(var i=0;i<this.channelIds.length;i++){if(this.channelExcludeList.indexOf(this.channelIds[i])==-1){Ext.getCmp(this.channelTag+""+i).setDisabled(true);}}}else{for(var i=0;i<this.channelIds.length;i++){var comp=Ext.getCmp(this.channelTag+""+i);if(comp){comp.setDisabled(false);}}}},getData:function(metric,range){if(this.debug){console.log("--getData start-- "+(new Date()-this.start));}
this.ztitle='Members';this.wtitle='Success Members';this.analyzerData=null;this.bubbleJSONData=null;this.bubbleChartData=null;this.selCombos=Array();this.availCombos=Array();this.channelExcludeList=Array();this.index=[["costs","Cost"],["pipelinedollars","Pipeline Value"],["members","Members"],["successes","Success Members"],["newnames","New Names"],["costpermembers","Cost/Member"],["costpersuccesses","Cost/Succ Member"],["costpernewnames","Cost/New Name"],["rois","Return On Investment"],["percentnewnames","Percent New Names"],["percentsuccesses","Percent Successes"]];this.indexWithNone=[["none","None"],["costs","Cost"],["pipelinedollars","Pipeline Value"],["members","Members"],["successes","Success Members"],["newnames","New Names"],["costpermembers","Cost/Member"],["costpersuccesses","Cost/Succ Member"],["costpernewnames","Cost/New Name"],["rois","Return On Investment"],["percentnewnames","Percent New Names"],["percentsuccesses","Percent Successes"]];this.indexColorWithNone=[["none","None"],["costs","Cost"],["pipelinedollars","Pipeline Value"],["members","Members"],["successes","Success Members"],["newnames","New Names"],["costpermembers","Cost/Member"],["costpersuccesses","Cost/Succ Member"],["costpernewnames","Cost/New Name"],["rois","Return On Investment"],["percentnewnames","Percent New Names"],["percentsuccesses","Percent Successes"]];this.invertColorList=[];this.currencyFormatLabels=['costs','costpersuccesses','costperleads','costpernewnames','costpermembers','costpernewnamesuccesses','pipelinedollars','revenue'];this.percentageFormatLabels=['percentsuccesses','percentnewnames','percentleads','rois','newnamepercent','successpercent','newnamesuccesspercent','percentnewnamesuccesses'];var dateFrom,dateTo;if(this.settings.dateFrom!=null&&this.settings.dateFrom!=""){dateFrom=this.settings.dateFrom+"-01";}
else{dateFrom=null;}
if(this.settings.dateTo!=null&&this.settings.dateTo!=""){var splitDateTo=this.settings.dateTo.split("-");var monthswith31days=[1,3,5,7,8,10,12];if(monthswith31days.indexOf(parseInt(splitDateTo[1]))!=-1){dateTo=this.settings.dateTo+"-31";}
else{dateTo=this.settings.dateTo+"-30";}}
else{dateTo=null;}
var parms={compId:this.compId,analyzerDomain:this.analyzerDomain,dateFrom:dateFrom,dateTo:dateTo,periodicity:'date'};this.analyzerPanelSettings={};this.programRangeSettings=[];this.channelRangeSettings=[];if(this.settings.reportJsonSettings&&this.settings.reportJsonSettings!=""){this.analyzerPanelSettings=Ext.decode(this.settings.reportJsonSettings);}
parms.metric='program';MktSession.ajaxRequest('analytics/getProgramAnalyzerData',{serializeParms:parms,onMySuccess:this.setData.createDelegate(this),onMyFailure:this.getDataFailure.createDelegate(this)});},initData:function(){},sort:function(a,b){return a-b;},isChannelEnabled:function(value){if(this.view=='by_channel'){return true;}
if(this.channelExcludeList&&this.channelExcludeList.length>0){if(this.channelExcludeList.indexOf(value)!=-1){return false;}
return true;}
return true;},checkChannelMenu:function(){if(this.view=="by_program"){Ext.getCmp('channel_menu_button').setDisabled(false);var menu=Ext.getCmp('menu_channel_items');if(menu.items.items.length<1&&this.channelIds.length>0){this.channelIds=[];this.resetChannelMenu();}}},compareData:function(){var jsonObject=this.makeSaveData();var storedSettings=Ext.encode(this.analyzerPanelSettings);var currentSettings=Ext.encode(jsonObject);if(storedSettings!=currentSettings){return false;}
return true;},saveData:function(){this.analyzerPanelSettings=this.makeSaveData();return this.analyzerPanelSettings;},makeSaveData:function(){var range;this.saveView();var jsonObject;if(this.channelExcludeList&&this.channelExcludeList.length>0){jsonObject={view:this.view,scale:this.logscale,channelexcludelist:this.channelExcludeList,channelviewData:this.channelViewSettings,programviewData:this.programViewSettings}}else{jsonObject={view:this.view,scale:this.logscale,channelviewData:this.channelViewSettings,programviewData:this.programViewSettings}}
return jsonObject;},setStoreData:function(){var xdata=this.bubbleJSONData[this.xcombovalue];var ydata=this.bubbleJSONData[this.ycombovalue];var zdata=null;var zrange=null;if(this.zcombovalue=="none"){zdata=this.bubbleJSONData[this.ycombovalue];zrange=this.ysliderrange;}else{zdata=this.bubbleJSONData[this.zcombovalue];zrange=this.zsliderrange;}
var wdata=null;var wrange=null;if(this.wcombovalue=="none"||this.wcombovalue=="channelColor"){wdata=this.bubbleJSONData[this.ycombovalue];wrange=this.ysliderrange;}else{wdata=this.bubbleJSONData[this.wcombovalue];wrange=this.wsliderrange;}
var pdata=this.bubbleJSONData["programs"];var n=xdata.length;if(n==0){var sdata1=[];sdata1.push({name:["__fake","__fake","__fake"],xaxis:(this.xsliderrange[1]/2),yaxis:this.ysliderrange[1]/2,units:0,color:this.currentwrange[1]/2,dataindex:0});this.xsliderrange=[0,0];this.ysliderrange=[0,0];this.zsliderrange=[0,0];this.wsliderrange=[0,0];return sdata1;}
var sizes=[];sizes[0]=xdata.length;sizes[1]=ydata.length;sizes[2]=zdata.length;sizes[2]=wdata.length;var dsize=sizes[0];for(i=1;i<4;i++){if(dsize>sizes[i]){dsize=sizes[i];}}
n=dsize;if(xdata!=null&&ydata!=null&&zdata!=null&&wdata!=null){var sdata1=[];var currentzmin=zdata[0],currentzmax=zdata[0],currentwmin=wdata[0],currentwmax=-20000;var currentymin=ydata[0],currentymax=ydata[1];var xvalue,yvalue,zvalue,wvalue,pvalue;sdata1.push({name:["__fake","__fake","__fake"],xaxis:this.xsliderrange[0],yaxis:this.ysliderrange[0],units:0,color:this.currentwrange[0],dataindex:0});sdata1.push({name:["__fake","__fake","__fake"],xaxis:this.xsliderrange[1]
+(this.xsliderrange[0]===this.xsliderrange[1]?5:0),yaxis:this.ysliderrange[1]
+(this.ysliderrange[0]===this.ysliderrange[1]?5:0),units:0,color:this.currentwrange[1],dataindex:1});var dindex=1;for(i=0;i<n;i++){if(xdata[i]=="N/A"||ydata[i]=="N/A"||zdata[i]=="N/A"||wdata[i]=="N/A"){continue;}
if(this.enableDataFilter){if(this.isChannelEnabled(pdata[i][0])&&(xdata[i]==null||(this.xsliderrange[0]<=xdata[i])&&(xdata[i]<=this.xsliderrange[1]+1))&&(ydata[i]==null||(this.ysliderrange[0]<=ydata[i])&&(ydata[i]<=this.ysliderrange[1]+1))&&(zdata[i]==null||(zrange[0]<=zdata[i])&&(zdata[i]<=zrange[1]+1))&&(wdata[i]==null||(wrange[0]<=wdata[i])&&(wdata[i]<=wrange[1]+1))){if(this.wcombovalue!="none"&&this.wcombovalue!="channelColor"){if(wdata[i]!=null&&wdata[i]>currentwmax){currentwmax=wdata[i];}
if(wdata[i]!=null&&wdata[i]<currentwmin){currentwmin=wdata[i];}}
if(this.zcombovalue!="none"){if(zdata[i]!=null&&zdata[i]>currentzmax){currentzmax=zdata[i];}
if(zdata[i]!=null&&zdata[i]<currentzmin){currentzmin=zdata[i];}}
if(ydata[i]!=null&&ydata[i]>currentymax){currentymax=ydata[i];}
if(ydata[i]!=null&&ydata[i]<currentymin){currentymin=ydata[i];}
yvalue=ydata[i];if(ydata[i]!=null&&this.checkInvertAxis("yaxis")){yvalue=this.ysliderrange[1]-yvalue;}
var colorval;if(this.wcombovalue=="channelColor"){colorval=pdata[i][0];}else{colorval=wdata[i];}
dindex=dindex+1;sdata1.push({name:pdata[i],xaxis:xdata[i],yaxis:yvalue,units:zdata[i],color:colorval,dataindex:dindex});}}else{if(this.isChannelEnabled(pdata[i][0])){if(this.wcombovalue!="none"&&this.wcombovalue!="channelColor"){if(wdata[i]>currentwmax){currentwmax=wdata[i];}
if(wdata[i]!=null&&wdata[i]<currentwmin){currentwmin=wdata[i];}}
if(this.zcombovalue!="none"){if(zdata[i]!=null&&zdata[i]>currentzmax){currentzmax=zdata[i];}
if(zdata[i]!=null&&zdata[i]<currentzmin){currentzmin=zdata[i];}}}
yvalue=ydata[i];if(ydata[i]!=null&&this.checkInvertAxis("yaxis")){yvalue=this.ysliderrange[1]-yvalue;}
if(ydata[i]!=null&&ydata[i]>currentymax){currentymax=ydata[i];}
if(ydata[i]!=null&&ydata[i]<currentymin){currentymin=ydata[i];}
var colorval;if(this.wcombovalue=="channelColor"){colorval=pdata[i][0];}else{colorval=wdata[i];}
dindex=dindex+1;sdata1.push({name:pdata[i],xaxis:xdata[i],yaxis:yvalue,units:zdata[i],color:colorval,dataindex:dindex});}}
if(this.wcombovalue!="none"&&this.wcombovalue!="channelColor"){if(!this.currentwrange){this.currentwrange=[];}
this.currentwrange[0]=Math.floor(currentwmin);this.currentwrange[1]=Math.ceil(currentwmax);}
if(this.zcombovalue!="none"){if(!this.currentzrange){this.currentzrange=[];}
this.currentzrange[0]=Math.floor(currentzmin);this.currentzrange[1]=Math.ceil(currentzmax);}
this.currentyrange=[];this.currentyrange[0]=Math.floor(currentymin);this.currentyrange[1]=Math.ceil(currentymax);return sdata1;}},setComboValue:function(value,comboName){if(Ext.getCmp(comboName)){Ext.getCmp(comboName).setValue(value);}
if(comboName=='xCombo'){this.xcombovalue=value;}else if(comboName=='yCombo'){this.ycombovalue=value;}else if(comboName=='zCombo'){this.zcombovalue=value;}else{this.wcombovalue=value;}},setRangeSize:function(values,sliderCompName){if(values){if(sliderCompName=='xSlider'){this.xsliderrange=values;}else if(sliderCompName=='ySlider'){this.ysliderrange=values;}else if(sliderCompName=='zSlider'){this.zsliderrange=values;}else{this.wsliderrange=values;}}},setSliderSize:function(values,sliderCompName){var compSlider=Ext.getCmp(sliderCompName);if(values!=null&&values.length>0){compSlider.setDisabled(false);var sliderrangevalues=this.findComboRangeForSlider(sliderCompName);if(sliderCompName=="xSlider"){direction='xaxis';}
else if(sliderCompName=="ySlider"){direction='yaxis';}
else if(sliderCompName=="zSlider"){direction='zaxis';}
else{direction='waxis';}
var sliderindexvalues=this.getSliderIndexes(direction,values);compSlider.setMinValue(sliderrangevalues[0]);compSlider.setMaxValue(sliderrangevalues[1]);compSlider.setValue(0,sliderindexvalues[0]);compSlider.setValue(1,sliderindexvalues[1]);}},setAxisName:function(value,direction){var title;for(var i=0;i<this.index.length;i++){if(value==this.index[i][0]){title=this.index[i][1];}}
this.setTitle(title,direction);},setTitle:function(title,direction){if(direction=='xaxis'){this.xtitle=title;}else if(direction=='yaxis'){this.ytitle=title;}else if(direction=='zaxis'){this.ztitle=title;}else{this.wtitle=title;}},setDataFilterFlag:function(flag){this.enableDataFilter=flag;},validateData:function(){var checkData=true;if(this.analyzerData){var summaryData=this.getSummaryData();var detailData=this.getDetailData();var validSummaryDataFlag=false;for(var prop in summaryData){if(summaryData.hasOwnProperty(prop)){validSummaryDataFlag=true;break;}}
var validDetailDataFlag=false;for(var prop in detailData){if(detailData.hasOwnProperty(prop)){validDetailDataFlag=true;break;}}
if(!validDetailDataFlag||!validSummaryDataFlag){checkData=false;}}else{checkData=false;}
if(!checkData){MktMessage.showInfo('There was No Program Information found for the Program Analyzer');return false;}
return true;},setData:function(){var result=MktPage.appVars.analyzerData.GET_PROGRAM_DATA;this.analyzerData=this.parseData(result);if(MktPage.appVars.analyzerData.status=="error"){MktMessage.showError(MktPage.appVars.analyzerData.msg);}else{this.rcaendpoint=MktPage.appVars.analyzerData.endpoint;this.rcacustprefix=MktPage.appVars.analyzerData.custprefix;this.view="by_channel";this.byChannel=true;this.byProgram=false;if(this.validateData()){var metrics=this.getProgramMetricsData();this.resetSettingsMenu();this.buildSettings();this.resetSliderSize('xSlider');this.resetSliderSize('ySlider');this.resetSliderSize('zSlider');this.resetSliderSize('wSlider');this.resetPanel();this.bubbleChartData=this.setStoreData();Mkt.charts.bubbleChart.setChartSettings();Mkt.charts.bubbleChart.setChartData(this.bubbleChartData);Mkt.charts.bubbleChart.renderChart();}}
MktCanvas.unmask();},saveView:function(){if(this.view=="by_channel"){this.channelViewSettings={xCombo:this.xcombovalue,yCombo:this.ycombovalue,zCombo:this.zcombovalue,wCombo:this.wcombovalue,metrics:this.channelRangeSettings};}else{this.programViewSettings={xCombo:this.xcombovalue,yCombo:this.ycombovalue,zCombo:this.zcombovalue,wCombo:this.wcombovalue,metrics:this.programRangeSettings};}},switchView:function(viewtype){this.analyzerPanelSettings['view']=this.view;this.analyzerPanelSettings['scale']=this.logscale;this.selCombos=Array();this.availCombos=Array();this.currentwrange=Array();this.currentzrange=Array();this.enableDataFilter=false;this.channelIds=[];this.resetSettingsMenu();this.resetSliderSize('xSlider');this.resetSliderSize('ySlider');this.resetSliderSize('zSlider');this.resetSliderSize('wSlider');this.resetPanel();this.reloadChart();this.autosave();},findWRange:function(){var data=this.bubbleJSONData[this.wcombovalue];return this.findRange(data);},findZRange:function(){var data=this.bubbleJSONData[this.zcombovalue];return this.findRange(data);},findXRange:function(){var data=this.bubbleJSONData[this.xcombovalue];return this.findRange(data);},findYRange:function(){var data=this.bubbleJSONData[this.ycombovalue];return this.findRange(data)},checkRangeAlreadySet:function(combovalue){if(combovalue=="none"||combovalue=="channelColor"){return null;}
if(this.view=="by_channel"){for(var i=0;i<this.channelRangeSettings.length;i++){if(this.channelRangeSettings[i].comboname==combovalue){var range=[this.channelRangeSettings[i].datarange[0],this.channelRangeSettings[i].datarange[1]];return range;}}}else if(this.view=="by_program"){for(var i=0;i<this.programRangeSettings.length;i++){if(this.programRangeSettings[i].comboname==combovalue){var range=[this.programRangeSettings[i].datarange[0],this.programRangeSettings[i].datarange[1]];return range;}}}
return null;},setComboRangeData:function(combovalue,range){var alreadyset=false;if(combovalue=="none"||combovalue=="channelColor"){return;}
var currentRange=[];currentRange[0]=range[0];if(range[1]==Number.POSITIVE_INFINITY){currentRange[1]="Max";}
else{currentRange[1]=range[1];}
if(this.view=="by_channel"){for(var i=0;i<this.channelRangeSettings.length;i++){if(this.channelRangeSettings[i].comboname==combovalue){this.channelRangeSettings[i].datarange[0]=currentRange[0];this.channelRangeSettings[i].datarange[1]=currentRange[1];alreadyset=true;break;}}
if(!alreadyset){this.channelRangeSettings.push({comboname:combovalue,datarange:range});}}else{for(var i=0;i<this.programRangeSettings.length;i++){if(this.programRangeSettings[i].comboname==combovalue){this.programRangeSettings[i].datarange[0]=currentRange[0];this.programRangeSettings[i].datarange[1]=currentRange[1];alreadyset=true;break;}}
if(!alreadyset){this.programRangeSettings.push({comboname:combovalue,datarange:range});}}
return;},findAxisRange:function(combovalue){var data=this.bubbleJSONData[combovalue];if(data){return this.findRange(data);}else{return["",""];}},findComboRangeForSlider:function(sliderCompName){var sliderrangevalues,direction;if(sliderCompName=='xSlider'){direction='xaxis';}else if(sliderCompName=='ySlider'){direction='yaxis';}else if(sliderCompName=='zSlider'){if(this.zcombovalue=="none"||this.zcombovalue=="channelColor"){return["",""];}
direction='zaxis';}else{if(this.wcombovalue=="none"||this.wcombovalue=="channelColor"){return["",""];}
direction='waxis';}
sliderrangevalues=this.getSliderIndexes(direction);return sliderrangevalues;},findCurrentRange:function(sliderCompName){if(sliderCompName=='xSlider'){return this.xsliderrange;}else if(sliderCompName=='ySlider'){return this.ysliderrange;}else if(sliderCompName=='zSlider'){return this.zsliderrange;}else{if(this.currentwrange&&this.currentwrange.length>0){if(this.logscale){return[Mkt.charts.bubbleChart.getLogbase10scale(this.currentwrange[0]),Mkt.charts.bubbleChart.getLogbase10scale(this.currentwrange[1])];}
return this.currentwrange;}
return this.wsliderrange;}},findRange:function(data){if(data!=null){var min=data[0];var max=data[0];if(min=="N/A"||isNaN(min)){min=0;}
if(max=="N/A"||isNaN(max)){max=0;}
for(var i=0;i<data.length;i++){if(data[i]!="N/A"&&!isNaN(data[i])){if(data[i]>max){max=data[i];}
if(data[i]<min){min=data[i];}}}
min=Math.floor(min);if(max>100){max=Math.ceil(max);}else{max=max;}
if(min==null){min=0;}
if(max==null){max=0;}
var range=[min,max];return range;}
else{return["0","5"];}},getSliderDistribution:function(direction,startindex,endindex){var values=[],data;data=this.getSortedData(direction);if(data==null){return["",""];}
if(startindex==null){startindex=0;}
if(endindex==null){endindex=data.length-1;}
min=Math.floor(data[startindex]);max=Math.ceil(data[endindex]);values=[min,max];return values;},getSliderIndexes:function(direction,values){var data;data=this.getSortedData(direction);if(data==null){return["",""];}
if(values==null){return[0,data.length-1];}
var startIndex=0,endIndex=data.length-1;if(data[data.length-1]==null&&data.length>=2){endIndex=data.length-2;}
if(values[0]!=null&&values[0]!=""){for(var i=0;i<data.length;i++){if(values[0]>=Math.floor(data[i])&&i>0){startIndex=i;}}}
else{startIndex=0;}
if(values[1]!=null&&values[1]!=""){for(var i=data.length-1;i>=0;i--){if(Math.ceil(data[i])>=(values[1])&&i>0){endIndex=i;}}}
else{endIndex=0;}
return[startIndex,endIndex];},getSortedData:function(direction){var values=[],rdata;if(direction=="xaxis"){rdata=this.bubbleJSONData[this.xcombovalue];}
else if(direction=="yaxis"){rdata=this.bubbleJSONData[this.ycombovalue];}
else if(direction=="zaxis"){if(this.zcombovalue=="none"||this.zcombovalue=="channelColor"){return null;}
rdata=this.bubbleJSONData[this.zcombovalue];}
else{if(this.wcombovalue=="none"||this.wcombovalue=="channelColor"){return null;}
rdata=this.bubbleJSONData[this.wcombovalue];}
var data=[],j=0;for(var i=0;i<rdata.length;i++){if((rdata[i]!="N/A"&&!isNaN(rdata[i]))&&data.indexOf(rdata[i])==-1){data[j++]=rdata[i];}}
data.sort(function(a,b){return a-b;});return data;},getAxisPointForInfinity:function(direction,major){var value;if(direction=="xaxis"){if(major){value=this.xsliderrange[1];}
else{value=this.xsliderrange[0];}}
else if(direction=="yaxis"){if(major){value=this.ysliderrange[1];}
else{value=this.ysliderrange[0];}}
else if(direction=="zaxis"){if(major){value=this.zsliderrange[1];}
else{value=this.zsliderrange[0];}}
else if(direction=="waxis"){if(major){value=this.wsliderrange[1];}
else{value=this.wsliderrange[0];}}
if(value==Number.POSITIVE_INFINITY){data=this.getSortedData(direction);if(data&&data.length>=2){value=data[data.length-2]+50;}
else{value=10;}}
return value;},getSliderThumbValue:function(direction,index){var data=this.getSortedData(direction);if(index<data.length&&index>=0){if(data[index]==Number.POSITIVE_INFINITY){return"Max";}
return data[index];}
return 0;},formatData:function(data){for(var i=0;i<data.length;i++){data[i].date=new Date(data[i].date);}
return data;},getInvertColor:function(){for(var i=0;i<this.invertColorList.length;i++){if(this.invertColorList[i]==this.wcombovalue){return true;}}
return false;},getComboValue:function(dimension){if(dimension=='xCombo'){return this.xcombovalue;}else if(dimension=='yCombo'){return this.ycombovalue;}else if(dimension=='zCombo'){return this.zcombovalue;}else{return this.wcombovalue;}},getComboTitle:function(dimension){var value;if(dimension=='xCombo'){value=this.xcombovalue;}else if(dimension=='yCombo'){value=this.ycombovalue;}else if(dimension=='zCombo'){value=this.zcombovalue;}else{value=this.wcombovalue;}
for(var i=0;i<this.index.length;i++){if(this.index[i][0]==value){return this.index[i][1];}}
return null;},getLoadedData:function(){return this.analyzerData;},getBubbleData:function(){return this.bubbleJSONData;},getChartData:function(){return this.bubbleChartData;},getXTitle:function(){return this.xtitle;},getYTitle:function(){return this.ytitle;},getZTitle:function(){return this.ztitle;},getWTitle:function(){return this.wtitle;},getDataFailure:function(obj){MktMessage.showError('Failed retriving analyzer data');},getSummaryData:function(){if(this.analyzerData){return this.analyzerData["summarydata"];}else{return null;}},getDetailData:function(){if(this.analyzerData){return this.analyzerData["detaildata"];}else{return null;}},getProgramMetricsData:function(){if(this.analyzerData["programmetadata"]){var metrics=this.analyzerData["programmetadata"]["metricsdata"];this.index=metrics;this.indexWithNone=[["none","None"]];this.indexColorWithNone=[["none","None"]];for(var i=0;i<metrics.length;i++){this.indexWithNone.push(metrics[i]);this.indexColorWithNone.push(metrics[i]);}
if(this.analyzerData["programmetadata"]["currencyLabels"]){this.currencyFormatLabels=this.analyzerData["programmetadata"]["currencyLabels"];}
if(this.analyzerData["programmetadata"]["percentageLabels"]){this.percentageFormatLabels=this.analyzerData["programmetadata"]["percentageLabels"];}
this.defaultxcombo=this.analyzerData["programmetadata"]["defaultXMetric"];this.defaultycombo=this.analyzerData["programmetadata"]["defaultYMetric"];this.defaultzcombo=this.analyzerData["programmetadata"]["defaultZMetric"];this.defaultwcombo=this.analyzerData["programmetadata"]["defaultWMetric"];for(var i=0;i<this.percentageFormatLabels.length;i++){var data=this.analyzerData["summarydata"][this.percentageFormatLabels[i]];if(data){for(var j=0;j<data.length;j++){this.analyzerData["summarydata"][this.percentageFormatLabels[i]][j]=this.analyzerData["summarydata"][this.percentageFormatLabels[i]][j]*100;}}
data=this.analyzerData["detaildata"][this.percentageFormatLabels[i]];if(data){for(var j=0;j<data.length;j++){this.analyzerData["detaildata"][this.percentageFormatLabels[i]][j]=this.analyzerData["detaildata"][this.percentageFormatLabels[i]][j]*100;}}}
return;}else{return;}},getFormattedData:function(number,axisname,includefraction){var combovalue;if(axisname=='xaxis'){combovalue=this.xcombovalue;}else if(axisname=='yaxis'){combovalue=this.ycombovalue;}else if(axisname=='zaxis'){combovalue=this.zcombovalue;}else if(axisname=='waxis'){combovalue=this.wcombovalue;}
if((number==null||number==Number.POSITIVE_INFINITY)&&(combovalue!='none'&&combovalue!='channelColor')){return"Max";}
var formatsettings;if(this.settings.currencysettings){formatsettings=Ext.decode(this.settings.currencysettings);}else{return number;}
var numFormatted;if(this.currencyFormatLabels.indexOf(combovalue)!=-1){numFormatted=Mkt.util.locale.Format.formatCurrency(number,formatsettings.currencyFormat,formatsettings.currencySymbol,{includeFractional:includefraction});}else if(this.percentageFormatLabels.indexOf(combovalue)!=-1){var negitive=false;if(number<0){number=0-number;negitive=true;}
numFormatted=Mkt.util.locale.Format.formatNumber(number,"WWW,WWW,WWW,WWW.FF",{includeFractional:includefraction})
+"%";if(negitive){numFormatted='-'+numFormatted;}}else{var negitive=false;if(number<0){number=0-number;negitive=true;}
numFormatted=Mkt.util.locale.Format.formatNumber(number,"WWW,WWW,WWW,WWW.FF",{includeFractional:includefraction});if(negitive){numFormatted='-'+numFormatted;}}
return numFormatted;},checkInvertAxis:function(axisname){if(axisname=='xaxis'){return this.isInvertAxis(this.xcombovalue);}else if(axisname=='yaxis'){return this.isInvertAxis(this.ycombovalue);}else if(axisname=='zaxis'){return this.isInvertAxis(this.zcombovalue);}else if(axisname=='waxis'){return this.isInvertAxis(this.wcombovalue);}else{return false;}},isInvertAxis:function(name){if(this.invertColorList.indexOf(name)!=-1){return true;}
return false;},parseData:function(jsonResult){var data=Ext.decode(jsonResult);return data;},resetAxisDataFromJson:function(data,comboName,sliderName,direction){this.setComboValue(data[0],comboName);var values=[];var range=this.findRange(this.bubbleJSONData[data[0]]);if(data[0]!="none"&&data[0]!="channelColor"){if(data[1]===null||data[1]===""){data[1]=range[0];}else if(data[1]<range[0]){data[1]=range[0];}
if(data[2]===null||data[2]===""){data[2]=range[1];}else if(data[2]>range[1]){data[2]=range[1];}
values[0]=data[1];values[1]=data[2];this.setRangeSize(values,sliderName);this.setAxisName(data[0],direction);}else{values=["",""];this.setRangeSize(values,sliderName);}
return;},getCurrentViewSettings:function(data,rangeData){if(data==null){this.xcombovalue=this.defaultxcombo;this.ycombovalue=this.defaultycombo;this.zcombovalue=this.defaultzcombo;this.wcombovalue=this.defaultwcombo;}
else{this.xcombovalue=data['xCombo'];this.ycombovalue=data['yCombo'];this.zcombovalue=data['zCombo'];this.wcombovalue=data['wCombo'];var id;var values;var idset=false;for(var i=0;i<rangeData.length;i++){values=rangeData[i].datarange;if(values[1]==null||values[1]=="Max"){values[1]=Number.POSITIVE_INFINITY;}
if(rangeData[i].comboname==this.xcombovalue){id='x';idset=true;}
else if(rangeData[i].comboname==this.ycombovalue){id='y';idset=true;}
else if(rangeData[i].comboname==this.zcombovalue){id='z';idset=true;}
else if(rangeData[i].comboname==this.wcombovalue){id='w';idset=true;}
if(idset){if(rangeData[i].comboname!='none'&&rangeData[i].comboname!='channelColor'){this.setRangeSize(values,id+'Slider');}
else{values=["",""];this.setRangeSize(values,id+'Slider');}}}}
return;},resetSettingsMenu:function(){var jsonSettingsData=this.analyzerPanelSettings;var settingsData=[];if(jsonSettingsData&&jsonSettingsData!=""){this.view=jsonSettingsData['view'];this.enableDataFilter=true;this.channelExcludeList=jsonSettingsData['channelexcludelist'];var xdata;if(this.view=="by_program"){this.byChannel=false;this.byProgram=true;if(jsonSettingsData['programviewData']){if(jsonSettingsData['programviewData']['metrics'].length>0){this.programRangeSettings=(jsonSettingsData['programviewData']['metrics']);}
this.getCurrentViewSettings(jsonSettingsData['programviewData'],this.programRangeSettings);}
else{this.getCurrentViewSettings(null,null);}
this.byChannel=false;this.byProgram=true;}else{if(jsonSettingsData['channelviewData']){if(jsonSettingsData['channelviewData']['metrics'].length>0){this.channelRangeSettings=(jsonSettingsData['channelviewData']['metrics']);}
this.getCurrentViewSettings(jsonSettingsData['channelviewData'],this.channelRangeSettings);}
else{this.getCurrentViewSettings(null,null);}
this.byChannel=true;this.byProgram=false;}
if(jsonSettingsData['xdata']){this.xcombovalue=jsonSettingsData['xdata'][0];if(this.xcombovalue!="none"&&this.xcombovalue!="channelColor"){if(this.view=="by_channel"){this.channelRangeSettings[this.xcombovalue]=[jsonSettingsData['xdata'][1],jsonSettingsData['xdata'][2]];}
else{this.programRangeSettings[this.xcombovalue]=[jsonSettingsData['xdata'][1],jsonSettingsData['xdata'][2]];}}}
if(jsonSettingsData['ydata']!=null){this.ycombovalue=jsonSettingsData['ydata'][0];if(this.view=="by_channel"){this.channelRangeSettings[this.ycombovalue]=[jsonSettingsData['ydata'][1],jsonSettingsData['ydata'][2]];}
else{this.programRangeSettings[this.ycombovalue]=[jsonSettingsData['ydata'][1],jsonSettingsData['ydata'][2]];}}
if(jsonSettingsData['zdata']!=null){this.zcombovalue=jsonSettingsData['zdata'][0];if(this.view=="by_channel"){this.channelRangeSettings[this.zcombovalue]=[jsonSettingsData['zdata'][1],jsonSettingsData['zdata'][2]];}
else{this.programRangeSettings[this.zcombovalue]=[jsonSettingsData['zdata'][1],jsonSettingsData['zdata'][2]];}}
if(jsonSettingsData['wdata']!=null){this.wcombovalue=jsonSettingsData['wdata'][0];if(this.view=="by_channel"){this.channelRangeSettings[this.wcombovalue]=[jsonSettingsData['wdata'][1],jsonSettingsData['wdata'][2]];}
else{this.programRangeSettings[this.wcombovalue]=[jsonSettingsData['wdata'][1],jsonSettingsData['wdata'][2]];}}
this.logscale=jsonSettingsData['scale'];}
else{this.view="by_channel";this.logscale=false;this.byChannel=true;this.byProgram=false;this.getCurrentViewSettings(null,this.channelRangeSettings);this.enableDataFilter=false;}
if(this.view=="by_program"){this.bubbleJSONData=this.getDetailData();}else{this.bubbleJSONData=this.getSummaryData();}
this.selCombos.push(this.xcombovalue);this.selCombos.push(this.ycombovalue);if(this.zcombovalue!="none"){this.selCombos.push(this.zcombovalue);}
if(this.wcombovalue!="none"||this.wcombovalue!='channelColor'){this.selCombos.push(this.wcombovalue);}
var curComboValue;if(!this.bubbleJSONData[this.xcombovalue]){curComboValue=this.xcombovalue;if(this.selCombos.indexOf(this.defaultxcombo)==-1){this.xcombovalue=this.defaultxcombo;}
else if(this.selCombos.indexOf(this.defaultycombo)==-1){this.xcombovalue=this.defaultycombo;}
else if(this.selCombos.indexOf(this.defaultwcombo)==-1){this.xcombovalue=this.defaultwcombo;}
else if(this.selCombos.indexOf(this.defaultzcombo)==-1){this.xcombovalue=this.defaultzcombo;}
this.replace(this.selCombos,curComboValue,this.xcombovalue);}
if(!this.bubbleJSONData[this.ycombovalue]){curComboValue=this.ycombovalue;if(this.selCombos.indexOf(this.defaultxcombo)==-1){this.ycombovalue=this.defaultxcombo;}
else if(this.selCombos.indexOf(this.defaultycombo)==-1){this.ycombovalue=this.defaultycombo;}
else if(this.selCombos.indexOf(this.defaultwcombo)==-1){this.ycombovalue=this.defaultwcombo;}
else if(this.selCombos.indexOf(this.defaultzcombo)==-1){this.ycombovalue=this.defaultzcombo;}
this.replace(this.selCombos,curComboValue,this.ycombovalue);}
if(this.zcombovalue!="none"&&!this.bubbleJSONData[this.zcombovalue]){curComboValue=this.zcombovalue;this.zcombovalue="none";this.replace(this.selCombos,curComboValue);}
if(this.wcombovalue!="none"&&this.wcombovalue!="channelColor"&&!this.bubbleJSONData[this.wcombovalue]){curComboValue=this.wcombovalue;this.wcombovalue="none";this.replace(this.selCombos,curComboValue);}
this.xsliderrange=this.findRange(this.bubbleJSONData[this.xcombovalue]);this.ysliderrange=this.findRange(this.bubbleJSONData[this.ycombovalue]);if(this.zcombovalue!="none"){this.zsliderrange=this.findRange(this.bubbleJSONData[this.zcombovalue]);}
else{this.zsliderrange=["",""];}
if(this.wcombovalue!="none"&&this.wcombovalue!="channelColor"){this.wsliderrange=this.findRange(this.bubbleJSONData[this.wcombovalue]);}
else{this.wsliderrange=["",""];}
this.setAxisName(this.xcombovalue,'xaxis');this.setAxisName(this.ycombovalue,'yaxis');this.setAxisName(this.zcombovalue,'zaxis');this.setAxisName(this.wcombovalue,'waxis');this.resetChannelMenu();if(Ext.getCmp('scalemenu')){Ext.getCmp('log').setChecked(this.logscale,true);Ext.getCmp('linear').setChecked(!this.logscale,true);var text;if(this.logscale){text="Scale: Log";}
else{text="Scale: Linear";}
Ext.getCmp('scalemenu').setText(text);}
if(Ext.getCmp('viewmenu')){Ext.getCmp('by_channel').setChecked(this.byChannel,true);Ext.getCmp('by_program').setChecked(this.byProgram,true);var text;if(this.view=="by_program"){text="View: Program";}
else{text="View: Channel";}
Ext.getCmp('viewmenu').setText(text);}
var checkindex=-1;for(var i=0;i<this.index.length;i++){for(var j=0;j<this.selCombos.length;j++){if(checkindex==-1&&this.selCombos[j]==this.index[i][0]){checkindex=j;}}
if(checkindex==-1){this.availCombos.push(this.index[i][0]);}
checkindex=-1;}},replace:function(arrayValues,replaceTo,replaceWith)
{var i=arrayValues.indexOf(replaceTo);if(arrayValues[i]!=-1){if(replaceWith==undefined){arrayValues.splice(i,1);}
else{arrayValues.splice(i,1,replaceWith);}}
return;},resetPanel:function(){Ext.getCmp('xCombo').setValue(this.xcombovalue);Ext.getCmp('yCombo').setValue(this.ycombovalue);Ext.getCmp('zCombo').setValue(this.zcombovalue);Ext.getCmp('wCombo').setValue(this.wcombovalue);this.resetFromToPanel(this.xsliderrange,'x');this.resetFromToPanel(this.ysliderrange,'y');if(this.zcombovalue=="none"){Ext.getCmp('zSlider').setDisabled(true);Ext.getCmp('zPanel').disable();}else{this.resetFromToPanel(this.zsliderrange,'z');}
if(this.wcombovalue=="none"||this.wcombovalue=="channelColor"){Ext.getCmp('wSlider').setDisabled(true);Ext.getCmp('wPanel').disable();}else{this.resetFromToPanel(this.wsliderrange,'w');}},resetFromToPanel:function(values,id){var fromPanel=Ext.getCmp(id+'From');if(fromPanel!=null&&fromPanel.rendered){fromPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(values[0],id
+'axis',false)||0});}
var toPanel=Ext.getCmp(id+'To');if(toPanel!=null&&toPanel.rendered){toPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(values[1],id
+'axis',false)||0});}},resetSliderSize:function(sliderCompName){var values,id,comboname;if(sliderCompName=='xSlider'){values=this.checkRangeAlreadySet(this.xcombovalue);comboname=this.xcombovalue;id='x';if(values==null){this.xsliderrange=this.findXRange();values=this.xsliderrange;}else{this.xsliderrange=values;}}else if(sliderCompName=='ySlider'){values=this.checkRangeAlreadySet(this.ycombovalue);id='y';comboname=this.ycombovalue;if(values==null){this.ysliderrange=this.findYRange();values=this.ysliderrange;}else{this.ysliderrange=values;}}else if(sliderCompName=='zSlider'){values=this.checkRangeAlreadySet(this.zcombovalue);id='z';comboname=this.zcombovalue;if(values==null){this.zsliderrange=this.findZRange();values=this.zsliderrange;}else{this.zsliderrange=values;}}else{values=this.checkRangeAlreadySet(this.wcombovalue);id='w';comboname=this.wcombovalue;if(values==null){this.wsliderrange=this.findWRange();values=this.wsliderrange;}else{this.wsliderrange=values;}}
if(comboname=='none'||comboname=='channelColor'){values=["",""];}
this.resetFromToPanel(values,id);this.setSliderSize(values,sliderCompName);},resetChannelMenu:function(){if(this.view=="by_program"){this.byProgram=true;this.byChannel=false;if(Ext.getCmp('channel_menu_button')){Ext.getCmp('channel_menu_button').setDisabled(false);var menu=Ext.getCmp('menu_channel_items');this.channelIds=[];var items=this.createChannelMenuItems(this.bubbleJSONData);if(items.length>0){menu.removeAll();menu.add(items);}
menu.doLayout();}}else{if(Ext.getCmp('channel_menu_button')){Ext.getCmp('channel_menu_button').setDisabled(true);}
this.byProgram=false;this.byChannel=true;}},resetCombos:function(comboName){var comboUpdated=['xCombo','yCombo','zCombo','wCombo'];var sliderUpdated=['xSlider','ySlider','zSlider','wSlider'];var axisUpdated=['xaxis','yaxis','zaxis','waxis'];var cvalue=Ext.getCmp(comboName).getValue();var prevValue=this.getComboValue(comboName);if(cvalue==prevValue){return;}
if(cvalue!="none"&&cvalue!='channelColor'){var index=-1;for(var i=0;i<this.selCombos.length;i++){if(this.selCombos[i]==cvalue){index=i;break;}}
if(prevValue=="channelColor"||prevValue=="none"){for(var i=0;i<this.availCombos.length;i++){for(var j=0;j<this.selCombos.length;j++){if(this.availCombos[i]!=this.selCombos[j]){prevValue=this.availCombos[i];break;}}}}
var avail,selected,prevComboValue,currentIndex,changeComboName,changeSliderName;var replaceComboValue,changeAxisDirection;if(index!=-1){changeComboName=comboUpdated[index];changeSliderName=sliderUpdated[index];changeAxisDirection=axisUpdated[index];replaceComboValue=prevValue;this.setComboValue(prevValue,changeComboName);this.resetSliderSize(changeSliderName);this.setAxisName(prevValue,changeAxisDirection);this.selCombos[index]=prevValue;}}
if(comboName=='xCombo'){this.xcombovalue=cvalue;this.selCombos[0]=cvalue;}else if(comboName=='yCombo'){this.ycombovalue=cvalue;this.selCombos[1]=cvalue;}else if(comboName=='zCombo'){this.zcombovalue=cvalue;this.selCombos[2]=cvalue;}else{this.wcombovalue=cvalue;this.selCombos[3]=cvalue;}
return;},getXYComboStore:function(){var store=new Ext.data.ArrayStore({fields:['id','name'],data:this.index});return store;},getZComboStore:function(){var store=new Ext.data.ArrayStore({fields:['id','name'],data:this.indexWithNone});return store;},getWComboStore:function(){this.indexColorWithNone.push(["channelColor","Color for Channel Picker"]);if(!this.wstore){this.wstore=new Ext.data.ArrayStore({fields:['id','name'],data:this.indexColorWithNone});}},reloadChart:function(){if(Mkt.charts.bubbleChart.store){var storeData=this.setStoreData();Mkt.charts.bubbleChart.setTitle(this.xtitle,'xaxis');Mkt.charts.bubbleChart.setTitle(this.ytitle,'yaxis');storeData=Mkt.charts.bubbleChart.setMetricsData(storeData);this.bubbleChartData=storeData;Mkt.charts.bubbleChart.store.loadData(storeData);}},getMetricsData:function(index){var metricsdata=this.bubbleChartData[index];if(metricsdata.data!=null&&metricsdata.$className!=null){return metricsdata.data;}
else{return metricsdata;}},redirectProgramReports:function(index,measure){var form=document.createElement("form");form.setAttribute("method","POST");form.setAttribute("action",this.rcaendpoint+"/rce/DrillThrough");var costArea=["Cost per Member","Cost per Success","Cost per New Name","Cost per Success (New Names)","Program Cost"];var opptyArea=["Expected Revenue (Acquisition)","Expected Revenue (Success)","Pipeline Open (Acquisition)","Pipeline Open (Success)","Pipeline Generated (Acquisition)","Pipeline Generated (Success)","Revenue To Investment (Acquisition)","Revenue To Investment (Success)","Revenue (Acquisition)","Revenue (Success)"];var memberArea=["Success (New Names)","Success (Total)","% New Names","% Success (Total)","% Success (New Names)","Members","New Names"];form.setAttribute("target","_blank");var cview="channel";var pdata=this.getMetricsData(index);var cincluded=[];if(this.view=="by_program"){cview="program";var j=0;for(var i=0;i<this.channelIds.length;i++){if(this.channelExcludeList&&this.channelExcludeList.length>0&&this.channelExcludeList.indexOf(this.channelIds[i])!=-1){cincluded[j++]=this.channelIds[i];}
else{cincluded[j++]=this.channelIds[i];}}}
var hiddenField=document.createElement("input");hiddenField.setAttribute("name","view");hiddenField.setAttribute("value",cview);form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","custPrefix");hiddenField.setAttribute("value",this.rcacustprefix);form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","costfrom");hiddenField.setAttribute("value",this.settings.dateFrom);form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","costto");hiddenField.setAttribute("value",this.settings.dateTo);form.appendChild(hiddenField);var area;if(pdata!=null){if(costArea.indexOf(measure)!=-1){area="cost";}
else if(opptyArea.indexOf(measure)!=-1){area="oppty";}
else if(memberArea.indexOf(measure)!=-1){area="member";}
else{area="stage";}
hiddenField=document.createElement("input");hiddenField.setAttribute("name","area");hiddenField.setAttribute("value",area);form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","channelname");hiddenField.setAttribute("value",pdata['name'][0]);form.appendChild(hiddenField);if(pdata['name'][1].length>0){hiddenField=document.createElement("input");hiddenField.setAttribute("name","programname");hiddenField.setAttribute("value",pdata['name'][1]);form.appendChild(hiddenField);}
hiddenField=document.createElement("input");hiddenField.setAttribute("name","measure");hiddenField.setAttribute("value",measure);form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","measurex");hiddenField.setAttribute("value",this.getComboTitle('xCombo'));form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","measurey");hiddenField.setAttribute("value",this.getComboTitle('yCombo'));form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","measurez");hiddenField.setAttribute("value",this.getComboTitle('zCombo'));form.appendChild(hiddenField);hiddenField=document.createElement("input");hiddenField.setAttribute("name","measurew");hiddenField.setAttribute("value",this.getComboTitle('wCombo'));form.appendChild(hiddenField);if(this.view=="by_channel"){cincluded=[];}
hiddenField=document.createElement("input");hiddenField.setAttribute("name","channelsIncluded");hiddenField.setAttribute("value",cincluded.join(','));form.appendChild(hiddenField);}
form.style.display="none";document.body.appendChild(form);form.submit();document.body.removeChild(form);return;},buildSettings:function(){var tip=new Ext.slider.Tip({getText:function(thumb){var id=thumb.slider.id;var direction;if(id=="xSlider"){direction="xaxis";}
else if(id=="ySlider"){direction="yaxis";}
else if(id=="zSlider"){direction="zaxis";}
else{direction="waxis";}
return String.format('<b>{0}</b>',Mkt.apps.ProgramAnalyzer.getSliderThumbValue(direction,thumb.value));}});var _createCombo=function(id,store){return new Ext.form.ComboBox({id:id+'Combo',hideLabel:true,anchor:'100%',valueField:'id',displayField:'name',cls:'paSettingsSelector',typeAhead:true,resizable:true,mode:'local',triggerAction:'all',forceSelection:true,selectOnFocus:true,store:store,listeners:{select:function(storeItem,item){var values=[];Mkt.apps.ProgramAnalyzer.setTitle(item.get('name'),id+'axis');Mkt.apps.ProgramAnalyzer.resetCombos(id+'Combo');if(this.getValue()=='none'||this.getValue()=='channelColor'){Ext.getCmp(id+'Slider').setDisabled(true);Ext.getCmp(id+'Panel').disable();var fromPanel=Ext.getCmp(id+'From');if(fromPanel!=null){fromPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(values[0],id+'axis',false)||0});}
var toPanel=Ext.getCmp(id+'To');if(toPanel!=null){toPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(values[1],id+'axis',false)||0});}}else{Ext.getCmp(id+'Panel').enable();Mkt.apps.ProgramAnalyzer.resetSliderSize(id+'Slider');}
Mkt.apps.ProgramAnalyzer.reloadChart();Mkt.apps.ProgramAnalyzer.autosave();}}});};var _sliderChangedCallback=function(id,slider){var values=slider.getValues();var dataRange=Mkt.apps.ProgramAnalyzer.findComboRangeForSlider(id
+'Slider'),increment=Math.ceil(Math.max(slider.increment,slider.keyIncrement)/2),deltaAllowed=increment;if(values[1]-values[0]<0){slider.setValue(1,values[0]);slider.setValue(0,values[1]);var tmp=values[1];values[1]=values[0];values[0]=tmp;}
Mkt.apps.ProgramAnalyzer.setDataFilterFlag(true);var dataValues=Mkt.apps.ProgramAnalyzer.getSliderDistribution(id+'axis',values[0],values[1]);var comboValue=Mkt.apps.ProgramAnalyzer.getComboValue(id+'Combo');Mkt.apps.ProgramAnalyzer.setComboRangeData(comboValue,dataValues);Mkt.apps.ProgramAnalyzer.setRangeSize(dataValues,id+'Slider');var fromPanel=Ext.getCmp(id+'From');if(fromPanel!=null&&fromPanel.rendered){fromPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(dataValues[0],id
+'axis',false)||0});}
var toPanel=Ext.getCmp(id+'To');if(toPanel!=null&&toPanel.rendered){toPanel.update({value:Mkt.apps.ProgramAnalyzer.getFormattedData(dataValues[1],id
+'axis',false)||0});}
Mkt.apps.ProgramAnalyzer.reloadChart();Mkt.apps.ProgramAnalyzer.autosave();};var _sliderRangeCheckCallback=function(slider,newValue,oldValue,thumb,id){var dataRange=Mkt.apps.ProgramAnalyzer.findComboRangeForSlider(id
+'Slider'),increment=Math.ceil(Math.max(slider.increment,slider.keyIncrement)/2),deltaAllowed=Math.max(Math.round(((dataRange[1]-dataRange[0])/100)*10),increment),aboveThumb=slider.thumbs[thumb.index+1],belowThumb=slider.thumbs[thumb.index-1],constrainedValue=newValue;if(belowThumb!=undefined&&newValue<belowThumb.value+deltaAllowed-increment){constrainedValue=belowThumb.value+deltaAllowed;}
if(aboveThumb!=undefined&&newValue>aboveThumb.value-deltaAllowed+increment){constrainedValue=aboveThumb.value-deltaAllowed;}
if(constrainedValue!==newValue){slider.setValue(thumb.index,constrainedValue,false);return false;}};var _createSlider=function(id,values,min,max){var slider=new Ext.Slider({id:id+'Slider',hideLabel:true,anchor:'100%',cls:'paSettingsSlider',minValue:min,maxValue:max,increment:1,values:values,plugins:tip});slider.on('changecomplete',_sliderChangedCallback.createDelegate(this,[id,slider]));return slider;};var _createPanel=function(id,from,to){return new Ext.Panel({id:id+'Panel',anchor:'100%',unstyled:true,cls:'paSettingsRangePanel',layout:'column',items:[{id:id+'From',columnWidth:.5,tpl:'<b>From:</b> <span>{value}</span>',data:{value:from||0},unstyled:true,cls:'paSettingsRangeFrom'},{id:id+'To',columnWidth:.5,tpl:'<b>To:</b> <span>{value}</span>',data:{value:to||0},unstyled:true,cls:'paSettingsRangeTo'}],enable:function(){this.removeClass('paSettingsRangePanelDisabled');},disable:function(){this.addClass('paSettingsRangePanelDisabled');}});};var datarange=this.getSliderDistribution('xaxis');var sliderrange=this.getSliderIndexes('xaxis');var combox=_createCombo('x',Mkt.apps.ProgramAnalyzer.getXYComboStore());var sliderx=_createSlider('x',sliderrange,sliderrange[0],sliderrange[1]);var xpanel=_createPanel('x',datarange[0],datarange[1]);datarange=this.getSliderDistribution('yaxis');sliderrange=this.getSliderIndexes('yaxis');var comboy=_createCombo('y',Mkt.apps.ProgramAnalyzer.getXYComboStore());var slidery=_createSlider('y',sliderrange,sliderrange[0],sliderrange[1]);var ypanel=_createPanel('y',datarange[0],datarange[1]);var comboz=_createCombo('z',Mkt.apps.ProgramAnalyzer.getZComboStore());datarange=this.getSliderDistribution('zaxis');sliderrange=this.getSliderIndexes('zaxis');var sliderz=_createSlider('z',sliderrange,sliderrange[0],sliderrange[1]);var zpanel=_createPanel('z',datarange[0],datarange[1]);datarange=this.getSliderDistribution('waxis');sliderrange=this.getSliderIndexes('waxis');Mkt.apps.ProgramAnalyzer.getWComboStore();var combow=_createCombo('w',this.wstore);var sliderw=_createSlider('w',sliderrange,sliderrange[0],sliderrange[1]);var wpanel=_createPanel('w',datarange[0],datarange[1]);var xFieldSet=new Ext.form.FieldSet({title:'<img class="mkiArrow2RightBlue" src="'+Ext.BLANK_IMAGE_URL
+'" />&nbsp;&nbsp; X Axis',cls:'paSettingsBlock',autoHeight:true,items:[combox,sliderx,xpanel]});var yFieldSet=new Ext.form.FieldSet({title:'<img class="mkiArrow2UpBlue""16" src="'+Ext.BLANK_IMAGE_URL
+'" />&nbsp;&nbsp; Y Axis',cls:'paSettingsBlock',autoHeight:true,items:[comboy,slidery,ypanel]});var sizeFieldSet=new Ext.form.FieldSet({title:'<img class="mkiCompasses" src="'+Ext.BLANK_IMAGE_URL
+'" />&nbsp;&nbsp; Bubble Size',cls:'paSettingsBlock',autoHeight:true,items:[comboz,sliderz,zpanel]});var colorFieldSet=new Ext.form.FieldSet({title:'<img class="mkiColorWheel" src="'+Ext.BLANK_IMAGE_URL
+'" />&nbsp;&nbsp; Color',cls:'paSettingsBlock',autoHeight:true,items:[combow,sliderw,wpanel]});var bubblepanel=new Ext.Panel({title:'Settings',cls:'paSettings',collapsible:false,frame:true,width:250,renderTo:'settings_container',items:[xFieldSet,yFieldSet,sizeFieldSet,colorFieldSet]});}};Ext.applyIf(Mkt.apps.ProgramAnalyzer,Mkt.apps.Analyzer);Mkt.apps.AccountAnalyzer={weeklyTrigger:150,weekly:false,view:null,name:null,opty:null,leads:[],saveBtn:null,INTERACTIONS_CUMULATIVE:'Interactions (Cumulative)',INTERACTIONS_INTENSITY:'Interactions (Intensity)',SCORE:'Score',TYPE_INTERSTING_MOMENT:'Interesting Moment',TYPE_ADDED_TO_OPTY:'Added to Opportunity',TYPE_EVENT_SUCCESS:'Event Success',TYPE_PROGRAM_SUCCESS:'Program Success',analyzerScript:'/mkt-ext-2.0/apps/AccountAnalyzerChart.js',chartObjName:'accountChart',optionalMenu:function(){if(!MktPage.xfeatures){return null;}
var menuButton=new Ext.Button({text:'View',iconCls:'mkiWindowView',menu:{xtype:'menu',plain:true,items:[{text:this.INTERACTIONS_CUMULATIVE,id:'interaction_cumulative',checked:this.view=='interaction_cumulative'||this.view==null,group:'view',checkHandler:Mkt.apps.AccountAnalyzer.viewHandler},{text:this.INTERACTIONS_INTENSITY,id:'interaction_intensity',checked:this.view=='interaction_intensity',group:'view',checkHandler:Mkt.apps.AccountAnalyzer.viewHandler},{text:this.SCORE,id:'score_mkto',checked:this.view=='score_mkto',group:'view',checkHandler:Mkt.apps.AccountAnalyzer.viewHandler}]}});return menuButton;},viewHandler:function(item,checked){if(checked){Mkt.apps.AccountAnalyzer.view=item.id;Mkt.apps.AccountAnalyzer.switchChart();}},getData:function(){if(this.name!=null){this.analyzerData=null;this.hashData=new Ext.util.MixedCollection();this.leadsIds=[];MktCanvas.mask();var dateFrom=this.settings.dateFrom;var dateTo=this.settings.dateTo;var splitDateFrom=dateFrom.split("/");var splitDateTo=dateTo.split("/");var parms={compId:this.compId,analyzerDomain:this.analyzerDomain,metric:'account',dateFrom:splitDateFrom[2]+"-"+splitDateFrom[0]+"-"+splitDateFrom[1],dateTo:splitDateTo[2]+"-"+splitDateTo[0]+"-"+splitDateTo[1],accountName:this.name};MktSession.ajaxRequest('analytics/getAccountAnalyzerData',{serializeParms:parms,onMySuccess:this.setData.createDelegate(this),onMyFailure:this.getDataFailure.createDelegate(this)});}else{MktCanvas.unmask();if(this.initialConfig.opptyNotFound){var opptyNotFoundMsgEl=Ext.get('opptyNotFoundMsg');if(opptyNotFoundMsgEl){opptyNotFoundMsgEl.setDisplayed(true);}}
else if(this.initialConfig.accountNotFound){var accountNotFoundMsgEl=Ext.get('accountNotFoundMsg');if(accountNotFoundMsgEl){accountNotFoundMsgEl.setDisplayed(true);}}
else{var accountMsgEl=Ext.get('accountMsg');if(accountMsgEl){accountMsgEl.setVisibilityMode(Ext.Element.DISPLAY).show();}}}
this.buildSettings();if(this.name){Ext.getCmp('accountPicker').setValue(this.name);}},initData:function(){var analyzersettings={};this.view=null;this.name=null;this.opty=null;this.leads=[];if(this.settings.reportJsonSettings&&this.settings.reportJsonSettings!=""){analyzersettings=Ext.decode(this.settings.reportJsonSettings);analyzersettings.name=unescape(analyzersettings.name);if(analyzersettings.name){this.name=analyzersettings.name;}
if(analyzersettings.view){this.view=analyzersettings.view;}
if(analyzersettings.opty){this.opty=analyzersettings.opty;}
if(analyzersettings.leads){this.leads=analyzersettings.leads;}}
if(this.initialConfig.opptyNotFound||this.initialConfig.accountNotFound){this.name=null;this.opty=null;}
else{if(this.initialConfig.accountName){this.name=this.initialConfig.accountName;this.opty=null;}
if(this.initialConfig.opptyName){this.opty=this.initialConfig.opptyName;}}
if(!MktPage.xfeatures){this.view=this.INTERACTIONS_CUMULATIVE;}},setData:function(){if(MktPage.appVars.analyzerData.status=="error"){MktMessage.showError(MktPage.appVars.analyzerData.msg);}else{this.analyzerData=Ext.decode(MktPage.appVars.analyzerData.GET_COMPANY_ACTIVITIES);this.weekly=false;if(this.validateData()){this.buildDatesBasedHash();}
this.buildOpty();if(this.opty){Ext.getCmp('opptyPicker').setValue(this.opty);}else{if(this.analyzerData.oppties.length>0){Ext.getCmp('opptyPicker').setValue(this.analyzerData.oppties[0][0]);}else{Ext.getCmp('opptyPicker').setValue(0);}}
var accountMsgEl=Ext.get('accountMsg');if(accountMsgEl){accountMsgEl.setVisibilityMode(Ext.Element.DISPLAY).hide();}
var accountNotFoundMsgEl=Ext.get('accountNotFoundMsg');if(accountNotFoundMsgEl){accountNotFoundMsgEl.setDisplayed(false);}
var opptyNotFoundMsgEl=Ext.get('opptyNotFoundMsg');if(opptyNotFoundMsgEl){opptyNotFoundMsgEl.setDisplayed(false);}}
MktCanvas.unmask();},saveData:function(){jsonObject={view:this.view,name:escape(this.name),opty:this.opty,leads:this.leads}
return jsonObject;},getSaveBtn:function(){var cfg=Mkt.apps.Analyzer.autoSaveConfig;var saveActionBtn=new Ext.Toolbar.Button({id:'analyzerSaveSettingsButton',text:cfg.nochangeText,iconCls:cfg.nochangeIconCls,disabled:true});this.saveBtn=saveActionBtn;return saveActionBtn;},validateData:function(){if(this.analyzerData.lead_activities.lead_0&&this.analyzerData.lead_scores.lead_0){var name=this.analyzerData.name;MktMessage.showInfo('There were no activities or score changes in "'+name+'" account during selected timeframe');return false;}
return true;},buildDatesBasedHash:function(){if(this.debug){var start=new Date();}
var firstDate;var lastDate;var leadsIds=[];var latestScores=[];this.hashData.clear();var leads=this.analyzerData.leads;for(var i=0;i<leads.length;i++){var id=leads[i][0];this.leadsIds.push(id);latestScores.push(0);}
firstDate=Date.parseDate(this.analyzerData.firstDate,"Y-m-d").getTime();lastDate=Date.parseDate(this.analyzerData.lastDate,"Y-m-d").getTime();if(this.settings.dateFrom!=null&&this.settings.dateFrom.length>0){var dateFrom=Date.parseDate(this.settings.dateFrom,"m/d/Y").getTime();if(firstDate<dateFrom){firstDate=dateFrom;}}
if(this.settings.dateTo!=null&&this.settings.dateTo.length>0){var dateTo=Date.parseDate(this.settings.dateTo,"m/d/Y").getTime();if(lastDate>dateTo){lastDate=dateTo;}}
for(var i=firstDate;i<lastDate+86400000;i+=86400000){var date=new Date(i);var y=date.getUTCFullYear();var m=date.getUTCMonth()+1;var d=date.getUTCDate();if(m<10){m="0"+m;}
if(d<10){d="0"+d;}
this.hashData.add(y+"-"+m+"-"+d,{scores:new Array(leads.length),acts:new Array(leads.length),flags:new Array(leads.length)});}
for(i=0;i<leads.length;i++){var leadId=leads[i][0];var leadScoreData=this.analyzerData.lead_scores['lead_'+leadId];var leadActData=this.analyzerData.lead_activities['lead_'+leadId];if(leadScoreData){for(var j=0;j<leadScoreData.length;j++){var date=leadScoreData[j].date;var sc=leadScoreData[j].sc;if(this.hashData.containsKey(date)){var item=this.hashData.get(date);item.scores[i]=sc;this.hashData.replace(date,item);}else{console.log(date+" key missing!!!!!");}}}
if(leadActData){for(j=0;j<leadActData.length;j++){var date=leadActData[j].date;if(this.hashData.containsKey(date)){var item=this.hashData.get(date);if(item.acts[i]==null){item.acts[i]=[];}
item.acts[i].push(i+"-"+j);if(item.flags[i]==null){item.flags[i]=[];}
if(leadActData[j].type==this.TYPE_PROGRAM_SUCCESS&&item.flags.indexOf(this.TYPE_PROGRAM_SUCCESS)==-1){item.flags[i].push(this.TYPE_PROGRAM_SUCCESS);}
if(leadActData[j].type==this.TYPE_EVENT_SUCCESS&&item.flags.indexOf(this.TYPE_EVENT_SUCCESS)==-1){item.flags[i].push(this.TYPE_EVENT_SUCCESS);}
this.hashData.replace(date,item);}}}}
for(i=0;i<this.hashData.keys.length;i++){var key=this.hashData.keys[i];var item=this.hashData.get(key);for(j=0;j<item.scores.length;j++){if(item.scores[j]==null){item.scores[j]=latestScores[j];}else{latestScores[j]=item.scores[j];}}}
if(this.debug){console.log("buildDatesBasedHash() "+(new Date().getTime()-start.getTime())+"ms ("+leads.length+" leads)");}},getLoadedData:function(){return this.analyzerData;},getDataFailure:function(obj){MktMessage.showError('Failed retrieving analyzer data');MktCanvas.unmask();},switchChart:function(){Mkt.charts.accountChart.switchView(this.view);this.autosave();},loadChart:function(){if(this.debug){var start=new Date();}
var data=Mkt.apps.AccountAnalyzer.buildData();var chartObj=Mkt.charts.accountChart;if(data.length>0){Ext.get('leadMsg').hide();Ext.get('accountAnalyzerChartContainer').show();try{if(chartObj.chart){chartObj.clearFlags();chartObj.store.loadData(data);}else{chartObj.setChartData(data);chartObj.renderChart();}}catch(e){if(Mkt.apps.AccountAnalyzer.debug){console.error(e);}
MktCanvas.unmask();chartObj.chart.destroy();chartObj.chartPanel.destroy();delete chartObj.chart;delete chartObj.chartPanel;MktMessage.showInfo("No information available for these leads in the selected timeframe");}}else{Ext.get('accountAnalyzerChartContainer').hide();Ext.get('leadMsg').show();return;}
if(this.debug){console.log("loadChart() "+(new Date().getTime()-start.getTime())+"ms");}},mktoScoreFormula:function(scores){var x=0.7;var ratio=1-x;var mktTotal=0;var powerOf=0;scores=scores.sort();for(var i=scores.length-1;i>-1;i--){if(powerOf==0){mktTotal+=scores[i];}else if(powerOf==1){mktTotal+=scores[i]*ratio;}else{mktTotal+=scores[i]*Math.pow(ratio,powerOf);}
powerOf++;}
return mktTotal;},buildData:function(){if(this.debug){var start=new Date();}
var key,item,scores,act,mktAct,acts,flags,leadActs,total,mktTotal,mktScores,selectedActs,selectedFlags;var returnData=[];var leadScoreData;var leadActivityData;var keyDate;var oldTotal=0;var upTodayActsCount=0;var optyTrend=0;var record;var actRecordsIndex=[];var hashScoreColumns=[];var optyStart,optyEnd;var inOpty=false;var startEndOpty=false;var optyId;var rangeHasOpty=false;var oppties=this.analyzerData.oppties;if(oppties.length>0){if(this.opty){for(var oi=0;oi<oppties.length;oi++){if(oppties[oi][0]==this.opty){optyStart=Date.parseDate(oppties[oi][5],"Y-m-d");optyEnd=Date.parseDate(oppties[oi][6],"Y-m-d");optyId=oppties[oi][0];}}}else{optyStart=Date.parseDate(oppties[0][5],"Y-m-d");optyEnd=Date.parseDate(oppties[0][6],"Y-m-d");optyId=oppties[0][0];}
if(optyStart&&optyEnd){if(optyStart.getTime()>optyEnd.getTime()){var tempDate=optyEnd;optyEnd=optyStart;optyStart=tempDate;}}}
var opLeadCheckBoxes=Ext.getCmp('checkBoxes1').items.items;var nopLeadCheckBoxes=Ext.getCmp('checkBoxes2').items.items;var leadCheckBoxes=opLeadCheckBoxes.concat(nopLeadCheckBoxes);this.leads=[];if(leadCheckBoxes.length==0){return[];}
for(var i=0;i<leadCheckBoxes.length;i++){if(leadCheckBoxes[i].checked){var id=leadCheckBoxes[i].leadId
for(var j=0;j<this.leadsIds.length;j++){if(id==this.leadsIds[j]){hashScoreColumns.push(j);this.leads.push(id);break;}}}}
if(hashScoreColumns.length>0){var optyStartIndex=0;var optyEndIndex=this.hashData.keys.length-1;for(i=0;i<this.hashData.keys.length;i++){key=this.hashData.keys[i];item=this.hashData.get(key);scores=item.scores;acts=item.acts;flags=item.flags;total=0;mktTotal=0;mktScores=[];selectedActs=[];selectedFlags=[];oldTotal=total;optyTrend=0;keyDate=Date.parseDate(key,"Y-m-d");inOpty=false;startEndOpty=false;if(optyStart&&optyEnd){if(keyDate.getTime()==optyStart.getTime()){startEndOpty=true;selectedActs.push("optyStart-"+optyId);optyStartIndex=i;}
if(keyDate.getTime()==optyEnd.getTime()){startEndOpty=true;selectedActs.push("optyEnd-"+optyId);optyEndIndex=i;}
if(keyDate.getTime()>=optyStart.getTime()&&keyDate.getTime()<=optyEnd.getTime()){inOpty=true;rangeHasOpty=true;}}
for(j=0;j<hashScoreColumns.length;j++){total+=scores[hashScoreColumns[j]];mktScores.push(scores[hashScoreColumns[j]]);leadActs=acts[hashScoreColumns[j]];if(leadActs!=null&&leadActs.length>0){selectedActs=selectedActs.concat(leadActs);}
leadFlags=flags[hashScoreColumns[j]];if(leadFlags!=null&&leadFlags.length>0){for(var f=0;f<leadFlags.length;f++){if(selectedFlags.indexOf(leadFlags[f])==-1){selectedFlags.push(leadFlags[f]);}}}}
mktTotal=this.mktoScoreFormula(mktScores);act=total;if(selectedActs.length>0||startEndOpty){mktAct=mktTotal;upTodayActsCount+=selectedActs.length;if(inOpty){optyTrend=upTodayActsCount;}
actRecordsIndex.push(i);record={date:keyDate,sc:mktTotal,act:mktAct,actCount:selectedActs.length,trend:selectedActs.length,upToday:upTodayActsCount,upTrend:upTodayActsCount,optyTrend:optyTrend,acts:selectedActs,flags:selectedFlags};}else{record={date:keyDate,sc:mktTotal,trend:0};if(i==0||i==this.hashData.keys.length-1){record.upTrend=upTodayActsCount;if(inOpty){record.optyTrend=upTodayActsCount;}}}
returnData.push(record);}
if(returnData.length==1){var dummyRecord={date:returnData[0].date.add(Date.DAY,-1),score:0,trend:0,upTrend:0};returnData.unshift(dummyRecord);}
if(returnData.length>this.weeklyTrigger){this.weekly=true;var weeklyData=[];mktTotal=0;act=0;var actCount=0;var upToday=0;acts=[];actRecordsIndex=[];var itemCounter=0;optyStartIndex=0;optyEndIndex=0;inOpty=false;startOpty=false;endOpty=false;for(var i=0;i<returnData.length;i++){keyDate=returnData[i].date;if(keyDate.getDay()==0){mktTotal=0;actCount=0;trend=0;acts=[];flags=[];inOpty=false;}
mktTotal+=returnData[i].sc;if(returnData[i].upToday>upToday){upToday=returnData[i].upToday;}
if(returnData[i].actCount>0){actCount+=returnData[i].actCount;acts=acts.concat(returnData[i].acts);}
if(returnData[i].flags&&returnData[i].flags.length>0){for(var f=0;f<returnData[i].flags.length;f++){if(flags.indexOf(returnData[i].flags[f])==-1){flags.push(returnData[i].flags[f]);}}}
if(optyStart&&optyEnd){if(keyDate.getTime()==optyStart.getTime()){startOpty=true;}
if(keyDate.getTime()==optyEnd.getTime()){endOpty=true;}
if(keyDate.getTime()>=optyStart.getTime()&&keyDate.getTime()<=optyEnd.getTime()){inOpty=true;rangeHasOpty=true;}}
if(keyDate.getDay()==6){if(startOpty){optyStartIndex=itemCounter;startOpty=false;}
if(endOpty){optyEndIndex=itemCounter;endOpty=false;}
if(actCount>0){actRecordsIndex.push(itemCounter);record={date:keyDate,sc:mktTotal/7,act:mktTotal/7,actCount:actCount,trend:actCount,upToday:upToday,upTrend:upToday,acts:acts,flags:flags};if(inOpty){record.optyTrend=upToday;}}else{record={date:keyDate,sc:mktTotal/7,trend:0};if(itemCounter==0){record.upTrend=upToday;if(inOpty){record.optyTrend=upToday;}}}
weeklyData.push(record);itemCounter++;}}
if(keyDate.getDay()!=6){var lastSaturday=weeklyData[weeklyData.length-1].date;lastSaturday=lastSaturday.add(Date.DAY,7);if(actCount>0){actRecordsIndex.push(itemCounter);record={date:lastSaturday,sc:mktTotal/7,act:mktTotal/7,actCount:actCount,trend:actCount,upToday:upToday,upTrend:upToday,acts:acts,flags:flags};}else{record={date:lastSaturday,sc:mktTotal/7,trend:0};}
if(inOpty){record.optyTrend=upToday;}
weeklyData.push(record);}
if(!weeklyData[weeklyData.length-1].upTrend){weeklyData[weeklyData.length-1].upTrend=upToday;}
returnData=weeklyData;}
if(optyEndIndex==0){optyEndIndex=returnData.length-1;}
if(rangeHasOpty){if(optyStartIndex>0){returnData[optyStartIndex-1].optyTrend=0;}
if(optyEndIndex+1<returnData.length){returnData[optyEndIndex+1].optyTrend=0;}}else{returnData[0].optyTrend=0;returnData[returnData.length-1].optyTrend=0;}}
Mkt.charts.accountChart.actRecordIndex=actRecordsIndex;if(this.debug){console.log("buildData() "+(new Date().getTime()-start.getTime())+"ms");}
return returnData;},getTooltipHtml:function(acts){var tip="";for(var i=0;i<acts.length;i++){var actRecord=acts[i];var actParts=actRecord.split("-");if(actParts[0]=="optyStart"||actParts[0]=="optyEnd"){var type="optyDate";}else{var leadIndex=actParts[0];var actIndex=actParts[1];var lead=this.analyzerData.leads[leadIndex];var leadId=lead[0];var leadName=lead[1];var act=this.analyzerData.lead_activities["lead_"+leadId][actIndex];var type=act.type;}
tip+="<BR/>";switch(type){case this.TYPE_INTERSTING_MOMENT:tip+="<div class='mkiMegaphone interactionTipIconDiv'></div>";tip+="<div class='interactionTipTextDiv'><b>Name:</b> "+leadName+"<BR/>";tip+="<b>Type:</b> "+type+" - "+act.im_type+"<BR/>";tip+="<b>Text:</b> "+act.description+"<BR/>";break;case this.TYPE_ADDED_TO_OPTY:var optyName="";var oppty=this.getOptyById(act.oppty_id);if(oppty){optyName=oppty[1];}
tip+="<div class='mkiWoman3Moneybag interactionTipIconDiv'></div>";tip+="<div class='interactionTipTextDiv'><b>Name:</b> "+leadName+"<BR/>";tip+="<b>Type:</b> "+type+"<BR/>";tip+="<b>Role:</b> "+act.role+"<BR/>";tip+="<b>Opty:</b> "+optyName+"<BR/>";tip+="<b>Primary:</b> "+(act.primary?"Yes":"No")+"<BR/>";break;case this.TYPE_EVENT_SUCCESS:tip+="<div class='mkiCalApproved interactionTipIconDiv'></div>";tip+="<div class='interactionTipTextDiv'><b>Name:</b> "+leadName+"<BR/>";tip+="<b>Type:</b> "+type+"<BR/>";tip+="<b>Program:</b> "+act.program+"<BR/>";tip+="<b>Channel:</b> "+act.channel+"<BR/>";tip+="<b>Status:</b> "+act.status+"<BR/>";break;case this.TYPE_PROGRAM_SUCCESS:tip+="<div class='mkiWalletApproved interactionTipIconDiv'></div>";tip+="<div class='interactionTipTextDiv'><b>Name:</b> "+leadName+"<BR/>";tip+="<b>Type:</b> "+type+"<BR/>";tip+="<b>Program:</b> "+act.program+"<BR/>";tip+="<b>Channel:</b> "+act.channel+"<BR/>";tip+="<b>Status:</b> "+act.status+"<BR/>";break;case"optyDate":var oppty=this.getOptyById(actParts[1]);if(oppty){optyName=oppty[1];if(actRecord.indexOf("optyStart")!=-1){var description="Opportunity Created";}else if(actRecord.indexOf("optyEnd")!=-1){var description="Opportunity "+oppty[3];}
var amount=oppty[4];if(this.settings.currencysettings){var formatsettings=Ext.decode(this.settings.currencysettings);amount=Mkt.util.locale.Format.formatCurrency(amount,formatsettings.currencyFormat,formatsettings.currencySymbol,{includeFractional:2});}
tip+="<div class='mkiMoney interactionTipIconDiv'></div>";tip+="<div class='interactionTipTextDiv'><b>"+description+"</b><BR/>";tip+="<b>Name:</b> "+oppty[1]+"<BR/>";tip+="<b>Type:</b> "+oppty[2]+"<BR/>";tip+="<b>Amount:</b> "+amount+"<BR/>";}
break;}
tip+="</div>";}
return tip;},buildSettings:function(){var settingsDom=(Ext.query("div[id='presentationBox'] #accountAnalyzerSettings").length>0);var formPanel=Ext.getCmp('accountAnalyzerSettings');if(formPanel&&settingsDom){formPanel.destroy();}
var accountBox=null;if(this.initialConfig.isSalesUserReport){accountBox=new Ext.form.DisplayField({fieldLabel:'Account',id:'accountPicker',labelStyle:'width:60px; font-weight: bold;',style:'padding-top: 3px',value:this.name});}
else{accountBox=new Ext.form.ImprovedComboBox({fieldLabel:'Account',id:'accountPicker',displayField:'name',valueField:'name',width:205,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/analytics/getAccountListData',fields:['name']}),labelStyle:'width:60px; font-weight: bold;',mode:'remote',queryDelay:1000,loadingText:'Searching...',forceSelection:true,typeAhead:true,allowBlank:true,emptyText:'',triggerAction:'all',minChars:0,listeners:{select:function(){var name=this.getValue();Mkt.apps.AccountAnalyzer.name=name;Mkt.apps.AccountAnalyzer.opty=null;Mkt.apps.AccountAnalyzer.leads=[];Mkt.apps.AccountAnalyzer.autosave();Mkt.apps.AccountAnalyzer.getData(name);}}});}
var leadsPanel=new Ext.Panel({id:'accountAnalyzerSettings',layout:'form',title:'Settings',labelWidth:1,width:300,cls:'paSettings',frame:true,autoScroll:false,containerScroll:false,renderTo:'leads_container',bodyStyle:'padding:10px 10px 0;',items:[accountBox]});},getOptyById:function(id){var oppties=Mkt.apps.AccountAnalyzer.analyzerData.oppties;var optyName="";for(var i=0;i<oppties.length;i++){if(oppties[i][0]==id){return oppties[i];}}
return false;},buildOpty:function(){if(this.debug){var start=new Date();}
var settingsPanel=Ext.getCmp('accountAnalyzerSettings');var oppties=this.analyzerData.oppties;var opData=[];var selectedOpty=this.opty;if(oppties.length==0){opData.push([0,'None']);}
for(var i=0;i<oppties.length;i++){var id=oppties[i][0];var name=oppties[i][1]+" ("+oppties[i][3]+")";opData.push([id,name]);if(selectedOpty==null&&i==0){selectedOpty=id;}}
var settingsDom=(Ext.query("div[id='presentationBox'] #opptyPicker").length>0);var oldBox=Ext.getCmp('opptyPicker');if(oldBox&&settingsDom){oldBox.destroy();}
var comboBox={xtype:'combo',id:'opptyPicker',fieldLabel:'Opty',labelStyle:'width:60px; font-weight: bold;',width:205,typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({fields:['opId','displayText'],data:opData}),valueField:'opId',displayField:'displayText',listeners:{select:function(){var opId=this.getValue();Mkt.apps.AccountAnalyzer.opty=opId;Mkt.apps.AccountAnalyzer.leads=[];Mkt.apps.AccountAnalyzer.buildOpLeads(opId);Mkt.apps.AccountAnalyzer.autosave();}}};settingsPanel.add(comboBox);settingsPanel.doLayout();Mkt.apps.AccountAnalyzer.buildOpLeads(selectedOpty);},buildOpLeads:function(opId){MktSession.clockCursor(true);var scrollHeight=this.initialConfig.containerHeight-120;var settingsDom=(Ext.query("div[id='presentationBox'] #leadBoxes").length>0);var leadsContainer=Ext.getCmp('leadBoxes');if(leadsContainer&&settingsDom){scrollHeight=leadsContainer.el.dom.offsetHeight;leadsContainer.destroy();}
if(opId==0){opId=null;}
if(opId){var opLeads=this.analyzerData.oppty_leads["oppty_"+opId];if(opLeads==null){opLeads=[];}}
var opLeadsHash=new Ext.util.MixedCollection();var leadsHash=new Ext.util.MixedCollection();for(var i=0;i<this.analyzerData.leads.length;i++){var leadId=this.analyzerData.leads[i][0];var eventCount=0
if(this.analyzerData.lead_activities["lead_"+leadId]){eventCount=this.analyzerData.lead_activities["lead_"+leadId].length;}
if(opId&&(opLeads.indexOf(leadId)!=-1||opLeads.indexOf(leadId*-1)!=-1)){opLeadsHash.add(i,eventCount);}else{leadsHash.add(i,eventCount);}}
opLeadsHash.sort('DESC');leadsHash.sort('DESC');var firstLeadId;var makeItem=function(hash,i){var key=hash.keys[i];var item=hash.get(key);var lead=Mkt.apps.AccountAnalyzer.analyzerData.leads[key];var leadId=lead[0];var name=lead[1];if(name==null){name=lead[6];}
var leadTitle=lead[3];if(leadTitle==null){leadTitle='none';}
var leadSource=lead[6];if(leadSource==null){leadSource='none';}
var savedLeads=Mkt.apps.AccountAnalyzer.leads;var toBeChecked=false;if(savedLeads.length>0&&savedLeads.indexOf(leadId)!=-1){toBeChecked=true;}
var primary=false;if(opId&&opLeads.indexOf(leadId*-1)!=-1){primary=true;hasPrimary=true;}
var config={boxLabel:name+" ("+item+")"+(primary?' <img src="/images/icons16/star_yellow.png" title="Primary"/>':''),leadId:leadId,id:'cb_'+leadId,name:'lead',primary:primary,checked:toBeChecked,listeners:{render:function(){Ext.get(this.el.dom.nextSibling).set({qtip:'<b>Title:</b> '+leadTitle+'<br/><b>Source:</b> '+leadSource});}},handler:function(leadId){MktSession.clockCursor(true);Mkt.apps.AccountAnalyzer.loadChart(leadId);Mkt.apps.AccountAnalyzer.autosave();}.createDelegate(this,[leadId])};return config;};var hasPrimary=false;var opPrimItems=[];var opItems=[];for(var i=0;i<opLeadsHash.length&&i<15;i++){var checkbox=makeItem(opLeadsHash,i);if(checkbox.primary){opPrimItems.push(checkbox);}else{opItems.push(checkbox);}}
opItems=opPrimItems.concat(opItems);var items=[];for(var i=0;i<leadsHash.length&&i<20;i++){var checkbox=makeItem(leadsHash,i);items.push(checkbox);}
if(this.leads.length==0){if(opItems.length>0){for(var j=0;j<opItems.length;j++){opItems[j].checked=true;}}else if(items.length>0){items[0].checked=true;}}
var newCheckGroup1={xtype:'checkboxgroup',fieldLabel:'Has&nbsp;Opty&nbsp;Role',labelStyle:'float: none; font-weight: bold; padding-left:0px',id:'checkBoxes1',itemCls:'x-check-group-alt',columns:1,items:[opItems]};var newCheckGroup2={xtype:'checkboxgroup',fieldLabel:'No&nbsp;Role',labelStyle:'float: none; font-weight: bold; padding-left:0px',id:'checkBoxes2',itemCls:'x-check-group-alt',columns:1,items:[items]};var leadsPanel={xtype:'form',id:'leadBoxes',style:'margin-top: 10px; height:'+scrollHeight+'px; overflow-y:auto',items:[newCheckGroup1,newCheckGroup2]}
var settingsPanel=Ext.getCmp('accountAnalyzerSettings');settingsPanel.add(leadsPanel);settingsPanel.doLayout();Mkt.apps.AccountAnalyzer.loadChart();MktSession.clockCursor(false);}};Ext.applyIf(Mkt.apps.AccountAnalyzer,Mkt.apps.Analyzer);Mkt.apps.SPAnalyzer={debug:false,constructor:function(config){this.start=new Date();this.BEGIN_BALANCE_METRIC="beginbalance";this.BALANCE_METRIC='balance';this.INFLOW_METRIC='inflow';this.OUTFLOW_METRIC='outflow';this.SLAMISSED_METRIC='slamissed';this.SLAOVERDUE_METRIC='slaoverdue';this.CONVRATIO_METRIC='convRatio';this.CYCLETIME_METRIC='cycleTime';this.indexNames={};this.indexNames[this.BEGIN_BALANCE_METRIC]='beginningBalance';this.indexNames[this.BALANCE_METRIC]='endingBalance';this.indexNames[this.INFLOW_METRIC]='inflow';this.indexNames[this.OUTFLOW_METRIC]='outflow';this.indexNames[this.SLAMISSED_METRIC]='slaMissed';this.indexNames[this.SLAOVERDUE_METRIC]='slaOverdue';this.indexNames[this.CONVRATIO_METRIC]='value';this.indexNames[this.CYCLETIME_METRIC]='value';this.analyzerDomain=config.analyzerDomain;this.settings={dateFrom:config.dateFrom,dateTo:config.dateTo}
this.columnIndex={};this.stageContext={};this.operationContext={};this.init();this.analyzerData={};this.lastDayofData;MktCanvas.on('resize',function(){Mkt.apps.SPAnalyzer.rebuildUI()});},init:function(){this.prebuildChartData={stages:[]}
this.getData();},getData:function(metric,stageName,stageToName,periodicity,range){if(this.debug){console.log("--getData start-- "+(new Date()-this.start));}
this.operationContext.metric=metric;this.operationContext.periodicity=periodicity;var dateFrom=this.settings.dateFrom;var dateTo=this.settings.dateTo;if(isDefined(range)&&range.length==2){dateFrom=this.operationContext.dateFrom=range[0];dateTo=this.operationContext.dateTo=range[1];}
var splitDateFrom=dateFrom.split("/");var splitDateTo=dateTo.split("/");var parms={analyzerDomain:this.analyzerDomain,dateFrom:splitDateFrom[2]+"-"+splitDateFrom[0]+"-"+splitDateFrom[1],dateTo:splitDateTo[2]+"-"+splitDateTo[0]+"-"+splitDateTo[1],periodicity:'date'};if(metric){parms.metric=metric;parms.stageName=stageName;parms.stageToName=stageToName;parms.periodicity=periodicity;MktSession.ajaxRequest('analytics/getAnalyzerData',{serializeParms:parms,onMySuccess:metric?this.setAdditionalData.createDelegate(this):this.setData.createDelegate(this),onMyFailure:this.getDataFailure.createDelegate(this)});}
else{parms.queryName="GET_STAGE_METRICS";MktSession.ajaxRequest('analytics/getAnalyzerData',{serializeParms:parms,onMySuccess:this.checkResponseData.createDelegate(this,[parms.queryName]),onMyFailure:this.getDataFailure.createDelegate(this)});parms.queryName="GET_TRANSITION_METRICS";MktSession.ajaxRequest('analytics/getAnalyzerData',{serializeParms:parms,onMySuccess:this.checkResponseData.createDelegate(this,[parms.queryName]),onMyFailure:this.getDataFailure.createDelegate(this)});parms.queryName="GET_DETAIL_METRICS_MULTI_STAGE";MktSession.ajaxRequest('analytics/getAnalyzerData',{serializeParms:parms,onMySuccess:this.checkResponseData.createDelegate(this,[parms.queryName]),onMyFailure:this.getDataFailure.createDelegate(this)});}},checkResponseData:function(queryName){if(queryName===null){this.analyzerData=MktPage.appVars.analyzerData;}
if(this.analyzerData.status=="error"){MktMessage.showError(this.analyzerData.msg);}
if(queryName=="GET_STAGE_METRICS"){this.analyzerData.GET_STAGE_METRICS=MktPage.appVars.analyzerData.GET_STAGE_METRICS;}
if(queryName=="GET_DETAIL_METRICS_MULTI_STAGE"){this.analyzerData.GET_DETAIL_METRICS_MULTI_STAGE=MktPage.appVars.analyzerData.GET_DETAIL_METRICS_MULTI_STAGE;}
if(queryName=="GET_TRANSITION_METRICS"){this.analyzerData.GET_TRANSITION_METRICS=MktPage.appVars.analyzerData.GET_TRANSITION_METRICS;}
if(this.analyzerData.GET_STAGE_METRICS===undefined||this.analyzerData.GET_DETAIL_METRICS_MULTI_STAGE===undefined||this.analyzerData.GET_TRANSITION_METRICS===undefined){return;}
else{this.setData();}},setData:function(){if(this.debug){console.log("--setData  start-- "+(new Date()-this.start));}
if(this.analyzerData.status=="error"){MktMessage.showError(this.analyzerData.msg);}
this.STAGE_METRICS=Ext.decode(this.analyzerData.GET_STAGE_METRICS);this.TRANSITION_METRICS=Ext.decode(this.analyzerData.GET_TRANSITION_METRICS);this.DETAIL_METRICS_MULTI_STAGE=Ext.decode(this.analyzerData.GET_DETAIL_METRICS_MULTI_STAGE);if(this.STAGE_METRICS.succeeded==false){console.log("Failed getting "+this.STAGE_METRICS.query.name+" metric. \r"+this.STAGE_METRICS.message);MktMessage.showError("Failed getting a metric.");}
else if(this.STAGE_METRICS.resultset.data.length==0){console.log("No data in date range.");MktMessage.showInfo("No data found in the specified Time Frame",function(){Mkt.widgets.ReportSettings.data.reportSettingsTitle=Mkt.widgets.ReportSettings.data.reportSettingsTitle.replace("Report Settings","Analyzer Settings");Mkt.widgets.ReportSettings.show(Mkt.widgets.ReportSettings.data);});}
else if(this.TRANSITION_METRICS.succeeded==false){console.log("Failed getting '"+this.TRANSITION_METRICS.query.name+"' metric. \r"+this.TRANSITION_METRICS.message)
MktMessage.showError("Failed getting a metric.");}
else if(this.DETAIL_METRICS_MULTI_STAGE.succeeded==false){console.log("Failed getting "+this.DETAIL_METRICS_MULTI_STAGE.query.name+" metric. \r"+this.DETAIL_METRICS_MULTI_STAGE.message);MktMessage.showError("Failed getting a metric.");}
else{var dateColumnIndex=this.getIndexFromMetadata(this.DETAIL_METRICS_MULTI_STAGE.resultset.metadata,'date');this.lastDayofData=this.DETAIL_METRICS_MULTI_STAGE.resultset.data[this.DETAIL_METRICS_MULTI_STAGE.resultset.data.length-1][dateColumnIndex];this.render();}
MktCanvas.unmask();},getDataFailure:function(){MktMessage.showError('Failed retrieving analyzer data');},getAdditionalData:function(stageName,stageToName,metric,periodType,range){this.getData(metric,stageName,stageToName,periodType,range);},setAdditionalData:function(){if(this.debug){console.log("--setAdditionalData  start-- "+(new Date()-this.start));}
this.analyzerData=MktPage.appVars.analyzerData;var stageName=this.operationContext.stageName;var stageToName=this.stageContext[stageName].stageToName;var metric=this.stageContext[stageName].metric;var periodType=this.stageContext[stageName].periodicity;if(metric==this.BALANCE_METRIC||metric=='inflow'||metric=='outflow'){var incomingData=Ext.decode(this.analyzerData.GET_DETAIL_METRICS_MULTI_STAGE);}else{var incomingData=Ext.decode(this.analyzerData.GET_TRANSITION_DETAIL_METRICS);}
var chartArray=this.buildChartArray(incomingData,stageName,stageToName,metric,periodType);if(this.operationContext.operation=='compare'){Mkt.apps.SPAnalyzer.addChart(chartArray,stageName);}else{Mkt.apps.SPAnalyzer.insertChart(chartArray,stageName);}
MktSession.clockCursor(false);},buildChartArray:function(dataSet,stageName,stageToName,metric,periodType){if(this.debug){console.log("--buildChartArray  start-- "+(new Date()-this.start));}
var data=dataSet.resultset.data;var metaData=dataSet.resultset.metadata;var stageNameIndex=this.getIndexFromMetadata(metaData,'revenueStage');var stageToNameIndex=this.getIndexFromMetadata(metaData,'revenueStageTo');var dateIndex=this.getIndexFromMetadata(metaData,'date');var columnIndex=this.getIndexFromMetadata(metaData,this.indexNames[metric]);var numberAdjustment=1;if(metric=='convRatio'){numberAdjustment=100;}
if(stageToName==null||stageToName==''){var chartName=this.getChartObjName(stageName,null,metric,periodType);}else{var chartName=this.getChartObjName(stageName,stageToName,metric,periodType);}
var dateOffset=0;var range=new Date(this.settings.dateTo)-new Date(this.settings.dateFrom);var rangeDays=range/86400000+1;var start=new Date(this.settings.dateFrom+" UTC");if(this.operationContext.operation=='compare'){dateOffset=new Date(this.settings.dateFrom)-new Date(this.operationContext.dateFrom);this.operationContext.dateOffset=dateOffset;start=new Date(this.operationContext.dateFrom+" UTC");chartName+="_compare";}
this.prebuildChartData[chartName]={};var prebuildObj=this.prebuildChartData[chartName];prebuildObj.chartArray=[];if(rangeDays>data.length&&(metric=='convRatio'||metric=='cycleTime')){var index=0;for(var i=0;i<rangeDays;i++){var tickStamp=start.add(Date.DAY,i);if(tickStamp.format('Ymd')>=new Date(this.lastDayofData).format('Ymd')){break;}
if(periodType=='date'||(periodType=='week'&&tickStamp.getUTCDay()==6)||(periodType=='month'&&tickStamp.getUTCDate()==tickStamp.getDaysInMonth())){if(index<data.length){var dateStamp=new Date(data[index][dateIndex]+" UTC");}else{var dateStamp="";}
if(dateStamp!=""&&dateStamp.format('Y/m/d')==tickStamp.format('Y/m/d')){prebuildObj.chartArray.push([dateStamp.add(Date.MILLI,dateOffset),data[index][columnIndex]*numberAdjustment]);index++;}
else{prebuildObj.chartArray.push([tickStamp.add(Date.MILLI,dateOffset),0]);}}}}else{for(var i=0;i<data.length;i++){var dateStamp=data[i][dateIndex];dateStamp=new Date(dateStamp+" UTC");if(dateOffset!=0){dateStamp=dateStamp.add(Date.MILLI,dateOffset);}
if(dateStamp>new Date(this.settings.dateTo+" UTC")){break;}
prebuildObj.chartArray.push([dateStamp,data[i][columnIndex]*numberAdjustment]);}}
return prebuildObj.chartArray;},findChart:function(stageName){if(this.debug){console.log("--findChart start-- "+(new Date()-this.start));}
var stageToName=this.stageContext[stageName].stageToName;var metric=this.stageContext[stageName].metric;var periodType=this.stageContext[stageName].periodicity;if(this.operationContext.operation=='add'){metric=this.operationContext.metric;}
if(metric==this.BEGIN_BALANCE_METRIC||metric==this.BALANCE_METRIC||metric==this.INFLOW_METRIC||metric==this.OUTFLOW_METRIC||metric==this.SLAMISSED_METRIC||metric==this.SLAOVERDUE_METRIC){var stageMetric=true;var chartName=this.getChartObjName(stageName,null,metric,periodType);}else{var chartName=this.getChartObjName(stageName,stageToName,metric,periodType);}
if(isDefined(this.prebuildChartData[chartName])){var prebuildObj=this.prebuildChartData[chartName];MktSession.clockCursor(false);return prebuildObj.chartArray;}else if(stageMetric){MktSession.clockCursor(false);this.prebuildChartData[chartName]={};var prebuildObj=this.prebuildChartData[chartName];prebuildObj.chartArray=this.getStageChartArray(stageName,metric,periodType);return prebuildObj.chartArray;}else{this.getAdditionalData(stageName,stageToName,metric,periodType);return null;}},compareChart:function(stageName,range){if(this.debug){console.log("--compareChart start-- "+(new Date()-this.start));}
var stageToName=this.stageContext[stageName].stageToName;var metric=this.stageContext[stageName].metric;var periodType=this.stageContext[stageName].periodicity;this.getAdditionalData(stageName,stageToName,metric,periodType,range);},getChartObjName:function(stageName,stageToName,metric,periodType){if(this.debug){console.log("--getChartObjName start-- "+(new Date()-this.start));}
stageName=stageName.replace(/ /g,"_");if(stageToName==null){var chartName=stageName+"_"+metric+"_"+periodType;}else{stageToName=stageToName.replace(/ /g,"_");var chartName=stageName+"_to_"+stageToName+"_"+metric+"_"+periodType;}
return chartName;},render:function(){this.buildAnalyzer();},changeChartPeriodType:function(stageName,periodType){MktSession.clockCursor(true);Mkt.apps.SPAnalyzer.stageContext[stageName].periodicity=periodType;chartData=Mkt.apps.SPAnalyzer.findChart(stageName);if(chartData){Mkt.apps.SPAnalyzer.insertChart(chartData,stageName);}},getIndexFromMetadata:function(metadata,name){var columnNames=metadata.dimensions;columnNames=columnNames.concat(metadata.columns);for(var i=0;i<columnNames.length;i++){if(columnNames[i]==name){return i;}}},getStageChartArray:function(stageName,metric,periodType){if(this.debug){console.log("--getStageChartArray start-- "+(new Date()-this.start));}
var data=this.DETAIL_METRICS_MULTI_STAGE.resultset.data;var metaData=this.DETAIL_METRICS_MULTI_STAGE.resultset.metadata;var stageNameIndex=this.getIndexFromMetadata(metaData,'stageName');var dateLabelIndex=this.getIndexFromMetadata(metaData,'date');var columnIndex=this.getIndexFromMetadata(metaData,this.indexNames[metric]);var d=[];var countLeads=0;for(var i=0;i<data.length;i++){if(data[i][stageNameIndex]==stageName){var dateStamp=data[i][dateLabelIndex];dateStamp=new Date(dateStamp+" UTC");if(isDefined(periodType)&&periodType!='date'){countLeads+=data[i][columnIndex];if((periodType=='week'&&dateStamp.getUTCDay()==6)||(periodType=='month'&&dateStamp.getUTCDate()==dateStamp.getDaysInMonth())){if(metric=="inflow"||metric=="outflow"){d.push([dateStamp,countLeads]);countLeads=0;}else{d.push([dateStamp,data[i][columnIndex]]);}}}else{d.push([dateStamp,data[i][columnIndex]]);}}}
if(this.debug){console.log("--getStageChartArray end-- "+(new Date()-this.start));}
return d;},buildAnalyzer:function(){if(this.debug){console.log("--build start-- "+(new Date()-this.start));}
MktCanvas.unmask();var stageRows=Ext.get('stage_rows');var canvasContainerWidth=stageRows.dom.offsetWidth-400;var stageName='';var stageType='';var stageToName='';var rowId='';var chartContainer='';var chartData=[];var slaChartData=[];var stageData=this.STAGE_METRICS.resultset.data;var stageMetaData=this.STAGE_METRICS.resultset.metadata;var stageNameIndex=this.getIndexFromMetadata(stageMetaData,'stageName');var stageTypeIndex=this.getIndexFromMetadata(stageMetaData,'stageType');var endBalanceIndex=this.getIndexFromMetadata(stageMetaData,'endingBalance');var inFlowIndex=this.getIndexFromMetadata(stageMetaData,'inflow');var outFlowIndex=this.getIndexFromMetadata(stageMetaData,'outflow');var transitionData=this.TRANSITION_METRICS.resultset.data;var transitionMetaData=this.TRANSITION_METRICS.resultset.metadata;var fromStageIndex=this.getIndexFromMetadata(transitionMetaData,'fromStage');var toStageIndex=this.getIndexFromMetadata(transitionMetaData,'toStage');var cycleTimeIndex=this.getIndexFromMetadata(transitionMetaData,'cycletime');var conversionRatioIndex=this.getIndexFromMetadata(transitionMetaData,'conversionRatio');var flowIndex=this.getIndexFromMetadata(transitionMetaData,'flow');for(var i=0;i<stageData.length;i++){stageName=stageData[i][stageNameIndex];stageType=stageData[i][stageTypeIndex];stageToName=(i+1<stageData.length)?stageData[i+1][stageNameIndex]:'';rowId="stageRow_"+i;chartContainer="chartBox_"+i;this.stageContext[stageName]={rowId:rowId,stageToName:stageToName,chartContainerId:chartContainer,metric:this.BALANCE_METRIC,periodicity:'date'};chartData=this.findChart(stageName);switch(stageType){case'SLA':var stage16Icon="mkiStopwatch";var stage128Icon="mki128Stopwatch";break;case'Gate':var stage16Icon="mkiSignpost";var stage128Icon="mki128Signpost";break;default:var stage16Icon="mkiBox";var stage128Icon="mki128Box";}
var containerSnippet="<div id='"+rowId+"' class='chart_row'>"+"<div class='chart_left'>"+"<div class='stageName "+stage16Icon+"'> Stage: "+stageName+"</div>"+"<div class='stageBlock'>"+"<img class='stageSlice "+stage128Icon+"' src='/images/spacer.gif'>"+"<table class='' cellspacing='15'><tr><td><div class='selectedMetric'/></td><td><div/></td><td><div/></td></tr></table>"+"</div>"+"<div class='transitionBlock'>"+"<div class='arrowDown'>&nbsp;</div>"+"<table class='transTable' cellspacing='15'><tr><td><div/></td><td><div style='width:14px'/></td><td><div/></td></tr></table>"+"</div>"+"</div>"+"<div class='chart_right' style='width:"+canvasContainerWidth+"px;'>"+"<div class='optionsDiv'><div class='optionsButtons x-toolbar' style='padding:0px'></div></div>"+"<div class='templateChartButtons' style='float: right;'>"+"<div class='templateChartButtons_lable'>Graph by:</div>"+"<button class='dateButton' title='daily' onclick='Mkt.apps.SPAnalyzer.changeChartPeriodType(\""+stageName+"\", \"date\");'></button>"+"<button class='weekButton' title='weekly' onclick='Mkt.apps.SPAnalyzer.changeChartPeriodType(\""+stageName+"\", \"week\");'></button>"+"<button class='monthButton' title='monthly' onclick='Mkt.apps.SPAnalyzer.changeChartPeriodType(\""+stageName+"\", \"month\");'></button>"+"</div>"+"<div id='"+chartContainer+"' class='chartBox' style='width:"+canvasContainerWidth+"px; height: 200px;'></div>"+"</div>"+"</div>";stageRows.insertHtml('beforeEnd',containerSnippet);var stageBlockTds=Ext.query("div[id='"+rowId+"'] div.stageBlock td");var transitionBlockTds=Ext.query("div[id='"+rowId+"'] div.transitionBlock td");var optionsBlock=Ext.query("div[id='"+rowId+"'] div.optionsButtons");if(stageData[i][endBalanceIndex]==0){var balanceTemp=chartData[chartData.length-1][1];}else{var balanceTemp=stageData[i][endBalanceIndex];}
stageBlockTds[0].firstChild.innerHTML="<div class='infoNumbers'>"+balanceTemp+"</div>";stageBlockTds[1].firstChild.innerHTML="<div class='infoNumbers'>"+stageData[i][inFlowIndex]+"</div>";stageBlockTds[2].firstChild.innerHTML="<div class='infoNumbers'>"+stageData[i][outFlowIndex]+"</div>";var conversionRatio="n/a";var cycleTime="n/a";var flowNumber=0;if(i+1<stageData.length){var transitionRecord=this.matchingTransitionMetric(stageName,stageData[i+1][stageNameIndex]);if(transitionRecord!=null){conversionRatio=transitionRecord[conversionRatioIndex];flowNumber=transitionRecord[flowIndex];var inFlowBalance=stageData[i][inFlowIndex];this.stageContext[stageName].metric=this.BEGIN_BALANCE_METRIC;var beginBalanceData=this.findChart(stageName);var beginBalance=beginBalanceData[0][1];var SLABalance=0;if(stageType=='SLA'){this.stageContext[stageName].metric=this.SLAOVERDUE_METRIC;var slaData=this.findChart(stageName);SLABalance=slaData[slaData.length-1][1];SLABalance=balanceTemp-SLABalance;}
this.stageContext[stageName].metric=this.BALANCE_METRIC;var test=flowNumber+"/( "+beginBalance+"+ "+inFlowBalance+"-"+SLABalance+")";conversionRatio=flowNumber/(beginBalance+inFlowBalance-SLABalance);conversionRatio=Math.round(conversionRatio*100)+"%";cycleTime=transitionRecord[cycleTimeIndex];}}
transitionBlockTds[0].firstChild.innerHTML="<div class='infoNumbers'>"+conversionRatio+"</div>";transitionBlockTds[1].firstChild.innerHTML="";transitionBlockTds[2].firstChild.innerHTML="<div class='infoNumbers'>"+cycleTime+"</div>";var balanceButton=new Ext.Button({text:'Balance',stageName:stageName,chartContainer:chartContainer,iconCls:'mkiBusinesspeople',toggleGroup:'stageButtons_'+stageName,enableToggle:true,pressed:true,renderTo:stageBlockTds[0].firstChild,handler:function(){Mkt.apps.SPAnalyzer.operationContext.operation='insert';Mkt.apps.SPAnalyzer.stageContext[this.stageName].metric=Mkt.apps.SPAnalyzer.BALANCE_METRIC;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);Mkt.apps.SPAnalyzer.insertChart(chartData,this.stageName);},listeners:{toggle:function(menu){if(this.pressed){this.el.parent().addClass('selectedMetric');}else{this.el.parent().removeClass('selectedMetric');}}}});var inFlowButton=new Ext.Button({text:'In Flow',stageName:stageName,chartContainer:chartContainer,iconCls:'mkiWindowNext',toggleGroup:'stageButtons_'+stageName,enableToggle:true,renderTo:stageBlockTds[1].firstChild,handler:function(){Mkt.apps.SPAnalyzer.stageContext[this.stageName].metric=Mkt.apps.SPAnalyzer.INFLOW_METRIC;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);Mkt.apps.SPAnalyzer.insertChart(chartData,this.stageName);},listeners:{toggle:function(menu){if(this.pressed){this.el.parent().addClass('selectedMetric');}else{this.el.parent().removeClass('selectedMetric');}}}});var outFlowButton=new Ext.Button({text:'Out Flow',stageName:stageName,chartContainer:chartContainer,iconCls:'mkiWindowPrevious',toggleGroup:'stageButtons_'+stageName,enableToggle:true,renderTo:stageBlockTds[2].firstChild,handler:function(){Mkt.apps.SPAnalyzer.stageContext[this.stageName].metric=Mkt.apps.SPAnalyzer.OUTFLOW_METRIC;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);Mkt.apps.SPAnalyzer.insertChart(chartData,this.stageName);},listeners:{toggle:function(menu){if(this.pressed){this.el.parent().addClass('selectedMetric');}else{this.el.parent().removeClass('selectedMetric');}}}});var convButton=new Ext.Button({text:'Conv %',stageName:stageName,stageToName:stageToName,chartContainer:chartContainer,iconCls:'mkiHandThumbUp',toggleGroup:'stageButtons_'+stageName,enableToggle:true,renderTo:transitionBlockTds[0].firstChild,handler:function(){if(this.stageToName!=null){MktSession.clockCursor(true);Mkt.apps.SPAnalyzer.stageContext[this.stageName].metric=Mkt.apps.SPAnalyzer.CONVRATIO_METRIC;Mkt.apps.SPAnalyzer.operationContext.operation='insert';Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);if(chartData){Mkt.apps.SPAnalyzer.insertChart(chartData,this.stageName);}}},listeners:{toggle:function(menu){if(this.pressed){this.el.parent().addClass('selectedMetric');}else{this.el.parent().removeClass('selectedMetric');}}}});var avgTimeButton=new Ext.Button({text:'Avg Time',stageName:stageName,stageToName:stageToName,chartContainer:chartContainer,iconCls:'mkiClock',toggleGroup:'stageButtons_'+stageName,enableToggle:true,renderTo:transitionBlockTds[2].firstChild,handler:function(){if(this.stageToName!=null){MktSession.clockCursor(true);Mkt.apps.SPAnalyzer.stageContext[this.stageName].metric=Mkt.apps.SPAnalyzer.CYCLETIME_METRIC;Mkt.apps.SPAnalyzer.operationContext.operation='insert';Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);if(chartData){Mkt.apps.SPAnalyzer.insertChart(chartData,this.stageName);}}},listeners:{toggle:function(menu){if(this.pressed){this.el.parent().addClass('selectedMetric');}else{this.el.parent().removeClass('selectedMetric');}}}});var chartActionItems=[];if(stageType=="SLA"){chartActionItems.push(this.slaMissButton(stageName));chartActionItems.push(this.slaOverButton(stageName));}
chartActionItems.push(this.compareChartButton(stageName));chartActionItems.push(this.printChartButton(stageName));var chartActions=new Mkt.widgets.ToolbarButton({text:'Chart Actions',iconCls:'mkiChartLine',renderTo:optionsBlock[0],menu:new Ext.menu.Menu({items:chartActionItems})});this.insertChart(chartData,stageName);}
if(this.debug){console.log("--build end-- "+(new Date()-this.start));}},calculateInFlow:function(dates){var total=0;for(var i=0;i<dates.length;i++){total+=dates[i].inflow;}
return total;},calculateOutFlow:function(dates){var total=0;for(var i=0;i<dates.length;i++){total+=dates[i].outflow;}
return total;},matchingTransitionMetric:function(fromStage,toStage){var fromStageIndex=this.getIndexFromMetadata(this.TRANSITION_METRICS.resultset.metadata,'fromStage');var toStageIndex=this.getIndexFromMetadata(this.TRANSITION_METRICS.resultset.metadata,'toStage');var transitionData=this.TRANSITION_METRICS.resultset.data;for(var i=0;i<transitionData.length;i++){if(transitionData[i][fromStageIndex]==fromStage&&transitionData[i][toStageIndex]==toStage){return transitionData[i];}}
return null;},insertChart:function(chartArray,stageName){var stageToName=this.stageContext[stageName].stageToName;var metric=this.stageContext[stageName].metric;var periodType=this.stageContext[stageName].periodicity;var containerId=this.stageContext[stageName].chartContainerId;if(this.operationContext.operation=='print'){metric=this.operationContext.metric;containerId=this.operationContext.container;}
if(typeof(containerId)=='string'){var container=jQuery("#"+containerId);}
else if(typeof(containerId)=='object'){var container=jQuery(containerId);containerId=container.id;}
switch(metric){case this.INFLOW_METRIC:var label='In-Flow';var unit=' leads';break;case this.OUTFLOW_METRIC:var label='Out-Flow';var unit=' leads';break;case this.CONVRATIO_METRIC:var label='Conversion Ratio';var unit='%';break;case this.CYCLETIME_METRIC:var label='Transition Time';var unit=' days';break;default:var label='Balance';var unit=' leads';metric=this.BALANCE_METRIC;}
var xaxis={mode:'time',ticks:chartArray.length,minTickSize:[Math.floor(chartArray.length/30)+1,"day"]};if(periodType=="week"){xaxis={mode:'time',ticks:chartArray.length,tickSize:[7,"day"]};}
Mkt.apps.SPAnalyzer[containerId+"_flot"]=jQuery.plot(container,[{data:chartArray,label:label,metric:metric,labelBoxBorderColor:"#FF0000",unit:unit,lines:{show:true,fill:true,lineWidth:3,fillColor:"rgba(227,227,246, 0.8)"},points:{show:true,radius:2}}],{xaxis:xaxis,yaxis:{minTickSize:1,tickDecimals:0,min:0},colors:["rgba(112,109,178, 1)","rgba(0, 0, 255, 1)"],grid:{clickable:true,hoverable:true,backgroundColor:{colors:["#fff","#eee"]},borderColor:"#AAAAAA"}});container.bind("plothover",function(event,pos,item){jQuery("#x").text(pos.x.toFixed(2));jQuery("#y").text(pos.y.toFixed(2));if(item){if(previousPoint!=item.datapoint){previousPoint=item.datapoint;jQuery("#tooltip").remove();var x=item.datapoint[0].toFixed(2),y=item.datapoint[1].toFixed(2);var toolTipUnit=item.series.unit;var dateTip='';var dateOffset=0;if(item.series.dateOffset){dateOffset=item.series.dateOffset;}
var dateStamp=new Date(x-dateOffset);var dateTip=' on '+(dateStamp.getUTCMonth()+1)+'/'+dateStamp.getUTCDate()+'/'+dateStamp.getUTCFullYear();jQuery('<div id="tooltip">'+parseFloat(y)+''+toolTipUnit+dateTip+'</div>').css({position:'absolute',display:'none',top:item.pageY+15,left:item.pageX+15,border:'1px solid #666666',padding:'2px','background-color':'#FAF7BE','-moz-border-radius':'3px','border-radius':'3px','font-weight':'bold',color:'#444444',opacity:0.80}).appendTo("body").fadeIn(200);}}
else{jQuery("#tooltip").remove();previousPoint=null;}});},addChart:function(chartArray,stageName){var stageToName=this.stageContext[stageName].stageToName;var metric=this.stageContext[stageName].metric;var periodType=this.stageContext[stageName].periodicity;var containerId=this.stageContext[stageName].chartContainerId;if(this.operationContext.operation=='add'){metric=this.operationContext.metric;}else if(this.operationContext.operation=='print'){metric=this.operationContext.metric;containerId=this.operationContext.container;}
if(typeof(containerId)=='string'){var container=jQuery("#"+containerId);}else if(typeof(containerId)=='object'){var container=jQuery(containerId);containerId=container.id;}
var flotObj=Mkt.apps.SPAnalyzer[containerId+"_flot"];var flotData=flotObj.getData();var flotOpt=flotObj.getOptions();if(flotData.length>1){if(flotData[1]){flotData.pop();}}
flotData[0].yaxis=null;flotData[0].xaxis=null;switch(metric){case this.INFLOW_METRIC:var label='In-Flow';var unit=' leads';break;case this.OUTFLOW_METRIC:var label='Out-Flow';var unit=' leads';break;case this.CONVRATIO_METRIC:var label='Conversion Ratio';var unit='%';break;case this.CYCLETIME_METRIC:var label='Transition Time';var unit='days';break;case this.SLAOVERDUE_METRIC:var label='SLA Past Due';var unit=' leads';break;case this.SLAMISSED_METRIC:var label='SLA Due';var unit=' leads';break;default:var label='Balance';var unit=' leads';metric=this.BALANCE_METRIC;}
var newChart={data:chartArray,label:label,metric:metric,unit:unit,dateOffset:this.operationContext.dateOffset,color:"rgba(215, 111, 0, 1)",lines:{show:true,fill:false,lineWidth:3,fillColor:"rgba(215, 111, 0, 0.3)"},points:{show:true,radius:4}};if(this.operationContext.operation=='compare'){newChart.color="rgba(98, 168, 30, 1)";newChart.lines.fillColor="rgba(223, 251, 216, 0.8)";newChart.lines.lineWidth=3;newChart.points.radius=3;}
flotData.push(newChart);var xaxis={mode:'time',ticks:chartArray.length,minTickSize:[Math.floor(chartArray.length/30)+1,"day"]};if(periodType=="week"){xaxis={mode:'time',ticks:chartArray.length,tickSize:[7,"day"]};}
jQuery.plot(container,flotData,{xaxis:xaxis,yaxis:{minTickSize:1,tickDecimals:0,min:0},colors:["rgba(144, 163, 243, 1)","rgba(243, 163, 144, 1)"],grid:{clickable:true,hoverable:true,backgroundColor:{colors:["#fff","#eee"]},borderColor:"#AAAAAA"}});},compareDateDialog:function(btn){var dateFrom=this.settings.dateFrom;var dateTo=this.settings.dateTo;var createCompareForm=new Ext.form.FormPanel({formId:'createRoleForm',baseCls:'x-plain',cls:'mktDialogFormPanel',labelWidth:70,labelAlign:'right',defaultType:'datefield',style:'padding:5px',items:[{fieldLabel:'From ',id:'fromTime',name:'fromTime',vtype:'daterange',value:dateFrom,anchor:'100%',listeners:{select:function(){var diff=new Date(dateTo)-new Date(dateFrom);var start=new Date(this.value);var end=start.add(Date.MILLI,diff);createCompareForm.form.items.items[1].setValue(end);}}},{fieldLabel:'To ',id:'toTime',name:'toTime',disabled:true,vtype:'daterange',value:dateTo,anchor:'100%'}]});var compareDialog=new Ext.Window({title:'Compare Period',cls:'mktModalForm',iconCls:'mkiDataTime',modal:true,width:300,minWidth:300,height:200,minHeight:200,items:createCompareForm,buttons:[{text:'Compare',iconCls:'mkiOk',handler:function(){MktSession.clockCursor(true);var range=[];range.push(createCompareForm.form.items.items[0].value);range.push(createCompareForm.form.items.items[1].value);chartData=Mkt.apps.SPAnalyzer.compareChart(btn.stageName,range);if(chartData){Mkt.apps.SPAnalyzer.addChart(chartData,btn.stageName);}
compareDialog.close();}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){compareDialog.close();}}]});compareDialog.show();},slaMissButton:function(stageName){return{text:'Show SLA Due',iconCls:'mkiStopwatchDown',stageName:stageName,handler:function(){Mkt.apps.SPAnalyzer.operationContext.operation='add';Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;Mkt.apps.SPAnalyzer.operationContext.metric=Mkt.apps.SPAnalyzer.SLAMISSED_METRIC;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);if(chartData){Mkt.apps.SPAnalyzer.addChart(chartData,this.stageName);}}};},slaOverButton:function(stageName){return{text:'Show SLA Past Due',iconCls:'mkiStopwatchRight',stageName:stageName,handler:function(){Mkt.apps.SPAnalyzer.operationContext.operation='add';Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;Mkt.apps.SPAnalyzer.operationContext.metric=Mkt.apps.SPAnalyzer.SLAOVERDUE_METRIC;chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);if(chartData){Mkt.apps.SPAnalyzer.addChart(chartData,this.stageName);}}};},compareChartButton:function(stageName){return{text:'Compare Period',iconCls:'mkiDataTime',stageName:stageName,handler:function(){Mkt.apps.SPAnalyzer.operationContext.operation='compare';Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;Mkt.apps.SPAnalyzer.compareDateDialog(this);}};},printChartButton:function(stageName){return{text:'Print Chart',iconCls:'mkiPrinter2',stageName:stageName,handler:function(){var chartData=Mkt.apps.SPAnalyzer.findChart(this.stageName);var containerId=Mkt.apps.SPAnalyzer.stageContext[this.stageName].chartContainerId;var flotObj=Mkt.apps.SPAnalyzer[containerId+"_flot"];var flotData=flotObj.getData();Mkt.apps.SPAnalyzer.operationContext.stageName=this.stageName;Mkt.apps.SPAnalyzer.operationContext.flotData=flotData;var printWindow=window.open("/mkt-ext-2.0/apps/printPage.php","newwin","height=500,width=960,toolbar=no,scrollbars=no,menubar=no");}};},rebuildUI:function(){var allRows=Ext.get('stage_rows');allRows.dom.innerHTML="";this.render();}};
/* ========== ../mkt-ext-2.0/apps/AnalyzersInfoPanel.js ============ */

(function()
{Ext.ns('Mkt','Mkt.charts');Mkt.charts.InfoPanel=Ext.extend(Ext.Panel,{width:300,cls:'mktAnalyzersInfoPanel',floating:true,unstyled:true,shadow:false,html:'<a href="#" class="mkiCancel mktAnalyzersInfoPanelClose"></a>',listeners:{render:function(){this.getEl().on('mousedown',function(e){if(Ext.get(e.target).hasClass('mktAnalyzersInfoPanelClose')){this.hide();}
e.stopEvent();}.createDelegate(this));this.getEl().on('click',function(e){if(e.target.tagName.toLowerCase()=='a'){this.hide();}}.createDelegate(this));},beforehide:function(){if(this.lastShowTime&&this.lastShowTime>=(new Date()).getTime()-100){return false;}},show:function(){this.lastShowTime=(new Date()).getTime();},hide:function(){this.lastShowTime=null;}},closeOnMouseDown:true,lastShowTime:null,initComponent:function()
{Mkt.charts.InfoPanel.superclass.initComponent.call(this);if(this.closeOnMouseDown){this.mon(Ext.getBody(),'mousedown',function(){this.hide();},this);}},setPosition:function(x,y)
{var ps=this.getSize(),br=Ext.getBody().getRegion();x=(x+ps.width>br.right)?br.right-ps.width:(x<0?0:x);y=(y+ps.height>br.bottom)?br.bottom-ps.height:(y<0?0:y);return Mkt.charts.InfoPanel.superclass.setPosition.call(this,x,y);}});})();
/* ========== ../mkt-ext-2.0/apps/LpSettings.js ============ */

Ext.ns('Mkt','Mkt.apps','Mkt.apps.lpSettings');Mkt.apps.lpSettings.Actions={unapproveConfirmation:'<b>{0}</b> is being used in a redirect rule<br />'+'<div class="mktFormWarning"><div><b>Note:</b> '+'The redirect rule will not work and the visitor will be redirected to the fallback page'+'</div></div>',unapproveConfirmationOneOrMore:'One or more landing page is being used in a redirect rule<br />'+'<div class="mktFormWarning"><div><b>Note:</b> '+'The redirect rule will not work and the visitor will be redirected to the fallback page'+'</div></div>',newRule:function(animEl){var newRuleForm=new Mkt.apps.lpSettings.RuleForm({isMarketoLandingPage:true});newRuleForm.show(animEl);},editRule:function(animEl){var sel=this.getSelectedItems();if(!sel||sel.length<=0){return;}
var type=sel[0].get('lpRuleType');var domainAlias=sel[0].get('hostName');var pageName=sel[0].get('lpRuleRedirectUrl');var incomingPageName=sel[0].get('incomingPageName');var pathName=sel[0].get('pathName');if(pathName){pathName=pathName.replace('/','');}
var redirectUrl=sel[0].get('lpRuleRedirectUrl');var redirectInternalVid=sel[0].get('redirectInternalVid');var incomingInternalVid=sel[0].get('incomingInternalVid');var lpRedirectionId=sel[0].get('id');var isMarketoLandingPage=false;if(redirectInternalVid){isMarketoLandingPage=true;}
if(type==='Redirect Rule'){if(!incomingPageName){incomingPageName=pathName;}
var ruleForm=new Mkt.apps.lpSettings.RuleForm({title:'Edit Redirect Rule',lpRedirectionId:lpRedirectionId,domainAlias:domainAlias,pageName:pageName,editMode:true,incomingPageName:incomingPageName,incomingInternalVid:incomingInternalVid,redirectUrl:redirectUrl,isMarketoLandingPage:isMarketoLandingPage,redirectInternalVid:redirectInternalVid});ruleForm.show(animEl);}
else{var newAliasForm=new Mkt.apps.lpSettings.AliasForm({title:'Edit Domain Alias',lpRedirectionId:lpRedirectionId,domainAlias:domainAlias,redirectUrl:redirectUrl,editMode:true,redirectInternalVid:redirectInternalVid,isMarketoLandingPage:isMarketoLandingPage,pageName:pageName});newAliasForm.show(animEl);}},deleteRule:function(animEl){var selectedItems=this.getSelectedItems();var message="";var selectedCount=selectedItems.length;if(selectedCount==1){message='Are you sure you want to delete <b>'+selectedItems[0].get('lpRuleIncomingUrl')+'</b>?';}
else if(selectedCount<=0){return;}
else{message='Are you sure you want to delete multiple rules?';}
MktMessage.confirmDelete('Delete Rule',message,function(btn,text){var items=this.getSelectedItems();MktSession.clockCursor();MktSession.ajaxRequest('lpRedirection/deleteRuleSubmit',{serializeParms:{ids:Ext.encode(this.getSelectedItemIds())},onMySuccess:this.deleteRuleSubmitDone.createDelegate(this)});}.createDelegate(this),animEl);},deleteRuleSubmitDone:function(){this.refreshGrid();},newAlias:function(animEl){var newAliasForm=new Mkt.apps.lpSettings.AliasForm({isMarketoLandingPage:true});newAliasForm.show(animEl);},refreshGrid:function(){var grid=this.getGrid();if(grid){var store=grid.getStore();if(store){store.reload();}}},getGrid:function(){var canvas=MktCanvas.getActiveTab();var grid;if(canvas){grid=canvas.getGridPanel();}
return grid;},getSelectedItems:function(){var selections=[];var canvas=MktCanvas.getActiveTab();if(canvas){var grid=canvas.getGridPanel();if(grid){selections=grid.getSelectionModel().getSelections();}}
return selections;},getSelectedItemIds:function(){var sel=this.getSelectedItems();var itemIds=[];var selCount=sel.length;for(var i=0;i<selCount;i++){itemIds.push(sel[i].get('id'));}
return itemIds;},editLandingPageSettings:function(animEl){var mp=new MktModalForm({url:'accounts/changeLPRequest',title:'Edit Domain Settings',iconCls:'mkiTextRichColoredEdit',okButtonTitle:'Save',width:650,height:300});mp.show(animEl,this.editLandingPageSettingsForm.createDelegate(this));},editLandingPageSettingsForm:function(){var valid=true;var errMsg='';var domainNameEl=Ext.get('stt3LpDomainName');var domainName=domainNameEl.dom.value;if((domainName.indexOf('/')!=-1)||(domainName.indexOf(':')!=-1)||(domainName.indexOf('.')<=0)){valid=false;errMsg+='Domain name invalid. It must be a domain name not a complete URL. ';}
var homepageEl=Ext.get('stt3LpHomepageURL');var homepage=homepageEl.dom.value;if(Ext.type(homepage)=='string'&&homepage.length>0){}else{valid=false;errMsg+='Homepage must not be empty. ';}
var fallbackPageEl=Ext.get('stt3LpFallbackPage');var fallbackPage=fallbackPageEl.dom.value;if(Ext.type(fallbackPage)=='string'&&fallbackPage.length>0){}else{if(valid){fallbackPageEl.dom.value=homepage;}}
if(valid){MktSession.ajaxRequest('/accounts/changeLPSubmit',{serializeForm:'stt3LpSubmitForm',onMySuccess:this.editLandingPageSettingsDone.createDelegate(this)});return false;}else{MktModalForm.setMessage(errMsg);}},editLandingPageSettingsDone:function(jsonObject,request){MktCanvas.reloadActiveTab();}};Mkt.apps.lpSettings.Grid=Ext.extend(MktGrids.CanvasGridPanel,{enableSearchPaging:true,enablePaging:true,pagingDisplayMsg:'{0}-{1} of {2} rules',totalDisplayMsg:'{0} rules',enableTotal:true,pagingEmptyMsg:"No rules found",searchEmptyText:'Quick Find...',searchQtip:'Search for URL',beforeLoadMaskMsg:'Loading rules...',afterLoadMaskMsg:'Loading {0} rules...',autoscroll:false,autoExpandColumn:'lpRuleIncomingUrl',pageSize:50,initComponent:function(){var cols=[{id:'id',dataIndex:'id',header:'Id',type:'string',width:35,hidden:true,sortable:true},{id:'lpRuleType',dataIndex:'lpRuleType',header:'Type',type:'string',width:100,sortable:true},{id:'lpRuleIncomingUrl',dataIndex:'lpRuleIncomingUrl',header:'Original URL',type:'string',width:350,renderer:Mkt.util.Format.urlRenderer,sortable:true},{id:'lpRuleRedirectUrl',dataIndex:'lpRuleRedirectUrl',header:'Redirect URL',type:'string',width:350,sortable:true},{id:'lpUpdatedAt',dataIndex:'lpUpdatedAt',header:'Last Updated',type:'date',width:140,renderer:Ext.util.Format.dateRenderer(Mkt.util.Format.longDateTimeShortMonthFormat),align:'right',sortable:true}];var cm=new Ext.grid.ColumnModel(cols);var fields=[{name:'id',type:'string'},{name:'lpRuleType',type:'string'},{name:'lpRuleIncomingUrl',type:'string'},{name:'lpRuleRedirectUrl',type:'string'},{name:'hostName',type:'string'},{name:'pathName',type:'string'},{name:'incomingPageName',type:'string'},{name:'isAlias',type:'boolean'},{name:'redirectInternalVid',type:'string'},{name:'incomingInternalVid',type:'string'},{name:'lpUpdatedAt',type:'date'}];var ds=new Ext.data.JsonStore({url:'lpRedirection/getAllLpRules',totalProperty:'totalCount',fields:fields,baseParams:{limit:this.pageSize},remoteSort:true,root:'data',sortInfo:{field:'lpUpdatedAt',direction:'DESC'}});this.cm=cm;this.ds=ds;Mkt.apps.lpSettings.Grid.superclass.initComponent.call(this);var sm=this.getSelectionModel().on('selectionchange',Mkt.menus.LpSettings.Toolbar.updateLandingPageToolbarState.createDelegate(this));}});Mkt.widgets.LpSettingsModal=Ext.extend(Ext.Window,{initComponent:function(){this.items=this.items||[];this.messagePanel=new Ext.Panel({tpl:'<h2><div class="mktModalInFormMessage" style="display: block;"><div class="mktModalErrorMessage">{message}</div></div></h2>',baseCls:"mkt-modal-message-body",hidden:true,height:30,anchor:"99% 20%"});this.items.unshift(this.messagePanel);Mkt.widgets.LpSettingsModal.superclass.initComponent.call(this);window.setTimeout(function(){windowel=this.getEl();}.createDelegate(this),1000);},showMessageError:function(message){this.messagePanel.update({message:message});this.messagePanel.show();this.messagePanel.addClass('visibleMessage');},showErrorMessage:function(message){this.showMessageError(message);},hideMessage:function(){this.messagePanel.hide();this.messagePanel.removeClass('visibleMessage');}});Mkt.apps.lpSettings.RuleForm=Ext.extend(Mkt.widgets.LpSettingsModal,{title:'New Redirect Rule',minWidth:550,width:550,height:230,resizable:true,cls:'mktModalForm ruleForm',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 15px 15px 0 15px;',buttonAlign:'right',labelWidth:130,fieldRequiredMsg:'This field is required',initComponent:function(){this.iconCls=this.editMode?'mkiTextRichColoredEdit':'mkiTextRichColoredForward';var items=this.items||[];items.push(this.getFormFields());this.items=items;var buttons=[];var okButtonText='Create';if(this.editMode){okButtonText='Save';}
this.buttons=this.buttons||[];this.buttons.push({text:okButtonText,iconCls:'mkiOk',handler:function(button,event){if(!this.incomingDomain.validate()||!this.incomingPageField.validate()||!this.redirectUrlField.validate()){return;}
var incomingDomain=this.incomingDomain.getValue();var incomingPage=this.incomingPageField.getValue();var redirectUrl=this.redirectUrlField.getValue();var isIncomingMarketoLandingPage=Ext.isNumber(incomingPage*1);var isRedirectMarketoLandingPage=this.landingPageSelectVisible;if(!redirectUrl){this.redirectUrlField.markInvalid(this.fieldRequiredMsg);return;}
if(!incomingPage){this.incomingPageField.markInvalid(this.fieldRequiredMsg);return;}
if(!incomingDomain){this.incomingDomain.markInvalid(this.fieldRequiredMsg);return;}
if(this.editMode){if(incomingPage==this.incomingPageName){if(this.incomingInternalVid){isIncomingMarketoLandingPage=true;incomingPage=this.incomingInternalVid;}}
if(redirectUrl==this.pageName){if(this.redirectInternalVid){isRedirectMarketoLandingPage=true;redirectUrl=this.redirectInternalVid;}}}
var params={incomingDomain:incomingDomain,isIncomingMarketoLandingPage:isIncomingMarketoLandingPage,isRedirectMarketoLandingPage:isRedirectMarketoLandingPage};if(isIncomingMarketoLandingPage){params.incomingLpId=incomingPage;}
else{params.incomingPage=incomingPage;}
if(isRedirectMarketoLandingPage){params.redirectLpId=redirectUrl;}
else{params.redirectUrl=redirectUrl;}
if(this.editMode){params.lpRedirectionId=this.lpRedirectionId;}
MktSession.ajaxRequest('lpRedirection/createRuleSubmit',{serializeParms:params,onMySuccess:this.newRuleSubmitDone.createDelegate(this,[button])});}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.lpSettings.RuleForm.superclass.initComponent.call(this);},getFormFields:function(){var formFields=[];this.incomingUrl=this.getIncomingUrl();formFields.push(this.incomingUrl);this.landingPageSelectVisible=this.isMarketoLandingPage;this.redirectUrlField=this.getRedirectPageField(this.landingPageSelectVisible);formFields.push(this.redirectUrlField);this.homePageFieldLink=this.getHomePageFieldLink(this.landingPageSelectVisible);formFields.push(this.homePageFieldLink);return formFields;},newRuleSubmitDone:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){this.close();Mkt.apps.lpSettings.Actions.refreshGrid();}
else{var errMsg=MktPage.appVars.errMsg;if(errMsg){this.showMessageError(errMsg);}}
var activeTab=MktCanvas.getActiveTab();var lpRulesCanvasId='cadLpRules';if(activeTab.getId()!=MktCanvas._makeTabId(lpRulesCanvasId)){MktCanvas.setActiveTab(lpRulesCanvasId);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}},getIncomingUrl:function(){var comp=new Ext.BoxComponent({fieldLabel:"Original URL",itemCls:'mktRequired',labelSeparator:'',plugins:[{init:function(comp){comp.on('render',function(comp){var el=comp.getEl();this.incomingDomain=this.getIncomingDomain();this.incomingPageField=this.getIncomingPageField();var panel=new Ext.Panel({renderTo:el,unstyled:true,anchor:'100%',items:[{items:[this.incomingDomain],unstyled:true,width:180,style:'float: left'},{width:14,unstyled:true,style:'float: left; line-height: 19px;',html:'/'},{items:[this.incomingPageField],unstyled:true,width:170,style:'float: left'}]});comp.ownerCt.on('resize',function(){console.log("resize");}.createDelegate(this));}.createDelegate(this));}.createDelegate(this)}],cls:'',anchor:"100%"});return comp;},getIncomingDomain:function(){return new Ext.form.ImprovedComboBox({forceSelection:true,value:this.domainAlias,tabIndex:2,fieldLabel:"Original Domain",width:170,resizable:true,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/lpRedirection/getAliases',root:'aliases',baseParams:{approved:true},fields:['type','hostname']}),valueField:'hostname',displayField:'hostname',mode:'remote',loadingText:'Searching...',itemCls:'',typeAhead:false,allowBlank:false,emptyText:'',triggerAction:'all',allowBlank:false,minChars:0});},getIncomingPageField:function(){return new Ext.form.ImprovedComboBox({forceSelection:false,value:this.incomingPageName,tabIndex:2,fieldLabel:"Original Path",width:170,resizable:true,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/lpRedirection/getLandingPages',root:'lps',baseParams:{approved:false},fields:['lpId','val']}),valueField:'lpId',displayField:'val',mode:'remote',loadingText:'Searching...',itemCls:'',hideLabel:true,typeAhead:false,allowBlank:false,emptyText:'',triggerAction:'all',allowBlank:false,minChars:0});},getRedirectPageField:function(showLandingPagePicker){var redirectPageField;var fieldLabel='Redirect URL';if(showLandingPagePicker){redirectPageField=new Ext.form.ImprovedComboBox({forceSelection:true,value:this.redirectUrl,tabIndex:2,fieldLabel:fieldLabel,width:280,anchor:'99% -30',resizable:true,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/lpRedirection/getLandingPages',root:'lps',baseParams:{approved:true},fields:['lpId','val']}),valueField:'lpId',displayField:'val',mode:'remote',loadingText:'Searching...',itemCls:'mktRequired',typeAhead:false,allowBlank:false,emptyText:'',triggerAction:'all',allowBlank:false,minChars:0});}
else{redirectPageField=new Ext.form.TextField({fieldLabel:fieldLabel,value:this.redirectUrl,itemCls:'mktRequired',name:'redirectPage',allowBlank:false,labelWidth:30,anchor:"99%",width:255});}
this.redirectUrl=undefined;return redirectPageField;},toggleRedirectPage:function(){this.remove(this.redirectUrlField);if(this.landingPageSelectVisible){this.redirectUrlField=this.getRedirectPageField(false);this.homePageFieldLink.update(this.homePageLinkUseMarketoLandingPage);}
else{this.redirectUrlField=this.getRedirectPageField(true);this.homePageFieldLink.update(this.homePageLinkUseNonMarketoLandingPage);}
this.landingPageSelectVisible=!this.landingPageSelectVisible;this.insert(2,this.redirectUrlField);this.doLayout();},homePageLinkUseMarketoLandingPage:'Use Marketo Landing Page',homePageLinkUseNonMarketoLandingPage:'Use non-Marketo Landing Page',getHomePageFieldLink:function(showUseNoneMarketo,handler){var text="";if(showUseNoneMarketo){text=this.homePageLinkUseNonMarketoLandingPage;}
else{text=this.homePageLinkUseMarketoLandingPage;}
var comp=new Ext.BoxComponent({autoEl:{tag:'a',href:'#',style:'margin-left: 148px',html:text},plugins:[new Ext.DomObserver({click:function(event,comp){this.toggleRedirectPage();event.stopEvent();}.createDelegate(this)})],anchor:"95% -30"});return comp;}});Mkt.apps.lpSettings.AliasForm=Ext.extend(Mkt.widgets.LpSettingsModal,{title:'New Domain Alias',width:550,height:310,resizable:true,cls:'aliasForm mktModalForm',layout:'form',plain:true,modal:true,bodyStyle:'padding: 15px 15px 0 15px;',buttonAlign:'right',labelWidth:130,editMode:false,emptyDomainName:'yourdomain.com',homePageLinkUseMarketoLandingPage:'Use Marketo Landing Page',homePageLinkUseNonMarketoLandingPage:'Use non-Marketo Landing Page',initComponent:function(){this.iconCls=this.editMode?'mkiTextRichColoredEdit':'mkiTextRichColoredAdd';var items=this.items||[];items.push({unstyled:true,style:'padding-top: 15px',html:'Domain aliases can be used to create microsites or additional sub-domains'});items.push(this.getFormFields());this.items=items;this.buttons=this.buttons||[];var okButtonText='Create';if(this.editMode){okButtonText='Save';}
this.buttons.push({text:okButtonText,iconCls:'mkiOk',handler:function(button,event){if(!this.incomingDomain.validate()||!this.redirectPageField.validate()){return;}
var incomingDomain=this.incomingDomain.getValue();var redirectPage=this.redirectPageField.getValue();var isMarketoLandingPage=this.landingPageSelectVisible;if(this.editMode){if(redirectPage==this.pageName){if(this.redirectInternalVid){isMarketoLandingPage=true;redirectPage=this.redirectInternalVid;}}}
var params={isMarketoLandingPage:isMarketoLandingPage,incomingDomain:incomingDomain};if(isMarketoLandingPage){params.lpId=redirectPage;}
else{params.redirectPage=redirectPage;}
if(this.editMode){params.lpRedirectionId=this.lpRedirectionId;}
MktSession.clockCursor();MktSession.ajaxRequest('lpRedirection/createAliasSubmit',{serializeParms:params,onMySuccess:this.newAliasSubmitDone.createDelegate(this,[button])});}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.lpSettings.AliasForm.superclass.initComponent.call(this);},getFormFields:function(){var formFields=[];this.incomingDomain=new Ext.form.TextField({fieldLabel:'Domain Alias',itemCls:'mktRequired',name:'incomingDomain',labelWidth:30,allowBlank:false,value:this.domainAlias,tabIndex:1,anchor:"99%",enableKeyEvents:true,width:255});this.incomingDomain.on('keypress',this.updateNote.createDelegate(this));this.incomingDomain.on('change',this.updateNote.createDelegate(this));formFields.push(this.incomingDomain);this.redirectPageField=this.getRedirectPageField(this.isMarketoLandingPage);formFields.push(this.redirectPageField);this.homePageFieldLink=this.getHomePageFieldLink(this.isMarketoLandingPage);this.landingPageSelectVisible=this.isMarketoLandingPage;formFields.push(this.homePageFieldLink);this.domainNote=this.getNote();formFields.push(this.domainNote);return formFields;},updateNote:function(textField,event){window.setTimeout(function(textField){var domainNote;if(!this.domainNoteEl){domainNote=Ext.query('#domainNote',this.domainNote.getEl().dom);if(domainNote&&Ext.isArray(domainNote)&&domainNote.length>0){this.domainNoteEl=domainNote[0];}}
if(this.domainNoteEl){var domainName=textField.getValue();if(!domainName){domainName=this.emptyDomainName;}
Ext.get(this.domainNoteEl).update(this.prependProtocol(domainName));}}.createDelegate(this,[textField]),500);},prependProtocol:function(domainName,protocol){var url;if(protocol){url=protocol+domainName;}
else{url='http://'+domainName;}
url+='/';return url;},getNote:function(){var url=this.emptyDomainName;if(this.domainAlias){url=this.domainAlias;}
url=this.prependProtocol(url);return new Ext.BoxComponent({autoEl:{tag:'div',cls:'mktFormWarning',style:'margin-left: 136px; margin-top: 13px;',html:'<b>Note:</b> The default page will be displayed if the user navigates to <span id="domainNote">'+url+'</span>'}});},getRedirectPageField:function(showLandingPagePicker){var redirectPageField;var fieldLabel='Default Page';if(showLandingPagePicker){redirectPageField=new Ext.form.ImprovedComboBox({forceSelection:true,value:this.pageName,tabIndex:2,fieldLabel:fieldLabel,width:280,anchor:'99% -30',resizable:true,store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/lpRedirection/getLandingPages',root:'lps',baseParams:{approved:true},fields:['lpId','val']}),valueField:'lpId',displayField:'val',forceSelection:true,mode:'remote',loadingText:'Searching...',itemCls:'mktRequired',typeAhead:false,allowBlank:false,emptyText:'',triggerAction:'all',allowBlank:false,minChars:0});}
else{redirectPageField=new Ext.form.TextField({fieldLabel:fieldLabel,value:this.redirectUrl,itemCls:'mktRequired',name:'redirectPage',allowBlank:false,labelWidth:30,anchor:"99%",width:255});}
this.redirectUrl=undefined;return redirectPageField;},toggleRedirectPage:function(){this.remove(this.redirectPageField);if(this.landingPageSelectVisible){this.redirectPageField=this.getRedirectPageField(false);this.homePageFieldLink.update(this.homePageLinkUseMarketoLandingPage);}
else{this.redirectPageField=this.getRedirectPageField(true);this.homePageFieldLink.update(this.homePageLinkUseNonMarketoLandingPage);}
this.landingPageSelectVisible=!this.landingPageSelectVisible;this.insert(3,this.redirectPageField);this.doLayout();},getHomePageFieldLink:function(showUseNonMarketo){var text="";if(showUseNonMarketo){text=this.homePageLinkUseNonMarketoLandingPage;}
else{text=this.homePageLinkUseMarketoLandingPage;}
var comp=new Ext.BoxComponent({autoEl:{tag:'a',href:'#',style:'margin-left: 148px',html:text},plugins:[new Ext.DomObserver({click:function(event,comp){this.toggleRedirectPage();event.stopEvent();}.createDelegate(this)})],anchor:"95% -30"});return comp;},newAliasSubmitDone:function(){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){this.close();Mkt.apps.lpSettings.Actions.refreshGrid();}else{if(MktPage.appVars.errMsg){this.showMessageError(MktPage.appVars.errMsg);}}
var activeTab=MktCanvas.getActiveTab();var lpRulesCanvasId='cadLpRules';if(activeTab.getId()!=MktCanvas._makeTabId(lpRulesCanvasId)){MktCanvas.setActiveTab(lpRulesCanvasId);}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});
/* ========== ../mkt-ext-2.0/apps/Rsm.js ============ */

Ext.ns('Mkt','Mkt.apps');Mkt.apps.Rcm={STATUS_DRAFT:1,STATUS_APPROVED_STAGES:2,STATUS_APPROVED:3,STATUS_APPROVED_WITH_DRAFT:4,STATUS_ARCHIVE:5,createModel:function(parentId,accessZoneId,cloneFromId,cloneName,animEl){if(!isDefined(parentId)){parentId='';}
if(!isDefined(accessZoneId)){accessZoneId='';}
if(isDefined(cloneFromId)){var title="Clone Revenue Cycle Model";var okBtn="Clone";var height=325;}else{var title="New Revenue Cycle Model";var okBtn="Create";var height=285;cloneFromId='';}
var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div>'+'  <form action="" method="post" name="newRcmForm" id="newRcmForm" class="newRcmForm">'+'    <h2><div class="mktModalInFormMessage"></div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2">'+'      <tr id="newRcmFmCloneRow" class=""'+(cloneFromId==''?' style="display:none;"':'')+'>'+'        <td class="mktForm2Label">From Model:</td>'+'        <td class="mktForm2Field">'+cloneName+'        </td>'+'      </tr>'+'      <tr class="mktRequired">'+'        <td class="mktForm2Label">Name:</td>'+'        <td class="mktForm2Field">'+'          <input class="mktMedium" type="text" tabindex="1" id="rcmName" name="rcmName" value="" style="width: 95%;"/>'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'      <tr>'+'        <td class="mktForm2Label">Description:</td>'+'        <td class="mktForm2Field">'+'          <textarea class="mktLong95" id="rcmDesc" name="rcmDesc" tabindex="2" title="description" rows="5"></textarea>'+'          <input type="hidden" id="parentId" name="parentId" value="'+parentId+'" />'+'          <input type="hidden" id="accessZoneId" name="accessZoneId" value="'+accessZoneId+'" />'+'          <input type="hidden" id="cloneFromId" name="cloneFromId" value="'+cloneFromId+'" />'+'          <div class="message"></div>'+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'</div>');},title:title,iconCls:'mkiPackage',okButtonTitle:okBtn,extension:{submitted:false},width:540,height:height});dialog.show(animEl,function(){if(cloneFromId===''){MktSession.clockCursor(true);}
else{Ext.MessageBox.show({title:'Please wait...',msg:'Cloning Model',progress:true,wait:true,width:200,closable:false});}
MktSession.ajaxRequest('/rcm/createRcm',{serializeForm:'newRcmForm',onMySuccess:Mkt.apps.Rcm.createModelDone});});},createModelDone:function(){if(MktPage.appVars.result==MktSession.resultSuccess){MktMainNav.loadRCM({compId:MktPage.appVars.rcmId});}},exportModel:function(rcmId,animEl){MktMessage.showExport("Exporting your model, please wait...",undefined,undefined,'ext-mb-generic-download');var url='/rcm/exportRcm?compId='+rcmId;location=url;},editDraft:function(rcmId){if(MktPage.appVars.modelIsDraft){MktSession.clockCursor(true);}
else{Ext.MessageBox.show({title:'Please wait...',msg:'Creating Draft',progress:true,wait:true,width:200,closable:false});}
MktSession.ajaxRequest('/rcm/editDraft',{serializeParms:{compId:rcmId,flag:'editDraft'},onMySuccess:Mkt.apps.Rcm.modelChangeDone});},previewModel:function(rcmId,approved){MktSession.clockCursor(true);var url=MktSession.getUrlPrefix()+"?preview=true&approved="+approved+"/#RCM"+rcmId+"B2!";var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");},discardDraft:function(rcmId){Ext.MessageBox.show({title:'Please wait...',msg:'Discarding Draft',progress:true,wait:true,width:200,closable:false});MktSession.ajaxRequest('/rcm/discardDraft',{serializeParms:{compId:rcmId},onMySuccess:Mkt.apps.Rcm.modelChangeDone});},approveStages:function(rcmId,approve){if(approve){var msg="Approving Stages";}else{var msg="Unapproving Stages";}
Ext.MessageBox.show({title:'Please wait...',msg:msg,progress:true,wait:true,width:200,closable:false});MktSession.ajaxRequest('/rcm/approveStages',{serializeParms:{compId:rcmId,approve:approve,status:Mkt.apps.Rcm.STATUS_APPROVED_STAGES},onMySuccess:Mkt.apps.Rcm.modelChangeDone});},approveDraft:function(rcmId,approve){if(approve){var msg="Approving Model";}else{var msg="Unapproving Model";}
Ext.MessageBox.show({title:'Please wait...',msg:msg,progress:true,wait:true,width:200,closable:false});MktSession.ajaxRequest('/rcm/approveRcm',{serializeParms:{compId:rcmId,approve:approve,status:Mkt.apps.Rcm.STATUS_APPROVED},onMySuccess:Mkt.apps.Rcm.modelChangeDone});},validateModel:function(rcmId,approve){Ext.MessageBox.show({title:'Please wait...',msg:'Validating Model',progress:true,wait:true,width:200,closable:false});MktSession.ajaxRequest('/rcm/validateRcm',{serializeParms:{compId:rcmId}});},editPhases:function(rcmId,approve){var stagesCount=MktRCMer.layer.containers.length;var successPathCount=0;var successPathIds=[];var phasesStarts=[1,1,1,1,1];var selectHtml="<select>";for(var i=0;i<MktRCMer.phasesCode.length;i++){selectHtml+="<option value=\""+MktRCMer.phasesCode[i]+"\">"+MktRCMer.phasesText[i]+"</options>";}
selectHtml+="</select>";var phasesListHtml=[];phasesListHtml.push('<div id="phasesWarning"><!-- notes placeholder --></div>');phasesListHtml.push('<h2>Use the slider to map the phases to your success path</h2><br/>');phasesListHtml.push('<div id="phasesSliderPlaceholder" style="float:left; padding-left: 10px; padding-right: 10px; padding-top: 2px; width:20px" ></div>');phasesListHtml.push('<div style="float:left;"><ul id="successPathPhaseStages">');var nextStage=MktRCMer.layer.containers[0];while(nextStage!=null){if(phasesStarts[4]==1&&nextStage.options.phase==MktRCMer.phasesCode[0]){phasesStarts[4]=successPathCount*(-1);}
if(phasesStarts[3]==1&&nextStage.options.phase==MktRCMer.phasesCode[1]){phasesStarts[3]=successPathCount*(-1);}
if(phasesStarts[2]==1&&nextStage.options.phase==MktRCMer.phasesCode[2]){phasesStarts[2]=successPathCount*(-1);}
if(phasesStarts[1]==1&&nextStage.options.phase==MktRCMer.phasesCode[3]){phasesStarts[1]=successPathCount*(-1);}
if(phasesStarts[0]==1&&nextStage.options.phase==MktRCMer.phasesCode[4]){phasesStarts[0]=successPathCount*(-1);}
successPathCount++;phasesListHtml.push('<li class="phasesStage" stageId="'+nextStage.options.id+'">'+nextStage.options.title+'</li>');successPathIds.push(nextStage.options.id);nextStage=MktRCMer.getNextSuccessPathStage(nextStage);}
if(phasesStarts[0]==successPathCount*(-1)||phasesStarts.indexOf(1)!=-1||!(phasesStarts[0]<phasesStarts[1]&&phasesStarts[1]<phasesStarts[2]&&phasesStarts[2]<phasesStarts[3]&&phasesStarts[3]<phasesStarts[4])){phasesStarts=[-5,-4,-3,-2,0];phasesListHtml[0]='<div id="phasesWarning" class="mktForm2Warning" style="margin-bottom:5px; width:400px"> <b>Note:</b> The phases were reset because the model changed</div>';}
phasesListHtml.push('<br/><br/><br/>');var haveDetourStages=false;phasesListHtml.push('<h2 id="detourText" style="position:relative; left: -40px;">Assign phases to detour stages</h2>');for(var i=0;i<MktRCMer.layer.containers.length;i++){if(successPathIds.indexOf(MktRCMer.layer.containers[i].options.id)==-1){haveDetourStages=true;selectHtml=!MktRCMer.isEditable?"<select disabled=\"true\">":"<select>";for(var p=0;p<MktRCMer.phasesCode.length;p++){if(MktRCMer.layer.containers[i].options.phase==MktRCMer.phasesCode[p]){selectHtml+="<option selected=\"true\" value=\""+MktRCMer.phasesCode[p]+"\">"+MktRCMer.phasesText[p]+"</options>";}else{selectHtml+="<option value=\""+MktRCMer.phasesCode[p]+"\">"+MktRCMer.phasesText[p]+"</options>";}}
selectHtml+="</select>";phasesListHtml.push('<li class="phasesStage" stageId="'+MktRCMer.layer.containers[i].options.id+'">'+MktRCMer.layer.containers[i].options.title+selectHtml+'</li>');}}
phasesListHtml.push('</ul></div>');var phasesModal=new Ext.Window({id:'phasesWindow',title:'Phases',cls:'mktModalForm',iconCls:'mkiElements',modal:true,width:500,minWidth:450,height:535,minHeight:500,autoScroll:true,html:phasesListHtml.join(''),buttons:[{text:'Save',iconCls:'mkiOk',disabled:!MktRCMer.isEditable,handler:function(){Mkt.apps.Rcm.savePhases(MktCanvas.getActiveTab().config.compId,successPathCount);}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){phasesModal.close();}}]});phasesModal.show();if(Ext.isIE7){phasesModal.body.position();Ext.EventManager.on(phasesModal.body.dom,'scroll',function(){phasesModal.body.position()},this,[]);}
if(!haveDetourStages){Ext.get('detourText').hide();}
var thumbsTracker=[];var list=Ext.get('successPathPhaseStages');var itemHeight=list.dom.firstChild.offsetHeight;if(successPathCount>5){var phasesSlider=new Ext.Slider({id:'rcmPhasesSilder',vertical:true,height:successPathCount*(itemHeight+2),minValue:successPathCount*-1,renderTo:'phasesSliderPlaceholder',maxValue:0,values:phasesStarts,indicators:[],listeners:{dragstart:function(slider,e){thumbsTracker=this.getValues();},dragend:function(slider,e){var values=this.getValues();for(var i=0;i<values.length;i++){if(values[i]!=thumbsTracker[i]){if(i==0&&(values[i]==values[i+1]||values[i]==slider.minValue)){this.setValue(i,thumbsTracker[i]);break;}
if(i==values.length-1&&values[i]==values[i-1]){this.setValue(i,thumbsTracker[i]);break;}
if(values[i]==values[i+1]){this.setValue(i,thumbsTracker[i]);break;}
if(values[i]==values[i-1]){this.setValue(i,thumbsTracker[i]);break;}}}}},onRender:function(ct,position){Ext.Slider.prototype.onRender.call(this,ct,position);this.thumbs[4].disable();this.setIndicator();},setIndicator:function(){var thumbs=this.innerEl.query('.x-slider-thumb');for(var i=0;i<this.thumbs.length;i++){if(this.indicators[i]){this.indicators[i].update("-------------------------------------- "+MktRCMer.phasesText[i]);}else{this.indicators[i]=Ext.get(thumbs[i]).insertFirst({tag:'div'});this.render(this.indicators[i]);this.indicators[i].addClass('phaseSliderIndicator');this.indicators[i].insertHtml('afterBegin',"-------------------------------------- <span>"+MktRCMer.phasesText[i]+"</span>");}
if(!MktRCMer.isEditable){this.thumbs[i].disable();}}}});}else{var placeHolder=Ext.get('phasesWarning');placeHolder.insertHtml('beforeBegin','<div class="mktForm2Warning" style="margin-bottom:5px; width:400px"> <b>Note:</b> Phases require 6 or more stages on the success path</div>');Ext.select('#phasesWarning').remove();}
MktSession.activeModalForm={};MktSession.activeModalForm.dlg=phasesModal;},savePhases:function(rcmId,successPathCount){MktSession.clockCursor(true);var slider=Ext.getCmp('rcmPhasesSilder');var list=Ext.get('successPathPhaseStages');var phasesData={phases:[]};for(var i=0;i<MktRCMer.phasesCode.length;i++){phasesData.phases.push({name:MktRCMer.phasesCode[i],stageIds:[]});}
var detourStart=successPathCount;if(slider&&successPathCount>5){var max=slider.minValue*-1;for(var i=0;i<max;i++){var phase=null;var id=list.dom.childNodes[i].getAttribute('stageId');if(id==null){continue;}
if(slider.thumbs[4].value*(-1)<=i){phase=phasesData.phases[0];}
if(slider.thumbs[3].value*(-1)<=i){phase=phasesData.phases[1];}
if(slider.thumbs[2].value*(-1)<=i){phase=phasesData.phases[2];}
if(slider.thumbs[1].value*(-1)<=i){phase=phasesData.phases[3];}
if(slider.thumbs[0].value*(-1)<=i){phase=phasesData.phases[4];}
if(phase){phase.stageIds.push(id);}
var stage=MktRCMer.findStageById(id);stage.options.phase=phase.name;}}
var LiTagItems=list.getChildrenByTagName('li');for(var i=detourStart;i<LiTagItems.length;i++){var item=LiTagItems[i];var id=item.getAttribute('stageId');if(item.tagName=='LI'){var selectBox=Ext.get(item.lastChild);for(var p=0;p<phasesData.phases.length;p++){if(phasesData.phases[p].name==selectBox.getValue()){phasesData.phases[p].stageIds.push(id);var stage=MktRCMer.findStageById(id);stage.options.phase=phasesData.phases[p].name;}}}}
MktSession.ajaxRequest('/rcm/savePhases',{serializeParms:{compId:rcmId,phases:Ext.encode(phasesData)},onMySuccess:Mkt.apps.Rcm.savePhasesDone});},savePhasesDone:function(results){var jsonResults=results.JSONResults;if(jsonResults.success){}},modelChangeDone:function(results){var jsonResults=results.JSONResults;if(jsonResults.success){var overview=MktCanvas.getTab(Mkt.menus.Rcm.Toolbar.rcmCanvasOverviewId);if(overview&&overview.config.compId==jsonResults.modelId){if(jsonResults.overviewTitle){overview.updateTabTitle(jsonResults.overviewTitle);}
if(jsonResults.overviewDesc){overview.updateTabDescription(jsonResults.overviewDesc);}
if(jsonResults.reloadCanvases){overview.clearContentValid();MktCanvas.reloadActiveTab();}
else{Mkt.menus.Rcm.Toolbar.updateToolbarState({status:jsonResults.status});if(isDefined(Mkt.apps.Rcm.rcmHome)){Mkt.apps.Rcm.rcmHome.getSummary();}}}
if(this.serializeParms.approve&&this.serializeParms.status==Mkt.apps.Rcm.STATUS_APPROVED_STAGES){MktMessage.showQuestion('Stages are available in Smart Lists<p>Use the Flow Step: <b>Change Revenue Stage</b> to assign leads or just approve the model to activate</p>','Assign Leads',function(){var context={};MktMainNav.loadLeadDb(context);this.hide();},'mkiUsers3','Close');}
if(this.serializeParms.flag=='editDraft'){var url=MktSession.getUrlPrefix()+"/#RCM"+this.serializeParms.compId+"B2!";var newWind=window.open(url,"_blank","width=1200, height=800, left=100, top=80, "+"channelmode=no, copyhistory=no, directories=yes, fullscreen=no, location=yes, "+"menubar=yes, resizable=yes, scrollbars=yes, status=yes, titlebar=yes, toolbar=yes");}}
else{MktMessage.showWarningExt(jsonResults.errorTitle,jsonResults.errorMessage);}
Ext.MessageBox.hide();},deleteModel:function(rcmId){Ext.MessageBox.show({title:'Please wait...',msg:'Deleting Model',progress:true,wait:true,width:200,closable:false});MktSession.ajaxRequest('/rcm/deleteRcm',{serializeParms:{compId:rcmId},onMySuccess:Mkt.apps.Rcm.deleteModelDone});},deleteModelDone:function(results){var jsonResults=results.JSONResults;if(jsonResults.success){if(MktMainNav.activeNav=="tnAnalytics"){MktMainNav.loadAnalytics({});}}
else{MktMessage.showWarning(jsonResults.errorMessage);}}};
/* ========== ../mkt-ext-2.0/menus/RsmMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.Rcm');Mkt.menus.Rcm.menuItemPool={editMenu:{text:'Edit Draft',itemId:'rcmEdit',iconCls:'mkiPackageEdit',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
Mkt.apps.Rcm.editDraft(compId);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},previewMenu:{text:'Preview Model',itemId:'rcmPreview',iconCls:'mkiPackageView',handler:function(el){var currNode=el.parentMenu.currNode;var approved=true;if(currNode){var compId=currNode.attributes.xtra.compId;var compText=currNode.text;var parentId=currNode.attributes.parentId;}
else{var activeTab=MktCanvas.getActiveTab();var compId=activeTab.config.compId;var compText=activeTab.config.title;}
Mkt.apps.Rcm.previewModel(compId,true);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},cloneMenu:{text:'Clone Model',itemId:'rcmClone',iconCls:'mkiPackageAdd',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;var compText=currNode.text;var parentId=currNode.attributes.parentId;}
else{var activeTab=MktCanvas.getActiveTab();var compId=activeTab.config.compId;var compText=activeTab.config.title;}
var accessZoneId=Mkt.util.Common.getNodeAttrValue(undefined,'accessZoneId',true);Mkt.apps.Rcm.createModel(undefined,accessZoneId,compId,compText,el);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},deleteMenu:{text:'Delete Model',itemId:'rcmDelete',iconCls:'mkiPackageDelete',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;var compText=currNode.text;}
else{var activeTab=MktCanvas.getActiveTab();var compId=activeTab.config.compId;var compText=activeTab.config.title;}
MktMessage.confirmDelete('Delete?','Are you sure you want to delete <b>'+compText+'</b>?',function(){Mkt.apps.Rcm.deleteModel(compId);},el.getEl());el.parentMenu.hide(true);el.parentMenu.currNode=null;}},exportMenu:{text:'Export Model',itemId:'rcmExport',iconCls:'mkiPackage',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var activeTab=MktCanvas.getActiveTab();var compId=activeTab.config.compId;}
Mkt.apps.Rcm.exportModel(compId,el);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},approveStages:{text:'Approve Stages',itemId:'rcmApproveStages',iconCls:'mkiBoxPreferences',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
Mkt.apps.Rcm.approveStages(compId,true);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},unapproveStages:{text:'Unapprove Stages',itemId:'rcmUnapproveStages',iconCls:'mkiBoxForbidden',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
MktMessage.confirm('Unapprove Stages','Are you sure you want to unapprove?<br /><br /> All leads will be removed from the stages in this model, may take several minutes.','Unapprove',function(){Mkt.apps.Rcm.approveStages(compId,false);},'mkiOk',el);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},approve:{text:'Approve Model',itemId:'rcmApprove',iconCls:'mkiPackageOk',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
MktMessage.confirm('Approve Model','Are you sure you want to approve the model?&nbsp;&nbsp;Only one model can be approved.','Approve',function(){Mkt.apps.Rcm.approveDraft(compId,true);},'mkiPackageOk',el);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},unapprove:{text:'Unapprove Model',itemId:'rcmUnapprove',iconCls:'mkiPackageForbidden',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
MktMessage.confirm('Unapprove Model','Are you sure you want to unapprove?<br /><br /> All leads will be removed from the stages in this model, may take several minutes','Unapprove',function(){Mkt.apps.Rcm.approveDraft(compId,false);},'mkiOk',el);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},editDraft:{text:'Edit Draft',itemId:'rcmEditDraft',iconCls:'mkiPackageEdit',cls:'mktMenuIndent',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
Mkt.apps.Rcm.editDraft(compId);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},previewDraft:{text:'Preview Draft',itemId:'rcmPreviewDraft',iconCls:'mkiPackageView',cls:'mktMenuIndent',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;var compText=currNode.text;var parentId=currNode.attributes.parentId;}
else{var activeTab=MktCanvas.getActiveTab();var compId=activeTab.config.compId;var compText=activeTab.config.title;}
Mkt.apps.Rcm.previewModel(compId,false);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},approveDraft:{text:'Approve Model Draft',itemId:'rcmApproveDraft',iconCls:'mkiPackageOk',cls:'mktMenuIndent',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
Mkt.apps.Rcm.approveDraft(compId,true);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},discardDraft:{text:'Discard Model Draft',itemId:'rcmDiscardDraft',iconCls:'mkiPackageDelete',cls:'mktMenuIndent',handler:function(el){var currNode=el.parentMenu.currNode;if(currNode){var compId=currNode.attributes.xtra.compId;}
else{var compId=MktCanvas.getActiveTab().config.compId;}
Mkt.apps.Rcm.discardDraft(compId);el.parentMenu.hide(true);el.parentMenu.currNode=null;}},assignmentRules:{text:'Assignment Rules',itemId:"rcmAassignmentRules",iconCls:'mkiBoxInto',handler:function(el){var leadAction=new Mkt.apps.leadAction();leadAction.editLeadAction(el,101);}}};Mkt.menus.Rcm.getMenu=function(attr){var rcmMip=Mkt.menus.Rcm.menuItemPool;var m=Ext.menu.MenuMgr.get('rcmMenu');if(!isDefined(m)){m=MktLeadDbMenu.menuFactory("rcmMenu",rcmMip.editMenu,rcmMip.previewMenu,rcmMip.approveStages,rcmMip.unapproveStages,rcmMip.approve,rcmMip.unapprove,rcmMip.cloneMenu,rcmMip.deleteMenu,rcmMip.exportMenu,new Ext.menu.Separator({itemId:'rcmDraftActionsSeparator'}),{itemId:'rcmDraftActionsText',text:'Draft Actions',iconCls:'mkiPencil',cls:'mktMenuGroupText',disabledClass:' ',disabled:true},rcmMip.editDraft,rcmMip.previewDraft,rcmMip.approveDraft,rcmMip.discardDraft,new Ext.menu.Separator({itemId:'rcmAssignmentRulesSeparator'}),rcmMip.assignmentRules);}
m.triggeredFrom=attr.triggeredFrom;return m;};Mkt.menus.Rcm.preshowActionsMenu=function(menu,attr){if(menu.triggeredFrom=='tree'){var status=attr.status;var system=attr.system;}
else if(menu.triggeredFrom=='button'){var activeTab=MktCanvas.getActiveTab();if(!activeTab)return menu;var status=activeTab.config.status;var system=this.system;}
else{return menu;}
var hasDraftNode=status==Mkt.apps.Rcm.STATUS_APPROVED_WITH_DRAFT;var hideEdit=false;var hidePreview=false;var hideDiscardDraft=false;var hideApproveStages=false;var hideUnapproveStages=false;var hideApprove=false;var hideUnapprove=false;var hideEditDraft=true;var hidePreviewDraft=true;var hideAssignmentRules=false;var hideExport=!MktPage.isDev();if(status==Mkt.apps.Rcm.STATUS_DRAFT){hideEdit=false;hideDiscardDraft=true;hideUnapproveStages=true;hideApprove=true;hideUnapprove=true;hideEditDraft=true;hidePreviewDraft=true;hideAssignmentRules=true;}
else if(status==Mkt.apps.Rcm.STATUS_APPROVED_STAGES){hideEdit=false;hideDiscardDraft=true;hideApproveStages=true;hideUnapprove=true;}
else if(status==Mkt.apps.Rcm.STATUS_APPROVED){hideApproveStages=true;hideDiscardDraft=true;hideUnapproveStages=true;hideApprove=true;hideEditDraft=true;hidePreviewDraft=true;}
else if(status==Mkt.apps.Rcm.STATUS_APPROVED_WITH_DRAFT){hideEdit=true;hideApproveStages=true;hideUnapproveStages=true;hideApprove=true;hideEditDraft=false;hidePreviewDraft=false;}
var mItems=menu.items;mItems.get('rcmEdit').setVisible(!hideEdit&&!system);mItems.get('rcmPreview').setVisible(!hidePreview||system);mItems.get('rcmApproveStages').setVisible(!hideApproveStages&&!system);mItems.get('rcmUnapproveStages').setVisible(!hideUnapproveStages&&!system);mItems.get('rcmEditDraft').setVisible(!hideEditDraft&&!system);mItems.get('rcmPreviewDraft').setVisible(!hidePreviewDraft&&!system);mItems.get('rcmApprove').setVisible(!hideApprove&&!system);mItems.get('rcmUnapprove').setVisible(!hideUnapprove&&!system);mItems.get('rcmDelete').setVisible(!system);mItems.get('rcmExport').setVisible(!hideExport);mItems.get('rcmDraftActionsSeparator').setVisible(hasDraftNode);mItems.get('rcmDraftActionsText').setVisible(hasDraftNode);mItems.get('rcmApproveDraft').setVisible(hasDraftNode);mItems.get('rcmDiscardDraft').setVisible(hasDraftNode);mItems.get('rcmAssignmentRulesSeparator').setVisible(!hideAssignmentRules);mItems.get('rcmAassignmentRules').setVisible(!hideAssignmentRules);return menu;}
MktMenuMgr.registerMenuProvider('Revenue Cycle Model',function(attr){attr.menu=Mkt.menus.Rcm.preshowActionsMenu(Mkt.menus.Rcm.getMenu(attr),attr);});Mkt.menus.Rcm.Toolbar=function(){function toolbarRequestHandler(attr,ret){var subType="home";if(attr.subType){subType=attr.subType;}
if(isFunction(Mkt.menus.Rcm.Toolbar['get'+MktUtil.camelCase(subType)])){ret.comp=Mkt.menus.Rcm.Toolbar['get'+MktUtil.camelCase(subType)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('Revenue Cycle Model',toolbarRequestHandler);return{rcmHomeCanvasId:'rcmHomeCanvas',rcmCanvasOverviewId:'rcmCanvasOverview',rcmCanvasModelId:'rcmCanvasModel',getHome:function(attr){var buttonArgs=attr;var menuItems=[Mkt.menus.Analytics.Toolbar.newMenuButton({panelId:attr.panelId})];return new Ext.Toolbar({items:menuItems});},getDetail:function(attr){var menuItems=[Mkt.menus.Analytics.Toolbar.newMenuButton({panelId:attr.panelId})];menuItems.push({itemId:'rcmMenuActions_'+attr.panelId,text:'Model Actions',iconCls:'mkiPackage',xtype:'mkttbbutton',menuPreShowCb:Mkt.menus.Rcm.preshowActionsMenu.createDelegate(attr),menu:MktMenuMgr.getMenu(attr.type,attr)});menuItems.push('-');if(!attr.system){menuItems.push(this.editDraftButton(attr));}
menuItems.push(this.previewModelButton(attr));return new Ext.Toolbar({items:menuItems});},updateToolbarState:function(attr){var tab1=MktCanvas.getTab(Mkt.menus.Rcm.Toolbar.rcmCanvasOverviewId);if(tab1){if(attr.status){tab1.config.status=attr.status;}}},editDraftButton:function(attr){return{text:'Edit Draft',itemId:"editDraft_"+attr.panelId,iconCls:'mkiPackageEdit',compId:attr.compId,handler:function(button,e){Mkt.apps.Rcm.editDraft(button.compId);}};},previewModelButton:function(attr){return{text:'Preview Model',itemId:"previewModel_"+attr.panelId,iconCls:'mkiPackageView',compId:attr.compId,handler:function(button,e){Mkt.apps.Rcm.previewModel(button.compId,true);}};}};}();
/* ========== ../wire-it/yui/utilities.js ============ */

if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={};}YAHOO.namespace=function(){var A=arguments,E=null,C,B,D;for(C=0;C<A.length;C=C+1){D=(""+A[C]).split(".");E=YAHOO;for(B=(D[0]=="YAHOO")?1:0;B<D.length;B=B+1){E[D[B]]=E[D[B]]||{};E=E[D[B]];}}return E;};YAHOO.log=function(D,A,C){var B=YAHOO.widget.Logger;if(B&&B.log){return B.log(D,A,C);}else{return false;}};YAHOO.register=function(A,E,D){var I=YAHOO.env.modules,B,H,G,F,C;if(!I[A]){I[A]={versions:[],builds:[]};}B=I[A];H=D.version;G=D.build;F=YAHOO.env.listeners;B.name=A;B.version=H;B.build=G;B.versions.push(H);B.builds.push(G);B.mainClass=E;for(C=0;C<F.length;C=C+1){F[C](B);}if(E){E.VERSION=H;E.BUILD=G;}else{YAHOO.log("mainClass is undefined for module "+A,"warn");}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(A){return YAHOO.env.modules[A]||null;};YAHOO.env.ua=function(){var C={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,caja:0},B=navigator.userAgent,A;if((/KHTML/).test(B)){C.webkit=1;}A=B.match(/AppleWebKit\/([^\s]*)/);if(A&&A[1]){C.webkit=parseFloat(A[1]);if(/ Mobile\//.test(B)){C.mobile="Apple";}else{A=B.match(/NokiaN[^\/]*/);if(A){C.mobile=A[0];}}A=B.match(/AdobeAIR\/([^\s]*)/);if(A){C.air=A[0];}}if(!C.webkit){A=B.match(/Opera[\s\/]([^\s]*)/);if(A&&A[1]){C.opera=parseFloat(A[1]);A=B.match(/Opera Mini[^;]*/);if(A){C.mobile=A[0];}}else{A=B.match(/MSIE\s([^;]*)/);if(A&&A[1]){C.ie=parseFloat(A[1]);}else{A=B.match(/Gecko\/([^\s]*)/);if(A){C.gecko=1;A=B.match(/rv:([^\s\)]*)/);if(A&&A[1]){C.gecko=parseFloat(A[1]);}}}}}A=B.match(/Caja\/([^\s]*)/);if(A&&A[1]){C.caja=parseFloat(A[1]);}return C;}();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var B=YAHOO_config.listener,A=YAHOO.env.listeners,D=true,C;if(B){for(C=0;C<A.length;C=C+1){if(A[C]==B){D=false;break;}}if(D){A.push(B);}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var B=YAHOO.lang,F="[object Array]",C="[object Function]",A=Object.prototype,E=["toString","valueOf"],D={isArray:function(G){return A.toString.apply(G)===F;},isBoolean:function(G){return typeof G==="boolean";},isFunction:function(G){return A.toString.apply(G)===C;},isNull:function(G){return G===null;},isNumber:function(G){return typeof G==="number"&&isFinite(G);},isObject:function(G){return(G&&(typeof G==="object"||B.isFunction(G)))||false;},isString:function(G){return typeof G==="string";},isUndefined:function(G){return typeof G==="undefined";},_IEEnumFix:(YAHOO.env.ua.ie)?function(I,H){var G,K,J;for(G=0;G<E.length;G=G+1){K=E[G];J=H[K];if(B.isFunction(J)&&J!=A[K]){I[K]=J;}}}:function(){},extend:function(J,K,I){if(!K||!J){throw new Error("extend failed, please check that "+"all dependencies are included.");}var H=function(){},G;H.prototype=K.prototype;J.prototype=new H();J.prototype.constructor=J;J.superclass=K.prototype;if(K.prototype.constructor==A.constructor){K.prototype.constructor=K;}if(I){for(G in I){if(B.hasOwnProperty(I,G)){J.prototype[G]=I[G];}}B._IEEnumFix(J.prototype,I);}},augmentObject:function(K,J){if(!J||!K){throw new Error("Absorb failed, verify dependencies.");}var G=arguments,I,L,H=G[2];if(H&&H!==true){for(I=2;I<G.length;I=I+1){K[G[I]]=J[G[I]];}}else{for(L in J){if(H||!(L in K)){K[L]=J[L];}}B._IEEnumFix(K,J);}},augmentProto:function(J,I){if(!I||!J){throw new Error("Augment failed, verify dependencies.");}var G=[J.prototype,I.prototype],H;for(H=2;H<arguments.length;H=H+1){G.push(arguments[H]);}B.augmentObject.apply(this,G);},dump:function(G,L){var I,K,N=[],O="{...}",H="f(){...}",M=", ",J=" => ";if(!B.isObject(G)){return G+"";}else{if(G instanceof Date||("nodeType"in G&&"tagName"in G)){return G;}else{if(B.isFunction(G)){return H;}}}L=(B.isNumber(L))?L:3;if(B.isArray(G)){N.push("[");for(I=0,K=G.length;I<K;I=I+1){if(B.isObject(G[I])){N.push((L>0)?B.dump(G[I],L-1):O);}else{N.push(G[I]);}N.push(M);}if(N.length>1){N.pop();}N.push("]");}else{N.push("{");for(I in G){if(B.hasOwnProperty(G,I)){N.push(I+J);if(B.isObject(G[I])){N.push((L>0)?B.dump(G[I],L-1):O);}else{N.push(G[I]);}N.push(M);}}if(N.length>1){N.pop();}N.push("}");}return N.join("");},substitute:function(V,H,O){var L,K,J,R,S,U,Q=[],I,M="dump",P=" ",G="{",T="}",N;for(;;){L=V.lastIndexOf(G);if(L<0){break;}K=V.indexOf(T,L);if(L+1>=K){break;}I=V.substring(L+1,K);R=I;U=null;J=R.indexOf(P);if(J>-1){U=R.substring(J+1);R=R.substring(0,J);}S=H[R];if(O){S=O(R,S,U);}if(B.isObject(S)){if(B.isArray(S)){S=B.dump(S,parseInt(U,10));}else{U=U||"";N=U.indexOf(M);if(N>-1){U=U.substring(4);}if(S.toString===A.toString||N>-1){S=B.dump(S,parseInt(U,10));}else{S=S.toString();}}}else{if(!B.isString(S)&&!B.isNumber(S)){S="~-"+Q.length+"-~";Q[Q.length]=I;}}V=V.substring(0,L)+S+V.substring(K+1);}for(L=Q.length-1;L>=0;L=L-1){V=V.replace(new RegExp("~-"+L+"-~"),"{"+Q[L]+"}","g");}return V;},trim:function(G){try{return G.replace(/^\s+|\s+$/g,"");}catch(H){return G;}},merge:function(){var J={},H=arguments,G=H.length,I;for(I=0;I<G;I=I+1){B.augmentObject(J,H[I],true);}return J;},later:function(N,H,O,J,K){N=N||0;H=H||{};var I=O,M=J,L,G;if(B.isString(O)){I=H[O];}if(!I){throw new TypeError("method undefined");}if(!B.isArray(M)){M=[J];}L=function(){I.apply(H,M);};G=(K)?setInterval(L,N):setTimeout(L,N);return{interval:K,cancel:function(){if(this.interval){clearInterval(G);}else{clearTimeout(G);}}};},isValue:function(G){return(B.isObject(G)||B.isString(G)||B.isNumber(G)||B.isBoolean(G));}};B.hasOwnProperty=(A.hasOwnProperty)?function(G,H){return G&&G.hasOwnProperty(H);}:function(G,H){return!B.isUndefined(G[H])&&G.constructor.prototype[H]!==G[H];};D.augmentObject(B,D,true);YAHOO.util.Lang=B;B.augment=B.augmentProto;YAHOO.augment=B.augmentProto;YAHOO.extend=B.extend;})();YAHOO.register("yahoo",YAHOO,{version:"2.7.0",build:"1799"});YAHOO.util.Get=function(){var M={},L=0,R=0,E=false,N=YAHOO.env.ua,S=YAHOO.lang;var J=function(W,T,X){var U=X||window,Y=U.document,Z=Y.createElement(W);for(var V in T){if(T[V]&&YAHOO.lang.hasOwnProperty(T,V)){Z.setAttribute(V,T[V]);}}return Z;};var I=function(T,U,W){var V=W||"utf-8";return J("link",{"id":"yui__dyn_"+(R++),"type":"text/css","charset":V,"rel":"stylesheet","href":T},U);};var P=function(T,U,W){var V=W||"utf-8";return J("script",{"id":"yui__dyn_"+(R++),"type":"text/javascript","charset":V,"src":T},U);};var A=function(T,U){return{tId:T.tId,win:T.win,data:T.data,nodes:T.nodes,msg:U,purge:function(){D(this.tId);}};};var B=function(T,W){var U=M[W],V=(S.isString(T))?U.win.document.getElementById(T):T;if(!V){Q(W,"target node not found: "+T);}return V;};var Q=function(W,V){var T=M[W];if(T.onFailure){var U=T.scope||T.win;T.onFailure.call(U,A(T,V));}};var C=function(W){var T=M[W];T.finished=true;if(T.aborted){var V="transaction "+W+" was aborted";Q(W,V);return;}if(T.onSuccess){var U=T.scope||T.win;T.onSuccess.call(U,A(T));}};var O=function(V){var T=M[V];if(T.onTimeout){var U=T.scope||T;T.onTimeout.call(U,A(T));}};var G=function(V,Z){var U=M[V];if(U.timer){U.timer.cancel();}if(U.aborted){var X="transaction "+V+" was aborted";Q(V,X);return;}if(Z){U.url.shift();if(U.varName){U.varName.shift();}}else{U.url=(S.isString(U.url))?[U.url]:U.url;if(U.varName){U.varName=(S.isString(U.varName))?[U.varName]:U.varName;}}var c=U.win,b=c.document,a=b.getElementsByTagName("head")[0],W;if(U.url.length===0){if(U.type==="script"&&N.webkit&&N.webkit<420&&!U.finalpass&&!U.varName){var Y=P(null,U.win,U.charset);Y.innerHTML='YAHOO.util.Get._finalize("'+V+'");';U.nodes.push(Y);a.appendChild(Y);}else{C(V);}return;}var T=U.url[0];if(!T){U.url.shift();return G(V);}if(U.timeout){U.timer=S.later(U.timeout,U,O,V);}if(U.type==="script"){W=P(T,c,U.charset);}else{W=I(T,c,U.charset);}F(U.type,W,V,T,c,U.url.length);U.nodes.push(W);if(U.insertBefore){var e=B(U.insertBefore,V);if(e){e.parentNode.insertBefore(W,e);}}else{a.appendChild(W);}if((N.webkit||N.gecko)&&U.type==="css"){G(V,T);}};var K=function(){if(E){return;}E=true;for(var T in M){var U=M[T];if(U.autopurge&&U.finished){D(U.tId);delete M[T];}}E=false;};var D=function(a){var X=M[a];if(X){var Z=X.nodes,T=Z.length,Y=X.win.document,W=Y.getElementsByTagName("head")[0];if(X.insertBefore){var V=B(X.insertBefore,a);if(V){W=V.parentNode;}}for(var U=0;U<T;U=U+1){W.removeChild(Z[U]);}X.nodes=[];}};var H=function(U,T,V){var X="q"+(L++);V=V||{};if(L%YAHOO.util.Get.PURGE_THRESH===0){K();}M[X]=S.merge(V,{tId:X,type:U,url:T,finished:false,aborted:false,nodes:[]});var W=M[X];W.win=W.win||window;W.scope=W.scope||W.win;W.autopurge=("autopurge"in W)?W.autopurge:(U==="script")?true:false;S.later(0,W,G,X);return{tId:X};};var F=function(c,X,W,U,Y,Z,b){var a=b||G;if(N.ie){X.onreadystatechange=function(){var d=this.readyState;if("loaded"===d||"complete"===d){X.onreadystatechange=null;a(W,U);}};}else{if(N.webkit){if(c==="script"){if(N.webkit>=420){X.addEventListener("load",function(){a(W,U);});}else{var T=M[W];if(T.varName){var V=YAHOO.util.Get.POLL_FREQ;T.maxattempts=YAHOO.util.Get.TIMEOUT/V;T.attempts=0;T._cache=T.varName[0].split(".");T.timer=S.later(V,T,function(j){var f=this._cache,e=f.length,d=this.win,g;for(g=0;g<e;g=g+1){d=d[f[g]];if(!d){this.attempts++;if(this.attempts++>this.maxattempts){var h="Over retry limit, giving up";T.timer.cancel();Q(W,h);}else{}return;}}T.timer.cancel();a(W,U);},null,true);}else{S.later(YAHOO.util.Get.POLL_FREQ,null,a,[W,U]);}}}}else{X.onload=function(){a(W,U);};}}};return{POLL_FREQ:10,PURGE_THRESH:20,TIMEOUT:2000,_finalize:function(T){S.later(0,null,C,T);},abort:function(U){var V=(S.isString(U))?U:U.tId;var T=M[V];if(T){T.aborted=true;}},script:function(T,U){return H("script",T,U);},css:function(T,U){return H("css",T,U);}};}();YAHOO.register("get",YAHOO.util.Get,{version:"2.7.0",build:"1799"});(function(){var Y=YAHOO,util=Y.util,lang=Y.lang,env=Y.env,PROV="_provides",SUPER="_supersedes",REQ="expanded",AFTER="_after";var YUI={dupsAllowed:{"yahoo":true,"get":true},info:{"root":"2.7.0/build/","base":"http://yui.yahooapis.com/2.7.0/build/","comboBase":"http://yui.yahooapis.com/combo?","skin":{"defaultSkin":"sam","base":"assets/skins/","path":"skin.css","after":["reset","fonts","grids","base"],"rollup":3},dupsAllowed:["yahoo","get"],"moduleInfo":{"animation":{"type":"js","path":"animation/animation-min.js","requires":["dom","event"]},"autocomplete":{"type":"js","path":"autocomplete/autocomplete-min.js","requires":["dom","event","datasource"],"optional":["connection","animation"],"skinnable":true},"base":{"type":"css","path":"base/base-min.css","after":["reset","fonts","grids"]},"button":{"type":"js","path":"button/button-min.js","requires":["element"],"optional":["menu"],"skinnable":true},"calendar":{"type":"js","path":"calendar/calendar-min.js","requires":["event","dom"],"skinnable":true},"carousel":{"type":"js","path":"carousel/carousel-min.js","requires":["element"],"optional":["animation"],"skinnable":true},"charts":{"type":"js","path":"charts/charts-min.js","requires":["element","json","datasource"]},"colorpicker":{"type":"js","path":"colorpicker/colorpicker-min.js","requires":["slider","element"],"optional":["animation"],"skinnable":true},"connection":{"type":"js","path":"connection/connection-min.js","requires":["event"]},"container":{"type":"js","path":"container/container-min.js","requires":["dom","event"],"optional":["dragdrop","animation","connection"],"supersedes":["containercore"],"skinnable":true},"containercore":{"type":"js","path":"container/container_core-min.js","requires":["dom","event"],"pkg":"container"},"cookie":{"type":"js","path":"cookie/cookie-min.js","requires":["yahoo"]},"datasource":{"type":"js","path":"datasource/datasource-min.js","requires":["event"],"optional":["connection"]},"datatable":{"type":"js","path":"datatable/datatable-min.js","requires":["element","datasource"],"optional":["calendar","dragdrop","paginator"],"skinnable":true},"dom":{"type":"js","path":"dom/dom-min.js","requires":["yahoo"]},"dragdrop":{"type":"js","path":"dragdrop/dragdrop-min.js","requires":["dom","event"]},"editor":{"type":"js","path":"editor/editor-min.js","requires":["menu","element","button"],"optional":["animation","dragdrop"],"supersedes":["simpleeditor"],"skinnable":true},"element":{"type":"js","path":"element/element-min.js","requires":["dom","event"]},"event":{"type":"js","path":"event/event-min.js","requires":["yahoo"]},"fonts":{"type":"css","path":"fonts/fonts-min.css"},"get":{"type":"js","path":"get/get-min.js","requires":["yahoo"]},"grids":{"type":"css","path":"grids/grids-min.css","requires":["fonts"],"optional":["reset"]},"history":{"type":"js","path":"history/history-min.js","requires":["event"]},"imagecropper":{"type":"js","path":"imagecropper/imagecropper-min.js","requires":["dom","event","dragdrop","element","resize"],"skinnable":true},"imageloader":{"type":"js","path":"imageloader/imageloader-min.js","requires":["event","dom"]},"json":{"type":"js","path":"json/json-min.js","requires":["yahoo"]},"layout":{"type":"js","path":"layout/layout-min.js","requires":["dom","event","element"],"optional":["animation","dragdrop","resize","selector"],"skinnable":true},"logger":{"type":"js","path":"logger/logger-min.js","requires":["event","dom"],"optional":["dragdrop"],"skinnable":true},"menu":{"type":"js","path":"menu/menu-min.js","requires":["containercore"],"skinnable":true},"paginator":{"type":"js","path":"paginator/paginator-min.js","requires":["element"],"skinnable":true},"profiler":{"type":"js","path":"profiler/profiler-min.js","requires":["yahoo"]},"profilerviewer":{"type":"js","path":"profilerviewer/profilerviewer-min.js","requires":["profiler","yuiloader","element"],"skinnable":true},"reset":{"type":"css","path":"reset/reset-min.css"},"reset-fonts-grids":{"type":"css","path":"reset-fonts-grids/reset-fonts-grids.css","supersedes":["reset","fonts","grids","reset-fonts"],"rollup":4},"reset-fonts":{"type":"css","path":"reset-fonts/reset-fonts.css","supersedes":["reset","fonts"],"rollup":2},"resize":{"type":"js","path":"resize/resize-min.js","requires":["dom","event","dragdrop","element"],"optional":["animation"],"skinnable":true},"selector":{"type":"js","path":"selector/selector-min.js","requires":["yahoo","dom"]},"simpleeditor":{"type":"js","path":"editor/simpleeditor-min.js","requires":["element"],"optional":["containercore","menu","button","animation","dragdrop"],"skinnable":true,"pkg":"editor"},"slider":{"type":"js","path":"slider/slider-min.js","requires":["dragdrop"],"optional":["animation"],"skinnable":true},"stylesheet":{"type":"js","path":"stylesheet/stylesheet-min.js","requires":["yahoo"]},"tabview":{"type":"js","path":"tabview/tabview-min.js","requires":["element"],"optional":["connection"],"skinnable":true},"treeview":{"type":"js","path":"treeview/treeview-min.js","requires":["event","dom"],"optional":["json"],"skinnable":true},"uploader":{"type":"js","path":"uploader/uploader.js","requires":["element"]},"utilities":{"type":"js","path":"utilities/utilities.js","supersedes":["yahoo","event","dragdrop","animation","dom","connection","element","yahoo-dom-event","get","yuiloader","yuiloader-dom-event"],"rollup":8},"yahoo":{"type":"js","path":"yahoo/yahoo-min.js"},"yahoo-dom-event":{"type":"js","path":"yahoo-dom-event/yahoo-dom-event.js","supersedes":["yahoo","event","dom"],"rollup":3},"yuiloader":{"type":"js","path":"yuiloader/yuiloader-min.js","supersedes":["yahoo","get"]},"yuiloader-dom-event":{"type":"js","path":"yuiloader-dom-event/yuiloader-dom-event.js","supersedes":["yahoo","dom","event","get","yuiloader","yahoo-dom-event"],"rollup":5},"yuitest":{"type":"js","path":"yuitest/yuitest-min.js","requires":["logger"],"skinnable":true}}},ObjectUtil:{appendArray:function(o,a){if(a){for(var i=0;i<a.length;i=i+1){o[a[i]]=true;}}},keys:function(o,ordered){var a=[],i;for(i in o){if(lang.hasOwnProperty(o,i)){a.push(i);}}return a;}},ArrayUtil:{appendArray:function(a1,a2){Array.prototype.push.apply(a1,a2);},indexOf:function(a,val){for(var i=0;i<a.length;i=i+1){if(a[i]===val){return i;}}return-1;},toObject:function(a){var o={};for(var i=0;i<a.length;i=i+1){o[a[i]]=true;}return o;},uniq:function(a){return YUI.ObjectUtil.keys(YUI.ArrayUtil.toObject(a));}}};YAHOO.util.YUILoader=function(o){this._internalCallback=null;this._useYahooListener=false;this.onSuccess=null;this.onFailure=Y.log;this.onProgress=null;this.onTimeout=null;this.scope=this;this.data=null;this.insertBefore=null;this.charset=null;this.varName=null;this.base=YUI.info.base;this.comboBase=YUI.info.comboBase;this.combine=false;this.root=YUI.info.root;this.timeout=0;this.ignore=null;this.force=null;this.allowRollup=true;this.filter=null;this.required={};this.moduleInfo=lang.merge(YUI.info.moduleInfo);this.rollups=null;this.loadOptional=false;this.sorted=[];this.loaded={};this.dirty=true;this.inserted={};var self=this;env.listeners.push(function(m){if(self._useYahooListener){self.loadNext(m.name);}});this.skin=lang.merge(YUI.info.skin);this._config(o);};Y.util.YUILoader.prototype={FILTERS:{RAW:{"searchExp":"-min\\.js","replaceStr":".js"},DEBUG:{"searchExp":"-min\\.js","replaceStr":"-debug.js"}},SKIN_PREFIX:"skin-",_config:function(o){if(o){for(var i in o){if(lang.hasOwnProperty(o,i)){if(i=="require"){this.require(o[i]);}else{this[i]=o[i];}}}}var f=this.filter;if(lang.isString(f)){f=f.toUpperCase();if(f==="DEBUG"){this.require("logger");}if(!Y.widget.LogWriter){Y.widget.LogWriter=function(){return Y;};}this.filter=this.FILTERS[f];}},addModule:function(o){if(!o||!o.name||!o.type||(!o.path&&!o.fullpath)){return false;}o.ext=("ext"in o)?o.ext:true;o.requires=o.requires||[];this.moduleInfo[o.name]=o;this.dirty=true;return true;},require:function(what){var a=(typeof what==="string")?arguments:what;this.dirty=true;YUI.ObjectUtil.appendArray(this.required,a);},_addSkin:function(skin,mod){var name=this.formatSkin(skin),info=this.moduleInfo,sinf=this.skin,ext=info[mod]&&info[mod].ext;if(!info[name]){this.addModule({"name":name,"type":"css","path":sinf.base+skin+"/"+sinf.path,"after":sinf.after,"rollup":sinf.rollup,"ext":ext});}if(mod){name=this.formatSkin(skin,mod);if(!info[name]){var mdef=info[mod],pkg=mdef.pkg||mod;this.addModule({"name":name,"type":"css","after":sinf.after,"path":pkg+"/"+sinf.base+skin+"/"+mod+".css","ext":ext});}}return name;},getRequires:function(mod){if(!mod){return[];}if(!this.dirty&&mod.expanded){return mod.expanded;}mod.requires=mod.requires||[];var i,d=[],r=mod.requires,o=mod.optional,info=this.moduleInfo,m;for(i=0;i<r.length;i=i+1){d.push(r[i]);m=info[r[i]];YUI.ArrayUtil.appendArray(d,this.getRequires(m));}if(o&&this.loadOptional){for(i=0;i<o.length;i=i+1){d.push(o[i]);YUI.ArrayUtil.appendArray(d,this.getRequires(info[o[i]]));}}mod.expanded=YUI.ArrayUtil.uniq(d);return mod.expanded;},getProvides:function(name,notMe){var addMe=!(notMe),ckey=(addMe)?PROV:SUPER,m=this.moduleInfo[name],o={};if(!m){return o;}if(m[ckey]){return m[ckey];}var s=m.supersedes,done={},me=this;var add=function(mm){if(!done[mm]){done[mm]=true;lang.augmentObject(o,me.getProvides(mm));}};if(s){for(var i=0;i<s.length;i=i+1){add(s[i]);}}m[SUPER]=o;m[PROV]=lang.merge(o);m[PROV][name]=true;return m[ckey];},calculate:function(o){if(o||this.dirty){this._config(o);this._setup();this._explode();if(this.allowRollup){this._rollup();}this._reduce();this._sort();this.dirty=false;}},_setup:function(){var info=this.moduleInfo,name,i,j;for(name in info){if(lang.hasOwnProperty(info,name)){var m=info[name];if(m&&m.skinnable){var o=this.skin.overrides,smod;if(o&&o[name]){for(i=0;i<o[name].length;i=i+1){smod=this._addSkin(o[name][i],name);}}else{smod=this._addSkin(this.skin.defaultSkin,name);}m.requires.push(smod);}}}var l=lang.merge(this.inserted);if(!this._sandbox){l=lang.merge(l,env.modules);}if(this.ignore){YUI.ObjectUtil.appendArray(l,this.ignore);}if(this.force){for(i=0;i<this.force.length;i=i+1){if(this.force[i]in l){delete l[this.force[i]];}}}for(j in l){if(lang.hasOwnProperty(l,j)){lang.augmentObject(l,this.getProvides(j));}}this.loaded=l;},_explode:function(){var r=this.required,i,mod;for(i in r){if(lang.hasOwnProperty(r,i)){mod=this.moduleInfo[i];if(mod){var req=this.getRequires(mod);if(req){YUI.ObjectUtil.appendArray(r,req);}}}}},_skin:function(){},formatSkin:function(skin,mod){var s=this.SKIN_PREFIX+skin;if(mod){s=s+"-"+mod;}return s;},parseSkin:function(mod){if(mod.indexOf(this.SKIN_PREFIX)===0){var a=mod.split("-");return{skin:a[1],module:a[2]};}return null;},_rollup:function(){var i,j,m,s,rollups={},r=this.required,roll,info=this.moduleInfo;if(this.dirty||!this.rollups){for(i in info){if(lang.hasOwnProperty(info,i)){m=info[i];if(m&&m.rollup){rollups[i]=m;}}}this.rollups=rollups;}for(;;){var rolled=false;for(i in rollups){if(!r[i]&&!this.loaded[i]){m=info[i];s=m.supersedes;roll=false;if(!m.rollup){continue;}var skin=(m.ext)?false:this.parseSkin(i),c=0;if(skin){for(j in r){if(lang.hasOwnProperty(r,j)){if(i!==j&&this.parseSkin(j)){c++;roll=(c>=m.rollup);if(roll){break;}}}}}else{for(j=0;j<s.length;j=j+1){if(this.loaded[s[j]]&&(!YUI.dupsAllowed[s[j]])){roll=false;break;}else{if(r[s[j]]){c++;roll=(c>=m.rollup);if(roll){break;}}}}}if(roll){r[i]=true;rolled=true;this.getRequires(m);}}}if(!rolled){break;}}},_reduce:function(){var i,j,s,m,r=this.required;for(i in r){if(i in this.loaded){delete r[i];}else{var skinDef=this.parseSkin(i);if(skinDef){if(!skinDef.module){var skin_pre=this.SKIN_PREFIX+skinDef.skin;for(j in r){if(lang.hasOwnProperty(r,j)){m=this.moduleInfo[j];var ext=m&&m.ext;if(!ext&&j!==i&&j.indexOf(skin_pre)>-1){delete r[j];}}}}}else{m=this.moduleInfo[i];s=m&&m.supersedes;if(s){for(j=0;j<s.length;j=j+1){if(s[j]in r){delete r[s[j]];}}}}}}},_onFailure:function(msg){YAHOO.log("Failure","info","loader");var f=this.onFailure;if(f){f.call(this.scope,{msg:"failure: "+msg,data:this.data,success:false});}},_onTimeout:function(){YAHOO.log("Timeout","info","loader");var f=this.onTimeout;if(f){f.call(this.scope,{msg:"timeout",data:this.data,success:false});}},_sort:function(){var s=[],info=this.moduleInfo,loaded=this.loaded,checkOptional=!this.loadOptional,me=this;var requires=function(aa,bb){var mm=info[aa];if(loaded[bb]||!mm){return false;}var ii,rr=mm.expanded,after=mm.after,other=info[bb],optional=mm.optional;if(rr&&YUI.ArrayUtil.indexOf(rr,bb)>-1){return true;}if(after&&YUI.ArrayUtil.indexOf(after,bb)>-1){return true;}if(checkOptional&&optional&&YUI.ArrayUtil.indexOf(optional,bb)>-1){return true;}var ss=info[bb]&&info[bb].supersedes;if(ss){for(ii=0;ii<ss.length;ii=ii+1){if(requires(aa,ss[ii])){return true;}}}if(mm.ext&&mm.type=="css"&&!other.ext&&other.type=="css"){return true;}return false;};for(var i in this.required){if(lang.hasOwnProperty(this.required,i)){s.push(i);}}var p=0;for(;;){var l=s.length,a,b,j,k,moved=false;for(j=p;j<l;j=j+1){a=s[j];for(k=j+1;k<l;k=k+1){if(requires(a,s[k])){b=s.splice(k,1);s.splice(j,0,b[0]);moved=true;break;}}if(moved){break;}else{p=p+1;}}if(!moved){break;}}this.sorted=s;},toString:function(){var o={type:"YUILoader",base:this.base,filter:this.filter,required:this.required,loaded:this.loaded,inserted:this.inserted};lang.dump(o,1);},_combine:function(){this._combining=[];var self=this,s=this.sorted,len=s.length,js=this.comboBase,css=this.comboBase,target,startLen=js.length,i,m,type=this.loadType;YAHOO.log("type "+type);for(i=0;i<len;i=i+1){m=this.moduleInfo[s[i]];if(m&&!m.ext&&(!type||type===m.type)){target=this.root+m.path;target+="&";if(m.type=="js"){js+=target;}else{css+=target;}this._combining.push(s[i]);}}if(this._combining.length){YAHOO.log("Attempting to combine: "+this._combining,"info","loader");var callback=function(o){var c=this._combining,len=c.length,i,m;for(i=0;i<len;i=i+1){this.inserted[c[i]]=true;}this.loadNext(o.data);},loadScript=function(){if(js.length>startLen){YAHOO.util.Get.script(self._filter(js),{data:self._loading,onSuccess:callback,onFailure:self._onFailure,onTimeout:self._onTimeout,insertBefore:self.insertBefore,charset:self.charset,timeout:self.timeout,scope:self});}};if(css.length>startLen){YAHOO.util.Get.css(this._filter(css),{data:this._loading,onSuccess:loadScript,onFailure:this._onFailure,onTimeout:this._onTimeout,insertBefore:this.insertBefore,charset:this.charset,timeout:this.timeout,scope:self});}else{loadScript();}return;}else{this.loadNext(this._loading);}},insert:function(o,type){this.calculate(o);this._loading=true;this.loadType=type;if(this.combine){return this._combine();}if(!type){var self=this;this._internalCallback=function(){self._internalCallback=null;self.insert(null,"js");};this.insert(null,"css");return;}this.loadNext();},sandbox:function(o,type){this._config(o);if(!this.onSuccess){throw new Error("You must supply an onSuccess handler for your sandbox");}this._sandbox=true;var self=this;if(!type||type!=="js"){this._internalCallback=function(){self._internalCallback=null;self.sandbox(null,"js");};this.insert(null,"css");return;}if(!util.Connect){var ld=new YAHOO.util.YUILoader();ld.insert({base:this.base,filter:this.filter,require:"connection",insertBefore:this.insertBefore,charset:this.charset,onSuccess:function(){this.sandbox(null,"js");},scope:this},"js");return;}this._scriptText=[];this._loadCount=0;this._stopCount=this.sorted.length;this._xhr=[];this.calculate();var s=this.sorted,l=s.length,i,m,url;for(i=0;i<l;i=i+1){m=this.moduleInfo[s[i]];if(!m){this._onFailure("undefined module "+m);for(var j=0;j<this._xhr.length;j=j+1){this._xhr[j].abort();}return;}if(m.type!=="js"){this._loadCount++;continue;}url=m.fullpath;url=(url)?this._filter(url):this._url(m.path);var xhrData={success:function(o){var idx=o.argument[0],name=o.argument[2];this._scriptText[idx]=o.responseText;if(this.onProgress){this.onProgress.call(this.scope,{name:name,scriptText:o.responseText,xhrResponse:o,data:this.data});}this._loadCount++;if(this._loadCount>=this._stopCount){var v=this.varName||"YAHOO";var t="(function() {\n";var b="\nreturn "+v+";\n})();";var ref=eval(t+this._scriptText.join("\n")+b);this._pushEvents(ref);if(ref){this.onSuccess.call(this.scope,{reference:ref,data:this.data});}else{this._onFailure.call(this.varName+" reference failure");}}},failure:function(o){this.onFailure.call(this.scope,{msg:"XHR failure",xhrResponse:o,data:this.data});},scope:this,argument:[i,url,s[i]]};this._xhr.push(util.Connect.asyncRequest("GET",url,xhrData));}},loadNext:function(mname){if(!this._loading){return;}if(mname){if(mname!==this._loading){return;}this.inserted[mname]=true;if(this.onProgress){this.onProgress.call(this.scope,{name:mname,data:this.data});}}var s=this.sorted,len=s.length,i,m;for(i=0;i<len;i=i+1){if(s[i]in this.inserted){continue;}if(s[i]===this._loading){return;}m=this.moduleInfo[s[i]];if(!m){this.onFailure.call(this.scope,{msg:"undefined module "+m,data:this.data});return;}if(!this.loadType||this.loadType===m.type){this._loading=s[i];var fn=(m.type==="css")?util.Get.css:util.Get.script,url=m.fullpath,self=this,c=function(o){self.loadNext(o.data);};url=(url)?this._filter(url):this._url(m.path);if(env.ua.webkit&&env.ua.webkit<420&&m.type==="js"&&!m.varName){c=null;this._useYahooListener=true;}fn(url,{data:s[i],onSuccess:c,onFailure:this._onFailure,onTimeout:this._onTimeout,insertBefore:this.insertBefore,charset:this.charset,timeout:this.timeout,varName:m.varName,scope:self});return;}}this._loading=null;if(this._internalCallback){var f=this._internalCallback;this._internalCallback=null;f.call(this);}else{if(this.onSuccess){this._pushEvents();this.onSuccess.call(this.scope,{data:this.data});}}},_pushEvents:function(ref){var r=ref||YAHOO;if(r.util&&r.util.Event){r.util.Event._load();}},_filter:function(str){var f=this.filter;return(f)?str.replace(new RegExp(f.searchExp,"g"),f.replaceStr):str;},_url:function(path){return this._filter((this.base||"")+path);}};})();YAHOO.register("yuiloader",YAHOO.util.YUILoader,{version:"2.7.0",build:"1799"});(function(){YAHOO.env._id_counter=YAHOO.env._id_counter||0;var E=YAHOO.util,L=YAHOO.lang,m=YAHOO.env.ua,A=YAHOO.lang.trim,d={},h={},N=/^t(?:able|d|h)$/i,X=/color$/i,K=window.document,W=K.documentElement,e="ownerDocument",n="defaultView",v="documentElement",t="compatMode",b="offsetLeft",P="offsetTop",u="offsetParent",Z="parentNode",l="nodeType",C="tagName",O="scrollLeft",i="scrollTop",Q="getBoundingClientRect",w="getComputedStyle",a="currentStyle",M="CSS1Compat",c="BackCompat",g="class",F="className",J="",B=" ",s="(?:^|\\s)",k="(?= |$)",U="g",p="position",f="fixed",V="relative",j="left",o="top",r="medium",q="borderLeftWidth",R="borderTopWidth",D=m.opera,I=m.webkit,H=m.gecko,T=m.ie;E.Dom={CUSTOM_ATTRIBUTES:(!W.hasAttribute)?{"for":"htmlFor","class":F}:{"htmlFor":"for","className":g},get:function(y){var AA,Y,z,x,G;if(y){if(y[l]||y.item){return y;}if(typeof y==="string"){AA=y;y=K.getElementById(y);if(y&&y.id===AA){return y;}else{if(y&&K.all){y=null;Y=K.all[AA];for(x=0,G=Y.length;x<G;++x){if(Y[x].id===AA){return Y[x];}}}}return y;}if(y.DOM_EVENTS){y=y.get("element");}if("length"in y){z=[];for(x=0,G=y.length;x<G;++x){z[z.length]=E.Dom.get(y[x]);}return z;}return y;}return null;},getComputedStyle:function(G,Y){if(window[w]){return G[e][n][w](G,null)[Y];}else{if(G[a]){return E.Dom.IE_ComputedStyle.get(G,Y);}}},getStyle:function(G,Y){return E.Dom.batch(G,E.Dom._getStyle,Y);},_getStyle:function(){if(window[w]){return function(G,y){y=(y==="float")?y="cssFloat":E.Dom._toCamel(y);var x=G.style[y],Y;if(!x){Y=G[e][n][w](G,null);if(Y){x=Y[y];}}return x;};}else{if(W[a]){return function(G,y){var x;switch(y){case"opacity":x=100;try{x=G.filters["DXImageTransform.Microsoft.Alpha"].opacity;}catch(z){try{x=G.filters("alpha").opacity;}catch(Y){}}return x/100;case"float":y="styleFloat";default:y=E.Dom._toCamel(y);x=G[a]?G[a][y]:null;return(G.style[y]||x);}};}}}(),setStyle:function(G,Y,x){E.Dom.batch(G,E.Dom._setStyle,{prop:Y,val:x});},_setStyle:function(){if(T){return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){switch(x){case"opacity":if(L.isString(Y.style.filter)){Y.style.filter="alpha(opacity="+y*100+")";if(!Y[a]||!Y[a].hasLayout){Y.style.zoom=1;}}break;case"float":x="styleFloat";default:Y.style[x]=y;}}else{}};}else{return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){if(x=="float"){x="cssFloat";}Y.style[x]=y;}else{}};}}(),getXY:function(G){return E.Dom.batch(G,E.Dom._getXY);},_canPosition:function(G){return(E.Dom._getStyle(G,"display")!=="none"&&E.Dom._inDoc(G));},_getXY:function(){if(K[v][Q]){return function(y){var z,Y,AA,AF,AE,AD,AC,G,x,AB=Math.floor,AG=false;if(E.Dom._canPosition(y)){AA=y[Q]();AF=y[e];z=E.Dom.getDocumentScrollLeft(AF);Y=E.Dom.getDocumentScrollTop(AF);AG=[AB(AA[j]),AB(AA[o])];if(T&&m.ie<8){AE=2;AD=2;AC=AF[t];G=S(AF[v],q);x=S(AF[v],R);if(m.ie===6){if(AC!==c){AE=0;AD=0;}}if((AC==c)){if(G!==r){AE=parseInt(G,10);}if(x!==r){AD=parseInt(x,10);}}AG[0]-=AE;AG[1]-=AD;}if((Y||z)){AG[0]+=z;AG[1]+=Y;}AG[0]=AB(AG[0]);AG[1]=AB(AG[1]);}else{}return AG;};}else{return function(y){var x,Y,AA,AB,AC,z=false,G=y;if(E.Dom._canPosition(y)){z=[y[b],y[P]];x=E.Dom.getDocumentScrollLeft(y[e]);Y=E.Dom.getDocumentScrollTop(y[e]);AC=((H||m.webkit>519)?true:false);while((G=G[u])){z[0]+=G[b];z[1]+=G[P];if(AC){z=E.Dom._calcBorders(G,z);}}if(E.Dom._getStyle(y,p)!==f){G=y;while((G=G[Z])&&G[C]){AA=G[i];AB=G[O];if(H&&(E.Dom._getStyle(G,"overflow")!=="visible")){z=E.Dom._calcBorders(G,z);}if(AA||AB){z[0]-=AB;z[1]-=AA;}}z[0]+=x;z[1]+=Y;}else{if(D){z[0]-=x;z[1]-=Y;}else{if(I||H){z[0]+=x;z[1]+=Y;}}}z[0]=Math.floor(z[0]);z[1]=Math.floor(z[1]);}else{}return z;};}}(),getX:function(G){var Y=function(x){return E.Dom.getXY(x)[0];};return E.Dom.batch(G,Y,E.Dom,true);},getY:function(G){var Y=function(x){return E.Dom.getXY(x)[1];};return E.Dom.batch(G,Y,E.Dom,true);},setXY:function(G,x,Y){E.Dom.batch(G,E.Dom._setXY,{pos:x,noRetry:Y});},_setXY:function(G,z){var AA=E.Dom._getStyle(G,p),y=E.Dom.setStyle,AD=z.pos,Y=z.noRetry,AB=[parseInt(E.Dom.getComputedStyle(G,j),10),parseInt(E.Dom.getComputedStyle(G,o),10)],AC,x;if(AA=="static"){AA=V;y(G,p,AA);}AC=E.Dom._getXY(G);if(!AD||AC===false){return false;}if(isNaN(AB[0])){AB[0]=(AA==V)?0:G[b];}if(isNaN(AB[1])){AB[1]=(AA==V)?0:G[P];}if(AD[0]!==null){y(G,j,AD[0]-AC[0]+AB[0]+"px");}if(AD[1]!==null){y(G,o,AD[1]-AC[1]+AB[1]+"px");}if(!Y){x=E.Dom._getXY(G);if((AD[0]!==null&&x[0]!=AD[0])||(AD[1]!==null&&x[1]!=AD[1])){E.Dom._setXY(G,{pos:AD,noRetry:true});}}},setX:function(Y,G){E.Dom.setXY(Y,[G,null]);},setY:function(G,Y){E.Dom.setXY(G,[null,Y]);},getRegion:function(G){var Y=function(x){var y=false;if(E.Dom._canPosition(x)){y=E.Region.getRegion(x);}else{}return y;};return E.Dom.batch(G,Y,E.Dom,true);},getClientWidth:function(){return E.Dom.getViewportWidth();},getClientHeight:function(){return E.Dom.getViewportHeight();},getElementsByClassName:function(AB,AF,AC,AE,x,AD){AB=L.trim(AB);AF=AF||"*";AC=(AC)?E.Dom.get(AC):null||K;if(!AC){return[];}var Y=[],G=AC.getElementsByTagName(AF),z=E.Dom.hasClass;for(var y=0,AA=G.length;y<AA;++y){if(z(G[y],AB)){Y[Y.length]=G[y];}}if(AE){E.Dom.batch(Y,AE,x,AD);}return Y;},hasClass:function(Y,G){return E.Dom.batch(Y,E.Dom._hasClass,G);},_hasClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom.getAttribute(x,F)||J;if(Y.exec){G=Y.test(y);}else{G=Y&&(B+y+B).indexOf(B+Y+B)>-1;}}else{}return G;},addClass:function(Y,G){return E.Dom.batch(Y,E.Dom._addClass,G);},_addClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom.getAttribute(x,F)||J;if(!E.Dom._hasClass(x,Y)){E.Dom.setAttribute(x,F,A(y+B+Y));G=true;}}else{}return G;},removeClass:function(Y,G){return E.Dom.batch(Y,E.Dom._removeClass,G);},_removeClass:function(y,x){var Y=false,AA,z,G;if(y&&x){AA=E.Dom.getAttribute(y,F)||J;E.Dom.setAttribute(y,F,AA.replace(E.Dom._getClassRegex(x),J));z=E.Dom.getAttribute(y,F);if(AA!==z){E.Dom.setAttribute(y,F,A(z));Y=true;if(E.Dom.getAttribute(y,F)===""){G=(y.hasAttribute&&y.hasAttribute(g))?g:F;y.removeAttribute(G);}}}else{}return Y;},replaceClass:function(x,Y,G){return E.Dom.batch(x,E.Dom._replaceClass,{from:Y,to:G});},_replaceClass:function(y,x){var Y,AB,AA,G=false,z;if(y&&x){AB=x.from;AA=x.to;if(!AA){G=false;}else{if(!AB){G=E.Dom._addClass(y,x.to);}else{if(AB!==AA){z=E.Dom.getAttribute(y,F)||J;Y=(B+z.replace(E.Dom._getClassRegex(AB),B+AA)).split(E.Dom._getClassRegex(AA));Y.splice(1,0,B+AA);E.Dom.setAttribute(y,F,A(Y.join(J)));G=true;}}}}else{}return G;},generateId:function(G,x){x=x||"yui-gen";var Y=function(y){if(y&&y.id){return y.id;}var z=x+YAHOO.env._id_counter++;if(y){if(y[e].getElementById(z)){return E.Dom.generateId(y,z+x);}y.id=z;}return z;};return E.Dom.batch(G,Y,E.Dom,true)||Y.apply(E.Dom,arguments);},isAncestor:function(Y,x){Y=E.Dom.get(Y);x=E.Dom.get(x);var G=false;if((Y&&x)&&(Y[l]&&x[l])){if(Y.contains&&Y!==x){G=Y.contains(x);}else{if(Y.compareDocumentPosition){G=!!(Y.compareDocumentPosition(x)&16);}}}else{}return G;},inDocument:function(G,Y){return E.Dom._inDoc(E.Dom.get(G),Y);},_inDoc:function(Y,x){var G=false;if(Y&&Y[C]){x=x||Y[e];G=E.Dom.isAncestor(x[v],Y);}else{}return G;},getElementsBy:function(Y,AF,AB,AD,y,AC,AE){AF=AF||"*";AB=(AB)?E.Dom.get(AB):null||K;if(!AB){return[];}var x=[],G=AB.getElementsByTagName(AF);for(var z=0,AA=G.length;z<AA;++z){if(Y(G[z])){if(AE){x=G[z];break;}else{x[x.length]=G[z];}}}if(AD){E.Dom.batch(x,AD,y,AC);}return x;},getElementBy:function(x,G,Y){return E.Dom.getElementsBy(x,G,Y,null,null,null,true);},batch:function(x,AB,AA,z){var y=[],Y=(z)?AA:window;x=(x&&(x[C]||x.item))?x:E.Dom.get(x);if(x&&AB){if(x[C]||x.length===undefined){return AB.call(Y,x,AA);}for(var G=0;G<x.length;++G){y[y.length]=AB.call(Y,x[G],AA);}}else{return false;}return y;},getDocumentHeight:function(){var Y=(K[t]!=M||I)?K.body.scrollHeight:W.scrollHeight,G=Math.max(Y,E.Dom.getViewportHeight());return G;},getDocumentWidth:function(){var Y=(K[t]!=M||I)?K.body.scrollWidth:W.scrollWidth,G=Math.max(Y,E.Dom.getViewportWidth());return G;},getViewportHeight:function(){var G=self.innerHeight,Y=K[t];if((Y||T)&&!D){G=(Y==M)?W.clientHeight:K.body.clientHeight;}return G;},getViewportWidth:function(){var G=self.innerWidth,Y=K[t];if(Y||T){G=(Y==M)?W.clientWidth:K.body.clientWidth;}return G;},getAncestorBy:function(G,Y){while((G=G[Z])){if(E.Dom._testElement(G,Y)){return G;}}return null;},getAncestorByClassName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null;}var x=function(y){return E.Dom.hasClass(y,G);};return E.Dom.getAncestorBy(Y,x);},getAncestorByTagName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null;}var x=function(y){return y[C]&&y[C].toUpperCase()==G.toUpperCase();};return E.Dom.getAncestorBy(Y,x);},getPreviousSiblingBy:function(G,Y){while(G){G=G.previousSibling;if(E.Dom._testElement(G,Y)){return G;}}return null;},getPreviousSibling:function(G){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getPreviousSiblingBy(G);},getNextSiblingBy:function(G,Y){while(G){G=G.nextSibling;if(E.Dom._testElement(G,Y)){return G;}}return null;},getNextSibling:function(G){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getNextSiblingBy(G);},getFirstChildBy:function(G,x){var Y=(E.Dom._testElement(G.firstChild,x))?G.firstChild:null;return Y||E.Dom.getNextSiblingBy(G.firstChild,x);},getFirstChild:function(G,Y){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getFirstChildBy(G);},getLastChildBy:function(G,x){if(!G){return null;}var Y=(E.Dom._testElement(G.lastChild,x))?G.lastChild:null;return Y||E.Dom.getPreviousSiblingBy(G.lastChild,x);},getLastChild:function(G){G=E.Dom.get(G);return E.Dom.getLastChildBy(G);},getChildrenBy:function(Y,y){var x=E.Dom.getFirstChildBy(Y,y),G=x?[x]:[];E.Dom.getNextSiblingBy(x,function(z){if(!y||y(z)){G[G.length]=z;}return false;});return G;},getChildren:function(G){G=E.Dom.get(G);if(!G){}return E.Dom.getChildrenBy(G);},getDocumentScrollLeft:function(G){G=G||K;return Math.max(G[v].scrollLeft,G.body.scrollLeft);},getDocumentScrollTop:function(G){G=G||K;return Math.max(G[v].scrollTop,G.body.scrollTop);},insertBefore:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null;}return G[Z].insertBefore(Y,G);},insertAfter:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null;}if(G.nextSibling){return G[Z].insertBefore(Y,G.nextSibling);}else{return G[Z].appendChild(Y);}},getClientRegion:function(){var x=E.Dom.getDocumentScrollTop(),Y=E.Dom.getDocumentScrollLeft(),y=E.Dom.getViewportWidth()+Y,G=E.Dom.getViewportHeight()+x;return new E.Region(x,y,G,Y);},setAttribute:function(Y,G,x){G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;Y.setAttribute(G,x);},getAttribute:function(Y,G){G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;return Y.getAttribute(G);},_toCamel:function(Y){var x=d;function G(y,z){return z.toUpperCase();}return x[Y]||(x[Y]=Y.indexOf("-")===-1?Y:Y.replace(/-([a-z])/gi,G));},_getClassRegex:function(Y){var G;if(Y!==undefined){if(Y.exec){G=Y;}else{G=h[Y];if(!G){Y=Y.replace(E.Dom._patterns.CLASS_RE_TOKENS,"\\$1");G=h[Y]=new RegExp(s+Y+k,U);}}}return G;},_patterns:{ROOT_TAG:/^body|html$/i,CLASS_RE_TOKENS:/([\.\(\)\^\$\*\+\?\|\[\]\{\}])/g},_testElement:function(G,Y){return G&&G[l]==1&&(!Y||Y(G));},_calcBorders:function(x,y){var Y=parseInt(E.Dom[w](x,R),10)||0,G=parseInt(E.Dom[w](x,q),10)||0;if(H){if(N.test(x[C])){Y=0;G=0;}}y[0]+=G;y[1]+=Y;return y;}};var S=E.Dom[w];if(m.opera){E.Dom[w]=function(Y,G){var x=S(Y,G);if(X.test(G)){x=E.Dom.Color.toRGB(x);}return x;};}if(m.webkit){E.Dom[w]=function(Y,G){var x=S(Y,G);if(x==="rgba(0, 0, 0, 0)"){x="transparent";}return x;};}})();YAHOO.util.Region=function(C,D,A,B){this.top=C;this.y=C;this[1]=C;this.right=D;this.bottom=A;this.left=B;this.x=B;this[0]=B;this.width=this.right-this.left;this.height=this.bottom-this.top;};YAHOO.util.Region.prototype.contains=function(A){return(A.left>=this.left&&A.right<=this.right&&A.top>=this.top&&A.bottom<=this.bottom);};YAHOO.util.Region.prototype.getArea=function(){return((this.bottom-this.top)*(this.right-this.left));};YAHOO.util.Region.prototype.intersect=function(E){var C=Math.max(this.top,E.top),D=Math.min(this.right,E.right),A=Math.min(this.bottom,E.bottom),B=Math.max(this.left,E.left);if(A>=C&&D>=B){return new YAHOO.util.Region(C,D,A,B);}else{return null;}};YAHOO.util.Region.prototype.union=function(E){var C=Math.min(this.top,E.top),D=Math.max(this.right,E.right),A=Math.max(this.bottom,E.bottom),B=Math.min(this.left,E.left);return new YAHOO.util.Region(C,D,A,B);};YAHOO.util.Region.prototype.toString=function(){return("Region {"+"top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+", height: "+this.height+", width: "+this.width+"}");};YAHOO.util.Region.getRegion=function(D){var F=YAHOO.util.Dom.getXY(D),C=F[1],E=F[0]+D.offsetWidth,A=F[1]+D.offsetHeight,B=F[0];return new YAHOO.util.Region(C,E,A,B);};YAHOO.util.Point=function(A,B){if(YAHOO.lang.isArray(A)){B=A[1];A=A[0];}YAHOO.util.Point.superclass.constructor.call(this,B,A,B,A);};YAHOO.extend(YAHOO.util.Point,YAHOO.util.Region);(function(){var B=YAHOO.util,A="clientTop",F="clientLeft",J="parentNode",K="right",W="hasLayout",I="px",U="opacity",L="auto",D="borderLeftWidth",G="borderTopWidth",P="borderRightWidth",V="borderBottomWidth",S="visible",Q="transparent",N="height",E="width",H="style",T="currentStyle",R=/^width|height$/,O=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,M={get:function(X,Z){var Y="",a=X[T][Z];if(Z===U){Y=B.Dom.getStyle(X,U);}else{if(!a||(a.indexOf&&a.indexOf(I)>-1)){Y=a;}else{if(B.Dom.IE_COMPUTED[Z]){Y=B.Dom.IE_COMPUTED[Z](X,Z);}else{if(O.test(a)){Y=B.Dom.IE.ComputedStyle.getPixel(X,Z);}else{Y=a;}}}}return Y;},getOffset:function(Z,e){var b=Z[T][e],X=e.charAt(0).toUpperCase()+e.substr(1),c="offset"+X,Y="pixel"+X,a="",d;if(b==L){d=Z[c];if(d===undefined){a=0;}a=d;if(R.test(e)){Z[H][e]=d;if(Z[c]>d){a=d-(Z[c]-d);}Z[H][e]=L;}}else{if(!Z[H][Y]&&!Z[H][e]){Z[H][e]=b;}a=Z[H][Y];}return a+I;},getBorderWidth:function(X,Z){var Y=null;if(!X[T][W]){X[H].zoom=1;}switch(Z){case G:Y=X[A];break;case V:Y=X.offsetHeight-X.clientHeight-X[A];break;case D:Y=X[F];break;case P:Y=X.offsetWidth-X.clientWidth-X[F];break;}return Y+I;},getPixel:function(Y,X){var a=null,b=Y[T][K],Z=Y[T][X];Y[H][K]=Z;a=Y[H].pixelRight;Y[H][K]=b;return a+I;},getMargin:function(Y,X){var Z;if(Y[T][X]==L){Z=0+I;}else{Z=B.Dom.IE.ComputedStyle.getPixel(Y,X);}return Z;},getVisibility:function(Y,X){var Z;while((Z=Y[T])&&Z[X]=="inherit"){Y=Y[J];}return(Z)?Z[X]:S;},getColor:function(Y,X){return B.Dom.Color.toRGB(Y[T][X])||Q;},getBorderColor:function(Y,X){var Z=Y[T],a=Z[X]||Z.color;return B.Dom.Color.toRGB(B.Dom.Color.toHex(a));}},C={};C.top=C.right=C.bottom=C.left=C[E]=C[N]=M.getOffset;C.color=M.getColor;C[G]=C[P]=C[V]=C[D]=M.getBorderWidth;C.marginTop=C.marginRight=C.marginBottom=C.marginLeft=M.getMargin;C.visibility=M.getVisibility;C.borderColor=C.borderTopColor=C.borderRightColor=C.borderBottomColor=C.borderLeftColor=M.getBorderColor;B.Dom.IE_COMPUTED=C;B.Dom.IE_ComputedStyle=M;})();(function(){var C="toString",A=parseInt,B=RegExp,D=YAHOO.util;D.Dom.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(E){if(!D.Dom.Color.re_RGB.test(E)){E=D.Dom.Color.toHex(E);}if(D.Dom.Color.re_hex.exec(E)){E="rgb("+[A(B.$1,16),A(B.$2,16),A(B.$3,16)].join(", ")+")";}return E;},toHex:function(H){H=D.Dom.Color.KEYWORDS[H]||H;if(D.Dom.Color.re_RGB.exec(H)){var G=(B.$1.length===1)?"0"+B.$1:Number(B.$1),F=(B.$2.length===1)?"0"+B.$2:Number(B.$2),E=(B.$3.length===1)?"0"+B.$3:Number(B.$3);H=[G[C](16),F[C](16),E[C](16)].join("");}if(H.length<6){H=H.replace(D.Dom.Color.re_hex3,"$1$1");}if(H!=="transparent"&&H.indexOf("#")<0){H="#"+H;}return H.toLowerCase();}};}());YAHOO.register("dom",YAHOO.util.Dom,{version:"2.7.0",build:"1799"});YAHOO.util.CustomEvent=function(D,C,B,A){this.type=D;this.scope=C||window;this.silent=B;this.signature=A||YAHOO.util.CustomEvent.LIST;this.subscribers=[];if(!this.silent){}var E="_YUICEOnSubscribe";if(D!==E){this.subscribeEvent=new YAHOO.util.CustomEvent(E,this,true);}this.lastError=null;};YAHOO.util.CustomEvent.LIST=0;YAHOO.util.CustomEvent.FLAT=1;YAHOO.util.CustomEvent.prototype={subscribe:function(A,B,C){if(!A){throw new Error("Invalid callback for subscriber to '"+this.type+"'");}if(this.subscribeEvent){this.subscribeEvent.fire(A,B,C);}this.subscribers.push(new YAHOO.util.Subscriber(A,B,C));},unsubscribe:function(D,F){if(!D){return this.unsubscribeAll();}var E=false;for(var B=0,A=this.subscribers.length;B<A;++B){var C=this.subscribers[B];if(C&&C.contains(D,F)){this._delete(B);E=true;}}return E;},fire:function(){this.lastError=null;var K=[],E=this.subscribers.length;if(!E&&this.silent){return true;}var I=[].slice.call(arguments,0),G=true,D,J=false;if(!this.silent){}var C=this.subscribers.slice(),A=YAHOO.util.Event.throwErrors;for(D=0;D<E;++D){var M=C[D];if(!M){J=true;}else{if(!this.silent){}var L=M.getScope(this.scope);if(this.signature==YAHOO.util.CustomEvent.FLAT){var B=null;if(I.length>0){B=I[0];}try{G=M.fn.call(L,B,M.obj);}catch(F){this.lastError=F;if(A){throw F;}}}else{try{G=M.fn.call(L,this.type,I,M.obj);}catch(H){this.lastError=H;if(A){throw H;}}}if(false===G){if(!this.silent){}break;}}}return(G!==false);},unsubscribeAll:function(){var A=this.subscribers.length,B;for(B=A-1;B>-1;B--){this._delete(B);}this.subscribers=[];return A;},_delete:function(A){var B=this.subscribers[A];if(B){delete B.fn;delete B.obj;}this.subscribers.splice(A,1);},toString:function(){return"CustomEvent: "+"'"+this.type+"', "+"context: "+this.scope;}};YAHOO.util.Subscriber=function(A,B,C){this.fn=A;this.obj=YAHOO.lang.isUndefined(B)?null:B;this.overrideContext=C;};YAHOO.util.Subscriber.prototype.getScope=function(A){if(this.overrideContext){if(this.overrideContext===true){return this.obj;}else{return this.overrideContext;}}return A;};YAHOO.util.Subscriber.prototype.contains=function(A,B){if(B){return(this.fn==A&&this.obj==B);}else{return(this.fn==A);}};YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", overrideContext: "+(this.overrideContext||"no")+" }";};if(!YAHOO.util.Event){YAHOO.util.Event=function(){var H=false;var I=[];var J=[];var G=[];var E=[];var C=0;var F=[];var B=[];var A=0;var D={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9};var K=YAHOO.env.ua.ie?"focusin":"focus";var L=YAHOO.env.ua.ie?"focusout":"blur";return{POLL_RETRYS:2000,POLL_INTERVAL:20,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:YAHOO.env.ua.ie,_interval:null,_dri:null,DOMReady:false,throwErrors:false,startInterval:function(){if(!this._interval){var M=this;var N=function(){M._tryPreloadAttach();};this._interval=setInterval(N,this.POLL_INTERVAL);}},onAvailable:function(S,O,Q,R,P){var M=(YAHOO.lang.isString(S))?[S]:S;for(var N=0;N<M.length;N=N+1){F.push({id:M[N],fn:O,obj:Q,overrideContext:R,checkReady:P});}C=this.POLL_RETRYS;this.startInterval();},onContentReady:function(P,M,N,O){this.onAvailable(P,M,N,O,true);},onDOMReady:function(M,N,O){if(this.DOMReady){setTimeout(function(){var P=window;if(O){if(O===true){P=N;}else{P=O;}}M.call(P,"DOMReady",[],N);},0);}else{this.DOMReadyEvent.subscribe(M,N,O);}},_addListener:function(O,M,Y,S,W,b){if(!Y||!Y.call){return false;}if(this._isValidCollection(O)){var Z=true;for(var T=0,V=O.length;T<V;++T){Z=this.on(O[T],M,Y,S,W)&&Z;}return Z;}else{if(YAHOO.lang.isString(O)){var R=this.getEl(O);if(R){O=R;}else{this.onAvailable(O,function(){YAHOO.util.Event.on(O,M,Y,S,W);});return true;}}}if(!O){return false;}if("unload"==M&&S!==this){J[J.length]=[O,M,Y,S,W];return true;}var N=O;if(W){if(W===true){N=S;}else{N=W;}}var P=function(c){return Y.call(N,YAHOO.util.Event.getEvent(c,O),S);};var a=[O,M,Y,P,N,S,W];var U=I.length;I[U]=a;if(this.useLegacyEvent(O,M)){var Q=this.getLegacyIndex(O,M);if(Q==-1||O!=G[Q][0]){Q=G.length;B[O.id+M]=Q;G[Q]=[O,M,O["on"+M]];E[Q]=[];O["on"+M]=function(c){YAHOO.util.Event.fireLegacyEvent(YAHOO.util.Event.getEvent(c),Q);};}E[Q].push(a);}else{try{this._simpleAdd(O,M,P,b);}catch(X){this.lastError=X;this.removeListener(O,M,Y);return false;}}return true;},addListener:function(N,Q,M,O,P){return this._addListener(N,Q,M,O,P,false);},addFocusListener:function(N,M,O,P){return this._addListener(N,K,M,O,P,true);},removeFocusListener:function(N,M){return this.removeListener(N,K,M);},addBlurListener:function(N,M,O,P){return this._addListener(N,L,M,O,P,true);},removeBlurListener:function(N,M){return this.removeListener(N,L,M);},fireLegacyEvent:function(R,P){var T=true,M,V,U,N,S;V=E[P].slice();for(var O=0,Q=V.length;O<Q;++O){U=V[O];if(U&&U[this.WFN]){N=U[this.ADJ_SCOPE];S=U[this.WFN].call(N,R);T=(T&&S);}}M=G[P];if(M&&M[2]){M[2](R);}return T;},getLegacyIndex:function(N,O){var M=this.generateId(N)+O;if(typeof B[M]=="undefined"){return-1;}else{return B[M];}},useLegacyEvent:function(M,N){return(this.webkit&&this.webkit<419&&("click"==N||"dblclick"==N));},removeListener:function(N,M,V){var Q,T,X;if(typeof N=="string"){N=this.getEl(N);}else{if(this._isValidCollection(N)){var W=true;for(Q=N.length-1;Q>-1;Q--){W=(this.removeListener(N[Q],M,V)&&W);}return W;}}if(!V||!V.call){return this.purgeElement(N,false,M);}if("unload"==M){for(Q=J.length-1;Q>-1;Q--){X=J[Q];if(X&&X[0]==N&&X[1]==M&&X[2]==V){J.splice(Q,1);return true;}}return false;}var R=null;var S=arguments[3];if("undefined"===typeof S){S=this._getCacheIndex(N,M,V);}if(S>=0){R=I[S];}if(!N||!R){return false;}if(this.useLegacyEvent(N,M)){var P=this.getLegacyIndex(N,M);var O=E[P];if(O){for(Q=0,T=O.length;Q<T;++Q){X=O[Q];if(X&&X[this.EL]==N&&X[this.TYPE]==M&&X[this.FN]==V){O.splice(Q,1);break;}}}}else{try{this._simpleRemove(N,M,R[this.WFN],false);}catch(U){this.lastError=U;return false;}}delete I[S][this.WFN];delete I[S][this.FN];I.splice(S,1);return true;},getTarget:function(O,N){var M=O.target||O.srcElement;return this.resolveTextNode(M);},resolveTextNode:function(N){try{if(N&&3==N.nodeType){return N.parentNode;}}catch(M){}return N;},getPageX:function(N){var M=N.pageX;if(!M&&0!==M){M=N.clientX||0;if(this.isIE){M+=this._getScrollLeft();}}return M;},getPageY:function(M){var N=M.pageY;if(!N&&0!==N){N=M.clientY||0;if(this.isIE){N+=this._getScrollTop();}}return N;},getXY:function(M){return[this.getPageX(M),this.getPageY(M)];},getRelatedTarget:function(N){var M=N.relatedTarget;if(!M){if(N.type=="mouseout"){M=N.toElement;}else{if(N.type=="mouseover"){M=N.fromElement;}}}return this.resolveTextNode(M);},getTime:function(O){if(!O.time){var N=new Date().getTime();try{O.time=N;}catch(M){this.lastError=M;return N;}}return O.time;},stopEvent:function(M){this.stopPropagation(M);this.preventDefault(M);},stopPropagation:function(M){if(M.stopPropagation){M.stopPropagation();}else{M.cancelBubble=true;}},preventDefault:function(M){if(M.preventDefault){M.preventDefault();}else{M.returnValue=false;}},getEvent:function(O,M){var N=O||window.event;if(!N){var P=this.getEvent.caller;while(P){N=P.arguments[0];if(N&&Event==N.constructor){break;}P=P.caller;}}return N;},getCharCode:function(N){var M=N.keyCode||N.charCode||0;if(YAHOO.env.ua.webkit&&(M in D)){M=D[M];}return M;},_getCacheIndex:function(Q,R,P){for(var O=0,N=I.length;O<N;O=O+1){var M=I[O];if(M&&M[this.FN]==P&&M[this.EL]==Q&&M[this.TYPE]==R){return O;}}return-1;},generateId:function(M){var N=M.id;if(!N){N="yuievtautoid-"+A;++A;M.id=N;}return N;},_isValidCollection:function(N){try{return(N&&typeof N!=="string"&&N.length&&!N.tagName&&!N.alert&&typeof N[0]!=="undefined");}catch(M){return false;}},elCache:{},getEl:function(M){return(typeof M==="string")?document.getElementById(M):M;},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",this),_load:function(N){if(!H){H=true;var M=YAHOO.util.Event;M._ready();M._tryPreloadAttach();}},_ready:function(N){var M=YAHOO.util.Event;if(!M.DOMReady){M.DOMReady=true;M.DOMReadyEvent.fire();M._simpleRemove(document,"DOMContentLoaded",M._ready);}},_tryPreloadAttach:function(){if(F.length===0){C=0;if(this._interval){clearInterval(this._interval);this._interval=null;}return;}if(this.locked){return;}if(this.isIE){if(!this.DOMReady){this.startInterval();return;}}this.locked=true;var S=!H;if(!S){S=(C>0&&F.length>0);}var R=[];var T=function(V,W){var U=V;if(W.overrideContext){if(W.overrideContext===true){U=W.obj;}else{U=W.overrideContext;}}W.fn.call(U,W.obj);};var N,M,Q,P,O=[];for(N=0,M=F.length;N<M;N=N+1){Q=F[N];if(Q){P=this.getEl(Q.id);if(P){if(Q.checkReady){if(H||P.nextSibling||!S){O.push(Q);F[N]=null;}}else{T(P,Q);F[N]=null;}}else{R.push(Q);}}}for(N=0,M=O.length;N<M;N=N+1){Q=O[N];T(this.getEl(Q.id),Q);}C--;if(S){for(N=F.length-1;N>-1;N--){Q=F[N];if(!Q||!Q.id){F.splice(N,1);}}this.startInterval();}else{if(this._interval){clearInterval(this._interval);this._interval=null;}}this.locked=false;},purgeElement:function(Q,R,T){var O=(YAHOO.lang.isString(Q))?this.getEl(Q):Q;var S=this.getListeners(O,T),P,M;if(S){for(P=S.length-1;P>-1;P--){var N=S[P];this.removeListener(O,N.type,N.fn);}}if(R&&O&&O.childNodes){for(P=0,M=O.childNodes.length;P<M;++P){this.purgeElement(O.childNodes[P],R,T);}}},getListeners:function(O,M){var R=[],N;if(!M){N=[I,J];}else{if(M==="unload"){N=[J];}else{N=[I];}}var T=(YAHOO.lang.isString(O))?this.getEl(O):O;for(var Q=0;Q<N.length;Q=Q+1){var V=N[Q];if(V){for(var S=0,U=V.length;S<U;++S){var P=V[S];if(P&&P[this.EL]===T&&(!M||M===P[this.TYPE])){R.push({type:P[this.TYPE],fn:P[this.FN],obj:P[this.OBJ],adjust:P[this.OVERRIDE],scope:P[this.ADJ_SCOPE],index:S});}}}}return(R.length)?R:null;},_unload:function(T){var N=YAHOO.util.Event,Q,P,O,S,R,U=J.slice(),M;for(Q=0,S=J.length;Q<S;++Q){O=U[Q];if(O){M=window;if(O[N.ADJ_SCOPE]){if(O[N.ADJ_SCOPE]===true){M=O[N.UNLOAD_OBJ];}else{M=O[N.ADJ_SCOPE];}}O[N.FN].call(M,N.getEvent(T,O[N.EL]),O[N.UNLOAD_OBJ]);U[Q]=null;}}O=null;M=null;J=null;if(I){for(P=I.length-1;P>-1;P--){O=I[P];if(O){N.removeListener(O[N.EL],O[N.TYPE],O[N.FN],P);}}O=null;}G=null;N._simpleRemove(window,"unload",N._unload);},_getScrollLeft:function(){return this._getScroll()[1];},_getScrollTop:function(){return this._getScroll()[0];},_getScroll:function(){var M=document.documentElement,N=document.body;if(M&&(M.scrollTop||M.scrollLeft)){return[M.scrollTop,M.scrollLeft];}else{if(N){return[N.scrollTop,N.scrollLeft];}else{return[0,0];}}},regCE:function(){},_simpleAdd:function(){if(window.addEventListener){return function(O,P,N,M){O.addEventListener(P,N,(M));};}else{if(window.attachEvent){return function(O,P,N,M){O.attachEvent("on"+P,N);};}else{return function(){};}}}(),_simpleRemove:function(){if(window.removeEventListener){return function(O,P,N,M){O.removeEventListener(P,N,(M));};}else{if(window.detachEvent){return function(N,O,M){N.detachEvent("on"+O,M);};}else{return function(){};}}}()};}();(function(){var EU=YAHOO.util.Event;EU.on=EU.addListener;EU.onFocus=EU.addFocusListener;EU.onBlur=EU.addBlurListener;if(EU.isIE){YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,true);var n=document.createElement("p");EU._dri=setInterval(function(){try{n.doScroll("left");clearInterval(EU._dri);EU._dri=null;EU._ready();n=null;}catch(ex){}},EU.POLL_INTERVAL);}else{if(EU.webkit&&EU.webkit<525){EU._dri=setInterval(function(){var rs=document.readyState;if("loaded"==rs||"complete"==rs){clearInterval(EU._dri);EU._dri=null;EU._ready();}},EU.POLL_INTERVAL);}else{EU._simpleAdd(document,"DOMContentLoaded",EU._ready);}}EU._simpleAdd(window,"load",EU._load);EU._simpleAdd(window,"unload",EU._unload);EU._tryPreloadAttach();})();}YAHOO.util.EventProvider=function(){};YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(A,C,F,E){this.__yui_events=this.__yui_events||{};var D=this.__yui_events[A];if(D){D.subscribe(C,F,E);}else{this.__yui_subscribers=this.__yui_subscribers||{};var B=this.__yui_subscribers;if(!B[A]){B[A]=[];}B[A].push({fn:C,obj:F,overrideContext:E});}},unsubscribe:function(C,E,G){this.__yui_events=this.__yui_events||{};var A=this.__yui_events;if(C){var F=A[C];if(F){return F.unsubscribe(E,G);}}else{var B=true;for(var D in A){if(YAHOO.lang.hasOwnProperty(A,D)){B=B&&A[D].unsubscribe(E,G);}}return B;}return false;},unsubscribeAll:function(A){return this.unsubscribe(A);},createEvent:function(G,D){this.__yui_events=this.__yui_events||{};var A=D||{};var I=this.__yui_events;if(I[G]){}else{var H=A.scope||this;var E=(A.silent);var B=new YAHOO.util.CustomEvent(G,H,E,YAHOO.util.CustomEvent.FLAT);I[G]=B;if(A.onSubscribeCallback){B.subscribeEvent.subscribe(A.onSubscribeCallback);}this.__yui_subscribers=this.__yui_subscribers||{};var F=this.__yui_subscribers[G];if(F){for(var C=0;C<F.length;++C){B.subscribe(F[C].fn,F[C].obj,F[C].overrideContext);}}}return I[G];},fireEvent:function(E,D,A,C){this.__yui_events=this.__yui_events||{};var G=this.__yui_events[E];if(!G){return null;}var B=[];for(var F=1;F<arguments.length;++F){B.push(arguments[F]);}return G.fire.apply(G,B);},hasEvent:function(A){if(this.__yui_events){if(this.__yui_events[A]){return true;}}return false;}};(function(){var A=YAHOO.util.Event,C=YAHOO.lang;YAHOO.util.KeyListener=function(D,I,E,F){if(!D){}else{if(!I){}else{if(!E){}}}if(!F){F=YAHOO.util.KeyListener.KEYDOWN;}var G=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled");this.disabledEvent=new YAHOO.util.CustomEvent("disabled");if(C.isString(D)){D=document.getElementById(D);}if(C.isFunction(E)){G.subscribe(E);}else{G.subscribe(E.fn,E.scope,E.correctScope);}function H(O,N){if(!I.shift){I.shift=false;}if(!I.alt){I.alt=false;}if(!I.ctrl){I.ctrl=false;}if(O.shiftKey==I.shift&&O.altKey==I.alt&&O.ctrlKey==I.ctrl){var J,M=I.keys,L;if(YAHOO.lang.isArray(M)){for(var K=0;K<M.length;K++){J=M[K];L=A.getCharCode(O);if(J==L){G.fire(L,O);break;}}}else{L=A.getCharCode(O);if(M==L){G.fire(L,O);}}}}this.enable=function(){if(!this.enabled){A.on(D,F,H);this.enabledEvent.fire(I);}this.enabled=true;};this.disable=function(){if(this.enabled){A.removeListener(D,F,H);this.disabledEvent.fire(I);}this.enabled=false;};this.toString=function(){return"KeyListener ["+I.keys+"] "+D.tagName+(D.id?"["+D.id+"]":"");};};var B=YAHOO.util.KeyListener;B.KEYDOWN="keydown";B.KEYUP="keyup";B.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38};})();YAHOO.register("event",YAHOO.util.Event,{version:"2.7.0",build:"1799"});YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:true,_default_xhr_header:"XMLHttpRequest",_has_default_headers:true,_default_headers:{},_isFormSubmit:false,_isFileUpload:false,_formNode:null,_sFormData:null,_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,_submitElementValue:null,_hasSubmitListener:(function(){if(YAHOO.util.Event){YAHOO.util.Event.addListener(document,"click",function(C){var B=YAHOO.util.Event.getTarget(C),A=B.nodeName.toLowerCase();if((A==="input"||A==="button")&&(B.type&&B.type.toLowerCase()=="submit")){YAHOO.util.Connect._submitElementValue=encodeURIComponent(B.name)+"="+encodeURIComponent(B.value);}});return true;}return false;})(),startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),uploadEvent:new YAHOO.util.CustomEvent("upload"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(A){this._msxml_progid.unshift(A);},setDefaultPostHeader:function(A){if(typeof A=="string"){this._default_post_header=A;}else{if(typeof A=="boolean"){this._use_default_post_header=A;}}},setDefaultXhrHeader:function(A){if(typeof A=="string"){this._default_xhr_header=A;}else{this._use_default_xhr_header=A;}},setPollingInterval:function(A){if(typeof A=="number"&&isFinite(A)){this._polling_interval=A;}},createXhrObject:function(F){var E,A;try{A=new XMLHttpRequest();E={conn:A,tId:F};}catch(D){for(var B=0;B<this._msxml_progid.length;++B){try{A=new ActiveXObject(this._msxml_progid[B]);E={conn:A,tId:F};break;}catch(C){}}}finally{return E;}},getConnectionObject:function(A){var C;var D=this._transaction_id;try{if(!A){C=this.createXhrObject(D);}else{C={};C.tId=D;C.isUpload=true;}if(C){this._transaction_id++;}}catch(B){}finally{return C;}},asyncRequest:function(F,C,E,A){var D=(this._isFileUpload)?this.getConnectionObject(true):this.getConnectionObject();var B=(E&&E.argument)?E.argument:null;if(!D){return null;}else{if(E&&E.customevents){this.initCustomEvents(D,E);}if(this._isFormSubmit){if(this._isFileUpload){this.uploadFile(D,E,C,A);return D;}if(F.toUpperCase()=="GET"){if(this._sFormData.length!==0){C+=((C.indexOf("?")==-1)?"?":"&")+this._sFormData;}}else{if(F.toUpperCase()=="POST"){A=A?this._sFormData+"&"+A:this._sFormData;}}}if(F.toUpperCase()=="GET"&&(E&&E.cache===false)){C+=((C.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString();}D.conn.open(F,C,true);if(this._use_default_xhr_header){if(!this._default_headers["X-Requested-With"]){this.initHeader("X-Requested-With",this._default_xhr_header,true);}}if((F.toUpperCase()==="POST"&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader("Content-Type",this._default_post_header);}if(this._has_default_headers||this._has_http_headers){this.setHeader(D);}this.handleReadyState(D,E);D.conn.send(A||"");if(this._isFormSubmit===true){this.resetFormState();}this.startEvent.fire(D,B);if(D.startEvent){D.startEvent.fire(D,B);}return D;}},initCustomEvents:function(A,C){var B;for(B in C.customevents){if(this._customEvents[B][0]){A[this._customEvents[B][0]]=new YAHOO.util.CustomEvent(this._customEvents[B][1],(C.scope)?C.scope:null);A[this._customEvents[B][0]].subscribe(C.customevents[B]);}}},handleReadyState:function(C,D){var B=this;var A=(D&&D.argument)?D.argument:null;if(D&&D.timeout){this._timeOut[C.tId]=window.setTimeout(function(){B.abort(C,D,true);},D.timeout);}this._poll[C.tId]=window.setInterval(function(){if(C.conn&&C.conn.readyState===4){window.clearInterval(B._poll[C.tId]);delete B._poll[C.tId];if(D&&D.timeout){window.clearTimeout(B._timeOut[C.tId]);delete B._timeOut[C.tId];}B.completeEvent.fire(C,A);if(C.completeEvent){C.completeEvent.fire(C,A);}B.handleTransactionResponse(C,D);}},this._polling_interval);},handleTransactionResponse:function(F,G,A){var D,C;var B=(G&&G.argument)?G.argument:null;try{if(F.conn.status!==undefined&&F.conn.status!==0){D=F.conn.status;}else{D=13030;}}catch(E){D=13030;}if(D>=200&&D<300||D===1223){C=this.createResponseObject(F,B);if(G&&G.success){if(!G.scope){G.success(C);}else{G.success.apply(G.scope,[C]);}}this.successEvent.fire(C);if(F.successEvent){F.successEvent.fire(C);}}else{switch(D){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:C=this.createExceptionObject(F.tId,B,(A?A:false));if(G&&G.failure){if(!G.scope){G.failure(C);}else{G.failure.apply(G.scope,[C]);}}break;default:C=this.createResponseObject(F,B);if(G&&G.failure){if(!G.scope){G.failure(C);}else{G.failure.apply(G.scope,[C]);}}}this.failureEvent.fire(C);if(F.failureEvent){F.failureEvent.fire(C);}}this.releaseObject(F);C=null;},createResponseObject:function(A,G){var D={};var I={};try{var C=A.conn.getAllResponseHeaders();var F=C.split("\n");for(var E=0;E<F.length;E++){var B=F[E].indexOf(":");if(B!=-1){I[F[E].substring(0,B)]=F[E].substring(B+2);}}}catch(H){}D.tId=A.tId;D.status=(A.conn.status==1223)?204:A.conn.status;D.statusText=(A.conn.status==1223)?"No Content":A.conn.statusText;D.getResponseHeader=I;D.getAllResponseHeaders=C;D.responseText=A.conn.responseText;D.responseXML=A.conn.responseXML;if(G){D.argument=G;}return D;},createExceptionObject:function(H,D,A){var F=0;var G="communication failure";var C=-1;var B="transaction aborted";var E={};E.tId=H;if(A){E.status=C;E.statusText=B;}else{E.status=F;E.statusText=G;}if(D){E.argument=D;}return E;},initHeader:function(A,D,C){var B=(C)?this._default_headers:this._http_headers;B[A]=D;if(C){this._has_default_headers=true;}else{this._has_http_headers=true;}},setHeader:function(A){var B;if(this._has_default_headers){for(B in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,B)){A.conn.setRequestHeader(B,this._default_headers[B]);}}}if(this._has_http_headers){for(B in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,B)){A.conn.setRequestHeader(B,this._http_headers[B]);}}delete this._http_headers;this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){delete this._default_headers;this._default_headers={};this._has_default_headers=false;},setForm:function(M,H,C){var L,B,K,I,P,J=false,F=[],O=0,E,G,D,N,A;this.resetFormState();if(typeof M=="string"){L=(document.getElementById(M)||document.forms[M]);}else{if(typeof M=="object"){L=M;}else{return;}}if(H){this.createFrame(C?C:null);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=L;return;}for(E=0,G=L.elements.length;E<G;++E){B=L.elements[E];P=B.disabled;K=B.name;if(!P&&K){K=encodeURIComponent(K)+"=";I=encodeURIComponent(B.value);switch(B.type){case"select-one":if(B.selectedIndex>-1){A=B.options[B.selectedIndex];F[O++]=K+encodeURIComponent((A.attributes.value&&A.attributes.value.specified)?A.value:A.text);}break;case"select-multiple":if(B.selectedIndex>-1){for(D=B.selectedIndex,N=B.options.length;D<N;++D){A=B.options[D];if(A.selected){F[O++]=K+encodeURIComponent((A.attributes.value&&A.attributes.value.specified)?A.value:A.text);}}}break;case"radio":case"checkbox":if(B.checked){F[O++]=K+I;}break;case"file":case undefined:case"reset":case"button":break;case"submit":if(J===false){if(this._hasSubmitListener&&this._submitElementValue){F[O++]=this._submitElementValue;}J=true;}break;default:F[O++]=K+I;}}}this._isFormSubmit=true;this._sFormData=F.join("&");this.initHeader("Content-Type",this._default_form_header);return this._sFormData;},resetFormState:function(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";},createFrame:function(A){var B="yuiIO"+this._transaction_id;var C;if(YAHOO.env.ua.ie){C=document.createElement('<iframe id="'+B+'" name="'+B+'" />');if(typeof A=="boolean"){C.src="javascript:false";}}else{C=document.createElement("iframe");C.id=B;C.name=B;}C.style.position="absolute";C.style.top="-1000px";C.style.left="-1000px";document.body.appendChild(C);},appendPostData:function(A){var D=[],B=A.split("&"),C,E;for(C=0;C<B.length;C++){E=B[C].indexOf("=");if(E!=-1){D[C]=document.createElement("input");D[C].type="hidden";D[C].name=decodeURIComponent(B[C].substring(0,E));D[C].value=decodeURIComponent(B[C].substring(E+1));this._formNode.appendChild(D[C]);}}return D;},uploadFile:function(D,N,E,C){var I="yuiIO"+D.tId,J="multipart/form-data",L=document.getElementById(I),O=this,K=(N&&N.argument)?N.argument:null,M,H,B,G;var A={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")};this._formNode.setAttribute("action",E);this._formNode.setAttribute("method","POST");this._formNode.setAttribute("target",I);if(YAHOO.env.ua.ie){this._formNode.setAttribute("encoding",J);}else{this._formNode.setAttribute("enctype",J);}if(C){M=this.appendPostData(C);}this._formNode.submit();this.startEvent.fire(D,K);if(D.startEvent){D.startEvent.fire(D,K);}if(N&&N.timeout){this._timeOut[D.tId]=window.setTimeout(function(){O.abort(D,N,true);},N.timeout);}if(M&&M.length>0){for(H=0;H<M.length;H++){this._formNode.removeChild(M[H]);}}for(B in A){if(YAHOO.lang.hasOwnProperty(A,B)){if(A[B]){this._formNode.setAttribute(B,A[B]);}else{this._formNode.removeAttribute(B);}}}this.resetFormState();var F=function(){if(N&&N.timeout){window.clearTimeout(O._timeOut[D.tId]);delete O._timeOut[D.tId];}O.completeEvent.fire(D,K);if(D.completeEvent){D.completeEvent.fire(D,K);}G={tId:D.tId,argument:N.argument};try{G.responseText=L.contentWindow.document.body?L.contentWindow.document.body.innerHTML:L.contentWindow.document.documentElement.textContent;G.responseXML=L.contentWindow.document.XMLDocument?L.contentWindow.document.XMLDocument:L.contentWindow.document;}catch(P){}if(N&&N.upload){if(!N.scope){N.upload(G);}else{N.upload.apply(N.scope,[G]);}}O.uploadEvent.fire(G);if(D.uploadEvent){D.uploadEvent.fire(G);}YAHOO.util.Event.removeListener(L,"load",F);setTimeout(function(){document.body.removeChild(L);O.releaseObject(D);},100);};YAHOO.util.Event.addListener(L,"load",F);},abort:function(E,G,A){var D;var B=(G&&G.argument)?G.argument:null;if(E&&E.conn){if(this.isCallInProgress(E)){E.conn.abort();window.clearInterval(this._poll[E.tId]);delete this._poll[E.tId];if(A){window.clearTimeout(this._timeOut[E.tId]);delete this._timeOut[E.tId];}D=true;}}else{if(E&&E.isUpload===true){var C="yuiIO"+E.tId;var F=document.getElementById(C);if(F){YAHOO.util.Event.removeListener(F,"load");document.body.removeChild(F);if(A){window.clearTimeout(this._timeOut[E.tId]);delete this._timeOut[E.tId];}D=true;}}else{D=false;}}if(D===true){this.abortEvent.fire(E,B);if(E.abortEvent){E.abortEvent.fire(E,B);}this.handleTransactionResponse(E,G,true);}return D;},isCallInProgress:function(B){if(B&&B.conn){return B.conn.readyState!==4&&B.conn.readyState!==0;}else{if(B&&B.isUpload===true){var A="yuiIO"+B.tId;return document.getElementById(A)?true:false;}else{return false;}}},releaseObject:function(A){if(A&&A.conn){A.conn=null;A=null;}}};YAHOO.register("connection",YAHOO.util.Connect,{version:"2.7.0",build:"1799"});(function(){var B=YAHOO.util;var A=function(D,C,E,F){if(!D){}this.init(D,C,E,F);};A.NAME="Anim";A.prototype={toString:function(){var C=this.getEl()||{};var D=C.id||C.tagName;return(this.constructor.NAME+": "+D);},patterns:{noNegatives:/width|height|opacity|padding/i,offsetAttribute:/^((width|height)|(top|left))$/,defaultUnit:/width|height|top$|bottom$|left$|right$/i,offsetUnit:/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i},doMethod:function(C,E,D){return this.method(this.currentFrame,E,D-E,this.totalFrames);},setAttribute:function(C,F,E){var D=this.getEl();if(this.patterns.noNegatives.test(C)){F=(F>0)?F:0;}if("style"in D){B.Dom.setStyle(D,C,F+E);}else{if(C in D){D[C]=F;}}},getAttribute:function(C){var E=this.getEl();var G=B.Dom.getStyle(E,C);if(G!=="auto"&&!this.patterns.offsetUnit.test(G)){return parseFloat(G);}var D=this.patterns.offsetAttribute.exec(C)||[];var H=!!(D[3]);var F=!!(D[2]);if("style"in E){if(F||(B.Dom.getStyle(E,"position")=="absolute"&&H)){G=E["offset"+D[0].charAt(0).toUpperCase()+D[0].substr(1)];}else{G=0;}}else{if(C in E){G=E[C];}}return G;},getDefaultUnit:function(C){if(this.patterns.defaultUnit.test(C)){return"px";}return"";},setRuntimeAttribute:function(D){var I;var E;var F=this.attributes;this.runtimeAttributes[D]={};var H=function(J){return(typeof J!=="undefined");};if(!H(F[D]["to"])&&!H(F[D]["by"])){return false;}I=(H(F[D]["from"]))?F[D]["from"]:this.getAttribute(D);if(H(F[D]["to"])){E=F[D]["to"];}else{if(H(F[D]["by"])){if(I.constructor==Array){E=[];for(var G=0,C=I.length;G<C;++G){E[G]=I[G]+F[D]["by"][G]*1;}}else{E=I+F[D]["by"]*1;}}}this.runtimeAttributes[D].start=I;this.runtimeAttributes[D].end=E;this.runtimeAttributes[D].unit=(H(F[D].unit))?F[D]["unit"]:this.getDefaultUnit(D);return true;},init:function(E,J,I,C){var D=false;var F=null;var H=0;E=B.Dom.get(E);this.attributes=J||{};this.duration=!YAHOO.lang.isUndefined(I)?I:1;this.method=C||B.Easing.easeNone;this.useSeconds=true;this.currentFrame=0;this.totalFrames=B.AnimMgr.fps;this.setEl=function(M){E=B.Dom.get(M);};this.getEl=function(){return E;};this.isAnimated=function(){return D;};this.getStartTime=function(){return F;};this.runtimeAttributes={};this.animate=function(){if(this.isAnimated()){return false;}this.currentFrame=0;this.totalFrames=(this.useSeconds)?Math.ceil(B.AnimMgr.fps*this.duration):this.duration;if(this.duration===0&&this.useSeconds){this.totalFrames=1;}B.AnimMgr.registerElement(this);return true;};this.stop=function(M){if(!this.isAnimated()){return false;}if(M){this.currentFrame=this.totalFrames;this._onTween.fire();}B.AnimMgr.stop(this);};var L=function(){this.onStart.fire();this.runtimeAttributes={};for(var M in this.attributes){this.setRuntimeAttribute(M);}D=true;H=0;F=new Date();};var K=function(){var O={duration:new Date()-this.getStartTime(),currentFrame:this.currentFrame};O.toString=function(){return("duration: "+O.duration+", currentFrame: "+O.currentFrame);};this.onTween.fire(O);var N=this.runtimeAttributes;for(var M in N){this.setAttribute(M,this.doMethod(M,N[M].start,N[M].end),N[M].unit);}H+=1;};var G=function(){var M=(new Date()-F)/1000;var N={duration:M,frames:H,fps:H/M};N.toString=function(){return("duration: "+N.duration+", frames: "+N.frames+", fps: "+N.fps);};D=false;H=0;this.onComplete.fire(N);};this._onStart=new B.CustomEvent("_start",this,true);this.onStart=new B.CustomEvent("start",this);this.onTween=new B.CustomEvent("tween",this);this._onTween=new B.CustomEvent("_tween",this,true);this.onComplete=new B.CustomEvent("complete",this);this._onComplete=new B.CustomEvent("_complete",this,true);this._onStart.subscribe(L);this._onTween.subscribe(K);this._onComplete.subscribe(G);}};B.Anim=A;})();YAHOO.util.AnimMgr=new function(){var C=null;var B=[];var A=0;this.fps=1000;this.delay=1;this.registerElement=function(F){B[B.length]=F;A+=1;F._onStart.fire();this.start();};this.unRegister=function(G,F){F=F||E(G);if(!G.isAnimated()||F==-1){return false;}G._onComplete.fire();B.splice(F,1);A-=1;if(A<=0){this.stop();}return true;};this.start=function(){if(C===null){C=setInterval(this.run,this.delay);}};this.stop=function(H){if(!H){clearInterval(C);for(var G=0,F=B.length;G<F;++G){this.unRegister(B[0],0);}B=[];C=null;A=0;}else{this.unRegister(H);}};this.run=function(){for(var H=0,F=B.length;H<F;++H){var G=B[H];if(!G||!G.isAnimated()){continue;}if(G.currentFrame<G.totalFrames||G.totalFrames===null){G.currentFrame+=1;if(G.useSeconds){D(G);}G._onTween.fire();}else{YAHOO.util.AnimMgr.stop(G,H);}}};var E=function(H){for(var G=0,F=B.length;G<F;++G){if(B[G]==H){return G;}}return-1;};var D=function(G){var J=G.totalFrames;var I=G.currentFrame;var H=(G.currentFrame*G.duration*1000/G.totalFrames);var F=(new Date()-G.getStartTime());var K=0;if(F<G.duration*1000){K=Math.round((F/H-1)*G.currentFrame);}else{K=J-(I+1);}if(K>0&&isFinite(K)){if(G.currentFrame+K>=J){K=J-(I+1);}G.currentFrame+=K;}};};YAHOO.util.Bezier=new function(){this.getPosition=function(E,D){var F=E.length;var C=[];for(var B=0;B<F;++B){C[B]=[E[B][0],E[B][1]];}for(var A=1;A<F;++A){for(B=0;B<F-A;++B){C[B][0]=(1-D)*C[B][0]+D*C[parseInt(B+1,10)][0];C[B][1]=(1-D)*C[B][1]+D*C[parseInt(B+1,10)][1];}}return[C[0][0],C[0][1]];};};(function(){var A=function(F,E,G,H){A.superclass.constructor.call(this,F,E,G,H);};A.NAME="ColorAnim";A.DEFAULT_BGCOLOR="#fff";var C=YAHOO.util;YAHOO.extend(A,C.Anim);var D=A.superclass;var B=A.prototype;B.patterns.color=/color$/i;B.patterns.rgb=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i;B.patterns.hex=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i;B.patterns.hex3=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i;B.patterns.transparent=/^transparent|rgba\(0, 0, 0, 0\)$/;B.parseColor=function(E){if(E.length==3){return E;}var F=this.patterns.hex.exec(E);if(F&&F.length==4){return[parseInt(F[1],16),parseInt(F[2],16),parseInt(F[3],16)];}F=this.patterns.rgb.exec(E);if(F&&F.length==4){return[parseInt(F[1],10),parseInt(F[2],10),parseInt(F[3],10)];}F=this.patterns.hex3.exec(E);if(F&&F.length==4){return[parseInt(F[1]+F[1],16),parseInt(F[2]+F[2],16),parseInt(F[3]+F[3],16)];}return null;};B.getAttribute=function(E){var G=this.getEl();if(this.patterns.color.test(E)){var I=YAHOO.util.Dom.getStyle(G,E);var H=this;if(this.patterns.transparent.test(I)){var F=YAHOO.util.Dom.getAncestorBy(G,function(J){return!H.patterns.transparent.test(I);});if(F){I=C.Dom.getStyle(F,E);}else{I=A.DEFAULT_BGCOLOR;}}}else{I=D.getAttribute.call(this,E);}return I;};B.doMethod=function(F,J,G){var I;if(this.patterns.color.test(F)){I=[];for(var H=0,E=J.length;H<E;++H){I[H]=D.doMethod.call(this,F,J[H],G[H]);}I="rgb("+Math.floor(I[0])+","+Math.floor(I[1])+","+Math.floor(I[2])+")";}else{I=D.doMethod.call(this,F,J,G);}return I;};B.setRuntimeAttribute=function(F){D.setRuntimeAttribute.call(this,F);if(this.patterns.color.test(F)){var H=this.attributes;var J=this.parseColor(this.runtimeAttributes[F].start);var G=this.parseColor(this.runtimeAttributes[F].end);if(typeof H[F]["to"]==="undefined"&&typeof H[F]["by"]!=="undefined"){G=this.parseColor(H[F].by);for(var I=0,E=J.length;I<E;++I){G[I]=J[I]+G[I];}}this.runtimeAttributes[F].start=J;this.runtimeAttributes[F].end=G;}};C.ColorAnim=A;})();YAHOO.util.Easing={easeNone:function(B,A,D,C){return D*B/C+A;},easeIn:function(B,A,D,C){return D*(B/=C)*B+A;},easeOut:function(B,A,D,C){return-D*(B/=C)*(B-2)+A;},easeBoth:function(B,A,D,C){if((B/=C/2)<1){return D/2*B*B+A;}return-D/2*((--B)*(B-2)-1)+A;},easeInStrong:function(B,A,D,C){return D*(B/=C)*B*B*B+A;},easeOutStrong:function(B,A,D,C){return-D*((B=B/C-1)*B*B*B-1)+A;},easeBothStrong:function(B,A,D,C){if((B/=C/2)<1){return D/2*B*B*B*B+A;}return-D/2*((B-=2)*B*B*B-2)+A;},elasticIn:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F)==1){return A+G;}if(!E){E=F*0.3;}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}return-(B*Math.pow(2,10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E))+A;},elasticOut:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F)==1){return A+G;}if(!E){E=F*0.3;}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}return B*Math.pow(2,-10*C)*Math.sin((C*F-D)*(2*Math.PI)/E)+G+A;},elasticBoth:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F/2)==2){return A+G;}if(!E){E=F*(0.3*1.5);}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}if(C<1){return-0.5*(B*Math.pow(2,10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E))+A;}return B*Math.pow(2,-10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E)*0.5+G+A;},backIn:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}return E*(B/=D)*B*((C+1)*B-C)+A;},backOut:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}return E*((B=B/D-1)*B*((C+1)*B+C)+1)+A;},backBoth:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}if((B/=D/2)<1){return E/2*(B*B*(((C*=(1.525))+1)*B-C))+A;}return E/2*((B-=2)*B*(((C*=(1.525))+1)*B+C)+2)+A;},bounceIn:function(B,A,D,C){return D-YAHOO.util.Easing.bounceOut(C-B,0,D,C)+A;},bounceOut:function(B,A,D,C){if((B/=C)<(1/2.75)){return D*(7.5625*B*B)+A;}else{if(B<(2/2.75)){return D*(7.5625*(B-=(1.5/2.75))*B+0.75)+A;}else{if(B<(2.5/2.75)){return D*(7.5625*(B-=(2.25/2.75))*B+0.9375)+A;}}}return D*(7.5625*(B-=(2.625/2.75))*B+0.984375)+A;},bounceBoth:function(B,A,D,C){if(B<C/2){return YAHOO.util.Easing.bounceIn(B*2,0,D,C)*0.5+A;}return YAHOO.util.Easing.bounceOut(B*2-C,0,D,C)*0.5+D*0.5+A;}};(function(){var A=function(H,G,I,J){if(H){A.superclass.constructor.call(this,H,G,I,J);}};A.NAME="Motion";var E=YAHOO.util;YAHOO.extend(A,E.ColorAnim);var F=A.superclass;var C=A.prototype;C.patterns.points=/^points$/i;C.setAttribute=function(G,I,H){if(this.patterns.points.test(G)){H=H||"px";F.setAttribute.call(this,"left",I[0],H);F.setAttribute.call(this,"top",I[1],H);}else{F.setAttribute.call(this,G,I,H);}};C.getAttribute=function(G){if(this.patterns.points.test(G)){var H=[F.getAttribute.call(this,"left"),F.getAttribute.call(this,"top")];}else{H=F.getAttribute.call(this,G);}return H;};C.doMethod=function(G,K,H){var J=null;if(this.patterns.points.test(G)){var I=this.method(this.currentFrame,0,100,this.totalFrames)/100;J=E.Bezier.getPosition(this.runtimeAttributes[G],I);}else{J=F.doMethod.call(this,G,K,H);}return J;};C.setRuntimeAttribute=function(P){if(this.patterns.points.test(P)){var H=this.getEl();var J=this.attributes;var G;var L=J["points"]["control"]||[];var I;var M,O;if(L.length>0&&!(L[0]instanceof Array)){L=[L];}else{var K=[];for(M=0,O=L.length;M<O;++M){K[M]=L[M];}L=K;}if(E.Dom.getStyle(H,"position")=="static"){E.Dom.setStyle(H,"position","relative");}if(D(J["points"]["from"])){E.Dom.setXY(H,J["points"]["from"]);}else{E.Dom.setXY(H,E.Dom.getXY(H));}G=this.getAttribute("points");if(D(J["points"]["to"])){I=B.call(this,J["points"]["to"],G);var N=E.Dom.getXY(this.getEl());for(M=0,O=L.length;M<O;++M){L[M]=B.call(this,L[M],G);}}else{if(D(J["points"]["by"])){I=[G[0]+J["points"]["by"][0],G[1]+J["points"]["by"][1]];for(M=0,O=L.length;M<O;++M){L[M]=[G[0]+L[M][0],G[1]+L[M][1]];}}}this.runtimeAttributes[P]=[G];if(L.length>0){this.runtimeAttributes[P]=this.runtimeAttributes[P].concat(L);}this.runtimeAttributes[P][this.runtimeAttributes[P].length]=I;}else{F.setRuntimeAttribute.call(this,P);}};var B=function(G,I){var H=E.Dom.getXY(this.getEl());G=[G[0]-H[0]+I[0],G[1]-H[1]+I[1]];return G;};var D=function(G){return(typeof G!=="undefined");};E.Motion=A;})();(function(){var D=function(F,E,G,H){if(F){D.superclass.constructor.call(this,F,E,G,H);}};D.NAME="Scroll";var B=YAHOO.util;YAHOO.extend(D,B.ColorAnim);var C=D.superclass;var A=D.prototype;A.doMethod=function(E,H,F){var G=null;if(E=="scroll"){G=[this.method(this.currentFrame,H[0],F[0]-H[0],this.totalFrames),this.method(this.currentFrame,H[1],F[1]-H[1],this.totalFrames)];}else{G=C.doMethod.call(this,E,H,F);}return G;};A.getAttribute=function(E){var G=null;var F=this.getEl();if(E=="scroll"){G=[F.scrollLeft,F.scrollTop];}else{G=C.getAttribute.call(this,E);}return G;};A.setAttribute=function(E,H,G){var F=this.getEl();if(E=="scroll"){F.scrollLeft=H[0];F.scrollTop=H[1];}else{C.setAttribute.call(this,E,H,G);}};B.Scroll=D;})();YAHOO.register("animation",YAHOO.util.Anim,{version:"2.7.0",build:"1799"});if(!YAHOO.util.DragDropMgr){YAHOO.util.DragDropMgr=function(){var A=YAHOO.util.Event,B=YAHOO.util.Dom;return{useShim:false,_shimActive:false,_shimState:false,_debugShim:false,_createShim:function(){var C=document.createElement("div");C.id="yui-ddm-shim";if(document.body.firstChild){document.body.insertBefore(C,document.body.firstChild);}else{document.body.appendChild(C);}C.style.display="none";C.style.backgroundColor="red";C.style.position="absolute";C.style.zIndex="99999";B.setStyle(C,"opacity","0");this._shim=C;A.on(C,"mouseup",this.handleMouseUp,this,true);A.on(C,"mousemove",this.handleMouseMove,this,true);A.on(window,"scroll",this._sizeShim,this,true);},_sizeShim:function(){if(this._shimActive){var C=this._shim;C.style.height=B.getDocumentHeight()+"px";C.style.width=B.getDocumentWidth()+"px";C.style.top="0";C.style.left="0";}},_activateShim:function(){if(this.useShim){if(!this._shim){this._createShim();}this._shimActive=true;var C=this._shim,D="0";if(this._debugShim){D=".5";}B.setStyle(C,"opacity",D);this._sizeShim();C.style.display="block";}},_deactivateShim:function(){this._shim.style.display="none";this._shimActive=false;},_shim:null,ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,interactionInfo:null,init:function(){this.initialized=true;},POINT:0,INTERSECT:1,STRICT_INTERSECT:2,mode:0,_execOnAll:function(E,D){for(var F in this.ids){for(var C in this.ids[F]){var G=this.ids[F][C];if(!this.isTypeOfDD(G)){continue;}G[E].apply(G,D);}}},_onLoad:function(){this.init();A.on(document,"mouseup",this.handleMouseUp,this,true);A.on(document,"mousemove",this.handleMouseMove,this,true);A.on(window,"unload",this._onUnload,this,true);A.on(window,"resize",this._onResize,this,true);},_onResize:function(C){this._execOnAll("resetConstraints",[]);},lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isLocked:function(){return this.locked;},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:1000,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,fromTimeout:false,regDragDrop:function(D,C){if(!this.initialized){this.init();}if(!this.ids[C]){this.ids[C]={};}this.ids[C][D.id]=D;},removeDDFromGroup:function(E,C){if(!this.ids[C]){this.ids[C]={};}var D=this.ids[C];if(D&&D[E.id]){delete D[E.id];}},_remove:function(E){for(var D in E.groups){if(D){var C=this.ids[D];if(C&&C[E.id]){delete C[E.id];}}}delete this.handleIds[E.id];},regHandle:function(D,C){if(!this.handleIds[D]){this.handleIds[D]={};}this.handleIds[D][C]=C;},isDragDrop:function(C){return(this.getDDById(C))?true:false;},getRelated:function(H,D){var G=[];for(var F in H.groups){for(var E in this.ids[F]){var C=this.ids[F][E];if(!this.isTypeOfDD(C)){continue;}if(!D||C.isTarget){G[G.length]=C;}}}return G;},isLegalTarget:function(G,F){var D=this.getRelated(G,true);for(var E=0,C=D.length;E<C;++E){if(D[E].id==F.id){return true;}}return false;},isTypeOfDD:function(C){return(C&&C.__ygDragDrop);},isHandle:function(D,C){return(this.handleIds[D]&&this.handleIds[D][C]);},getDDById:function(D){for(var C in this.ids){if(this.ids[C][D]){return this.ids[C][D];}}return null;},handleMouseDown:function(E,D){this.currentTarget=YAHOO.util.Event.getTarget(E);this.dragCurrent=D;var C=D.getEl();this.startX=YAHOO.util.Event.getPageX(E);this.startY=YAHOO.util.Event.getPageY(E);this.deltaX=this.startX-C.offsetLeft;this.deltaY=this.startY-C.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var F=YAHOO.util.DDM;F.startDrag(F.startX,F.startY);F.fromTimeout=true;},this.clickTimeThresh);},startDrag:function(C,E){if(this.dragCurrent&&this.dragCurrent.useShim){this._shimState=this.useShim;this.useShim=true;}this._activateShim();clearTimeout(this.clickTimeout);var D=this.dragCurrent;if(D&&D.events.b4StartDrag){D.b4StartDrag(C,E);D.fireEvent("b4StartDragEvent",{x:C,y:E});}if(D&&D.events.startDrag){D.startDrag(C,E);D.fireEvent("startDragEvent",{x:C,y:E});}this.dragThreshMet=true;},handleMouseUp:function(C){if(this.dragCurrent){clearTimeout(this.clickTimeout);if(this.dragThreshMet){if(this.fromTimeout){this.fromTimeout=false;this.handleMouseMove(C);}this.fromTimeout=false;this.fireEvents(C,true);}else{}this.stopDrag(C);this.stopEvent(C);}},stopEvent:function(C){if(this.stopPropagation){YAHOO.util.Event.stopPropagation(C);}if(this.preventDefault){YAHOO.util.Event.preventDefault(C);}},stopDrag:function(E,D){var C=this.dragCurrent;if(C&&!D){if(this.dragThreshMet){if(C.events.b4EndDrag){C.b4EndDrag(E);C.fireEvent("b4EndDragEvent",{e:E});}if(C.events.endDrag){C.endDrag(E);C.fireEvent("endDragEvent",{e:E});}}if(C.events.mouseUp){C.onMouseUp(E);C.fireEvent("mouseUpEvent",{e:E});}}if(this._shimActive){this._deactivateShim();if(this.dragCurrent&&this.dragCurrent.useShim){this.useShim=this._shimState;this._shimState=false;}}this.dragCurrent=null;this.dragOvers={};},handleMouseMove:function(F){var C=this.dragCurrent;if(C){if(YAHOO.util.Event.isIE&&!F.button){this.stopEvent(F);return this.handleMouseUp(F);}else{if(F.clientX<0||F.clientY<0){}}if(!this.dragThreshMet){var E=Math.abs(this.startX-YAHOO.util.Event.getPageX(F));var D=Math.abs(this.startY-YAHOO.util.Event.getPageY(F));if(E>this.clickPixelThresh||D>this.clickPixelThresh){this.startDrag(this.startX,this.startY);}}if(this.dragThreshMet){if(C&&C.events.b4Drag){C.b4Drag(F);C.fireEvent("b4DragEvent",{e:F});}if(C&&C.events.drag){C.onDrag(F);C.fireEvent("dragEvent",{e:F});}if(C){this.fireEvents(F,false);}}this.stopEvent(F);}},fireEvents:function(V,L){var a=this.dragCurrent;if(!a||a.isLocked()||a.dragOnly){return;}var N=YAHOO.util.Event.getPageX(V),M=YAHOO.util.Event.getPageY(V),P=new YAHOO.util.Point(N,M),K=a.getTargetCoord(P.x,P.y),F=a.getDragEl(),E=["out","over","drop","enter"],U=new YAHOO.util.Region(K.y,K.x+F.offsetWidth,K.y+F.offsetHeight,K.x),I=[],D={},Q=[],c={outEvts:[],overEvts:[],dropEvts:[],enterEvts:[]};for(var S in this.dragOvers){var d=this.dragOvers[S];if(!this.isTypeOfDD(d)){continue;}if(!this.isOverTarget(P,d,this.mode,U)){c.outEvts.push(d);}I[S]=true;delete this.dragOvers[S];}for(var R in a.groups){if("string"!=typeof R){continue;}for(S in this.ids[R]){var G=this.ids[R][S];if(!this.isTypeOfDD(G)){continue;}if(G.isTarget&&!G.isLocked()&&G!=a){if(this.isOverTarget(P,G,this.mode,U)){D[R]=true;if(L){c.dropEvts.push(G);}else{if(!I[G.id]){c.enterEvts.push(G);}else{c.overEvts.push(G);}this.dragOvers[G.id]=G;}}}}}this.interactionInfo={out:c.outEvts,enter:c.enterEvts,over:c.overEvts,drop:c.dropEvts,point:P,draggedRegion:U,sourceRegion:this.locationCache[a.id],validDrop:L};for(var C in D){Q.push(C);}if(L&&!c.dropEvts.length){this.interactionInfo.validDrop=false;if(a.events.invalidDrop){a.onInvalidDrop(V);a.fireEvent("invalidDropEvent",{e:V});}}for(S=0;S<E.length;S++){var Y=null;if(c[E[S]+"Evts"]){Y=c[E[S]+"Evts"];}if(Y&&Y.length){var H=E[S].charAt(0).toUpperCase()+E[S].substr(1),X="onDrag"+H,J="b4Drag"+H,O="drag"+H+"Event",W="drag"+H;if(this.mode){if(a.events[J]){a[J](V,Y,Q);a.fireEvent(J+"Event",{event:V,info:Y,group:Q});}if(a.events[W]){a[X](V,Y,Q);a.fireEvent(O,{event:V,info:Y,group:Q});}}else{for(var Z=0,T=Y.length;Z<T;++Z){if(a.events[J]){a[J](V,Y[Z].id,Q[0]);a.fireEvent(J+"Event",{event:V,info:Y[Z].id,group:Q[0]});}if(a.events[W]){a[X](V,Y[Z].id,Q[0]);a.fireEvent(O,{event:V,info:Y[Z].id,group:Q[0]});}}}}}},getBestMatch:function(E){var G=null;var D=E.length;if(D==1){G=E[0];}else{for(var F=0;F<D;++F){var C=E[F];if(this.mode==this.INTERSECT&&C.cursorIsOver){G=C;break;}else{if(!G||!G.overlap||(C.overlap&&G.overlap.getArea()<C.overlap.getArea())){G=C;}}}}return G;},refreshCache:function(D){var F=D||this.ids;for(var C in F){if("string"!=typeof C){continue;}for(var E in this.ids[C]){var G=this.ids[C][E];if(this.isTypeOfDD(G)){var H=this.getLocation(G);if(H){this.locationCache[G.id]=H;}else{delete this.locationCache[G.id];}}}}},verifyEl:function(D){try{if(D){var C=D.offsetParent;if(C){return true;}}}catch(E){}return false;},getLocation:function(H){if(!this.isTypeOfDD(H)){return null;}var F=H.getEl(),K,E,D,M,L,N,C,J,G;try{K=YAHOO.util.Dom.getXY(F);}catch(I){}if(!K){return null;}E=K[0];D=E+F.offsetWidth;M=K[1];L=M+F.offsetHeight;N=M-H.padding[0];C=D+H.padding[1];J=L+H.padding[2];G=E-H.padding[3];return new YAHOO.util.Region(N,C,J,G);},isOverTarget:function(K,C,E,F){var G=this.locationCache[C.id];if(!G||!this.useCache){G=this.getLocation(C);this.locationCache[C.id]=G;}if(!G){return false;}C.cursorIsOver=G.contains(K);var J=this.dragCurrent;if(!J||(!E&&!J.constrainX&&!J.constrainY)){return C.cursorIsOver;}C.overlap=null;if(!F){var H=J.getTargetCoord(K.x,K.y);var D=J.getDragEl();F=new YAHOO.util.Region(H.y,H.x+D.offsetWidth,H.y+D.offsetHeight,H.x);}var I=F.intersect(G);if(I){C.overlap=I;return(E)?true:C.cursorIsOver;}else{return false;}},_onUnload:function(D,C){this.unregAll();},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null;}this._execOnAll("unreg",[]);this.ids={};},elementCache:{},getElWrapper:function(D){var C=this.elementCache[D];if(!C||!C.el){C=this.elementCache[D]=new this.ElementWrapper(YAHOO.util.Dom.get(D));}return C;},getElement:function(C){return YAHOO.util.Dom.get(C);},getCss:function(D){var C=YAHOO.util.Dom.get(D);return(C)?C.style:null;},ElementWrapper:function(C){this.el=C||null;this.id=this.el&&C.id;this.css=this.el&&C.style;},getPosX:function(C){return YAHOO.util.Dom.getX(C);},getPosY:function(C){return YAHOO.util.Dom.getY(C);},swapNode:function(E,C){if(E.swapNode){E.swapNode(C);}else{var F=C.parentNode;var D=C.nextSibling;if(D==E){F.insertBefore(E,C);}else{if(C==E.nextSibling){F.insertBefore(C,E);}else{E.parentNode.replaceChild(C,E);F.insertBefore(E,D);}}}},getScroll:function(){var E,C,F=document.documentElement,D=document.body;if(F&&(F.scrollTop||F.scrollLeft)){E=F.scrollTop;C=F.scrollLeft;}else{if(D){E=D.scrollTop;C=D.scrollLeft;}else{}}return{top:E,left:C};},getStyle:function(D,C){return YAHOO.util.Dom.getStyle(D,C);},getScrollTop:function(){return this.getScroll().top;},getScrollLeft:function(){return this.getScroll().left;},moveToEl:function(C,E){var D=YAHOO.util.Dom.getXY(E);YAHOO.util.Dom.setXY(C,D);},getClientHeight:function(){return YAHOO.util.Dom.getViewportHeight();},getClientWidth:function(){return YAHOO.util.Dom.getViewportWidth();},numericSort:function(D,C){return(D-C);},_timeoutCount:0,_addListeners:function(){var C=YAHOO.util.DDM;if(YAHOO.util.Event&&document){C._onLoad();}else{if(C._timeoutCount>2000){}else{setTimeout(C._addListeners,10);if(document&&document.body){C._timeoutCount+=1;}}}},handleWasClicked:function(C,E){if(this.isHandle(E,C.id)){return true;}else{var D=C.parentNode;while(D){if(this.isHandle(E,D.id)){return true;}else{D=D.parentNode;}}}return false;}};}();YAHOO.util.DDM=YAHOO.util.DragDropMgr;YAHOO.util.DDM._addListeners();}(function(){var A=YAHOO.util.Event;var B=YAHOO.util.Dom;YAHOO.util.DragDrop=function(E,C,D){if(E){this.init(E,C,D);}};YAHOO.util.DragDrop.prototype={events:null,on:function(){this.subscribe.apply(this,arguments);},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isTarget:true,padding:null,dragOnly:false,useShim:false,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,deltaX:0,deltaY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,cursorIsOver:false,overlap:null,b4StartDrag:function(C,D){},startDrag:function(C,D){},b4Drag:function(C){},onDrag:function(C){},onDragEnter:function(C,D){},b4DragOver:function(C){},onDragOver:function(C,D){},b4DragOut:function(C){},onDragOut:function(C,D){},b4DragDrop:function(C){},onDragDrop:function(C,D){},onInvalidDrop:function(C){},b4EndDrag:function(C){},endDrag:function(C){},b4MouseDown:function(C){},onMouseDown:function(C){},onMouseUp:function(C){},onAvailable:function(){},getEl:function(){if(!this._domRef){this._domRef=B.get(this.id);}return this._domRef;},getDragEl:function(){return B.get(this.dragElId);},init:function(F,C,D){this.initTarget(F,C,D);A.on(this._domRef||this.id,"mousedown",this.handleMouseDown,this,true);for(var E in this.events){this.createEvent(E+"Event");}},initTarget:function(E,C,D){this.config=D||{};this.events={};this.DDM=YAHOO.util.DDM;this.groups={};if(typeof E!=="string"){this._domRef=E;E=B.generateId(E);}this.id=E;this.addToGroup((C)?C:"default");this.handleElId=E;A.onAvailable(E,this.handleOnAvailable,this,true);this.setDragElId(E);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();},applyConfig:function(){this.events={mouseDown:true,b4MouseDown:true,mouseUp:true,b4StartDrag:true,startDrag:true,b4EndDrag:true,endDrag:true,drag:true,b4Drag:true,invalidDrop:true,b4DragOut:true,dragOut:true,dragEnter:true,b4DragOver:true,dragOver:true,b4DragDrop:true,dragDrop:true};if(this.config.events){for(var C in this.config.events){if(this.config.events[C]===false){this.events[C]=false;}}}this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false);this.dragOnly=((this.config.dragOnly===true)?true:false);this.useShim=((this.config.useShim===true)?true:false);},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable();},setPadding:function(E,C,F,D){if(!C&&0!==C){this.padding=[E,E,E,E];}else{if(!F&&0!==F){this.padding=[E,C,E,C];}else{this.padding=[E,C,F,D];}}},setInitPosition:function(F,E){var G=this.getEl();if(!this.DDM.verifyEl(G)){if(G&&G.style&&(G.style.display=="none")){}else{}return;}var D=F||0;var C=E||0;var H=B.getXY(G);this.initPageX=H[0]-D;this.initPageY=H[1]-C;this.lastPageX=H[0];this.lastPageY=H[1];this.setStartPosition(H);},setStartPosition:function(D){var C=D||B.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=C[0];this.startPageY=C[1];},addToGroup:function(C){this.groups[C]=true;this.DDM.regDragDrop(this,C);},removeFromGroup:function(C){if(this.groups[C]){delete this.groups[C];}this.DDM.removeDDFromGroup(this,C);},setDragElId:function(C){this.dragElId=C;},setHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C);}this.handleElId=C;this.DDM.regHandle(this.id,C);},setOuterHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C);}A.on(C,"mousedown",this.handleMouseDown,this,true);this.setHandleElId(C);this.hasOuterHandles=true;},unreg:function(){A.removeListener(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this);},isLocked:function(){return(this.DDM.isLocked()||this.locked);},handleMouseDown:function(J,I){var D=J.which||J.button;if(this.primaryButtonOnly&&D>1){return;}if(this.isLocked()){return;}var C=this.b4MouseDown(J),F=true;if(this.events.b4MouseDown){F=this.fireEvent("b4MouseDownEvent",J);}var E=this.onMouseDown(J),H=true;if(this.events.mouseDown){H=this.fireEvent("mouseDownEvent",J);}if((C===false)||(E===false)||(F===false)||(H===false)){return;}this.DDM.refreshCache(this.groups);var G=new YAHOO.util.Point(A.getPageX(J),A.getPageY(J));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(G,this)){}else{if(this.clickValidator(J)){this.setStartPosition();this.DDM.handleMouseDown(J,this);this.DDM.stopEvent(J);}else{}}},clickValidator:function(D){var C=YAHOO.util.Event.getTarget(D);return(this.isValidHandleChild(C)&&(this.id==this.handleElId||this.DDM.handleWasClicked(C,this.id)));},getTargetCoord:function(E,D){var C=E-this.deltaX;var F=D-this.deltaY;if(this.constrainX){if(C<this.minX){C=this.minX;}if(C>this.maxX){C=this.maxX;}}if(this.constrainY){if(F<this.minY){F=this.minY;}if(F>this.maxY){F=this.maxY;}}C=this.getTick(C,this.xTicks);F=this.getTick(F,this.yTicks);return{x:C,y:F};},addInvalidHandleType:function(C){var D=C.toUpperCase();this.invalidHandleTypes[D]=D;},addInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C);}this.invalidHandleIds[C]=C;},addInvalidHandleClass:function(C){this.invalidHandleClasses.push(C);},removeInvalidHandleType:function(C){var D=C.toUpperCase();delete this.invalidHandleTypes[D];},removeInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C);}delete this.invalidHandleIds[C];},removeInvalidHandleClass:function(D){for(var E=0,C=this.invalidHandleClasses.length;E<C;++E){if(this.invalidHandleClasses[E]==D){delete this.invalidHandleClasses[E];}}},isValidHandleChild:function(F){var E=true;var H;try{H=F.nodeName.toUpperCase();}catch(G){H=F.nodeName;}E=E&&!this.invalidHandleTypes[H];E=E&&!this.invalidHandleIds[F.id];for(var D=0,C=this.invalidHandleClasses.length;E&&D<C;++D){E=!B.hasClass(F,this.invalidHandleClasses[D]);}return E;},setXTicks:function(F,C){this.xTicks=[];this.xTickSize=C;var E={};for(var D=this.initPageX;D>=this.minX;D=D-C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true;}}for(D=this.initPageX;D<=this.maxX;D=D+C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true;}}this.xTicks.sort(this.DDM.numericSort);},setYTicks:function(F,C){this.yTicks=[];this.yTickSize=C;var E={};for(var D=this.initPageY;D>=this.minY;D=D-C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true;}}for(D=this.initPageY;D<=this.maxY;D=D+C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true;}}this.yTicks.sort(this.DDM.numericSort);},setXConstraint:function(E,D,C){this.leftConstraint=parseInt(E,10);this.rightConstraint=parseInt(D,10);this.minX=this.initPageX-this.leftConstraint;this.maxX=this.initPageX+this.rightConstraint;if(C){this.setXTicks(this.initPageX,C);}this.constrainX=true;},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks();},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0;},setYConstraint:function(C,E,D){this.topConstraint=parseInt(C,10);this.bottomConstraint=parseInt(E,10);this.minY=this.initPageY-this.topConstraint;this.maxY=this.initPageY+this.bottomConstraint;if(D){this.setYTicks(this.initPageY,D);}this.constrainY=true;},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var D=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var C=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(D,C);}else{this.setInitPosition();}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize);}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize);}},getTick:function(I,F){if(!F){return I;}else{if(F[0]>=I){return F[0];}else{for(var D=0,C=F.length;D<C;++D){var E=D+1;if(F[E]&&F[E]>=I){var H=I-F[D];var G=F[E]-I;return(G>H)?F[D]:F[E];}}return F[F.length-1];}}},toString:function(){return("DragDrop "+this.id);}};YAHOO.augment(YAHOO.util.DragDrop,YAHOO.util.EventProvider);})();YAHOO.util.DD=function(C,A,B){if(C){this.init(C,A,B);}};YAHOO.extend(YAHOO.util.DD,YAHOO.util.DragDrop,{scroll:true,autoOffset:function(C,B){var A=C-this.startPageX;var D=B-this.startPageY;this.setDelta(A,D);},setDelta:function(B,A){this.deltaX=B;this.deltaY=A;},setDragElPos:function(C,B){var A=this.getDragEl();this.alignElWithMouse(A,C,B);},alignElWithMouse:function(C,G,F){var E=this.getTargetCoord(G,F);if(!this.deltaSetXY){var H=[E.x,E.y];YAHOO.util.Dom.setXY(C,H);var D=parseInt(YAHOO.util.Dom.getStyle(C,"left"),10);var B=parseInt(YAHOO.util.Dom.getStyle(C,"top"),10);this.deltaSetXY=[D-E.x,B-E.y];}else{YAHOO.util.Dom.setStyle(C,"left",(E.x+this.deltaSetXY[0])+"px");YAHOO.util.Dom.setStyle(C,"top",(E.y+this.deltaSetXY[1])+"px");}this.cachePosition(E.x,E.y);var A=this;setTimeout(function(){A.autoScroll.call(A,E.x,E.y,C.offsetHeight,C.offsetWidth);},0);},cachePosition:function(B,A){if(B){this.lastPageX=B;this.lastPageY=A;}else{var C=YAHOO.util.Dom.getXY(this.getEl());this.lastPageX=C[0];this.lastPageY=C[1];}},autoScroll:function(J,I,E,K){if(this.scroll){var L=this.DDM.getClientHeight();var B=this.DDM.getClientWidth();var N=this.DDM.getScrollTop();var D=this.DDM.getScrollLeft();var H=E+I;var M=K+J;var G=(L+N-I-this.deltaY);var F=(B+D-J-this.deltaX);var C=40;var A=(document.all)?80:30;if(H>L&&G<C){window.scrollTo(D,N+A);}if(I<N&&N>0&&I-N<C){window.scrollTo(D,N-A);}if(M>B&&F<C){window.scrollTo(D+A,N);}if(J<D&&D>0&&J-D<C){window.scrollTo(D-A,N);}}},applyConfig:function(){YAHOO.util.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false);},b4MouseDown:function(A){this.setStartPosition();this.autoOffset(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A));},b4Drag:function(A){this.setDragElPos(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A));},toString:function(){return("DD "+this.id);}});YAHOO.util.DDProxy=function(C,A,B){if(C){this.init(C,A,B);this.initFrame();}};YAHOO.util.DDProxy.dragElId="ygddfdiv";YAHOO.extend(YAHOO.util.DDProxy,YAHOO.util.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var B=this,A=document.body;if(!A||!A.firstChild){setTimeout(function(){B.createFrame();},50);return;}var F=this.getDragEl(),E=YAHOO.util.Dom;if(!F){F=document.createElement("div");F.id=this.dragElId;var D=F.style;D.position="absolute";D.visibility="hidden";D.cursor="move";D.border="2px solid #aaa";D.zIndex=999;D.height="25px";D.width="25px";var C=document.createElement("div");E.setStyle(C,"height","100%");E.setStyle(C,"width","100%");E.setStyle(C,"background-color","#ccc");E.setStyle(C,"opacity","0");F.appendChild(C);A.insertBefore(F,A.firstChild);}},initFrame:function(){this.createFrame();},applyConfig:function(){YAHOO.util.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||YAHOO.util.DDProxy.dragElId);},showFrame:function(E,D){var C=this.getEl();var A=this.getDragEl();var B=A.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(B.width,10)/2),Math.round(parseInt(B.height,10)/2));}this.setDragElPos(E,D);YAHOO.util.Dom.setStyle(A,"visibility","visible");},_resizeProxy:function(){if(this.resizeFrame){var H=YAHOO.util.Dom;var B=this.getEl();var C=this.getDragEl();var G=parseInt(H.getStyle(C,"borderTopWidth"),10);var I=parseInt(H.getStyle(C,"borderRightWidth"),10);var F=parseInt(H.getStyle(C,"borderBottomWidth"),10);var D=parseInt(H.getStyle(C,"borderLeftWidth"),10);if(isNaN(G)){G=0;}if(isNaN(I)){I=0;}if(isNaN(F)){F=0;}if(isNaN(D)){D=0;}var E=Math.max(0,B.offsetWidth-I-D);var A=Math.max(0,B.offsetHeight-G-F);H.setStyle(C,"width",E+"px");H.setStyle(C,"height",A+"px");}},b4MouseDown:function(B){this.setStartPosition();var A=YAHOO.util.Event.getPageX(B);var C=YAHOO.util.Event.getPageY(B);this.autoOffset(A,C);},b4StartDrag:function(A,B){this.showFrame(A,B);},b4EndDrag:function(A){YAHOO.util.Dom.setStyle(this.getDragEl(),"visibility","hidden");},endDrag:function(D){var C=YAHOO.util.Dom;var B=this.getEl();var A=this.getDragEl();C.setStyle(A,"visibility","");C.setStyle(B,"visibility","hidden");YAHOO.util.DDM.moveToEl(B,A);C.setStyle(A,"visibility","hidden");C.setStyle(B,"visibility","");},toString:function(){return("DDProxy "+this.id);}});YAHOO.util.DDTarget=function(C,A,B){if(C){this.initTarget(C,A,B);}};YAHOO.extend(YAHOO.util.DDTarget,YAHOO.util.DragDrop,{toString:function(){return("DDTarget "+this.id);}});YAHOO.register("dragdrop",YAHOO.util.DragDropMgr,{version:"2.7.0",build:"1799"});YAHOO.util.Attribute=function(B,A){if(A){this.owner=A;this.configure(B,true);}};YAHOO.util.Attribute.prototype={name:undefined,value:null,owner:null,readOnly:false,writeOnce:false,_initialConfig:null,_written:false,method:null,setter:null,getter:null,validator:null,getValue:function(){var A=this.value;if(this.getter){A=this.getter.call(this.owner,this.name);}return A;},setValue:function(F,B){var E,A=this.owner,C=this.name;var D={type:C,prevValue:this.getValue(),newValue:F};if(this.readOnly||(this.writeOnce&&this._written)){return false;}if(this.validator&&!this.validator.call(A,F)){return false;}if(!B){E=A.fireBeforeChangeEvent(D);if(E===false){return false;}}if(this.setter){F=this.setter.call(A,F,this.name);if(F===undefined){}}if(this.method){this.method.call(A,F,this.name);}this.value=F;this._written=true;D.type=C;if(!B){this.owner.fireChangeEvent(D);}return true;},configure:function(B,C){B=B||{};if(C){this._written=false;}this._initialConfig=this._initialConfig||{};for(var A in B){if(B.hasOwnProperty(A)){this[A]=B[A];if(C){this._initialConfig[A]=B[A];}}}},resetValue:function(){return this.setValue(this._initialConfig.value);},resetConfig:function(){this.configure(this._initialConfig,true);},refresh:function(A){this.setValue(this.value,A);}};(function(){var A=YAHOO.util.Lang;YAHOO.util.AttributeProvider=function(){};YAHOO.util.AttributeProvider.prototype={_configs:null,get:function(C){this._configs=this._configs||{};var B=this._configs[C];if(!B||!this._configs.hasOwnProperty(C)){return null;}return B.getValue();},set:function(D,E,B){this._configs=this._configs||{};var C=this._configs[D];if(!C){return false;}return C.setValue(E,B);},getAttributeKeys:function(){this._configs=this._configs;var C=[],B;for(B in this._configs){if(A.hasOwnProperty(this._configs,B)&&!A.isUndefined(this._configs[B])){C[C.length]=B;}}return C;},setAttributes:function(D,B){for(var C in D){if(A.hasOwnProperty(D,C)){this.set(C,D[C],B);}}},resetValue:function(C,B){this._configs=this._configs||{};if(this._configs[C]){this.set(C,this._configs[C]._initialConfig.value,B);return true;}return false;},refresh:function(E,C){this._configs=this._configs||{};var F=this._configs;E=((A.isString(E))?[E]:E)||this.getAttributeKeys();for(var D=0,B=E.length;D<B;++D){if(F.hasOwnProperty(E[D])){this._configs[E[D]].refresh(C);}}},register:function(B,C){this.setAttributeConfig(B,C);},getAttributeConfig:function(C){this._configs=this._configs||{};var B=this._configs[C]||{};var D={};for(C in B){if(A.hasOwnProperty(B,C)){D[C]=B[C];}}return D;},setAttributeConfig:function(B,C,D){this._configs=this._configs||{};C=C||{};if(!this._configs[B]){C.name=B;this._configs[B]=this.createAttribute(C);}else{this._configs[B].configure(C,D);}},configureAttribute:function(B,C,D){this.setAttributeConfig(B,C,D);},resetAttributeConfig:function(B){this._configs=this._configs||{};this._configs[B].resetConfig();},subscribe:function(B,C){this._events=this._events||{};if(!(B in this._events)){this._events[B]=this.createEvent(B);}YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){this.subscribe.apply(this,arguments);},addListener:function(){this.subscribe.apply(this,arguments);},fireBeforeChangeEvent:function(C){var B="before";B+=C.type.charAt(0).toUpperCase()+C.type.substr(1)+"Change";C.type=B;return this.fireEvent(C.type,C);},fireChangeEvent:function(B){B.type+="Change";return this.fireEvent(B.type,B);},createAttribute:function(B){return new YAHOO.util.Attribute(B,this);}};YAHOO.augment(YAHOO.util.AttributeProvider,YAHOO.util.EventProvider);})();(function(){var B=YAHOO.util.Dom,C=YAHOO.util.AttributeProvider;var A=function(D,E){this.init.apply(this,arguments);};A.DOM_EVENTS={"click":true,"dblclick":true,"keydown":true,"keypress":true,"keyup":true,"mousedown":true,"mousemove":true,"mouseout":true,"mouseover":true,"mouseup":true,"focus":true,"blur":true,"submit":true,"change":true};A.prototype={DOM_EVENTS:null,DEFAULT_HTML_SETTER:function(F,D){var E=this.get("element");if(E){E[D]=F;}},DEFAULT_HTML_GETTER:function(D){var E=this.get("element"),F;if(E){F=E[D];}return F;},appendChild:function(D){D=D.get?D.get("element"):D;return this.get("element").appendChild(D);},getElementsByTagName:function(D){return this.get("element").getElementsByTagName(D);},hasChildNodes:function(){return this.get("element").hasChildNodes();},insertBefore:function(D,E){D=D.get?D.get("element"):D;E=(E&&E.get)?E.get("element"):E;return this.get("element").insertBefore(D,E);},removeChild:function(D){D=D.get?D.get("element"):D;return this.get("element").removeChild(D);},replaceChild:function(D,E){D=D.get?D.get("element"):D;E=E.get?E.get("element"):E;return this.get("element").replaceChild(D,E);},initAttributes:function(D){},addListener:function(H,G,I,F){var E=this.get("element")||this.get("id");F=F||this;var D=this;if(!this._events[H]){if(E&&this.DOM_EVENTS[H]){YAHOO.util.Event.addListener(E,H,function(J){if(J.srcElement&&!J.target){J.target=J.srcElement;}D.fireEvent(H,J);},I,F);}this.createEvent(H,this);}return YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){return this.addListener.apply(this,arguments);},subscribe:function(){return this.addListener.apply(this,arguments);},removeListener:function(E,D){return this.unsubscribe.apply(this,arguments);},addClass:function(D){B.addClass(this.get("element"),D);},getElementsByClassName:function(E,D){return B.getElementsByClassName(E,D,this.get("element"));},hasClass:function(D){return B.hasClass(this.get("element"),D);},removeClass:function(D){return B.removeClass(this.get("element"),D);},replaceClass:function(E,D){return B.replaceClass(this.get("element"),E,D);},setStyle:function(E,D){return B.setStyle(this.get("element"),E,D);},getStyle:function(D){return B.getStyle(this.get("element"),D);},fireQueue:function(){var E=this._queue;for(var F=0,D=E.length;F<D;++F){this[E[F][0]].apply(this,E[F][1]);}},appendTo:function(E,F){E=(E.get)?E.get("element"):B.get(E);this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:E});F=(F&&F.get)?F.get("element"):B.get(F);var D=this.get("element");if(!D){return false;}if(!E){return false;}if(D.parent!=E){if(F){E.insertBefore(D,F);}else{E.appendChild(D);}}this.fireEvent("appendTo",{type:"appendTo",target:E});return D;},get:function(D){var F=this._configs||{},E=F.element;if(E&&!F[D]&&!YAHOO.lang.isUndefined(E.value[D])){this._setHTMLAttrConfig(D);}return C.prototype.get.call(this,D);},setAttributes:function(J,G){var E={},H=this._configOrder;for(var I=0,D=H.length;I<D;++I){if(J[H[I]]!==undefined){E[H[I]]=true;this.set(H[I],J[H[I]],G);}}for(var F in J){if(J.hasOwnProperty(F)&&!E[F]){this.set(F,J[F],G);}}},set:function(E,G,D){var F=this.get("element");if(!F){this._queue[this._queue.length]=["set",arguments];if(this._configs[E]){this._configs[E].value=G;}return;}if(!this._configs[E]&&!YAHOO.lang.isUndefined(F[E])){this._setHTMLAttrConfig(E);}return C.prototype.set.apply(this,arguments);},setAttributeConfig:function(D,E,F){this._configOrder.push(D);C.prototype.setAttributeConfig.apply(this,arguments);},createEvent:function(E,D){this._events[E]=true;return C.prototype.createEvent.apply(this,arguments);},init:function(E,D){this._initElement(E,D);},destroy:function(){var D=this.get("element");YAHOO.util.Event.purgeElement(D,true);this.unsubscribeAll();if(D&&D.parentNode){D.parentNode.removeChild(D);}this._queue=[];this._events={};this._configs={};this._configOrder=[];},_initElement:function(F,E){this._queue=this._queue||[];this._events=this._events||{};this._configs=this._configs||{};this._configOrder=[];E=E||{};E.element=E.element||F||null;var H=false;var D=A.DOM_EVENTS;this.DOM_EVENTS=this.DOM_EVENTS||{};for(var G in D){if(D.hasOwnProperty(G)){this.DOM_EVENTS[G]=D[G];}}if(typeof E.element==="string"){this._setHTMLAttrConfig("id",{value:E.element});}if(B.get(E.element)){H=true;this._initHTMLElement(E);this._initContent(E);}YAHOO.util.Event.onAvailable(E.element,function(){if(!H){this._initHTMLElement(E);}this.fireEvent("available",{type:"available",target:B.get(E.element)});},this,true);YAHOO.util.Event.onContentReady(E.element,function(){if(!H){this._initContent(E);}this.fireEvent("contentReady",{type:"contentReady",target:B.get(E.element)});},this,true);},_initHTMLElement:function(D){this.setAttributeConfig("element",{value:B.get(D.element),readOnly:true});},_initContent:function(D){this.initAttributes(D);this.setAttributes(D,true);this.fireQueue();},_setHTMLAttrConfig:function(D,F){var E=this.get("element");F=F||{};F.name=D;F.setter=F.setter||this.DEFAULT_HTML_SETTER;F.getter=F.getter||this.DEFAULT_HTML_GETTER;F.value=F.value||E[D];this._configs[D]=new YAHOO.util.Attribute(F,this);}};YAHOO.augment(A,C);YAHOO.util.Element=A;})();YAHOO.register("element",YAHOO.util.Element,{version:"2.7.0",build:"1799"});YAHOO.register("utilities",YAHOO,{version:"2.7.0",build:"1799"});
/* ========== ../flot/excanvas.js ============ */

if(!document.createElement('canvas').getContext){(function(){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var abs=m.abs;var sqrt=m.sqrt;var Z=10;var Z2=Z/2;function getContext(){return this.context_||(this.context_=new CanvasRenderingContext2D_(this));}
var slice=Array.prototype.slice;function bind(f,obj,var_args){var a=slice.call(arguments,2);return function(){return f.apply(obj,a.concat(slice.call(arguments)));};}
function encodeHtmlAttribute(s){return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;');}
function addNamespacesAndStylesheet(doc){if(!doc.namespaces['g_vml_']){doc.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!doc.namespaces['g_o_']){doc.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}
if(!doc.styleSheets['ex_canvas_']){var ss=doc.createStyleSheet();ss.owningElement.id='ex_canvas_';ss.cssText='canvas{display:inline-block;overflow:hidden;'+'text-align:left;width:300px;height:150px}';}}
addNamespacesAndStylesheet(document);var G_vmlCanvasManager_={init:function(opt_doc){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var doc=opt_doc||document;doc.createElement('canvas');doc.attachEvent('onreadystatechange',bind(this.init_,this,doc));}},init_:function(doc){var els=doc.getElementsByTagName('canvas');for(var i=0;i<els.length;i++){this.initElement(els[i]);}},initElement:function(el){if(!el.getContext){el.getContext=getContext;addNamespacesAndStylesheet(el.ownerDocument);el.innerHTML='';el.attachEvent('onpropertychange',onPropertyChange);el.attachEvent('onresize',onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+'px';}else{el.width=el.clientWidth;}
if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+'px';}else{el.height=el.clientHeight;}}
return el;}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case'width':el.getContext().clearRect();el.style.width=el.attributes.width.nodeValue+'px';el.firstChild.style.width=el.clientWidth+'px';break;case'height':el.getContext().clearRect();el.style.height=el.attributes.height.nodeValue+'px';el.firstChild.style.height=el.clientHeight+'px';break;}}
function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+'px';el.firstChild.style.height=el.clientHeight+'px';}}
G_vmlCanvasManager_.init();var decToHex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){decToHex[i*16+j]=i.toString(16)+j.toString(16);}}
function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]];}
function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y];}
result[x][y]=sum;}}
return result;}
function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.globalAlpha=o1.globalAlpha;o2.font=o1.font;o2.textAlign=o1.textAlign;o2.textBaseline=o1.textBaseline;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;o2.lineScale_=o1.lineScale_;}
var colorData={aliceblue:'#F0F8FF',antiquewhite:'#FAEBD7',aquamarine:'#7FFFD4',azure:'#F0FFFF',beige:'#F5F5DC',bisque:'#FFE4C4',black:'#000000',blanchedalmond:'#FFEBCD',blueviolet:'#8A2BE2',brown:'#A52A2A',burlywood:'#DEB887',cadetblue:'#5F9EA0',chartreuse:'#7FFF00',chocolate:'#D2691E',coral:'#FF7F50',cornflowerblue:'#6495ED',cornsilk:'#FFF8DC',crimson:'#DC143C',cyan:'#00FFFF',darkblue:'#00008B',darkcyan:'#008B8B',darkgoldenrod:'#B8860B',darkgray:'#A9A9A9',darkgreen:'#006400',darkgrey:'#A9A9A9',darkkhaki:'#BDB76B',darkmagenta:'#8B008B',darkolivegreen:'#556B2F',darkorange:'#FF8C00',darkorchid:'#9932CC',darkred:'#8B0000',darksalmon:'#E9967A',darkseagreen:'#8FBC8F',darkslateblue:'#483D8B',darkslategray:'#2F4F4F',darkslategrey:'#2F4F4F',darkturquoise:'#00CED1',darkviolet:'#9400D3',deeppink:'#FF1493',deepskyblue:'#00BFFF',dimgray:'#696969',dimgrey:'#696969',dodgerblue:'#1E90FF',firebrick:'#B22222',floralwhite:'#FFFAF0',forestgreen:'#228B22',gainsboro:'#DCDCDC',ghostwhite:'#F8F8FF',gold:'#FFD700',goldenrod:'#DAA520',grey:'#808080',greenyellow:'#ADFF2F',honeydew:'#F0FFF0',hotpink:'#FF69B4',indianred:'#CD5C5C',indigo:'#4B0082',ivory:'#FFFFF0',khaki:'#F0E68C',lavender:'#E6E6FA',lavenderblush:'#FFF0F5',lawngreen:'#7CFC00',lemonchiffon:'#FFFACD',lightblue:'#ADD8E6',lightcoral:'#F08080',lightcyan:'#E0FFFF',lightgoldenrodyellow:'#FAFAD2',lightgreen:'#90EE90',lightgrey:'#D3D3D3',lightpink:'#FFB6C1',lightsalmon:'#FFA07A',lightseagreen:'#20B2AA',lightskyblue:'#87CEFA',lightslategray:'#778899',lightslategrey:'#778899',lightsteelblue:'#B0C4DE',lightyellow:'#FFFFE0',limegreen:'#32CD32',linen:'#FAF0E6',magenta:'#FF00FF',mediumaquamarine:'#66CDAA',mediumblue:'#0000CD',mediumorchid:'#BA55D3',mediumpurple:'#9370DB',mediumseagreen:'#3CB371',mediumslateblue:'#7B68EE',mediumspringgreen:'#00FA9A',mediumturquoise:'#48D1CC',mediumvioletred:'#C71585',midnightblue:'#191970',mintcream:'#F5FFFA',mistyrose:'#FFE4E1',moccasin:'#FFE4B5',navajowhite:'#FFDEAD',oldlace:'#FDF5E6',olivedrab:'#6B8E23',orange:'#FFA500',orangered:'#FF4500',orchid:'#DA70D6',palegoldenrod:'#EEE8AA',palegreen:'#98FB98',paleturquoise:'#AFEEEE',palevioletred:'#DB7093',papayawhip:'#FFEFD5',peachpuff:'#FFDAB9',peru:'#CD853F',pink:'#FFC0CB',plum:'#DDA0DD',powderblue:'#B0E0E6',rosybrown:'#BC8F8F',royalblue:'#4169E1',saddlebrown:'#8B4513',salmon:'#FA8072',sandybrown:'#F4A460',seagreen:'#2E8B57',seashell:'#FFF5EE',sienna:'#A0522D',skyblue:'#87CEEB',slateblue:'#6A5ACD',slategray:'#708090',slategrey:'#708090',snow:'#FFFAFA',springgreen:'#00FF7F',steelblue:'#4682B4',tan:'#D2B48C',thistle:'#D8BFD8',tomato:'#FF6347',turquoise:'#40E0D0',violet:'#EE82EE',wheat:'#F5DEB3',whitesmoke:'#F5F5F5',yellowgreen:'#9ACD32'};function getRgbHslContent(styleString){var start=styleString.indexOf('(',3);var end=styleString.indexOf(')',start+1);var parts=styleString.substring(start+1,end).split(',');if(parts.length==4&&styleString.substr(3,1)=='a'){alpha=Number(parts[3]);}else{parts[3]=1;}
return parts;}
function percent(s){return parseFloat(s)/100;}
function clamp(v,min,max){return Math.min(max,Math.max(min,v));}
function hslToRgb(parts){var r,g,b;h=parseFloat(parts[0])/360%360;if(h<0)
h++;s=clamp(percent(parts[1]),0,1);l=clamp(percent(parts[2]),0,1);if(s==0){r=g=b=l;}else{var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hueToRgb(p,q,h+1/3);g=hueToRgb(p,q,h);b=hueToRgb(p,q,h-1/3);}
return'#'+decToHex[Math.floor(r*255)]+
decToHex[Math.floor(g*255)]+
decToHex[Math.floor(b*255)];}
function hueToRgb(m1,m2,h){if(h<0)
h++;if(h>1)
h--;if(6*h<1)
return m1+(m2-m1)*6*h;else if(2*h<1)
return m2;else if(3*h<2)
return m1+(m2-m1)*(2/3-h)*6;else
return m1;}
function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.charAt(0)=='#'){str=styleString;}else if(/^rgb/.test(styleString)){var parts=getRgbHslContent(styleString);var str='#',n;for(var i=0;i<3;i++){if(parts[i].indexOf('%')!=-1){n=Math.floor(percent(parts[i])*255);}else{n=Number(parts[i]);}
str+=decToHex[clamp(n,0,255)];}
alpha=parts[3];}else if(/^hsl/.test(styleString)){var parts=getRgbHslContent(styleString);str=hslToRgb(parts);alpha=parts[3];}else{str=colorData[styleString]||styleString;}
return{color:str,alpha:alpha};}
var DEFAULT_STYLE={style:'normal',variant:'normal',weight:'normal',size:10,family:'sans-serif'};var fontStyleCache={};function processFontStyle(styleString){if(fontStyleCache[styleString]){return fontStyleCache[styleString];}
var el=document.createElement('div');var style=el.style;try{style.font=styleString;}catch(ex){}
return fontStyleCache[styleString]={style:style.fontStyle||DEFAULT_STYLE.style,variant:style.fontVariant||DEFAULT_STYLE.variant,weight:style.fontWeight||DEFAULT_STYLE.weight,size:style.fontSize||DEFAULT_STYLE.size,family:style.fontFamily||DEFAULT_STYLE.family};}
function getComputedStyle(style,element){var computedStyle={};for(var p in style){computedStyle[p]=style[p];}
var canvasFontSize=parseFloat(element.currentStyle.fontSize),fontSize=parseFloat(style.size);if(typeof style.size=='number'){computedStyle.size=style.size;}else if(style.size.indexOf('px')!=-1){computedStyle.size=fontSize;}else if(style.size.indexOf('em')!=-1){computedStyle.size=canvasFontSize*fontSize;}else if(style.size.indexOf('%')!=-1){computedStyle.size=(canvasFontSize/100)*fontSize;}else if(style.size.indexOf('pt')!=-1){computedStyle.size=fontSize/.75;}else{computedStyle.size=canvasFontSize;}
computedStyle.size*=0.981;return computedStyle;}
function buildStyle(style){return style.style+' '+style.variant+' '+style.weight+' '+
style.size+'px '+style.family;}
function processLineCap(lineCap){switch(lineCap){case'butt':return'flat';case'round':return'round';case'square':default:return'square';}}
function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle='#000';this.fillStyle='#000';this.lineWidth=1;this.lineJoin='miter';this.lineCap='butt';this.miterLimit=Z*1;this.globalAlpha=1;this.font='10px sans-serif';this.textAlign='left';this.textBaseline='alphabetic';this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement('div');el.style.width=surfaceElement.clientWidth+'px';el.style.height=surfaceElement.clientHeight+'px';el.style.overflow='hidden';el.style.position='absolute';surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1;}
var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);this.textMeasureEl_=null;}
this.element_.innerHTML='';};contextPrototype.beginPath=function(){this.currentPath_=[];};contextPrototype.moveTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'moveTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.lineTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'lineTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var p=this.getCoords_(aX,aY);var cp1=this.getCoords_(aCP1x,aCP1y);var cp2=this.getCoords_(aCP2x,aCP2y);bezierCurveTo(this,cp1,cp2,p);};function bezierCurveTo(self,cp1,cp2,p){self.currentPath_.push({type:'bezierCurveTo',cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y});self.currentX_=p.x;self.currentY_=p.y;}
contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp=this.getCoords_(aCPx,aCPy);var p=this.getCoords_(aX,aY);var cp1={x:this.currentX_+2.0/3.0*(cp.x-this.currentX_),y:this.currentY_+2.0/3.0*(cp.y-this.currentY_)};var cp2={x:cp1.x+(p.x-this.currentX_)/3.0,y:cp1.y+(p.y-this.currentY_)/3.0};bezierCurveTo(this,cp1,cp2,p);};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?'at':'wa';var xStart=aX+mc(aStartAngle)*aRadius-Z2;var yStart=aY+ms(aStartAngle)*aRadius-Z2;var xEnd=aX+mc(aEndAngle)*aRadius-Z2;var yEnd=aY+ms(aEndAngle)*aRadius-Z2;if(xStart==xEnd&&!aClockwise){xStart+=0.125;}
var p=this.getCoords_(aX,aY);var pStart=this.getCoords_(xStart,yStart);var pEnd=this.getCoords_(xEnd,yEnd);this.currentPath_.push({type:arcType,x:p.x,y:p.y,radius:aRadius,xStart:pStart.x,yStart:pStart.y,xEnd:pEnd.x,yEnd:pEnd.y});};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){var oldPath=this.currentPath_;this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();this.currentPath_=oldPath;};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){var oldPath=this.currentPath_;this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();this.currentPath_=oldPath;};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_('gradient');gradient.x0_=aX0;gradient.y0_=aY0;gradient.x1_=aX1;gradient.y1_=aY1;return gradient;};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_('gradientradial');gradient.x0_=aX0;gradient.y0_=aY0;gradient.r0_=aR0;gradient.x1_=aX1;gradient.y1_=aY1;gradient.r1_=aR1;return gradient;};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width='auto';image.runtimeStyle.height='auto';var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h;}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h;}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8];}else{throw Error('Invalid number of arguments');}
var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(' <g_vml_:group',' coordsize="',Z*W,',',Z*H,'"',' coordorigin="0,0"',' style="width:',W,'px;height:',H,'px;position:absolute;');if(this.m_[0][0]!=1||this.m_[0][1]||this.m_[1][1]!=1||this.m_[1][0]){var filter=[];filter.push('M11=',this.m_[0][0],',','M12=',this.m_[1][0],',','M21=',this.m_[0][1],',','M22=',this.m_[1][1],',','Dx=',mr(d.x/Z),',','Dy=',mr(d.y/Z),'');var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);vmlStr.push('padding:0 ',mr(max.x/Z),'px ',mr(max.y/Z),'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',filter.join(''),", sizingmethod='clip');");}else{vmlStr.push('top:',mr(d.y/Z),'px;left:',mr(d.x/Z),'px;');}
vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,'px;',' height:',Z*dh,'px"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"',' />','</g_vml_:group>');this.element_.insertAdjacentHTML('BeforeEnd',vmlStr.join(''));};contextPrototype.stroke=function(aFill){var W=10;var H=10;var chunkSize=5000;var min={x:null,y:null};var max={x:null,y:null};for(var j=0;j<this.currentPath_.length;j+=chunkSize){var lineStr=[];var lineOpen=false;lineStr.push('<g_vml_:shape',' filled="',!!aFill,'"',' style="position:absolute;width:',W,'px;height:',H,'px;"',' coordorigin="0,0"',' coordsize="',Z*W,',',Z*H,'"',' stroked="',!aFill,'"',' path="');var newSeq=false;for(var i=j;i<Math.min(j+chunkSize,this.currentPath_.length);i++){if(i%chunkSize==0&&i>0){lineStr.push(' m ',mr(this.currentPath_[i-1].x),',',mr(this.currentPath_[i-1].y));}
var p=this.currentPath_[i];var c;switch(p.type){case'moveTo':c=p;lineStr.push(' m ',mr(p.x),',',mr(p.y));break;case'lineTo':lineStr.push(' l ',mr(p.x),',',mr(p.y));break;case'close':lineStr.push(' x ');p=null;break;case'bezierCurveTo':lineStr.push(' c ',mr(p.cp1x),',',mr(p.cp1y),',',mr(p.cp2x),',',mr(p.cp2y),',',mr(p.x),',',mr(p.y));break;case'at':case'wa':lineStr.push(' ',p.type,' ',mr(p.x-this.arcScaleX_*p.radius),',',mr(p.y-this.arcScaleY_*p.radius),' ',mr(p.x+this.arcScaleX_*p.radius),',',mr(p.y+this.arcScaleY_*p.radius),' ',mr(p.xStart),',',mr(p.yStart),' ',mr(p.xEnd),',',mr(p.yEnd));break;}
if(p){if(min.x==null||p.x<min.x){min.x=p.x;}
if(max.x==null||p.x>max.x){max.x=p.x;}
if(min.y==null||p.y<min.y){min.y=p.y;}
if(max.y==null||p.y>max.y){max.y=p.y;}}}
lineStr.push(' ">');if(!aFill){appendStroke(this,lineStr);}else{appendFill(this,lineStr,min,max);}
lineStr.push('</g_vml_:shape>');this.element_.insertAdjacentHTML('beforeEnd',lineStr.join(''));}};function appendStroke(ctx,lineStr){var a=processStyle(ctx.strokeStyle);var color=a.color;var opacity=a.alpha*ctx.globalAlpha;var lineWidth=ctx.lineScale_*ctx.lineWidth;if(lineWidth<1){opacity*=lineWidth;}
lineStr.push('<g_vml_:stroke',' opacity="',opacity,'"',' joinstyle="',ctx.lineJoin,'"',' miterlimit="',ctx.miterLimit,'"',' endcap="',processLineCap(ctx.lineCap),'"',' weight="',lineWidth,'px"',' color="',color,'" />');}
function appendFill(ctx,lineStr,min,max){var fillStyle=ctx.fillStyle;var arcScaleX=ctx.arcScaleX_;var arcScaleY=ctx.arcScaleY_;var width=max.x-min.x;var height=max.y-min.y;if(fillStyle instanceof CanvasGradient_){var angle=0;var focus={x:0,y:0};var shift=0;var expansion=1;if(fillStyle.type_=='gradient'){var x0=fillStyle.x0_/arcScaleX;var y0=fillStyle.y0_/arcScaleY;var x1=fillStyle.x1_/arcScaleX;var y1=fillStyle.y1_/arcScaleY;var p0=ctx.getCoords_(x0,y0);var p1=ctx.getCoords_(x1,y1);var dx=p1.x-p0.x;var dy=p1.y-p0.y;angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<0){angle+=360;}
if(angle<1e-6){angle=0;}}else{var p0=ctx.getCoords_(fillStyle.x0_,fillStyle.y0_);focus={x:(p0.x-min.x)/width,y:(p0.y-min.y)/height};width/=arcScaleX*Z;height/=arcScaleY*Z;var dimension=m.max(width,height);shift=2*fillStyle.r0_/dimension;expansion=2*fillStyle.r1_/dimension-shift;}
var stops=fillStyle.colors_;stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset;});var length=stops.length;var color1=stops[0].color;var color2=stops[length-1].color;var opacity1=stops[0].alpha*ctx.globalAlpha;var opacity2=stops[length-1].alpha*ctx.globalAlpha;var colors=[];for(var i=0;i<length;i++){var stop=stops[i];colors.push(stop.offset*expansion+shift+' '+stop.color);}
lineStr.push('<g_vml_:fill type="',fillStyle.type_,'"',' method="none" focus="100%"',' color="',color1,'"',' color2="',color2,'"',' colors="',colors.join(','),'"',' opacity="',opacity2,'"',' g_o_:opacity2="',opacity1,'"',' angle="',angle,'"',' focusposition="',focus.x,',',focus.y,'" />');}else if(fillStyle instanceof CanvasPattern_){if(width&&height){var deltaLeft=-min.x;var deltaTop=-min.y;lineStr.push('<g_vml_:fill',' position="',deltaLeft/width*arcScaleX*arcScaleX,',',deltaTop/height*arcScaleY*arcScaleY,'"',' type="tile"',' src="',fillStyle.src_,'" />');}}else{var a=processStyle(ctx.fillStyle);var color=a.color;var opacity=a.alpha*ctx.globalAlpha;lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />');}}
contextPrototype.fill=function(){this.stroke(true);};contextPrototype.closePath=function(){this.currentPath_.push({type:'close'});};contextPrototype.getCoords_=function(aX,aY){var m=this.m_;return{x:Z*(aX*m[0][0]+aY*m[1][0]+m[2][0])-Z2,y:Z*(aX*m[0][1]+aY*m[1][1]+m[2][1])-Z2};};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_);};contextPrototype.restore=function(){if(this.aStack_.length){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop();}};function matrixIsFinite(m){return isFinite(m[0][0])&&isFinite(m[0][1])&&isFinite(m[1][0])&&isFinite(m[1][1])&&isFinite(m[2][0])&&isFinite(m[2][1]);}
function setM(ctx,m,updateLineScale){if(!matrixIsFinite(m)){return;}
ctx.m_=m;if(updateLineScale){var det=m[0][0]*m[1][1]-m[0][1]*m[1][0];ctx.lineScale_=sqrt(abs(det));}}
contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];setM(this,matrixMultiply(m1,this.m_),false);};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];setM(this,matrixMultiply(m1,this.m_),false);};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];setM(this,matrixMultiply(m1,this.m_),true);};contextPrototype.transform=function(m11,m12,m21,m22,dx,dy){var m1=[[m11,m12,0],[m21,m22,0],[dx,dy,1]];setM(this,matrixMultiply(m1,this.m_),true);};contextPrototype.setTransform=function(m11,m12,m21,m22,dx,dy){var m=[[m11,m12,0],[m21,m22,0],[dx,dy,1]];setM(this,m,true);};contextPrototype.drawText_=function(text,x,y,maxWidth,stroke){var m=this.m_,delta=1000,left=0,right=delta,offset={x:0,y:0},lineStr=[];var fontStyle=getComputedStyle(processFontStyle(this.font),this.element_);var fontStyleString=buildStyle(fontStyle);var elementStyle=this.element_.currentStyle;var textAlign=this.textAlign.toLowerCase();switch(textAlign){case'left':case'center':case'right':break;case'end':textAlign=elementStyle.direction=='ltr'?'right':'left';break;case'start':textAlign=elementStyle.direction=='rtl'?'right':'left';break;default:textAlign='left';}
switch(this.textBaseline){case'hanging':case'top':offset.y=fontStyle.size/1.75;break;case'middle':break;default:case null:case'alphabetic':case'ideographic':case'bottom':offset.y=-fontStyle.size/2.25;break;}
switch(textAlign){case'right':left=delta;right=0.05;break;case'center':left=right=delta/2;break;}
var d=this.getCoords_(x+offset.x,y+offset.y);lineStr.push('<g_vml_:line from="',-left,' 0" to="',right,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!stroke,'" stroked="',!!stroke,'" style="position:absolute;width:1px;height:1px;">');if(stroke){appendStroke(this,lineStr);}else{appendFill(this,lineStr,{x:-left,y:0},{x:right,y:fontStyle.size});}
var skewM=m[0][0].toFixed(3)+','+m[1][0].toFixed(3)+','+
m[0][1].toFixed(3)+','+m[1][1].toFixed(3)+',0,0';var skewOffset=mr(d.x/Z)+','+mr(d.y/Z);lineStr.push('<g_vml_:skew on="t" matrix="',skewM,'" ',' offset="',skewOffset,'" origin="',left,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',encodeHtmlAttribute(text),'" style="v-text-align:',textAlign,';font:',encodeHtmlAttribute(fontStyleString),'" /></g_vml_:line>');this.element_.insertAdjacentHTML('beforeEnd',lineStr.join(''));};contextPrototype.fillText=function(text,x,y,maxWidth){this.drawText_(text,x,y,maxWidth,false);};contextPrototype.strokeText=function(text,x,y,maxWidth){this.drawText_(text,x,y,maxWidth,true);};contextPrototype.measureText=function(text){if(!this.textMeasureEl_){var s='<span style="position:absolute;'+'top:-20000px;left:0;padding:0;margin:0;border:none;'+'white-space:pre;"></span>';this.element_.insertAdjacentHTML('beforeEnd',s);this.textMeasureEl_=this.element_.lastChild;}
var doc=this.element_.ownerDocument;this.textMeasureEl_.innerHTML='';this.textMeasureEl_.style.font=this.font;this.textMeasureEl_.appendChild(doc.createTextNode(text));return{width:this.textMeasureEl_.offsetWidth};};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(image,repetition){return new CanvasPattern_(image,repetition);};function CanvasGradient_(aType){this.type_=aType;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[];}
CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:aOffset,color:aColor.color,alpha:aColor.alpha});};function CanvasPattern_(image,repetition){assertImageIsValid(image);switch(repetition){case'repeat':case null:case'':this.repetition_='repeat';break
case'repeat-x':case'repeat-y':case'no-repeat':this.repetition_=repetition;break;default:throwException('SYNTAX_ERR');}
this.src_=image.src;this.width_=image.width;this.height_=image.height;}
function throwException(s){throw new DOMException_(s);}
function assertImageIsValid(img){if(!img||img.nodeType!=1||img.tagName!='IMG'){throwException('TYPE_MISMATCH_ERR');}
if(img.readyState!='complete'){throwException('INVALID_STATE_ERR');}}
function DOMException_(s){this.code=this[s];this.message=s+': DOM Exception '+this.code;}
var p=DOMException_.prototype=new Error;p.INDEX_SIZE_ERR=1;p.DOMSTRING_SIZE_ERR=2;p.HIERARCHY_REQUEST_ERR=3;p.WRONG_DOCUMENT_ERR=4;p.INVALID_CHARACTER_ERR=5;p.NO_DATA_ALLOWED_ERR=6;p.NO_MODIFICATION_ALLOWED_ERR=7;p.NOT_FOUND_ERR=8;p.NOT_SUPPORTED_ERR=9;p.INUSE_ATTRIBUTE_ERR=10;p.INVALID_STATE_ERR=11;p.SYNTAX_ERR=12;p.INVALID_MODIFICATION_ERR=13;p.NAMESPACE_ERR=14;p.INVALID_ACCESS_ERR=15;p.VALIDATION_ERR=16;p.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=G_vmlCanvasManager_;CanvasRenderingContext2D=CanvasRenderingContext2D_;CanvasGradient=CanvasGradient_;CanvasPattern=CanvasPattern_;DOMException=DOMException_;})();}
/* ========== ../wire-it/js/WireIt.js ============ */

var WireIt={getIntStyle:function(el,style){var sStyle=YAHOO.util.Dom.getStyle(el,style);return parseInt(sStyle.substr(0,sStyle.length-2),10);},sn:function(el,domAttributes,styleAttributes){if(!el){return;}
if(domAttributes){for(var i in domAttributes){var domAttribute=domAttributes[i];if(typeof(domAttribute)=="function"){continue;}
if(i=="className"){i="class";el.className=domAttribute;}
if(domAttribute!==el.getAttribute(i)){if(domAttribute===false){el.removeAttribute(i);}else{el.setAttribute(i,domAttribute);}}}}
if(styleAttributes){for(var i in styleAttributes){if(typeof(styleAttributes[i])=="function"){continue;}
if(el.style[i]!=styleAttributes[i]){el.style[i]=styleAttributes[i];}}}},cn:function(tag,domAttributes,styleAttributes,innerHTML){var el=document.createElement(tag);this.sn(el,domAttributes,styleAttributes);if(innerHTML){el.innerHTML=innerHTML;}
return el;},indexOf:YAHOO.lang.isFunction(Array.prototype.indexOf)?function(el,arr){return arr.indexOf(el);}:function(el,arr){for(var i=0;i<arr.length;i++){if(arr[i]==el)return i;}
return-1;},compact:YAHOO.lang.isFunction(Array.prototype.compact)?function(arr){return arr.compact();}:function(arr){var n=[];for(var i=0;i<arr.length;i++){if(arr[i]){n.push(arr[i]);}}
return n;}};WireIt.util={};
/* ========== ../wire-it/js/util/Anim.js ============ */

WireIt.util.Anim=function(terminals,el,attributes,duration,method){if(!terminals){throw new Error("WireIt.util.Anim needs at least terminals and id");}
this._WireItTerminals=terminals;WireIt.util.Anim.superclass.constructor.call(this,el,attributes,duration,method);this.onTween.subscribe(this.moveWireItWires,this,true);};YAHOO.extend(WireIt.util.Anim,YAHOO.util.Anim,{moveWireItWires:function(e){var terminalList=YAHOO.lang.isArray(this._WireItTerminals)?this._WireItTerminals:(this._WireItTerminals.isWireItTerminal?[this._WireItTerminals]:[]);for(var i=0;i<terminalList.length;i++){if(terminalList[i].wires){for(var k=0;k<terminalList[i].wires.length;k++){terminalList[i].wires[k].redraw();}}}},setTerminals:function(terminals){this._WireItTerminals=terminals;}});
/* ========== ../wire-it/js/util/DD.js ============ */

WireIt.util.DD=function(terminals,id,sGroup,config){if(!terminals){throw new Error("WireIt.util.DD needs at least terminals and id");}
this._WireItTerminals=terminals;WireIt.util.DD.superclass.constructor.call(this,id,sGroup,config);};YAHOO.extend(WireIt.util.DD,YAHOO.util.DD,{onDrag:function(e){var terminalList=YAHOO.lang.isArray(this._WireItTerminals)?this._WireItTerminals:(this._WireItTerminals.isWireItTerminal?[this._WireItTerminals]:[]);for(var i=0;i<terminalList.length;i++){if(terminalList[i].wires){for(var k=0;k<terminalList[i].wires.length;k++){terminalList[i].wires[k].redraw();}}}},setTerminals:function(terminals){this._WireItTerminals=terminals;}});
/* ========== ../wire-it/js/util/DDResize.js ============ */

WireIt.util.DDResize=function(container,config){this.myConf=config||{};this.myConf.container=container;this.myConf.minWidth=this.myConf.minWidth||50;this.myConf.minHeight=this.myConf.minHeight||50;WireIt.util.DDResize.superclass.constructor.apply(this,[container.el,container.ddResizeHandle]);this.setHandleElId(container.ddResizeHandle);this.eventResize=new YAHOO.util.CustomEvent("eventResize");};YAHOO.extend(WireIt.util.DDResize,YAHOO.util.DragDrop,{onMouseDown:function(e){var panel=this.getEl();this.startWidth=panel.offsetWidth;this.startHeight=panel.offsetHeight;this.startPos=[YAHOO.util.Event.getPageX(e),YAHOO.util.Event.getPageY(e)];},onDrag:function(e){var newPos=[YAHOO.util.Event.getPageX(e),YAHOO.util.Event.getPageY(e)];var offsetX=newPos[0]-this.startPos[0];var offsetY=newPos[1]-this.startPos[1];var newWidth=Math.max(this.startWidth+offsetX,this.myConf.minWidth);var newHeight=Math.max(this.startHeight+offsetY,this.myConf.minHeight);var panel=this.getEl();panel.style.width=newWidth+"px";panel.style.height=newHeight+"px";this.eventResize.fire([newWidth,newHeight]);}});
/* ========== ../wire-it/js/CanvasElement.js ============ */

(function(){var Event=YAHOO.util.Event,UA=YAHOO.env.ua;WireIt.CanvasElement=function(parentNode){this.element=document.createElement('canvas');parentNode.appendChild(this.element);if(typeof(G_vmlCanvasManager)!="undefined"){this.element=G_vmlCanvasManager.initElement(this.element);}};WireIt.CanvasElement.prototype={getContext:function(mode){return this.element.getContext(mode||"2d");},destroy:function(){var el=this.element;if(YAHOO.util.Dom.inDocument(el)){el.parentNode.removeChild(el);}
Event.purgeElement(el,true);},SetCanvasRegion:UA.ie?function(left,top,width,height){var el=this.element;WireIt.sn(el,null,{left:left+"px",top:top+"px",width:width+"px",height:height+"px"});el.getContext("2d").clearRect(0,0,width,height);this.element=el;}:((UA.webkit||UA.opera)?function(left,top,width,height){var el=this.element;var newCanvas=WireIt.cn("canvas",{className:el.className||el.getAttribute("class"),width:width,height:height},{left:left+"px",top:top+"px"});var listeners=Event.getListeners(el);for(var listener in listeners){var l=listeners[listener];Event.addListener(newCanvas,l.type,l.fn,l.obj,l.adjust);}
Event.purgeElement(el);el.parentNode.replaceChild(newCanvas,el);this.element=newCanvas;}:function(left,top,width,height){WireIt.sn(this.element,{width:width,height:height},{left:left+"px",top:top+"px"});})};})();
/* ========== ../wire-it/js/Wire.js ============ */

WireIt.Wire=function(terminal1,terminal2,parentEl,options){this.parentEl=parentEl;this.terminal1=terminal1;this.terminal2=terminal2;this.eventMouseClick=new YAHOO.util.CustomEvent("eventMouseClick");this.eventMouseIn=new YAHOO.util.CustomEvent("eventMouseIn");this.eventMouseOut=new YAHOO.util.CustomEvent("eventMouseOut");this.eventMouseMove=new YAHOO.util.CustomEvent("eventMouseMove");this.setOptions(options||{});WireIt.Wire.superclass.constructor.call(this,this.parentEl);YAHOO.util.Dom.addClass(this.element,this.options.className);this.terminal1.addWire(this);this.terminal2.addWire(this);};YAHOO.lang.extend(WireIt.Wire,WireIt.CanvasElement,{setOptions:function(options){this.options={};this.options.className=options.className||'WireIt-Wire';this.options.coeffMulDirection=YAHOO.lang.isUndefined(options.coeffMulDirection)?100:options.coeffMulDirection;this.options.drawingMethod=options.drawingMethod||'bezier';this.options.cap=options.cap||'round';this.options.bordercap=options.bordercap||'round';this.options.width=options.width||3;this.options.borderwidth=options.borderwidth||1;this.options.color=options.color||'rgb(173, 216, 230)';this.options.bordercolor=options.bordercolor||'#0000ff';},remove:function(){this.parentEl.removeChild(this.element);if(this.terminal1&&this.terminal1.removeWire){this.terminal1.removeWire(this);}
if(this.terminal2&&this.terminal2.removeWire){this.terminal2.removeWire(this);}
this.terminal1=null;this.terminal2=null;},drawBezierCurve:function(){var p1=this.terminal1.getXY();var p2=this.terminal2.getXY();var coeffMulDirection=this.options.coeffMulDirection;var distance=Math.sqrt(Math.pow(p1[0]-p2[0],2)+Math.pow(p1[1]-p2[1],2));if(distance<coeffMulDirection){coeffMulDirection=distance/2;}
var d1=[this.terminal1.options.direction[0]*coeffMulDirection,this.terminal1.options.direction[1]*coeffMulDirection];var d2=[this.terminal2.options.direction[0]*coeffMulDirection,this.terminal2.options.direction[1]*coeffMulDirection];var bezierPoints=[];bezierPoints[0]=p1;bezierPoints[1]=[p1[0]+d1[0],p1[1]+d1[1]];bezierPoints[2]=[p2[0]+d2[0],p2[1]+d2[1]];bezierPoints[3]=p2;var min=[p1[0],p1[1]];var max=[p1[0],p1[1]];for(var i=1;i<bezierPoints.length;i++){var p=bezierPoints[i];if(p[0]<min[0]){min[0]=p[0];}
if(p[1]<min[1]){min[1]=p[1];}
if(p[0]>max[0]){max[0]=p[0];}
if(p[1]>max[1]){max[1]=p[1];}}
var margin=[4,4];min[0]=min[0]-margin[0];min[1]=min[1]-margin[1];max[0]=max[0]+margin[0];max[1]=max[1]+margin[1];var lw=Math.abs(max[0]-min[0]);var lh=Math.abs(max[1]-min[1]);this.SetCanvasRegion(min[0],min[1],lw,lh);var ctxt=this.getContext();for(i=0;i<bezierPoints.length;i++){bezierPoints[i][0]=bezierPoints[i][0]-min[0];bezierPoints[i][1]=bezierPoints[i][1]-min[1];}
ctxt.lineCap=this.options.bordercap;ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.width+this.options.borderwidth*2;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0],bezierPoints[3][1]);ctxt.stroke();ctxt.lineCap=this.options.cap;ctxt.strokeStyle=this.options.color;ctxt.lineWidth=this.options.width;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0],bezierPoints[3][1]);ctxt.stroke();},drawBezierArrows:function(){var arrowWidth=Math.round(this.options.width*1.5+20);var arrowLength=Math.round(this.options.width*1.2+20);var d=arrowWidth/2;var redim=d+3;var margin=[4+redim,4+redim];var p1=this.terminal1.getXY();var p2=this.terminal2.getXY();var coeffMulDirection=this.options.coeffMulDirection;var distance=Math.sqrt(Math.pow(p1[0]-p2[0],2)+Math.pow(p1[1]-p2[1],2));if(distance<coeffMulDirection){coeffMulDirection=distance/2;}
var d1=[this.terminal1.options.direction[0]*coeffMulDirection,this.terminal1.options.direction[1]*coeffMulDirection];var d2=[this.terminal2.options.direction[0]*coeffMulDirection,this.terminal2.options.direction[1]*coeffMulDirection];var bezierPoints=[];bezierPoints[0]=p1;bezierPoints[1]=[p1[0]+d1[0],p1[1]+d1[1]];bezierPoints[2]=[p2[0]+d2[0],p2[1]+d2[1]];bezierPoints[3]=p2;var min=[p1[0],p1[1]];var max=[p1[0],p1[1]];for(var i=1;i<bezierPoints.length;i++){var p=bezierPoints[i];if(p[0]<min[0]){min[0]=p[0];}
if(p[1]<min[1]){min[1]=p[1];}
if(p[0]>max[0]){max[0]=p[0];}
if(p[1]>max[1]){max[1]=p[1];}}
min[0]=min[0]-margin[0];min[1]=min[1]-margin[1];max[0]=max[0]+margin[0];max[1]=max[1]+margin[1];var lw=Math.abs(max[0]-min[0]);var lh=Math.abs(max[1]-min[1]);this.SetCanvasRegion(min[0],min[1],lw,lh);var ctxt=this.getContext();for(i=0;i<bezierPoints.length;i++){bezierPoints[i][0]=bezierPoints[i][0]-min[0];bezierPoints[i][1]=bezierPoints[i][1]-min[1];}
ctxt.lineCap=this.options.bordercap;ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.width+this.options.borderwidth*2;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0],bezierPoints[3][1]+arrowLength/2*this.terminal2.options.direction[1]);ctxt.stroke();ctxt.lineCap=this.options.cap;ctxt.strokeStyle=this.options.color;ctxt.lineWidth=this.options.width;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0],bezierPoints[3][1]+arrowLength/2*this.terminal2.options.direction[1]);ctxt.stroke();var t1=bezierPoints[2],t2=p2;var z=[0,0];var dlug=arrowLength;var t=1-(dlug/distance);z[0]=Math.abs(t1[0]+t*(t2[0]-t1[0]));z[1]=Math.abs(t1[1]+t*(t2[1]-t1[1]));var W=t1[0]-t2[0];var Wa=t1[1]-t2[1];var Wb=t1[0]*t2[1]-t1[1]*t2[0];if(W!==0){a=Wa/W;b=Wb/W;}
else{a=0;}
if(a===0){aProst=0;}
else{aProst=-1/a;}
bProst=z[1]-aProst*z[0];var A=1+Math.pow(aProst,2),B=2*aProst*bProst-2*z[0]-2*z[1]*aProst,C=-2*z[1]*bProst+Math.pow(z[0],2)+Math.pow(z[1],2)-Math.pow(d,2)+Math.pow(bProst,2),delta=Math.pow(B,2)-4*A*C;if(delta<0){return;}
var x1=(-B+Math.sqrt(delta))/(2*A),x2=(-B-Math.sqrt(delta))/(2*A),y1=aProst*x1+bProst,y2=aProst*x2+bProst;if(t1[1]==t2[1]){var o=(t1[0]>t2[0])?1:-1;x1=t2[0]+o*dlug;x2=x1;y1-=d;y2+=d;}
ctxt.fillStyle=this.options.color;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.fill();ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.borderwidth;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.lineTo(t2[0],t2[1]);ctxt.stroke();},getOtherTerminal:function(terminal){return(terminal==this.terminal1)?this.terminal2:this.terminal1;},drawArrows:function()
{var d=7;var redim=d+3;var margin=[4+redim,4+redim];var p1=this.terminal1.getXY();var p2=this.terminal2.getXY();var distance=Math.sqrt(Math.pow(p1[0]-p2[0],2)+Math.pow(p1[1]-p2[1],2));var min=[Math.min(p1[0],p2[0])-margin[0],Math.min(p1[1],p2[1])-margin[1]];var max=[Math.max(p1[0],p2[0])+margin[0],Math.max(p1[1],p2[1])+margin[1]];var lw=Math.abs(max[0]-min[0])+redim;var lh=Math.abs(max[1]-min[1])+redim;p1[0]=p1[0]-min[0];p1[1]=p1[1]-min[1];p2[0]=p2[0]-min[0];p2[1]=p2[1]-min[1];this.SetCanvasRegion(min[0],min[1],lw,lh);var ctxt=this.getContext();ctxt.lineCap=this.options.bordercap;ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.width+this.options.borderwidth*2;ctxt.beginPath();ctxt.moveTo(p1[0],p1[1]);ctxt.lineTo(p2[0],p2[1]);ctxt.stroke();ctxt.lineCap=this.options.cap;ctxt.strokeStyle=this.options.color;ctxt.lineWidth=this.options.width;ctxt.beginPath();ctxt.moveTo(p1[0],p1[1]);ctxt.lineTo(p2[0],p2[1]);ctxt.stroke();var t1=p1;var t2=p2;var z=[0,0];var dlug=20;var t=(distance==0)?0:1-(dlug/distance);z[0]=Math.abs(t1[0]+t*(t2[0]-t1[0]));z[1]=Math.abs(t1[1]+t*(t2[1]-t1[1]));var W=t1[0]-t2[0];var Wa=t1[1]-t2[1];var Wb=t1[0]*t2[1]-t1[1]*t2[0];if(W!==0){a=Wa/W;b=Wb/W;}
else{a=0;}
if(a==0){aProst=0;}
else{aProst=-1/a;}
bProst=z[1]-aProst*z[0];var A=1+Math.pow(aProst,2);var B=2*aProst*bProst-2*z[0]-2*z[1]*aProst;var C=-2*z[1]*bProst+Math.pow(z[0],2)+Math.pow(z[1],2)-Math.pow(d,2)+Math.pow(bProst,2);var delta=Math.pow(B,2)-4*A*C;if(delta<0){return;}
var x1=(-B+Math.sqrt(delta))/(2*A);var x2=(-B-Math.sqrt(delta))/(2*A);var y1=aProst*x1+bProst;var y2=aProst*x2+bProst;if(t1[1]==t2[1]){var o=(t1[0]>t2[0])?1:-1;x1=t2[0]+o*dlug;x2=x1;y1-=d;y2+=d;}
ctxt.fillStyle=this.options.color;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.fill();ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.borderwidth;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.lineTo(t2[0],t2[1]);ctxt.stroke();},drawStraight:function()
{var margin=[4,4];var p1=this.terminal1.getXY();var p2=this.terminal2.getXY();var min=[Math.min(p1[0],p2[0])-margin[0],Math.min(p1[1],p2[1])-margin[1]];var max=[Math.max(p1[0],p2[0])+margin[0],Math.max(p1[1],p2[1])+margin[1]];var lw=Math.abs(max[0]-min[0]);var lh=Math.abs(max[1]-min[1]);p1[0]=p1[0]-min[0];p1[1]=p1[1]-min[1];p2[0]=p2[0]-min[0];p2[1]=p2[1]-min[1];this.SetCanvasRegion(min[0],min[1],lw,lh);var ctxt=this.getContext();ctxt.lineCap=this.options.bordercap;ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.width+this.options.borderwidth*2;ctxt.beginPath();ctxt.moveTo(p1[0],p1[1]);ctxt.lineTo(p2[0],p2[1]);ctxt.stroke();ctxt.lineCap=this.options.cap;ctxt.strokeStyle=this.options.color;ctxt.lineWidth=this.options.width;ctxt.beginPath();ctxt.moveTo(p1[0],p1[1]);ctxt.lineTo(p2[0],p2[1]);ctxt.stroke();},redraw:function(){if(this.options.drawingMethod=='straight'){this.drawStraight();}
else if(this.options.drawingMethod=='arrows'){this.drawArrows();}
else if(this.options.drawingMethod=='bezier'){this.drawBezierCurve();}
else if(this.options.drawingMethod=='bezierArrows'){this.drawBezierArrows();}
else{throw new Error("WireIt.Wire unable to find '"+this.drawingMethod+"' drawing method.");}},wireDrawnAt:function(x,y){var ctxt=this.getContext();var imgData=ctxt.getImageData(x,y,1,1);var pixel=imgData.data;return!(pixel[0]===0&&pixel[1]===0&&pixel[2]===0&&pixel[3]===0);},onMouseMove:function(x,y){if(typeof this.mouseInState===undefined){this.mouseInState=false;}
if(this.wireDrawnAt(x,y)){if(!this.mouseInState){this.mouseInState=true;this.onWireIn(x,y);}
this.onWireMove(x,y);}
else{if(this.mouseInState){this.mouseInState=false;this.onWireOut(x,y);}}},onWireMove:function(x,y){this.eventMouseMove.fire(this,[x,y]);},onWireIn:function(x,y){this.eventMouseIn.fire(this,[x,y]);},onWireOut:function(x,y){this.eventMouseOut.fire(this,[x,y]);},onClick:function(x,y){if(this.wireDrawnAt(x,y)){this.onWireClick(x,y);}},onWireClick:function(x,y){this.eventMouseClick.fire(this,[x,y]);}});
/* ========== ../wire-it/js/Terminal.js ============ */

(function(){var util=YAHOO.util;var Event=util.Event,lang=YAHOO.lang,Dom=util.Dom,CSS_PREFIX="WireIt-";WireIt.Scissors=function(terminal,oConfigs){WireIt.Scissors.superclass.constructor.call(this,document.createElement('div'),oConfigs);this._terminal=terminal;this.initScissors();};WireIt.Scissors.visibleInstance=null;lang.extend(WireIt.Scissors,util.Element,{initScissors:function(){this.hideNow();this.addClass(CSS_PREFIX+"Wire-scissors");this.appendTo(this._terminal.container?this._terminal.container.layer.el:this._terminal.el.parentNode.parentNode);this.on("mouseover",this.show,this,true);this.on("mouseout",this.hide,this,true);this.on("click",this.scissorClick,this,true);Event.addListener(this._terminal.el,"mouseover",this.mouseOver,this,true);Event.addListener(this._terminal.el,"mouseout",this.hide,this,true);},setPosition:function(){var pos=this._terminal.getXY();this.setStyle("left",(pos[0]+this._terminal.options.direction[0]*30-8)+"px");this.setStyle("top",(pos[1]+this._terminal.options.direction[1]*30-8)+"px");},mouseOver:function(){if(this._terminal.wires.length>0){this.show();}},scissorClick:function(){this._terminal.removeAllWires();if(this.terminalTimeout){this.terminalTimeout.cancel();}
this.hideNow();},show:function(){this.setPosition();this.setStyle('display','');if(WireIt.Scissors.visibleInstance&&WireIt.Scissors.visibleInstance!=this){if(WireIt.Scissors.visibleInstance.terminalTimeout){WireIt.Scissors.visibleInstance.terminalTimeout.cancel();}
WireIt.Scissors.visibleInstance.hideNow();}
WireIt.Scissors.visibleInstance=this;if(this.terminalTimeout){this.terminalTimeout.cancel();}},hide:function(){this.terminalTimeout=lang.later(700,this,this.hideNow);},hideNow:function(){WireIt.Scissors.visibleInstance=null;this.setStyle('display','none');}});WireIt.TerminalProxy=function(terminal,options){this.terminal=terminal;this.termConfig=options||{};this.terminalProxySize=options.terminalProxySize||10;this.fakeTerminal=null;WireIt.TerminalProxy.superclass.constructor.call(this,this.terminal.el,undefined,{dragElId:"WireIt-TerminalProxy",resizeFrame:false,centerFrame:true});};util.DDM.mode=util.DDM.INTERSECT;lang.extend(WireIt.TerminalProxy,util.DDProxy,{createFrame:function(){var self=this,body=document.body;if(!body||!body.firstChild){setTimeout(function(){self.createFrame();},50);return;}
var div=this.getDragEl(),Dom=YAHOO.util.Dom;if(!div){div=document.createElement("div");div.id=this.dragElId;var s=div.style;s.position="absolute";s.visibility="hidden";s.cursor="move";s.border="2px solid #aaa";s.zIndex=999;var size=this.terminalProxySize+"px";s.height=size;s.width=size;var _data=document.createElement('div');Dom.setStyle(_data,'height','100%');Dom.setStyle(_data,'width','100%');Dom.setStyle(_data,'background-color','#ccc');Dom.setStyle(_data,'opacity','0');div.appendChild(_data);body.insertBefore(div,body.firstChild);}},startDrag:function(){if(this.terminal.options.nMaxWires==1&&this.terminal.wires.length==1){this.terminal.wires[0].remove();}
else if(this.terminal.wires.length>=this.terminal.options.nMaxWires){return;}
var halfProxySize=this.terminalProxySize/2;this.fakeTerminal={options:{direction:this.terminal.options.fakeDirection},pos:[200,200],addWire:function(){},removeWire:function(){},getXY:function(){var layers=Dom.getElementsByClassName('WireIt-Layer');if(layers.length>0){var orig=Dom.getXY(layers[0]);return[this.pos[0]-orig[0]+halfProxySize,this.pos[1]-orig[1]+halfProxySize];}
return this.pos;}};var parentEl=this.terminal.parentEl.parentNode;if(this.terminal.container){parentEl=this.terminal.container.layer.el;}
this.editingWire=new WireIt.Wire(this.terminal,this.fakeTerminal,parentEl,this.terminal.options.editingWireConfig);Dom.addClass(this.editingWire.element,CSS_PREFIX+'Wire-editing');},onDrag:function(e){if(!this.editingWire){return;}
if(this.terminal.container){var obj=this.terminal.container.layer.el;var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;obj=obj.offsetParent;}while(obj=obj.offsetParent);}
this.fakeTerminal.pos=[e.clientX-curleft+this.terminal.container.layer.el.scrollLeft,e.clientY-curtop+this.terminal.container.layer.el.scrollTop];}
else{this.fakeTerminal.pos=(YAHOO.env.ua.ie)?[e.clientX,e.clientY]:[e.clientX+window.pageXOffset,e.clientY+window.pageYOffset];}
this.editingWire.redraw();},endDrag:function(e){if(this.editingWire){this.editingWire.remove();this.editingWire=null;}},onDragEnter:function(e,ddTargets){if(!this.editingWire){return;}
for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){ddTargets[i].terminal.setDropInvitation(true);}}},onDragOut:function(e,ddTargets){if(!this.editingWire){return;}
for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){ddTargets[i].terminal.setDropInvitation(false);}}},onDragDrop:function(e,ddTargets){if(!this.editingWire){return;}
this.onDragOut(e,ddTargets);var targetTerminalProxy=null;for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){targetTerminalProxy=ddTargets[i];break;}}
if(!targetTerminalProxy){return;}
this.editingWire.remove();this.editingWire=null;var termAlreadyConnected=false;for(var i=0;i<this.terminal.wires.length;i++){if(this.terminal.wires[i].terminal1==this.terminal){if(this.terminal.wires[i].terminal2==targetTerminalProxy.terminal){termAlreadyConnected=true;break;}}
else if(this.terminal.wires[i].terminal2==this.terminal){if(this.terminal.wires[i].terminal1==targetTerminalProxy.terminal){termAlreadyConnected=true;break;}}}
if(termAlreadyConnected){return;}
var parentEl=this.terminal.parentEl.parentNode;if(this.terminal.container){parentEl=this.terminal.container.layer.el;}
var term1=this.terminal;var term2=targetTerminalProxy.terminal;if(term2.options.alwaysSrc){term1=targetTerminalProxy.terminal;term2=this.terminal;}
var tgtTerm=targetTerminalProxy.terminal;if(tgtTerm.options.nMaxWires==1){if(tgtTerm.wires.length>0){tgtTerm.wires[0].remove();}
var w=new WireIt.Wire(term1,term2,parentEl,term1.options.wireConfig);w.redraw();}
else if(tgtTerm.wires.length<tgtTerm.options.nMaxWires){var w=new WireIt.Wire(term1,term2,parentEl,term1.options.wireConfig);w.redraw();}},isWireItTerminal:true,isValidWireTerminal:function(DDterminal){if(!DDterminal.isWireItTerminal){return false;}
if(this.termConfig.type){if(this.termConfig.allowedTypes){if(WireIt.indexOf(DDterminal.termConfig.type,this.termConfig.allowedTypes)==-1){return false;}}
else{if(this.termConfig.type!=DDterminal.termConfig.type){return false;}}}
else if(DDterminal.termConfig.type){if(DDterminal.termConfig.allowedTypes){if(WireIt.indexOf(this.termConfig.type,DDterminal.termConfig.allowedTypes)==-1){return false;}}
else{if(this.termConfig.type!=DDterminal.termConfig.type){return false;}}}
if(this.terminal.container){if(this.terminal.container.options.preventSelfWiring){if(DDterminal.terminal.container==this.terminal.container){return false;}}}
return true;}});WireIt.Terminal=function(parentEl,options,container){this.parentEl=parentEl;this.container=container;this.wires=[];this.setOptions(options);this.eventAddWire=new util.CustomEvent("eventAddWire");this.eventRemoveWire=new util.CustomEvent("eventRemoveWire");this.el=null;this.render();if(this.options.editable){this.dd=new WireIt.TerminalProxy(this,this.options.ddConfig);this.scissors=new WireIt.Scissors(this);}};WireIt.Terminal.prototype={setOptions:function(options){this.options={};this.options.name=options.name;this.options.direction=options.direction||[0,1];this.options.fakeDirection=options.fakeDirection||[-this.options.direction[0],-this.options.direction[1]];this.options.className=options.className||CSS_PREFIX+'Terminal';this.options.connectedClassName=options.connectedClassName||CSS_PREFIX+'Terminal-connected';this.options.dropinviteClassName=options.dropinviteClassName||CSS_PREFIX+'Terminal-dropinvite';this.options.editable=lang.isUndefined(options.editable)?true:options.editable;this.options.nMaxWires=options.nMaxWires||Infinity;this.options.wireConfig=options.wireConfig||{};this.options.editingWireConfig=options.editingWireConfig||this.options.wireConfig;this.options.offsetPosition=options.offsetPosition;this.options.alwaysSrc=lang.isUndefined(options.alwaysSrc)?false:options.alwaysSrc;this.options.ddConfig=options.ddConfig||{};},setDropInvitation:function(display){if(display){Dom.addClass(this.el,this.options.dropinviteClassName);}
else{Dom.removeClass(this.el,this.options.dropinviteClassName);}},render:function(){this.el=WireIt.cn('div',{className:this.options.className});if(this.options.name){this.el.title=this.options.name;}
var pos=this.options.offsetPosition;if(pos){if(lang.isArray(pos)){this.el.style.left=pos[0]+"px";this.el.style.top=pos[1]+"px";}
else if(lang.isObject(pos)){for(var key in pos){if(pos.hasOwnProperty(key)&&pos[key]!=""){this.el.style[key]=pos[key]+"px";}}}}
this.parentEl.appendChild(this.el);},addWire:function(wire){this.wires.push(wire);Dom.addClass(this.el,this.options.connectedClassName);this.eventAddWire.fire(wire);},removeWire:function(wire){var index=WireIt.indexOf(wire,this.wires),w;if(index!=-1){this.wires[index].destroy();this.wires[index]=null;this.wires=WireIt.compact(this.wires);if(this.wires.length==0){Dom.removeClass(this.el,this.options.connectedClassName);}
this.eventRemoveWire.fire(wire);}},getXY:function(){var layerEl=this.container&&this.container.layer?this.container.layer.el:document.body;var obj=this.el;var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;obj=obj.offsetParent;}while(!!obj&&obj!=layerEl);}
return[curleft+15,curtop+15];},remove:function(){while(this.wires.length>0){this.wires[0].remove();}
this.parentEl.removeChild(this.el);Event.purgeElement(this.el);if(this.scissors){Event.purgeElement(this.scissors.get('element'));}},getConnectedTerminals:function(){var terminalList=[];if(this.wires){for(var i=0;i<this.wires.length;i++){terminalList.push(this.wires[i].getOtherTerminal(this));}}
return terminalList;},redrawAllWires:function(){if(this.wires){for(var i=0;i<this.wires.length;i++){this.wires[i].redraw();}}},removeAllWires:function(){while(this.wires.length>0){this.wires[0].remove();}}};WireIt.util.TerminalInput=function(parentEl,options,container){WireIt.util.TerminalInput.superclass.constructor.call(this,parentEl,options,container);};lang.extend(WireIt.util.TerminalInput,WireIt.Terminal,{setOptions:function(options){WireIt.util.TerminalInput.superclass.setOptions.call(this,options);this.options.direction=options.direction||[0,-1];this.options.fakeDirection=options.fakeDirection||[0,1];this.options.ddConfig={type:"input",allowedTypes:["output"]};this.options.nMaxWires=options.nMaxWires||1;}});WireIt.util.TerminalOutput=function(parentEl,options,container){WireIt.util.TerminalOutput.superclass.constructor.call(this,parentEl,options,container);};lang.extend(WireIt.util.TerminalOutput,WireIt.Terminal,{setOptions:function(options){WireIt.util.TerminalOutput.superclass.setOptions.call(this,options);this.options.direction=options.direction||[0,1];this.options.fakeDirection=options.fakeDirection||[0,-1];this.options.ddConfig={type:"output",allowedTypes:["input"]};this.options.alwaysSrc=true;}});})();
/* ========== ../wire-it/js/Layer.js ============ */

WireIt.Layer=function(options){this.setOptions(options);this.containers=[];this.wires=[];this.el=null;this.eventChanged=new YAHOO.util.CustomEvent("eventChanged");this.eventAddWire=new YAHOO.util.CustomEvent("eventAddWire");this.eventRemoveWire=new YAHOO.util.CustomEvent("eventRemoveWire");this.eventAddContainer=new YAHOO.util.CustomEvent("eventAddContainer");this.eventRemoveContainer=new YAHOO.util.CustomEvent("eventRemoveContainer");this.eventContainerDragged=new YAHOO.util.CustomEvent("eventContainerDragged");this.eventContainerResized=new YAHOO.util.CustomEvent("eventContainerResized");this.render();this.initContainers();this.initWires();if(this.options.layerMap){new WireIt.LayerMap(this,this.options.layerMapOptions);}};WireIt.Layer.prototype={setOptions:function(options){this.options={};this.options.className=options.className||'WireIt-Layer';this.options.parentEl=options.parentEl||document.body;this.options.containers=options.containers||[];this.options.wires=options.wires||[];this.options.layerMap=YAHOO.lang.isUndefined(options.layerMap)?false:options.layerMap;this.options.layerMapOptions=options.layerMapOptions;this.options.enableMouseEvents=YAHOO.lang.isUndefined(options.enableMouseEvents)?true:options.enableMouseEvents;},render:function(){this.el=WireIt.cn('div',{className:this.options.className});this.options.parentEl.appendChild(this.el);},initContainers:function(){for(var i=0;i<this.options.containers.length;i++){this.addContainer(this.options.containers[i]);}},initWires:function(){for(var i=0;i<this.options.wires.length;i++){this.addWire(this.options.wires[i]);}},addWire:function(wireConfig){var type=eval(wireConfig.xtype||"WireIt.Wire");var src=wireConfig.src;var tgt=wireConfig.tgt;var terminal1=this.containers[src.moduleId].getTerminal(src.terminal);var terminal2=this.containers[tgt.moduleId].getTerminal(tgt.terminal);var wire=new type(terminal1,terminal2,this.el,wireConfig);wire.redraw();return wire;},addContainer:function(containerConfig){var type=eval('('+(containerConfig.xtype||"WireIt.Container")+')');if(!YAHOO.lang.isFunction(type)){throw new Error("WireIt layer unable to add container: xtype '"+containerConfig.xtype+"' not found");}
var container=new type(containerConfig,this);this.containers.push(container);container.eventAddWire.subscribe(this.onAddWire,this,true);container.eventRemoveWire.subscribe(this.onRemoveWire,this,true);if(container.ddResize){container.ddResize.on('endDragEvent',function(){this.eventContainerResized.fire(container);this.eventChanged.fire(this);},this,true);}
if(container.dd){container.dd.on('endDragEvent',function(){this.eventContainerDragged.fire(container);this.eventChanged.fire(this);},this,true);}
this.eventAddContainer.fire(container);this.eventChanged.fire(this);return container;},removeContainer:function(container){var index=WireIt.indexOf(container,this.containers);if(index!=-1){container.remove();this.containers[index]=null;this.containers=WireIt.compact(this.containers);this.eventRemoveContainer.fire(container);this.eventChanged.fire(this);}},onAddWire:function(event,args){var wire=args[0];if(WireIt.indexOf(wire,this.wires)==-1){this.wires.push(wire);if(this.options.enableMouseEvents){YAHOO.util.Event.addListener(wire.element,"mousemove",this.onWireMouseMove,this,true);YAHOO.util.Event.addListener(wire.element,"click",this.onWireClick,this,true);}
this.eventAddWire.fire(wire);this.eventChanged.fire(this);}},onRemoveWire:function(event,args){var wire=args[0];var index=WireIt.indexOf(wire,this.wires);if(index!=-1){this.wires[index]=null;this.wires=WireIt.compact(this.wires);this.eventRemoveWire.fire(wire);this.eventChanged.fire(this);}},clear:function(){while(this.containers.length>0){this.removeContainer(this.containers[0]);}},removeAllContainers:function(){this.clear();},getWiring:function(){var i;var obj={containers:[],wires:[]};for(i=0;i<this.containers.length;i++){obj.containers.push(this.containers[i].getConfig());}
for(i=0;i<this.wires.length;i++){var wire=this.wires[i];var wireObj={src:{moduleId:WireIt.indexOf(wire.terminal1.container,this.containers),terminal:wire.terminal1.name},tgt:{moduleId:WireIt.indexOf(wire.terminal2.container,this.containers),terminal:wire.terminal2.name}};obj.wires.push(wireObj);}
return obj;},setWiring:function(wiring){this.clear();if(YAHOO.lang.isArray(wiring.containers)){for(var i=0;i<wiring.containers.length;i++){this.addContainer(wiring.containers[i]);}}
if(YAHOO.lang.isArray(wiring.wires)){for(var i=0;i<wiring.wires.length;i++){this.addWire(wiring.wires[i]);}}},_getMouseEvtPos:function(e){var tgt=YAHOO.util.Event.getTarget(e);var tgtPos=[tgt.offsetLeft,tgt.offsetTop];return[tgtPos[0]+e.layerX,tgtPos[1]+e.layerY];},onWireClick:function(e){var p=this._getMouseEvtPos(e);var lx=p[0],ly=p[1],n=this.wires.length,w;for(var i=0;i<n;i++){w=this.wires[i];var elx=w.element.offsetLeft,ely=w.element.offsetTop;if(lx>=elx&&lx<elx+w.element.width&&ly>=ely&&ly<ely+w.element.height){var rx=lx-elx,ry=ly-ely;w.onClick(rx,ry);}}},onWireMouseMove:function(e){var p=this._getMouseEvtPos(e);var lx=p[0],ly=p[1],n=this.wires.length,w;for(var i=0;i<n;i++){w=this.wires[i];var elx=w.element.offsetLeft,ely=w.element.offsetTop;if(lx>=elx&&lx<elx+w.element.width&&ly>=ely&&ly<ely+w.element.height){var rx=lx-elx,ry=ly-ely;w.onMouseMove(rx,ry);}}},clearExplode:function(callback,bind){var center=[Math.floor(YAHOO.util.Dom.getViewportWidth()/2),Math.floor(YAHOO.util.Dom.getViewportHeight()/2)];var R=1.2*Math.sqrt(Math.pow(center[0],2)+Math.pow(center[1],2));for(var i=0;i<this.containers.length;i++){var left=parseInt(dbWire.layer.containers[i].el.style.left.substr(0,dbWire.layer.containers[i].el.style.left.length-2),10);var top=parseInt(dbWire.layer.containers[i].el.style.top.substr(0,dbWire.layer.containers[i].el.style.top.length-2),10);var d=Math.sqrt(Math.pow(left-center[0],2)+Math.pow(top-center[1],2));var u=[(left-center[0])/d,(top-center[1])/d];YAHOO.util.Dom.setStyle(this.containers[i].el,"opacity","0.8");var myAnim=new WireIt.util.Anim(this.containers[i].terminals,this.containers[i].el,{left:{to:center[0]+R*u[0]},top:{to:center[1]+R*u[1]},opacity:{to:0,by:0.05},duration:3});if(i==this.containers.length-1){myAnim.onComplete.subscribe(function(){this.clear();callback.call(bind);},this,true);}
myAnim.animate();}}};
/* ========== ../wire-it/js/Container.js ============ */

(function(){var util=YAHOO.util;var Dom=util.Dom,Event=util.Event,CSS_PREFIX="WireIt-";WireIt.Container=function(options,layer){this.setOptions(options);this.layer=layer;this.terminals=[];this.wires=[];this.el=null;this.bodyEl=null;this.eventAddWire=new util.CustomEvent("eventAddWire");this.eventRemoveWire=new util.CustomEvent("eventRemoveWire");this.render();this.initTerminals(this.options.terminals);if(this.options.draggable){if(this.options.resizable){this.ddResize=new WireIt.util.DDResize(this);this.ddResize.eventResize.subscribe(this.onResize,this,true);}
this.dd=new WireIt.util.DD(this.terminals,this.el);if(this.options.ddHandle){this.dd.setHandleElId(this.ddHandle);}
if(this.options.resizable){this.dd.addInvalidHandleId(this.ddResizeHandle);this.ddResize.addInvalidHandleId(this.ddHandle);}}};WireIt.Container.prototype={setOptions:function(options){this.options={};this.options.terminals=options.terminals||[];this.options.draggable=(typeof options.draggable=="undefined")?true:options.draggable;this.options.position=options.position||[100,100];this.options.className=options.className||CSS_PREFIX+'Container';this.options.ddHandle=(typeof options.ddHandle=="undefined")?true:options.ddHandle;this.options.ddHandleClassName=options.ddHandleClassName||CSS_PREFIX+"Container-ddhandle";this.options.resizable=(typeof options.resizable=="undefined")?true:options.resizable;this.options.resizeHandleClassName=options.resizeHandleClassName||CSS_PREFIX+"Container-resizehandle";this.options.width=options.width;this.options.height=options.height;this.options.close=(typeof options.close=="undefined")?true:options.close;this.options.closeButtonClassName=options.closeButtonClassName||CSS_PREFIX+"Container-closebutton";this.options.title=options.title;this.options.icon=options.icon;this.options.preventSelfWiring=(typeof options.preventSelfWiring=="undefined")?true:options.preventSelfWiring;},onResize:function(event,args){var size=args[0];WireIt.sn(this.bodyEl,null,{width:(size[0]-10)+"px",height:(size[1]-44)+"px"});},render:function(){this.el=WireIt.cn('div',{className:this.options.className});if(this.options.width){this.el.style.width=this.options.width+"px";}
if(this.options.height){this.el.style.height=this.options.height+"px";}
Event.addListener(this.el,"mousedown",this.onMouseDown,this,true);if(this.options.ddHandle){this.ddHandle=WireIt.cn('div',{className:this.options.ddHandleClassName});this.el.appendChild(this.ddHandle);if(this.options.title){this.ddHandle.appendChild(WireIt.cn('span',null,null,this.options.title));}
if(this.options.icon){var iconCn=WireIt.cn('img',{src:this.options.icon,className:'WireIt-Container-icon'});this.ddHandle.appendChild(iconCn);}}
this.bodyEl=WireIt.cn('div',{className:"body"});this.el.appendChild(this.bodyEl);if(this.options.resizable){this.ddResizeHandle=WireIt.cn('div',{className:this.options.resizeHandleClassName});this.el.appendChild(this.ddResizeHandle);}
if(this.options.close){this.closeButton=WireIt.cn('div',{className:this.options.closeButtonClassName});this.el.appendChild(this.closeButton);Event.addListener(this.closeButton,"click",this.onCloseButton,this,true);}
this.layer.el.appendChild(this.el);this.el.style.left=this.options.position[0]+"px";this.el.style.top=this.options.position[1]+"px";},setBody:function(content){if(typeof content=="string"){this.bodyEl.innerHTML=content;}
else{this.bodyEl.innerHTML="";this.bodyEl.appendChild(content);}},onMouseDown:function(){if(this.layer){if(this.layer.focusedContainer&&this.layer.focusedContainer!=this){this.layer.focusedContainer.removeFocus();}
this.setFocus();this.layer.focusedContainer=this;}},setFocus:function(){Dom.addClass(this.el,CSS_PREFIX+"Container-focused");},removeFocus:function(){Dom.removeClass(this.el,CSS_PREFIX+"Container-focused");},onCloseButton:function(e,args){Event.stopEvent(e);this.layer.removeContainer(this);},remove:function(){this.removeAllTerminals();this.layer.el.removeChild(this.el);Event.purgeElement(this.el);},initTerminals:function(terminalConfigs){for(var i=0;i<terminalConfigs.length;i++){this.addTerminal(terminalConfigs[i]);}},addTerminal:function(terminalConfig){var type=eval(terminalConfig.xtype||"WireIt.Terminal");var term=new type(this.el,terminalConfig,this);this.terminals.push(term);term.eventAddWire.subscribe(this.onAddWire,this,true);term.eventRemoveWire.subscribe(this.onRemoveWire,this,true);return term;},onAddWire:function(event,args){var wire=args[0];if(WireIt.indexOf(wire,this.wires)==-1){this.wires.push(wire);this.eventAddWire.fire(wire);}},onRemoveWire:function(event,args){var wire=args[0];var index=WireIt.indexOf(wire,this.wires);if(index!=-1){this.eventRemoveWire.fire(wire);this.wires[index]=null;}
this.wires=WireIt.compact(this.wires);},removeAllTerminals:function(){for(var i=0;i<this.terminals.length;i++){this.terminals[i].remove();}
this.terminals=[];},redrawAllWires:function(){for(var i=0;i<this.terminals.length;i++){this.terminals[i].redrawAllWires();}},getConfig:function(){var obj={};obj.position=Dom.getXY(this.el);if(this.layer){var layerPos=Dom.getXY(this.layer.el);obj.position[0]-=layerPos[0];obj.position[1]-=layerPos[1];obj.position[0]+=this.layer.el.scrollLeft;obj.position[1]+=this.layer.el.scrollTop;}
if(this.options.xtype){obj.xtype=this.options.xtype;}
return obj;},getValue:function(){return{};},setValue:function(val){},getTerminal:function(name){var term;for(var i=0;i<this.terminals.length;i++){term=this.terminals[i];if(term.options.name==name){return term;}}
return null;}};})();
/* ========== ../wire-it/js/ImageContainer.js ============ */

WireIt.ImageContainer=function(options,layer){WireIt.ImageContainer.superclass.constructor.call(this,options,layer);};YAHOO.lang.extend(WireIt.ImageContainer,WireIt.Container,{setOptions:function(options){WireIt.ImageContainer.superclass.setOptions.call(this,options);this.options.image=options.image;this.options.xtype="WireIt.ImageContainer";this.options.className=options.className||"WireIt-Container WireIt-ImageContainer";this.options.resizable=(typeof options.resizable=="undefined")?false:options.resizable;this.options.ddHandle=(typeof options.ddHandle=="undefined")?false:options.ddHandle;},render:function(){WireIt.ImageContainer.superclass.render.call(this);YAHOO.util.Dom.setStyle(this.bodyEl,"background-image","url("+this.options.image+")");}});
/* ========== ../wire-it/js/WiringEditor.js ============ */

(function(){var util=YAHOO.util,lang=YAHOO.lang;var Event=util.Event,Dom=util.Dom,Connect=util.Connect,JSON=lang.JSON,widget=YAHOO.widget;WireIt.ModuleProxy=function(el,WiringEditor){this._WiringEditor=WiringEditor;WireIt.ModuleProxy.superclass.constructor.call(this,el,"module",{dragElId:"moduleProxy"});this.isTarget=false;};YAHOO.extend(WireIt.ModuleProxy,YAHOO.util.DDProxy,{startDrag:function(e){WireIt.ModuleProxy.superclass.startDrag.call(this,e);var del=this.getDragEl(),lel=this.getEl();del.innerHTML=lel.innerHTML;del.className=lel.className;},endDrag:function(e){},onDragDrop:function(e,ddTargets){var layerTarget=ddTargets[0],layer=ddTargets[0]._layer,del=this.getDragEl(),pos=YAHOO.util.Dom.getXY(del),layerPos=YAHOO.util.Dom.getXY(layer.el);this._WiringEditor.addModule(this._module,[pos[0]-layerPos[0]+layer.el.scrollLeft,pos[1]-layerPos[1]+layer.el.scrollTop]);}});WireIt.WiringEditor=function(options){this.modulesByName={};this.setOptions(options);this.el=Dom.get(options.parentEl);this.helpPanel=new widget.Panel('helpPanel',{fixedcenter:true,draggable:true,visible:false,modal:true});this.helpPanel.render();this.layout=new widget.Layout(this.el,this.options.layoutOptions);this.layout.render();this.renderAccordion();this.layer=new WireIt.Layer(this.options.layerOptions);this.layer.eventChanged.subscribe(this.onLayerChanged,this,true);this.leftEl=Dom.get('left');this.buildModulesList();this.renderButtons();this.renderSavedStatus();this.renderPropertiesForm();if(this.adapter.init&&YAHOO.lang.isFunction(this.adapter.init)){this.adapter.init();}
this.load();};WireIt.WiringEditor.prototype={setOptions:function(options){this.options={};this.modules=options.modules||[];for(var i=0;i<this.modules.length;i++){var m=this.modules[i];this.modulesByName[m.name]=m;}
this.adapter=options.adapter||WireIt.WiringEditor.adapters.JsonRpc;this.options.languageName=options.languageName||'anonymousLanguage';this.options.propertiesFields=options.propertiesFields||[{"type":"string",inputParams:{"name":"name",label:"Title",typeInvite:"Enter a title"}},{"type":"text",inputParams:{"name":"description",label:"Description",cols:30,rows:4}}];this.options.layoutOptions=options.layoutOptions||{units:[{position:'top',height:50,body:'top'},{position:'left',width:200,resize:true,body:'left',gutter:'5px',collapse:true,collapseSize:25,header:'Modules',scroll:true,animate:true},{position:'center',body:'center',gutter:'5px'},{position:'right',width:320,resize:true,body:'right',gutter:'5px',collapse:true,collapseSize:25,animate:true}]};this.options.layerOptions={};var layerOptions=options.layerOptions||{};this.options.layerOptions.parentEl=layerOptions.parentEl?layerOptions.parentEl:Dom.get('center');this.options.layerOptions.layerMap=YAHOO.lang.isUndefined(layerOptions.layerMap)?true:layerOptions.layerMap;this.options.layerOptions.layerMapOptions=layerOptions.layerMapOptions||{parentEl:'layerMap'};this.options.accordionViewParams=options.accordionViewParams||{collapsible:true,expandable:true,width:'308px',expandItem:0,animationSpeed:'0.3',animate:true,effect:YAHOO.util.Easing.easeBothStrong};},renderAccordion:function(){this.accordionView=new YAHOO.widget.AccordionView('accordionView',this.options.accordionViewParams);},renderPropertiesForm:function(){this.propertiesForm=new inputEx.Group({parentEl:YAHOO.util.Dom.get('propertiesForm'),fields:this.options.propertiesFields});this.propertiesForm.updatedEvt.subscribe(function(){this.markUnsaved();},this,true);},buildModulesList:function(){var modules=this.modules;for(var i=0;i<modules.length;i++){this.addModuleToList(modules[i]);}
if(!this.ddTarget){this.ddTarget=new YAHOO.util.DDTarget(this.layer.el,"module");this.ddTarget._layer=this.layer;}},addModuleToList:function(module){var div=WireIt.cn('div',{className:"WiringEditor-module"});if(module.container.icon){div.appendChild(WireIt.cn('img',{src:module.container.icon}));}
div.appendChild(WireIt.cn('span',null,null,module.name));var ddProxy=new WireIt.ModuleProxy(div,this);ddProxy._module=module;this.leftEl.appendChild(div);},addModule:function(module,pos){try{var containerConfig=module.container;containerConfig.position=pos;containerConfig.title=module.name;var container=this.layer.addContainer(containerConfig);Dom.addClass(container.el,"WiringEditor-module-"+module.name);}
catch(ex){this.alert("Error Layer.addContainer: "+ex.message);}},renderButtons:function(){var toolbar=Dom.get('toolbar');var newButton=new widget.Button({label:"New",id:"WiringEditor-newButton",container:toolbar});newButton.on("click",this.onNew,this,true);var loadButton=new widget.Button({label:"Load",id:"WiringEditor-loadButton",container:toolbar});loadButton.on("click",this.load,this,true);var saveButton=new widget.Button({label:"Save",id:"WiringEditor-saveButton",container:toolbar});saveButton.on("click",this.onSave,this,true);var deleteButton=new widget.Button({label:"Delete",id:"WiringEditor-deleteButton",container:toolbar});deleteButton.on("click",this.onDelete,this,true);var helpButton=new widget.Button({label:"Help",id:"WiringEditor-helpButton",container:toolbar});helpButton.on("click",this.onHelp,this,true);},renderSavedStatus:function(){var top=Dom.get('top');this.savedStatusEl=WireIt.cn('div',{className:'savedStatus',title:'Not saved'},{display:'none'},"*");top.appendChild(this.savedStatusEl);},saveModule:function(){var value=this.getValue();if(value.name===""){this.alert("Please choose a name");return;}
this.tempSavedWiring={name:value.name,working:JSON.stringify(value.working),language:this.options.languageName};this.adapter.saveWiring(this.tempSavedWiring,{success:this.saveModuleSuccess,failure:this.saveModuleFailure,scope:this});},saveModuleSuccess:function(o){this.markSaved();this.alert("Saved !");},saveModuleFailure:function(errorStr){this.alert("Unable to save the wiring : "+errorStr);},alert:function(txt){if(!this.alertPanel){this.renderAlertPanel();}
Dom.get('alertPanelBody').innerHTML=txt;this.alertPanel.show();},onHelp:function(){this.helpPanel.show();},onNew:function(){if(!this.isSaved()){if(!confirm("Warning: Your work is not saved yet ! Press ok to continue anyway.")){return;}}
this.preventLayerChangedEvent=true;this.layer.clear();this.propertiesForm.clear(false);this.markSaved();this.preventLayerChangedEvent=false;},onDelete:function(){if(confirm("Are you sure you want to delete this wiring ?")){var value=this.getValue();this.adapter.deleteWiring({name:value.name,language:this.options.languageName},{success:function(result){this.onNew();this.alert("Deleted !");},failure:function(errorStr){this.alert("Unable to delete wiring: "+errorStr);},scope:this});}},onSave:function(){this.saveModule();},renderLoadPanel:function(){if(!this.loadPanel){this.loadPanel=new widget.Panel('WiringEditor-loadPanel',{fixedcenter:true,draggable:true,width:'500px',visible:false,modal:true});this.loadPanel.setHeader("Select the wiring to load");this.loadPanel.setBody("Filter: <input type='text' id='loadFilter' /><div id='loadPanelBody'></div>");this.loadPanel.render(document.body);Event.onAvailable('loadFilter',function(){Event.addListener('loadFilter',"keyup",this.inputFilterTimer,this,true);},this,true);}},inputFilterTimer:function(){if(this.inputFilterTimeout){clearTimeout(this.inputFilterTimeout);this.inputFilterTimeout=null;}
var that=this;this.inputFilterTimeout=setTimeout(function(){that.updateLoadPanelList(Dom.get('loadFilter').value);},500);},updateLoadPanelList:function(filter){var list=WireIt.cn("ul");if(lang.isArray(this.pipes)){for(var i=0;i<this.pipes.length;i++){var module=this.pipes[i];this.pipesByName[module.name]=module;if(!filter||filter===""||module.name.match(new RegExp(filter,"i"))){list.appendChild(WireIt.cn('li',null,{cursor:'pointer'},module.name));}}}
var panelBody=Dom.get('loadPanelBody');panelBody.innerHTML="";panelBody.appendChild(list);Event.addListener(list,'click',function(e,args){this.loadPipe(Event.getTarget(e).innerHTML);},this,true);},load:function(){this.adapter.listWirings({language:this.options.languageName},{success:function(result){this.onLoadSuccess(result);},failure:function(errorStr){this.alert("Unable to load the wirings: "+errorStr);},scope:this});},onLoadSuccess:function(wirings){this.pipes=wirings;this.pipesByName={};this.renderLoadPanel();this.updateLoadPanelList();if(!this.afterFirstRun){var p=window.location.search.substr(1).split('&');var oP={};for(var i=0;i<p.length;i++){var v=p[i].split('=');oP[v[0]]=window.decodeURIComponent(v[1]);}
this.afterFirstRun=true;if(oP.autoload){this.loadPipe(oP.autoload);return;}}
this.loadPanel.show();},getPipeByName:function(name){var n=this.pipes.length,ret;for(var i=0;i<n;i++){if(this.pipes[i].name==name){try{ret=JSON.parse(this.pipes[i].working);return ret;}
catch(ex){this.alert("Unable to eval working json for module "+name);return null;}}}
return null;},loadPipe:function(name){if(!this.isSaved()){if(!confirm("Warning: Your work is not saved yet ! Press ok to continue anyway.")){return;}}
try{this.preventLayerChangedEvent=true;this.loadPanel.hide();var wiring=this.getPipeByName(name),i;if(!wiring){this.alert("The wiring '"+name+"' was not found.");return;}
this.layer.clear();this.propertiesForm.setValue(wiring.properties,false);if(lang.isArray(wiring.modules)){for(i=0;i<wiring.modules.length;i++){var m=wiring.modules[i];if(this.modulesByName[m.name]){var baseContainerConfig=this.modulesByName[m.name].container;YAHOO.lang.augmentObject(m.config,baseContainerConfig);m.config.title=m.name;var container=this.layer.addContainer(m.config);Dom.addClass(container.el,"WiringEditor-module-"+m.name);container.setValue(m.value);}
else{throw new Error("WiringEditor: module '"+m.name+"' not found !");}}
if(lang.isArray(wiring.wires)){for(i=0;i<wiring.wires.length;i++){this.layer.addWire(wiring.wires[i]);}}}
this.markSaved();this.preventLayerChangedEvent=false;}
catch(ex){this.alert(ex);}},renderAlertPanel:function(){this.alertPanel=new widget.Panel('WiringEditor-alertPanel',{fixedcenter:true,draggable:true,width:'500px',visible:false,modal:true});this.alertPanel.setHeader("Message");this.alertPanel.setBody("<div id='alertPanelBody'></div><button id='alertPanelButton'>Ok</button>");this.alertPanel.render(document.body);Event.addListener('alertPanelButton','click',function(){this.alertPanel.hide();},this,true);},onLayerChanged:function(){if(!this.preventLayerChangedEvent){this.markUnsaved();}},markSaved:function(){this.savedStatusEl.style.display='none';},markUnsaved:function(){this.savedStatusEl.style.display='';},isSaved:function(){return(this.savedStatusEl.style.display=='none');},getValue:function(){var i;var obj={modules:[],wires:[],properties:null};for(i=0;i<this.layer.containers.length;i++){obj.modules.push({name:this.layer.containers[i].options.title,value:this.layer.containers[i].getValue(),config:this.layer.containers[i].getConfig()});}
for(i=0;i<this.layer.wires.length;i++){var wire=this.layer.wires[i];var wireObj={src:{moduleId:WireIt.indexOf(wire.terminal1.container,this.layer.containers),terminal:wire.terminal1.options.name},tgt:{moduleId:WireIt.indexOf(wire.terminal2.container,this.layer.containers),terminal:wire.terminal2.options.name}};obj.wires.push(wireObj);}
obj.properties=this.propertiesForm.getValue();return{name:obj.properties.name,working:obj};}};WireIt.WiringEditor.adapters={};})();
/* ========== ../mkt-ext-2.0/widgets/RSModeler.js ============ */

var RSM_DEBUG=false;var MktRCMer={ANONYMOUS_TYPE:'Anonymous',INVENTORY_TYPE:'Inventory',GATE_TYPE:'Gate',SLA_TYPE:'SLA',PQ_PHASE:'PQ',MQ_PHASE:'MQ',SQ_PHASE:'SQ',SA_PHASE:'SA',CL_PHASE:'CL',stageWidth:110,stageHeight:65,terminalBox:30,palettePadding:15,snapGridSize:25,drawingMethod:"bezierArrows",wireConfig:{drawingMethod:this.drawingMethod},wireWidth:3,wireColor:'#706db2',wireBorderColor:'#FFFFFF',mouseOverWireColor:'#F7941E',mouseOverWireBorderColor:'#F7941E',selectedWireColor:'#d76f00',selectedWireBorderColor:'#FFFFFF',enabledWireColor:'#706db2',enabledWireBorderColor:'#FFFFFF',disabledWireColor:'#DDDDDD',init:function(config){this.palettePanel=config.palette;this.editorPanel=config.editor;this.props=config.props;this.stageProp=this.props.items.items[0];this.transitionProp=this.props.items.items[1];this.palettePadding=config.palettePadding?config.palettePadding:this.palettePadding;this.stageWidth=config.stageWidth?config.stageWidth:this.stageWidth;this.stageHeight=config.stageHeight?config.stageHeight:this.stageHeight;this.wireConfig=config.wireConfig?config.wireConfig:this.wireConfig;leftcssLeft=0-(this.terminalBox/2);leftcssRight=this.stageWidth-(this.terminalBox/2);leftcssCenter=this.stageWidth/2-(this.terminalBox/2);topcssTop=0-(this.terminalBox/2);topcssMiddle=this.stageHeight/2-(this.terminalBox/2)+10;topcssBottom=this.stageHeight-(this.terminalBox/2);this.terminalsConfig=[{direction:[-1,0],editable:true,offsetPosition:{top:topcssMiddle,left:leftcssLeft},wireConfig:this.wireConfig},{direction:[0,-1],editable:true,offsetPosition:{top:topcssTop,left:leftcssCenter},wireConfig:this.wireConfig},{direction:[1,0],editable:true,offsetPosition:{top:topcssMiddle,left:leftcssRight},wireConfig:this.wireConfig},{direction:[0,1],editable:true,offsetPosition:{top:topcssBottom,left:leftcssCenter},wireConfig:this.wireConfig}];this.canvas=config.canvas;this.phasesCode=[this.PQ_PHASE,this.MQ_PHASE,this.SA_PHASE,this.SQ_PHASE,this.CL_PHASE];this.phasesText=['Pre Marketing Qualified','Marketing Qualified','Sales Accepted','Sales Qualified','Closed/Won'];this.isEditable=true;this.isSystem=false;this.isDraft=false;this.isAssigningLeads=false;this.isApproved=false;this.defaultMaxAge=7;this.saveBtn=config.saveBtn;this.menus=config.menus;this.getAction="rcm/getModel";this.saveAction="rcm/saveModel";this.enableAutosave=true;this.enableEventTriggers=true;this.selectedStage=null;this.selectedWire=null;this.mouseOverWire=null;this.moveInProgress=false;this.wireMenu;MktRCMer.stageProp.hide();MktRCMer.transitionProp.hide();},createCanvas:function(){this.layer=new WireIt.Layer({parentEl:this.editorPanel.body});if(Ext.isIE){this.layer.onWireClick=function(e){var lx=e.x,ly=e.y,n=this.wires.length,w;for(var i=0;i<n;i++){w=this.wires[i];var elx=w.element.offsetLeft,ely=w.element.offsetTop;var wireWidth=w.element.width||w.element.offsetWidth;var wireHeight=w.element.height||w.element.offsetHeight;if(lx>=elx&&lx<elx+wireWidth&&ly>=ely&&ly<ely+wireHeight){var rx=lx-elx,ry=ly-ely;w.onClick(rx,ry);}}};}
this.layer.eventContainerDragged.subscribe(MktRCMer.stageMoved,this,true);this.layer.eventRemoveContainer.subscribe(MktRCMer.stageDeleted,this,true);Ext.EventManager.on(this.layer.el,'click',MktRCMer.layerClicked,this,[this.layer]);return this.layer;},layerClicked:function(e,target,params){if(MktRCMer.layer.skipEvent){MktRCMer.layer.skipEvent=false;return;}
if(MktRCMer.selectedStage){MktRCMer.selectedStage.removeFocus();MktRCMer.selectedStage=null;}
if(MktRCMer.selectedWire){MktRCMer.wireSelect(MktRCMer.selectedWire,false);MktRCMer.selectedWire=null;}
MktRCMer.clearAllProperties();},resetPalette:function(type,reason){var pal=Ext.get('rcmPalette');if(pal==null){return;}
var offsets=pal.getOffsetsTo(MktRCMer.layer.el);var xOffset=offsets[0];var yOffset=offsets[1];var xy=pal.getXY();this.paletteClientX=xy[0];this.paletteClientY=xy[1];if(!isDefined(type)){var type='all';}
MktRCMer.buildFloatingPalette('palette1',this.INVENTORY_TYPE,'Inventory');MktRCMer.buildFloatingPalette('palette3',this.SLA_TYPE,'SLA');MktRCMer.buildFloatingPalette('palette2',this.GATE_TYPE,'Gate');},buildFloatingPalette:function(id,type,caption){var pal=Ext.get('rcmPalette');if(pal==null){return;}
var div=WireIt.cn('div',{className:"WiringEditor-module"});if(type==this.INVENTORY_TYPE){div.appendChild(WireIt.cn('div',{className:"inventoryIcon16"}));}
if(type==this.GATE_TYPE){div.appendChild(WireIt.cn('div',{className:"gateIcon16"}));}
if(type==this.SLA_TYPE){div.appendChild(WireIt.cn('div',{className:"slaIcon16"}));}
div.appendChild(WireIt.cn('span',null,null,caption));var ddProxy=new WireIt.ModuleProxy(div,pal);ddProxy.startDrag=function(e){WireIt.ModuleProxy.superclass.startDrag.call(this,e);this.maxX=document.width-MktRCMer.stageWidth;this.maxY=document.height-MktRCMer.stageHeight;this.minX=0;this.minY=0;this.constrainX=true;this.constrainY=true;var del=this.getDragEl(),lel=this.getEl();del.innerHTML=lel.innerHTML;del.className=lel.className;},ddProxy.endDrag=function(e){if(MktRCMer.isEditable){MktRCMer.stageAdded(this.lastPageX,this.lastPageY,id,type);}};this.palettePanel.body.insertFirst(div);},setIcons:function(stage){var type=stage.options.type;var trackCssFlag=stage.options.isTrackByAcct==true?'Track':'';switch(type){case this.ANONYMOUS_TYPE:stage.setBody("<div class='anonymousIcon"+trackCssFlag+"'></div>");break;case this.INVENTORY_TYPE:stage.setBody("<div class='"+(stage.options.isKnown?'inventoryKnownIcon':'inventoryIcon')+trackCssFlag+"'></div>");break;case this.GATE_TYPE:stage.setBody("<div class='gateIcon"+trackCssFlag+"'></div>");break;case this.SLA_TYPE:stage.setBody("<div class='"+(stage.options.isKnown?'slaKnownIcon':'slaIcon')+trackCssFlag+"'></div>");break;default:break;}},attachTerminalListeners:function(contnr,event,func){if(event=='eventAddWire'){for(var i=0;i<contnr.terminals.length;i++){contnr.terminals[i].eventAddWire.subscribe(func,true,true);Ext.EventManager.on(contnr.terminals[i].el,'mouseover',MktRCMer.terminalMouseOver,this,[contnr.terminals[i]]);if(contnr.terminals[i].scissors){contnr.terminals[i].scissors.destroy();}}}},refakeDirection:function(stage){if(stage.options.isSuccessPath){stage.terminals[1].options.fakeDirection=[0,-1];}else{stage.terminals[1].options.fakeDirection=[0,1];}},loadModel:function(){var compId=MktCanvas.activeTab.config.compId;var parms={compId:compId,approved:(window.location.search.indexOf('approved=true')!=-1)?true:false};MktSession.ajaxRequest(this.getAction,{serializeParms:parms,onMySuccess:this.loadSuccess.createDelegate(this),onMyFailure:this.loadFailure.createDelegate(this)});},loadSuccess:function(){var modelDataJson=Ext.decode(MktPage.appVars.modelData);this.isEditable=(window.location.search.indexOf('preview=true')!=-1)?false:modelDataJson.isEditable;this.isSystem=modelDataJson.isSystem;this.isDraft=modelDataJson.isDraft;this.isAssigningLeads=modelDataJson.isAssigningLeads;this.isApproved=modelDataJson.isApproved;this.buildStages(modelDataJson.stages);this.buildTransitions(modelDataJson.transitions);if(!this.isEditable){this.saveBtn.hide();this.menus.validateBtn.setDisabled(true);this.palettePanel.setDisabled(true);}else{this.saveBtn.show();this.menus.phasesBtn.setDisabled(false);this.menus.validateBtn.setDisabled(false);this.palettePanel.setDisabled(false);}
MktCanvas.unmask(this.canvas);},loadFailure:function(){if(RSM_DEBUG){console.debug('Failed Loading Model!');}},buildStage:function(config){if(config.type==this.ANONYMOUS_TYPE||!MktRCMer.isEditable){this.terminalsConfig[0].editable=false;this.terminalsConfig[1].editable=false;this.terminalsConfig[2].editable=false;this.terminalsConfig[3].editable=false;}else{this.terminalsConfig[0].editable=!config.isKnown;this.terminalsConfig[1].editable=true;this.terminalsConfig[2].editable=true;this.terminalsConfig[3].editable=true;}
var newStage=MktRCMer.layer.addContainer({terminals:this.terminalsConfig,title:config.name,width:this.stageWidth,height:this.stageHeight,close:config.deleteAllowed,draggable:(config.type==this.ANONYMOUS_TYPE||!MktRCMer.isEditable)?false:true,resizable:false,position:config.position});MktRCMer.changeTitle(newStage,config.name);newStage.options.id=config.id;newStage.options.description=config.description||'';newStage.options.type=config.type;newStage.options.isSuccessPath=config.isSuccessPath;newStage.options.isTrackByAcct=config.isTrackByAcct;newStage.options.isKnown=config.isKnown;newStage.options.phase=config.phase;newStage.options.timeValue=config.timeValue||this.defaultMaxAge;if(newStage.dd){newStage.dd.setHandleElId(newStage.el);newStage.ddHandle.style.cursor="move";newStage.el.style.cursor="move";}
MktRCMer.setIcons(newStage);this.attachTerminalListeners(newStage,'eventAddWire',MktRCMer.addedWire);if(newStage.options.isSuccessPath){this.refakeDirection(newStage);}
Ext.EventManager.on(newStage.el,'click',MktRCMer.stageClicked,this,[newStage]);Ext.EventManager.on(newStage.el,'contextmenu',MktRCMer.stageContextMenu,this,[newStage]);return newStage;},buildStages:function(stagesArray){if(RSM_DEBUG)console.debug("loading "+stagesArray.length+" stages ");for(var i=0;i<stagesArray.length;i++){var deleteAllowed=true;if(stagesArray[i].type==this.ANONYMOUS_TYPE||stagesArray[i].isKnown){deleteAllowed=false;}
var config={id:stagesArray[i].id,name:stagesArray[i].name,description:stagesArray[i].description,type:stagesArray[i].type,position:stagesArray[i].position,isSuccessPath:stagesArray[i].isSuccessPath,isTrackByAcct:stagesArray[i].isTrackByAcct,isKnown:stagesArray[i].isKnown,phase:stagesArray[i].phase,timeValue:stagesArray[i].timeValue?stagesArray[i].timeValue:0,deleteAllowed:deleteAllowed}
var newStage=MktRCMer.buildStage(config);}},buildTransitions:function(transitionsArray){this.enableEventTriggers=false;if(RSM_DEBUG)console.debug("loading "+transitionsArray.length+" transitions ");for(var i=0;i<transitionsArray.length;i++){if(transitionsArray[i].fromStage!=null&&transitionsArray[i].toStage!=null){var fromStage=this.findStageById(transitionsArray[i].fromStage.id);var toStage=this.findStageById(transitionsArray[i].toStage.id);var fromTerminal=fromStage.terminals[transitionsArray[i].fromStage.terminal];var toTerminal=toStage.terminals[transitionsArray[i].toStage.terminal];var newWire=new WireIt.Wire(fromTerminal,toTerminal,this.layer.el);newWire.options.drawingMethod=this.drawingMethod;newWire.options.color=this.disabledWireColor;newWire.options.width=this.wireWidth;newWire.options.bordercolor=this.wireBorderColor;newWire.options.id=transitionsArray[i].id;newWire.options.description=transitionsArray[i].description?transitionsArray[i].description:'';newWire.options.isEnabled=transitionsArray[i].isEnabled;newWire.options.campaign=transitionsArray[i].campaign;newWire.options.smartListSummary=transitionsArray[i].smartListSummary;if(transitionsArray[i].isEnabled){newWire.options.color=this.enabledWireColor;}
newWire.redraw();Ext.EventManager.on(newWire.element,'contextmenu',MktRCMer.wireContextMenu,this,[newWire]);}}
this.enableEventTriggers=true;},stageClicked:function(e,target,params){if(e){e.stopEvent();}
if(this.selectedStage!=null){MktRCMer.changeStage();}
var stage=params[0];stage.onMouseDown();if(MktRCMer.selectedWire!=null){MktRCMer.wireSelect(MktRCMer.selectedWire,false);MktRCMer.selectedWire=null;}
this.stageProp.hide();this.transitionProp.hide();MktRCMer.menus.transitionBtn.disable();MktRCMer.props.setTitle("Stage Properties");var stageProp=this.stageProp;var nameField=stageProp.findById('stageName');var descriptionField=stageProp.findById('stageDescription');var typeField=stageProp.findById('stageType');var typeAge=stageProp.findById('stageAge');var trackAcc=stageProp.findById('stageTrackAcct');nameField.setValue(Ext.util.Format.htmlDecode(stage.options.title));descriptionField.setValue(Ext.util.Format.htmlDecode(stage.options.description));typeField.setValue(stage.options.type);trackAcc.setValue(stage.options.isTrackByAcct);typeAge.setValue(stage.options.timeValue);var beingTracked=false;if(stage.options.isSuccessPath&&this.getPreviousSuccessPathStage(stage)&&this.getPreviousSuccessPathStage(stage).options.isTrackByAcct){beingTracked=true;}
if(stage.options.type==this.GATE_TYPE){typeAge.container.parent().hide();this.changePropIcons(this.GATE_TYPE);typeField.setDisabled(true);trackAcc.setDisabled(!this.isEditable);}else if(stage.options.type==this.SLA_TYPE){typeAge.container.parent().show();this.changePropIcons(this.SLA_TYPE);typeField.setDisabled(!this.isEditable);trackAcc.setDisabled(!this.isEditable||stage.options.isKnown);}else if(stage.options.type==this.ANONYMOUS_TYPE){typeAge.container.parent().hide();this.changePropIcons(this.ANONYMOUS_TYPE);typeField.setDisabled(true);trackAcc.setDisabled(true);}else{typeAge.container.parent().hide();this.changePropIcons(this.INVENTORY_TYPE);typeField.setDisabled(!this.isEditable);trackAcc.setDisabled(!this.isEditable||stage.options.isKnown);}
this.selectedStage=stage;this.stageProp.show();nameField.setDisabled(!this.isEditable||stage.options.type==this.ANONYMOUS_TYPE);descriptionField.setDisabled(!this.isEditable||stage.options.type==this.ANONYMOUS_TYPE);typeAge.setDisabled(!this.isEditable);if(beingTracked){trackAcc.setDisabled(true);}
if(this.isEditable){MktRCMer.menus.stageBtn.enable();}
nameField.focus();},isOKtoDrop:function(x,y){var additionalPadding=0;if(x>0&&y>0){return true;}
return false;},stageContextMenu:function(e,target,params){e.preventDefault();var stage=params[0];MktRCMer.menus.stageMenu.stageId=stage.options.id;if(MktRCMer.isEditable){MktRCMer.menus.stageMenu.showAt(e.xy);}},stageAdded:function(x,y,id,type){var oX=this.palettePanel.el.dom.offsetLeft;var oY=this.palettePanel.el.dom.offsetHeight;var xy=this.editorPanel.el.getXY();var newOffsetX=x-xy[0]+this.layer.el.scrollLeft;var newOffsetY=y-xy[1]+this.layer.el.scrollTop;if(this.isOKtoDrop(newOffsetX,newOffsetY)){var newStageNumber=this.layer.containers.length+1;var newTitle="stage-"+newStageNumber;if(newTitle==null){return;}
var config={id:"new-"+Ext.id(),name:newTitle,description:'',type:type,position:[newOffsetX,newOffsetY],isSuccessPath:false,isTrackByAcct:false,phase:'',deleteAllowed:true}
var newStage=MktRCMer.buildStage(config);this.snapToGrid(newStage,newOffsetX,newOffsetY);MktSession.clockCursor(true);this.autosave("stagenew",newStage.options.id,false);this.stageClicked(null,null,[newStage]);}},stageMoved:function(e,params){var stage=params[0];var lastX=stage.dd.lastPageX;var lastY=stage.dd.lastPageY;var xDelta=stage.dd.startPageX-lastX;var yDelta=stage.dd.startPageY-lastY;var newOffsetX=stage.options.position[0]-xDelta;var newOffsetY=stage.options.position[1]-yDelta;if(!this.isOKtoDrop(newOffsetX,newOffsetY)){var moveBack=new WireIt.util.Anim(stage.terminals,stage.el,{top:{to:stage.options.position[1]},left:{to:stage.options.position[0]}},.25,YAHOO.util.Easing.easeOut);moveBack.animate();}else{if(newOffsetX<0){newOffsetX=0;}
if(newOffsetY<0){newOffsetY=0;}
this.snapToGrid(stage,newOffsetX,newOffsetY);id=stage.options.id;if(stage.options.isSuccessPath){var previousStage=this.getPreviousSuccessPathStage(stage);if(previousStage&&previousStage.options.isTrackByAcct&&!stage.options.isTrackByAcct){this.setTrackByAccount(previousStage);this.stageClicked(null,null,[stage]);}}
this.autosave("stagemoved",id,false);}},snapToGrid:function(container,x,y){x=Math.round(x/this.snapGridSize)*this.snapGridSize;y=Math.round(y/this.snapGridSize)*this.snapGridSize;var snap=new WireIt.util.Anim(container.terminals,container.el,{top:{to:y},left:{to:x}},.25,YAHOO.util.Easing.easeOut);snap.animate();container.options.position=[x,y];container.options.isSuccessPath=false;if(container.layer.containers[0].options.type==this.ANONYMOUS_TYPE){if(y==container.layer.containers[0].options.position[1]){container.options.isSuccessPath=true;}}
this.refakeDirection(container);},clearAllProperties:function(){MktRCMer.stageProp.hide();MktRCMer.menus.stageBtn.disable();MktRCMer.transitionProp.hide();MktRCMer.menus.transitionBtn.disable();MktRCMer.changePropIcons('');MktRCMer.props.setTitle("Properties <i> (select Stage or Transition)</i>");},stageDeleteConfirm:function(el){var stageId=MktRCMer.menus.stageMenu.stageId;if(isDefined(stageId)&&stageId!=null){var stage=MktRCMer.findStageById(stageId);}else{var stage=MktRCMer.selectedStage;}
var name=stage.options.title;if(stage.options.type==MktRCMer.ANONYMOUS_TYPE||stage.options.isKnown){MktMessage.showInfo('<b>\''+name+'\'</b> stage cannot be deleted');return;}
MktMessage.confirmDelete("Confirm",'Are you sure you want to delete stage <b>\''+name+'\'</b>?',MktRCMer.stageDoDelete.createDelegate(this,[stage]));},stageDoDelete:function(stage){MktRCMer.layer.removeContainer(stage);MktRCMer.clearAllProperties();},stageDeleted:function(e,params){var container=params[0];var id=container.options.id;var mergeToId=container.options.mergeToId;this.autosave("stagedeleted",id,false,mergeToId);},stageMergeConfirm:function(el){var stageId=MktRCMer.menus.stageMenu.stageId;if(isDefined(stageId)&&stageId!=null){var stage=MktRCMer.findStageById(stageId);}else{var stage=MktRCMer.selectedStage;stageId=stage.options.id;}
var name=stage.options.title;if(stage.options.type==MktRCMer.ANONYMOUS_TYPE||stage.options.isKnown){MktMessage.showInfo('<b>\''+name+'\'</b> stage cannot be merged');return;}
stage.options.mergeToId=null;var select='<select id="mergeStageSelect"><option value="-1">None</option>';for(var i=0;i<this.layer.containers.length;i++){var stageOptions=this.layer.containers[i].options;if(stageOptions.id!="palette"&&stageOptions.id!=stageId&&stageOptions.type!=this.ANONYMOUS_TYPE){select+='<option value="'+stageOptions.id+'">'+stageOptions.title+'</option>';}}
select+='</select>';var dialog=new MktModalForm({renderer:function(el,unused){Ext.DomHelper.append(el,'<div id="rsmMergeStageForm">'+'  <form">'+'    <h2><div style="font-family: arial, helvetica, sans-serif; font-size: 14px">Some leads may be in this stage.  Choose a destination<br/>stage for them.</div></h2>'+'    <!-- General Form table -->'+'    <table border="0" cellpadding="0" cellspacing="0" class="mktForm2" style="margin-top: 10px">'+'      <tr>'+'        <td class="mktForm2Label" style="width: 105px; padding-top: 15px">Merge Stage to:</td>'+'        <td class="mktForm2Field">'+
select+'        </td>'+'      </tr>'+'    </table>'+'  </form>'+'  <div style="font-family: arial, helvetica, sans-serif; font-size: 14px; margin-top: 40px">Note: Changes take effect after the draft model is approved</div>'+'</div>');},title:'Merge Stage',iconCls:'mkiBoxPrevious',okButtonTitle:'Merge',width:450,height:250});dialog.on('load',function(dlg){this.mergeSelect=new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',transform:'mergeStageSelect',forceSelection:true});});dialog.show(el,MktRCMer.stageDoMerge.createDelegate(this,[stage,dialog]));},stageDoMerge:function(stage,dialog){MktSession.clockCursor(true);var mergeToId=parseInt(dialog.mergeSelect.getValue());if(mergeToId!=0){stage.options.mergeToId=mergeToId;}
MktRCMer.layer.removeContainer(stage);MktRCMer.clearAllProperties();},wireDeleteConfirm:function(el){var wire=MktRCMer.selectedWire;var fromName=wire.terminal1.container.options.title;var toName=wire.terminal2.container.options.title;if(wire.terminal1.container.options.type==MktRCMer.ANONYMOUS_TYPE&&wire.terminal2.container.options.isKnown){MktMessage.showInfo('<b>\''+fromName+' &rArr; '+toName+'\'</b> transition cannot be deleted');return;}
MktMessage.confirmDelete("Confirm",'Are you sure you want to delete the transition from <b>'+fromName+' &rArr; '+toName+'</b>?',MktRCMer.wireDoDelete.createDelegate(this,[wire]));},wireDoDelete:function(wire){var wireId=wire.options.id;wire.remove();MktRCMer.autosave("wiredeleted",wireId,false);MktRCMer.selectedWire=null;MktRCMer.clearAllProperties();},wireDeleted:function(e,params){var wire=params[0];var id=wire.options.id;if(isDefined(id)){this.autosave("wiredeleted",id,false);}},addedWire:function(e,params){var wire=params[0];if(isDefined(wire.terminal1.parentEl)&&isDefined(wire.terminal2.parentEl)&&!isDefined(wire.options.id)){if(MktRCMer.moveInProgress&&MktRCMer.selectedWire!=null){wire.options.id=MktRCMer.selectedWire.options.id;wire.options.description=MktRCMer.selectedWire.options.description;wire.options.isEnabled=MktRCMer.selectedWire.options.isEnabled;wire.options.smartListSummary=MktRCMer.selectedWire.options.smartListSummary;MktRCMer.movedWire(wire);}else{wire.options.id="new-"+Ext.id();wire.options.description='';wire.options.isEnabled=true;wire.options.smartListSummary=[{name:"No rules defined",conditions:[]}];}
wire.eventMouseIn.subscribe(MktRCMer.wireMouseOver,wire,true);wire.eventMouseOut.subscribe(MktRCMer.wireMouseOut,wire,true);wire.eventMouseClick.subscribe(MktRCMer.wireClick,wire,true);Ext.EventManager.on(wire.element,'contextmenu',MktRCMer.wireContextMenu,this,[wire]);Ext.EventManager.on(wire.element,'dblclick',MktRCMer.wireDoubleClick,this,[wire]);if(wire.terminal1.container.options.isSuccessPath&&wire.terminal2.container.options.isSuccessPath){if(wire.terminal1.container.options.isTrackByAcct&&!wire.terminal2.container.options.isTrackByAcct){MktRCMer.setTrackByAccount(wire.terminal1.container);}}
if(MktRCMer.enableEventTriggers){var autoSave=new Ext.util.DelayedTask(function(){MktSession.clockCursor(true);MktRCMer.autosave("wireadded",wire.options.id,false);}).delay(10);}}},movedWire:function(wire){MktRCMer.selectedTerminal1.removeWire(MktRCMer.selectedWire);MktRCMer.selectedTerminal2.removeWire(MktRCMer.selectedWire);MktRCMer.selectedTerminal1=null;MktRCMer.selectedTerminal2=null;MktRCMer.moveInProgress=false;MktRCMer.selectedWire=null;MktRCMer.wireClick("wireClick",[wire]);},restoreWire:function(){if(MktRCMer.selectedWire.moveTerminal==1){MktRCMer.selectedWire.terminal1=MktRCMer.selectedTerminal1;}else if(MktRCMer.selectedWire.moveTerminal==2){MktRCMer.selectedWire.terminal2=MktRCMer.selectedTerminal2;}
var wireId=MktRCMer.selectedWire.options.id;MktRCMer.selectedWire.remove();MktRCMer.enableEventTriggers=false;MktRCMer.selectedWire=new WireIt.Wire(MktRCMer.selectedTerminal1,MktRCMer.selectedTerminal2,this.layer.el);MktRCMer.selectedWire.options.drawingMethod=this.drawingMethod;MktRCMer.selectedWire.options.id=wireId;MktRCMer.selectedWire.redraw();MktRCMer.enableEventTriggers=true;MktRCMer.selectedTerminal1=null;MktRCMer.selectedTerminal2=null;MktRCMer.wireSelect(MktRCMer.selectedWire,true);MktRCMer.moveInProgress=false;},autoSaveConfig:{nochangeText:'<span class="mktAutoSavedText">Auto-Save: </span> no changes',nochangeIconCls:'mkiFloppyDisk',savingText:'<span class="mktAutoSavedText">Auto-Save: </span> saving...',savingIconCls:'mkiFloppyDisk',savedText:'<span class="mktAutoSavedText">Auto-Save: </span> ',savedIconCls:'mkiFloppyDisk',errorText:'<span class="mktAutoSavedText">Auto-Save: </span> error',errorIconCls:'mkiFloppyDiskError',highlightColor:'#c3daf9'},validationErrorMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.errorText,cfg.errorIconCls);},beforeSaveMessage:function(){var cfg=this.autoSaveConfig;this.setSaveMessage(cfg.savingText,cfg.savingIconCls);},afterSaveMessage:function(){var cfg=this.autoSaveConfig;var dt=new Date();this.setSaveMessage(cfg.savedText+dt.format('M j, h:ia'),cfg.savedIconCls);},autosave:function(cause,id,acceptUpdates,p1){if(!this.enableAutosave){return;}
switch(cause){case"stagenew":this.saveStage(id);break;case"stagemoved":this.saveStage(id);break;case"stagedeleted":this.deleteStage(id,p1);break;case"wireadded":this.saveWire(id);break;case"wiredeleted":this.deleteWire(id);break;default:this.save();break;}},save:function(cause,dp,acceptUpdates){var compId=MktCanvas.activeTab.config.compId;var rcmJson=Ext.util.JSON.encode(this.preSave());var parms={compId:compId,rcmJson:rcmJson};this.beforeSaveMessage();MktSession.ajaxRequest(this.saveAction,{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this),onMyFailure:this.saveFailure.createDelegate(this)});},changeStage:function(){var stageProp=this.stageProp;if(this.stageProp.hidden){return;}
var foundChanges=false;var nameField=stageProp.findById('stageName');var descriptionField=stageProp.findById('stageDescription');var stageType=stageProp.findById('stageType');var stageTrackAccountField=stageProp.findById('stageTrackAcct');var timeValueField=stageProp.findById('stageAge');if(this.selectedStage.options.title!=Ext.util.Format.htmlEncode(nameField.getValue())){this.changeTitle(this.selectedStage,Ext.util.Format.htmlEncode(nameField.getValue()));foundChanges=true;}
if(this.selectedStage.options.description!=Ext.util.Format.htmlEncode(descriptionField.getValue())){this.selectedStage.options.description=Ext.util.Format.htmlEncode(descriptionField.getValue());foundChanges=true;}
if(this.selectedStage.options.type!=stageType.getValue()){this.selectedStage.options.type=stageType.getValue();this.setIcons(this.selectedStage);if(this.selectedStage.options.type==this.INVENTORY_TYPE){this.changePropIcons(this.INVENTORY_TYPE);timeValueField.container.parent().hide();}else if(this.selectedStage.options.type==this.SLA_TYPE){this.changePropIcons(this.SLA_TYPE);timeValueField.container.parent().show();}
foundChanges=true;}
if(this.selectedStage.options.timeValue!=timeValueField.getValue()){this.selectedStage.options.timeValue=timeValueField.getValue();foundChanges=true;}
if(this.selectedStage.options.isTrackByAcct!=stageTrackAccountField.getValue()){this.selectedStage.options.isTrackByAcct=stageTrackAccountField.getValue();foundChanges=true;this.setTrackByAccount(this.selectedStage);this.setIcons(this.selectedStage);}
if(foundChanges){this.saveStage(this.selectedStage.options.id);}},changePropIcons:function(type){MktRCMer.props.el.dom.setAttribute('type',type);MktRCMer.props.setIconClass(type!=''?type.toLowerCase()+'Icon16':'');if(Ext.isIE){MktRCMer.props.body.dom.lastChild.focus();}},setTrackByAccount:function(stage){if(stage.options.isSuccessPath){var nextStage=this.getNextSuccessPathStage(stage);while(nextStage!=null){if(nextStage.options.isTrackByAcct!=stage.options.isTrackByAcct){nextStage.options.isTrackByAcct=stage.options.isTrackByAcct;this.setIcons(nextStage);this.saveStage(nextStage.options.id);if(nextStage.options.id==this.selectedStage.options.id){var trackAcc=this.stageProp.findById('stageTrackAcct');trackAcc.setValue(stage.options.isTrackByAcct);trackAcc.setDisabled(stage.options.isTrackByAcct);}}
nextStage=this.getNextSuccessPathStage(nextStage);}}},getNextSuccessPathStage:function(stage){var stages=this.getSiblingStage(stage,2,true,true);if(stages.length>0){return stages[0];}
return null;},getPreviousSuccessPathStage:function(stage){var stages=this.getSiblingStage(stage,0,false,true);if(stages.length>0){return stages[0];}
return null;},getSiblingStage:function(stage,terminal,arrowOut,onSuccessPath){var testStage=null;var stages=[];if(arrowOut){var atTerminal="terminal2";}else{var atTerminal="terminal1";}
for(var i=0;i<stage.terminals[terminal].wires.length;i++){eval("testStage = stage.terminals[terminal].wires["+i+"]."+atTerminal+".container");if(arrowOut&&stage.options.id==testStage.options.id||!arrowOut&&stage.options.id==testStage.options.id){continue;}
if(onSuccessPath){if(testStage.options.isSuccessPath){stages.push(testStage);}}else{stages.push(testStage);}}
return stages;},changeTitle:function(container,title){var spanClass="";if(title.length>12){spanClass="longTitle";}
container.options.title=title;container.ddHandle.innerHTML="<span class='"+spanClass+"'>"+title+"</span>";if(spanClass==""&&container.ddHandle.firstChild.offsetHeight>30){spanClass="longTitle";container.ddHandle.innerHTML="<span class='"+spanClass+"'>"+title+"</span>";}},saveStage:function(stageId){var compId=MktCanvas.activeTab.config.compId;var stageJson=Ext.util.JSON.encode(this.stagesToJson(stageId));var parms={compId:compId,stageId:stageId,stageJson:stageJson};this.beforeSaveMessage();MktSession.ajaxRequest("rcm/saveStage",{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this,['saveStage',stageId]),onMyFailure:this.saveFailure.createDelegate(this)});},deleteStage:function(stageId,mergeToId){if(isNaN(stageId)&&stageId.indexOf('palette')!=-1){return;}
var compId=MktCanvas.activeTab.config.compId;var parms={compId:compId,stageId:stageId};if(isDefined(mergeToId)){parms.mergeToId=mergeToId;}
this.beforeSaveMessage();MktSession.ajaxRequest("rcm/deleteStage",{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this),onMyFailure:this.saveFailure.createDelegate(this)});},editWireRules:function(el){var wire=MktRCMer.selectedWire;var canvas=MktCanvas.getItem('cp_rcmCanvasCampaign');if(isDefined(canvas)){canvas.config.contentValid=false;}
var compId=MktCanvas.activeTab.config.compId;var context={};context.name=""+wire.terminal1.container.options.title+" &rArr; "+wire.terminal2.container.options.title+"";if(wire.terminal1.container.options.type==MktRCMer.ANONYMOUS_TYPE&&wire.terminal2.container.options.isKnown){MktMessage.showInfo('<b>\''+context.name+'\'</b> transition rules cannot be edited');return;}
context.compId=compId;context.transitionId=wire.options.id;MktMainNav.loadRCMTransition(context);},changeWire:function(){var foundChanges=false;var transitionProp=this.transitionProp;var descriptionField=transitionProp.findById('transitionDescription');var enabledField=transitionProp.findById('transitionEnabled');if(this.selectedWire.options.description!=descriptionField.getValue()){this.selectedWire.options.description=descriptionField.getValue();foundChanges=true;}
if(this.selectedWire.options.isEnabled!=!enabledField.getValue()){this.selectedWire.options.isEnabled=!enabledField.getValue();foundChanges=true;}
if(foundChanges){this.saveWire(this.selectedWire.options.id);}},saveWire:function(wireId){var compId=MktCanvas.activeTab.config.compId;var wireJson=Ext.util.JSON.encode(this.transitionsToJson(wireId));var parms={compId:compId,wireId:wireId,wireJson:wireJson};this.beforeSaveMessage();MktSession.ajaxRequest("rcm/saveTransition",{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this,['saveWire',wireId]),onMyFailure:this.saveFailure.createDelegate(this)});},deleteWire:function(wireId){var compId=MktCanvas.activeTab.config.compId;var parms={compId:compId,wireId:wireId};this.beforeSaveMessage();MktSession.ajaxRequest("rcm/deleteTransition",{serializeParms:parms,onMySuccess:this.saveSuccess.createDelegate(this),onMyFailure:this.saveFailure.createDelegate(this)});},saveSuccess:function(type,oldId){if(isDefined(oldId)&&isNaN(oldId)){if(type=='saveStage'){this.replaceStageId(oldId,MktPage.appVars.stageId);}
if(type=='saveWire'){this.replaceTransitionId(oldId,MktPage.appVars.transitionId);}}
MktSession.clockCursor(false);this.afterSaveMessage();},saveFailure:function(){this.validationErrorMessage();},setSaveMessage:function(msg,iconCls){if(this.canvas){this.saveBtn.setText(msg);this.saveBtn.setIconClass(iconCls);}},wireMouseOver:function(){if(this!=MktRCMer.selectedWire){}
this.element.style.cursor='pointer';this.options.width=MktRCMer.wireWidth+2;this.redraw();},wireMouseOut:function(){if(this!=MktRCMer.selectedWire){}
this.element.style.cursor='auto';this.options.width=MktRCMer.wireWidth;this.redraw();},terminalMouseOver:function(e,target,params){var terminal=params[0];for(var i=0;i<terminal.wires.length;i++){if(terminal.wires[i].options.width>MktRCMer.wireWidth){terminal.wires[i].options.width=MktRCMer.wireWidth;terminal.wires[i].redraw();}}},buildWireMenu:function(){this.wireMenu=new Ext.menu.Menu({items:[{text:'Edit Transition',iconCls:'mkiEdit',handler:function(el){var wireId=el.parentMenu.wireId;var wire=MktRCMer.findWireById(wireId);MktRCMer.editWireRules(wire);}},{text:'Delete',iconCls:'mkiDelete2',handler:function(el){var wireId=el.parentMenu.wireId;var wire=MktRCMer.findWireById(wireId);wire.remove();MktRCMer.autosave("wiredeleted",wireId,false);MktRCMer.selectedWire=null;}}]});},wireClick:function(e,params){var wire=params[0];var xy=params[1];var sameWire=false;var anonToKnown=false;if(wire.terminal1.container.options.type==MktRCMer.ANONYMOUS_TYPE&&wire.terminal2.container.options.isKnown){anonToKnown=true;}
MktRCMer.layer.skipEvent=true;if(MktRCMer.selectedStage){MktRCMer.selectedStage.removeFocus();MktRCMer.selectedStage=null;}
if(MktRCMer.selectedWire!=null){MktRCMer.wireSelect(MktRCMer.selectedWire,false);MktRCMer.selectedWire=null;}
MktRCMer.selectedWire=wire;MktRCMer.wireSelect(MktRCMer.selectedWire,true);var tranProp=MktRCMer.transitionProp;var tranNameField=tranProp.findById('transitionName');var tranDescriptionField=tranProp.findById('transitionDescription');var enabledField=tranProp.findById('transitionEnabled');tranNameField.setValue(Ext.util.Format.htmlDecode(wire.terminal1.container.options.title+' --> '+wire.terminal2.container.options.title));tranDescriptionField.setValue(Ext.util.Format.htmlDecode(wire.options.description));MktRCMer.wireUpdateCampaign(wire);enabledField.setValue(!wire.options.isEnabled);MktRCMer.props.setTitle("Transition Properties");MktRCMer.stageProp.hide();MktRCMer.menus.stageBtn.disable();MktRCMer.changePropIcons('wire');tranDescriptionField.setDisabled(!MktRCMer.isEditable||anonToKnown);enabledField.setDisabled(!MktRCMer.isEditable||anonToKnown);MktRCMer.transitionProp.show();if(MktRCMer.isEditable){MktRCMer.menus.transitionBtn.enable();}},wireUpdateCampaign:function(wire){if(MktRCMer.selectedWire==null||MktRCMer.selectedWire.options.id!=wire.options.id){return;}
var tooltips='';var tranCampaignField=Ext.getDom('transitionCampaign');var campaignHTML="<table width=\"100%\" cellspacing=\"0\">";for(var i=0;i<wire.options.smartListSummary.length;i++){var rowSpan=wire.options.smartListSummary[i].conditions.length;var cellCssClass='';if(rowSpan==0){rowSpan=1;}
if(wire.options.smartListSummary[i].error){cellCssClass='rulesErrorCell';tooltips+="new Ext.ToolTip({target: 'sls-"+i+"', html: '"+String.escape(wire.options.smartListSummary[i].error)+"', iconCls:'mkiSignWarning', anchor: 'right'});";}
campaignHTML+="<tr class=\"rulesDivider\">";campaignHTML+="<td id=\"sls-"+i+"\" valign=\"top\"  rowspan=\""+rowSpan+"\" class=\""+cellCssClass+"\">"+wire.options.smartListSummary[i].name+"</td>";if(wire.options.smartListSummary[i].conditions.length==0){campaignHTML=campaignHTML+"<td>&nbsp;</td>";}
for(var j=0;j<wire.options.smartListSummary[i].conditions.length;j++){if(j==0){campaignHTML+="<td>"+wire.options.smartListSummary[i].conditions[j]+"</td>";}else{campaignHTML+="</tr><tr><td>"+wire.options.smartListSummary[i].conditions[j]+"</td>";}}
campaignHTML+="</tr>";}
campaignHTML+="</table>";tranCampaignField.innerHTML=campaignHTML;eval(tooltips);},wireSelect:function(wireObj,selectBool){if(selectBool){wireObj.options.color=MktRCMer.selectedWireColor;wireObj.options.bordercolor=MktRCMer.selectedWireBorderColor;wireObj.redraw();}else{if(wireObj.options.isEnabled){wireObj.options.color=MktRCMer.enabledWireColor;wireObj.options.bordercolor=MktRCMer.enabledWireBorderColor;}else{wireObj.options.color=MktRCMer.disabledWireColor;wireObj.options.bordercolor=MktRCMer.wireBorderColor;}
wireObj.redraw();}},wireContextMenu:function(e,target,params){e.preventDefault();var wire=params[0]
var canvasEl=Ext.get(wire.element);var inCanvasX=e.xy[0]-canvasEl.getLeft();var inCanvasY=e.xy[1]-canvasEl.getTop();wire=MktRCMer.getTheWireAt(wire,e.xy);if(wire){MktRCMer.wireClick(e,[wire]);if(MktRCMer.isEditable){MktRCMer.menus.transitionMenu.showAt(e.xy);}}},wireDoubleClick:function(e,target,params){e.preventDefault();var wire=params[0]
wire=MktRCMer.getTheWireAt(wire,e.xy);if(wire){MktRCMer.wireClick(e,[wire]);if(MktRCMer.isEditable){MktSession.clockCursor(true);MktRCMer.editWireRules();}}},getTheWireAt:function(wire,xy){var canvasEl=Ext.get(wire.element);var inCanvasX=xy[0]-canvasEl.getLeft();var inCanvasY=xy[1]-canvasEl.getTop();if(inCanvasX<canvasEl.getWidth()&&inCanvasY<canvasEl.getHeight()&&wire.wireDrawnAt(inCanvasX,inCanvasY)){return wire;}else{var wires=MktRCMer.layer.wires;for(var i=0;i<wires.length;i++){canvasEl=Ext.get(wires[i].element);inCanvasX=xy[0]-canvasEl.getLeft();inCanvasY=xy[1]-canvasEl.getTop();if(inCanvasX>0&&inCanvasX<canvasEl.getWidth()&&inCanvasY>0&&inCanvasY<canvasEl.getHeight()&&wires[i].wireDrawnAt(inCanvasX,inCanvasY)){return wires[i];}}}},wireEditTransition:function(){var wire=MktRCMer.findWireById(this.selectedWire.options.id);MktRCMer.editWireRules(wire);},showMoveTerminals:function(wire){},preSave:function(){var rcmJson={stages:this.stagesToJson(),transitions:this.transitionsToJson()}
return rcmJson;},stagesToJson:function(stageId){var stagesArray=new Array();for(var i=0;i<this.layer.containers.length;i++){var stageOptions=this.layer.containers[i].options;if(stageOptions.id!="palette"){var stage={id:stageOptions.id,name:Ext.util.Format.htmlDecode(stageOptions.title),description:Ext.util.Format.htmlDecode(stageOptions.description),type:stageOptions.type,timeValue:stageOptions.timeValue,isTrackByAcct:stageOptions.isTrackByAcct,isSuccessPath:stageOptions.isSuccessPath,isKnown:stageOptions.isKnown,position:stageOptions.position}
if(isDefined(stageId)&&stageId==stageOptions.id){return stage;}else{stagesArray.push(stage);}}}
return stagesArray;},transitionsToJson:function(transitionId){var transitionsArray=new Array();for(var i=0;i<this.layer.wires.length;i++){var wire=this.layer.wires[i];var fromContainer=wire.terminal1.container;var fromTerminal=null;for(var t=0;t<fromContainer.terminals.length;t++){for(var w=0;w<fromContainer.terminals[t].wires.length;w++){if(fromContainer.terminals[t].wires[w].options.id==transitionId){fromTerminal=t;}}}
var toContainer=wire.terminal2.container;var toTerminal=null;for(var t=0;t<toContainer.terminals.length;t++){for(var w=0;w<toContainer.terminals[t].wires.length;w++){if(toContainer.terminals[t].wires[w].options.id==transitionId){toTerminal=t;}}}
var transition={id:wire.options.id,description:wire.options.description,isEnabled:wire.options.isEnabled?true:false,fromStage:{id:wire.terminal1.container.options.id,terminal:fromTerminal},toStage:{id:wire.terminal2.container.options.id,terminal:toTerminal}}
if(isDefined(transitionId)&&transitionId==wire.options.id){return transition;}else{transitionsArray.push(transition);}}
return transitionsArray;},replaceStageId:function(oldId,newId){for(var i=0;i<this.layer.containers.length;i++){var stageOptions=this.layer.containers[i].options;if(stageOptions.id==oldId){stageOptions.id=newId;return;}}},replaceTransitionId:function(oldId,newId){for(var i=0;i<this.layer.wires.length;i++){var transitionOptions=this.layer.wires[i].options;if(transitionOptions.id==oldId){transitionOptions.id=newId;return;}}},findStageById:function(stageId){for(var i=0;i<this.layer.containers.length;i++){if(this.layer.containers[i].options.id==stageId){return this.layer.containers[i];}}},findWireById:function(wireId){for(var i=0;i<this.layer.wires.length;i++){if(this.layer.wires[i].options.id==wireId){return this.layer.wires[i];}}}}
Ext.override(WireIt.Terminal,{});Ext.override(WireIt.TerminalProxy,{startDrag:function(){var Dom=YAHOO.util.Dom;var CSS_PREFIX="WireIt-";var movingTerminal=0;if(this.terminal.options.nMaxWires==1&&this.terminal.wires.length==1){this.terminal.wires[0].remove();}
else if(this.terminal.wires.length>=this.terminal.options.nMaxWires){return;}
this.terminal.options.editingWireConfig.color=MktRCMer.wireColor;this.terminal.options.editingWireConfig.bordercolor=MktRCMer.wireBorderColor;if(isDefined(MktRCMer.selectedWire)&&MktRCMer.selectedWire!=null){var selectedWireObj=MktRCMer.selectedWire;MktRCMer.selectedTerminal1=selectedWireObj.terminal1;MktRCMer.selectedTerminal2=selectedWireObj.terminal2;if(this.terminal==selectedWireObj.terminal2){movingTerminal=2;}
else if(this.terminal==selectedWireObj.terminal1){movingTerminal=1;}
if(movingTerminal>0){this.terminal.options.editingWireConfig.color=MktRCMer.selectedWireColor;this.terminal.options.editingWireConfig.bordercolor=MktRCMer.selectedWireBorderColor;MktRCMer.selectedWire.moveTerminal=movingTerminal;MktRCMer.moveInProgress=true;this.originalTerminal=this.terminal;}}
var halfProxySize=this.terminalProxySize/2;this.fakeTerminal={options:{direction:this.terminal.options.fakeDirection},pos:[200,200],addWire:function(){},removeWire:function(){},getXY:function(){var layers=Dom.getElementsByClassName('WireIt-Layer');if(layers.length>0){var orig=Dom.getXY(layers[0]);return[this.pos[0]-orig[0]+halfProxySize,this.pos[1]-orig[1]+halfProxySize+180];}
return this.pos;}};var parentEl=this.terminal.parentEl.parentNode;if(this.terminal.container){parentEl=this.terminal.container.layer.el;}
if(movingTerminal==1){this.terminal=selectedWireObj.terminal2;this.fakeTerminal.options.direction=selectedWireObj.terminal1.options.direction;this.editingWire=selectedWireObj;this.editingWire.terminal1=this.fakeTerminal;this.editingWire.terminal2=selectedWireObj.terminal2;}else if(movingTerminal==2){this.terminal=selectedWireObj.terminal1;this.fakeTerminal.options.direction=selectedWireObj.terminal2.options.direction;this.editingWire=selectedWireObj;this.editingWire.terminal1=selectedWireObj.terminal1;this.editingWire.terminal2=this.fakeTerminal;}else{this.editingWire=new WireIt.Wire(this.terminal,this.fakeTerminal,parentEl,this.terminal.options.editingWireConfig);}
Dom.addClass(this.editingWire.element,CSS_PREFIX+'Wire-editing');}});Ext.override(WireIt.TerminalProxy,{endDrag:function(e){if(MktRCMer.moveInProgress){MktRCMer.restoreWire();if(this.originalTerminal){this.terminal=this.originalTerminal;}}else if(this.editingWire){this.editingWire.remove();this.editingWire=null;}},onDragEnter:function(e,ddTargets){if(!this.editingWire){return;}
for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){ddTargets[i].terminal.setDropInvitation(true);YAHOO.util.Dom.addClass(ddTargets[i].terminal.container.el,'DropOnStage');}}},onDragOut:function(e,ddTargets){if(!this.editingWire){return;}
for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){ddTargets[i].terminal.setDropInvitation(false);YAHOO.util.Dom.removeClass(ddTargets[i].terminal.container.el,'DropOnStage');}}}});Ext.override(WireIt.TerminalProxy,{onDragDrop:function(e,ddTargets){if(!this.editingWire){return;}
this.onDragOut(e,ddTargets);var targetTerminalProxy=null;for(var i=0;i<ddTargets.length;i++){if(this.isValidWireTerminal(ddTargets[i])){targetTerminalProxy=ddTargets[i];break;}}
if(!targetTerminalProxy){return;}
if(this.originalTerminal){this.terminal=this.originalTerminal;}
this.editingWire.remove();this.editingWire=null;var termAlreadyConnected=false;for(var i=0;i<this.terminal.wires.length;i++){if(this.terminal.wires[i].terminal1==this.terminal){if(this.terminal.wires[i].terminal2==targetTerminalProxy.terminal){termAlreadyConnected=true;break;}}
else if(this.terminal.wires[i].terminal2==this.terminal){if(this.terminal.wires[i].terminal1==targetTerminalProxy.terminal){termAlreadyConnected=true;break;}}}
if(termAlreadyConnected){return;}
var parentEl=this.terminal.parentEl.parentNode;if(this.terminal.container){parentEl=this.terminal.container.layer.el;}
var term1=this.terminal;var term2=targetTerminalProxy.terminal;if(term2.options.alwaysSrc){term1=targetTerminalProxy.terminal;term2=this.terminal;}
if(MktRCMer.moveInProgress){if(MktRCMer.selectedWire.moveTerminal==1){term1=term2;term2=MktRCMer.selectedTerminal2;}else if(MktRCMer.selectedWire.moveTerminal==2){term1=MktRCMer.selectedTerminal1;}}
var tgtTerm=targetTerminalProxy.terminal;if(tgtTerm.options.nMaxWires==1){if(tgtTerm.wires.length>0){tgtTerm.wires[0].remove();}
var w=new WireIt.Wire(term1,term2,parentEl,term1.options.wireConfig);w.redraw();}
else if(tgtTerm.wires.length<tgtTerm.options.nMaxWires){var w=new WireIt.Wire(term1,term2,parentEl,term1.options.wireConfig);w.redraw();}}});if(Ext.isIE){Ext.override(WireIt.Wire,{wireDrawnAt:function(x,y){var ctxt=this.getContext();var inflectionsY=this.getYForX(ctxt.bezierPoints,x);for(var i=0;i<inflectionsY.length;i++){if(Math.abs(inflectionsY[i]-y)<15){return true;}}
if(ctxt.bezierPoints[0][0]==ctxt.bezierPoints[3][0]&&ctxt.bezierPoints[0][0]==ctxt.bezierPoints[1][0]&&ctxt.bezierPoints[2][0]==ctxt.bezierPoints[3][0]){if(Math.abs(ctxt.bezierPoints[0][0]-x)<15){return true;}}
if(ctxt.bezierPoints[0][0]==ctxt.bezierPoints[3][0]){var canvasHeight=Math.abs(ctxt.bezierPoints[0][1]-ctxt.bezierPoints[3][1])+20;if(Math.abs(inflectionsY[0]-(canvasHeight-y))<15){return true;}}
return false;},getYForX:function(bezierArray,x,coefficients){var y=[];if(!coefficients){coefficients=this.getCubicCoefficients(bezierArray[0][0],bezierArray[1][0],bezierArray[2][0],bezierArray[3][0]);}
var roots=this.getCubicRoots(coefficients[0],coefficients[1],coefficients[2],coefficients[3]-x);var time=null;if(roots.length==0){time=0;y.push(this.getSingleValue(time,bezierArray[0][1],bezierArray[1][1],bezierArray[2][1],bezierArray[3][1]));}else if(roots.length==1){time=roots[0];y.push(this.getSingleValue(time,bezierArray[0][1],bezierArray[1][1],bezierArray[2][1],bezierArray[3][1]));}else{for(var i=0;i<roots.length;i++){if(0<=roots[i]&&roots[i]<=1){time=roots[i];y.push(this.getSingleValue(time,bezierArray[0][1],bezierArray[1][1],bezierArray[2][1],bezierArray[3][1]));}}}
return y;},getSingleValue:function getSingleValue(t,a,b,c,d){return(t*t*(d-a)+3*(1-t)*(t*(c-a)+(1-t)*(b-a)))*t+a;},getCubicCoefficients:function(a,b,c,d){return[-a+3*b-3*c+d,3*a-6*b+3*c,-3*a+3*b,a];},getCubicRoots:function(a,b,c,d){if(!a){return this.getQuadraticRoots(b,c,d);}
if(a!=1){b/=a;c/=a;d/=a;}
var q=(b*b-3*c)/9;var qCubed=q*q*q;var r=(2*b*b*b-9*b*c+27*d)/54;var diff=qCubed-r*r;if(diff>=0){var theta=Math.acos(r/Math.sqrt(qCubed));var qSqrt=Math.sqrt(q);var root1=-2*qSqrt*Math.cos(theta/3)-b/3;var root2=-2*qSqrt*Math.cos((theta+2*Math.PI)/3)-b/3;var root3=-2*qSqrt*Math.cos((theta+4*Math.PI)/3)-b/3;return[root1,root2,root3];}else{var tmp=Math.pow(Math.sqrt(-diff)+Math.abs(r),1/3);var rSign=(r>0)?1:(r<0)?-1:0;var root=-rSign*(tmp+q/tmp)-b/3;return[root];}
return[];},getQuadraticRoots:function(a,b,c){var roots=[];if(!a){if(!b){return[];}
roots[0]=-c/b;return roots;}
var q=b*b-4*a*c;var signQ=(q>0)?1:(q<0)?-1:0;if(signQ<0){return[];}else if(!signQ){roots[0]=-b/(2*a);}else{roots[0]=roots[1]=-b/(2*a);var tmp=Math.sqrt(q)/(2*a);roots[0]-=tmp;roots[1]+=tmp;}
return roots;}});}
Ext.override(WireIt.Wire,{drawBezierArrows:function(){var arrowWidth=Math.round(this.options.width*1.5+15);var arrowLength=Math.round(this.options.width*1.2+14);var d=arrowWidth/2;var redim=d+3;var margin=[4+redim,4+redim];var p1=this.terminal1.getXY();var p2=this.terminal2.getXY();var coeffMulDirection=this.options.coeffMulDirection;var distance=Math.sqrt(Math.pow(p1[0]-p2[0],2)+Math.pow(p1[1]-p2[1],2));if(distance<coeffMulDirection){coeffMulDirection=distance/2;}
var d1=[this.terminal1.options.direction[0]*coeffMulDirection,this.terminal1.options.direction[1]*coeffMulDirection];var d2=[this.terminal2.options.direction[0]*coeffMulDirection,this.terminal2.options.direction[1]*coeffMulDirection];var bezierPoints=[];bezierPoints[0]=p1;bezierPoints[1]=[p1[0]+d1[0],p1[1]+d1[1]];bezierPoints[2]=[p2[0]+d2[0],p2[1]+d2[1]];bezierPoints[3]=p2;var min=[p1[0],p1[1]];var max=[p1[0],p1[1]];for(var i=1;i<bezierPoints.length;i++){var p=bezierPoints[i];if(p[0]<min[0]){min[0]=p[0];}
if(p[1]<min[1]){min[1]=p[1];}
if(p[0]>max[0]){max[0]=p[0];}
if(p[1]>max[1]){max[1]=p[1];}}
var successPath=false;var selectedWire=false;if(this.terminal1.container&&this.terminal2.container&&this.terminal1.container.options.isSuccessPath&&this.terminal2.container.options.isSuccessPath){if(this.terminal1==this.terminal1.container.terminals[2]&&this.terminal2==this.terminal2.container.terminals[0]){successPath=true;}}
if(MktRCMer.selectedWireColor==this.options.color){selectedWire=true;}
var margin=successPath?[80,20]:[10,10];min[0]=min[0]-margin[0];min[1]=min[1]-margin[1];max[0]=max[0]+margin[0];max[1]=max[1]+margin[1];var lw=Math.abs(max[0]-min[0]);var lh=Math.abs(max[1]-min[1]);this.SetCanvasRegion(min[0],min[1],lw,lh);var ctxt=this.getContext();for(i=0;i<bezierPoints.length;i++){bezierPoints[i][0]=bezierPoints[i][0]-min[0];bezierPoints[i][1]=bezierPoints[i][1]-min[1];}
adjustForArrowX=arrowLength/1.2*this.terminal2.options.direction[0];adjustForArrowY=arrowLength/1.2*this.terminal2.options.direction[1];ctxt.lineCap=this.options.bordercap;ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.width+this.options.borderwidth*2;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0]+adjustForArrowX,bezierPoints[3][1]+adjustForArrowY);ctxt.stroke();if(successPath){ctxt.lineCap=this.options.cap;ctxt.strokeStyle="#ddfcd1";ctxt.lineWidth=30;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0]-50,bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0]+50,bezierPoints[1][1],bezierPoints[2][0]-50,bezierPoints[2][1],bezierPoints[3][0]+50,bezierPoints[3][1]);ctxt.stroke();}
ctxt.lineCap=this.options.cap;ctxt.strokeStyle=this.options.color;ctxt.lineWidth=this.options.width;ctxt.beginPath();ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.bezierCurveTo(bezierPoints[1][0],bezierPoints[1][1],bezierPoints[2][0],bezierPoints[2][1],bezierPoints[3][0]+adjustForArrowX,bezierPoints[3][1]+adjustForArrowY);ctxt.stroke();if(selectedWire){if(this.terminal1.options.editable){ctxt.moveTo(bezierPoints[0][0],bezierPoints[0][1]);ctxt.lineWidth=3;ctxt.arc(bezierPoints[0][0],bezierPoints[0][1],3,0,Math.PI*2,true);ctxt.stroke();}
if(this.terminal2.options.editable){ctxt.moveTo(bezierPoints[3][0],bezierPoints[3][1]);ctxt.lineWidth=3;ctxt.arc(bezierPoints[3][0],bezierPoints[3][1],3,0,Math.PI*2,true);ctxt.stroke();}}
ctxt.bezierPoints=bezierPoints;var t1=bezierPoints[2],t2=p2;var z=[0,0];var dlug=arrowLength;if(this.terminal2.options.direction[1]!=0){z[0]=t2[0];z[1]=t2[1]+this.terminal2.options.direction[1]*arrowLength;}else{z[0]=t2[0]+this.terminal2.options.direction[0]*arrowLength;z[1]=t2[1];}
var W=t1[0]-t2[0];var Wa=t1[1]-t2[1];var Wb=t1[0]*t2[1]-t1[1]*t2[0];if(W!==0){a=Wa/W;b=Wb/W;}
else{a=0;}
if(a===0){aProst=0;}
else{aProst=-1/a;}
bProst=z[1]-aProst*z[0];var A=1+Math.pow(aProst,2),B=2*aProst*bProst-2*z[0]-2*z[1]*aProst,C=-2*z[1]*bProst+Math.pow(z[0],2)+Math.pow(z[1],2)-Math.pow(d,2)+Math.pow(bProst,2),delta=Math.pow(B,2)-4*A*C;if(delta<0){return;}
var x1=(-B+Math.sqrt(delta))/(2*A),x2=(-B-Math.sqrt(delta))/(2*A),y1=aProst*x1+bProst,y2=aProst*x2+bProst;if(t1[1]==t2[1]){var o=(t1[0]>t2[0])?1:-1;x1=t2[0]+o*dlug;x2=x1;y1-=d;y2+=d;}
ctxt.fillStyle=this.options.color;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.fill();ctxt.strokeStyle=this.options.bordercolor;ctxt.lineWidth=this.options.borderwidth;ctxt.beginPath();ctxt.moveTo(t2[0],t2[1]);ctxt.lineTo(x1,y1);ctxt.lineTo(x2,y2);ctxt.lineTo(t2[0],t2[1]);ctxt.stroke();}});
/* ========== ../mkt-ext-2.0/apps/LeadAction.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.leadAction');Mkt.apps.leadAction=Ext.extend(Ext.util.Observable,{constructor:function(config){this.addEvents("modified");},SAVE_URL:'/flows/saveLeadAction',VALIDATE_URL:'/flows/validateLeadAction',ERROR_MESSAGE:"<h2 style=\"padding-left: 25px;\"><div class=\"mktModalInFormMessage mktModalErrorMessage\">"+"Cannot save rules, please check to make sure all of the choices are valid</div><\h2>",INFO_MESSAGE:{100:"Define partition assignment rules for new leads",101:"Define initial stage rules for new leads",103:"Define rules for formula field"},editLeadAction:function(animEl,activityTypeId,actionKey,title,iconCls){MktSession.clockCursor(true);url='/flows/getLeadAction?activityTypeId='+activityTypeId;if(actionKey){url+='&actionKey='+actionKey;}
MktSession.ajaxRequest(url,{onMySuccess:this.editLeadActionModalRender.createDelegate(this,[activityTypeId,title,iconCls])});},editLeadActionModalRender:function(activityTypeId,title,iconCls){var dataPanel=this._getDataPanel();var bodyPanel=this._getBodyPanel(activityTypeId,dataPanel);var zoneModal=this._getWindow(bodyPanel,title,iconCls);MktSession.activeModalDialog=zoneModal;dataPanel.manager.addListener("modified",function(){this.fireEvent('modified');},this);zoneModal.show();},_getDataPanel:function(){var dataPanel=new Mkt.widgets.DataPanelLayout({id:'leadActionDataPanel',region:'center',canvas:null,phpModule:'flows',appVarsBase:'assignmentRules',dpType:'Flow',dpSubtype:Mkt.widgets.DataPanelConstants.RUN_ACTION,paletteWidth:0,layout:'fit',listeners:{beforeRender:function(){Mkt.widgets.DataPanel.prototype.oldStyle=Mkt.widgets.DataPanel.prototype.style;Mkt.widgets.DataPanel.prototype.style="margin: 0px 20px 20px 20px";},afterlayout:function(){Mkt.widgets.DataPanel.prototype.style=Mkt.widgets.DataPanel.prototype.oldStyle;MktSession.clockCursor(false);}},beforeSaveHook:function(){var savesPending=(this.saveQueue.pendingChangesCount>0);if(!savesPending&&this.isFinalSave){this.saveAction=Mkt.apps.leadAction.prototype.SAVE_URL;}},afterSaveHook:function(){var hasError=MktPage.appVars.errorInfo.hasError;if(!hasError){this.clearErrorMessage();}
var hasNoPendingChanges=(this.saveQueue.pendingChangesCount==0);if(this.isFinalSave&&hasNoPendingChanges){if(hasError){this.isFinalSave=false;this.saveAction=Mkt.apps.leadAction.prototype.VALIDATE_URL;this.showErrorMessage(Mkt.apps.leadAction.prototype.ERROR_MESSAGE);}else{this.fireEvent('modified');MktSession.activeModalDialog.close();}}
MktSession.clockCursor(false);},dpEditable:true});Ext.apply(dataPanel.manager,{saveAction:Mkt.apps.leadAction.prototype.VALIDATE_URL,isFinalSave:false,finalSave:function(){this.isFinalSave=true;MktSession.clockCursor(true);var panelId=this.dataPanelMetas[0].dpid;var dp=this.getDataPanelById(panelId);if(dp&&dp.dpMeta){dp.dpMeta.edited=true;}
this.save("Save clicked",dp,true);},showErrorMessage:function(errorMsg){var messageBox=Ext.getCmp('window-message-box');if(messageBox&&messageBox.layout){messageBox.layout.setActiveItem('card-error');}},clearErrorMessage:function(){var messageBox=Ext.getCmp('window-message-box');if(messageBox&&messageBox.layout){messageBox.layout.setActiveItem('card-info');}}});dataPanel.manager.addEvents("modified");return dataPanel;},_getWindow:function(bodyPanel,titleIn,iconCls){var zoneModal=new Ext.Window({title:titleIn?titleIn:'Assignment Rules',cls:'mktModalForm-white',iconCls:iconCls?iconCls:'mkiBoxInto',modal:true,maximizable:true,constrain:true,width:MktLeadDb.RunAction.dialogWidth,minWidth:MktLeadDb.RunAction.dialogWidth,layout:'fit',height:MktLeadDb.RunAction.dialogHeight,minHeight:300,padding:0,autoScroll:true,items:bodyPanel,buttons:[{text:'Save',iconCls:'mkiOk',handler:function(){var manager=Ext.getCmp('leadActionDataPanel').manager;manager.finalSave();}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){zoneModal.close();}}]});return zoneModal;},_getBodyPanel:function(activityTypeId,dataPanel){return{xtype:"panel",layout:"anchor",items:[{xtype:"panel",layout:'card',id:'window-message-box',height:40,anchor:'100%',activeItem:'card-info',items:[{id:'card-info',html:'<h2 style="padding-left: 25px; padding-top: 10px; color: rgb(102, 102, 102);'+'font-size: 14px; font-family: arial,helvetica,sans-serif;">'+
Mkt.apps.leadAction.prototype.INFO_MESSAGE[activityTypeId]+"</h2>"},{id:'card-error',html:Mkt.apps.leadAction.prototype.ERROR_MESSAGE}]},{xtype:"panel",layout:"fit",anchor:'100%, -40',items:dataPanel}]};}});
/* ========== ../mkt-ext-2.0/apps/MarketingEvent.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.marketingEvent');Mkt.apps.marketingEvent.UpdateState={updateRunning:{}};Mkt.apps.marketingEvent.colModelCacheKey="marketingEvent.ColumnModel";Mkt.apps.marketingEvent.getStore=function()
{var store=Ext.StoreMgr.get('programs');if(!store){store=new Ext.data.JsonStore({storeId:'programs',url:'marketingEvent/getProgram',root:'data',idProperty:'id',fields:['id','name',{name:'startDate',type:'date'},{name:'endDate',type:'date'},'campaignId','hasMembers']});}
return store;};Mkt.apps.marketingEvent.reloadStore=function(id)
{if(!id){throw'Component id is required';}
var store=Ext.StoreMgr.get('programs');if(!store){return;}
store.reload({params:{compId:id},add:true});};Mkt.apps.marketingEvent.Actions={createNewMarketingEvent:function(parentFolderId,animEl,accessZoneId){var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventForm({parentFolderId:parentFolderId,isEvent:true,accessZoneId:accessZoneId});marketingEventForm.show(animEl);},createNewMarketingProgram:function(parentFolderId,animEl,accessZoneId,sparkParams){if(!sparkParams){sparkParams=new Array();}
var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventForm({parentFolderId:parentFolderId,isProgram:true,accessZoneId:accessZoneId,programType:sparkParams.subType?sparkParams.subType:'',sparkParams:sparkParams});if(sparkParams.cls){marketingEventForm.addClass(sparkParams.cls);}
marketingEventForm.show(animEl);},createSubCampaign:function(compId,compName,marketingFolderId,animEl,accessZoneId){var subCampaignForm=new Mkt.apps.marketingEvent.SubCampaignForm({compId:compId,marketingFolderId:marketingFolderId,compName:compName,accessZoneId:accessZoneId});subCampaignForm.show(animEl);},cloneMarketingEvent:function(compId,name,parentFolderId,animEl,accessZoneId){var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventForm({parentFolderId:parentFolderId,isEvent:true,cloneFromId:compId,cloneName:name,accessZoneId:accessZoneId});marketingEventForm.show(animEl);},cloneMarketingProgram:function(compId,name,parentFolderId,animEl,accessZoneId){var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventForm({parentFolderId:parentFolderId,isProgram:true,cloneFromId:compId,cloneName:name,accessZoneId:accessZoneId});marketingEventForm.show(animEl);},renameEvent:function(){MktMessage.comingSoon();},editEventSchedule:function(compId){var params={compId:compId};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;};MktSession.ajaxRequest('marketingEvent/getMarketingEvent',{serializeParms:params,onMySuccess:this.showEventScheduleDialog.createDelegate(this)});},showEventScheduleDialog:function(response,reqParams){var event=response.JSONResults.event;var params={event:event};var marketingEventForm=new Mkt.apps.marketingEvent.ScheduleDialog(params);marketingEventForm.show();},editWebinarSettings:function(compId){var params={compId:compId};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;};var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventWebinarSettings(params);marketingEventForm.show();},editSfdcCampaignSync:function(programId,animEl)
{var form=new Mkt.apps.marketingEvent.SfdcCampaignSyncForm({programId:programId});form.show(animEl);},showWebinarSettingsDialog:function(response,reqParams){var event=response.JSONResults.event;var marketingEventForm=new Mkt.apps.marketingEvent.MarketingEventWebinarSettings({event:event});marketingEventForm.show();},deleteMarketingProgram:function(compId,name,animEl,isEvent){var title=(isEvent?'Delete Event?':'Delete Program?');MktMessage.confirmDelete(title,'Are you sure you want to delete <b>'+name+'</b>?',function(){var params={marketingProgramId:compId,isEvent:isEvent};MktSession.ajaxRequest('marketingEvent/deleteMarketingProgram',{serializeParms:params,onMySuccess:this.deleteMarketingProgramDone.createDelegate(this)});}.createDelegate(this),animEl);},deleteMarketingProgramDone:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){MktDlManager.loadDl({type:'MA'});}},changeStatusSubmitSuccess:function(request,reqParams){MktSession.unclockCursor();if(MktPage.appVars.result==MktSession.resultSuccess){var win=new Mkt.apps.marketingEvent.EventStatusActionStatusWindow(Ext.apply({campaignId:MktPage.appVars.eventStatusActionCampId,triggerId:MktPage.appVars.eventStatusActionTrigId,renderTo:Ext.getBody()},MktPage.appVars.eventStatusActionStatuses));win.show();}
else if(MktPage.appVars.errorMsg){MktMessage.showError(MktPage.appVars.errorMsg);}},changeStatusSubmitFailure:function(request,reqParams){MktSession.unclockCursor();return false;},changeStatusInProgression:function(compId,status,grid){var params={compId:compId,status:status,memberIds:Ext.util.JSON.encode(grid.getSelectedMemberIds())};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;}
if(grid.query){params.query=grid.query;}
MktSession.clockCursor();MktSession.ajaxRequest('/marketingEvent/changeStatusInProgression',{serializeParms:params,onMySuccess:this.changeStatusSubmitSuccess.createDelegate(this),onMyFailure:this.changeStatusSubmitFailure.createDelegate(this)});},createNewField:function(){var newFieldForm=new Mkt.apps.MarketingEventNewField({});newFieldForm.show();},updateEventSubmitSuccess:function(response,reqParams){var compId=reqParams.params.compId;Mkt.apps.marketingEvent.UpdateState.updateRunning[compId]=false;data=response.JSONResults.data;Mkt.apps.marketingEvent.showRefreshStatusWindow(data,reqParams.params);},updateEventSubmitFailure:function(request,reqParams){var compId=reqParams.params.compId;Mkt.apps.marketingEvent.UpdateState.updateRunning[compId]=false;data={success:false,reason:'HTTP request failure'};Mkt.apps.marketingEvent.showRefreshStatusWindow(data,reqParams.params);},updateEvent:function(compId){Mkt.apps.marketingEvent.UpdateState.updateRunning[compId]=true;var config=MktCanvas.getActiveTab().config;var params={compId:compId,compName:config.compName};var accessZoneId=config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;}
Mkt.apps.marketingEvent.showRefreshStatusWindow(null,params);MktSession.ajaxRequest('/marketingEvent/updateEvent',{serializeParms:params,onMySuccess:this.updateEventSubmitSuccess.createDelegate(this),onMyFailure:this.updateEventSubmitFailure.createDelegate(this)});},gotoWebinarAdmin:function(){MktDlManager.loadDl({type:"CustAdmin",compSubtype:"webinarPartner",nodeId:MktPage.constants.adminTreeMeta.WEBINARS.nodeId});}};Mkt.apps.storeExceptionListener={fn:function(proxy,type,action,options,response){if(type==='response'){response.success=false;console.group('store caught load exception');console.debug("action=",action);console.debug("response=",response);console.debug("options=",options);console.debug("Tip: Try loading this URL in a new window.");console.groupEnd();if(MktPage.debug)debugger;var parseResults=MktSession.parseResults(response);parseResults.systemErrorMsg=MktMessage.SYSTEM_ERROR_TIMEOUT;var reqParams=options.params;MktSession.ajaxShowError(response,parseResults,reqParams);}}};Mkt.apps.marketingEvent.RefreshStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Refresh from webinar",height:110,width:320,renderTo:Ext.getBody(),isFailed:false,isCompleted:false,isCanceled:false,isFailed:false,isUpdated:false,hasHistory:false,closeAction:'hide',data:null,eventName:'',updateTitleStatus:function(){this.setTitle(this.title);},setCompleted:function(data){this.data=data;var success=data['success'];var updated=data['updated'];var hasHistory=data['hasHistory']
this.isCompleted=success;this.isUpdated=updated;this.hasHistory=hasHistory;this.isFailed=!success;this.renderStatus();},reset:function(){this.isCompleted=false;this.isFailed=false;this.isCanceled=false;this.isUpdated=false;this.hasHistory=false;this.data=null;this.renderStatus();},renderStatus:function(){var buff='';if(!this.isCanceled){var imageSrc=this.executingImage;if(this.isCompleted){imageSrc=this.completedImage;}else if(this.isFailed){imageSrc=this.failedImage;}
buff+='</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px;'+' margin-top: 4px; margin-bottom:2px; width:24px; height:24px;" src="'+imageSrc+'"/>';buff+="</div>";}
buff+='<div style="float:left; width: 240px; padding-top: 5px">';if(!this.isCompleted&&!this.isCanceled&&!this.isFailed){buff+="<b>Refreshing <i>'"+this.eventName+"'</i></b>";}
if(this.isCompleted){buff+="<b>Refresh of <i>'"+this.eventName+"'</i> completed</b><table border='0' cellspacing='5'>";if(this.hasHistory){buff+='<tr><td>Attendees:</td><td>'+this.data['attendees']+'</td></tr>';}
if(this.isUpdated){buff+='<tr><td>Event details have been updated</td></tr>';}
if(!this.hasHistory&&!this.isUpdated){buff+="<tr><td><p>No updates</td></tr>";}
buff+='</table>';}else{if(this.isFailed){var reason=this.data['reason'];var wasError=reason!='no history';if(wasError){buff+="<b>Refresh of <i>'"+this.eventName+"'</i> failed</b><p>"+this.data['reason'];}}}
buff+="</div></div>";this.body.dom.innerHTML=buff;if(this.hasHistory||this.isUpdated){MktPage.clearPanelContentValid('maMarketingEventHome');MktPage.clearPanelContentValid('maMembers');var homeIsActive=MktCanvas.isActiveTab('maMarketingEventHome');var membersIsActive=MktCanvas.isActiveTab('maMembers');var setupIsActive=MktCanvas.isActiveTab('maSettings');if(homeIsActive||membersIsActive||setupIsActive){MktCanvas.reloadActiveTab();Mkt.apps.marketingEvent.reloadStore(MktCanvas.getActiveTab().config.compId);}}}});Mkt.apps.marketingEvent.showRefreshStatusWindow=function(data,params){var compId=params.compId;var id='refreshStatusWindow'+compId;var statusWindow=Ext.WindowMgr.get(id);if(statusWindow==null){config=data||{};config.id=id;config.eventName=params.compName;statusWindow=new Mkt.apps.marketingEvent.RefreshStatusWindow(config);}
statusWindow.reset();if(data!=null){statusWindow.setCompleted(data);}else{}
statusWindow.show();};Mkt.apps.marketingEvent.comboxBox=Ext.extend(Ext.form.ComboBox,{setValue:function(value){var storeLoaded=this.store&&this.store.getCount()>0;if(!storeLoaded){this.store.on('load',this.setValue.createDelegate(this,[value]),null,{single:true});}else{var index=this.store.findExact('id',value);if(index>-1){Mkt.apps.marketingEvent.comboxBox.superclass.setValue.call(this,value);}else{Mkt.apps.marketingEvent.comboxBox.superclass.setValue.call(this,'');}}}});Mkt.apps.marketingEvent.MarketingEventForm=Ext.extend(Mkt.widgets.ModalForm,{title:null,isEvent:false,isProgram:false,minWidth:550,width:520,height:380,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',labelWidth:130,okText:'Create',fieldRequiredMsg:'This field is required',parentFolderId:null,progressionId:0,cloneFromId:0,cloneName:'',submitUrl:'marketingEvent/createMarketingProgramSubmit',requiredDescriptors:[],descriptorValues:null,isClone:false,accessZoneId:null,programType:'',initComponent:function(){var accessZoneId=this.accessZoneId;this.isClone=(this.cloneFromId!==0);this.title=(this.isClone?'Clone ':'New ')+(this.isEvent?'Event':'Program');this.iconCls=(this.isEvent?'mkiCal':'mkiWalletClosed')+(this.isClone?'Add':'');this.channelStore=new Ext.data.JsonStore({idProperty:'id',messageProperty:'message',url:'/marketingEvent/getChannelList',baseParams:{accessZoneId:accessZoneId},autoload:true,root:'data.channels',fields:['id','value'],listeners:{exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}});this.accountSelector=new Mkt.widgets.ComboBoxRemoteChain({chainedcombo:null,hideContainerWhenDisabled:true,disableValue:'',hideContainerWhenDisabled:false,fieldLabel:'Login',triggerAction:'all',mode:'local',store:this.accountsJsonStore,valueField:'id',displayField:'displayName',editable:false,forceSelection:true,hideParent:true,emptyText:'Loading...',width:'100%'});if(this.isClone){this.loadEventData();}
else{this.descriptorComboBoxes=[];this.loadFormData();}
if(this.isClone){this.height+=30;this.cloneFromField=new Ext.form.DisplayField({fieldLabel:'Clone From',value:this.cloneName});}
this.nameField=new Ext.form.TextField({fieldLabel:'Name',width:300,allowBlank:false,itemCls:'mktRequired',inputType:'text',value:undefined});this.typeField=new Ext.form.ComboBox({fieldLabel:'Program Type',width:300,allowBlank:false,value:this.programType?this.programType:'program',itemCls:'mktRequired',store:new Ext.data.JsonStore({fields:['text','value'],data:[{text:'Default',value:'program'},{text:'Event',value:'event'}]}),valueField:'value',displayField:'text',triggerAction:'all',editable:false,mode:'local',listeners:{'select':function(combo,record){if(this.channelDescriptorComboBox){var channelCombo=this.channelDescriptorComboBox;channelCombo.clearValue();var newType=record.get('value');this.isEvent=newType=='event';this.isProgram=!this.isEvent;var store=channelCombo.getStore();if(store.proxy.activeRequest){Ext.Ajax.abort(store.proxy.activeRequest.read);}
var lastOptions=store.lastOptions||{params:{}};Ext.apply(lastOptions.params,{type:newType});store.load(lastOptions);}}.createDelegate(this)}});this.focusedField=this.nameField;this.descriptionField=new Ext.form.TextArea({fieldLabel:'Description',width:300,allowBlank:true});if(this.cls.indexOf("mktSpark")){var url=this.sparkParams&&this.sparkParams.tutorialUrl?this.sparkParams.tutorialUrl:'';var name=this.sparkParams&&this.sparkParams.name?this.sparkParams.name:'';if(url&&name){this.sparkLogo=new Ext.form.Label({xtype:'label',id:'spark_logo',html:'<a href="'+url+'" id="sparkLearningLink" target="_blank" style="text-decoration: none;"><div style="float:left;"><img src="../images/spark/modal-spark.jpg" /></div><div id="sparkFolderName"  style="text-decoration: underline;margin-top: 40px;">Learn '+name+'</div></a>'});}}
this.items=[];Mkt.apps.marketingEvent.MarketingEventForm.superclass.initComponent.call(this);},loadFormData:function()
{MktSession.ajaxRequest('marketingEvent/getRequiredDescriptorsList',{onMySuccess:function(results){if(MktPage.appVars.result==MktSession.resultSuccess){this.requiredDescriptors=results.JSONResults.descriptors;this.formDataLoadedCallback(this.accessZoneId);}}.createDelegate(this)});},loadEventData:function()
{MktSession.ajaxRequest('marketingEvent/getMarketingEvent',{serializeParms:{compId:this.cloneFromId},onMySuccess:function(results){var descriptors=results.JSONResults.event.descriptors;this.descriptorValues={};for(var i=0,l=descriptors.length;i<l;i++){this.descriptorValues[descriptors[i].descriptorId]=descriptors[i].value;}
this.formDataLoadedCallback(this.accessZoneId);}.createDelegate(this)});},formDataLoadedCallback:function(accessZoneId)
{if(!accessZoneId){accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;}
if(!this.isClone){if(this.requiredDescriptors!=null){for(var i=0,l=this.requiredDescriptors.length;i<l;i++){var descriptor=this.requiredDescriptors[i],isChannel=(descriptor.type=='channel'),insertIndex=this.items.indexOf(this.nameField)+this.descriptorComboBoxes.length+1,fieldIndex=i;var comboBox=new Ext.form.ComboBox({fieldLabel:descriptor.name,itemId:'descriptor'+descriptor.id,itemCls:'mktRequired',triggerAction:'all',mode:'remote',minChars:0,autoSelect:false,allowBlank:false,valueField:'id',displayField:'value',emptyText:'- Choose -',width:300,value:this.descriptorValues!=null?this.descriptorValues[descriptor.id]:undefined,store:new Ext.data.JsonStore({url:'/marketingEvent/get'+(isChannel?'ProgramEventChannel':'VisibleDescriptor')+'Values',root:'data.values',idProperty:'id',baseParams:{accessZoneId:accessZoneId,descriptorId:descriptor.id,type:this.isEvent?'event':'program'},fields:['id','value'],listeners:{load:function(store,records,options){var combo=this.getComponent('descriptor'+store.baseParams.descriptorId);combo.mode='local';store.filter('value',combo.getRawValue());}.createDelegate(this),exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}})});if(isChannel){this.channelDescriptorComboBox=comboBox;}
this.descriptorComboBoxes.push(comboBox);}}}
this.programComboBox=new Ext.form.ComboBox({fieldLabel:'Campaign Folder',itemCls:'mktRequired',triggerAction:'all',mode:'local',editable:false,selectOnFocus:true,valueField:'id',allowBlank:false,autoSelect:false,forceSelection:true,displayField:'name',emptyText:'- Choose -',width:300,store:new Ext.data.JsonStore({url:'/smartcampaigns/getProgramFolders',baseParams:{accessZoneId:accessZoneId},root:'JSONResults.data',idProperty:'id',fields:['id','name'],autoLoad:true,listeners:{load:function(store,records,options){if(store.findExact('id',this.parentFolderId)!=-1){this.programComboBox.setValue(this.parentFolderId);}}.createDelegate(this)}})});var items=[];items.push(this.programComboBox);if(this.isClone){items.push(this.cloneFromField);}
items.push(this.nameField);if(!this.isClone){items.push(this.typeField);items.push.apply(items,this.descriptorComboBoxes);}
items.push(this.descriptionField);if(this.sparkLogo){items.push(this.sparkLogo);}
var record=this.typeField.findRecord('value',this.programType);var index=this.typeField.store.indexOf(record);if(record&&index){this.typeField.onSelect(record,index);}
this.add(items);this.doLayout();},beforeSubmitCallback:function()
{valid=this.programComboBox.validate();if(!this.isClone){for(var i=0,l=this.descriptorComboBoxes.length;i<l;i++){valid=this.descriptorComboBoxes[i].validate()&&valid;}}
valid=this.nameField.validate()&&valid;return valid;},okCallback:function()
{var name=this.nameField.getValue();var description=this.descriptionField.getValue();var parentFolderId=this.programComboBox.getValue();var type=this.isEvent?'event':'program';this.serializeParms={name:name,description:description,parentFolderId:parentFolderId,cloneFromId:this.cloneFromId,type:type};if(!this.isClone){var descriptorValues={};for(var i=0,l=this.descriptorComboBoxes.length;i<l;i++){descriptorValues[this.requiredDescriptors[i].id]=this.descriptorComboBoxes[i].getRawValue();}
this.serializeParms.descriptorValues=Ext.encode(descriptorValues);}
if(this.isClone){this.hide();Ext.MessageBox.show({title:'Please wait...',msg:'Cloning '+(this.isEvent?'event':'program')+'...',progress:true,wait:true,width:200,closable:false});}},submitSuccessCallback:function(){var result=MktPage.appVars.result;var subType=(this.isEvent?'marketingevent':'marketingprogram');if(result==MktSession.resultSuccess){MktDlManager.loadDl({type:'MA',subType:subType,compId:MktPage.appVars.compId});}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});Mkt.apps.marketingEvent.SubCampaignForm=Ext.extend(Mkt.widgets.ModalForm,{title:'New Smart Campaign',minWidth:550,width:520,height:300,resizable:false,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',iconCls:'mkiLightbulbOn',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',okText:"Create",labelWidth:130,fieldRequiredMsg:'This field is required',compId:0,accessZoneId:null,submitUrl:'marketingEvent/createSubCampaignSubmit',initComponent:function(){this.items=this.items||[];this.baseParams={compId:this.compId,accessZoneId:this.accessZoneId};var eventNameField=new Ext.form.DisplayField({fieldLabel:'Event',value:this.compName});this.items.push(eventNameField);this.nameField=new Ext.form.TextField({itemCls:'mktRequired',fieldLabel:'Name',width:300,allowBlank:false});this.items.push(this.nameField);this.descriptionField=new Ext.form.TextArea({fieldLabel:'Description',width:300,allowBlank:true});this.items.push(this.descriptionField);var canvas=MktCanvas.getActiveTab();if(canvas.id=='cp_maLocalAssets'&&canvas.config&&canvas.config.compId==this.compId){this.navigateDetailsField=new Ext.form.Checkbox({boxLabel:'Go to Smart Campaign',checked:true,width:300});this.items.push(this.navigateDetailsField);}
Mkt.apps.marketingEvent.SubCampaignForm.superclass.initComponent.call(this);},beforeSubmitCallback:function(){if(!this.nameField.validate()){return false;}},okCallback:function(){this.createSubCampaignSubmit();},createSubCampaignSubmit:function(button){var name=this.nameField.getValue();var description=this.descriptionField.getValue();var navToDetails=this.navigateDetailsField?this.navigateDetailsField.getValue():'';this.serializeParms={name:name,description:description,navToDetails:navToDetails};if(this.marketingFolderId){this.serializeParms.marketingFolderId=this.marketingFolderId;}
delete MktPage.appVars.compId;delete MktPage.appVars.result;},submitSuccessCallback:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){this.close();var skipLoadLanding=this.skipLoadLanding();if(!skipLoadLanding){MktDlManager.loadDl({type:'MA',subType:'smartcampaign',compId:MktPage.appVars.compId});}
else{MktSession.clockCursor(false);}}},skipLoadLanding:function(){var tabConfig=MktCanvas.getActiveTab().config;var isAssetTab=Mkt.apps.localasset&&Mkt.apps.localasset.Constants.TAB_NAME==tabConfig.id;if(isAssetTab){var isChildOfSameProgram=''+MktPage.appVars.marketingProgramId===''+tabConfig.compId;return isChildOfSameProgram&&!MktPage.appVars.loadDetails;}
return false;}});Mkt.apps.MarketingEventNewField=Ext.extend(Mkt.widgets.ModalForm,{title:'New Field',minWidth:410,width:410,height:280,resizable:false,cls:'mktModalForm mktModalForm2 mktMarketingEvent',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 15px 15px 0 15px;',buttonAlign:'right',labelWidth:80,useStandardButtons:false,fieldRequiredMsg:'This field is required',parentFolderId:0,initComponent:function(){this.items=this.items||[];this.nameField=new Ext.form.TextField({fieldLabel:'Name',width:250,allowBlank:false});this.items.push(this.nameField);this.typeField=new Ext.form.ComboBox({fieldLabel:'Type',width:250,allowBlank:false,typeAhead:true,editable:true,forceSelection:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['attrType','displayText'],data:[['boolean','Boolean'],['integer','Integer'],['float','Float'],['currency','Currency'],['string','String'],['date','Date'],['datetime','Datetime'],['phone','Phone'],['email','Email']]}),valueField:'attrType',displayField:'displayText'});this.items.push(this.typeField);this.descField=new Ext.form.TextArea({fieldLabel:'Description',width:250,height:100,allowBlank:true});this.items.push(this.descField);this.buttons=this.buttons||[];var okButtonText='Create';if(this.editMode){okButtonText='Save';}
this.buttons.push({text:okButtonText,iconCls:'mkiOk',handler:function(button,event){this.createFieldSubmit(button);}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});Mkt.apps.MarketingEventNewField.superclass.initComponent.call(this);},createFieldSubmit:function(button){var name=this.nameField.getValue();var type=this.typeField.getValue();var desc=this.descField.getValue();var params={compId:MktCanvas.getActiveTab().config.compId,name:name,type:type,description:desc};MktSession.clockCursor();if(MktPage.appVars.result){delete MktPage.appVars.result;}
if(MktPage.appVars.layoutData){delete MktPage.appVars.layoutData;}
MktSession.ajaxRequest('marketingEvent/createFieldSubmit',{serializeParms:params,onMySuccess:this.createFieldDone.createDelegate(this,[button])});},createFieldDone:function(){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){this.close();var tab=MktCanvas.getActiveTab();if(tab.config.id=="maMembers"){tab.getGridPanel().updateColumnModel(MktPage.appVars.layoutData);}}
if(MktPage.appVars.result){delete MktPage.appVars.result;}}});Mkt.apps.marketingEvent.MarketingEventWebinarSettings=Ext.extend(Mkt.widgets.ModalForm,{title:'Event Settings',minWidth:410,width:600,height:400,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktMarketingEvent',layout:'form',focusFirstInput:false,bodyStyle:'padding: 30px 15px 0 15px;',labelWidth:130,useStandardButtons:false,plain:true,editMode:false,modal:true,closable:true,buttonAlign:'right',fieldRequiredMsg:'This field is required',progressMsg:'Saving Webinar Settings...',iconCls:'mkiUserMonitorEdit',selectedEvent:null,hasEvent:false,eventSelectionListAvailable:null,initComponent:function(){var params={compId:this.compId};if(isDefined(this.accessZoneId)){params.accessZoneId=this.accessZoneId;};var params={compId:this.compId}
MktSession.ajaxRequest('marketingEvent/getMarketingEvent',{serializeParms:params,onMySuccess:this.eventLoaded.createDelegate(this)});this.eventsLoadListener=function(store,records,options){var response=store.reader.jsonData.JSONResults;this.eventSelector.emptyText='- Choose -';this.eventSelector.clearValue();if(!response['success']){this.displayError('Error getting Events listing',response['errorMessage']);}else{var noEvents=response['count']==0;if(noEvents){this.displayError('Account has no webinars scheduled')}else{this.eventSelector.enable();var sessionInStore=(store.find('sessionKey',this.selectedEvent.webinarSessionId)>-1);if(sessionInStore){this.eventSelector.setValue(this.selectedEvent.webinarSessionId);}else{this.eventSelector.setValue(this.selectedEvent.name);}}}};this.accountsLoadListener=function(store,records,options){this.accountSelector.emptyText='- Choose -';this.accountSelector.clearValue();this.accountSelector.enable();};this.accountTypesLoadListener=function(store,records,options){var response=store.reader.jsonData.JSONResults;if(records.length==1){var message='No logins have been configured yet';if(MktPage.hasAdminRole){var link="<a href='#' onclick='MktSession.activeModalForm.close();Mkt.apps.marketingEvent.Actions.gotoWebinarAdmin(); return false'>";message+="<br>Go to "+link+"Admin</a> page to set up an account";}
this.displayError(message,null);}};this.eventSelected=function(combobox,record,index){Ext.getCmp('saveButton').enable();var event=record.json;this.selectedEvent=event;this.displayInPanel("<table class='mktDetailTable'><col align='right'/><col align='left'/>"+"<tr><td><b>Name:</b></td><td>"+Ext.util.Format.htmlEncode(event.name)+"</td></tr>"+"<tr><td><b>Start Date:</b></td><td>"+event.formattedStartDate+"</td></tr>"+"<tr><td><b>End Date:</b></td><td>"+event.formattedEndDate+"</td></tr>"+"<tr><td><b>Time Zone:</b></td><td>"+event.timeZoneName+"</td></tr>"+"<tr><td><b>Description:</b></td><td>"+Ext.util.Format.htmlEncode(event.description)+"</td></tr>"+"</table>");};this.eventDeselected=function(){Ext.getCmp('saveButton').disable();this.clearPanel();};this.accountTypeSelected=function(combo,record,index){this.hideEventControls();var isNone=(record.data.name=="");if(isNone){this.accountSelector.reset();this.accountSelector.hideContainer();this.displayInPanel('');Ext.getCmp('saveButton').enable();}else{this.accountSelector.emptyText='Loading...',this.accountSelector.clearValue();this.accountSelector.store.reload({params:{type:record.data.name}});this.accountSelector.showContainer();this.accountSelector.disable();this.displayInPanel('');Ext.getCmp('saveButton').disable();}};this.accountSelected=function(combo,record,index){var subtype=record.data.subtype;this.eventSelectionListAvailable=(subtype!="on24");if(!this.eventSelectionListAvailable){this.showEventIdField();}else{this.eventSelector.emptyText='Loading...',this.eventSelector.clearValue();this.eventSelector.store.reload({params:{accountId:record.data.id}});this.eventSelector.showContainer();this.eventSelector.disable();this.displayInPanel('');Ext.getCmp('saveButton').disable();}};this.hideEventControls=function(){this.eventSelector.reset();this.eventSelector.hideContainer();this.eventIdField.getItemCt().addClass('mktHidden');this.eventIdField.allowBlank=true;};this.showEventIdField=function(){var itemCt=this.eventIdField.getItemCt();itemCt.removeClass('mktHidden');this.eventIdField.allowBlank=false;Ext.getCmp('saveButton').enable();};this.accountTypesJsonStore=new Ext.data.JsonStore({url:'/marketingEvent/getWebinarAccountTypes',root:'JSONResults.types',idProperty:'name',autoLoad:false,fields:['displayName','name','logoCls'],listeners:{load:this.accountTypesLoadListener.createDelegate(this),exception:Mkt.apps.storeExceptionListener}});this.accountsJsonStore=new Ext.data.JsonStore({url:'/marketingEvent/getWebinarAccounts?type=',root:'JSONResults.accounts',idProperty:'id',autoLoad:false,fields:['id','webinarLogin','webinarPartner','displayName','subtype'],listeners:{load:this.accountsLoadListener.createDelegate(this),exception:Mkt.apps.storeExceptionListener}});this.eventsJsonStore=new Ext.data.JsonStore({url:'/marketingEvent/getPartnerEvents?accountId=',root:'JSONResults.events',idProperty:'sessionKey',autoLoad:false,fields:['name','sessionKey','startDate','uniqueName','description'],listeners:{load:this.eventsLoadListener.createDelegate(this),exception:Mkt.apps.storeExceptionListener}});this.eventTpl=new Ext.XTemplate('<tpl for="."><div class="search-item">','<h3><span>{startDate:date("M j, Y")}</span>{name:htmlEncode}</h3>','{[this.trimAndEncode(values.description)]}','</div></tpl>',{trimAndEncode:function(value){var result=Ext.util.Format.ellipsis(value,130,true);return Ext.util.Format.htmlEncode(result);}});this.eventSelector=new Mkt.widgets.ComboBoxRemoteChain({chainedcombo:null,hideContainerWhenDisabled:true,mode:'local',loadingText:'loading events...',fieldLabel:'Event',forceSelection:true,displayField:'uniqueName',valueField:'sessionKey',editable:false,hideParent:true,triggerAction:'all',emptyText:'Loading...',tpl:this.eventTpl,itemSelector:'div.search-item',store:this.eventsJsonStore,anchor:'94%'});this.eventSelector.on('select',this.eventSelected.createDelegate(this));this.eventSelector.on('selectDisabled',this.eventDeselected.createDelegate(this));this.accountSelector=new Mkt.widgets.ComboBoxRemoteChain({chainedcombo:null,hideContainerWhenDisabled:true,disableValue:'',hideContainerWhenDisabled:false,fieldLabel:'Login',triggerAction:'all',mode:'local',store:this.accountsJsonStore,valueField:'id',displayField:'displayName',editable:false,forceSelection:true,hideParent:true,emptyText:'Loading...',anchor:'94%'});this.accountSelector.on('select',this.accountSelected.createDelegate(this));this.accountTypeSelector=new Mkt.widgets.ComboBoxRemoteChain({chainedcombo:null,hideContainerWhenDisabled:true,disableValue:'',fieldLabel:'Event Partner',triggerAction:'all',mode:'remote',store:this.accountTypesJsonStore,valueField:'name',editable:false,forceSelection:true,displayField:'displayName',emptyText:'Loading...',anchor:'94%'});this.accountTypeSelector.on('select',this.accountTypeSelected.createDelegate(this));this.eventIdField=new Ext.form.TextField({fieldLabel:'Event Id',allowBlank:true,itemCls:'mktRequired mktHidden',anchor:"94%",inputType:'text'});this.eventDetailsPanel=new Ext.Panel({id:'detailsPanel',fieldLabel:'',labelSeparator:'',frame:false,title:'',html:'',style:{marginTop:'20px',backgroundColor:'#E8E8E8'}});this.tokenPanel={title:'Tokens',layout:'fit',hidden:true,items:null};this.buttons=this.buttons||[];this.buttons.push({text:'Save',id:'saveButton',iconCls:'mkiOk',disabled:true,handler:function(button,event){this.webinarSettingsSubmit(button);}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.close();}.createDelegate(this)});this.items=[this.accountTypeSelector,this.accountSelector,this.eventSelector,this.eventIdField,this.eventDetailsPanel];Mkt.apps.marketingEvent.MarketingEventWebinarSettings.superclass.initComponent.call(this);},eventLoaded:function(response){var event=response.JSONResults.event;this.selectedEvent=event;var partnerId='';var partnerType='';var integrationPartner=event.integrationPartner;if(integrationPartner!=null){partnerId=integrationPartner.id;partnerType=integrationPartner.subtype;}
var eventId=event.webinarSessionId;this.hasEvent=(eventId!=null);this.accountTypesJsonStore.url='/marketingEvent/getWebinarAccounts?type='+partnerType;this.eventsJsonStore.url='/marketingEvent/getPartnerEvents?accountId='+partnerId;this.eventSelector.setReadOnly(event.hasMembers);this.accountSelector.setReadOnly(event.hasMembers);this.accountTypeSelector.setReadOnly(event.hasMembers);this.eventIdField.setValue(eventId);this.eventIdField.setReadOnly(event.hasMembers);this.initializeComboboxes();this.doLayout();if(event.hasMembers){var panelHtml='<div class="mktFormWarning" style="margin:0">The Webinar settings can not be modified once there are members in the event</div>';this.eventDetailsPanel.update(panelHtml);}},storeInitialLoadDone:function(store){this.loading-=1;if(this.loading==0){this.connectComboboxes.defer(10);}},connectComboboxes:function(){this.accountTypeSelector.chainedcombo=this.accountSelector;this.accountSelector.chainedcombo=this.eventSelector;},initializeComboboxes:function(){this.accountTypesJsonStore.load();if(this.hasEvent){var integrationPartner=this.selectedEvent.integrationPartner;this.eventSelectionListAvailable=(integrationPartner.subtype!="on24");this.accountTypeSelector.setValue(integrationPartner.subtype?integrationPartner.subtype:'');this.accountSelector.setValue(integrationPartner.id);this.accountsJsonStore.load({params:{type:integrationPartner.subtype}});if(this.eventSelectionListAvailable){this.eventsJsonStore.load({params:{accountId:integrationPartner.id}});}else{this.showEventIdField();this.eventSelector.hideContainer();}}else{this.accountTypeSelector.setValue('');this.eventSelector.hideContainer();this.accountSelector.hideContainer();}},displayInPanel:function(html){var panel=Ext.get('detailsPanel');panel.update(html);},displayError:function(html,errorDetails){if(errorDetails!=null){this.displayInPanel('<div class="mktFormWarning" class="tip-target" ext:qtip="'+errorDetails+'">'+html+'</div>');}else{this.displayInPanel('<div class="mktFormWarning">'+html+'</div>');}},clearPanel:function(){this.displayInPanel('');},eventDeselected:function(){Ext.getCmp('saveButton').disable();this.clearPanel();},webinarSettingsSubmit:function(button){var accountId=this.accountSelector.getValue();var compId=MktCanvas.getActiveTab().config.compId;var accountType=this.accountTypeSelector.getValue();var params=null;if(this.eventSelectionListAvailable){if(this.selectedEvent){var sessionKey=this.eventSelector.getValue();var event=this.selectedEvent;var params={compId:compId,accountType:accountType,accountId:accountId,sessionKey:sessionKey,sessionName:event.name,sessionDescription:event.description,startTime:event.startDate,endTime:event.endDate,timeZoneId:event.timeZoneID,timeZoneName:event.timeZoneName,phpTimeZone:event.phpTimeZone,metaData:Ext.util.JSON.encode(event.metaData)};}}else{var isValid=this.eventIdField.isValid();if(!isValid){return;}
var eventId=this.eventIdField.getValue();var params={compId:compId,accountType:accountType,accountId:accountId,sessionKey:eventId,metaData:{}};}
if(params!=null){MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/webinarSettingsSubmit',{serializeParms:params,onMySuccess:this.webinarSettingsSubmitDone.createDelegate(this,[button])});}else{this.close();}},webinarSettingsSubmitDone:function(){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var summaryTab=MktCanvas.getFirstTab();var activeTab=MktCanvas.activeTab;var summaryTabIsActive=summaryTab.id==activeTab.id;if(summaryTabIsActive){MktCanvas.reloadActiveTab();}else{summaryTab.clearContentValid();}
this.close();Mkt.apps.marketingEvent.reloadStore(MktCanvas.getActiveTab().config.compId);}}});Mkt.apps.marketingEvent.ScheduleDialog=Ext.extend(Mkt.widgets.ModalForm,{title:'Event Schedule',minWidth:410,width:440,height:220,resizable:true,cls:'mktModalForm mktModalForm2 mktMarketingEvent',iconCls:'mkiCalClock',layout:'form',bodyStyle:'padding: 15px 15px 0 15px;',useStandardButtons:false,plain:true,editMode:true,modal:true,buttonAlign:'right',fieldRequiredMsg:'This field is required',selectedEvent:null,initComponent:function(){var hasWebinar=this.event.hasWebinar;this.createTimePicker=function(label,fieldName,timeStr,disabled){minValue=0;minText='';hideTime=false;var time=null;if(isDefined(timeStr)&&timeStr!=null&&timeStr.length>0){var time=new Date(timeStr);}
var options=[];options['fieldLabel']=label;options['dateValue']=time;options['name']=fieldName;options['timeWidth']=135;options['disabled']=disabled;options['timeConfig']={altFormats:'H:i:s',value:time,vtype:'datetimerange',increment:30,name:fieldName+'timeField',forceSelection:false,displayField:'field1',allowBlank:true};options['dateConfig']={altFormats:'Y-m-d|Y-n-d',value:time,vtype:'datetimerange',minValue:minValue,minText:minText,name:fieldName+'_dateField',allowBlank:true};var dateTime=new Ext.ux.form.DateTime(options);dateTime.on('focus',function(){dateTime.clearInvalid();},dateTime);return dateTime;};this.startTimePicker=this.createTimePicker('Start Date','startDate',this.event.startDate,hasWebinar);this.endTimePicker=this.createTimePicker('End Date','endDate',this.event.endDate,hasWebinar);var startDateField=this.startTimePicker.df;var startTimeField=this.startTimePicker.tf;var endDateField=this.endTimePicker.df;var endTimeField=this.endTimePicker.tf;startDateField.isStartDateField=true;this.startTimePicker.startTimePicker=this.startTimePicker;this.startTimePicker.endTimePicker=this.endTimePicker;startDateField.parent=this.startTimePicker;startTimeField.parent=this.startTimePicker;endDateField.isEndDateField=true;this.endTimePicker.startTimePicker=this.startTimePicker;this.endTimePicker.endTimePicker=this.endTimePicker;endDateField.parent=this.endTimePicker;endTimeField.parent=this.endTimePicker;this.timezoneComboBox=new Mkt.widgets.ComboBoxRemoteChain({fieldLabel:'Time Zone',triggerAction:'all',mode:'local',store:new Ext.data.SimpleStore({url:'/marketingEvent/getTimeZones',idProperty:'code',fields:['code','name'],autoLoad:true}),valueField:'code',value:hasWebinar?this.event.timezoneName:this.event.timezone,editable:false,disabled:hasWebinar,forceSelection:true,displayField:'name',emptyText:'- Choose -',width:275});this.note=new Ext.form.DisplayField({fieldLabel:'',value:hasWebinar?'<div class="mktFormWarning">Configure the event schedule with the webinar provider</div>':''})
this.items=[this.startTimePicker,this.endTimePicker,this.timezoneComboBox,this.note];this.buttons=this.buttons||[];this.buttons.push({text:'Save',id:'saveButton',iconCls:'mkiOk',disabled:hasWebinar,handler:function(button,event){this.scheduleDialogSubmit(button);}.createDelegate(this)});this.buttons.push({text:'Cancel',iconCls:'mkiCancel',handler:function(){this.hide();}.createDelegate(this)});Mkt.apps.marketingEvent.ScheduleDialog.superclass.initComponent.call(this);},scheduleDialogSubmit:function(button){var isValid=this.startTimePicker.validate()&&this.endTimePicker.validate()&&this.timezoneComboBox.validate();if(isValid){var startTime=this.startTimePicker.getValue();var endTime=this.endTimePicker.getValue();var phpTimeZone=this.timezoneComboBox.getValue();var params={compId:MktCanvas.getActiveTab().config.compId,startTime:startTime,endTime:endTime,phpTimeZone:phpTimeZone};MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/scheduleDialogSubmit',{serializeParms:params,onMySuccess:this.scheduleDialogSubmitDone.createDelegate(this,[button])});}},scheduleDialogSubmitDone:function(){MktSession.unclockCursor();var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var summaryTab=MktCanvas.getFirstTab();var activeTab=MktCanvas.activeTab;var summaryTabIsActive=summaryTab.id==activeTab.id;if(summaryTabIsActive){MktCanvas.reloadActiveTab();}else{summaryTab.clearContentValid();}
this.hide();Mkt.apps.marketingEvent.reloadStore(activeTab.config.compId);}}});Mkt.apps.marketingEvent.SfdcCampaignSyncForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Salesforce Campaign Sync',minWidth:400,width:500,autoHeight:true,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktSfdcCampaignSyncForm',iconCls:'mkiSalesforce',bodyStyle:'padding: 30px 15px 15px 15px;',layout:'form',plain:true,modal:true,labelWidth:140,buttonAlign:'right',okText:'Save',submitUrl:'marketingEvent/sfdcCampaignSyncSubmit',programsStore:null,campaignsStore:null,programId:null,campaignId:null,campaignField:null,campaignNameField:null,descriptionField:null,descriptionDisplayField:null,newCampaignFieldSet:null,existingCampaignFieldSet:null,warningMessage:null,statusErrorPanel:null,initComponent:function()
{Mkt.apps.marketingEvent.SfdcCampaignSyncForm.superclass.initComponent.call(this);this.programsStore=Mkt.apps.marketingEvent.getStore();this.campaignsStore=Ext.StoreMgr.get('campaigns');if(!this.campaignsStore){this.campaignsStore=new Ext.data.JsonStore({storeId:'campaigns',root:'',idProperty:'id',fields:[{name:'id'},{name:'name'},{name:'description'},{name:'isDeleted'}]});}
else{this.campaignsStore.removeAll();}
this._loadForm();},beforeSubmitCallback:function()
{var isValid=true;isValid=this.campaignField.validate()&&isValid;if(this.campaignId===0){isValid=this.nameField.validate()&&isValid;isValid=this.descriptionField.validate()&&isValid;}
return isValid;},okCallback:function()
{this.serializeJSON={programId:this.programId,campaignId:this.campaignId};if(this.campaignId===0){this.serializeJSON.name=this.nameField.getValue();this.serializeJSON.description=this.descriptionField.getValue();}},submitSuccessCallback:function(response)
{if(MktPage.appVars.result==MktSession.resultSuccess){MktCanvas.reloadActiveTab();Mkt.apps.marketingEvent.reloadStore(MktCanvas.getActiveTab().config.compId);this.close();}
else{if(MktPage.appVars.resultErrorType=='incompatibleStatuses'){this._hideNewCampaign();this._hideExistingCampaign();this._showStatusError(MktPage.appVars.resultErrorData||[]);}}},_loadForm:function()
{var program=this.programsStore.getById(this.programId);if(!program){MktSession.clockCursor();var params={compId:this.programId};var accessZoneId=MktCanvas.getActiveTab().config.accessZoneId;if(isDefined(accessZoneId)){params.accessZoneId=accessZoneId;};this.programsStore.load({params:params,add:true,callback:function(records,options,success){if(success){this._loadForm();}
MktSession.unclockCursor();},scope:this})
return;}
this.campaignId=program.get('campaignId');this.campaignField=new Ext.form.ImprovedComboBox({fieldLabel:'Campaign',autoSelect:false,editable:true,allowBlank:false,forceSelection:true,valueField:'id',displayField:'name',triggerAction:'all',mode:'local',anchor:'-10',style:'margin-bottom: 15px;',value:undefined,tpl:'<tpl for="."><div class="x-combo-list-item {recordCls}">{name}</div></tpl>',preventExpandOnLoad:true,store:new Ext.data.JsonStore({url:'marketingEvent/getSfdcCampaignList',baseParams:{accessZoneId:MktCanvas.getActiveTab().config.accessZoneId},idProperty:'id',valueProperty:'name',autoLoad:true,autoDestroy:true,root:'data.campaigns',fields:['id','name'],listeners:{load:function(store,records){if(!store)return;var noneRecord=new store.recordType({id:null,name:'None'});noneRecord.commit();store.insert(0,noneRecord);var newRecord=new store.recordType({id:0,name:'Create New'});newRecord.commit();store.insert(1,newRecord);if(records.length>0){var existingHeaderRecord=new store.recordType({id:'',name:' - Existing Campaigns - ',recordCls:'mktComboListItemHeader'});existingHeaderRecord.commit();store.insert(2,existingHeaderRecord);}
if(!Ext.isEmpty(this.campaignId)){this._showExistingCampaign();}
else{this.campaignField.setValue(null);}}.createDelegate(this),exception:function(proxy,type,action,options,response){MktMessage.showError(response.message||response.statusText||'Undefined error');}}}),listeners:{beforeselect:function(combo,record,index){return(record.data.id!=='');},select:function(combo){var selectedCampaignId=combo.getValue();this._selectCampaign(selectedCampaignId);}.createDelegate(this)}});this.add(this.campaignField);this.warningMessage=new Ext.Panel({cls:'mktSfdcCampaignSyncNote mkiSignWarning',hidden:true,unstyled:true,html:'Salesforce Campaign flow steps in smart campaigns will be skipped.&nbsp;&nbsp;'+'<a href="/guide/displaySuccessContent?contentTag=maMarketingEventHome_link1" target="_blank">Learn More</a>'});this.add(this.warningMessage);this.doLayout();},_selectCampaign:function(campaignId)
{this.campaignId=campaignId;this._hideStatusError();if(campaignId){this._hideNewCampaign();this._showExistingCampaign();}
else if(campaignId===0){this._hideExistingCampaign();this._showNewCampaign();}
else{this._hideNewCampaign();this._hideExistingCampaign();}},_showNewCampaign:function()
{var program=this.programsStore.getById(this.programId);if(!this.newCampaignFieldSet){var items=[];this.nameField=new Ext.form.TextField({fieldLabel:'Name',itemCls:'mktRequired',allowBlank:false});items.push(this.nameField);this.descriptionField=new Ext.form.TextArea({fieldLabel:'Description'});items.push(this.descriptionField);this.newCampaignFieldSet=new Ext.form.FieldSet({labelWidth:this.labelWidth,unstyled:true,style:'border: 0;',defaults:{anchor:'-10'},items:items});this.insert(2,this.newCampaignFieldSet);this.doLayout();}
else{this.newCampaignFieldSet.show();}
this.warningMessage.show();this.nameField.setValue(program.get('name')||'');},_hideNewCampaign:function()
{if(this.newCampaignFieldSet){this.newCampaignFieldSet.hide();this.warningMessage.hide();this.nameField.setValue(null);this.descriptionField.setValue(null);}},_showExistingCampaign:function()
{this._hideExistingCampaign();var campaign=this.campaignsStore.getById(this.campaignId);if(!campaign){MktSession.clockCursor();MktSession.ajaxRequest('marketingEvent/getSfdcCampaign',{serializeJSON:{campaignId:this.campaignId},onMySuccess:function(response){this.campaignsStore.loadData([response.JSONResults.campaign],true);this._showExistingCampaign();MktSession.unclockCursor();}.createDelegate(this)});return;}
if(campaign.get('isDeleted')){this.showErrorMessage('Campaign '+campaign.get('name')+' has been deleted in Salesforce');this.campaignField.setRawValue('');return;}
if(!this.existingCampaignFieldSet){var items=[];this.descriptionDisplayField=new Ext.form.DisplayField({fieldLabel:'Description'});items.push(this.descriptionDisplayField);this.existingCampaignFieldSet=new Ext.form.FieldSet({labelWidth:this.labelWidth,unstyled:true,style:'border: 0;',defaults:{anchor:'-10'},items:items});this.insert(2,this.existingCampaignFieldSet);this.doLayout();}
else{this.existingCampaignFieldSet.show();}
this.warningMessage.show();this.campaignField.setValue(this.campaignId);this.descriptionDisplayField.setValue(Ext.util.Format.nl2br(campaign.get('description'))||'None');},_hideExistingCampaign:function()
{if(this.existingCampaignFieldSet){this.existingCampaignFieldSet.hide();this.warningMessage.hide();this.descriptionDisplayField.setValue(null);}},_showStatusError:function(compatibilityData)
{if(!Ext.isArray(compatibilityData)){throw"{SfdcCampaignSyncForm._showStatusError} Compatibility data should be an array."}
if(!this.statusErrorPanel){this.statusErrorPanel=new Ext.Panel({cls:'mktSfdcCampaignSyncStatusError mki48SignForbidden',unstyled:true,autoHeight:true,items:[{unstyled:true,cls:'mktSfdcCampaignSyncStatusErrorMessage',html:'Not Allowed: Salesforce campaign contains incompatible statuses.&nbsp;&nbsp;'+'<a href="/guide/displaySuccessContent?contentTag=maMarketingEventHome_link2" target="_blank">Learn how to fix this.</a>'},{itemId:'statusGrid',xtype:'grid',enableColumnHide:false,disableSelection:true,trackMouseOver:false,height:120,viewConfig:{forceFit:true,getRowClass:function(record){return!record.get('isCompatible')?'mktSfdcCampaignSyncGridErrorRow':'';}},columns:[{header:'Salesforce Status',dataIndex:'campaignStatus',sortable:false},{header:'Marketo Status',dataIndex:'programStatus',sortable:false},{dataIndex:'isCompatible',sortable:false,hidden:true}],store:{xtype:'jsonstore',fields:[{name:'programStatus'},{name:'campaignStatus'},{name:'isCompatible',type:'boolean'}],data:compatibilityData,sortInfo:{field:'isCompatible',direction:'DESC'}}}]});this.add(this.statusErrorPanel);this.doLayout();}
else{var grid=this.statusErrorPanel.get('statusGrid');grid.getStore().loadData(compatibilityData);this.statusErrorPanel.show();}},_hideStatusError:function()
{if(this.statusErrorPanel){this.statusErrorPanel.hide();}}});Mkt.apps.marketingEvent.MembershipGridPanel=function(config){Mkt.apps.marketingEvent.MembershipGridPanel.superclass.constructor.call(this,config);};Mkt.apps.marketingEvent.MembershipGridPanel.ALL_STATUSES_FILTER_ID=-99;Ext.extend(Mkt.apps.marketingEvent.MembershipGridPanel,MktLeadDb.LeadListGridPanel,{layout:'fit',enablePaging:true,enableSearchPaging:true,searchEmptyText:'Quick Find...',autoSizeColumns:true,pagingEmptyMsg:'No members found',enableExport:true,compType:'Marketing Event',compSubtype:'Marketing Event',defaultSort:'Full Name',defaultOrder:'ASC',beforeLoadMaskMsg:'Loading membership...',afterLoadMaskMsg:'Loading {0} members...',enableTotalCountAsyncLoading:false,enableTotalCountRefresh:false,enableBackgroundLoad:false,colModelCacheKey:Mkt.apps.marketingEvent.colModelCacheKey,columnPickerUrl:'marketingEvent/fieldsColumnPicker',updateLayoutUrl:'marketingEvent/updateLayoutMeta',initComponent:function(){this.id='progMemberGrid';this.loadColumnMeta();this.leadNameTemplate=new Ext.Template('<a href="{leadHref}" target="_blank" title="{leadName} (Lead ID: {leadId})">{leadName}</a>');this.leadNameTemplate.compile();this.exportUrl='/marketingEvent/exportMembership?eventId='+this.eventId+'&dir=DESC&limit=20000';var proxy=new Ext.data.HttpProxy({api:{read:'/marketingEvent/readMembership',create:'/marketingEvent/createMembership',update:'/marketingEvent/updateMembership',destroy:'/marketingEvent/deleteMembership'}});var writer=new Ext.data.JsonWriter({encode:true,writeAllFields:false});this.ds=new Ext.data.JsonStore({proxy:proxy,writer:writer,baseParams:{compId:this.eventId,limit:this.pageSize,filter:Ext.encode(this.filter)},root:this.colMeta.root,idProperty:this.colMeta.idProperty,totalProperty:this.colMeta.totalProperty,successProperty:this.colMeta.successProperty,fields:this.colMeta.fields,remoteSort:true});delete this.filter;var specialColRenderer={"Acquired By":this.acquiredByRenderer,"Success":this.successRenderer};var specialCols=[];for(key in specialColRenderer){specialCols.push(key);}
var colCount=this.colMeta.columnModel.length;for(var i=0;i<colCount;i++){var col=this.colMeta.columnModel[i];if(col&&specialCols.indexOf(col.dataIndex)!=-1){col.renderer=specialColRenderer[col.dataIndex];}}
Mkt.apps.marketingEvent.MembershipGridPanel.superclass.initComponent.call(this);this.layoutMetaParams={compId:this.eventId,compType:'Marketing Event'};},exportHandler:function(){var grid=this.gridOwner;MktLeadDb.exportList(this.getEl().dom,grid.smListId,grid.compType,grid.compSubtype,grid.smListName,grid.canvas,grid.eventId,MktCanvas.getFirstTab().config.title);},acquiredByRenderer:function(val,meta,record,rowIndex,colIndex,store){if(val==true){return'<div class="mki16-grid-cell mkiUserNew"></div>';}
else{return"";}},successRenderer:function(val,meta,record,rowIndex,colIndex,store){if(val==true){return'<div class="mki16-grid-cell mkiOk"></div>';}
else{return'';}},applyFilter:function(filter){var store=this.getStore();store.setBaseParam('filter',Ext.encode(filter));lastOptions=store.lastOptions;Ext.apply(lastOptions.params,{start:0});store.reload(lastOptions);},selectAll:function(){this.getSelectionModel().selectAll();},hasSelection:function(){return this.getSelectionModel().getCount()>0;},getSelectedMemberIds:function(){var memberIds=[];var items=this.getSelectionModel().getSelections();if(items.length==1&&items[0].id=='ALL'){memberIds.push(items[0].id);}
else if(items.length>0){for(var i=0;i<items.length;i++){memberIds.push(items[i].data['Id']);}}
return memberIds;},updateColumnModel:function(layoutData){this.layoutData=layoutData;var store=this.getStore();var lastOptions=store.lastOptions;Ext.apply(lastOptions.params,{includeMeta:1});store.reload(lastOptions);}});Mkt.apps.marketingEvent.MembershipGrid=function(canvas,eventId,timezone,metaData,layoutData,filters,activeFilter,smListId,colLayoutTimeKey){this.grid=new Mkt.apps.marketingEvent.MembershipGridPanel({canvas:canvas,eventId:eventId,smListId:smListId,layoutMeta:{cols:layoutData.cols,sort:layoutData.sort},colMeta:{columnModel:metaData.fields,fields:metaData.fields,idProperty:metaData.idProperty,root:metaData.root,sortInfo:metaData.sortInfo,successProperty:metaData.successProperty,totalProperty:metaData.totalProperty},enableTotal:true,timezone:timezone,pageSize:50,colLayoutTimeKey:colLayoutTimeKey,filter:activeFilter});this.buildFilterTextAndFilter=function(){var filter=[];var summaryText='Filter: ';var numChecked=0;this.filtersetMenu.items.each(function(item,index,length){if(item.isXType('menucheckitem')){if(item.statusId!==Mkt.apps.marketingEvent.MembershipGridPanel.ALL_STATUSES_FILTER_ID&&item.checked){numChecked++;if(filter.length>0){summaryText+=', ';}
summaryText+=item.text;if(isDefined(item.statusId)){filter.push(item.statusId);}}}});if(numChecked==0){this.allStatusesMenuItem.setChecked(true,true);summaryText+=this.allStatusesMenuItem.text;}
return{text:summaryText,filter:filter};};this.changedFilterset=function(menuItem,value){if(menuItem.statusId===Mkt.apps.marketingEvent.MembershipGridPanel.ALL_STATUSES_FILTER_ID){if(value){this.filtersetMenu.items.each(function(item,index,length){if(item.isXType('menucheckitem')){if(item.statusId!==Mkt.apps.marketingEvent.MembershipGridPanel.ALL_STATUSES_FILTER_ID){item.setChecked(false,true);}}});}}
else if(value){this.allStatusesMenuItem.setChecked(false,true);}
var filterInfo=this.buildFilterTextAndFilter();this.filterBtn.setText(filterInfo.text);this.grid.applyFilter(filterInfo.filter);};MktCanvas.fillCanvasGrid(this.grid,canvas);var tbar=[];this.filtersetMenu=new MktMenu({cls:"MktMenu mktMenuStrictHeight"});this.allStatusesMenuItem=new Ext.menu.CheckItem({statusId:Mkt.apps.marketingEvent.MembershipGridPanel.ALL_STATUSES_FILTER_ID,text:'All Statuses',hideOnClick:false,checked:activeFilter.length==0,checkHandler:this.changedFilterset.createDelegate(this)});this.filtersetMenu.add(this.allStatusesMenuItem);this.filtersetMenu.add(new Ext.menu.Separator());for(var i=0;i<filters.length;i++){if(filters[i]['Name']==='Not in Program'){continue;}
var item=new Ext.menu.CheckItem({statusId:filters[i]['Id'],text:filters[i]['Name'],hideOnClick:false,checked:activeFilter.indexOf(filters[i]['Id'])!=-1,checkHandler:this.changedFilterset.createDelegate(this)});this.filtersetMenu.add(item);}
var filterInfo=this.buildFilterTextAndFilter();this.filterBtn=new Ext.Button({text:filterInfo.text,iconCls:'mkiFunnel',menu:this.filtersetMenu});tbar.push(this.filterBtn);MktCanvas.extendGutter(tbar,canvas);this.grid.loadPagedGrid();return this;};Mkt.apps.marketingEvent.EventStatusActionStatusWindow=Ext.extend(MktLeadDb.FloatingStatusWindow,{title:"Change Status",ctype:'Mkt.apps.marketingEvent.EventStatusActionStatusWindow',height:80,pollInterval:10000,refreshGrid:true,initComponent:function(){this.setStatuses(this);this.id='EventStatusActionStatusWindow'+this.campaignId;Mkt.apps.marketingEvent.EventStatusActionStatusWindow.superclass.initComponent.call(this);},setCompletedLeads:function(nLeads){this.completedLeads=nLeads;},setStatuses:function(statuses){if(hasValue(statuses.completed_leads)){this.completedLeads=statuses.completed_leads;}else{delete this.completedLeads;}
if(hasValue(statuses.status)){this.status=statuses.status;}else{delete this.status;}
if(hasValue(statuses.started_at)){this.startedAt=statuses.started_at;}else{delete this.startedAt;}
if(hasValue(statuses.ended_at)){this.endedAt=statuses.ended_at;}else{delete this.endedAt;}},buildTitleStatus:function(){var title="";if(hasValue(this.status)){title=this.status+' ';}
title+="Change Status";return title;},renderStatus:function(statuses){if(statuses){this.setStatuses(statuses);}
var buff='<div style="float:left; width:188px;">';var queued=(this.status=="Queued");var running=(this.status=="Running");var completed=(this.status=="Complete"||this.status=="Failed"||this.status=="Shutdown");if(hasValue(this.status)&&!completed){buff=buff+'Status: '+this.postProcessStatus(this.status)+'<br />';}
if(hasValue(this.completedLeads)&&running){buff=buff+'Leads processed: '+this.completedLeads+'<br />';}
if(!queued){buff=buff+'</div><div style="float:right; padding-right: 5px; padding-top:"><img style="margin-left:2px; margin-top: 4px; margin-bottom:2px; width:'+(completed?'24':'16')+'px; height:'+(completed?'24':'16')+'px;" '+'src=\"'+(!completed?this.executingImage:this.completedImage)+'\" />';buff+="</div>";}
if(completed){buff=buff+"Completed "+(hasValue(this.endedAt)?this.endedAt:"");buff=buff+'<div>Leads processed: '+this.completedLeads+'</div>';if(this.refreshGrid){var tab=MktCanvas.getActiveTab();if(tab.config.id=="maMembers"){tab.getGridPanel().reload();}
Mkt.apps.marketingEvent.reloadStore(tab.config.compId);}}
this.body.dom.innerHTML=buff;this.updateTitleStatus();},getStatus:function(){MktSession.ajaxRequest('/marketingEvent/getEventStatusActionStatus',{serializeParms:{campaignId:this.campaignId,triggerId:this.triggerId},onMySuccess:function(){var runStatuses=MktPage.appVars.eventStatusActionStatuses;this.renderStatus(runStatuses);if(hasValue(runStatuses)&&(runStatuses.status=="Complete"||runStatuses.status=="Failed"||runStatuses.status=="Shutdown")){this.stopPollingStatus(this.pollId);}}.createDelegate(this)});},postProcessStatus:function(status){switch(status){case"Failed":case"Shutdown":status="Complete";break;case"Queued":case"Running":case"Complete":default:break;}
return status;}});Mkt.apps.marketingEvent.constants={MARKETING_EVENT_ASSETS_PANEL_INDEX:1,MARKETING_EVENT_SETTINGS_PANEL_INDEX:2,MARKETING_EVENT_TOKENS_PANEL_INDEX:3,MARKETING_EVENT_MEMBERS_PANEL_INDEX:4};Mkt.apps.marketingEvent.timezones=[['Europe/Dublin','(GMT+00:00) Europe/Dublin'],['Europe/London','(GMT+00:00) Europe/London'],['UTC','(GMT+00:00) UTC'],['Europe/Paris','(GMT+01:00) Europe/Paris'],['Asia/Jerusalem','(GMT+02:00) Asia/Jerusalem'],['Europe/Bucharest','(GMT+02:00) Europe/Bucharest'],['Asia/Baghdad','(GMT+03:00) Asia/Baghdad'],['Asia/Baku','(GMT+04:00) Asia/Baku'],['Asia/Yekaterinburg','(GMT+05:00) Asia/Yekaterinburg'],['Asia/Novosibirsk','(GMT+06:00) Asia/Novosibirsk'],['Asia/Bangkok','(GMT+07:00) Asia/Bangkok'],['Asia/Shanghai','(GMT+08:00) Asia/Shanghai'],['Asia/Tokyo','(GMT+09:00) Asia/Tokyo'],['Pacific/Guam','(GMT+10:00) Pacific/Guam'],['Asia/Magadan','(GMT+11:00) Asia/Magadan'],['Australia/Sydney','(GMT+11:00) Australia/Sydney'],['Pacific/Fiji','(GMT+12:00) Pacific/Fiji'],['Pacific/Auckland','(GMT+13:00) Pacific/Auckland'],['Atlantic/Azores','(GMT-01:00) Atlantic/Azores'],['America/Montevideo','(GMT-02:00) America/Montevideo'],['America/Halifax','(GMT-04:00) America/Halifax'],['America/Indianapolis','(GMT-05:00) America/Indianapolis'],['America/Montreal','(GMT-05:00) America/Montreal'],['America/New_York','(GMT-05:00) America/New_York'],['America/Chicago','(GMT-06:00) America/Chicago'],['America/Winnipeg','(GMT-06:00) America/Winnipeg'],['America/Denver','(GMT-07:00) America/Denver'],['America/Edmonton','(GMT-07:00) America/Edmonton'],['America/Phoenix','(GMT-07:00) America/Phoenix'],['America/Los_Angeles','(GMT-08:00) America/Los_Angeles'],['America/Vancouver','(GMT-08:00) America/Vancouver'],['America/Anchorage','(GMT-09:00) America/Anchorage'],['Pacific/Honolulu','(GMT-10:00) Pacific/Honolulu'],['Pacific/Midway','(GMT-11:00) Pacific/Midway']];
/* ========== ../mkt-ext-2.0/apps/DataMgr.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.dataMgr');Mkt.apps.dataMgr.Common={duplicateGroupText:'Duplicate group name; please choose another name',maxGroupPerField:'You can only have 10 groups per field',createAutoSaveButton:function(){var cfg=Mkt.widgets.DataPanelManager.prototype.autoSaveConfig;return new Ext.Button({text:cfg.nochangeText,disabled:true,iconCls:cfg.nochangeIconCls});},afterSaveButtonTextUpdate:function(autoSaveButton){var cfg=Mkt.widgets.DataPanelManager.prototype.autoSaveConfig;if(autoSaveButton&&autoSaveButton.btnEl){var dt=new Date();var msg=cfg.savedText+dt.format('M j, h:ia');autoSaveButton.setText(msg);autoSaveButton.setIconClass(cfg.savedIconCls);autoSaveButton.el.highlight(cfg.highlightColor,{block:true});}},beforeSaveButtonTextUpdate:function(autoSaveButton){var cfg=Mkt.widgets.DataPanelManager.prototype.autoSaveConfig;if(autoSaveButton&&autoSaveButton.btnEl){var dt=new Date();var msg=cfg.savingText;autoSaveButton.setText(msg);autoSaveButton.setIconClass(cfg.savingIconCls);autoSaveButton.el.highlight(cfg.highlightColor,{block:true});}},deleteGroup:function(button){var firstTab=MktCanvas.getFirstTab();if(firstTab){MktMessage.confirmDelete('Delete Field Organizer','Are you sure you want to delete <b>'+firstTab.config.title+'</b>?',function(){MktSession.ajaxRequest('dataMgr/deleteDataMgr',{serializeParms:{dataMgrId:firstTab.config.compId},onMySuccess:this.deleteGroupDone.createDelegate(this,[firstTab.config.compId])});}.createDelegate(this),button.getEl(),'Delete');}},deleteGroupDone:function(dataMgrId){if(MktPage.appVars.result==MktSession.resultSuccess){var activeTab=MktCanvas.getActiveTab();if(activeTab&&activeTab.config.compId==dataMgrId*1){MktDlManager.loadDl({type:'LeadDb'});}}},clearContentSummaryTab:function(){var summaryTab=MktCanvas.getTab('dmDataMgrSummary');if(summaryTab){summaryTab.clearContentValid();}},buildDataMgrSummaryList:function(renderTo,groups,uiDataMgrType){var list=[];if(groups&&groups.length){for(var i=0;i<groups.length;i++){var text="";if(uiDataMgrType==Mkt.apps.dataMgr.DataMgrTypes.string){if(groups[i].name=="Other"){continue;}
else{text=groups[i].itemCount+' values';}}
else if(uiDataMgrType==Mkt.apps.dataMgr.DataMgrTypes.integer){var value=groups[i].values[0];if(!value.operator1){var value2=!Ext.isEmpty(value.value2)?value.value2:"";text='less than or equal '+value2;}
else{if(value.value2){text=(value.value1*1+1)+' - '+value.value2;}
else{text='more than '+value.value1;}}}
else if(uiDataMgrType==Mkt.apps.dataMgr.DataMgrTypes.datetime){var getDisplayDate=Mkt.apps.dataMgr.DatetimeGroupPanel.prototype.getDisplayDate;var value=groups[i].values[0];if(!value.operator1){var value2=!Ext.isEmpty(value.value2)?getDisplayDate(value.value2):"";text='on or before '+value2;}
else{if(value.value2){text=Mkt.util.Common.getNextDay(getDisplayDate(value.value1),Mkt.util.Format.longDateShortMonthFormat)+' - '+getDisplayDate(value.value2);}
else{text='after '+getDisplayDate(value.value1);}}}
list.push(new Ext.form.DisplayField({fieldLabel:groups[i].name,labelStyle:'height: 8px; padding-top: 1px;',value:text}));}}
if(list.length<=0){list.push(new Ext.form.DisplayField({hideLabel:true,labelStyle:'height: 8px;',value:'None'}));}
new Ext.Panel({layout:'form',labelWidth:100,unstyled:true,renderTo:renderTo,items:[list]});}};Mkt.apps.dataMgr.DataMgrTypes={string:'StringDataMgr',integer:'IntegerDataMgr',datetime:'DatetimeDataMgr'};Mkt.apps.dataMgr.DataMgrForm=Ext.extend(Mkt.widgets.ModalForm,{layout:'form',modal:true,okText:'Create',resizable:true,title:'New Field Organizer',minWidth:550,width:470,iconCls:'mkiDataTableAdd',height:250,editMode:false,labelWidth:130,cls:'mktModalForm mktModalForm2 mktModalForm3 mktDataMgrForm',bodyStyle:'padding: 30px 15px 0 15px;',submitUrl:'dataMgr/createDataMgrSubmit',initComponent:function(){this.items=this.items||[];this.items=this.items.concat(this.getFields());Mkt.apps.dataMgr.DataMgrForm.superclass.initComponent.call(this);},getFields:function(){var items=[];var fields=['attribute_name','dt','aid','disabled'];var jsonStore=new Ext.data.JsonStore({url:'fieldManagement/getFieldsAsCombo',root:'suggest',baseParams:{},fields:fields});var store=new Ext.data.SimpleStore({fields:fields,data:[[this.sourceFieldName,this.sourceDataType,this.aid,false]]});this.aidField=new Ext.form.ImprovedComboBox({fieldLabel:"Field",lazyRender:true,store:jsonStore,displayField:'attribute_name',valueField:'aid',forceSelection:true,typeAhead:false,triggerAction:'all',selectOnFocus:false,itemCls:'mktRequired',anchor:"94%",mode:'remote',loadingText:'Searching...',minChars:0,allowBlank:false,name:"aid"});items.push(this.aidField);this.descriptionField=new Ext.form.TextArea({anchor:"94%",fieldLabel:'Description'});items.push(this.descriptionField);return items;},beforeSubmitCallback:function(){if(!this.aidField.validate()){return false;}},okCallback:function(){this.dataMgrSubmit();},dataMgrSubmit:function(){var aid=this.aidField.getValue();var groupName=this.aidField.getRawValue()+' Group';this.serializeParms={aid:aid,groupName:groupName,parentId:this.parentId,description:this.descriptionField.getValue(),accessZoneId:this.accessZoneId,editMode:this.editMode};},submitSuccessCallback:function(){if(MktPage.appVars.result==MktSession.resultSuccess){MktDlManager.loadDl({type:'DataMgr',panelIndex:1,compId:MktPage.appVars.dataMgrId});}}});Mkt.apps.dataMgr.DataMgr=function(config){if(config.dataMgrType&&Mkt.apps.dataMgr[config.dataMgrType]){config.initialConfig=Ext.decode(Ext.encode(config));var dataMgr=new Mkt.apps.dataMgr[config.dataMgrType](config);MktCanvas.fillCanvas(dataMgr,config.canvas,false);MktCanvas.registerItem('dataMgr',dataMgr,config.canvas);}
else{MktMessage.showNotAllowed('Field type is not supported');}};Mkt.apps.dataMgr.StringDataMgr=Ext.extend(Mkt.widget.LayoutDesigner,{cls:'mktFieldManager mktStringDataMgr',layout:'border',margins:'35 5 5 0',style:'padding-right: 5px;',bodyStyle:'height: 100%;',reservedHeight:21,reservedWidth:100,droppable:true,initComponent:function(){Mkt.apps.dataMgr.StringDataMgr.superclass.initComponent.call(this);this.addFilterMenu();},addFilterMenu:function(){var tbar=[];this.groupMenu=new MktMenu({cls:"MktMenu mktMenuStrictHeight"});this.groupMenu.on('hide',this.applyFilter.createDelegate(this));this.groupMenu.on('show',function(){this.checkedItems=this.getCheckedGroupIds();}.createDelegate(this));for(var i=0;i<this.groups.length;i++){var group=this.groups[i];var checked=false;if(group.name=='Other'){checked=true;this.checkedItems=this.checkedItems||[];this.checkedItems.push(group.id);}
this.groupMenu.add(new Ext.menu.CheckItem({text:group.name,itemId:'group'+group.id.toString(),hideOnClick:false,groupId:group.id,checked:checked}));}
this.groupFilterBtn=new Ext.Button({text:'Other',iconCls:'mkiFunnel',menu:this.groupMenu});tbar.push(this.groupFilterBtn);tbar.push('->');this.autoSaveBtn=Mkt.apps.dataMgr.Common.createAutoSaveButton();tbar.push(this.autoSaveBtn);MktCanvas.extendGutter(tbar,this.canvas);},buildCenterComponents:function(){this.dataMgrGrid=new Mkt.apps.dataMgr.StringDataMgrGridPanel({stringGroupPanel:this.stringGroupPanel,dataMgrId:this.dataMgrId});this.dataMgrGrid.loadPagedGrid();return this.dataMgrGrid;},createFilterFieldTreePanel:function(config){this.stringGroupPanel=new Mkt.apps.dataMgr.StringGroupPanel({groups:this.groups,dataMgr:this,groupsName:this.groupsName,beforeAddValuesToGroupCallback:this.beforeAddValuesToGroupCallback.createDelegate(this),addValuesToGroupCallback:this.addValuesToGroupCallback.createDelegate(this),deleteGroupCallback:this.deleteGroupCallback.createDelegate(this),addGroupCallback:this.addGroupCallback.createDelegate(this),editGroupCallback:this.editGroupCallback.createDelegate(this),dataMgrId:this.dataMgrId});return this.stringGroupPanel;},deleteGroupCallback:function(groupItem){if(groupItem.itemCount>0){this.dataMgrGrid.loadPagedGrid();}
var groupMenuItem=this.groupMenu.items.get('group'+groupItem.groupId.toString());if(groupMenuItem){this.groupMenu.remove(groupMenuItem);}},addGroupCallback:function(groupItem){this.groupMenu.add(new Ext.menu.CheckItem({text:groupItem.itemText,itemId:'group'+groupItem.groupId.toString(),hideOnClick:false,groupId:groupItem.groupId,checked:false}));},editGroupCallback:function(groupItem){var groupMenuItem=this.groupMenu.items.get('group'+groupItem.groupId.toString());if(groupMenuItem){groupMenuItem.setText(groupItem.itemText);}},beforeAddValuesToGroupCallback:function(){Mkt.apps.dataMgr.Common.beforeSaveButtonTextUpdate(this.autoSaveBtn);},addValuesToGroupCallback:function(){Mkt.apps.dataMgr.Common.afterSaveButtonTextUpdate(this.autoSaveBtn);},updateGroupCount:function(groupId,itemCount){this.stringGroupPanel.updateGroupCount(groupId,itemCount);},getFilterName:function(){var checkedGroupNames=[];var filterName="";this.groupMenu.items.each(function(item){if(item.checked){checkedGroupNames.push(item.text);}},this);for(var i=0;i<3;i++){if(!checkedGroupNames[i]){break;}
if(filterName){filterName=filterName+", "+checkedGroupNames[i];}
else{filterName=checkedGroupNames[i];}}
if(checkedGroupNames.length>3){filterName=filterName+' ...';}
return filterName;},getCheckedGroupIds:function(){var checkedGroupIds=[];this.groupMenu.items.each(function(item){if(item.checked){checkedGroupIds.push(item.groupId);}},this);return checkedGroupIds;},applyFilter:function(){if(this.dataMgrGrid){var filterName=this.getFilterName();if(filterName){this.groupFilterBtn.setText(filterName);}
var store=this.dataMgrGrid.getStore();if(store){var checkedItems=this.getCheckedGroupIds();if(!Mkt.util.Common.arrayEqual(checkedItems,this.checkedItems)){store.setBaseParam('filter',Ext.encode(checkedItems));this.dataMgrGrid.loadPagedGrid();}}}}});Mkt.apps.dataMgr.StringDataMgrGridPanel=Ext.extend(MktGrids.CanvasGridPanel,{layout:'fit',enableTotal:true,searchEmptyText:'Quick Find...',searchQtip:'Search for values',beforeLoadMaskMsg:'Loading values...',afterLoadMaskMsg:'Loading {0} value...',pagingEmptyMsg:'No values found',autoExpandColumn:'value',defaultSort:'value',defaultOrder:'ASC',ddGroup:'stringDataMgrDDGroup',enableDragDrop:true,cls:'nestedGrid',enablePaging:true,enableSearchPaging:true,searchEmptyText:'Quick Find...',pageSize:500,view:new MktGrids.BufferGridView({forceFit:false}),enablePurpleCorners:false,initComponent:function(){var fields=[{name:'value',type:'string'},{name:'group',type:'string'}];this.ds=new Ext.data.JsonStore({url:'dataMgr/getAllValues',totalProperty:'totalCount',fields:fields,remoteSort:true,baseParams:{limit:this.pageSize,compId:this.dataMgrId,filter:Ext.encode([0])},idProperty:'value',root:'data',sortInfo:{field:'value',direction:'ASC'}});this.cm=new Ext.grid.ColumnModel([{id:'value',header:'Value',dataIndex:'value',sortable:true,width:30},{id:'group',header:'Group',dataIndex:'group',sortable:true,width:200}]);Mkt.apps.dataMgr.StringDataMgrGridPanel.superclass.initComponent.call(this);this.on('keypress',function(e){var keyPressed=e.getKey();if(keyPressed){var groupId=this.stringGroupPanel.getGroupIdFromKey.call(this.stringGroupPanel,keyPressed);if(groupId||groupId===0){var values=[];var sm=this.getSelectionModel();var selections=sm.getSelections();if(selections){for(var i=0;i<selections.length;i++){values.push(selections[i].get('value'));}}
this.stringGroupPanel.addValuesToGroup(values,groupId);}}});this.on('afterrender',function(){var view=this.getView();if(view&&view.scroller){view.scroller.addClass('nestedGridSidewall');}}.createDelegate(this));}});Mkt.apps.dataMgr.StringGroupPanel=Ext.extend(Ext.Panel,{cls:'mktFilterTree mktStringGroupPanel',bodyStyle:'padding: 7px 0 0 10px;',frame:true,initComponent:function(){var items=this.items||[];this.currentShortcutKey=0;this.groupItems={};this.groupsNamePanel=new Ext.Panel({style:'font-size: 12px; font-weight: bold; padding-bottom: 7px;',bodyStyle:'float:left;',html:this.groupsName});items.push(this.groupsNamePanel);var that=this;this.groupsNamePanel.on('afterrender',function(){var labelEditor=new Ext.Editor({alignment:'l-l',listeners:{beforecomplete:function(ed,value){return true;},complete:function(ed,value,oldValue){if(value==oldValue){return;}
MktSession.ajaxRequest('dataMgr/editGroupsName',{serializeParms:{groupsName:value,dataMgrId:that.dataMgrId},onMySuccess:that.editGroupsNameDone.createDelegate(that)});}.createDelegate(this)},field:{allowBlank:false,xtype:'textfield',width:206,selectOnFocus:true},shadow:false,completeOnEnter:true,cancelOnEsc:true,updateEl:true,ignoreNoChange:true});if(this.bwrap){var editEl=new Ext.Element(Ext.DomHelper.createDom({tag:'img',src:'/images/icons16/pencil.png',style:'display:block; position: absolute ; cursor: pointer;'+'top: 7px; left: 226px; width:16px; height: 16px; float:left; '}));this.bwrap.appendChild(editEl);editEl.on('click',function(e,t){labelEditor.startEdit(this.body);}.createDelegate(this));}
this.body.on('click',function(e,t){labelEditor.startEdit(t);});});this.groupItems={};for(var i=0;i<this.groups.length;i++){var group=this.groups[i];var shortcutKey=this.currentShortcutKey;if(group.name=="Other"){shortcutKey='X';}
else{this.currentShortcutKey++;}
this.groupItems[group.id]=new Mkt.apps.dataMgr.StringGroupItem({dataMgrId:this.dataMgrId,groupId:group.id,dataMgr:this,hideDelete:group.hideDelete,readOnly:group.readOnly,shortcutKey:shortcutKey,deleteGroupCallback:this.deleteGroup.createDelegate(this),addGroupCallback:this.addGroupCallback,editGroupCallback:this.editGroupCallback,itemText:group.name,itemCount:group.itemCount});items.push(this.groupItems[group.id]);}
this.addGroupButton=new Ext.Button({iconCls:'mkiAdd2',style:'margin-top: 10px',text:'Add Group',handler:function(){var count=0;for(group in this.groupItems){count++;}
if(count>=11){MktMessage.showInfo(Mkt.apps.dataMgr.Common.maxGroupPerField);return;}
var tempGroupId=Ext.id();this.groupItems[tempGroupId]=new Mkt.apps.dataMgr.StringGroupItem({dataMgrId:this.dataMgrId,tempGroupId:tempGroupId,dataMgr:this,newItem:true,deleteGroupCallback:this.deleteGroup.createDelegate(this),addGroupCallback:this.addGroupCallback,editGroupCallback:this.editGroupCallback,itemText:'New Group',shortcutKey:this.currentShortcutKey,itemCount:0,editMode:true});this.insert(this.items.length-1,this.groupItems[tempGroupId]);this.doLayout();this.currentShortcutKey++;}.createDelegate(this)});items.push(this.addGroupButton);this.items=items;Mkt.apps.dataMgr.StringGroupPanel.superclass.initComponent.call(this);this.on('afterrender',this.setupPanel,this);},editGroupsNameDone:function(name){var summaryTab=MktCanvas.getTab('dmDataMgrSummary');if(summaryTab){if(MktPage.appVars.dataMgrName){summaryTab.setTitle(MktPage.appVars.dataMgrName);}
summaryTab.clearContentValid();}},findGroup:function(groupId){var group;for(groupItem in this.groupItems){if(this.groupItems[groupItem].groupId==groupId){group=this.groupItems[groupItem];break;}}
return group;},getGroupCount:function(){var count=0;for(this.groupItems in groupItem){count++;}
return count;},updateGroupCount:function(groupId,itemCount){var group=this.findGroup(groupId);if(group){group.itemCount=itemCount;group.updateText();}},deleteGroup:function(groupItem){MktMessage.confirmDelete('Delete Group',groupItem.itemCount+' values will be moved from <b>'+groupItem.itemText+'</b> to <b>Other</b>.<br /><br />Are you sure you want to delete <b>'+groupItem.itemText+'</b>?',function(){Mkt.apps.dataMgr.Common.beforeSaveButtonTextUpdate(this.autoSaveBtn);MktSession.ajaxRequest('dataMgr/deleteGroup',{serializeParms:{dataMgrId:this.dataMgrId,groupId:groupItem.groupId},onMySuccess:function(groupItem){var group=this.findGroup(groupItem.groupId);if(group){this.remove(group,true);delete this.groupItems[groupItem.groupId];this.doLayout();}
if(this.deleteGroupCallback){this.deleteGroupCallback(groupItem);}
Mkt.apps.dataMgr.Common.afterSaveButtonTextUpdate(this.autoSaveBtn);Mkt.apps.dataMgr.Common.clearContentSummaryTab();}.createDelegate(this,[groupItem])});}.createDelegate(this));},setupPanel:function(){var that=this;this.dropTarget=new Ext.dd.DropTarget(this.body.dom,{ddGroup:'stringDataMgrDDGroup',notifyOver:function(dragSource,e,data){if(e.getTarget('.mktStringGroupItemDrop',10)){return Ext.dd.DropZone.prototype.dropAllowed;}
else{return Ext.dd.DropZone.prototype.dropNotAllowed;}},notifyDrop:function(ddSource,e,data){var el=e.getTarget('.mktStringGroupItem',10);if(el){var groupId=Ext.get(el).getAttribute('group-panel-id','mkt');if(groupId&&data.grid){var sm=data.grid.getSelectionModel();if(sm){var values=[];var selections=sm.getSelections();if(selections){for(var i=0;i<selections.length;i++){values.push(selections[i].get('value'));}}
that.addValuesToGroup(values,groupId);}}}
return true;}.createDelegate(this)});},addValuesToGroup:function(values,groupId){if(values.length<=0){return;}
if(this.beforeAddValuesToGroupCallback){this.beforeAddValuesToGroupCallback();}
var grid=this.dataMgr.dataMgrGrid;if(grid){var sm=grid.getSelectionModel();grid.deleteGridRows(values);if(grid.getStore().getCount()<=0){grid.loadPagedGrid();}
else{grid.pager.updatePaging();sm.selectRow(sm.last);}}
MktSession.ajaxRequest('dataMgr/addValuesToGroup',{serializeParms:{dataMgrId:this.dataMgrId,groupId:groupId,values:Ext.encode(values)},onMySuccess:this.addValuesToGroupDone.createDelegate(this,[values,groupId])});},addValuesToGroupDone:function(values,groupId){Mkt.apps.dataMgr.Common.clearContentSummaryTab();var group=this.findGroup(groupId);if(group){group.bwrap.highlight(Mkt.widgets.DataPanelManager.prototype.autoSaveConfig.highlightColor,{block:true,endColor:"#E7E7E7"});}
this.addValuesToGroupCallback(values,groupId);},addValuesToGroupCallback:Ext.emptyFn,getGroupIdFromKey:function(keyCode){var asciiKey=String.fromCharCode(keyCode);var index=asciiKey*1;if(this.groups[index+1]){return this.groups[index+1].id;}
else if(asciiKey&&asciiKey.toUpperCase()=='X'){return 0;}}});Mkt.apps.dataMgr.StringGroupItem=Ext.extend(Ext.Panel,{shortcutKeyImage:"/images/icons24/number_shortcut.png",style:'padding-top: 10px',cls:'mktStringGroupItem',height:30,editMode:false,shortcutKey:0,initComponent:function(){var items=this.items||[];this.shortcutKeyImage=new Ext.Element(Ext.DomHelper.createDom({tag:'div',html:this.shortcutKey.toString(),style:'background: url("'+this.shortcutKeyImage+'") no-repeat; color: #FFF; padding-left: 5px; height: 26px;'}));items.push({width:30,cls:'mktStringGroupItemDrop',style:'float: left',contentEl:this.shortcutKeyImage});var itemCountText=' ('+this.itemCount+')';this.textPanel=new Ext.Panel({width:100,cls:'mktStringGroupItemDrop',baseCls:'mktStringGroupItemEditable',style:'float: left; cursor: default;',itemText:this.itemText,itemCountText:itemCountText,html:this.getItemHtml(this.itemText,this.itemCount)});items.push(this.textPanel);this.textPanel.on('afterrender',this.textPanelAfterRender,this);this.deleteButton=new Ext.Element(Ext.DomHelper.createDom({tag:'a',cls:'mktStringGroupItemDrop',href:'#',width:16,children:[{tag:'img',cls:'mkiDeleteSmall',style:'width: 16px; height: 16px;',src:Ext.BLANK_IMAGE_URL}]}));if(!this.hideDelete){this.deleteButton.on('click',function(e,html){e.stopEvent();if(this.deleteGroupCallback){this.deleteGroupCallback(this);}}.createDelegate(this));this.deleteButtonPanel=new Ext.Panel({width:20,cls:'mktEmbedButton'+(this.editMode?' mktHidden':''),contentEl:this.deleteButton,unstyled:true});items.push(this.deleteButtonPanel);}
this.saveButton=new Ext.Element(Ext.DomHelper.createDom({tag:'a',cls:'mktStringGroupItemDrop',href:'#',width:16,children:[{tag:'img',cls:'mkiOk',style:'width: 16px; height: 16px;',src:Ext.BLANK_IMAGE_URL}]}));this.saveButton.on('click',function(e,html){this.textPanelEditor.completeEdit();e.stopEvent();}.createDelegate(this));this.saveButtonPanel=new Ext.Panel({width:20,cls:'mktEmbedButton'+(this.editMode?'':' mktHidden'),contentEl:this.saveButton,unstyled:true});items.push(this.saveButtonPanel);this.cancelButton=new Ext.Element(Ext.DomHelper.createDom({tag:'a',cls:'mktStringGroupItemDrop',href:'#',width:16,children:[{tag:'img',cls:'mkiCancel',style:'width: 16px; height: 16px;',src:Ext.BLANK_IMAGE_URL}]}));this.cancelButton.on('click',function(e,html){this.setupEditMode(false);this.textPanelEditor.cancelEdit();if(!this.groupId){this.dataMgr.remove(this);}
e.stopEvent();}.createDelegate(this));this.cancelButtonPanel=new Ext.Panel({width:20,cls:'mktEmbedButton'+(this.editMode?'':' mktHidden'),contentEl:this.cancelButton,unstyled:true});items.push(this.cancelButtonPanel);this.items=items;Mkt.apps.dataMgr.StringGroupItem.superclass.initComponent.call(this);this.on('afterrender',function(){if(this.el){this.el.dom.setAttribute('mkt:group-panel-id',this.groupId);}}.createDelegate(this));},updateText:function(){this.textPanel.update(this.getItemHtml(this.itemText,this.itemCount));},getItemHtml:function(itemText,itemCount){var itemHtml;if(itemText!='Other'){itemHtml=itemText+" ("+itemCount+")";}
else{itemHtml=itemText;}
return itemHtml;},textPanelAfterRender:function(){if(!this.textPanelEditor&&!this.readOnly){var that=this;this.textPanelEditor=new Ext.Editor({alignment:'l-l',listeners:{beforecomplete:function(ed,value){return true;}.createDelegate(this),canceledit:function(){this.setupEditMode(false);if(this.newItem){this.dataMgr.remove(this);}}.createDelegate(this),complete:function(ed,value,oldValue){if(value!=oldValue||this.newItem){this.newItem=false;that.completeGroupEdit.call(that,ed,value,oldValue);}
else{this.setupEditMode(false);}}.createDelegate(this)},field:{allowBlank:false,xtype:'textfield',width:90,selectOnFocus:true},shadow:false,completeOnEnter:true,cancelOnEsc:true,updateEl:true,allowBlur:false,ignoreNoChange:false});}
this.body.on('click',this.startGroupEdit,this);if(this.editMode){this.startGroupEdit(undefined,this.textPanel.body);}},startGroupEdit:function(e,t){if(this.readOnly){return;}
if(!Ext.get(t).hasClass('mktStringGroupItemEditable-body')){return;}
this.setupEditMode();var tEl=Ext.get(t);if(tEl){tEl.update(this.itemText);}
this.textPanelEditor.startEdit(t);},completeGroupEdit:function(ed,value,oldValue){this.setupEditMode(false);var parms={dataMgrId:this.dataMgrId,groupId:this.groupId,name:value};if(this.tempGroupId&&!this.groupId){parms.tempGroupId=this.tempGroupId;}
MktSession.ajaxRequest('dataMgr/groupSubmit',{serializeParms:parms,onMySuccess:this.groupSubmitDone.createDelegate(this,[parms,ed])});},groupSubmitDone:function(parms,editor){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){Mkt.apps.dataMgr.Common.clearContentSummaryTab();this.itemText=parms.name;if(this.tempGroupId){if(this.tempGroupId==MktPage.appVars.tempGroupId){this.groupId=MktPage.appVars.groupId;this.el.dom.setAttribute('mkt:group-panel-id',this.groupId);this.tempGroupId=undefined;delete this.tempGroupId;if(this.addGroupCallback){this.addGroupCallback(this);}}}
else{if(this.groupId==MktPage.appVars.groupId&&this.editGroupCallback){this.editGroupCallback(this);}}
this.textPanel.update(this.getItemHtml(this.itemText,this.itemCount));}
else if(result==MktSession.resultDuplicate){MktMessage.showNotAllowed(Mkt.apps.dataMgr.Common.duplicateGroupText,function(){this.textPanel.body.update(this.itemText);this.startGroupEdit(undefined,this.textPanel.body);}.createDelegate(this));}},setupEditMode:function(editMode){if(editMode===false){if(this.deleteButtonPanel){this.deleteButtonPanel.removeClass('mktHidden');if(this.deleteButtonPanel.el&&this.deleteButtonPanel.el.hasClass('mktHidden')){this.deleteButtonPanel.removeClass('mktHidden');}}
this.saveButtonPanel.addClass('mktHidden');this.cancelButtonPanel.addClass('mktHidden');this.updateText();}
else{if(this.deleteButtonPanel){this.deleteButtonPanel.addClass('mktHidden');}
this.saveButtonPanel.removeClass('mktHidden');this.cancelButtonPanel.removeClass('mktHidden');}}});Mkt.apps.dataMgr.IntegerDataMgr=Ext.extend(Ext.Panel,{initComponent:function(){var items=this.items||[];this.groupsEditor=new Mkt.widgets.CanvasHeader({titleValue:this.groupsName,editable:true,bodyStyle:'background: #fff; border-color: #fff; height: 26px;',cls:'mktCanvasHeader mktCanvasHeaderTitleOnly',descValue:'',titleEditable:true,titleId:'groupsName',descEditable:false,actionUrl:'dataMgr/editGroupsName',savedCallback:this.editGroupsNameDone.createDelegate(this),serializeParms:{dataMgrId:this.dataMgrId}});items.push(this.groupsEditor);this.groupPanel=this.getGroupPanel();items.push(this.groupPanel);this.items=items;Mkt.apps.dataMgr.IntegerDataMgr.superclass.initComponent.call(this);},getGroupPanel:function(){return new Mkt.apps.dataMgr.IntegerGroupPanel(this.initialConfig);},editGroupsNameDone:function(){var summaryTab=MktCanvas.getTab('dmDataMgrSummary');if(summaryTab&&MktPage.appVars.dataMgrName){summaryTab.setTitle(MktPage.appVars.dataMgrName);Mkt.apps.dataMgr.Common.clearContentSummaryTab();}},updateGroupInfo:function(tempGroupId,groupId,groupName){if(tempGroupId&&groupId){this.groupPanel.updateGroupInfo(tempGroupId,groupId,groupName);}}});Mkt.apps.dataMgr.IntegerGroupPanel=Ext.extend(Ext.Panel,{collapsible:false,margins:'0 0 20 0',bodyStyle:'padding: 0 0 10px 20px;',title:'Group Definition',iconCls:'mkiDataTable',frame:true,autoWidth:true,autoHeight:true,resizable:false,monitorResize:true,cls:'mktDataPanel range-data-manager mktIntegerGroupPanel',baseCls:'mktDataPanelFrame x-panel',initComponent:function(){var items=this.items||[];this.groupHeader=this.getGroupHeader();items.push(this.groupHeader);this.group=[];if(this.groups&&this.groups.length>0){for(var i=0;i<this.groups.length;i++){items.push(this.addGroup(this.groups[i],false,false));}}
else{items.push(this.addGroup({tempGroupId:Ext.id()},false,false));}
this.items=items;Mkt.apps.dataMgr.IntegerGroupPanel.superclass.initComponent.call(this);this.addAutosaveButton();this.on('afterrender',function(){this.ownerCt.body.applyStyles({overflow:'auto'});}.createDelegate(this));},getGroupHeader:function(){var headerItems=[];this.header1Panel=new Ext.Panel({html:'Group Name',bodyStyle:'margin: 0 0 0 0; font-size: 12px;',cls:'mktEmbedText mktEmbedHeader',width:100,unstyled:true});headerItems.push(this.header1Panel);this.header2Panel=new Ext.Panel({html:'Group Range',bodyStyle:'margin: 0 0 0 0; font-size: 12px;',style:'margin-left: 46px;',cls:'mktEmbedText mktEmbedHeader',width:100,unstyled:true});headerItems.push(this.header2Panel);this.headerContainer=new Ext.Panel({items:headerItems,style:'margin-top: 15px; padding-bottom: 5px;',unstyles:true});return this.headerContainer;},addAutosaveButton:function(){var tbar=[];tbar.push('->');this.autoSaveBtn=new Ext.Button({text:'Auto-Save: no changes',disabled:true,iconCls:'mkiFloppyDisk'});tbar.push(this.autoSaveBtn);MktCanvas.extendGutter(tbar,this.canvas);},addGroup:function(config,addLayout,validate){if(this.group[this.group.length-1]&&validate!==false){var group=this.group[this.group.length-1];if(!this.validateValue(this.group[this.group.length-1])||!group.firstInputPanel.validate()){return;}
else if(!group.secondInputPanel.getValue()){group.secondInputPanel.markInvalid('This field is required for adding a new group');return;}
else if(group.isDuplicate&&group.isDuplicateName==group.firstInputPanel.getValue()){group.firstInputPanel.markInvalid(Mkt.apps.dataMgr.Common.duplicateGroupText);return;}};if(this.group.length>=10){MktMessage.showInfo(Mkt.apps.dataMgr.Common.maxGroupPerField);return;}
var group=this.getGroup(config,addLayout);this.group.push(group);if(addLayout){this.add(group);this.doLayout();}
if(this.group[this.group.length-2]){this.group[this.group.length-2].addButtonPanel.addClass('mktHidden');}
return group;},getGroup:function(config){var value1,value2,operator1,operator2,valueId,groupName,groupId;if(config){if(config.values&&config.values.length>0){groupId=config.id;value1=config.values[0].value1;operator1=config.values[0].operator1;value2=config.values[0].value2;operator2=config.values[0].operator2;valueId=config.values[0].valueId;}
groupName=config.name;}
return new Mkt.apps.dataMgr.IntegerGroupItem(Ext.apply({groupName:groupName,valueId:valueId,value1:value1,groupId:groupId,operator1:operator1,value2:value2,operator2:operator2,addGroupCallback:this.addGroup.createDelegate(this),removeGroupCallback:this.removeGroup.createDelegate(this),operatorText:this.getOperatorText(this.group.length),saveChangesCallback:this.saveChanges.createDelegate(this)},config));},removeGroup:function(groupItem){if(!groupItem.groupId){this.removeGroupItem(groupItem);return;}
var msg='Are you sure you want to delete the group <b>'+groupItem.groupName+'</b>?';MktMessage.confirmDelete('Delete Group',msg,this.removeGroupSubmit.createDelegate(this,[groupItem.groupId]),undefined);},removeGroupSubmit:function(groupId){if(groupId){MktSession.clockCursor();Mkt.apps.dataMgr.Common.beforeSaveButtonTextUpdate(this.autoSaveBtn);MktSession.ajaxRequest('dataMgr/deleteGroup',{serializeParms:{dataMgrId:this.dataMgrId,groupId:groupId},onMySuccess:this.removeGroupSubmitDone.createDelegate(this,[groupId])});}},removeGroupItem:function(group){var groupId=group.groupId;var addButtonPanel=group.addButtonPanel;if(addButtonPanel&&addButtonPanel.getEl()&&!addButtonPanel.getEl().hasClass('mktHidden')){var prevGroup=this.findPrevGroupFromGroupId(groupId);if(prevGroup){var addButtonPanelEl=prevGroup.addButtonPanel.getEl();if(addButtonPanelEl){addButtonPanelEl.removeClass('mktHidden');}}}
var nextGroup=this.findNextGroupFromGroupId(groupId);this.remove(group,true);this.group.remove(group);if(this.group.length<=0){this.addGroup({tempGroupId:Ext.id()},true);}
else{this.doLayout();}
if(nextGroup){var nextGroupIndex=this.getGroupIndex(nextGroup.groupId);if(isDefined(nextGroupIndex)){var operatorText=this.getOperatorText(nextGroupIndex);if(operatorText){nextGroup.operatorTextPanel.update(operatorText);}}}},removeGroupSubmitDone:function(groupId){MktSession.unclockCursor();var group=this.findGroup(groupId);if(group){this.removeGroupItem(group);}
Mkt.apps.dataMgr.Common.afterSaveButtonTextUpdate(this.autoSaveBtn);Mkt.apps.dataMgr.Common.clearContentSummaryTab();},updateGroupInfo:function(tempGroupId,groupId,groupName){var group=this.findGroup(tempGroupId,'tempGroupId');if(group){group.groupId=groupId;group.groupName=groupName;}},getGroupIndex:function(groupId,property){var groupIndex=-1;if(!property){property='groupId';}
for(var i=0;i<this.group.length;i++){if(this.group[i][property]==groupId){groupIndex=i;break;}}
return groupIndex;},findGroup:function(groupId,property){var group;if(!property){property='groupId';}
for(var i=0;i<this.group.length;i++){if(this.group[i][property]==groupId){group=this.group[i];break;}}
return group;},findPrevGroupFromGroupId:function(groupId){var group;for(var i=0;i<this.group.length;i++){if(this.group[i].groupId==groupId){if(i>0){group=this.group[i-1];}
break;}}
return group;},findNextGroupFromGroupId:function(groupId){var group;for(var i=0;i<this.group.length;i++){if(this.group[i].groupId==groupId){group=this.group[i+1];break;}}
return group;},validateValue:function(groupItem){var prevGroup=this.findPrevGroupFromGroupId(groupItem.groupId);var currentValue=this.getIntegerValue(groupItem.getSecondInputValue());if(prevGroup){if(!prevGroup.secondInputPanel.validate()||!groupItem.secondInputPanel.validate()){return false;}
var prevValue=this.getIntegerValue(prevGroup.getSecondInputValue());if(currentValue&&((currentValue*1)<=(prevValue*1))){groupItem.secondInputPanel.markInvalid('Value should be higher than the previous group');return false;}}
var nextGroup=this.findNextGroupFromGroupId(groupItem.groupId);if(nextGroup){if(!nextGroup.secondInputPanel.validate()||!nextGroup.secondInputPanel.validate()){return false;}
var nextValue=this.getIntegerValue(nextGroup.getSecondInputValue());if(nextValue&&currentValue&&((currentValue*1)>=(nextValue*1))){groupItem.secondInputPanel.markInvalid('Value should be less than the next group');return false;}
if(Ext.isEmpty(currentValue)||isNaN(currentValue)){groupItem.secondInputPanel.markInvalid("This field is required");return false;}}
return true;},getIntegerValue:function(val){return val;},saveChanges:function(groupItem){if(!this.validateValue(groupItem)){return;}
var value2=groupItem.getSecondInputValue();var groupName=groupItem.firstInputPanel.getValue();var operator2='<=';if(!groupName){return;}
var parms={dataMgrId:this.dataMgrId,groupId:groupItem.groupId,valueId:groupItem.valueId,groupName:groupName,value2:value2,operator2:operator2};if(!groupItem.groupId){parms.tempGroupId=groupItem.tempGroupId;}
var prevGroup=this.findPrevGroupFromGroupId(groupItem.groupId);if(prevGroup){parms.value1=prevGroup.getSecondInputValue();parms.operator1='>';}
Mkt.apps.dataMgr.Common.beforeSaveButtonTextUpdate(this.autoSaveBtn);MktSession.ajaxRequest('dataMgr/addValuesToGroup',{serializeParms:parms,onMySuccess:this.saveChangesDone.createDelegate(this,[parms])});},saveChangesDone:function(){var result=MktPage.appVars.result;var group=this.findGroup(MktPage.appVars.groupId);if(result==MktSession.resultDuplicate){if(group){group.firstInputPanel.markInvalid(Mkt.apps.dataMgr.Common.duplicateGroupText);group.isDuplicate=true;group.isDuplicateName=MktPage.appVars.groupName;}}
else{if(group){group.isDuplicate=false;group.isDuplicateName=undefined;}
Mkt.apps.dataMgr.Common.clearContentSummaryTab();}
Mkt.apps.dataMgr.Common.afterSaveButtonTextUpdate(this.autoSaveBtn);},getOperatorText:function(index){var prevValue2;if(this.group&&this.group[index-1]){prevValue2=this.group[index-1].getSecondInputValue();}
if(index<1){return'<=';}
else{return'> '+prevValue2+' to';}}});Mkt.apps.dataMgr.IntegerGroupItem=Ext.extend(Ext.Panel,{operatorPanelWidth:80,bodyStyle:'padding-top: 10px;',initComponent:function(){var items=this.items||[];this.firstInputPanel=new Ext.form.TextField({emptyText:'Group Name',hideLabel:true,allowBlank:false,value:this.groupName,style:'float: left'});this.firstInputPanel.on('blur',this.saveChanges.createDelegate(this));items.push(this.firstInputPanel);this.operatorTextPanel=new Ext.Panel({html:this.operatorText,bodyStyle:'margin: 0 0 0 10px; font-size: 12px;',style:'margin-left: 10px;',cls:'mktEmbedText',width:this.operatorPanelWidth,unstyled:true});items.push(this.operatorTextPanel);this.secondInputPanel=this.getInputPanel({value:this.value2,emptyText:''});this.secondInputPanel.on('blur',this.saveChanges.createDelegate(this));items.push(this.secondInputPanel);this.deleteButton=new Ext.Element(Ext.DomHelper.createDom({tag:'a',href:'#',style:'padding-left: 8px;',width:16,children:[{tag:'img',cls:'mkiDeleteSmall',style:'margin-top: 3px; width: 16px; height: 16px;',src:Ext.BLANK_IMAGE_URL}]}));this.deleteButton.on('click',this.removeGroup.createDelegate(this));this.deleteButtonPanel=new Ext.Panel({width:25,cls:'mktEmbedButton',contentEl:this.deleteButton,unstyled:true});items.push(this.deleteButtonPanel);this.addGroupButton=new Ext.Button({iconCls:'mkiAdd2',text:'Add Group',handler:this.addGroup.createDelegate(this)});this.addButtonPanel=new Ext.Panel({width:85,cls:'mktEmbedButton',style:'margin-left: 10px; margin-top: -1px;',unstyled:true,items:[this.addGroupButton]});items.push(this.addButtonPanel);this.items=items;Mkt.apps.dataMgr.IntegerGroupItem.superclass.initComponent.call(this);},addGroup:function(){this.addGroupCallback({tempGroupId:Ext.id()},true);},addGroupCallback:Ext.emptyFn,getSecondInputValue:function(){return this.secondInputPanel.getValue();},removeGroup:function(e,html){this.removeGroupCallback(this);e.stopEvent();},removeGroupCallback:Ext.emptyFn,saveChanges:function(){this.saveChangesCallback(this);},saveChangesCallback:Ext.emptyFn,getInputPanel:function(config){return new Ext.form.TextField(Ext.apply({vtype:'mkt_float',hideLabel:true,style:'float: left'},config));}});Mkt.apps.dataMgr.DatetimeDataMgr=Ext.extend(Mkt.apps.dataMgr.IntegerDataMgr,{initComponent:function(){Mkt.apps.dataMgr.DatetimeDataMgr.superclass.initComponent.call(this);},getGroupPanel:function(){return new Mkt.apps.dataMgr.DatetimeGroupPanel(this.initialConfig);}});Mkt.apps.dataMgr.DatetimeGroupPanel=Ext.extend(Mkt.apps.dataMgr.IntegerGroupPanel,{initComponent:function(){Mkt.apps.dataMgr.DatetimeGroupPanel.superclass.initComponent.call(this);},getGroup:function(config){var value1,value2,operator1,operator2,valueId,groupName,groupId;if(config){if(config.values&&config.values.length>0){if(config.values[0].value2){var split=config.values[0].value2.split(" ");if(split){value2=split[0];}};value1=config.values[0].value1;operator1=config.values[0].operator1;operator2=config.values[0].operator2;valueId=config.values[0].valueId;groupId=config.id;}
groupName=config.name;}
return new Mkt.apps.dataMgr.DatetimeGroupItem({groupName:groupName,groupId:groupId,tempGroupId:config.tempGroupId,valueId:valueId,value1:value1,operator1:operator1,value2:value2,operator2:operator2,addGroupCallback:this.addGroup.createDelegate(this),removeGroupCallback:this.removeGroup.createDelegate(this),operatorText:this.getOperatorText(this.group.length),saveChangesCallback:this.saveChanges.createDelegate(this)});},getOperatorText:function(index){var prevValue2;if(this.group&&this.group[index-1]){prevValue2=this.group[index-1].secondInputPanel.getValue();if(prevValue2){prevValue2=prevValue2.format(Mkt.util.Format.longDateShortMonthFormat);}}
if(index<1){return'On or before';}
else{return'After '+prevValue2+' to ';}},getDisplayDate:function(dateString){return Mkt.util.Common.getNextDay(Mkt.apps.dataMgr.DatetimeGroupPanel.prototype.extractDate(dateString),Mkt.util.Format.longDateShortMonthFormat,0);},getIntegerValue:function(val){return new Date(this.extractDate(val)).getTime();},extractDate:function(val){if(val){var split=val.split(" ");if(split){val=split[0];if(Ext.isIE){val=val.replace('-','/');}}}
return val;}});Mkt.apps.dataMgr.DatetimeGroupItem=Ext.extend(Mkt.apps.dataMgr.IntegerGroupItem,{operatorPanelWidth:137,initComponent:function(){Mkt.apps.dataMgr.DatetimeGroupItem.superclass.initComponent.call(this);},getSecondInputValue:function(){var value=this.secondInputPanel.getValue();if(value){return value.format("Y-m-d H:i:s");}},getInputPanel:function(config){var dateField=new Ext.form.DateField(Ext.apply({vtype:'mkt_date',width:200,hideLabel:true},config));dateField.on('afterrender',function(){if(this.wrap){this.wrap.applyStyles({'float':'left'});}});return dateField;}});
/* ========== ../mkt-ext-2.0/menus/DataMgrMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.dataMgr');Mkt.menus.dataMgr.Toolbar=function(){function toolbarRequestHandler(attr,ret){var getterFunc=attr.subType;if(!getterFunc){getterFunc=attr.type;}
if(isFunction(Mkt.menus.dataMgr.Toolbar['get'+MktUtil.camelCase(getterFunc)])){ret.comp=Mkt.menus.dataMgr.Toolbar['get'+MktUtil.camelCase(getterFunc)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('DataMgr',toolbarRequestHandler);return{getDataMgr:function(attr){var items=[];items.push({text:'New',sticky:true,iconCls:'mkiData',xtype:'mkttbbutton',menu:MktLeadDbMenu.leadDbMenu()});items.push({text:'Delete Field Organizer',sticky:true,iconCls:'mkiDataTableDelete',handler:Mkt.apps.dataMgr.Common.deleteGroup.createDelegate(Mkt.apps.dataMgr.Common)});return items;}};}();Mkt.menus.dataMgr.menuItemPool={newDataMgr:{text:'New Field Organizer',itemId:'newDataMgr',iconCls:'mkiDataTableAdd',handler:function(el){var accessZoneId,parentId;var dataMgrForm=new Mkt.apps.dataMgr.DataMgrForm({parentId:parentId,accessZoneId:accessZoneId});dataMgrForm.show(el.getEl());}}};
/* ========== ../mkt-ext-2.0/apps/LocalAsset.js ============ */

Ext.ns('Mkt.apps','Mkt.apps.localasset');Mkt.apps.localasset.MenuActions={createLocalAssetEmail:function(parentCompId,parentFolderId,compName,element,accessZoneId){mktEmManager.driveCreateEmailModal(element,null,parentFolderId,accessZoneId,parentCompId);},createLocalAssetLandingPage:function(parentCompId,parentFolderId,compName,element,accessZoneId){mktLPLManager.driveCreatePageModal(element,null,null,parentFolderId,accessZoneId,parentCompId);},createLocalAssetForm:function(parentCompId,parentFolderId,compName,element,accessZoneId){mktLPFManager.driveCreateFormModal(element,null,null,parentFolderId,accessZoneId,parentCompId)},createLocalAssetList:function(parentCompId,parentFolderId,compName,element,accessZoneId){MktLeadDb.ldbDriveCreateListModal(element,parentFolderId,null,null,accessZoneId,parentCompId);},createLocalAssetSmartList:function(parentCompId,parentFolderId,compName,element,accessZoneId){MktAppJS.ldbDriveCreateSmartListModal(element,parentFolderId,undefined,undefined,undefined,accessZoneId,parentCompId);},createLocalTestGroup:function(parentCompId,parentFolderId,compName,element,accessZoneId){mktLPLManager.driveCreateTestModal(element,parentFolderId,accessZoneId,parentCompId);}};Mkt.apps.localasset.Constants={LOCAL_ASSET_MANAGER:'maLocalAssetManager',TAB_NAME:'maLocalAssets',COMP_TYPE_SMART_CAMPAIGN:'Smart Campaign',COMP_TYPE_SMART_LIST:'Smart List',COMP_TYPE_STATIC_LIST:'List',COMP_TYPE_TEST_GROUP:'Landing Page Test Group',COMP_TYPE_FLOW:'Flow',COMP_TYPE_LANDING_PAGE:'Landing Page',COMP_TYPE_EMAIL:'Email',COMP_TYPE_FORM:'Landing Page Form',COMP_TYPE_ID_SMART_CAMPAIGN:2,SUFFIX_SMARTLIST:'SL',SUFFIX_FLOW:'FW'};Mkt.apps.localasset.Constants.LOCAL_ASSETS_COMP_TYPES=[Mkt.apps.localasset.Constants.COMP_TYPE_LANDING_PAGE,Mkt.apps.localasset.Constants.COMP_TYPE_EMAIL,Mkt.apps.localasset.Constants.COMP_TYPE_FORM,Mkt.apps.localasset.Constants.COMP_TYPE_TEST_GROUP,Mkt.apps.localasset.Constants.COMP_TYPE_SMART_LIST,Mkt.apps.localasset.Constants.COMP_TYPE_STATIC_LIST];Mkt.apps.localasset.Constants.CONFIG_SMARTLIST={iconCls:'mkiUsers3',leaf:true,compType:Mkt.apps.localasset.Constants.COMP_TYPE_SMART_LIST,folder:false,text:'Smart List Assets',expanded:true};Mkt.apps.localasset.Constants.CONFIG_FLOW={iconCls:'mkiCubes',leaf:true,compType:Mkt.apps.localasset.Constants.COMP_TYPE_FLOW,folder:false,text:'Flow Assets',expanded:true};Mkt.apps.localasset.TreeActions={replaceNodes:function(newNodeJsons,tree,config){var trimLength=0;if(config&&config.trimLength){trimLength=config.trimLength;}
var idSuffix='';if(config&&config.idSuffix){idSuffix=config.idSuffix;}
if(isUndefined(newNodeJsons)){return;}
if(newNodeJsons&&!isArray(newNodeJsons)&&!newNodeJsons.length){newNodeJsons=[newNodeJsons];}
var len=newNodeJsons.length;for(var i=0;i<len;i++){var idToFind=newNodeJsons[i].id+idSuffix;var node=tree.getNodeById(idToFind);if(isDefined(node)&&node){if(newNodeJsons[i].compType==Mkt.apps.localasset.Constants.COMP_TYPE_TEST_GROUP){newNodeJsons[i].canHaveChildren=false;newNodeJsons[i].leaf=true;delete newNodeJsons[i].children;}
var nodeJsonCopy=Ext.decode(Ext.encode(newNodeJsons[i]));var newNode=newNodeJsons[i].leaf?new MktTreeNode(nodeJsonCopy):new MktAsyncTreeNode(nodeJsonCopy);newNode.text=trimLength>0?Ext.util.Format.ellipsis(newNode.text,trimLength):newNode.text;newNode.id=idToFind;if(node.attributes.textIcon){newNode.attributes.textIcon=node.attributes.textIcon;newNode.text=node.attributes.textIcon+newNode.text;}
var prnNode=node.parentNode;prnNode.replaceChild(newNode,node);}}},removeNodes:function(nodeIds,tree,config){if(isUndefined(nodeIds)){return;}
var idSuffix='';if(config&&config.idSuffix){idSuffix=config.idSuffix;}
if(!isArray(nodeIds)&&(isString(nodeIds)||isNumber(nodeIds))){nodeIds=[nodeIds];}
var len=nodeIds.length;for(var i=0;i<len;i++){var idToFind=nodeIds[i]+idSuffix;var node=tree.getNodeById(idToFind);if(isDefined(node)){node.remove();}}},addNode:function(nodeConfig,tree,parentNode,config){var trimLength=0;if(config&&config.trimLength){trimLength=config.trimLength;}
if(parentNode){nodeConfig=Ext.applyIf(nodeConfig,{uiProvider:MktTreeNodeUI});var newNode=new Ext.tree.AsyncTreeNode(nodeConfig);newNode.text=trimLength>0?Ext.util.Format.ellipsis(newNode.text,trimLength):newNode.text;parentNode.appendChild(newNode);}},addNodes:function(nodeConfigs,tree,parentNode,config){if(isUndefined(nodeConfigs)||!isArray(nodeConfigs)||nodeConfigs.length<=0){return;}
var len=nodeConfigs.length;for(var i=0;i<len;i++){this.addNode(nodeConfigs[i],tree,parentNode,config);}}};Mkt.apps.localasset.LocalAssetPortletEmptyPicker={xtype:'panel',layout:'table',layoutConfig:{tableAttrs:{style:{height:'100%'}},columns:1},draggable:false,width:'98%',cls:'portletEmptyPicker',items:[{html:'&nbsp;'},{html:'<div class="pickerButton"><img src="/images/icons64/campaign_add.png"></img></div><div class="pickerText">New Smart Campaign</div>',listeners:{render:function(picker){picker.getEl().on('click',picker.createNewCampaign,picker);}},createNewCampaign:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;Mkt.apps.marketingEvent.Actions.createSubCampaign(compId,compName,0,this.getEl());}},{html:'&nbsp;'}],listeners:{resize:function(panel){var newsize=panel.ownerCt.getSize();newsize.height-=10;newsize.width-=20;panel.setSize(newsize);}}};Mkt.apps.localasset.LocalAssetPortal=Ext.extend(Ext.ux.ListPortal,{scrollThresh:100,layoutConfig:{defaultMargins:'5 0 20 10',align:'stretch'},initComponent:function(){var newListeners={drop:this.updatePortletOrder.createDelegate(this)};Ext.apply(newListeners,this.listeners);this.listeners=newListeners;Mkt.apps.localasset.LocalAssetPortal.superclass.initComponent.call(this);},getExistingPortlets:function(){var existingPortlets=[];var allItems=this.items||[];for(var i=0;i<allItems.length;i++){var existingItem=allItems.get(i);if(existingItem.xtype.indexOf('portlet_')==0){existingPortlets.push(existingItem);}}
return existingPortlets;},updatePortletProgress:function(inProgress){var existingCampaigns=this.getExistingPortlets();for(var i=0;i<existingCampaigns.length;i++){var existingCampaign=existingCampaigns[i];if(existingCampaign){existingCampaign.setProgress(inProgress);}}},updatePortal:function(portalMetadata,forceRebuild){var newCampaigns=portalMetadata.smartCampaigns||[];var existingCampaigns=this.getExistingPortlets();var needsRebuild=newCampaigns.length!=existingCampaigns.length||newCampaigns.length==0;if(!needsRebuild){for(var i=0;i<newCampaigns.length;i++){var newCampaign=newCampaigns[i];var existingCampaign=this.get('sc_portlet_'+newCampaign.compId);if(!existingCampaign){needsRebuild=true;break;}}}
if(forceRebuild||needsRebuild){this.removeAll(true);var portletOrdering=[];for(var i=0;i<newCampaigns.length;i++){var newCampaign=newCampaigns[i];this.add({xtype:'portlet_smartcampaign',autoScroll:true,collapsible:false,smartCampaignMetaData:newCampaign});portletOrdering.push(newCampaign.compTypeId+":"+newCampaign.compId);}
this.portletOrdering=portletOrdering;if(newCampaigns.length==0){this.add(Mkt.apps.localasset.LocalAssetPortletEmptyPicker);}
if(this.rendered){this.doLayout();}}
else{for(var i=0;i<newCampaigns.length;i++){var newCampaign=newCampaigns[i];var existingCampaign=this.get('sc_portlet_'+newCampaign.compId);if(existingCampaign){var smartcampaignData={};smartcampaignData[existingCampaign.dataRoot]=[newCampaign];existingCampaign.updatePortlet(smartcampaignData);}}}},updatePortletOrder:function(e){var newPortletOrder=[];for(var i=0;i<this.items.length;i++){var itemInfo=this.items.get(i).smartCampaignMetaData;newPortletOrder.push(itemInfo.compTypeId+":"+itemInfo.compId);}
var params={compId:this.programId,portletOrdering:Ext.encode(newPortletOrder)};MktSession.ajaxRequest('marketingEvent/orderLocalAssetPortlets',{serializeParms:params,localAssetManager:this,portletOrdering:newPortletOrder,onMySuccess:this.updatePortletOrderSuccess});},updatePortletOrderSuccess:function(jsonObject,ajaxOpts){var localAssetManager=ajaxOpts['localAssetManager']
localAssetManager.portletOrdering=ajaxOpts['portletOrdering'];},containsPortletItem:function(itemsToCheck){var existingCampaigns=this.getExistingPortlets();for(var i=0;i<existingCampaigns.length;i++){var existingCampaign=existingCampaigns[i];var dataRecord=existingCampaign.dataStore.getAt(0);var compareValue=dataRecord.get('compType')+":"+dataRecord.get('compId');if(itemsToCheck.indexOf(compareValue)>=0){return true;}}
return false;},replaceNodes:function(nodeJsons){var existingCampaigns=this.getExistingPortlets();for(var i=0;i<existingCampaigns.length;i++){var existingCampaign=existingCampaigns[i];existingCampaign.replaceNodes(nodeJsons);}},removeNodes:function(nodeIds){var existingCampaigns=this.getExistingPortlets();for(var i=0;i<existingCampaigns.length;i++){var existingCampaign=existingCampaigns[i];existingCampaign.removeNodes(nodeIds);}},addPortlet:function(campaignMeta){var existingPortlets=this.getExistingPortlets();if(existingPortlets.length==0){var portalConfig={smartCampaigns:[campaignMeta]};this.updatePortal(portalConfig,true);}
else{this.add({xtype:'portlet_smartcampaign',autoScroll:true,collapsible:false,smartCampaignMetaData:campaignMeta});if(this.rendered){this.doLayout();}}}});Mkt.apps.localasset.LocalAssetListTree=Ext.extend(Ext.tree.TreePanel,{cls:'mktTree mktTreeBox',loadMask:true,maskDisabled:false,selModel:new MktExplorerSelectionModel(),rootVisible:false,loader:new MktTreeLoader({uiProvider:MktTreeNodeUI}),listeners:{contextmenu:function(node,e){if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.type){var nodeType=node.attributes.xtra.type;if(nodeType=='Landing'){MktDsMenu.showContextMenu(node,e);}
else if(nodeType=='MA'){MktMaMenu.showContextMenu(node,e);}
else if(nodeType=='LeadDb'){MktLeadDbMenu.showContextMenu(node,e);}}},click:function(node,e){if(node.attributes&&node.attributes.xtra&&node.attributes.xtra.type){var xtraAttr=node.attributes.xtra;MktDlManager.loadDl(xtraAttr);}}}});Mkt.apps.localasset.LocalAssetListEmptyPicker=Ext.extend(Ext.Panel,{layout:'table',layoutConfig:{tableAttrs:{style:{height:'100%'}},columns:6},hidden:true,defaults:{padding:"0 5px 0 5px",cellCls:'pickerButton',listeners:{render:function(field){field.getEl().on('click',field.createLocalAsset,field);Ext.QuickTips.register({target:field.body,text:field.qtipText});}}},cls:'localAssetListEmptyPicker',initComponent:function(){this.items=[{html:'&nbsp;',colspan:6,listeners:{},cellCls:''},{html:'<img style="cursor: pointer" src="/images/icons32/email_add.png"></img>',cellCls:'pickerButton',qtipText:'New Email',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalAssetEmail(compId,parentFolderId,compName,this.getEl());}},{html:'<img style="cursor: pointer" src="/images/icons32/landing_page_add.png"></img>',cellCls:'pickerButton',qtipText:'New Landing Page',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalAssetLandingPage(compId,parentFolderId,compName,this.getEl());}},{html:'<img style="cursor: pointer" src="/images/icons32/form_add.png"></img>',qtipText:'New Form',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalAssetForm(compId,parentFolderId,compName,this.getEl());}},{html:'<img style="cursor: pointer" src="/images/icons32/list_add.png"></img>',cellCls:'pickerButton',qtipText:'New Static List',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalAssetList(compId,parentFolderId,compName,this.getEl());}},{html:'<img style="cursor: pointer" src="/images/icons32/smartlist_add.png"></img>',qtipText:'New Smart List',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalAssetSmartList(compId,parentFolderId,compName,this.getEl());}},{html:'<img style="cursor: pointer" src="/images/icons32/cust_abtest_add.png"></img>',qtipText:'New Test Group',createLocalAsset:function(){var config=MktCanvas.getActiveTab().config;var compId=config.compId;var compName=config.compName;var parentFolderId=parseInt(config.expNodeId);Mkt.apps.localasset.MenuActions.createLocalTestGroup(compId,parentFolderId,compName,this.getEl());}},{html:'New Local Assets',colspan:6,listeners:{},cellCls:'pickerText'}]
Mkt.apps.localasset.LocalAssetListEmptyPicker.superclass.initComponent.call(this);}});Mkt.apps.localasset.LocalAssetListPanel=Ext.extend(Ext.Panel,{iconCls:'mkiObjects',title:'Unused Local Assets',tools:[{id:'refreshProgress'}],updating:false,dataRoot:'assetList',dataId:null,dataUrl:null,dataFields:['tree'],initComponent:function(){this.cls=(this.cls||'')+' localAssetList';this.treePanel=new Mkt.apps.localasset.LocalAssetListTree();this.treePanel.setRootNode(new Ext.tree.TreeNode({hidden:true}));this.emptyPicker=new Mkt.apps.localasset.LocalAssetListEmptyPicker();this.items=[this.treePanel,this.emptyPicker];this.dataStore=this.createDataStore();Mkt.widgets.portal.SmartCampaignPortlet.superclass.initComponent.call(this);},createDataStore:function(){var listPanel=this;var loadHandler=function(store,records){listPanel.refreshListPanel();};var dataStore=new Ext.data.JsonStore({autoLoad:false,autoSave:false,fields:this.dataFields,idProperty:this.dataId,root:this.dataRoot,url:this.dataUrl});dataStore.addListener('load',loadHandler);return dataStore;},listeners:{afterlayout:function(panel){panel.setProgress(panel.updating);if(!panel.watermark){panel.watermark=panel.bwrap.createChild({cls:'mktWatermark '});}}},setProgress:function(inProgress){this.updating=inProgress;var refreshButton=this.getTool('refreshProgress');if(refreshButton){if(inProgress){refreshButton.addClass('inProgress');}
else{refreshButton.removeClass('inProgress');}}},updateListPanel:function(newMetaData){if(newMetaData){this.dataStore.loadData(newMetaData,false);}
else{this.dataStore.reload();}},refreshListPanel:function(){var dataRecord=this.dataStore.getAt(0);var treeData=dataRecord.get('tree');if(treeData&&this.treePanel){var root=new Ext.tree.AsyncTreeNode({text:'root',id:'root',cls:'folder',leaf:false,expanded:true,expandable:false,children:treeData,marketingProgramId:this.programId});this.treePanel.setRootNode(root);var treeEmpty=!this.treePanel.root.hasChildNodes();this.emptyPicker.setVisible(treeEmpty);}},replaceNodes:function(nodeJsons){if(this.treePanel){Mkt.apps.localasset.TreeActions.replaceNodes(nodeJsons,this.treePanel,{trimLength:36});}},addNodes:function(nodeJsons){if(this.treePanel){var rootNode=this.treePanel.getRootNode();Mkt.apps.localasset.TreeActions.addNodes(nodeJsons,this.treePanel,rootNode,{trimLength:36});var treeEmpty=!this.treePanel.root.hasChildNodes();this.emptyPicker.setVisible(treeEmpty);}},removeNodes:function(nodeIds){if(this.treePanel){Mkt.apps.localasset.TreeActions.removeNodes(nodeIds,this.treePanel);var treeEmpty=!this.treePanel.root.hasChildNodes();this.emptyPicker.setVisible(treeEmpty);}}});Mkt.apps.localasset.LocalAssetManager=Ext.extend(Ext.Panel,{layout:'border',border:false,initialData:{},dataUrl:'marketingEvent/getLocalAssetDetails',localAssetListDefaults:{},portalDefaults:{portletWidth:250,portletTitleLength:30},listeners:{destroy:function(){MktPage.eventMgr.removeListener('panelactivate',this.panelActivated,this);}},initComponent:function(){this.items=this.items||[];var portalConfig={region:'center',programId:this.programId};Ext.applyIf(portalConfig,this.portalDefaults);this.localAssetPortal=new Mkt.apps.localasset.LocalAssetPortal(portalConfig);this.items.push(this.localAssetPortal);this.localAssetPortal.updatePortal(this.initialData);var localAssetListConfig={region:'south',split:true,height:150,autoScroll:true,programId:this.programId};Ext.applyIf(localAssetListConfig,this.localAssetListDefaults);this.localAssetList=new Mkt.apps.localasset.LocalAssetListPanel(localAssetListConfig);this.items.push(this.localAssetList);MktPage.eventMgr.addListener('panelactivate',this.panelActivated,this);Mkt.apps.localasset.LocalAssetManager.superclass.initComponent.call(this);},panelActivated:function(){if(this.localAssetPortal.rendered){this.localAssetPortal.doLayout();}
if(this.localAssetList.rendered){this.localAssetList.doLayout();}},replaceNodes:function(nodeJsons){this.localAssetPortal.replaceNodes(nodeJsons);this.localAssetList.replaceNodes(nodeJsons);},addNodes:function(nodeJsons){var constants=Mkt.apps.localasset.Constants;if(nodeJsons.length>0){var nodeJson=Ext.decode(Ext.encode(nodeJsons[0]));if(nodeJson.compType==constants.COMP_TYPE_SMART_CAMPAIGN){var smartlistJson=Ext.decode(Ext.encode(constants.CONFIG_SMARTLIST));var flowJson=Ext.decode(Ext.encode(constants.CONFIG_FLOW));var portletConfig={name:nodeJson.text,description:'',compId:nodeJson.compId,compType:nodeJson.compType,compTypeId:constants.COMP_TYPE_ID_SMART_CAMPAIGN,status:nodeJson.status,tree:[nodeJson,smartlistJson,flowJson]};portletConfig.tree[0].hidden=true;this.localAssetPortal.addPortlet(portletConfig);}
else if(constants.LOCAL_ASSETS_COMP_TYPES.indexOf(nodeJson.compType)!=-1&&nodeJson.subType!='testpage'){this.localAssetList.addNodes(nodeJsons);}}},removeNodes:function(nodeIds){var itemsToCheck=[];for(var i=0;i<nodeIds.length;i++){if(nodeIds[i].indexOf('SC'==0)){itemsToCheck.push('Smart Campaign:'+nodeIds[i].substr(2));}}
if(this.localAssetPortal.containsPortletItem(itemsToCheck)){this.refreshLocalAssets();}
else{this.localAssetPortal.removeNodes(nodeIds);this.localAssetList.removeNodes(nodeIds);}},getNodeById:function(nodeId){var constants=Mkt.apps.localasset.Constants;var matchingNodes=[];if(this.localAssetList.treePanel){var treePanel=this.localAssetList.treePanel;var node=treePanel.getNodeById(nodeId);if(node){matchingNodes.push(node);}}
var portlets=this.localAssetPortal.getExistingPortlets();for(var i=0;i<portlets.length;i++){var portlet=portlets[i];if(portlet.treePanel){var treePanel=portlet.treePanel;var node=treePanel.getNodeById(nodeId+constants.SUFFIX_SMARTLIST);if(node){matchingNodes.push(node);}
var node=treePanel.getNodeById(nodeId+constants.SUFFIX_FLOW);if(node){matchingNodes.push(node);}}}
return matchingNodes;},refreshLocalAssets:function(){this.updateViewProgress(true);var params={compId:this.programId};MktSession.ajaxRequest(this.dataUrl,{serializeParms:params,localAssetManager:this,onMySuccess:this.refreshLocalAssetsSuccess});},refreshLocalAssetsSuccess:function(jsonObject,ajaxOpts){var startTime=(new Date()).getTime();if(isDefined(jsonObject.JSONResults.localAssetInfo)){var localAssetManager=ajaxOpts.localAssetManager;var localAssetInfo=jsonObject.JSONResults.localAssetInfo;localAssetManager.localAssetPortal.updatePortal(localAssetInfo);localAssetManager.localAssetList.updateListPanel(localAssetInfo);console.debug("SmartCampaign reference time: "+localAssetInfo.scReferenceTime+" sec");console.debug("SmartCampaign tree node time: "+localAssetInfo.treeNodeTime+" sec");console.debug('Finding referenced local assets: '+localAssetInfo.findAssetRefs+" sec");console.debug("Local assets generation + node time: "+localAssetInfo.localAssetTime+" sec");console.debug("UI render time: "+((new Date()).getTime()-startTime)/1000+" sec");}
localAssetManager.updateViewProgress(false);},updateViewProgress:function(inProgress){if(this.refreshButton){this.refreshButton.setProgressStatus(inProgress);}
this.localAssetPortal.updatePortletProgress(inProgress);this.localAssetList.setProgress(inProgress);}});Mkt.apps.localasset.moveForm=Ext.extend(Mkt.widgets.ModalForm,{title:'',minWidth:350,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3',layout:'form',plain:true,iconCls:'mkiObjects',modal:true,bodyStyle:'padding-top: 25px;padding-left: 20px;',buttonAlign:'right',useStandardButtons:true,labelWidth:130,closable:true,okText:'Move',height:210,width:450,compName:'',type:'',compId:'',pickerBox:null,applicationPicker:null,nameField:null,closeAction:'close',initComponent:function(){this.items=[];this.items=this.getFields();this.applicationPicker.on('select',this.updatePicker,this);Mkt.apps.localasset.moveForm.superclass.initComponent.call(this);},updatePicker:function(combo,object,index){if(this.pickerBox){this.remove(this.pickerBox);}
if(index==0){this.pickerBox=Mkt.apps.localasset.ComboManager.moveFolderPicker({compType:this.type,fieldLabel:'Folder'});}
else if(index==1){this.pickerBox=Mkt.apps.localasset.ComboManager.moveProgramPicker({fieldLabel:'Program'});}
this.add(this.pickerBox);this.doLayout();},beforeSubmitCallback:function(){var valid=true;var validateFormData=function(item){if(item.items){item.items.each(validateFormData);}
else if(Ext.isFunction(item.validate)){valid=valid&&item.validate();}};this.items.each(validateFormData);return valid;},okCallback:function(){this.serializeParms={};var formData=[];var getFormData=function(item){if(Ext.isFunction(item.getValue)){var value=item.getValue();if(Ext.isDate(value)){value=value.dateFormat('Y-m');}
if(item.itemId){formData[item.itemId]=value;}}
else if(item.items){item.items.each(getFormData,this);}};this.items.each(getFormData,this);this.serializeParms=formData;},getFields:function(){var dataStore=["Design Studio...","A Program..."];this.applicationPicker=Mkt.apps.localasset.ComboManager.applicationPicker({dataStore:dataStore,fieldLabel:'Move To'});var nameField=new Ext.form.DisplayField({fieldLabel:Mkt.util.Format.camelCase(this.type),itemId:this.type,value:Mkt.util.Format.camelCase(this.compName)});this.nameField=nameField;var items=[nameField,this.applicationPicker];return items;},setSubmitButtonText:function(text){this.submitButton.setText(text);},setSubmitButtonIconCls:function(iconCls){this.submitButton.setIconClass(iconCls);},setSubmitButtonVisible:function(visible){this.submitButton.setVisible(visible);},setSubmitButtonDisabled:function(disable){this.submitButton.setDisabled(disable);}});Mkt.apps.localasset.ComboManager={comboDefaults:{value:'',fieldLabel:'',width:280,resizable:true,forceSelection:true,loadingText:'Searching...',itemCls:'mktRequired',typeAhead:true,allowBlank:true,emptyText:'',triggerAction:'all',minChars:0,editable:false},programPickerTemplate:function(params){var tpl=new Ext.Template('<tr id="programRow" class="mktRequired">'+'<td class="mktForm2Label" id="programLabel">Program: </td>'+'<td class="mktForm2Field" id="'+params.id+'"></td>'+'</tr>');var applicationRow=Ext.get('applicationRow');tpl.insertAfter(applicationRow,1);},folderPickerTemplate:function(params){var tpl=new Ext.Template('<tr id="folderRow" class="mktRequired">'+'<td class="mktForm2Label" id="folderLabel">Folder: </td>'+'<td class="mktForm2Field" id="'+params.id+'"></td>'+'</tr>');var applicationRow=Ext.get('applicationRow');tpl.insertAfter(applicationRow,1);},cloneProgramPicker:function(params){if(!params){params={};}
params.id=params.name='cloneToProgramPicker';params.renderTo='cloneToPicker';this.programPickerTemplate({'id':params.renderTo});Ext.get('programLabel').show();return this.programPicker(params);},moveProgramPicker:function(params){params.id=params.name='moveToProgramPicker';params.itemId='moveToMarketingProgramId';return this.programPicker(params);},programPicker:function(params){var id=params.id;var name=params.name;var parms={};Ext.apply(parms,{id:id,itemId:params.itemId?params.itemId:'',name:name,tabIndex:2,renderTo:params.renderTo?params.renderTo:'',fieldLabel:params.fieldLabel?params.fieldLabel:'',anchor:'90%',store:new Ext.data.JsonStore({url:MktSession.getUrlPrefix()+'/landingPage/getPrograms',fields:['programId','val']}),hidden:params.hidden?params.hidden:false,valueField:'programId',displayField:'val',mode:'remote',editable:true,selectOnFocus:true,listeners:{blur:function(combo){var record=this.findRecord(combo.valueField,combo.value);var index=this.store.indexOf(record);if(record&&index){this.onSelect(record,index);}}}},this.comboDefaults);return new Ext.form.ImprovedComboBox(parms);},applicationPicker:function(params){var parms={};Ext.apply(parms,{id:'applicationList',name:'applicationList',renderTo:params.renderTo?params.renderTo:'',fieldLabel:params.fieldLabel?params.fieldLabel:'',store:params.dataStore,anchor:'90%',value:undefined,allowBlank:false},this.comboDefaults);return new Ext.form.ImprovedComboBox(parms);},cloneFolderPicker:function(params){if(!params){params={};}
params.id=params.name='cloneToFolderPicker';params.renderTo='cloneToPicker';this.folderPickerTemplate({id:params.renderTo});return this.folderPicker(params);},moveFolderPicker:function(params){params.id=params.name='moveToFolderPicker';params.itemId='parentFolderId';return this.folderPicker(params);},folderPicker:function(params){var compType=params.compType;var id=params.id;var name=params.name;var root='';var url=MktSession.getUrlPrefix();if(compType=='form'||compType=='page'){url+='/landingPage/getChildFolders';}
else if(compType=='email'){url+='/email/getChildFolders';}
else if(compType=='list'||compType=='smartlist'){url+='/leadDatabase/getChildFolders';}
else if(compType=='campaign'){url+='/smartcampaigns/getMarketingProgramFolders';}
var store=new Ext.data.JsonStore({baseParams:{type:compType},url:url,fields:['id','name'],root:root});var parms={};Ext.apply(parms,{id:id,itemId:params.itemId?params.itemId:'',name:name,width:280,anchor:'90%',tabIndex:2,resizable:true,fieldLabel:params.fieldLabel?params.fieldLabel:'',renderTo:params.renderTo?params.renderTo:'',store:store,valueField:'id',displayField:'name',hidden:params.hidden?params.hidden:false,mode:'remote',editable:true,selectOnFocus:true,listeners:{blur:function(combo){var record=this.findRecord(combo.valueField,combo.value);var index=this.store.indexOf(record);if(record&&index){this.onSelect(record,index);}}}},this.comboDefaults);return new Ext.form.ImprovedComboBox(parms);},clearForm:function(type){if('program'==type||'all'==type){if(Ext.getCmp('cloneToProgramPicker')){Ext.getCmp('cloneToProgramPicker').destroy();}
if(Ext.get('programLabel')){Ext.get('programLabel').hide();}
if(Ext.get('programRow')){Ext.get('programRow').remove();}}
if('folder'==type||'all'==type){if(Ext.getCmp('cloneToFolderPicker')){Ext.getCmp('cloneToFolderPicker').destroy();}
if(Ext.get('folderLabel')){Ext.get('folderLabel').hide();}
if(Ext.get('folderRow')){Ext.get('folderRow').remove();}}}};
/* ========== ../mkt-ext-2.0/apps/WebinarAdmin.js ============ */

Ext.ns('Mkt.apps','Mkt.apps.webinarAdmin','Mkt.apps.calendarAdmin');Mkt.apps.webinarAdmin.Action={newWebinarLoginForm:function(animEl){var webinarLogin=new Mkt.apps.webinarAdmin.WebinarForm({title:'New Event Partner'});webinarLogin.show(animEl);},newCalendarLoginForm:function(animEl){var calendarLogin=new Mkt.apps.calendarAdmin.CalendarForm({title:'New Calendar Partner'});calendarLogin.show(animEl);},editWebinarLogin:function(animEl){var sel=this.getSelected();if(sel){var config={title:'Edit Event Partner',siteName:sel.get('siteName'),hostName:sel.get('hostName'),meetingFolderId:sel.get('meetingFolderId'),participantPassword:sel.get('participantPassword'),partnerEventFolderUrl:sel.get('partnerEventFolderUrl'),webinarPartner:sel.get('webinarPartner'),username:sel.get('webinarLogin'),password:sel.get('password'),name:sel.get('name'),clientKey:sel.get('clientKey'),clientId:sel.get('clientId'),lastLoginStatus:sel.get('lastLoginStatus'),progressMsg:'Saving event partner...',editMode:true,webinarLoginId:sel.get('id')};if(sel.get('integrationType')=='Calendar'){config.title='Edit Calendar Partner';config.progressMsg='Saving calendar partner...';var webinarLogin=new Mkt.apps.calendarAdmin.CalendarForm(config);}
else{var webinarLogin=new Mkt.apps.webinarAdmin.WebinarForm(config);}
webinarLogin.show(animEl);}},deleteWebinarLogin:function(animEl){var sels=this.getSelections();if(sels){var msg;var ids=[];if(sels.length>1){msg="Are you sure you want to delete multiple logins?";for(var i=0;i<sels.length;i++){ids.push(sels[i].get('id'));}}
else{msg="Are you sure you want to delete <b>"+sels[0].get('name')+"</b>?";ids.push(sels[0].get('id'));}
MktMessage.confirmDelete('Delete Login?',msg,function(){MktSession.ajaxRequest('marketingEvent/deleteWebinarLogin',{serializeParms:{integrationPartnerIds:Ext.encode(ids)},onMySuccess:this.deleteWebinarLoginDone.createDelegate(this)});}.createDelegate(this),animEl,'Delete');}},deleteWebinarLoginDone:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var tab=MktCanvas.getTab('meaWebinars');if(tab){var grid=tab.getGridPanel();if(grid){grid.getStore().reload();}}}},showUsedByEvents:function(login,webinarPartner,webinarLoginId,animEl)
{var config={title:'Used by Events',usedPropertyLabel:'Partner Name',usedPropertyText:Mkt.util.Format.camelCase(webinarPartner),usedByRequestUrl:'marketingEvent/getUsedByEvent',usedByRequestConfig:{serializeParms:{webinarLoginId:webinarLoginId}}};var usedByModal=new Mkt.widgets.UsedByModal(config);usedByModal.show();},loginStatusRenderer:function(val,meta,record,rowIndex,colIndex,store){var iconCls='';var text='';var loginStatus=record.get('lastLoginStatus');switch(loginStatus){case'ok':iconCls='mkiKeyOk';text='';break;case'failed':iconCls='mkiKeyError';text='Failed: '+record.get('lastLoginErrorMsg');break;}
var tmpl='<div ext:qtip="{text}" style="height:16px;">'+'<div class="mki16-grid-cell {iconCls}" style="float:left;"></div>'+'<div style="padding-left:7px; padding-top:2px;" ext:qtip="{text}">&nbsp;&nbsp;{text}</div>'+'</div>';return new Ext.Template(tmpl).apply({iconCls:iconCls,text:text});},getSelections:function(){var tab=MktCanvas.getTab('meaWebinars');var sels;if(tab){var grid=tab.getGridPanel();if(grid){sels=grid.getSelectionModel().getSelections();}}
return sels;},getSelected:function(){var tab=MktCanvas.getTab('meaWebinars');var sel;if(tab){var grid=tab.getGridPanel();if(grid){sel=grid.getSelectionModel().getSelected();}}
return sel;}};Mkt.apps.webinarAdmin.WebinarGrid=Ext.extend(MktGrids.CanvasGridPanel,{enableSearchPaging:false,pageSize:50,beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading {0} event partners...',pagingEmptyMsg:'No event partners found',pagingDisplayMsg:'{0}-{1} of {2}',searchQtip:'Search for event partners',reloadAfterLayoutSave:false,enableTotal:true,totalDisplayMsg:'{0} items',showRefreshButton:true,enableDragDrop:false,initComponent:function(){Mkt.apps.webinarAdmin.WebinarGrid.superclass.initComponent.call(this);Ext.QuickTips.init();}});Mkt.apps.webinarAdmin.WebinarForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Webinar Login',minWidth:520,width:520,height:422,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktWebinarLogin',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',labelWidth:130,webinarPartner:'webex',fieldRequiredMsg:'This field is required',submitUrl:'marketingEvent/webinarLoginSubmit',showProgressModal:false,progressMsg:'Creating event partner...',initComponent:function(){this.items=this.items||[];this.items=this.items.concat(this.getFields());this.okText=this.editMode?"Save":"Create";this.iconCls=this.editMode?'mkiClientNetworkEdit':'mkiUserMonitorAdd';Mkt.apps.webinarAdmin.WebinarForm.superclass.initComponent.call(this);this.on('afterRender',function(form){form.setWebinarProviderFieldVisible(form.webinarPartner,true);}.createDelegate(this));},learnMoreClicked:function(e,html){var selectedWebinar=this.webinarProviderField.getValue();var url='';switch(selectedWebinar){case'webex':url="http://community.marketo.com/marketotutorial?articleName=WebEx-Integration-Overview&Id=kA250000000Kyt7&tutorialName=Manage_Your_WebEx_Event";break;case'adobe_connect':url="http://community.marketo.com/MarketoTutorial?Id=kA250000000Kyu0";break;case'on24':url="http://community.marketo.com/MarketoTutorial?Id=kA250000000Kytv";break;case'go_to_webinar':url="http://community.marketo.com/";break;}
if(url){window.open(encodeURI(url));}
e.stopEvent();},getFields:function(){var items=[];var fieldSetItems=[];var fieldSetButtons=[];var initialCls=' mktHidden';var initialAllowBlank=true;this.displayNameField=new Ext.form.TextField({itemCls:'mktRequired',value:this.name,anchor:"95%",allowBlankWhenVisible:false,allowBlank:false,fieldLabel:'Display Name'});items.push(this.displayNameField);var enableGoToWebinar=MktCanvas.getActiveTab().config.enableGoToWebinar;var providers=[['WebEx','webex'],['Adobe Connect','adobe_connect'],['ON24','on24']];if(enableGoToWebinar){providers.push(['GoToWebinar','go_to_webinar']);}
this.webinarProviderField=new Ext.form.ImprovedComboBox({forceSelection:true,fieldLabel:"Event Partner",value:this.webinarPartner,anchor:"95%",mode:'local',itemCls:'mktRequired',triggerAction:'all',editable:false,emptyText:'--choose--',store:new Ext.data.ArrayStore({fields:['displayText','valueField'],data:providers}),displayField:'displayText',valueField:'valueField'});this.webinarProviderField.on('select',function(comboBox,record,index){var newValue=record.get('valueField');var oldValue=this.webinarPartner;this.webinarPartner=newValue;this.setWebinarProviderFieldVisible(oldValue,false);this.setWebinarProviderFieldVisible(newValue,true);}.createDelegate(this));items.push(this.webinarProviderField);this.learnMoreLink=new Ext.Element(Ext.DomHelper.createDom({tag:'a',href:'#',html:'Learn More'}));this.learnMoreLink.on('click',this.learnMoreClicked,this);items.push({width:64,unstyled:true,plain:true,style:'margin-left: 399px;',contentEl:this.learnMoreLink});this.usernameField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,value:this.username,anchor:"95%",allowBlankWhenVisible:false,allowBlank:initialAllowBlank,fieldLabel:'Username'});fieldSetItems.push(this.usernameField);this.passwordField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,value:this.password,allowBlankWhenVisible:false,allowBlank:initialAllowBlank,anchor:"95%",labelWidth:125,fieldLabel:'Password',inputType:'password'});fieldSetItems.push(this.passwordField);this.siteNameField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:initialAllowBlank,value:this.siteName,anchor:"95%",fieldLabel:'Site Name',inputType:'text'});fieldSetItems.push(this.siteNameField);this.hostNameField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:initialAllowBlank,value:this.hostName,anchor:"95%",fieldLabel:'Host Name',inputType:'text'});fieldSetItems.push(this.hostNameField);this.meetingFolderIdField=new Ext.form.TextField({itemCls:initialCls,allowBlankWhenVisible:true,allowBlank:true,value:this.meetingFolderId,anchor:"95%",fieldLabel:'Meeting Folder Id',inputType:'text'});fieldSetItems.push(this.meetingFolderIdField);this.participantPasswordField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:true,value:this.participantPassword,anchor:"95%",fieldLabel:'Participant Password',inputType:'text'});fieldSetItems.push(this.participantPasswordField);this.partnerEventFolderUrlField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:true,value:this.partnerEventFolderUrl,anchor:"95%",fieldLabel:'Meeting Folder Url',inputType:'text'});fieldSetItems.push(this.partnerEventFolderUrlField);this.clientIdField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:true,value:this.clientId,anchor:"95%",fieldLabel:'Client Id',inputType:'text'});fieldSetItems.push(this.clientIdField);this.clientKeyField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,allowBlankWhenVisible:false,allowBlank:true,value:this.clientKey,anchor:"95%",fieldLabel:'Client Key',inputType:'text'});fieldSetItems.push(this.clientKeyField);var isStatusOk=(this.lastLoginStatus=='ok');this.messageBox=new Ext.Panel({itemCls:'mktOauthMessage',cls:'mktOauthMessage',unstyled:true,html:isStatusOk?'GoToWebinar account is set':"Please enter your credentials on GoToWebinar's site"});fieldSetItems.push(this.messageBox);this.oauthButton=new Ext.Button({iconCls:'mkiKeys',text:isStatusOk?'Change Credentials':'Login to GoToWebinar',handler:this.oauthHandler.createDelegate(this)});fieldSetButtons.push(this.oauthButton);window.oauthCallback=this.oauthCallback.createDelegate(this);items.push({xtype:'fieldset',title:'Settings',labelWidth:123,style:'padding-top: 11px; margin-top: 5px;',cls:'mktFieldset mktModalForm3',items:fieldSetItems,buttons:fieldSetButtons});return items;},setWebinarProviderFieldVisible:function(provider,visible){var fields=[];this.oauthButton.hide();this.messageBox.hide();switch(provider){case'webex':fields=this.getWebexFields();break;case'adobe_connect':fields=this.getAdobeConnectFields();break;case'on24':fields=this.getOn24Fields();break;case'go_to_webinar':fields=this.getGoToWebinarFields();break;default:console.log('Invalid provider');break;}
for(var i=0;i<fields.length;i++){var itemCt=fields[i].getItemCt();fields[i].initialConfig.allowBlank=true;if(visible){itemCt.removeClass('mktHidden');fields[i].allowBlank=fields[i].allowBlankWhenVisible;}
else{itemCt.addClass('mktHidden');fields[i].allowBlank=true;}}},getWebexFields:function(){var items=[];items.push(this.usernameField);items.push(this.passwordField);items.push(this.siteNameField);return items;},getAdobeConnectFields:function(){var items=[];items.push(this.usernameField);items.push(this.passwordField);items.push(this.partnerEventFolderUrlField);items.push(this.participantPasswordField);return items;},getOn24Fields:function(){var items=[];items.push(this.clientKeyField);items.push(this.clientIdField);return items;},getGoToWebinarFields:function(){var items=[];this.oauthButton.show();this.messageBox.show();return items;},beforeSubmitCallback:function(){if(!this.displayNameField.validate()){return false;}
if(!this.webinarProviderField.validate()){return false;}
if(!this.usernameField.validate()){return false;}
if(!this.passwordField.validate()){return false;}
if(!this.siteNameField.validate()){return false;}
if(!this.hostNameField.validate()){return false;}
if(!this.clientKeyField.validate()){return false;}
if(!this.clientIdField.validate()){return false;}
if(!this.participantPasswordField.validate()){return false;}
if(!this.partnerEventFolderUrlField.validate()){return false;}
if(this.webinarPartner=='go_to_webinar'){if(this.lastLoginStatus!='ok'){this.showMessageError('You must login to GoToWebinar');return false;}}},okCallback:function(){this.newWebinarLoginSubmit();},oauthCallback:function(token,organizerKey){this.oauthWindow.hide();this.oauthWindow.destroy();this.passwordField.setValue(token);this.usernameField.setValue(organizerKey);this.messageBox.update('GoToWebinar account is set');this.hideMessage();this.lastLoginStatus='ok';},oauthHandler:function(){var goToWebinarKey=MktCanvas.getActiveTab().config.goToWebinarKey;var url='https://api.citrixonline.com/oauth/authorize?client_id='+goToWebinarKey;var panelContent=new Ext.Panel({region:'center',margins:'0 0 0 0',autoScroll:true,html:'<iframe style="overflow:auto;width:100%;height:100%;" frameborder="0"  src="'+url+'"></iframe>'});this.oauthWindow=new Ext.Window({id:'Authenticate',title:'Authenticate with GoToWebinar',width:1040,height:740,padding:'0 0 0 0',layout:'fit',items:[panelContent]});this.oauthWindow.show();},newWebinarLoginSubmit:function(){var name=this.displayNameField.getValue();var provider=this.webinarProviderField.getValue();var username=this.usernameField.getValue();var password=this.passwordField.getValue();var siteName=this.siteNameField.getValue();var hostName=this.hostNameField.getValue();var meetingFolderId=this.meetingFolderIdField.getValue();var participantPassword=this.participantPasswordField.getValue();var partnerEventFolderUrl=this.partnerEventFolderUrlField.getValue();var clientKey=this.clientKeyField.getValue();var clientId=this.clientIdField.getValue();this.serializeParms={name:name,provider:provider,username:username,password:password,siteName:siteName,hostName:hostName,meetingFolderId:meetingFolderId,participantPassword:participantPassword,partnerEventFolderUrl:partnerEventFolderUrl,clientKey:clientKey,clientId:clientId,editMode:this.editMode};if(this.webinarLoginId){this.serializeParms.webinarLoginId=this.webinarLoginId;}},submitSuccessCallback:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var tab=MktCanvas.getTab('meaWebinars');if(tab){var grid=tab.getGridPanel();if(grid){grid.getStore().reload();}}
this.close();}}});Mkt.apps.calendarAdmin.CalendarForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Calendar Integration Login',minWidth:520,width:520,height:450,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktCalendarLogin',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 0 15px;',buttonAlign:'right',labelWidth:130,calendarPartner:'exact_target',fieldRequiredMsg:'This field is required',submitUrl:'marketingEvent/webinarLoginSubmit',showProgressModal:true,progressMsg:'Creating calendar partner...',initComponent:function(){this.items=this.items||[];this.items=this.items.concat(this.getFields());this.okText=this.editMode?"Save":"Create";this.iconCls=this.editMode?'mkiClientNetworkEdit':'mkiCalendar7Add';Mkt.apps.calendarAdmin.CalendarForm.superclass.initComponent.call(this);this.on('afterRender',function(form){form.setCalendarProviderFieldVisible(form.calendarPartner,true);}.createDelegate(this));},getFields:function(){var items=[];var fieldSetItems=[];var initialCls=' mktHidden';var initialAllowBlank=true;this.displayNameField=new Ext.form.TextField({itemCls:'mktRequired',value:this.name,anchor:"95%",allowBlankWhenVisible:false,allowBlank:false,fieldLabel:'Display Name'});items.push(this.displayNameField);this.calendarProviderField=new Ext.form.ImprovedComboBox({forceSelection:true,fieldLabel:"Event Partner",value:this.calendarPartner,anchor:"95%",mode:'local',itemCls:'mktRequired',triggerAction:'all',editable:false,emptyText:'--choose--',store:new Ext.data.ArrayStore({fields:['displayText','valueField'],data:[['ExactTarget','exact_target']]}),displayField:'displayText',valueField:'valueField'});this.calendarProviderField.on('select',function(comboBox,record,index){var newValue=record.get('valueField');var oldValue=this.calendarPartner;this.calendarPartner=newValue;this.setCalendarProviderFieldVisible(oldValue,false);this.setCalendarProviderFieldVisible(newValue,true);}.createDelegate(this));items.push(this.calendarProviderField);this.usernameField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,value:this.username,anchor:"95%",allowBlankWhenVisible:false,allowBlank:initialAllowBlank,fieldLabel:'Username'});fieldSetItems.push(this.usernameField);this.passwordField=new Ext.form.TextField({itemCls:'mktRequired'+initialCls,value:this.password,allowBlankWhenVisible:false,allowBlank:initialAllowBlank,anchor:"95%",labelWidth:125,fieldLabel:'Password',inputType:'password'});fieldSetItems.push(this.passwordField);items.push({xtype:'fieldset',title:'Settings',labelWidth:123,cls:'mktFieldset mktModalForm3',items:fieldSetItems});return items;},setCalendarProviderFieldVisible:function(provider,visible){var fields=[];switch(provider){case'exact_target':fields=this.getExactTargetFields();break;case'google_calendar':fields=this.getGoogleCalendarFields();break;default:console.log('Invalid provider');break;}
for(var i=0;i<fields.length;i++){var itemCt=fields[i].getItemCt();fields[i].initialConfig.allowBlank=true;if(visible){itemCt.removeClass('mktHidden');fields[i].allowBlank=fields[i].allowBlankWhenVisible;}
else{itemCt.addClass('mktHidden');fields[i].allowBlank=true;}}},getExactTargetFields:function(){var items=[];items.push(this.usernameField);items.push(this.passwordField);return items;},getGoogleCalendarFields:function(){var items=[];items.push(this.usernameField);items.push(this.passwordField);return items;},beforeSubmitCallback:function(){if(!this.displayNameField.validate()){return false;}
if(!this.calendarProviderField.validate()){return false;}
if(!this.usernameField.validate()){return false;}
if(!this.passwordField.validate()){return false;}},okCallback:function(){this.newCalendarLoginSubmit();},newCalendarLoginSubmit:function(){var name=this.displayNameField.getValue();var provider=this.calendarProviderField.getValue();var username=this.usernameField.getValue();var password=this.passwordField.getValue();this.serializeParms={name:name,provider:provider,username:username,password:password,editMode:this.editMode};if(this.webinarLoginId){this.serializeParms.webinarLoginId=this.webinarLoginId;}},submitSuccessCallback:function(){var result=MktPage.appVars.result;if(result==MktSession.resultSuccess){var tab=MktCanvas.getTab('meaWebinars');if(tab){var grid=tab.getGridPanel();if(grid){grid.getStore().reload();}}
this.close();}}});
/* ========== ../mkt-ext-2.0/menus/WebinarAdminMenu.js ============ */

Ext.ns('Mkt.menus','Mkt.menus.webinarAdmin');Mkt.menus.webinarAdmin.Toolbar=function(){function toolbarRequestHandler(attr,ret){var getterFunc=attr.subType;if(!getterFunc){getterFunc=attr.type;}
if(isFunction(Mkt.menus.webinarAdmin.Toolbar['get'+MktUtil.camelCase(getterFunc)])){ret.comp=Mkt.menus.webinarAdmin.Toolbar['get'+MktUtil.camelCase(getterFunc)](attr);}}
Mkt.menus.ToolbarMgr.registerComp('WebinarAdmin',toolbarRequestHandler);return{preShowWebinarAdminActions:function(menu,attr){var sels=Mkt.apps.webinarAdmin.Action.getSelections();var disableEdit=true;var disableClone=true;var disableDelete=true;if(sels){if(sels.length==1){disableClone=disableDelete=disableEdit=false;}
else if(sels.length>1){disableDelete=false;}}
var mItems=menu.items;mItems.get('editWebinarLogin').setDisabled(disableEdit);mItems.get('cloneWebinarLogin').setDisabled(disableClone);mItems.get('deleteWebinarLogin').setDisabled(disableDelete);},updateWebinarAdminToolbarState:function(){},getWebinarAdminActions:function(attr){var items=[];var mip=Mkt.menus.webinarAdmin.menuItemPool;items.push({text:'Event Partner Actions',xtype:'mkttbbutton',iconCls:'mkiClientNetwork',menuPreShowCb:this.preShowWebinarAdminActions,menu:new Ext.menu.Menu({minWidth:200,items:[mip.newWebinarLogin,attr.exactTargetEnabled?mip.newCalendarLogin:'','-',mip.editWebinarLogin,mip.cloneWebinarLogin,mip.deleteWebinarLogin]})});return new Ext.Toolbar({items:items});},getMarketingEventNew:function(){return Mkt.app.MarketingActivities.Toolbar.getNewMenuButton();},getMarketingEventActions:function(attr){var items=[];var mep=Mkt.menus.marketingEvent.menuItemPool;items.push(mep.deleteMarketingEvent);return{text:'Event Actions',xtype:'mkttbbutton',iconCls:'mkiCal',menuPreShowCb:this.preShowMarketingEventActions,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getMarketingEventSelectAll:function(attr){return{text:'Select All',iconCls:'mkiDocumentCheck',handler:function(button,e){MktCanvas.getActiveTab().getGridPanel().selectAll();}};},getMarketingEventChangeStatus:function(attr){var items=[];var statuss=attr.statuss;for(var i=0;i<statuss.length;i++){var aStatus=statuss[i];var statusItem={text:aStatus,itemId:aStatus+'StatusMarketingEvent',iconCls:'mkiCal',handler:function(el,a,b){el.parentMenu.hide(true);var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;var grid=tab.getGridPanel();Mkt.apps.marketingEvent.Actions.changeStatusInEvent(compId,this.text,grid);}};items.push(statusItem);}
return{text:'Change Status',xtype:'mkttbbutton',iconCls:'mkiCal',menuPreShowCb:this.preShowMarketingEventChangeStatus,menu:new Ext.menu.Menu({minWidth:200,items:items})};},getMarketingEventNewField:function(attr){return{text:'New Field',iconCls:'mkiBranchAdd',handler:function(button,e){var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;Mkt.apps.marketingEvent.Actions.createNewField(compId);}};},getMarketingEventUpdate:function(attr){return{text:'Update',iconCls:'ico-refresh',handler:function(button,e){var tab=MktCanvas.getActiveTab();var compId=tab.config.compId;Mkt.apps.marketingEvent.Actions.updatePartner(compId);}};}};}();Mkt.menus.webinarAdmin.menuItemPool={newWebinarLogin:{text:'New Event Partner',itemId:'newWebinarLogin',iconCls:'mkiUserMonitorAdd',handler:function(el){Mkt.apps.webinarAdmin.Action.newWebinarLoginForm(el.getEl());el.parentMenu.hide(true);}},newCalendarLogin:{text:'New Calendar Partner',itemId:'newCalendarLogin',iconCls:'mkiCalendar7Add',handler:function(el){Mkt.apps.webinarAdmin.Action.newCalendarLoginForm(el.getEl());el.parentMenu.hide(true);}},editWebinarLogin:{text:'Edit Partner',itemId:'editWebinarLogin',iconCls:'mkiClientNetworkEdit',handler:function(el){Mkt.apps.webinarAdmin.Action.editWebinarLogin(el.getEl());el.parentMenu.hide(true);}},cloneWebinarLogin:{text:'Clone Login',itemId:'cloneWebinarLogin',iconCls:'mkiUserMonitorAdd',hidden:true,handler:function(el){Mkt.apps.webinarAdmin.Action.cloneWebinarLogin(el.getEl());el.parentMenu.hide(true);}},deleteWebinarLogin:{text:'Delete Partner',itemId:'deleteWebinarLogin',iconCls:'mkiClientNetworkDelete',handler:function(el){var action=Mkt.apps.webinarAdmin.Action;action.deleteWebinarLogin(el.getEl());el.parentMenu.hide(true);}}};
/* ========== ../mkt-ext-2.0/apps/DescriptorAdmin.js ============ */

(function()
{Ext.ns('Mkt','Mkt.apps','Mkt.apps.descriptorAdmin');var TAB_ID='meaDescriptors',VTYPE_DESCRIPTOR_NAME='descriptorName',VTYPE_DESCRIPTOR_VALUE='descriptorValue',VTYPE_PROGRESSION_STEP_NAME='progressionStepName',VTYPE_PROGRESSION_STEP_ORDER='progressionStepOrder';var _app=Mkt.apps.descriptorAdmin,_menu=Mkt.menus.descriptorAdmin;_app.TYPE_CHANNEL='channel';_app.PROGRESSION_TYPE_PROGRAM='program';_app.PROGRESSION_TYPE_EVENT='event';_app.PROGRESSION_TYPE_WEBINAR='webinar';var _progressionTypes={};_progressionTypes[_app.PROGRESSION_TYPE_PROGRAM]='Program';_progressionTypes[_app.PROGRESSION_TYPE_EVENT]='Event';_progressionTypes[_app.PROGRESSION_TYPE_WEBINAR]='Event with Webinar';_app.PROGRESSION_STEP_TYPE_REGISTERED='registered';_app.PROGRESSION_STEP_TYPE_ATTENDED='attended';_app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND='attended_on_demand';_app.PROGRESSION_STEP_TYPE_NO_SHOW='no_show';var _progressionStepTypes={};_progressionStepTypes[_app.PROGRESSION_STEP_TYPE_REGISTERED]='Webinar: Registered';_progressionStepTypes[_app.PROGRESSION_STEP_TYPE_ATTENDED]='Webinar: Attended';_progressionStepTypes[_app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND]='Webinar: Attended On-demand';_progressionStepTypes[_app.PROGRESSION_STEP_TYPE_NO_SHOW]='Webinar: No Show';Ext.apply(Ext.form.VTypes,{descriptorName:function(v,field){return/^[-\w\s]+$/i.test(v);},descriptorNameText:'This field should only contain letters, numbers, or dash',descriptorNameMask:/[-\w\s]/i});Ext.apply(Ext.form.VTypes,{descriptorValue:function(v,field){return/^[-\w\s]+$/i.test(v);},descriptorValueText:'This field should only contain letters, numbers, or dash',descriptorValueMask:/[-\w\s]/i});Ext.apply(Ext.form.VTypes,{progressionStepName:function(v,field){return/^[-\w\s]+$/i.test(v);},progressionStepNameText:'This field should only contain letters, numbers, or dash',progressionStepNameMask:/[-\w\s]/i});Ext.apply(Ext.form.VTypes,{progressionStepOrder:function(v,field){return/^\d+$/i.test(v);},progressionStepOrderText:'This field should only contain numbers',progressionStepOrderMask:/\d/i});function getGrid()
{var grid=null;var tab=MktCanvas.getTab(TAB_ID);if(tab){grid=tab.getGridPanel();}
return grid;}
function getStore()
{var store=null;var grid=getGrid();if(grid){store=grid.getStore();}
return store;}
_app.Actions={newDescriptor:function(animEl)
{var form=new _app.DescriptorForm({editMode:false});form.show(animEl);},editDescriptor:function(animEl)
{var sel=this.getSelected();if(sel){var form=new _app.DescriptorForm({descriptorId:sel.id,name:sel.get('name'),required:sel.get('required'),editMode:true});form.show(animEl);}},deleteDescriptor:function(animEl)
{var sel=this.getSelected();if(sel){if(sel.get('usedByCount')>0){MktMessage.showNotAllowed('Tag type <b>'+sel.get('name')+'</b> is being used in programs and cannot be deleted');}
else{var msg="Are you sure you want to delete <b>"+sel.get('name')+"</b>?";MktMessage.confirmDelete('Delete tag?',msg,function()
{MktSession.ajaxRequest('marketingEvent/deleteDescriptors',{serializeJSON:{descriptorIds:[sel.id]},onMySuccess:function(){if(MktPage.appVars.result==MktSession.resultSuccess){this.reload();}}.createDelegate(this)});}.createDelegate(this),animEl,'Delete');}}},newChannelValue:function(animEl)
{var form=new _app.ChannelForm({editMode:false});form.show(animEl);},editChannelValue:function(animEl)
{var sel=this.getSelected();if(sel){var form=new _app.ChannelForm({descriptorValueId:sel.json.id,editMode:true});form.show(animEl);}},newDescriptorValue:function(animEl)
{var descriptor=null;var sel=this.getSelected();if(sel){if(sel.json.isValue){if(sel.treeData!=null&&sel.treeData.parent!=null){descriptor=sel.treeData.parent;}}
else{descriptor=sel;}}
var form=new _app.DescriptorValueForm({descriptorId:(descriptor!=null&&descriptor.json.type!=_app.TYPE_CHANNEL)?descriptor.id:null,editMode:false});form.show(animEl);},editDescriptorValue:function(animEl)
{var sel=this.getSelected();if(sel){if(sel.json.descriptorId===1){return this.editChannelValue(animEl);}
var form=new _app.DescriptorValueForm({descriptorId:sel.json.type!=_app.TYPE_CHANNEL?sel.json.descriptorId:null,descriptorName:getStore().getById(sel.json.descriptorId).get('name'),descriptorValueId:sel.json.id,value:sel.json.value,editMode:true});form.show(animEl);}},hideDescriptorValue:function(ids)
{ids=ids||[];if(ids.length==0){var sels=this.getSelections();if(sels){for(var i=0,l=sels.length;i<l;i++){if(sels[i].json.isValue){ids.push(sels[i].json.id);}}}}
if(ids.length>0){MktSession.ajaxRequest('marketingEvent/hideDescriptorValues',{serializeJSON:{descriptorValueIds:ids},onMySuccess:function(){if(MktPage.appVars.result==MktSession.resultSuccess){this.reload();}}.createDelegate(this)});}},unhideDescriptorValue:function(ids)
{ids=ids||[];if(ids.length==0){var sels=this.getSelections();if(sels){for(var i=0,l=sels.length;i<l;i++){if(sels[i].json.isValue){ids.push(sels[i].json.id);}}}}
if(ids.length>0){MktSession.ajaxRequest('marketingEvent/unhideDescriptorValues',{serializeJSON:{descriptorValueIds:ids},onMySuccess:function(){if(MktPage.appVars.result==MktSession.resultSuccess){this.reload();}}.createDelegate(this)});}},showUsedByModal:function(record)
{var config={usedByRequestUrl:'marketingEvent/getDescriptorUsedByList'};if(record.json.isValue){config.usedPropertyLabel='Value';config.usedPropertyText=record.json.value;config.usedByRequestConfig={serializeJSON:{descriptorValueId:record.json.id}};config.items=[{xtype:'displayfield',fieldLabel:'Tag Type',value:getStore().getById(record.json.descriptorId).get('name')}];}
else{config.usedPropertyLabel='Tag Type';config.usedPropertyText=record.get('name');config.usedByRequestConfig={serializeJSON:{descriptorId:record.json.id}};}
var usedByModal=new Mkt.widgets.UsedByModal(config);usedByModal.show();},reload:function()
{getStore().reload();},getSelections:function()
{var sels=null;var grid=getGrid();if(grid){sels=grid.getSelectionModel().getSelections();}
return sels;},getSelected:function()
{var sel=null;var grid=getGrid();if(grid){sel=grid.getSelectionModel().getSelected();}
return sel;}};_app.DescriptorGrid=Ext.extend(MktGrids.TreeGridPanel,{enableSearchPaging:false,pageSize:50,cls:'mktDescriptorGrid',beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading {0} tags...',pagingEmptyMsg:'No tags found',pagingDisplayMsg:'{0}-{1} of {2}',searchQtip:'Search for tags',reloadAfterLayoutSave:false,enableTotal:true,totalDisplayMsg:'{0} items',showRefreshButton:true,enableDragDrop:false,showHiddenFilterActive:false,initComponent:function()
{this.ds.on('load',function(store,records,options){store.filterBy(function(record){return(!record.json.hidden||this.showHiddenFilterActive);}.createDelegate(this));}.createDelegate(this));_app.DescriptorGrid.superclass.initComponent.call(this);Ext.QuickTips.init();},initSubFilter:function()
{return[new Ext.Button({text:'Show Hidden',enableToggle:true,pressed:this.showHiddenFilterActive,iconCls:this.showHiddenFilterActive?'mkiCheckbox':'mkiCustCheckboxUnchecked',listeners:{toggle:function(button,pressed){this.showHiddenFilterActive=pressed;button.setIconClass(pressed?'mkiCheckbox':'mkiCustCheckboxUnchecked');this.getStore().filterBy(function(record){return(!record.json.hidden||pressed);});}.createDelegate(this)}})];},preDataInitCallback:function()
{var store=this.getStore();if(store){var records=store.getRange();for(var i=0,l=records.length;i<l;i++){var record=records[i];record.json.seeded=(record.json.type==_app.TYPE_CHANNEL);var children=record.json[this.childrenFieldId];if(children!=null){for(var j=0;j<children.length;j++){children[j].isValue=true;}}}}}});_app.DescriptorForm=Ext.extend(Mkt.widgets.ModalForm,{title:'New Tag Type',minWidth:500,width:500,autoHeight:true,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktDescriptorForm',iconCls:'mkiTagWindow',layout:'form',plain:true,editMode:false,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:130,fieldRequiredMsg:'This field is required',submitUrl:'marketingEvent/descriptorSubmit',valueFields:[],valueFieldsPanel:null,initComponent:function()
{this.items=this.items||[];this.items=this.items.concat(this.getFields());this.title=(this.editMode?'Edit':'New')+' Tag Type';this.okText=this.editMode?'Save':'Create';_app.DescriptorForm.superclass.initComponent.call(this);},getFields:function()
{var items=[];this.valueFields=[];this.nameField=new Ext.form.TextField({itemCls:'mktRequired',value:this.name,anchor:'94%',allowBlank:false,fieldLabel:'Tag Type',vtype:VTYPE_DESCRIPTOR_NAME});items.push(this.nameField);if(!this.editMode){this.valueFields.push(this._createValueField());var valuesPanel=this._createValuesPanel();items.push(valuesPanel);this.valueFieldsPanel=valuesPanel.getComponent('valueFieldsPanel');this.valueFieldsPanel.add(this.valueFields);}
this.requiredField=new Ext.form.Checkbox({checked:this.required,boxLabel:'Required for all programs and events',cls:'mktDescriptorCheckboxField',hideLabel:true});items.push(this.requiredField);return items;},_createValuesPanel:function()
{var panel=new Ext.Panel({itemId:'valueFieldsPanel',layout:'form',columnWidth:1,autoHeight:true,unstyled:true,items:[]});return new Ext.Panel({fieldLabel:'Values',itemCls:'mktRequired',layout:'column',autoHeight:true,anchor:'90%',unstyled:true,cls:'mktDescriptorValuesPanel',items:[panel,{xtype:'button',text:'Add Another',cls:'mktDescriptorAddValueButton',iconCls:'mkiAdd2',itemId:'addValueButton',onClick:this._addValueField.createDelegate(this)}]});},_createValueField:function(id,value,hidden)
{hidden=hidden||false;var field=new Ext.form.TextField({itemId:id,value:value,hidden:hidden,hideLabel:true,anchor:'90%',vtype:VTYPE_DESCRIPTOR_VALUE,onShow:function(){this.enable();this.getEl().up('.x-form-item').setDisplayed(true);},onHide:function(){this.disable();this.getEl().up('.x-form-item').setDisplayed(false);}});return field;},_addValueField:function()
{var field=this._createValueField();this.valueFields.push(field);this.valueFieldsPanel.add(field);this.doLayout();field.focus();},_hideValueField:function(field)
{var visibleFieldsCount=0;this.valueFieldsPanel.items.each(function(item){if(!item.hidden){visibleFieldsCount++;}});if(visibleFieldsCount>1){field.hide();}},validateValues:function()
{var isValid=true;if(this.valueFields.length>0){var previousValues=[],hasNonEmptyValue=false,duplicateMessage='Cannot have duplicate values';for(var i=0,l=this.valueFields.length;i<l;i++){var currentValue=this.valueFields[i].getValue().toLowerCase();this.valueFields[i].clearInvalid();if(currentValue.length==0){continue;}
for(var j=0;j<previousValues.length;j++){if(currentValue===previousValues[j]){this.valueFields[i].markInvalid(duplicateMessage);this.valueFields[j].markInvalid(duplicateMessage);isValid=false;}}
previousValues.push(currentValue);hasNonEmptyValue=true;}
if(!hasNonEmptyValue){this.valueFields[0].markInvalid('At least one tag value is required');isValid=false;}}
return isValid;},beforeSubmitCallback:function()
{this.nameField.clearInvalid();return this.nameField.validate()&&this.validateValues();},okCallback:function()
{this.descriptorSubmit();},descriptorSubmit:function()
{this.serializeJSON={name:Ext.util.Format.trim(this.nameField.getValue()),required:this.requiredField.getValue()};if(!this.editMode){this.serializeJSON.values=[];for(var i=0,l=this.valueFields.length;i<l;i++){if(this.valueFields[i].getValue().length>0){this.serializeJSON.values.push(Ext.util.Format.trim(this.valueFields[i].getValue()));}}}
if(this.descriptorId){this.serializeJSON.descriptorId=this.descriptorId;}},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){_app.Actions.reload();this.close();}}});_app.DescriptorValueForm=Ext.extend(_app.DescriptorForm,{title:'New Tag Value',submitUrl:'marketingEvent/descriptorValueSubmit',iconCls:'mkiTag',value:null,valueField:null,descriptorId:null,descriptorName:null,descriptorValueId:null,initComponent:function()
{_app.DescriptorValueForm.superclass.initComponent.call(this);this.title=(this.editMode?'Edit':'New')+' Tag Value';},getFields:function()
{var items=[];if(this.editMode){items.push(new Ext.form.DisplayField({fieldLabel:'Tag Type',value:this.descriptorName,anchor:'94%'}));this.valueField=new Ext.form.TextField({fieldLabel:'Value',itemCls:'mktRequired',value:this.value,allowBlank:false,anchor:'94%',vtype:VTYPE_DESCRIPTOR_VALUE});items.push(this.valueField);}
else{this.valueFields=[];var descriptors=[];getStore().queryBy(function(record){return!record.json.isValue&&record.json.type!=_app.TYPE_CHANNEL;}).each(function(record){descriptors.push([record.id,record.get('name')]);});this.descriptorField=new Ext.form.ComboBox({fieldLabel:'Tag Type',itemCls:'mktRequired',value:this.descriptorId!=null?this.descriptorId:undefined,autoSelect:false,editable:false,allowBlank:false,valueField:'id',displayField:'name',emptyText:'- Choose -',triggerAction:'all',mode:'local',store:new Ext.data.ArrayStore({fields:['id','name'],data:descriptors})});items.push(this.descriptorField);this.valueFields.push(this._createValueField());var valuesPanel=this._createValuesPanel();items.push(valuesPanel);this.valueFieldsPanel=valuesPanel.getComponent('valueFieldsPanel');this.valueFieldsPanel.add(this.valueFields);}
return items;},beforeSubmitCallback:function()
{if(this.editMode){this.valueField.clearInvalid();return this.valueField.validate();}
else{this.descriptorField.clearInvalid();return this.descriptorField.validate()&&this.validateValues();}},okCallback:function()
{this.descriptorValueSubmit();},descriptorValueSubmit:function()
{this.serializeJSON={};if(this.editMode){this.serializeJSON.descriptorValueId=this.descriptorValueId;this.serializeJSON.value=Ext.util.Format.trim(this.valueField.getValue());}
else{this.serializeJSON.descriptorId=this.descriptorField.getValue();this.serializeJSON.values=[];for(var i=0,l=this.valueFields.length;i<l;i++){if(this.valueFields[i].getValue().length>0){this.serializeJSON.values.push(Ext.util.Format.trim(this.valueFields[i].getValue()));}}}
if(this.descriptorValueId){this.serializeJSON.descriptorValueId=this.descriptorValueId;}
else if(this.descriptorId){this.serializeJSON.descriptorId=this.descriptorField.getValue();}}});_app.ChannelForm=Ext.extend(_app.DescriptorForm,{title:'New',submitUrl:'marketingEvent/descriptorValueSubmit',minWidth:580,width:580,cls:'mktModalForm mktModalForm2 mktModalForm3 mktChannelForm',iconCls:'mkiTag',warningMessage:null,descriptorValueId:null,descriptorValue:null,progressionType:_app.PROGRESSION_TYPE_PROGRAM,descriptorValueField:null,progressionTypeField:null,progressionPanel:null,stepsPanel:null,stepsHiddenPanel:null,stepsHiddenFieldSet:null,stepFields:{},stepsCount:0,initComponent:function()
{_app.ChannelForm.superclass.initComponent.call(this);this.title=(this.editMode?'Edit':'New')+' Channel';if(this.descriptorValueId!=null){MktSession.ajaxRequest('marketingEvent/getDescriptorValue',{serializeJSON:{descriptorValueId:this.descriptorValueId},onMySuccess:function(results){if(MktPage.appVars.result==MktSession.resultSuccess){this.descriptorValue=results.JSONResults.descriptorValue;this.formDataLoadedCallback();}}.createDelegate(this)});}
else{this.formDataLoadedCallback();}},getFields:function()
{var items=[];this.descriptorValueField=new Ext.form.TextField({fieldLabel:'Channel',itemCls:'mktRequired',anchor:'-30',allowBlank:false,vtype:VTYPE_DESCRIPTOR_VALUE});items.push(this.descriptorValueField);if(!this.editMode){this.progressionTypeField=new Ext.form.ComboBox({fieldLabel:'Applies to',itemCls:'mktRequired',value:_app.PROGRESSION_TYPE_PROGRAM,typeAhead:true,forceSelection:true,allowBlank:false,valueField:'id',displayField:'name',triggerAction:'all',mode:'local',store:new Ext.data.ArrayStore({fields:['id','name'],data:[[_app.PROGRESSION_TYPE_PROGRAM,_progressionTypes[_app.PROGRESSION_TYPE_PROGRAM]],[_app.PROGRESSION_TYPE_EVENT,_progressionTypes[_app.PROGRESSION_TYPE_EVENT]],[_app.PROGRESSION_TYPE_WEBINAR,_progressionTypes[_app.PROGRESSION_TYPE_WEBINAR]]]}),listeners:{select:function(combobox,record,index){this.progressionType=combobox.getValue();this._buildProgressionStepsPanel();}.createDelegate(this)}});}
else{this.progressionTypeField=new Ext.form.DisplayField({fieldLabel:'Applies to'});}
items.push(this.progressionTypeField);this.progressionPanel=new Ext.Panel({autoHeight:true,layout:{type:'hbox',align:'stretchmax'},unstyled:true,cls:'mktProgressionPanel',items:[]});items.push({xtype:'fieldset',title:'Progression',anchor:'-20',collapsible:false,autoHeight:true,items:[this.progressionPanel]});return items;},formDataLoadedCallback:function()
{if(this.descriptorValue!=null){this.descriptorValueField.setValue(this.descriptorValue.value);if(this.descriptorValue.progression!=null&&this.descriptorValue.progression.type!=null){this.progressionType=this.descriptorValue.progression.type;}
if(this.editMode){this.progressionTypeField.setValue(_progressionTypes[this.progressionType]);}}
this._buildProgressionStepsPanel();},_buildProgressionStepsPanel:function()
{var items=[],columnsCount=0;this.stepFields={};this.stepsCount=0;items.push({unstyled:true,html:'<b>Status</b>'});items.push({unstyled:true,html:'<b>Step</b>'});if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR){items.push({unstyled:true,html:'<b>Webinar Behavior</b>'});}
items.push({unstyled:true,html:'<b>Success</b>'});if(this.editMode){items.push({unstyled:true,html:'<b>Hide</b>'});}
columnsCount=items.length;if(this.descriptorValueId!=null){var progression=this.descriptorValue.progression;if(progression!=null&&progression.steps!=null&&progression.steps.length>0){for(var i=0,l=progression.steps.length;i<l;i++){var step=progression.steps[i];if(!step.system){var stepType=null;if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR){switch(step.type){case'Registered':stepType=_app.PROGRESSION_STEP_TYPE_REGISTERED;break;case'Attended':stepType=_app.PROGRESSION_STEP_TYPE_ATTENDED;break;case'Attended On-demand':stepType=_app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND;break;case'No Show':stepType=_app.PROGRESSION_STEP_TYPE_NO_SHOW;break;}}
items.push(this._createProgressionStep(step.id,step.name,step.order,step.success,step.hidden,stepType));}}}
else{items.push(this._createProgressionStep());}}
else{if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR){items.push(this._createProgressionStep(null,'Registered',10,false,false,_app.PROGRESSION_STEP_TYPE_REGISTERED));items.push(this._createProgressionStep(null,'No Show',20,false,false,_app.PROGRESSION_STEP_TYPE_NO_SHOW));items.push(this._createProgressionStep(null,'Attended',30,false,false,_app.PROGRESSION_STEP_TYPE_ATTENDED));items.push(this._createProgressionStep(null,'Attended On-demand',40,false,false,_app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND));items.push(this._createProgressionStep(null,'',50));}
else{items.push(this._createProgressionStep(null,'Member',10));items.push(this._createProgressionStep(null,'',20));}}
if(this.stepsPanel!=null){this.progressionPanel.removeAll();}
this.stepsPanel=new Ext.Panel({itemId:'stepsPanel',layout:'table',autoHeight:true,unstyled:true,defaults:{bodyStyle:'padding: 5px 10px 5px 2px'},layoutConfig:{columns:columnsCount},items:items});this.progressionPanel.add([this.stepsPanel,{itemId:'addStepButtonPanel',xtype:'panel',unstyled:true,cls:'mktProgressionAddStepButtonPanel',flex:1,items:[{xtype:'button',text:'Add Step',cls:'mktProgressionAddStepButton',iconCls:'mkiAdd2',onClick:this._addProgressionStep.createDelegate(this)}]}]);if(this.editMode){this.stepsHiddenPanel=new Ext.Panel({itemId:'stepsHiddenPanel',layout:'table',autoHeight:true,unstyled:true,defaults:{bodyStyle:'padding: 5px 10px 5px 2px'},layoutConfig:{columns:columnsCount},items:[]});this.stepsHiddenFieldSet=new Ext.form.FieldSet({xtype:'fieldset',title:'Hidden Steps',collapsible:true,collapsed:true,forceLayout:true,autoHeight:true,cls:'mktProgressionHiddenStepsFieldSet',items:[this.stepsHiddenPanel],listeners:{afterrender:function(fieldSet){var progression=this.descriptorValue.progression,hiddenStepsCount=0;if(progression!=null&&progression.steps!=null&&progression.steps.length>0){for(var i=0,l=progression.steps.length;i<l;i++){var step=progression.steps[i];if(step.hidden){this._hideProgressionStep(step.id);hiddenStepsCount++;}}}
if(hiddenStepsCount==0){fieldSet.hide();}}.createDelegate(this),add:function(){if(!this.isVisible()){this.show();}}}});this.progressionPanel.ownerCt.add(this.stepsHiddenFieldSet);}
if(this.rendered){this.doLayout();}},_createProgressionStep:function(id,name,order,success,hidden,type)
{id=id||undefined;name=name||undefined;order=order||undefined;success=success||false;hidden=hidden||false;type=type||undefined;var fields={},panels=[],stepId=id||'STEP-'+this.stepsCount;fields.id=new Ext.form.Hidden({value:id});fields.hidden=new Ext.form.Hidden({value:hidden});fields.name=new Ext.form.TextField({value:name,anchor:'100%',vtype:VTYPE_PROGRESSION_STEP_NAME});panels.push({itemId:'step-'+stepId+'-name',layout:'anchor',unstyled:true,width:140,hidden:hidden,items:[fields.id,fields.name]});fields.order=new Ext.form.TextField({value:order,anchor:'100%',vtype:VTYPE_PROGRESSION_STEP_ORDER});panels.push({itemId:'step-'+stepId+'-order',layout:'anchor',unstyled:true,width:45,hidden:hidden,items:[fields.order]});if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR){fields.behavior=new Ext.form.DisplayField({value:_progressionStepTypes[type]||'',cls:'mktProgressionStepDisplayField',unstyled:true});fields.type=new Ext.form.Hidden({value:type});panels.push({itemId:'step-'+stepId+'-type',unstyled:true,width:125,hidden:hidden,items:[fields.type,fields.behavior]});}
fields.success=new Ext.form.Checkbox({checked:success,boxLabel:''});panels.push({itemId:'step-'+stepId+'-success',unstyled:true,width:60,style:'text-align: center',hidden:hidden,items:[fields.success]});if(this.editMode){var hideLink=new Ext.Element(Ext.DomHelper.createDom({html:'<a href="#"><img class="mkiCancel" height="16" width="16" src="'+Ext.BLANK_IMAGE_URL+'" /></a>'}));hideLink.setVisible(id!=null&&type==null);hideLink.on('click',function(e){e.stopEvent();this._hideProgressionStep(stepId);}.createDelegate(this));panels.push({itemId:'step-'+stepId+'-hide',contentEl:hideLink,style:'text-align: center',unstyled:true,width:40,hidden:hidden});}
this.stepFields[stepId]=fields;this.stepsCount++;return panels;},_addProgressionStep:function()
{this.stepsPanel.add(this._createProgressionStep());this.stepsPanel.setWidth('auto');this.stepsPanel.doLayout();this.doLayout();},_hideProgressionStep:function(stepId)
{this.stepFields[stepId].hidden.setValue(true);var nameFieldPanel={itemId:'step-'+stepId+'-name',unstyled:true,width:140,items:[{xtype:'hidden',value:this.stepFields[stepId].id.getValue()},{xtype:'displayfield',value:this.stepFields[stepId].name.getValue(),unstyled:true}]};this.stepsHiddenPanel.add(nameFieldPanel);var orderFieldPanel={itemId:'step-'+stepId+'-order',unstyled:true,width:45,items:[{xtype:'displayfield',value:this.stepFields[stepId].order.getValue(),unstyled:true}]};this.stepsHiddenPanel.add(orderFieldPanel);if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR){var behaviorFieldPanel={itemId:'step-'+stepId+'-behavior',unstyled:true,width:125,items:[{xtype:'displayfield',value:_progressionStepTypes[this.stepFields[stepId].behavior.getValue()]||'',unstyled:true},{xtype:'hidden',value:this.stepFields[stepId].type.getValue()}]};this.stepsHiddenPanel.add(behaviorFieldPanel);}
var successFieldPanel={itemId:'step-'+stepId+'-success',unstyled:true,width:60,style:'text-align: center',items:[{xtype:'checkbox',checked:this.stepFields[stepId].success.getValue(),disabled:true,boxLabel:''}]};this.stepsHiddenPanel.add(successFieldPanel);var unhideLink=new Ext.Element(Ext.DomHelper.createDom({html:'<a href="#">Unhide</a>'}));unhideLink.on('click',function(e){e.stopEvent();this._unhideProgressionStep(stepId);}.createDelegate(this));var unhideLinkPanel={itemId:'step-'+stepId+'-unhide',contentEl:unhideLink,unstyled:true,width:40};this.stepsHiddenPanel.add(unhideLinkPanel);Ext.each(this.stepsPanel.findBy(function(item){return(item.getItemId().indexOf('step-'+stepId+'-')===0);}),function(){this.hide();});this.stepsPanel.setWidth('auto');this.progressionPanel.get('addStepButtonPanel').setHeight('auto');this.progressionPanel.doLayout();this.stepsHiddenPanel.doLayout();},_unhideProgressionStep:function(stepId)
{this.stepFields[stepId].hidden.setValue(false);var items=this.stepsHiddenPanel.findBy(function(item){return(item.getItemId().indexOf('step-'+stepId+'-')===0);});for(var i=0,l=items.length;i<l;i++){this.stepsHiddenPanel.remove(items[i]);}
Ext.each(this.stepsPanel.findBy(function(item){return(item.getItemId().indexOf('step-'+stepId+'-')===0);}),function(){this.show();});this.stepsPanel.setWidth('auto');this.stepsHiddenPanel.doLayout();this.progressionPanel.doLayout();},validateSteps:function()
{var isValid=true;this.hideMessage();var currentStepIndex=0,successStepsCount=0,webinarRegisteredText='',webinarRegisteredOrder=0,webinarAttendedText='',webinarAttendedOrder=0,webinarAttendedOnDemandText='',webinarAttendedOnDemandOrder=0,webinarNoShowText='',webinarNoShowOrder=0,stepNamesMap={};for(var id in this.stepFields){var fields=this.stepFields[id];fields.name.clearInvalid();fields.order.clearInvalid();if(fields.name.getValue().length>0){var currentName=fields.name.getValue().toLowerCase(),duplicateMessage='Cannot have duplicate steps';for(var id2 in stepNamesMap){if(currentName===stepNamesMap[id2]){this.stepFields[id].name.markInvalid(duplicateMessage);this.stepFields[id2].name.markInvalid(duplicateMessage);isValid=false;}}
stepNamesMap[id]=currentName;if(fields.order.getValue().length==0){fields.order.markInvalid('Order is is required');isValid=false;}
if(fields.success.getValue()){successStepsCount++;}
if(fields.type!=null){switch(fields.type.getValue()){case _app.PROGRESSION_STEP_TYPE_REGISTERED:webinarRegisteredText=fields.name.getValue();webinarRegisteredOrder=fields.order.getValue();break;case _app.PROGRESSION_STEP_TYPE_ATTENDED:webinarAttendedText=fields.name.getValue();webinarAttendedOrder=fields.order.getValue();break;case _app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND:webinarAttendedOnDemandText=fields.name.getValue();webinarAttendedOnDemandOrder=fields.order.getValue();break;case _app.PROGRESSION_STEP_TYPE_NO_SHOW:webinarNoShowText=fields.name.getValue();webinarNoShowOrder=fields.order.getValue();break;}}}
else{if(fields.type!=null){var type=fields.type.getValue();if(type==_app.PROGRESSION_STEP_TYPE_REGISTERED||type==_app.PROGRESSION_STEP_TYPE_ATTENDED||type==_app.PROGRESSION_STEP_TYPE_ATTENDED_ON_DEMAND||type==_app.PROGRESSION_STEP_TYPE_NO_SHOW){fields.name.markInvalid('This step is required');isValid=false;}}
else if(currentStepIndex==0&&this.progressionType!=_app.PROGRESSION_TYPE_WEBINAR){fields.name.markInvalid('This step is required');isValid=false;}}
currentStepIndex++;}
if(isValid){if(successStepsCount==0){this.showErrorMessage('At least one success step is required');isValid=false;}
if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR&&webinarRegisteredOrder>=Math.min(webinarAttendedOrder,webinarNoShowOrder)){this.showErrorMessage('"'+webinarRegisteredText+'" must come before "'+webinarNoShowText+'/'+webinarAttendedText+'"');isValid=false;}
if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR&&webinarNoShowOrder>=webinarAttendedOnDemandOrder){this.showErrorMessage('"'+webinarNoShowText+'" must come before "'+webinarAttendedOnDemandText+'"');isValid=false;}
if(this.progressionType==_app.PROGRESSION_TYPE_WEBINAR&&webinarAttendedOrder>=webinarAttendedOnDemandOrder){this.showErrorMessage('"'+webinarAttendedText+'" must come before "'+webinarAttendedOnDemandText+'"');isValid=false;}}
return isValid;},beforeSubmitCallback:function()
{return this.descriptorValueField.validate()&&this.progressionTypeField.validate()&&this.validateSteps();},okCallback:function()
{this.serializeJSON={};this.serializeJSON.value=Ext.util.Format.trim(this.descriptorValueField.getValue());if(!this.editMode){this.serializeJSON.progressionType=Ext.util.Format.trim(this.progressionTypeField.getValue());}
this.serializeJSON.progressionSteps=[];for(var id in this.stepFields){var fields=this.stepFields[id];if(fields.name.getValue().length==0)continue;var step={name:Ext.util.Format.trim(fields.name.getValue()),order:Ext.util.Format.trim(fields.order.getValue()),type:(fields.type&&fields.type.getValue())||null,success:fields.success.getValue(),hidden:fields.hidden.getValue()};if(fields.id.getValue()){step.id=fields.id.getValue();}
this.serializeJSON.progressionSteps.push(step);}
if(this.editMode&&this.descriptorValue.progression&&this.descriptorValue.progression.id){this.serializeJSON.progressionId=this.descriptorValue.progression.id;}
if(this.descriptorValueId){this.serializeJSON.descriptorValueId=this.descriptorValueId;}
else{this.serializeJSON.descriptorId=1;}}});})();
/* ========== ../mkt-ext-2.0/menus/DescriptorAdminMenu.js ============ */

(function()
{Ext.ns('Mkt','Mkt.menus','Mkt.menus.descriptorAdmin');var _app=Mkt.apps.descriptorAdmin,_menu=Mkt.menus.descriptorAdmin;_menu.newMenu=function()
{return new Ext.menu.Menu({minWidth:200,items:[_menu.menuItemPool.newDescriptor,_menu.menuItemPool.newDescriptorValue,_menu.menuItemPool.newChannelValue]});}
_menu.actionsMenu=function()
{var menu=new Ext.menu.Menu({minWidth:200,items:[_menu.menuItemPool.editDescriptor,_menu.menuItemPool.deleteDescriptor,_menu.menuItemPool.hideDescriptorValue,_menu.menuItemPool.unhideDescriptorValue]});menu.on('beforeshow',function(){var sels=_app.Actions.getSelections(),selectedCount=sels?sels.length:0,selectedSeededCount=0,selectedValuesCount=0,selectedHiddenValuesCount=0;for(var i=0;i<selectedCount;i++){if(sels[i].json.isValue){selectedValuesCount++;if(sels[i].json.hidden){selectedHiddenValuesCount++;}}
if(sels[i].json.seeded){selectedSeededCount++;}}
var disableEdit=selectedCount!=1||selectedSeededCount>0;var disableDelete=selectedCount!=1||selectedValuesCount>0||selectedSeededCount>0;var showDelete=selectedValuesCount==0;var showHide=selectedCount==selectedValuesCount&&selectedValuesCount!=selectedHiddenValuesCount;var showUnhide=selectedCount==selectedValuesCount&&selectedHiddenValuesCount!=0;this.items.get('editDescriptor').setDisabled(disableEdit);this.items.get('deleteDescriptor').setDisabled(disableDelete).setVisible(showDelete);this.items.get('hideDescriptorValue').setVisible(showHide);this.items.get('unhideDescriptorValue').setVisible(showUnhide);});return menu;}
_menu.Toolbar=function()
{function toolbarRequestHandler(attr,ret)
{var getterFuncName=MktUtil.camelCase(attr.subType||attr.type);if(isFunction(_menu.Toolbar['get'+getterFuncName])){ret.comp=_menu.Toolbar['get'+getterFuncName](attr);}}
Mkt.menus.ToolbarMgr.registerComp('DescriptorAdmin',toolbarRequestHandler);return{getDescriptorAdminActions:function()
{var newButton={xtype:'mkttbbutton',itemId:'newButton',text:'New',iconCls:'mkiTagAdd',menu:_menu.newMenu()};var actionsButton={xtype:'mkttbbutton',itemId:'actionsButton',text:'Tag Actions',iconCls:'mkiTag',menu:_menu.actionsMenu()};return new Ext.Toolbar({items:[newButton,actionsButton]});}};}();_menu.menuItemPool={newDescriptor:{text:'New Tag Type',itemId:'newDescriptor',iconCls:'mkiTagWindow',handler:function(item){_app.Actions.newDescriptor.call(_app.Actions,item.getEl());}},newDescriptorValue:{text:'New Tag Value',itemId:'newDescriptorValue',iconCls:'mkiTag',handler:function(item){_app.Actions.newDescriptorValue.call(_app.Actions,item.getEl());}},newChannelValue:{text:'New Channel',itemId:'newChannel',iconCls:'mkiTagRight',handler:function(item){_app.Actions.newChannelValue.call(_app.Actions,item.getEl());}},editDescriptor:{text:'Edit',itemId:'editDescriptor',iconCls:'mkiTagEdit',disabled:true,handler:function(item){var record=_app.Actions.getSelected();if(record){if(record.json.isValue){_app.Actions.editDescriptorValue.call(_app.Actions,item.getEl());}
else if(!record.json.seeded){_app.Actions.editDescriptor.call(_app.Actions,item.getEl());}}}},deleteDescriptor:{text:'Delete',itemId:'deleteDescriptor',iconCls:'mkiTagDelete',disabled:true,handler:function(item){_app.Actions.deleteDescriptor.call(_app.Actions,item.getEl());}},hideDescriptorValue:{text:'Hide',itemId:'hideDescriptorValue',iconCls:'mkiTagHide',disabled:false,handler:function(item){_app.Actions.hideDescriptorValue.call(_app.Actions);}},unhideDescriptorValue:{text:'Unhide',itemId:'unhideDescriptorValue',iconCls:'mkiTagUnhide2',disabled:false,handler:function(item){_app.Actions.unhideDescriptorValue.call(_app.Actions);}}};})();
/* ========== ../mkt-ext-2.0/apps/SparkHome.js ============ */

Ext.namespace('Mkt','Mkt.apps','Mkt.apps.sparkHome');Mkt.apps.sparkHome.initStatusTab=function(params){Mkt.apps.sparkHome.emailGrid=new MktGrids.CanvasGridPanel({id:'emailActivityGrid',cls:'no-grid-header no-grid-back chartToolbar gridChartToolbar',bodyStyle:'padding: 20px;padding-bottom:5px;padding-top:5px;',loadMask:true,maskCanvas:false,enableExport:false,totalDisplayMsg:'',enablePurpleCorners:false,pagingEmptyMsg:'There is no Status to show',params:params,refreshText:'Refresh',refreshIcon:undefined,exportIcon:undefined,plugins:[new Ext.ux.Sparkline.GridPlugin()],cm:new Ext.grid.ColumnModel([{header:'Type',id:'type',dataIndex:'type',hidden:true},{header:'Stats',xtype:'sparklinecolumn',dataIndex:'value',sparkline:{type:'line',lineColor:'#E49C3C',fillColor:'#44BED4'}}]),ds:new MktGrids.JsonGroupingStore({url:'/charts/gridData',root:'data',fields:[{name:'type'},{name:'value'}],groupField:'type',groupOnSort:false,remoteGroup:true,remoteSort:false}),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text}',showGroupName:false,hideGroupedColumn:true}),autoWidth:false,autoSizeColumns:false,autoExpandColumn:'value',disableSelection:true,trackMouseOver:false,stripeRows:false,listeners:{render:function(){this.store.load({params:params[1],callback:function(){Mkt.apps.sparkHome.statusTab.emailActivityLoaded=true;Mkt.apps.sparkHome.statusTab.unmask();}});}}});Mkt.apps.sparkHome.leadGrid=new MktGrids.CanvasGridPanel({id:'leadActivityGrid',cls:'no-grid-header no-grid-back chartToolbar gridChartToolbar',bodyStyle:'padding: 20px;padding-bottom:5px;padding-top:5px;',loadMask:true,maskCanvas:false,enableExport:false,totalDisplayMsg:'',enablePurpleCorners:false,pagingEmptyMsg:'There is no Status to show',params:params,refreshText:'Refresh',refreshIcon:undefined,exportIcon:undefined,plugins:[new Ext.ux.Sparkline.GridPlugin()],cm:new Ext.grid.ColumnModel([{header:'Type',id:'type',dataIndex:'type',hidden:true},{header:'Stats',xtype:'sparklinecolumn',dataIndex:'value',sparkline:{type:'line',lineColor:'#E49C3C',fillColor:'#44BED4'}}]),ds:new MktGrids.JsonGroupingStore({url:'/charts/gridData',root:'data',fields:[{name:'type'},{name:'value'}],groupField:'type',groupOnSort:false,remoteGroup:true,remoteSort:false}),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text}',showGroupName:false,hideGroupedColumn:true}),autoWidth:false,autoSizeColumns:false,autoExpandColumn:'value',disableSelection:true,trackMouseOver:false,stripeRows:false,listeners:{render:function(){this.store.load({params:params[0],callback:function(){Mkt.apps.sparkHome.statusTab.leadActivityLoaded=true;Mkt.apps.sparkHome.statusTab.unmask();}});}}});return Mkt.apps.sparkHome.statusTab=new Ext.Panel({id:'sparkHome_statusTab',title:'Status',leadActivityLoaded:false,emailActivityLoaded:false,mask:null,listeners:{render:function(){this.mask=new Ext.LoadMask(Mkt.apps.sparkHome.statusTab.el,{msg:"",msgCls:"x-mask-loading"});this.mask.show();Mkt.apps.sparkHome.statusTab.add(Mkt.apps.sparkHome.emailGrid);Mkt.apps.sparkHome.statusTab.add(Mkt.apps.sparkHome.leadGrid);}},unmask:function(){if(this.mask&&Mkt.apps.sparkHome.statusTab.leadActivityLoaded&&Mkt.apps.sparkHome.statusTab.emailActivityLoaded){this.mask.hide();this.mask=null;}}});}
Mkt.apps.sparkHome.initTabs=function(canvas,renderTo,params){Mkt.apps.sparkHome.tabpanel=new MktPanel.CanvasResizableTabPanel({canvas:canvas,renderTo:renderTo,frame:true,fitToCanvas:false,loadMask:true,canvasMask:false,height:380,width:300,cls:'mktPlainTbar',selectedTab:0,plain:true,title:'Testing',items:Mkt.apps.sparkHome.initStatusTab(params)});Mkt.apps.sparkHome.tabpanel.setActiveTab(0);};
/* ========== ../mkt-ext-2.0/apps/JigsawAdmin.js ============ */

(function()
{Ext.ns('Mkt','Mkt.apps','Mkt.apps.jigsawAdmin');var _app=Mkt.apps.jigsawAdmin,_menu=Mkt.menus.jigsawAdmin,_data={};_app.JIGSAW_ACTIVITY_TYPE_NAME='Enrich with Data.com';_app.setData=function(data)
{_data=data||{};};_app.Actions={editCredentials:function(animEl)
{var form=new _app.CredentialsForm({username:_data.username,password:_data.password,token:_data.token});form.show(animEl);},editMappings:function(animEl)
{var form=new _app.MappingsForm();form.show(animEl);},showIntro:function(animEl)
{var buttons=[];if(MktPage.hasAdminRole){buttons.push({text:'Enter Data.com Credentials',iconCls:'mkiOk',handler:MktMessage.okClicked});}
buttons.push({text:'Close',iconCls:'mkiCancel',handler:MktMessage.cancelClicked});MktMessage.show({title:'Enrich with Data.com',msg:'<div class="mktJigsawIntroContent">'+'<h3>Marketo & Data.com: A Great Combination</h3>'+'<span>Get <b>better</b>, <b>cleaner</b> and <b>more accurate data</b> for your leads</span>'+'<br /><br /><br />'+'<a href="/guide/displaySuccessContent?contentTag=jigsawAdmin_link1" target="_blank">Learn how</a> this feature works<br />'+'<a href="http://jigsaw.com" target="_blank">Sign up for Data.com</a>'+'</div>'+'<div class="mktJigsawIntroWatermark mki128DataCom"></div>',msgTmpl:'{1}',cls:'mktJigsawIntro mktModalForm',iconCls:'mkiDataCom',animateTarget:animEl,width:500,buttons:buttons,okCallback:function(){MktDlManager.loadDl(MktDlManager.getDlCodeMap('JS'));}});}};_app.CredentialsForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Edit Data.com Credentials',minWidth:400,width:450,autoHeight:true,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktJigsawCredentialsForm',iconCls:'mkiDataCom',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:130,fieldRequiredMsg:'This field is required',okText:'Save',submitUrl:'jigsaw/credentialsSubmit',username:null,password:null,token:null,usernameField:null,passwordField:null,tokenField:null,initComponent:function()
{this.items=(this.items||[]).concat(this.getFields());_app.CredentialsForm.superclass.initComponent.call(this);},getFields:function()
{var items=[];this.usernameField=new Ext.form.TextField({fieldLabel:'Username',value:!Ext.isEmpty(this.username)?this.username:undefined,anchor:'-10',allowBlank:false,itemCls:'mktRequired'});items.push(this.usernameField);this.passwordField=new Ext.form.TextField({fieldLabel:'Password',value:!Ext.isEmpty(this.password)?this.password:undefined,inputType:'password',anchor:'-10',allowBlank:false,itemCls:'mktRequired'});items.push(this.passwordField);this.tokenField=new Ext.form.TextField({fieldLabel:'Token',value:!Ext.isEmpty(this.token)?this.token:undefined,anchor:'-10',allowBlank:true,itemCls:'mktHidden'});items.push(this.tokenField);return items;},beforeSubmitCallback:function()
{var isValid=true;isValid=this.usernameField.validate()&&isValid;isValid=this.passwordField.validate()&&isValid;isValid=this.tokenField.validate()&&isValid;return isValid;},okCallback:function()
{this.serializeJSON={username:this.usernameField.getValue(),password:this.passwordField.getValue(),token:this.tokenField.getValue()};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){var username=this.usernameField.getValue(),password=this.passwordField.getValue(),token=this.tokenField.getValue();this.close();_app.setData({username:username,password:password,token:token});MktCanvas.mask();var usernameEl=Ext.get('cadJigsawUsernameValue');if(usernameEl){usernameEl.dom.innerHTML=!Ext.isEmpty(username)?username:'<i>not set</i>';}
var passwordEl=Ext.get('cadJigsawPasswordValue');if(passwordEl){passwordEl.dom.innerHTML=!Ext.isEmpty(password)?'set':'<i>not set</i>';}
var tokenEl=Ext.get('cadJigsawTokenValue');if(tokenEl){tokenEl.dom.innerHTML=!Ext.isEmpty(token)?token:'<i>not set</i>';}
MktCanvas.unmask();MktPage.savedState.jigsawActive=true;}}});_app.MappingsForm=Ext.extend(Mkt.widgets.ModalForm,{title:'Data.com Field Mapping',minHeight:300,height:500,minWidth:450,width:450,resizable:true,cls:'mktModalForm mktModalForm2 mktModalForm3 mktJigsawMappingsForm',iconCls:'mkiDataEdit',layout:'form',plain:true,modal:true,bodyStyle:'padding: 30px 15px 15px 15px;',buttonAlign:'right',labelWidth:190,okText:'Save',submitUrl:'jigsaw/mappingsSubmit',jigsawFieldsData:[],localFieldsData:[],mappingFields:[],initComponent:function()
{_app.MappingsForm.superclass.initComponent.call(this);MktSession.ajaxRequest('jigsaw/getMappings',{serializeJSON:{},onMySuccess:function(results){if(MktPage.appVars.result==MktSession.resultSuccess){this.jigsawFieldsData=results.JSONResults.jigsawFields;this.localFieldsData=results.JSONResults.localFields;this._loadFormData();}}.createDelegate(this)});},_loadFormData:function()
{this.mappingFields=[];var localFieldNamesMap={};for(var k=0,kl=this.localFieldsData.length;k<kl;k++){localFieldNamesMap[this.localFieldsData[k].aid]=this.localFieldsData[k].name;}
for(var i=0,il=this.jigsawFieldsData.length;i<il;i++){var jigsawField=this.jigsawFieldsData[i];var values=[];if(jigsawField.defaultAttrId){values.push({id:jigsawField.defaultAttrId,name:localFieldNamesMap[jigsawField.defaultAttrId],recommended:true});}
values.push({id:null,name:'None'});var localFieldValues=[];if(jigsawField.mappableAttrs){for(var j=0,jl=jigsawField.mappableAttrs.length;j<jl;j++){var localFieldAttrId=jigsawField.mappableAttrs[j];if(localFieldAttrId!==jigsawField.defaultAttrId){localFieldValues.push({id:localFieldAttrId,name:localFieldNamesMap[localFieldAttrId]});}}}
localFieldValues.sort(function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();return nameA>nameB?1:(nameA<nameB?-1:0);});values=values.concat(localFieldValues);this.mappingFields.push(new Ext.form.ComboBox({itemId:new String(i),value:!Ext.isEmpty(jigsawField.aid)?jigsawField.aid:null,fieldLabel:jigsawField.header,anchor:'-20',forceSelection:true,allowBlank:false,valueField:'id',displayField:'name',triggerAction:'all',mode:'local',tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">{name}<tpl if="recommended"> (default)</tpl></div></tpl>'),store:new Ext.data.JsonStore({fields:['id','name','recommended'],data:values})}));}
this.add({layout:'column',unstyled:true,anchor:'-20',defaults:{cls:'mktJigsawMappingsHeader',columnWidth:.5,unstyled:true},items:[{html:'Data.com Field'},{html:'Marketo Field'}]});this.add(this.mappingFields);this.doLayout();},beforeSubmitCallback:function()
{var isValid=true;var previousMappingValuesMap={};for(var i=0,il=this.mappingFields.length;i<il;i++){var field=this.mappingFields[i],value=field.getValue();field.clearInvalid();if(!value){continue;}
if(previousMappingValuesMap[value]){field.markInvalid('<b>'+field.getRawValue()+'</b> is already mapped to another Data.com field');isValid=false;}
previousMappingValuesMap[value]=true;}
return isValid;},okCallback:function()
{var mappings={};for(var i=0,il=this.mappingFields.length;i<il;i++){mappings[this.jigsawFieldsData[i].fid]=this.mappingFields[i].getValue();}
this.serializeJSON={mappings:mappings};},submitSuccessCallback:function()
{if(MktPage.appVars.result==MktSession.resultSuccess){this.close();}}});})();
/* ========== ../mkt-ext-2.0/menus/JigsawAdminMenu.js ============ */

(function()
{Ext.ns('Mkt','Mkt.menus','Mkt.menus.jigsawAdmin');var _app=Mkt.apps.jigsawAdmin,_menu=Mkt.menus.jigsawAdmin;_menu.Toolbar=function()
{function toolbarRequestHandler(attr,ret)
{var getterFuncName=MktUtil.camelCase(attr.subType||attr.type);if(isFunction(_menu.Toolbar['get'+getterFuncName])){ret.comp=_menu.Toolbar['get'+getterFuncName](attr);}}
Mkt.menus.ToolbarMgr.registerComp('JigsawAdmin',toolbarRequestHandler);return{getToolbar:function()
{return new Ext.Toolbar({items:[_menu.menuItemPool.editCredentials,_menu.menuItemPool.editMappings]});}};}();_menu.menuItemPool={editCredentials:{text:'Edit Credentials',itemId:'editCredentials',iconCls:'mkiDataCom',disabled:false,handler:function(item){_app.Actions.editCredentials.call(_app.Actions,item.getEl());}},editMappings:{text:'Edit Data.com Field Mapping',itemId:'editMappings',iconCls:'mkiDataEdit',disabled:false,handler:function(item){_app.Actions.editMappings.call(_app.Actions,item.getEl());}}};})();
/* ========== ../mkt-ext-2.0/apps/CampaignMonitor.js ============ */

(function()
{Ext.ns('Mkt','Mkt.apps','Mkt.apps.campaignMonitor');var _app=Mkt.apps.campaignMonitor;_app.CAMPAIGN_STATUS={DEFAULT:0,BAT:1,BAT_RAN:2,BAT_SCHEDULED:3,BAT_SCHEDULED_WARN:4,BAT_REPEAT:5,TRG_INACTIVE:6,TRG_ACTIVE:7,TRG_ACTIVE_WARN:8,UI_STATUS_TRG_ACTIVE_REQUESTED:9};_app.MonitorGrid=Ext.extend(MktGrids.CanvasGridPanel,{enableSearchPaging:false,pageSize:50,cls:'mktCampaignMonitorGrid',beforeLoadMaskMsg:'Loading...',afterLoadMaskMsg:'Loading {0} campaigns...',pagingEmptyMsg:'No campaigns found',pagingDisplayMsg:'{0}-{1} of {2}',searchQtip:'Search for campaigns',reloadAfterLayoutSave:false,enableTotal:true,loadMask:true,maskCanvas:false,totalDisplayMsg:'{0} items',showRefreshButton:true,enableDragDrop:false,enableHdMenu:false,initComponent:function()
{_app.MonitorGrid.superclass.initComponent.call(this);Ext.QuickTips.init();}});_app.render=function(canvas)
{var cm=new Ext.grid.ColumnModel([{id:'campaign_id',header:'Campaign ID',dataIndex:'campaign_id',sortable:false,groupable:false,hidden:true,width:30},{id:'type',dataIndex:'type',sortable:false,hidden:true,width:50,groupRenderer:function(v){return(v&&v.length>0)?v[0].toUpperCase()+v.substr(1):v;}},{id:'priority',header:'Priority',dataIndex:'priority',sortable:false,groupable:false,align:'center',width:70,renderer:function(v,metaData,record,rowIndex,colIndex,store){var status=record.get('status'),type=record.get('type'),imgClass='',tooltip='';if(type=='batch'){if(status=='working'){imgClass='mkiMediaPlayGreen';}
else if(status=='queued'){imgClass='mkiMediaPause';}
tooltip=Ext.util.Format.capitalize(status);}
else if(type=='trigger'){if(v<=50){imgClass='mkiNavUpGreen';tooltip='High';}
else if(v<=75){imgClass='mkiNavUpRightYellow';tooltip='Medium';}
else{imgClass='mkiNavDownBlue';tooltip='Low';}}
return'<img class="'+imgClass+'" height="16" width="16" src="'+Ext.BLANK_IMAGE_URL+'" title="'+tooltip+'" />';}},{id:'status',header:'Status',dataIndex:'status',sortable:false,groupable:false,width:130,css:'text-transform: capitalize;'},{id:'campaign_name',header:'Campaign Name',dataIndex:'campaign_name',sortable:false,groupable:false,width:500,renderer:function(v,metaData,record,rowIndex,colIndex,store){var imgClass='mkiLightbulb';switch(record.json.sc_type){case _app.CAMPAIGN_STATUS.DEFAULT:case _app.CAMPAIGN_STATUS.BAT:imgClass='mkiLightbulb';break;case _app.CAMPAIGN_STATUS.BAT_RAN:imgClass='mkiLightbulbCheck';break;case _app.CAMPAIGN_STATUS.BAT_SCHEDULED:imgClass='mkiClock';break;case _app.CAMPAIGN_STATUS.BAT_SCHEDULED_WARN:imgClass='mkiClockRedAnim';break;case _app.CAMPAIGN_STATUS.BAT_REPEAT:imgClass='mkiClockCheck';break;case _app.CAMPAIGN_STATUS.TRG_INACTIVE:imgClass='mkiLightbulb';break;case _app.CAMPAIGN_STATUS.TRG_ACTIVE:imgClass='mkiLightbulbOn';break;case _app.CAMPAIGN_STATUS.TRG_ACTIVE_WARN:imgClass='mkiLightbulbOnRedAnim';break;case _app.CAMPAIGN_STATUS.UI_STATUS_TRG_ACTIVE_REQUESTED:imgClass='mkiLightbulbOnArrow2';break;}
return'<img class="'+imgClass+'" height="16" width="16" src="'+Ext.BLANK_IMAGE_URL+'" />&nbsp;'+'<span class="clickable">'+v+'</span>';}},{id:'workspace',header:'Workspace',dataIndex:'workspace',hidden:!MktPage.savedState.zoneEnabled,sortable:false,groupable:false,width:250}]);var fields=[{name:'type',type:'auto'},{name:'priority',type:'auto'},{name:'campaign_id',type:'auto'},{name:'campaign_name',type:'auto'},{name:'status',type:'auto'},{name:'workspace',type:'auto'}];var ds=new MktGrids.JsonGroupingStore({url:'explorer/getCampaignMonitorData',baseParams:{},idProperty:'campaign_id',root:'data.campaigns',fields:fields,groupField:'type',sortInfo:{field:'type',sortDir:'ASC'},groupOnSort:false,remoteGroup:false,remoteSort:false});var grid=new _app.MonitorGrid({cm:cm,ds:ds,view:new Ext.grid.GroupingView({groupTextTpl:'{group}',showGroupName:false,hideGroupedColumn:true}),autoExpandColumn:'campaign_name',autoExpandMin:500,enableColumnHide:false,disableSelection:true,trackMouseOver:false});grid.on('cellclick',function(grid,rowIndex,columnIndex,e){if(Ext.get(e.target).hasClass('clickable')){var record=grid.getStore().getAt(rowIndex);if(record){MktDlManager.loadDl({type:'MA',compType:'Smart Campaign',compId:record.get('campaign_id')});}}});ds.on('load',function(store){grid.pager.loading.setText(store.reader.jsonData.data.timestamp);});MktCanvas.fillCanvas(grid,canvas,true);grid.loadPagedGrid();};})();
/* ========== ../js/mktCustAdmin.js ============ */

function mktCADUserGrid(){}
mktCADUserGrid.deleteUser=function(animEl){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var isUser=rec.data['isUser'];var userName=rec.data['name'];var userEmail=rec.data['email'];if(MktPage.userid==userEmail){MktMessage.showWarning('You cannot delete your own account',undefined,undefined);return;}
if(isUser){MktMessage.confirm("Confirm",'Are you sure you want to delete user <b>\''+userName+'\'</b>?',undefined,mktCADUserGrid.doDeleteUser);}
else{var status=rec.data['userSince'];if(status=='Pending'){MktMessage.confirm("Confirm",'Are you sure you want to delete the pending invitation to <b>\''+userName+'\'</b>?',undefined,mktCADUserGrid.doDeleteUser);}
else{mktCADUserGrid.doDeleteUser();}}}
mktCADUserGrid.doDeleteUser=function(){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var parms={cadUserId:rec.data['userId'],cadIsUser:rec.data['isUser']};MktSession.clockCursor(true);delete MktPage.appVars.updateError;MktSession.ajaxRequest('custAdmin/deleteUserSubmit',{serializeParms:parms,onMySuccess:mktCADUserGrid.deleteUserDone});}
mktCADUserGrid.deleteUserDone=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.updateError)){Ext.MessageBox.show({title:'Delete User Failed',msg:MktPage.appVars.updateError,buttons:Ext.MessageBox.OK});delete MktPage.appVars.updateError;}
else{MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasRoles').config.contentValid=false;}}
mktCADUserGrid.editUser=function(animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){MktSession.ajaxRequest('custAdmin/editUser?cadUserId='+rec.data.userId,{onMySuccess:mktCADUserGrid.editUserModal});}}
return false;}
mktCADUserGrid.editUserModal=function(animEl){var page=MktPage;mktCADUserGrid.createUserModal(MktPage.appVars);MktSession.clockCursor(false);}
mktCADUserGrid.resetPassword=function(animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){delete MktPage.appVars.updateError;MktSession.ajaxRequest('custAdmin/resetPasswordSubmit?hpfpUserId='+rec.data.userId,{onMySuccess:mktCADUserGrid.resetPasswordDone});}}
return false;}
mktCADUserGrid.resetPasswordDone=function(){if(isDefined(MktPage.appVars.updateError)){Ext.MessageBox.show({title:'Password Reset Failed',msg:MktPage.appVars.updateError,buttons:Ext.MessageBox.OK});}
else{Ext.MessageBox.alert('Marketo','Reset password notification sent.');}
delete MktPage.appVars.updateError;}
mktCADUserGrid.createUser=function(e){mktCADUserGrid.createUserModal(e.target);}
mktCADUserGrid.createUserModal=function(editAppVars){var userId=isDefined(editAppVars.userId)?editAppVars.userId:'';var firstName=isDefined(editAppVars.firstName)?editAppVars.firstName:'';var lastName=isDefined(editAppVars.lastName)?editAppVars.lastName:'';var userEmail=isDefined(editAppVars.email)?editAppVars.email:'';var createWindowTitle=isDefined(editAppVars.userId)?'Edit User':'Invite New User';var createWindowIconCls=isDefined(editAppVars.userId)?'mkiUserEdit':'mkiUserAdd';var createButtonText=isDefined(editAppVars.userId)?'Save':'Invite';var createButtonIcon=isDefined(editAppVars.userId)?'mkiOk':'mkiAdd2';var inviteFieldType="textarea";var userInvitationMsg=""
+"{{FirstName}} {{LastName}},\n"
+"Marketo Lead Management is ready for you to login.\n"
+"Click the following link to reset your password and get started.\n"
+"\n"
+"{{LoginToMarketoLink}}\n"
+"\n"
+"If you have any questions, check out {{CustomerSuccessPortalLink}} or {{AskForHelpLink}}.\n"
+"\n"
+"Happy Marketing!\n"
+"The Marketo Team";var sparkUserInvitationMsg=""
+"{{FirstName}} {{LastName}},\n"
+"Spark by Marketo is ready for you to login.\n"
+"Click the following link to reset your password and get started.\n"
+"\n"
+"{{LoginToSparkLink}}\n"
+"\n"
+"If you have any questions, check out {{SparkCustomerSuccessPortalLink}}.\n"
+"\n"
+"Happy Marketing!\n"
+"The Spark Team";var resetPasswordButton={};if(MktPage.userid==userEmail){MktMessage.showWarning('Please use \'My Account\' to edit your own account settings',undefined,undefined);return;}
if(userId!=''){var inviteFieldType='hidden';}
var createUserForm=new Ext.form.FormPanel({formId:'createUserForm',baseCls:'x-plain',cls:'mktDialogFormPanel',labelWidth:110,defaultType:'textfield',style:'padding:5px',items:[{fieldLabel:'First Name',id:'cadFirstName',name:'cadFirstName',value:firstName,itemCls:'mktRequired',anchor:'100%'},{fieldLabel:'Last Name',id:'cadLastName',name:'cadLastName',value:lastName,itemCls:'mktRequired',anchor:'100%'},{fieldLabel:'Email/Login',id:'cadEmail',name:'cadEmail',value:userEmail,itemCls:'mktRequired',anchor:'100%'},{fieldLabel:'Invitation',xtype:inviteFieldType,region:'south',id:'cadMessage',name:'cadMessage',value:(MktPage.isSpark())?sparkUserInvitationMsg:userInvitationMsg,height:100,anchor:'100%'},{xtype:'hidden',id:'cadUserId',name:'cadUserId',value:userId},{xtype:'hidden',id:'cadRole',name:'cadRole',value:''}]});var userModal=new Ext.Window({title:createWindowTitle,cls:'mktModalForm',iconCls:createWindowIconCls,modal:true,width:600,minWidth:400,height:535,minHeight:500,items:createUserForm,buttons:[{text:createButtonText,iconCls:createButtonIcon,handler:function(){mktCADUserGrid.submitInviteUserModal(createUserForm);}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){userModal.close();}}]});MktSession.ajaxRequest('/custAdmin/getRolesAndZones',{onMySuccess:mktCADUserGrid.buildRoles.createDelegate(this,[createUserForm,userModal,editAppVars])});}
mktCADUserGrid.buildRoles=function(createUserForm,userModal,editAppVars){var rolesJson=Ext.decode(MktPage.appVars.rolesJson);var zonesJson=Ext.decode(MktPage.appVars.zonesJson);if(isDefined(editAppVars.userId)){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();if(rec){var currentRoles=rec.data.roles;}}
var rolesTree=new Mkt.widgets.CheckedTreePanel({id:'rolePermsTree',fieldLabel:MktSession.zoneAccess?'Roles and Workspaces':'Roles',cls:'mktTreeBox-NoIcons',itemCls:isDefined(editAppVars.userId)?'':'mktRequired',xtype:'checkedTreePanel',isFormField:true,frame:false,height:isDefined(editAppVars.userId)?280:180,autoScroll:true,rootVisible:false,root:'',loader:'',preloadChildren:true,listeners:{'checkchange':function(node,checked){if(!checked){var parent=node.parentNode;this.setChecked([parent.id],false);}
if(!node.childredRendered){this.getLoader().doPreload(node);}
var childIds=new Array();node.cascade(function(){childIds.push(this.id);});this.setChecked(childIds,checked);this.setCheckedTotal(this.root);if(node.attributes.isOnlyAllZones){this.disableRoles(checked);}},'load':function(node){this.setCheckedTotal(this.root);}},setCheckedTotal:function(root){var nodes=root.childNodes;var node;var totalBoxes=0;var totalChecked=0;for(var i=0;i<nodes.length;i++){node=nodes[i];if(node&&!node.isLeaf()){if(!node.childredRendered){this.getLoader().doPreload(node);}
totalBoxes=0;totalChecked=0;node.cascade(function(){totalBoxes++;if(this.attributes.checked)
totalChecked++;});if(totalChecked==totalBoxes){node.setText(node.text.split(' (')[0]+" ("+"all workspaces"+")");}else{node.setText(node.text.split(' (')[0]+" ("+totalChecked+" of "+Math.max(totalBoxes-1,0)+" workspaces)");}}}},disableRoles:function(bool){var nodes=this.root.childNodes;for(var i=1;i<nodes.length;i++){bool?nodes[i].disable():nodes[i].enable();nodes[i].cascade(function(){bool?this.disable():this.enable();});}}});for(var i=0;i<zonesJson.length;i++){zonesJson[i].zoneId=zonesJson[i].id;zonesJson[i].text=zonesJson[i].name;zonesJson[i].checked=false;zonesJson[i].leaf=true;}
var roleIndex=null;for(var i=0;i<rolesJson.length;i++){rolesJson[i].roleId=rolesJson[i].id;rolesJson[i].text=rolesJson[i].name;rolesJson[i].qtip=rolesJson[i].desc;rolesJson[i].checked=false;if(currentRoles){for(var r=0;r<currentRoles.length;r++){if(currentRoles[r].id==rolesJson[i].roleId){if(currentRoles[r].allzones){rolesJson[i].checked=true;}
roleIndex=r;break;}}}
if(!MktSession.zoneAccess){rolesJson[i].leaf=true;}else{rolesJson[i].children=Ext.decode(Ext.encode(zonesJson));}
if(rolesJson[i].children&&MktSession.zoneAccess){for(var j=0;j<rolesJson[i].children.length;j++){rolesJson[i].children[j].id=rolesJson[i].id+'_'+rolesJson[i].children[j].zoneId;if(rolesJson[i].isOnlyAllZones){rolesJson[i].children[j].disabled=true;}
if(currentRoles&&roleIndex!=null){if(currentRoles[roleIndex].allzones){rolesJson[i].children[j].checked=true;}else{for(var z=0;z<currentRoles[roleIndex].zones.length;z++){if(currentRoles[roleIndex].zones[z].id==rolesJson[i].children[j].zoneId){rolesJson[i].children[j].checked=true;}}}}}}
roleIndex=null;}
var root=new Ext.tree.AsyncTreeNode({children:rolesJson});rolesTree.setRootNode(root);createUserForm.insert(3,rolesTree);if(!createUserForm.form.findField(rolesTree.id)){createUserForm.getForm().add(rolesTree);}
userModal.show();MktSession.activeModalForm=createUserForm;MktSession.activeModalForm.dlg=userModal;MktSession.clockCursor(false);}
mktCADUserGrid.submitInviteUserModal=function(createUserForm){var userId=createUserForm.form.findField("cadUserId").getValue();var userFirstName=Ext.util.Format.trim(createUserForm.form.findField("cadFirstName").getValue());var userLastName=Ext.util.Format.trim(createUserForm.form.findField("cadLastName").getValue());var userEmail=Ext.util.Format.trim(createUserForm.form.findField("cadEmail").getValue());var hasCheckedRoles=false;if(userFirstName==''||userLastName==''||userEmail==''){MktSession.setExtWindowFormError('Please fill in a correct value on all required fields');return false;}
MktSession.clockCursor(true);var rolesArray=new Array();var roleTree=createUserForm.form.findField("rolePermsTree");var roleNodes=roleTree.root.attributes.children;for(var i=0;i<roleNodes.length;i++){rolesArray.push({id:roleNodes[i].roleId,allzones:roleNodes[i].checked,zones:new Array(0)});if(roleNodes[i].checked){hasCheckedRoles=true;}
var zoneNodes=roleNodes[i].children;if(zoneNodes){for(var j=0;j<zoneNodes.length;j++){if(zoneNodes[j].checked){rolesArray[rolesArray.length-1].zones.push({id:zoneNodes[j].zoneId});hasCheckedRoles=true;}}}}
if(userId==''&&hasCheckedRoles==false){MktSession.setExtWindowFormError('Please fill in a correct value on all required fields');MktSession.clockCursor(false);return false;}
createUserForm.form.findField("cadRole").setValue(Ext.encode(rolesArray));if(isDefined(userId)&&userId!=''){MktSession.ajaxRequest('/custAdmin/editUserSubmit',{serializeForm:'createUserForm',onMySuccess:mktCADUserGrid.createUserDone});}else{MktSession.ajaxRequest('/custAdmin/inviteUserSubmit',{serializeForm:'createUserForm',onMySuccess:mktCADUserGrid.createUserDone});}
return false;}
mktCADUserGrid.createUserDone=function(){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){grid.getStore().reload();MktCanvas.getItem('cp_cadCanvasRoles').config.contentValid=false;}
MktSession.clockCursor(false);}
function mktCADRoleGrid(){}
mktCADRoleGrid.createRole=function(e){mktCADRoleGrid.createRoleModal(e.target);}
mktCADRoleGrid.createRoleModal=function(editAppVars){var roleId=isDefined(editAppVars.roleId)?editAppVars.roleId:'';var roleName=isDefined(editAppVars.roleName)?editAppVars.roleName:'';var roleDescription=isDefined(editAppVars.roleDescription)?editAppVars.roleDescription:'';var roleType=isDefined(editAppVars.roleType)?editAppVars.roleType:'';var createWindowTitle=isDefined(editAppVars.roleId)?'Edit Role':'Create New Role';var createWindowIconCls=isDefined(editAppVars.roleId)?'mkiIdCardEdit':'mkiIdCardAdd';var createButtonText=isDefined(editAppVars.roleId)?'Save':'Create';var createButtonIcon=isDefined(editAppVars.roleId)?'mkiOk':'mkiAdd2';var permTree=new Mkt.widgets.CheckedTreePanel({id:'rolePermsTree',fieldLabel:'Permissions',cls:'mktTreeBox-NoIcons',xtype:'checkedTreePanel',isFormField:true,frame:false,height:280,autoScroll:true,rootVisible:false,root:'',loader:'',preloadChildren:true,listeners:{'checkchange':function(node,checked){if(checked){var parentIds=new Array();var parent=node.parentNode;while(parent&&parent.id!='root'){parentIds.push(parent.id);parent=parent.parentNode;}
this.setChecked(parentIds,true);}
if(!node.childredRendered){this.getLoader().doPreload(node);}
var childIds=new Array();node.cascade(function(){childIds.push(this.id);});this.setChecked(childIds,checked);this.setCheckedTotal(this.root);},'load':function(node){this.setCheckedTotal(this.root);}}});if(isDefined(editAppVars.roleId)){var root=new Ext.tree.AsyncTreeNode({children:editAppVars.rolePerms});permTree.setRootNode(root);}else{permTree.getLoader().dataUrl="/custAdmin/getPermissions";}
var createRoleForm=new Ext.form.FormPanel({formId:'createRoleForm',baseCls:'x-plain',cls:'mktDialogFormPanel',labelWidth:110,defaultType:'textfield',style:'padding:5px',items:[{fieldLabel:'Role Name',id:'roleName',name:'roleName',value:roleName,itemCls:'mktRequired',anchor:'100%'},{fieldLabel:'Description',xtype:'textarea',id:'roleDescription',name:'roleDescription',value:roleDescription,anchor:'100%'},{xtype:'hidden',id:'roleId',name:'roleId',value:roleId},{xtype:'hidden',id:'permsCapIdsArray',name:'permsCapIdsArray',anchor:'100%'},permTree]});var mp=new Ext.Window({title:createWindowTitle,cls:'mktModalForm',iconCls:createWindowIconCls,modal:true,width:600,minWidth:400,height:535,minHeight:500,items:createRoleForm,buttons:[{text:createButtonText,iconCls:createButtonIcon,handler:function(){mktCADRoleGrid.submitCreateRoleModal(createRoleForm);}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){mp.close();}}]});mp.show();MktSession.activeModalForm=createRoleForm;MktSession.activeModalForm.dlg=mp;}
mktCADRoleGrid.submitCreateRoleModal=function(roleFormPanel){var roleName=roleFormPanel.form.findField("roleName").getValue();var roleId=roleFormPanel.form.findField("roleId").getValue();var checkedCapIds=roleFormPanel.findById("rolePermsTree").getChecked('capId');roleFormPanel.form.findField("permsCapIdsArray").setValue(Ext.util.JSON.encode(checkedCapIds));if(isDefined(roleId)&&roleId!=''){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var roleType=rec.data['type'];if(roleType=='system'){MktMessage.showWarning('<b>\''+roleName+'\'</b> is a system role and cannot be changed',undefined,undefined);return;}}
if(roleName==''){MktSession.setExtWindowFormError('Please fill in a correct value on all required fields');return false;}
MktSession.clockCursor(true);MktSession.ajaxRequest('/custAdmin/createRoleSubmit',{serializeForm:'createRoleForm',onMySuccess:mktCADRoleGrid.createRoleDone});return false;}
mktCADRoleGrid.createRoleDone=function(){MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasUsers').config.contentValid=false;MktSession.clockCursor(false);}
mktCADRoleGrid.editRole=function(animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){MktSession.ajaxRequest('custAdmin/editRole?cadRoleId='+rec.data.id,{onMySuccess:mktCADRoleGrid.editRoleModal});}}
return false;}
mktCADRoleGrid.editRoleModal=function(animEl){var page=MktPage;mktCADRoleGrid.createRoleModal(MktPage.appVars);MktSession.clockCursor(false);}
mktCADRoleGrid.deleteRole=function(animEl){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var roleId=rec.data['id'];var roleName=rec.data['name'];var roleType=rec.data['type'];var roleUsers=rec.data['users'];if(roleType=='system'){MktMessage.showWarning('<b>\''+roleName+'\'</b> is a system role and cannot be deleted',undefined,undefined);return;}else if(roleUsers>0){MktMessage.showWarning('<b>\''+roleName+'\'</b> role is assigned to '+roleUsers+' user(s) and cannot be deleted',undefined,undefined);return;}
else{MktMessage.confirm("Confirm",'Are you sure you want to delete role <b>\''+roleName+'\'</b>?',undefined,mktCADRoleGrid.doDeleteRole);}}
mktCADRoleGrid.doDeleteRole=function(){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var parms={cadRoleId:rec.data['id']};MktSession.clockCursor(true);delete MktPage.appVars.updateError;MktSession.ajaxRequest('custAdmin/deleteRoleSubmit',{serializeParms:parms,onMySuccess:mktCADRoleGrid.deleteRoleDone});}
mktCADRoleGrid.deleteRoleDone=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.updateError)){Ext.MessageBox.show({title:'Delete Role',msg:MktPage.appVars.updateError,buttons:Ext.MessageBox.OK});delete MktPage.appVars.updateError;}
else{MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasUsers').config.contentValid=false;}}
function mktCADZoneGrid(){}
mktCADZoneGrid.createZone=function(e){mktCADZoneGrid.createZoneModal(e.target);}
mktCADZoneGrid.createZoneModal=function(editAppVars){MktSession.clockCursor(true);var zoneId=isDefined(editAppVars.zoneId)?editAppVars.zoneId:'';var zoneName=isDefined(editAppVars.name)?editAppVars.name:'';var zoneDescription=isDefined(editAppVars.desc)?editAppVars.desc:'';var createWindowTitle=isDefined(editAppVars.zoneId)?'Edit Workspace':'Create New Workspace';var createWindowIconCls=isDefined(editAppVars.zoneId)?'mkiEnvironmentEdit':'mkiEnvironmentAdd';var createButtonText=isDefined(editAppVars.zoneId)?'Save':'Create';var createButtonIcon=isDefined(editAppVars.zoneId)?'mkiOk':'mkiAdd2';var createZoneForm=new Ext.form.FormPanel({formId:'createZoneForm',baseCls:'x-plain',cls:'mktDialogFormPanel',labelWidth:150,layout:'form',defaultType:'textfield',style:'padding:5px',items:[{fieldLabel:'Workspace Name',id:'zoneName',name:'zoneName',value:zoneName,itemCls:'mktRequired',anchor:'100%',listeners:{'render':function(field){if(zoneId!=''){field.getEl().on('keyup',function(){if(this.startValue!=this.getEl().getValue()){MktSession.setExtWindowFormMsg("<i>Note: <span style='font-weight:normal'>Changing Workspace name will not rename existing assets</span></i>");}else{MktSession.clearExtWindowFormError();}},field);}}}},{fieldLabel:'Description',xtype:'textarea',id:'zoneDescription',name:'zoneDescription',value:zoneDescription,anchor:'100%'},{xtype:'hidden',id:'zoneId',name:'zoneId',value:zoneId},{xtype:'hidden',id:'prtnsArray',name:'prtnsArray'},{xtype:'hidden',id:'primaryPrtn',name:'primaryPrtn'}]});var zoneModal=new Ext.Window({title:createWindowTitle,cls:'mktModalForm',iconCls:createWindowIconCls,modal:true,width:600,minWidth:400,height:520,minHeight:515,items:createZoneForm,buttons:[{text:createButtonText,iconCls:createButtonIcon,handler:function(){mktCADZoneGrid.submitCreateZoneModal(createZoneForm);}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){zoneModal.close();}}]});MktSession.ajaxRequest('/custAdmin/getAllPartitions?return=sfViewJson',{onMySuccess:mktCADZoneGrid.buildPartitions.createDelegate(this,[createZoneForm,zoneModal,editAppVars])});}
mktCADZoneGrid.buildPartitions=function(createZoneForm,zoneModal,editAppVars){var zonePartitionsJson=Ext.decode(MktPage.appVars.zonePartitions);var zonePartitions=zonePartitionsJson.data;var zoneGlobalViz=isDefined(editAppVars.globalViz)?editAppVars.globalViz:false;var checkAllBox=new Ext.form.Checkbox({fieldLabel:'Lead Partitions',id:'zoneAllPartitions',name:'zoneAllPartitions',checked:zoneGlobalViz,boxLabel:'All Lead Partitions (present and future)',listeners:{'check':function(node,checked){var prtnCheckBoxesGroup=this.ownerCt.form.findField("prtnCheckGroup");prtnCheckBoxesGroup.setDisabled(checked);for(var i=0;i<prtnCheckBoxesGroup.items.length;i++){if(prtnCheckBoxesGroup.items.itemAt(i).checked!=checked){prtnCheckBoxesGroup.items.itemAt(i).setValue(checked);}}}}});createZoneForm.add(checkAllBox);var updatePrimary=function(node,checked){if(primaryComboBox){var newItem=new Array();newItem['id']=node.initialConfig.stateId;newItem['name']=node.initialConfig.boxLabel;if(checked){var rec=new Ext.data.Record(newItem);primaryComboBox.store.add(rec);}else{var index=primaryComboBox.store.find('name',newItem['name'])
if(index!=-1){primaryComboBox.store.removeAt(index);}
if(newItem['name']==primaryComboBox.getRawValue()){primaryComboBox.clearValue();}}}}
var items=new Array();var primaryItems=new Array();var primaryId='';for(var i=0;i<zonePartitions.length;i++){var ptnCheckBox=new Ext.form.Checkbox({boxLabel:zonePartitions[i].name,stateId:zonePartitions[i].id,ctCls:'mktIndentCheckBox',listeners:{'check':function(node,checked){updatePrimary(node,checked);}}});if(editAppVars.ptns){for(var j=0;j<editAppVars.ptns.length;j++){if(editAppVars.ptns[j].id==zonePartitions[i].id){ptnCheckBox.setValue(true);primaryItems.push([zonePartitions[i].id,zonePartitions[i].name]);if(editAppVars.ptns[j].isPrimary){primaryId=editAppVars.ptns[j].id;}}}}
items.push(ptnCheckBox);}
var prtnCheckBoxGroup=new Ext.form.CheckboxGroup({fieldLabel:'',id:'prtnCheckGroup',name:'prtnCheckGroup',labelSeparator:'',xtype:'checkboxgroup',style:'height:190px; overflow:auto',itemCls:'mktCheckBoxGroup',columns:1,disabled:zoneGlobalViz,items:items});createZoneForm.add(prtnCheckBoxGroup);var primaryComboBox=new Ext.form.ComboBox({fieldLabel:'Primary Lead Partition',id:'primaryPartition',name:'primaryPartition',columns:1,anchor:'100%',mode:'local',displayField:'name',valueField:'id',emptyText:'Select...',forceSelection:false,setEditable:false,lazyInit:false,disableKeyFilter:true,typeAhead:true,triggerAction:'all',selectOnFocus:true,store:new Ext.data.SimpleStore({fields:['id','name'],data:primaryItems}),listeners:{'render':function(node){this.setRawValue(primaryId);}}});createZoneForm.add(primaryComboBox);zoneModal.show();MktSession.activeModalForm=createZoneForm;MktSession.activeModalForm.dlg=zoneModal;MktSession.clockCursor(false);}
mktCADZoneGrid.submitCreateZoneModal=function(zoneFormPanel){var zoneName=zoneFormPanel.form.findField('zoneName').getValue();var zonePrtns=zoneFormPanel.form.findField('prtnCheckGroup').items.items;var primPrtns=zoneFormPanel.form.findField('primaryPartition');var allPrtns=zoneFormPanel.form.findField('zoneAllPartitions');var prtns=new Array();for(var i=0;i<zonePrtns.length;i++){if(zonePrtns[i].checked){prtns.push(zonePrtns[i].stateId);}}
zoneFormPanel.form.findField('prtnsArray').setValue(Ext.encode(prtns));zoneFormPanel.form.findField('primaryPrtn').setValue(primPrtns.getValue());if(zoneName==''){MktSession.setExtWindowFormError('Please fill in a correct value on all required fields');return false;}
if(!allPrtns.checked&&prtns.length==0){MktSession.setExtWindowFormError('Please select at least one lead partition');return false;}
MktSession.clockCursor(true);MktSession.ajaxRequest('/custAdmin/createZoneSubmit',{serializeForm:'createZoneForm',onMySuccess:mktCADZoneGrid.createZoneDone});return false;}
mktCADZoneGrid.createZoneDone=function(){MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasPartitions').config.contentValid=false;MktSession.clockCursor(false);}
mktCADZoneGrid.editZone=function(animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){mktCADZoneGrid.createZoneModal(rec.data);}}
return false;}
mktCADZoneGrid.deleteZone=function(e){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var zoneId=rec.data['id'];var zoneName=rec.data['name'];MktMessage.confirm("Confirm",'Are you sure you want to delete <b>\''+zoneName+'\'</b> workspace?',undefined,mktCADZoneGrid.doDeleteZone);}
mktCADZoneGrid.doDeleteZone=function(){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var zoneId=rec.data.id;var zoneName=rec.data.name;var parms={cadZoneId:zoneId};MktMessage.showWarning('<b>\''+zoneName+'\'</b> workspace has assets and cannot be deleted!',undefined,undefined);return;}
mktCADZoneGrid.deleteZoneDone=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.updateError)){Ext.MessageBox.show({title:'Delete Workspace',msg:MktPage.appVars.updateError,buttons:Ext.MessageBox.OK});delete MktPage.appVars.updateError;}
else{MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasPartitions').config.contentValid=false;}}
function mktCADPartitionGrid(){}
mktCADPartitionGrid.createPartition=function(e){mktCADPartitionGrid.createPartitionModal(e.target);}
mktCADPartitionGrid.createPartitionModal=function(editAppVars){MktSession.clockCursor(true);var partitionId=isDefined(editAppVars.partitionId)?editAppVars.partitionId:'';var partitionName=isDefined(editAppVars.name)?editAppVars.name:'';var partitionDescription=isDefined(editAppVars.desc)?editAppVars.desc:'';var createWindowTitle=isDefined(editAppVars.partitionId)?'Edit Lead Partition':'Create New Lead Partition';var createWindowIconCls=isDefined(editAppVars.partitionId)?'mkiDataEdit':'mkiDataAdd';var createButtonText=isDefined(editAppVars.partitionId)?'Save':'Create';var createButtonIcon=isDefined(editAppVars.partitionId)?'mkiOk':'mkiAdd2';var createPartitionForm=new Ext.form.FormPanel({formId:'createPartitionForm',baseCls:'x-plain',cls:'mktDialogFormPanel',labelWidth:150,defaultType:'textfield',style:'padding:5px',items:[{fieldLabel:'Lead Partition Name',id:'partitionName',name:'partitionName',value:partitionName,itemCls:'mktRequired',anchor:'100%'},{fieldLabel:'Description',xtype:'textarea',id:'partitionDescription',name:'partitionDescription',value:partitionDescription,anchor:'100%'},{xtype:'hidden',id:'partitionId',name:'partitionId',value:partitionId},{xtype:'hidden',id:'zonesArray',name:'zonesArray'}]});var partitionModal=new Ext.Window({title:createWindowTitle,cls:'mktModalForm',iconCls:createWindowIconCls,modal:true,width:600,minWidth:400,height:500,minHeight:480,items:createPartitionForm,buttons:[{text:createButtonText,iconCls:createButtonIcon,handler:function(){mktCADPartitionGrid.submitCreatePartitionModal(createPartitionForm);}},{text:'Cancel',iconCls:'mkiCancel',handler:function(){partitionModal.close();}}]});MktSession.ajaxRequest("/custAdmin/getAllZones?return=sfViewJson",{onMySuccess:mktCADPartitionGrid.buildZones.createDelegate(this,[createPartitionForm,partitionModal,editAppVars])});}
mktCADPartitionGrid.buildZones=function(createPartitionForm,partitionModal,editAppVars){var partitionZonesJson=Ext.decode(MktPage.appVars.partitionZones);var partitionZones=partitionZonesJson.data;var items=new Array();for(var i=0;i<partitionZones.length;i++){var ptnCheckBox=new Ext.form.Checkbox({boxLabel:partitionZones[i].name,stateId:partitionZones[i].id,ctCls:'mktIndentCheckBox'});if(editAppVars.zones){for(var j=0;j<editAppVars.zones.length;j++){if(editAppVars.zones[j].id==partitionZones[i].id){ptnCheckBox.setValue(true);for(var p=0;p<partitionZones[i].ptns.length;p++){if(partitionZones[i].ptns[p].id==editAppVars.partitionId&&partitionZones[i].ptns[p].isPrimary){ptnCheckBox.disable();ptnCheckBox.boxLabel+=" (primary)";}}}}}
items.push(ptnCheckBox);}
var zonesCheckBoxGroup=new Ext.form.CheckboxGroup({fieldLabel:'Workspaces',xtype:'checkboxgroup',id:'zonesCheckGroup',name:'zonesCheckGroup',style:'height:250px; overflow:auto',itemCls:'mktCheckBoxGroup',columns:1,items:items});createPartitionForm.add(zonesCheckBoxGroup);partitionModal.show();MktSession.activeModalForm=createPartitionForm;MktSession.activeModalForm.dlg=partitionModal;MktSession.clockCursor(false);}
mktCADPartitionGrid.submitCreatePartitionModal=function(partitionFormPanel){var partitionName=partitionFormPanel.form.findField('partitionName').getValue();var partitionZones=partitionFormPanel.form.findField('zonesCheckGroup').items.items;var zones=new Array();for(var i=0;i<partitionZones.length;i++){if(partitionZones[i].checked){zones.push(partitionZones[i].stateId);}}
partitionFormPanel.form.findField('zonesArray').setValue(Ext.encode(zones));if(partitionName==''){MktSession.setExtWindowFormError('Please fill in a correct value on all required fields');return false;}
MktSession.clockCursor(true);MktSession.ajaxRequest('/custAdmin/createPartitionSubmit',{serializeForm:'createPartitionForm',onMySuccess:mktCADPartitionGrid.createPartitionDone});return false;}
mktCADPartitionGrid.createPartitionDone=function(){MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasZones').config.contentValid=false;MktSession.clockCursor(false);}
mktCADPartitionGrid.editPartition=function(animEl){var grid=MktCanvas.getActiveTab().getGridPanel();if(grid){var rec=grid.getSelectionModel().getSelected();if(rec){mktCADPartitionGrid.createPartitionModal(rec.data);}}
return false;}
mktCADPartitionGrid.editPartitionModal=function(animEl){var page=MktPage;mktCADPartitionGrid.createPartitionModal(MktPage.appVars);MktSession.clockCursor(false);}
mktCADPartitionGrid.submitEditPartitionModal=function(mf){delete MktPage.appVars.cadPartitionData;MktSession.ajaxRequest('/custAdmin/editPartitionSubmit',{serializeForm:'cadSubmitForm',onMySuccess:mktCADPartitionGrid.editPartitionDone});return false;}
mktCADPartitionGrid.editPartitionDone=function(){if(isDefined(MktPage.appVars.cadPartitionData)){MktCanvas.getActiveTab().getGridPanel().getStore().reload();}}
mktCADPartitionGrid.deletePartition=function(e){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var partitionName=rec.data.name;MktMessage.confirm("Confirm",'Are you sure you want to delete <b>\''+partitionName+'\'</b> lead partition?',undefined,mktCADPartitionGrid.doDeletePartition);}
mktCADPartitionGrid.doDeletePartition=function(){var rec=MktCanvas.getActiveTab().getGridPanel().getSelectionModel().getSelected();var partitionId=rec.data.partitionId;var partitionName=rec.data.name;var partitionLead=rec.data.leadCount;if(partitionLead>0){MktMessage.showWarning('<b>\''+partitionName+'\'</b> has leads and cannot be deleted!',undefined,undefined);return;}else{MktSession.clockCursor(true);var parms={cadPartitionId:partitionId};delete MktPage.appVars.updateError;MktSession.ajaxRequest('custAdmin/deletePartitionSubmit',{serializeParms:parms,onMySuccess:mktCADPartitionGrid.deletePartitionDone});}}
mktCADPartitionGrid.deletePartitionDone=function(){MktSession.clockCursor(false);if(isDefined(MktPage.appVars.updateError)){Ext.MessageBox.show({title:'Delete Lead Partition',msg:MktPage.appVars.updateError,buttons:Ext.MessageBox.OK});delete MktPage.appVars.updateError;}
else{MktCanvas.getActiveTab().getGridPanel().getStore().reload();MktCanvas.getItem('cp_cadCanvasZones').config.contentValid=false;}}